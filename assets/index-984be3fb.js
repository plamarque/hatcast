(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Xp(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const Nt={},ka=[],$r=()=>{},VT=()=>!1,ah=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),Zp=n=>n.startsWith("onUpdate:"),Dn=Object.assign,em=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},OT=Object.prototype.hasOwnProperty,St=(n,e)=>OT.call(n,e),Ke=Array.isArray,Da=n=>rc(n)==="[object Map]",cl=n=>rc(n)==="[object Set]",Iv=n=>rc(n)==="[object Date]",Ze=n=>typeof n=="function",gn=n=>typeof n=="string",jr=n=>typeof n=="symbol",$t=n=>n!==null&&typeof n=="object",A_=n=>($t(n)||Ze(n))&&Ze(n.then)&&Ze(n.catch),S_=Object.prototype.toString,rc=n=>S_.call(n),MT=n=>rc(n).slice(8,-1),P_=n=>rc(n)==="[object Object]",tm=n=>gn(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,cu=Xp(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),lh=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},LT=/-(\w)/g,Cr=lh(n=>n.replace(LT,(e,t)=>t?t.toUpperCase():"")),$T=/\B([A-Z])/g,Gi=lh(n=>n.replace($T,"-$1").toLowerCase()),uh=lh(n=>n.charAt(0).toUpperCase()+n.slice(1)),yf=lh(n=>n?`on${uh(n)}`:""),Ci=(n,e)=>!Object.is(n,e),ad=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},ep=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},Pd=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let Ev;const ch=()=>Ev||(Ev=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function br(n){if(Ke(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=gn(r)?qT(r):br(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(gn(n)||$t(n))return n}const FT=/;(?![^(]*\))/g,UT=/:([^]+)/,jT=/\/\*[^]*?\*\//g;function qT(n){const e={};return n.replace(jT,"").split(FT).forEach(t=>{if(t){const r=t.split(UT);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function Xt(n){let e="";if(gn(n))e=n;else if(Ke(n))for(let t=0;t<n.length;t++){const r=Xt(n[t]);r&&(e+=r+" ")}else if($t(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const BT="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",zT=Xp(BT);function R_(n){return!!n||n===""}function KT(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=sc(n[r],e[r]);return t}function sc(n,e){if(n===e)return!0;let t=Iv(n),r=Iv(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=jr(n),r=jr(e),t||r)return n===e;if(t=Ke(n),r=Ke(e),t||r)return t&&r?KT(n,e):!1;if(t=$t(n),r=$t(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!sc(n[o],e[o]))return!1}}return String(n)===String(e)}function nm(n,e){return n.findIndex(t=>sc(t,e))}const C_=n=>!!(n&&n.__v_isRef===!0),se=n=>gn(n)?n:n==null?"":Ke(n)||$t(n)&&(n.toString===S_||!Ze(n.toString))?C_(n)?se(n.value):JSON.stringify(n,k_,2):String(n),k_=(n,e)=>C_(e)?k_(n,e.value):Da(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[_f(r,i)+" =>"]=s,t),{})}:cl(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>_f(t))}:jr(e)?_f(e):$t(e)&&!Ke(e)&&!P_(e)?String(e):e,_f=(n,e="")=>{var t;return jr(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let ur;class GT{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=ur,!e&&ur&&(this.index=(ur.scopes||(ur.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=ur;try{return ur=this,e()}finally{ur=t}}}on(){++this._on===1&&(this.prevScope=ur,ur=this)}off(){this._on>0&&--this._on===0&&(ur=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function HT(){return ur}let Mt;const bf=new WeakSet;class D_{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,ur&&ur.active&&ur.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,bf.has(this)&&(bf.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||V_(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Tv(this),O_(this);const e=Mt,t=Fr;Mt=this,Fr=!0;try{return this.fn()}finally{M_(this),Mt=e,Fr=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)im(e);this.deps=this.depsTail=void 0,Tv(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?bf.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){tp(this)&&this.run()}get dirty(){return tp(this)}}let N_=0,du,hu;function V_(n,e=!1){if(n.flags|=8,e){n.next=hu,hu=n;return}n.next=du,du=n}function rm(){N_++}function sm(){if(--N_>0)return;if(hu){let e=hu;for(hu=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;du;){let e=du;for(du=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function O_(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function M_(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),im(r),WT(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function tp(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(L_(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function L_(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===Au)||(n.globalVersion=Au,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!tp(n))))return;n.flags|=2;const e=n.dep,t=Mt,r=Fr;Mt=n,Fr=!0;try{O_(n);const s=n.fn(n._value);(e.version===0||Ci(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{Mt=t,Fr=r,M_(n),n.flags&=-3}}function im(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)im(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function WT(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let Fr=!0;const $_=[];function Ls(){$_.push(Fr),Fr=!1}function $s(){const n=$_.pop();Fr=n===void 0?!0:n}function Tv(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=Mt;Mt=void 0;try{e()}finally{Mt=t}}}let Au=0;class QT{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class om{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Mt||!Fr||Mt===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Mt)t=this.activeLink=new QT(Mt,this),Mt.deps?(t.prevDep=Mt.depsTail,Mt.depsTail.nextDep=t,Mt.depsTail=t):Mt.deps=Mt.depsTail=t,F_(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=Mt.depsTail,t.nextDep=void 0,Mt.depsTail.nextDep=t,Mt.depsTail=t,Mt.deps===t&&(Mt.deps=r)}return t}trigger(e){this.version++,Au++,this.notify(e)}notify(e){rm();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{sm()}}}function F_(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)F_(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const np=new WeakMap,Do=Symbol(""),rp=Symbol(""),Su=Symbol("");function zn(n,e,t){if(Fr&&Mt){let r=np.get(n);r||np.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new om),s.map=r,s.key=t),s.track()}}function Ss(n,e,t,r,s,i){const o=np.get(n);if(!o){Au++;return}const a=l=>{l&&l.trigger()};if(rm(),e==="clear")o.forEach(a);else{const l=Ke(n),c=l&&tm(t);if(l&&t==="length"){const h=Number(r);o.forEach((f,g)=>{(g==="length"||g===Su||!jr(g)&&g>=h)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(Su)),e){case"add":l?c&&a(o.get("length")):(a(o.get(Do)),Da(n)&&a(o.get(rp)));break;case"delete":l||(a(o.get(Do)),Da(n)&&a(o.get(rp)));break;case"set":Da(n)&&a(o.get(Do));break}}sm()}function ba(n){const e=At(n);return e===n?e:(zn(e,"iterate",Su),Pr(n)?e:e.map(Mn))}function dh(n){return zn(n=At(n),"iterate",Su),n}const JT={__proto__:null,[Symbol.iterator](){return wf(this,Symbol.iterator,Mn)},concat(...n){return ba(this).concat(...n.map(e=>Ke(e)?ba(e):e))},entries(){return wf(this,"entries",n=>(n[1]=Mn(n[1]),n))},every(n,e){return Is(this,"every",n,e,void 0,arguments)},filter(n,e){return Is(this,"filter",n,e,t=>t.map(Mn),arguments)},find(n,e){return Is(this,"find",n,e,Mn,arguments)},findIndex(n,e){return Is(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return Is(this,"findLast",n,e,Mn,arguments)},findLastIndex(n,e){return Is(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return Is(this,"forEach",n,e,void 0,arguments)},includes(...n){return xf(this,"includes",n)},indexOf(...n){return xf(this,"indexOf",n)},join(n){return ba(this).join(n)},lastIndexOf(...n){return xf(this,"lastIndexOf",n)},map(n,e){return Is(this,"map",n,e,void 0,arguments)},pop(){return Kl(this,"pop")},push(...n){return Kl(this,"push",n)},reduce(n,...e){return Av(this,"reduce",n,e)},reduceRight(n,...e){return Av(this,"reduceRight",n,e)},shift(){return Kl(this,"shift")},some(n,e){return Is(this,"some",n,e,void 0,arguments)},splice(...n){return Kl(this,"splice",n)},toReversed(){return ba(this).toReversed()},toSorted(n){return ba(this).toSorted(n)},toSpliced(...n){return ba(this).toSpliced(...n)},unshift(...n){return Kl(this,"unshift",n)},values(){return wf(this,"values",Mn)}};function wf(n,e,t){const r=dh(n),s=r[e]();return r!==n&&!Pr(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const YT=Array.prototype;function Is(n,e,t,r,s,i){const o=dh(n),a=o!==n&&!Pr(n),l=o[e];if(l!==YT[e]){const f=l.apply(n,i);return a?Mn(f):f}let c=t;o!==n&&(a?c=function(f,g){return t.call(this,Mn(f),g,n)}:t.length>2&&(c=function(f,g){return t.call(this,f,g,n)}));const h=l.call(o,c,r);return a&&s?s(h):h}function Av(n,e,t,r){const s=dh(n);let i=t;return s!==n&&(Pr(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,Mn(a),l,n)}),s[e](i,...r)}function xf(n,e,t){const r=At(n);zn(r,"iterate",Su);const s=r[e](...t);return(s===-1||s===!1)&&um(t[0])?(t[0]=At(t[0]),r[e](...t)):s}function Kl(n,e,t=[]){Ls(),rm();const r=At(n)[e].apply(n,t);return sm(),$s(),r}const XT=Xp("__proto__,__v_isRef,__isVue"),U_=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(jr));function ZT(n){jr(n)||(n=String(n));const e=At(this);return zn(e,"has",n),e.hasOwnProperty(n)}class j_{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?uA:K_:i?z_:B_).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=Ke(e);if(!s){let l;if(o&&(l=JT[t]))return l;if(t==="hasOwnProperty")return ZT}const a=Reflect.get(e,t,Gn(e)?e:r);return(jr(t)?U_.has(t):XT(t))||(s||zn(e,"get",t),i)?a:Gn(a)?o&&tm(t)?a:a.value:$t(a)?s?H_(a):hh(a):a}}class q_ extends j_{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=Mi(i);if(!Pr(r)&&!Mi(r)&&(i=At(i),r=At(r)),!Ke(e)&&Gn(i)&&!Gn(r))return l?!1:(i.value=r,!0)}const o=Ke(e)&&tm(t)?Number(t)<e.length:St(e,t),a=Reflect.set(e,t,r,Gn(e)?e:s);return e===At(s)&&(o?Ci(r,i)&&Ss(e,"set",t,r):Ss(e,"add",t,r)),a}deleteProperty(e,t){const r=St(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&Ss(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!jr(t)||!U_.has(t))&&zn(e,"has",t),r}ownKeys(e){return zn(e,"iterate",Ke(e)?"length":Do),Reflect.ownKeys(e)}}class eA extends j_{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const tA=new q_,nA=new eA,rA=new q_(!0);const sp=n=>n,Hc=n=>Reflect.getPrototypeOf(n);function sA(n,e,t){return function(...r){const s=this.__v_raw,i=At(s),o=Da(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...r),h=t?sp:e?Rd:Mn;return!e&&zn(i,"iterate",l?rp:Do),{next(){const{value:f,done:g}=c.next();return g?{value:f,done:g}:{value:a?[h(f[0]),h(f[1])]:h(f),done:g}},[Symbol.iterator](){return this}}}}function Wc(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function iA(n,e){const t={get(s){const i=this.__v_raw,o=At(i),a=At(s);n||(Ci(s,a)&&zn(o,"get",s),zn(o,"get",a));const{has:l}=Hc(o),c=e?sp:n?Rd:Mn;if(l.call(o,s))return c(i.get(s));if(l.call(o,a))return c(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&zn(At(s),"iterate",Do),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=At(i),a=At(s);return n||(Ci(s,a)&&zn(o,"has",s),zn(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=At(a),c=e?sp:n?Rd:Mn;return!n&&zn(l,"iterate",Do),a.forEach((h,f)=>s.call(i,c(h),c(f),o))}};return Dn(t,n?{add:Wc("add"),set:Wc("set"),delete:Wc("delete"),clear:Wc("clear")}:{add(s){!e&&!Pr(s)&&!Mi(s)&&(s=At(s));const i=At(this);return Hc(i).has.call(i,s)||(i.add(s),Ss(i,"add",s,s)),this},set(s,i){!e&&!Pr(i)&&!Mi(i)&&(i=At(i));const o=At(this),{has:a,get:l}=Hc(o);let c=a.call(o,s);c||(s=At(s),c=a.call(o,s));const h=l.call(o,s);return o.set(s,i),c?Ci(i,h)&&Ss(o,"set",s,i):Ss(o,"add",s,i),this},delete(s){const i=At(this),{has:o,get:a}=Hc(i);let l=o.call(i,s);l||(s=At(s),l=o.call(i,s)),a&&a.call(i,s);const c=i.delete(s);return l&&Ss(i,"delete",s,void 0),c},clear(){const s=At(this),i=s.size!==0,o=s.clear();return i&&Ss(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=sA(s,n,e)}),t}function am(n,e){const t=iA(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(St(t,s)&&s in r?t:r,s,i)}const oA={get:am(!1,!1)},aA={get:am(!1,!0)},lA={get:am(!0,!1)};const B_=new WeakMap,z_=new WeakMap,K_=new WeakMap,uA=new WeakMap;function cA(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function dA(n){return n.__v_skip||!Object.isExtensible(n)?0:cA(MT(n))}function hh(n){return Mi(n)?n:lm(n,!1,tA,oA,B_)}function G_(n){return lm(n,!1,rA,aA,z_)}function H_(n){return lm(n,!0,nA,lA,K_)}function lm(n,e,t,r,s){if(!$t(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=dA(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function Na(n){return Mi(n)?Na(n.__v_raw):!!(n&&n.__v_isReactive)}function Mi(n){return!!(n&&n.__v_isReadonly)}function Pr(n){return!!(n&&n.__v_isShallow)}function um(n){return n?!!n.__v_raw:!1}function At(n){const e=n&&n.__v_raw;return e?At(e):n}function hA(n){return!St(n,"__v_skip")&&Object.isExtensible(n)&&ep(n,"__v_skip",!0),n}const Mn=n=>$t(n)?hh(n):n,Rd=n=>$t(n)?H_(n):n;function Gn(n){return n?n.__v_isRef===!0:!1}function P(n){return W_(n,!1)}function fA(n){return W_(n,!0)}function W_(n,e){return Gn(n)?n:new pA(n,e)}class pA{constructor(e,t){this.dep=new om,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:At(e),this._value=t?e:Mn(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||Pr(e)||Mi(e);e=r?e:At(e),Ci(e,t)&&(this._rawValue=e,this._value=r?e:Mn(e),this.dep.trigger())}}function ss(n){return Gn(n)?n.value:n}const mA={get:(n,e,t)=>e==="__v_raw"?n:ss(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return Gn(s)&&!Gn(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function Q_(n){return Na(n)?n:new Proxy(n,mA)}class gA{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new om(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Au-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&Mt!==this)return V_(this,!0),!0}get value(){const e=this.dep.track();return L_(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function vA(n,e,t=!1){let r,s;return Ze(n)?r=n:(r=n.get,s=n.set),new gA(r,s,t)}const Qc={},Cd=new WeakMap;let bo;function yA(n,e=!1,t=bo){if(t){let r=Cd.get(t);r||Cd.set(t,r=[]),r.push(n)}}function _A(n,e,t=Nt){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,c=L=>s?L:Pr(L)||s===!1||s===0?Ps(L,1):Ps(L);let h,f,g,y,I=!1,S=!1;if(Gn(n)?(f=()=>n.value,I=Pr(n)):Na(n)?(f=()=>c(n),I=!0):Ke(n)?(S=!0,I=n.some(L=>Na(L)||Pr(L)),f=()=>n.map(L=>{if(Gn(L))return L.value;if(Na(L))return c(L);if(Ze(L))return l?l(L,2):L()})):Ze(n)?e?f=l?()=>l(n,2):n:f=()=>{if(g){Ls();try{g()}finally{$s()}}const L=bo;bo=h;try{return l?l(n,3,[y]):n(y)}finally{bo=L}}:f=$r,e&&s){const L=f,re=s===!0?1/0:s;f=()=>Ps(L(),re)}const E=HT(),$=()=>{h.stop(),E&&E.active&&em(E.effects,h)};if(i&&e){const L=e;e=(...re)=>{L(...re),$()}}let F=S?new Array(n.length).fill(Qc):Qc;const M=L=>{if(!(!(h.flags&1)||!h.dirty&&!L))if(e){const re=h.run();if(s||I||(S?re.some((W,x)=>Ci(W,F[x])):Ci(re,F))){g&&g();const W=bo;bo=h;try{const x=[re,F===Qc?void 0:S&&F[0]===Qc?[]:F,y];F=re,l?l(e,3,x):e(...x)}finally{bo=W}}}else h.run()};return a&&a(M),h=new D_(f),h.scheduler=o?()=>o(M,!1):M,y=L=>yA(L,!1,h),g=h.onStop=()=>{const L=Cd.get(h);if(L){if(l)l(L,4);else for(const re of L)re();Cd.delete(h)}},e?r?M(!0):F=h.run():o?o(M.bind(null,!0),!0):h.run(),$.pause=h.pause.bind(h),$.resume=h.resume.bind(h),$.stop=$,$}function Ps(n,e=1/0,t){if(e<=0||!$t(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,Gn(n))Ps(n.value,e,t);else if(Ke(n))for(let r=0;r<n.length;r++)Ps(n[r],e,t);else if(cl(n)||Da(n))n.forEach(r=>{Ps(r,e,t)});else if(P_(n)){for(const r in n)Ps(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&Ps(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function ic(n,e,t,r){try{return r?n(...r):n()}catch(s){fh(s,e,t)}}function ls(n,e,t,r){if(Ze(n)){const s=ic(n,e,t,r);return s&&A_(s)&&s.catch(i=>{fh(i,e,t)}),s}if(Ke(n)){const s=[];for(let i=0;i<n.length;i++)s.push(ls(n[i],e,t,r));return s}}function fh(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||Nt;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const h=a.ec;if(h){for(let f=0;f<h.length;f++)if(h[f](n,l,c)===!1)return}a=a.parent}if(i){Ls(),ic(i,null,10,[n,l,c]),$s();return}}bA(n,t,s,r,o)}function bA(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const Zn=[];let Zr=-1;const Va=[];let vi=null,Ta=0;const J_=Promise.resolve();let kd=null;function Ht(n){const e=kd||J_;return n?e.then(this?n.bind(this):n):e}function wA(n){let e=Zr+1,t=Zn.length;for(;e<t;){const r=e+t>>>1,s=Zn[r],i=Pu(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function cm(n){if(!(n.flags&1)){const e=Pu(n),t=Zn[Zn.length-1];!t||!(n.flags&2)&&e>=Pu(t)?Zn.push(n):Zn.splice(wA(e),0,n),n.flags|=1,Y_()}}function Y_(){kd||(kd=J_.then(Z_))}function xA(n){Ke(n)?Va.push(...n):vi&&n.id===-1?vi.splice(Ta+1,0,n):n.flags&1||(Va.push(n),n.flags|=1),Y_()}function Sv(n,e,t=Zr+1){for(;t<Zn.length;t++){const r=Zn[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;Zn.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function X_(n){if(Va.length){const e=[...new Set(Va)].sort((t,r)=>Pu(t)-Pu(r));if(Va.length=0,vi){vi.push(...e);return}for(vi=e,Ta=0;Ta<vi.length;Ta++){const t=vi[Ta];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}vi=null,Ta=0}}const Pu=n=>n.id==null?n.flags&2?-1:1/0:n.id;function Z_(n){const e=$r;try{for(Zr=0;Zr<Zn.length;Zr++){const t=Zn[Zr];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),ic(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;Zr<Zn.length;Zr++){const t=Zn[Zr];t&&(t.flags&=-2)}Zr=-1,Zn.length=0,X_(),kd=null,(Zn.length||Va.length)&&Z_()}}let $n=null,eb=null;function Dd(n){const e=$n;return $n=n,eb=n&&n.type.__scopeId||null,e}function IA(n,e=$n,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&Fv(-1);const i=Dd(e);let o;try{o=n(...s)}finally{Dd(i),r._d&&Fv(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function at(n,e){if($n===null)return n;const t=vh($n),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=Nt]=e[s];i&&(Ze(i)&&(i={mounted:i,updated:i}),i.deep&&Ps(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function vo(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(Ls(),ls(l,t,8,[n.el,a,n,e]),$s())}}const tb=Symbol("_vte"),EA=n=>n.__isTeleport,fu=n=>n&&(n.disabled||n.disabled===""),Pv=n=>n&&(n.defer||n.defer===""),Rv=n=>typeof SVGElement<"u"&&n instanceof SVGElement,Cv=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,ip=(n,e)=>{const t=n&&n.to;return gn(t)?e?e(t):null:t},nb={name:"Teleport",__isTeleport:!0,process(n,e,t,r,s,i,o,a,l,c){const{mc:h,pc:f,pbc:g,o:{insert:y,querySelector:I,createText:S,createComment:E}}=c,$=fu(e.props);let{shapeFlag:F,children:M,dynamicChildren:L}=e;if(n==null){const re=e.el=S(""),W=e.anchor=S("");y(re,t,r),y(W,t,r);const x=(A,C)=>{F&16&&(s&&s.isCE&&(s.ce._teleportTarget=A),h(M,A,C,s,i,o,a,l))},b=()=>{const A=e.target=ip(e.props,I),C=rb(A,e,S,y);A&&(o!=="svg"&&Rv(A)?o="svg":o!=="mathml"&&Cv(A)&&(o="mathml"),$||(x(A,C),ld(e,!1)))};$&&(x(t,W),ld(e,!0)),Pv(e.props)?(e.el.__isMounted=!1,Xn(()=>{b(),delete e.el.__isMounted},i)):b()}else{if(Pv(e.props)&&n.el.__isMounted===!1){Xn(()=>{nb.process(n,e,t,r,s,i,o,a,l,c)},i);return}e.el=n.el,e.targetStart=n.targetStart;const re=e.anchor=n.anchor,W=e.target=n.target,x=e.targetAnchor=n.targetAnchor,b=fu(n.props),A=b?t:W,C=b?re:x;if(o==="svg"||Rv(W)?o="svg":(o==="mathml"||Cv(W))&&(o="mathml"),L?(g(n.dynamicChildren,L,A,s,i,o,a),mm(n,e,!0)):l||f(n,e,A,C,s,i,o,a,!1),$)b?e.props&&n.props&&e.props.to!==n.props.to&&(e.props.to=n.props.to):Jc(e,t,re,c,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const O=e.target=ip(e.props,I);O&&Jc(e,O,null,c,0)}else b&&Jc(e,W,x,c,1);ld(e,$)}},remove(n,e,t,{um:r,o:{remove:s}},i){const{shapeFlag:o,children:a,anchor:l,targetStart:c,targetAnchor:h,target:f,props:g}=n;if(f&&(s(c),s(h)),i&&s(l),o&16){const y=i||!fu(g);for(let I=0;I<a.length;I++){const S=a[I];r(S,e,t,y,!!S.dynamicChildren)}}},move:Jc,hydrate:TA};function Jc(n,e,t,{o:{insert:r},m:s},i=2){i===0&&r(n.targetAnchor,e,t);const{el:o,anchor:a,shapeFlag:l,children:c,props:h}=n,f=i===2;if(f&&r(o,e,t),(!f||fu(h))&&l&16)for(let g=0;g<c.length;g++)s(c[g],e,t,2);f&&r(a,e,t)}function TA(n,e,t,r,s,i,{o:{nextSibling:o,parentNode:a,querySelector:l,insert:c,createText:h}},f){const g=e.target=ip(e.props,l);if(g){const y=fu(e.props),I=g._lpa||g.firstChild;if(e.shapeFlag&16)if(y)e.anchor=f(o(n),e,a(n),t,r,s,i),e.targetStart=I,e.targetAnchor=I&&o(I);else{e.anchor=o(n);let S=I;for(;S;){if(S&&S.nodeType===8){if(S.data==="teleport start anchor")e.targetStart=S;else if(S.data==="teleport anchor"){e.targetAnchor=S,g._lpa=e.targetAnchor&&o(e.targetAnchor);break}}S=o(S)}e.targetAnchor||rb(g,e,h,c),f(I&&o(I),e,g,t,r,s,i)}ld(e,y)}return e.anchor&&o(e.anchor)}const Ru=nb;function ld(n,e){const t=n.ctx;if(t&&t.ut){let r,s;for(e?(r=n.el,s=n.anchor):(r=n.targetStart,s=n.targetAnchor);r&&r!==s;)r.nodeType===1&&r.setAttribute("data-v-owner",t.uid),r=r.nextSibling;t.ut()}}function rb(n,e,t,r){const s=e.targetStart=t(""),i=e.targetAnchor=t("");return s[tb]=i,n&&(r(s,n),r(i,n)),i}function dm(n,e){n.shapeFlag&6&&n.component?(n.transition=e,dm(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}/*! #__NO_SIDE_EFFECTS__ */function sb(n,e){return Ze(n)?(()=>Dn({name:n.name},e,{setup:n}))():n}function ib(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function pu(n,e,t,r,s=!1){if(Ke(n)){n.forEach((I,S)=>pu(I,e&&(Ke(e)?e[S]:e),t,r,s));return}if(Oa(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&pu(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?vh(r.component):r.el,o=s?null:i,{i:a,r:l}=n,c=e&&e.r,h=a.refs===Nt?a.refs={}:a.refs,f=a.setupState,g=At(f),y=f===Nt?()=>!1:I=>St(g,I);if(c!=null&&c!==l&&(gn(c)?(h[c]=null,y(c)&&(f[c]=null)):Gn(c)&&(c.value=null)),Ze(l))ic(l,a,12,[o,h]);else{const I=gn(l),S=Gn(l);if(I||S){const E=()=>{if(n.f){const $=I?y(l)?f[l]:h[l]:l.value;s?Ke($)&&em($,i):Ke($)?$.includes(i)||$.push(i):I?(h[l]=[i],y(l)&&(f[l]=h[l])):(l.value=[i],n.k&&(h[n.k]=l.value))}else I?(h[l]=o,y(l)&&(f[l]=o)):S&&(l.value=o,n.k&&(h[n.k]=o))};o?(E.id=-1,Xn(E,t)):E()}}}ch().requestIdleCallback;ch().cancelIdleCallback;const Oa=n=>!!n.type.__asyncLoader,ob=n=>n.type.__isKeepAlive;function AA(n,e){ab(n,"a",e)}function SA(n,e){ab(n,"da",e)}function ab(n,e,t=Kn){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(ph(e,r,t),t){let s=t.parent;for(;s&&s.parent;)ob(s.parent.vnode)&&PA(r,e,t,s),s=s.parent}}function PA(n,e,t,r){const s=ph(e,n,r,!0);ki(()=>{em(r[e],s)},t)}function ph(n,e,t=Kn,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{Ls();const a=oc(t),l=ls(e,t,n,o);return a(),$s(),l});return r?s.unshift(i):s.push(i),i}}const Gs=n=>(e,t=Kn)=>{(!Du||n==="sp")&&ph(n,(...r)=>e(...r),t)},RA=Gs("bm"),fn=Gs("m"),CA=Gs("bu"),kA=Gs("u"),lb=Gs("bum"),ki=Gs("um"),DA=Gs("sp"),NA=Gs("rtg"),VA=Gs("rtc");function OA(n,e=Kn){ph("ec",n,e)}const ub="components";function MA(n,e){return $A(ub,n,!0,e)||n}const LA=Symbol.for("v-ndc");function $A(n,e,t=!0,r=!1){const s=$n||Kn;if(s){const i=s.type;if(n===ub){const a=T1(i,!1);if(a&&(a===e||a===Cr(e)||a===uh(Cr(e))))return i}const o=kv(s[n]||i[n],e)||kv(s.appContext[n],e);return!o&&r?i:o}}function kv(n,e){return n&&(n[e]||n[Cr(e)]||n[uh(Cr(e))])}function wr(n,e,t,r){let s;const i=t&&t[r],o=Ke(n);if(o||gn(n)){const a=o&&Na(n);let l=!1,c=!1;a&&(l=!Pr(n),c=Mi(n),n=dh(n)),s=new Array(n.length);for(let h=0,f=n.length;h<f;h++)s[h]=e(l?c?Rd(Mn(n[h])):Mn(n[h]):n[h],h,void 0,i&&i[h])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if($t(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const h=a[l];s[l]=e(n[h],h,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}function FA(n,e,t={},r,s){if($n.ce||$n.parent&&Oa($n.parent)&&$n.parent.ce)return e!=="default"&&(t.name=e),D(),Ns(ot,null,[Qe("slot",t,r&&r())],64);let i=n[e];i&&i._c&&(i._d=!1),D();const o=i&&cb(i(t)),a=t.key||o&&o.key,l=Ns(ot,{key:(a&&!jr(a)?a:`_${e}`)+(!o&&r?"_fb":"")},o||(r?r():[]),o&&n._===1?64:-2);return!s&&l.scopeId&&(l.slotScopeIds=[l.scopeId+"-s"]),i&&i._c&&(i._d=!0),l}function cb(n){return n.some(e=>ku(e)?!(e.type===Fs||e.type===ot&&!cb(e.children)):!0)?n:null}const op=n=>n?Pb(n)?vh(n):op(n.parent):null,mu=Dn(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>op(n.parent),$root:n=>op(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>hm(n),$forceUpdate:n=>n.f||(n.f=()=>{cm(n.update)}),$nextTick:n=>n.n||(n.n=Ht.bind(n.proxy)),$watch:n=>o1.bind(n)}),If=(n,e)=>n!==Nt&&!n.__isScriptSetup&&St(n,e),UA={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const y=o[e];if(y!==void 0)switch(y){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(If(r,e))return o[e]=1,r[e];if(s!==Nt&&St(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&St(c,e))return o[e]=3,i[e];if(t!==Nt&&St(t,e))return o[e]=4,t[e];ap&&(o[e]=0)}}const h=mu[e];let f,g;if(h)return e==="$attrs"&&zn(n.attrs,"get",""),h(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==Nt&&St(t,e))return o[e]=4,t[e];if(g=l.config.globalProperties,St(g,e))return g[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return If(s,e)?(s[e]=t,!0):r!==Nt&&St(r,e)?(r[e]=t,!0):St(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==Nt&&St(n,o)||If(e,o)||(a=i[0])&&St(a,o)||St(r,o)||St(mu,o)||St(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:St(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function Dv(n){return Ke(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let ap=!0;function jA(n){const e=hm(n),t=n.proxy,r=n.ctx;ap=!1,e.beforeCreate&&Nv(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:c,created:h,beforeMount:f,mounted:g,beforeUpdate:y,updated:I,activated:S,deactivated:E,beforeDestroy:$,beforeUnmount:F,destroyed:M,unmounted:L,render:re,renderTracked:W,renderTriggered:x,errorCaptured:b,serverPrefetch:A,expose:C,inheritAttrs:O,components:U,directives:R,filters:mt}=e;if(c&&qA(c,r,null),o)for(const ne in o){const ue=o[ne];Ze(ue)&&(r[ne]=ue.bind(t))}if(s){const ne=s.call(t,t);$t(ne)&&(n.data=hh(ne))}if(ap=!0,i)for(const ne in i){const ue=i[ne],ie=Ze(ue)?ue.bind(t,t):Ze(ue.get)?ue.get.bind(t,t):$r,De=!Ze(ue)&&Ze(ue.set)?ue.set.bind(t):$r,ee=Ue({get:ie,set:De});Object.defineProperty(r,ne,{enumerable:!0,configurable:!0,get:()=>ee.value,set:J=>ee.value=J})}if(a)for(const ne in a)db(a[ne],r,t,ne);if(l){const ne=Ze(l)?l.call(t):l;Reflect.ownKeys(ne).forEach(ue=>{ud(ue,ne[ue])})}h&&Nv(h,n,"c");function be(ne,ue){Ke(ue)?ue.forEach(ie=>ne(ie.bind(t))):ue&&ne(ue.bind(t))}if(be(RA,f),be(fn,g),be(CA,y),be(kA,I),be(AA,S),be(SA,E),be(OA,b),be(VA,W),be(NA,x),be(lb,F),be(ki,L),be(DA,A),Ke(C))if(C.length){const ne=n.exposed||(n.exposed={});C.forEach(ue=>{Object.defineProperty(ne,ue,{get:()=>t[ue],set:ie=>t[ue]=ie})})}else n.exposed||(n.exposed={});re&&n.render===$r&&(n.render=re),O!=null&&(n.inheritAttrs=O),U&&(n.components=U),R&&(n.directives=R),A&&ib(n)}function qA(n,e,t=$r){Ke(n)&&(n=lp(n));for(const r in n){const s=n[r];let i;$t(s)?"default"in s?i=Ur(s.from||r,s.default,!0):i=Ur(s.from||r):i=Ur(s),Gn(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function Nv(n,e,t){ls(Ke(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function db(n,e,t,r){let s=r.includes(".")?Ib(t,r):()=>t[r];if(gn(n)){const i=e[n];Ze(i)&&wt(s,i)}else if(Ze(n))wt(s,n.bind(t));else if($t(n))if(Ke(n))n.forEach(i=>db(i,e,t,r));else{const i=Ze(n.handler)?n.handler.bind(t):e[n.handler];Ze(i)&&wt(s,i,n)}}function hm(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(c=>Nd(l,c,o,!0)),Nd(l,e,o)),$t(e)&&i.set(e,l),l}function Nd(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&Nd(n,i,t,!0),s&&s.forEach(o=>Nd(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=BA[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const BA={data:Vv,props:Ov,emits:Ov,methods:nu,computed:nu,beforeCreate:Yn,created:Yn,beforeMount:Yn,mounted:Yn,beforeUpdate:Yn,updated:Yn,beforeDestroy:Yn,beforeUnmount:Yn,destroyed:Yn,unmounted:Yn,activated:Yn,deactivated:Yn,errorCaptured:Yn,serverPrefetch:Yn,components:nu,directives:nu,watch:KA,provide:Vv,inject:zA};function Vv(n,e){return e?n?function(){return Dn(Ze(n)?n.call(this,this):n,Ze(e)?e.call(this,this):e)}:e:n}function zA(n,e){return nu(lp(n),lp(e))}function lp(n){if(Ke(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function Yn(n,e){return n?[...new Set([].concat(n,e))]:e}function nu(n,e){return n?Dn(Object.create(null),n,e):e}function Ov(n,e){return n?Ke(n)&&Ke(e)?[...new Set([...n,...e])]:Dn(Object.create(null),Dv(n),Dv(e??{})):e}function KA(n,e){if(!n)return e;if(!e)return n;const t=Dn(Object.create(null),n);for(const r in e)t[r]=Yn(n[r],e[r]);return t}function hb(){return{app:null,config:{isNativeTag:VT,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let GA=0;function HA(n,e){return function(r,s=null){Ze(r)||(r=Dn({},r)),s!=null&&!$t(s)&&(s=null);const i=hb(),o=new WeakSet,a=[];let l=!1;const c=i.app={_uid:GA++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:S1,get config(){return i.config},set config(h){},use(h,...f){return o.has(h)||(h&&Ze(h.install)?(o.add(h),h.install(c,...f)):Ze(h)&&(o.add(h),h(c,...f))),c},mixin(h){return i.mixins.includes(h)||i.mixins.push(h),c},component(h,f){return f?(i.components[h]=f,c):i.components[h]},directive(h,f){return f?(i.directives[h]=f,c):i.directives[h]},mount(h,f,g){if(!l){const y=c._ceVNode||Qe(r,s);return y.appContext=i,g===!0?g="svg":g===!1&&(g=void 0),f&&e?e(y,h):n(y,h,g),l=!0,c._container=h,h.__vue_app__=c,vh(y.component)}},onUnmount(h){a.push(h)},unmount(){l&&(ls(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(h,f){return i.provides[h]=f,c},runWithContext(h){const f=Ma;Ma=c;try{return h()}finally{Ma=f}}};return c}}let Ma=null;function ud(n,e){if(Kn){let t=Kn.provides;const r=Kn.parent&&Kn.parent.provides;r===t&&(t=Kn.provides=Object.create(r)),t[n]=e}}function Ur(n,e,t=!1){const r=Kn||$n;if(r||Ma){let s=Ma?Ma._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&Ze(e)?e.call(r&&r.proxy):e}}const fb={},pb=()=>Object.create(fb),mb=n=>Object.getPrototypeOf(n)===fb;function WA(n,e,t,r=!1){const s={},i=pb();n.propsDefaults=Object.create(null),gb(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:G_(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function QA(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=At(s),[l]=n.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const h=n.vnode.dynamicProps;for(let f=0;f<h.length;f++){let g=h[f];if(mh(n.emitsOptions,g))continue;const y=e[g];if(l)if(St(i,g))y!==i[g]&&(i[g]=y,c=!0);else{const I=Cr(g);s[I]=up(l,a,I,y,n,!1)}else y!==i[g]&&(i[g]=y,c=!0)}}}else{gb(n,e,s,i)&&(c=!0);let h;for(const f in a)(!e||!St(e,f)&&((h=Gi(f))===f||!St(e,h)))&&(l?t&&(t[f]!==void 0||t[h]!==void 0)&&(s[f]=up(l,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!St(e,f))&&(delete i[f],c=!0)}c&&Ss(n.attrs,"set","")}function gb(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(cu(l))continue;const c=e[l];let h;s&&St(s,h=Cr(l))?!i||!i.includes(h)?t[h]=c:(a||(a={}))[h]=c:mh(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(i){const l=At(t),c=a||Nt;for(let h=0;h<i.length;h++){const f=i[h];t[f]=up(s,l,f,c[f],n,!St(c,f))}}return o}function up(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=St(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&Ze(l)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const h=oc(s);r=c[t]=l.call(null,e),h()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===Gi(t))&&(r=!0))}return r}const JA=new WeakMap;function vb(n,e,t=!1){const r=t?JA:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!Ze(n)){const h=f=>{l=!0;const[g,y]=vb(f,e,!0);Dn(o,g),y&&a.push(...y)};!t&&e.mixins.length&&e.mixins.forEach(h),n.extends&&h(n.extends),n.mixins&&n.mixins.forEach(h)}if(!i&&!l)return $t(n)&&r.set(n,ka),ka;if(Ke(i))for(let h=0;h<i.length;h++){const f=Cr(i[h]);Mv(f)&&(o[f]=Nt)}else if(i)for(const h in i){const f=Cr(h);if(Mv(f)){const g=i[h],y=o[f]=Ke(g)||Ze(g)?{type:g}:Dn({},g),I=y.type;let S=!1,E=!0;if(Ke(I))for(let $=0;$<I.length;++$){const F=I[$],M=Ze(F)&&F.name;if(M==="Boolean"){S=!0;break}else M==="String"&&(E=!1)}else S=Ze(I)&&I.name==="Boolean";y[0]=S,y[1]=E,(S||St(y,"default"))&&a.push(f)}}const c=[o,a];return $t(n)&&r.set(n,c),c}function Mv(n){return n[0]!=="$"&&!cu(n)}const fm=n=>n[0]==="_"||n==="$stable",pm=n=>Ke(n)?n.map(es):[es(n)],YA=(n,e,t)=>{if(e._n)return e;const r=IA((...s)=>pm(e(...s)),t);return r._c=!1,r},yb=(n,e,t)=>{const r=n._ctx;for(const s in n){if(fm(s))continue;const i=n[s];if(Ze(i))e[s]=YA(s,i,r);else if(i!=null){const o=pm(i);e[s]=()=>o}}},_b=(n,e)=>{const t=pm(e);n.slots.default=()=>t},bb=(n,e,t)=>{for(const r in e)(t||!fm(r))&&(n[r]=e[r])},XA=(n,e,t)=>{const r=n.slots=pb();if(n.vnode.shapeFlag&32){const s=e.__;s&&ep(r,"__",s,!0);const i=e._;i?(bb(r,e,t),t&&ep(r,"_",i,!0)):yb(e,r)}else e&&_b(n,e)},ZA=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=Nt;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:bb(s,e,t):(i=!e.$stable,yb(e,s)),o=e}else e&&(_b(n,e),o={default:1});if(i)for(const a in s)!fm(a)&&o[a]==null&&delete s[a]},Xn=f1;function e1(n){return t1(n)}function t1(n,e){const t=ch();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:c,setElementText:h,parentNode:f,nextSibling:g,setScopeId:y=$r,insertStaticContent:I}=n,S=(T,k,K,G=null,te=null,de=null,ye=void 0,ve=null,Ie=!!k.dynamicChildren)=>{if(T===k)return;T&&!Gl(T,k)&&(G=X(T),J(T,te,de,!0),T=null),k.patchFlag===-2&&(Ie=!1,k.dynamicChildren=null);const{type:ge,ref:$e,shapeFlag:Pe}=k;switch(ge){case gh:E(T,k,K,G);break;case Fs:$(T,k,K,G);break;case cd:T==null&&F(k,K,G,ye);break;case ot:U(T,k,K,G,te,de,ye,ve,Ie);break;default:Pe&1?re(T,k,K,G,te,de,ye,ve,Ie):Pe&6?R(T,k,K,G,te,de,ye,ve,Ie):(Pe&64||Pe&128)&&ge.process(T,k,K,G,te,de,ye,ve,Ie,Ne)}$e!=null&&te?pu($e,T&&T.ref,de,k||T,!k):$e==null&&T&&T.ref!=null&&pu(T.ref,null,de,T,!0)},E=(T,k,K,G)=>{if(T==null)r(k.el=a(k.children),K,G);else{const te=k.el=T.el;k.children!==T.children&&c(te,k.children)}},$=(T,k,K,G)=>{T==null?r(k.el=l(k.children||""),K,G):k.el=T.el},F=(T,k,K,G)=>{[T.el,T.anchor]=I(T.children,k,K,G,T.el,T.anchor)},M=({el:T,anchor:k},K,G)=>{let te;for(;T&&T!==k;)te=g(T),r(T,K,G),T=te;r(k,K,G)},L=({el:T,anchor:k})=>{let K;for(;T&&T!==k;)K=g(T),s(T),T=K;s(k)},re=(T,k,K,G,te,de,ye,ve,Ie)=>{k.type==="svg"?ye="svg":k.type==="math"&&(ye="mathml"),T==null?W(k,K,G,te,de,ye,ve,Ie):A(T,k,te,de,ye,ve,Ie)},W=(T,k,K,G,te,de,ye,ve)=>{let Ie,ge;const{props:$e,shapeFlag:Pe,transition:Oe,dirs:z}=T;if(Ie=T.el=o(T.type,de,$e&&$e.is,$e),Pe&8?h(Ie,T.children):Pe&16&&b(T.children,Ie,null,G,te,Ef(T,de),ye,ve),z&&vo(T,null,G,"created"),x(Ie,T,T.scopeId,ye,G),$e){for(const _e in $e)_e!=="value"&&!cu(_e)&&i(Ie,_e,null,$e[_e],de,G);"value"in $e&&i(Ie,"value",null,$e.value,de),(ge=$e.onVnodeBeforeMount)&&Xr(ge,G,T)}z&&vo(T,null,G,"beforeMount");const j=n1(te,Oe);j&&Oe.beforeEnter(Ie),r(Ie,k,K),((ge=$e&&$e.onVnodeMounted)||j||z)&&Xn(()=>{ge&&Xr(ge,G,T),j&&Oe.enter(Ie),z&&vo(T,null,G,"mounted")},te)},x=(T,k,K,G,te)=>{if(K&&y(T,K),G)for(let de=0;de<G.length;de++)y(T,G[de]);if(te){let de=te.subTree;if(k===de||Tb(de.type)&&(de.ssContent===k||de.ssFallback===k)){const ye=te.vnode;x(T,ye,ye.scopeId,ye.slotScopeIds,te.parent)}}},b=(T,k,K,G,te,de,ye,ve,Ie=0)=>{for(let ge=Ie;ge<T.length;ge++){const $e=T[ge]=ve?yi(T[ge]):es(T[ge]);S(null,$e,k,K,G,te,de,ye,ve)}},A=(T,k,K,G,te,de,ye)=>{const ve=k.el=T.el;let{patchFlag:Ie,dynamicChildren:ge,dirs:$e}=k;Ie|=T.patchFlag&16;const Pe=T.props||Nt,Oe=k.props||Nt;let z;if(K&&yo(K,!1),(z=Oe.onVnodeBeforeUpdate)&&Xr(z,K,k,T),$e&&vo(k,T,K,"beforeUpdate"),K&&yo(K,!0),(Pe.innerHTML&&Oe.innerHTML==null||Pe.textContent&&Oe.textContent==null)&&h(ve,""),ge?C(T.dynamicChildren,ge,ve,K,G,Ef(k,te),de):ye||ue(T,k,ve,null,K,G,Ef(k,te),de,!1),Ie>0){if(Ie&16)O(ve,Pe,Oe,K,te);else if(Ie&2&&Pe.class!==Oe.class&&i(ve,"class",null,Oe.class,te),Ie&4&&i(ve,"style",Pe.style,Oe.style,te),Ie&8){const j=k.dynamicProps;for(let _e=0;_e<j.length;_e++){const we=j[_e],We=Pe[we],Ye=Oe[we];(Ye!==We||we==="value")&&i(ve,we,We,Ye,te,K)}}Ie&1&&T.children!==k.children&&h(ve,k.children)}else!ye&&ge==null&&O(ve,Pe,Oe,K,te);((z=Oe.onVnodeUpdated)||$e)&&Xn(()=>{z&&Xr(z,K,k,T),$e&&vo(k,T,K,"updated")},G)},C=(T,k,K,G,te,de,ye)=>{for(let ve=0;ve<k.length;ve++){const Ie=T[ve],ge=k[ve],$e=Ie.el&&(Ie.type===ot||!Gl(Ie,ge)||Ie.shapeFlag&198)?f(Ie.el):K;S(Ie,ge,$e,null,G,te,de,ye,!0)}},O=(T,k,K,G,te)=>{if(k!==K){if(k!==Nt)for(const de in k)!cu(de)&&!(de in K)&&i(T,de,k[de],null,te,G);for(const de in K){if(cu(de))continue;const ye=K[de],ve=k[de];ye!==ve&&de!=="value"&&i(T,de,ve,ye,te,G)}"value"in K&&i(T,"value",k.value,K.value,te)}},U=(T,k,K,G,te,de,ye,ve,Ie)=>{const ge=k.el=T?T.el:a(""),$e=k.anchor=T?T.anchor:a("");let{patchFlag:Pe,dynamicChildren:Oe,slotScopeIds:z}=k;z&&(ve=ve?ve.concat(z):z),T==null?(r(ge,K,G),r($e,K,G),b(k.children||[],K,$e,te,de,ye,ve,Ie)):Pe>0&&Pe&64&&Oe&&T.dynamicChildren?(C(T.dynamicChildren,Oe,K,te,de,ye,ve),(k.key!=null||te&&k===te.subTree)&&mm(T,k,!0)):ue(T,k,K,$e,te,de,ye,ve,Ie)},R=(T,k,K,G,te,de,ye,ve,Ie)=>{k.slotScopeIds=ve,T==null?k.shapeFlag&512?te.ctx.activate(k,K,G,ye,Ie):mt(k,K,G,te,de,ye,Ie):gt(T,k,Ie)},mt=(T,k,K,G,te,de,ye)=>{const ve=T.component=b1(T,G,te);if(ob(T)&&(ve.ctx.renderer=Ne),w1(ve,!1,ye),ve.asyncDep){if(te&&te.registerDep(ve,be,ye),!T.el){const Ie=ve.subTree=Qe(Fs);$(null,Ie,k,K)}}else be(ve,T,k,K,te,de,ye)},gt=(T,k,K)=>{const G=k.component=T.component;if(d1(T,k,K))if(G.asyncDep&&!G.asyncResolved){ne(G,k,K);return}else G.next=k,G.update();else k.el=T.el,G.vnode=k},be=(T,k,K,G,te,de,ye)=>{const ve=()=>{if(T.isMounted){let{next:Pe,bu:Oe,u:z,parent:j,vnode:_e}=T;{const rt=wb(T);if(rt){Pe&&(Pe.el=_e.el,ne(T,Pe,ye)),rt.asyncDep.then(()=>{T.isUnmounted||ve()});return}}let we=Pe,We;yo(T,!1),Pe?(Pe.el=_e.el,ne(T,Pe,ye)):Pe=_e,Oe&&ad(Oe),(We=Pe.props&&Pe.props.onVnodeBeforeUpdate)&&Xr(We,j,Pe,_e),yo(T,!0);const Ye=Tf(T),bt=T.subTree;T.subTree=Ye,S(bt,Ye,f(bt.el),X(bt),T,te,de),Pe.el=Ye.el,we===null&&h1(T,Ye.el),z&&Xn(z,te),(We=Pe.props&&Pe.props.onVnodeUpdated)&&Xn(()=>Xr(We,j,Pe,_e),te)}else{let Pe;const{el:Oe,props:z}=k,{bm:j,m:_e,parent:we,root:We,type:Ye}=T,bt=Oa(k);if(yo(T,!1),j&&ad(j),!bt&&(Pe=z&&z.onVnodeBeforeMount)&&Xr(Pe,we,k),yo(T,!0),Oe&&ct){const rt=()=>{T.subTree=Tf(T),ct(Oe,T.subTree,T,te,null)};bt&&Ye.__asyncHydrate?Ye.__asyncHydrate(Oe,T,rt):rt()}else{We.ce&&We.ce._def.shadowRoot!==!1&&We.ce._injectChildStyle(Ye);const rt=T.subTree=Tf(T);S(null,rt,K,G,T,te,de),k.el=rt.el}if(_e&&Xn(_e,te),!bt&&(Pe=z&&z.onVnodeMounted)){const rt=k;Xn(()=>Xr(Pe,we,rt),te)}(k.shapeFlag&256||we&&Oa(we.vnode)&&we.vnode.shapeFlag&256)&&T.a&&Xn(T.a,te),T.isMounted=!0,k=K=G=null}};T.scope.on();const Ie=T.effect=new D_(ve);T.scope.off();const ge=T.update=Ie.run.bind(Ie),$e=T.job=Ie.runIfDirty.bind(Ie);$e.i=T,$e.id=T.uid,Ie.scheduler=()=>cm($e),yo(T,!0),ge()},ne=(T,k,K)=>{k.component=T;const G=T.vnode.props;T.vnode=k,T.next=null,QA(T,k.props,G,K),ZA(T,k.children,K),Ls(),Sv(T),$s()},ue=(T,k,K,G,te,de,ye,ve,Ie=!1)=>{const ge=T&&T.children,$e=T?T.shapeFlag:0,Pe=k.children,{patchFlag:Oe,shapeFlag:z}=k;if(Oe>0){if(Oe&128){De(ge,Pe,K,G,te,de,ye,ve,Ie);return}else if(Oe&256){ie(ge,Pe,K,G,te,de,ye,ve,Ie);return}}z&8?($e&16&&Ot(ge,te,de),Pe!==ge&&h(K,Pe)):$e&16?z&16?De(ge,Pe,K,G,te,de,ye,ve,Ie):Ot(ge,te,de,!0):($e&8&&h(K,""),z&16&&b(Pe,K,G,te,de,ye,ve,Ie))},ie=(T,k,K,G,te,de,ye,ve,Ie)=>{T=T||ka,k=k||ka;const ge=T.length,$e=k.length,Pe=Math.min(ge,$e);let Oe;for(Oe=0;Oe<Pe;Oe++){const z=k[Oe]=Ie?yi(k[Oe]):es(k[Oe]);S(T[Oe],z,K,null,te,de,ye,ve,Ie)}ge>$e?Ot(T,te,de,!0,!1,Pe):b(k,K,G,te,de,ye,ve,Ie,Pe)},De=(T,k,K,G,te,de,ye,ve,Ie)=>{let ge=0;const $e=k.length;let Pe=T.length-1,Oe=$e-1;for(;ge<=Pe&&ge<=Oe;){const z=T[ge],j=k[ge]=Ie?yi(k[ge]):es(k[ge]);if(Gl(z,j))S(z,j,K,null,te,de,ye,ve,Ie);else break;ge++}for(;ge<=Pe&&ge<=Oe;){const z=T[Pe],j=k[Oe]=Ie?yi(k[Oe]):es(k[Oe]);if(Gl(z,j))S(z,j,K,null,te,de,ye,ve,Ie);else break;Pe--,Oe--}if(ge>Pe){if(ge<=Oe){const z=Oe+1,j=z<$e?k[z].el:G;for(;ge<=Oe;)S(null,k[ge]=Ie?yi(k[ge]):es(k[ge]),K,j,te,de,ye,ve,Ie),ge++}}else if(ge>Oe)for(;ge<=Pe;)J(T[ge],te,de,!0),ge++;else{const z=ge,j=ge,_e=new Map;for(ge=j;ge<=Oe;ge++){const jt=k[ge]=Ie?yi(k[ge]):es(k[ge]);jt.key!=null&&_e.set(jt.key,ge)}let we,We=0;const Ye=Oe-j+1;let bt=!1,rt=0;const Er=new Array(Ye);for(ge=0;ge<Ye;ge++)Er[ge]=0;for(ge=z;ge<=Pe;ge++){const jt=T[ge];if(We>=Ye){J(jt,te,de,!0);continue}let nn;if(jt.key!=null)nn=_e.get(jt.key);else for(we=j;we<=Oe;we++)if(Er[we-j]===0&&Gl(jt,k[we])){nn=we;break}nn===void 0?J(jt,te,de,!0):(Er[nn-j]=ge+1,nn>=rt?rt=nn:bt=!0,S(jt,k[nn],K,null,te,de,ye,ve,Ie),We++)}const Tr=bt?r1(Er):ka;for(we=Tr.length-1,ge=Ye-1;ge>=0;ge--){const jt=j+ge,nn=k[jt],Un=jt+1<$e?k[jt+1].el:G;Er[ge]===0?S(null,nn,K,Un,te,de,ye,ve,Ie):bt&&(we<0||ge!==Tr[we]?ee(nn,K,Un,2):we--)}}},ee=(T,k,K,G,te=null)=>{const{el:de,type:ye,transition:ve,children:Ie,shapeFlag:ge}=T;if(ge&6){ee(T.component.subTree,k,K,G);return}if(ge&128){T.suspense.move(k,K,G);return}if(ge&64){ye.move(T,k,K,Ne);return}if(ye===ot){r(de,k,K);for(let Pe=0;Pe<Ie.length;Pe++)ee(Ie[Pe],k,K,G);r(T.anchor,k,K);return}if(ye===cd){M(T,k,K);return}if(G!==2&&ge&1&&ve)if(G===0)ve.beforeEnter(de),r(de,k,K),Xn(()=>ve.enter(de),te);else{const{leave:Pe,delayLeave:Oe,afterLeave:z}=ve,j=()=>{T.ctx.isUnmounted?s(de):r(de,k,K)},_e=()=>{Pe(de,()=>{j(),z&&z()})};Oe?Oe(de,j,_e):_e()}else r(de,k,K)},J=(T,k,K,G=!1,te=!1)=>{const{type:de,props:ye,ref:ve,children:Ie,dynamicChildren:ge,shapeFlag:$e,patchFlag:Pe,dirs:Oe,cacheIndex:z}=T;if(Pe===-2&&(te=!1),ve!=null&&(Ls(),pu(ve,null,K,T,!0),$s()),z!=null&&(k.renderCache[z]=void 0),$e&256){k.ctx.deactivate(T);return}const j=$e&1&&Oe,_e=!Oa(T);let we;if(_e&&(we=ye&&ye.onVnodeBeforeUnmount)&&Xr(we,k,T),$e&6)lt(T.component,K,G);else{if($e&128){T.suspense.unmount(K,G);return}j&&vo(T,null,k,"beforeUnmount"),$e&64?T.type.remove(T,k,K,Ne,G):ge&&!ge.hasOnce&&(de!==ot||Pe>0&&Pe&64)?Ot(ge,k,K,!1,!0):(de===ot&&Pe&384||!te&&$e&16)&&Ot(Ie,k,K),G&&Te(T)}(_e&&(we=ye&&ye.onVnodeUnmounted)||j)&&Xn(()=>{we&&Xr(we,k,T),j&&vo(T,null,k,"unmounted")},K)},Te=T=>{const{type:k,el:K,anchor:G,transition:te}=T;if(k===ot){He(K,G);return}if(k===cd){L(T);return}const de=()=>{s(K),te&&!te.persisted&&te.afterLeave&&te.afterLeave()};if(T.shapeFlag&1&&te&&!te.persisted){const{leave:ye,delayLeave:ve}=te,Ie=()=>ye(K,de);ve?ve(T.el,de,Ie):Ie()}else de()},He=(T,k)=>{let K;for(;T!==k;)K=g(T),s(T),T=K;s(k)},lt=(T,k,K)=>{const{bum:G,scope:te,job:de,subTree:ye,um:ve,m:Ie,a:ge,parent:$e,slots:{__:Pe}}=T;Lv(Ie),Lv(ge),G&&ad(G),$e&&Ke(Pe)&&Pe.forEach(Oe=>{$e.renderCache[Oe]=void 0}),te.stop(),de&&(de.flags|=8,J(ye,T,k,K)),ve&&Xn(ve,k),Xn(()=>{T.isUnmounted=!0},k),k&&k.pendingBranch&&!k.isUnmounted&&T.asyncDep&&!T.asyncResolved&&T.suspenseId===k.pendingId&&(k.deps--,k.deps===0&&k.resolve())},Ot=(T,k,K,G=!1,te=!1,de=0)=>{for(let ye=de;ye<T.length;ye++)J(T[ye],k,K,G,te)},X=T=>{if(T.shapeFlag&6)return X(T.component.subTree);if(T.shapeFlag&128)return T.suspense.next();const k=g(T.anchor||T.el),K=k&&k[tb];return K?g(K):k};let Ae=!1;const xe=(T,k,K)=>{T==null?k._vnode&&J(k._vnode,null,null,!0):S(k._vnode||null,T,k,null,null,null,K),k._vnode=T,Ae||(Ae=!0,Sv(),X_(),Ae=!1)},Ne={p:S,um:J,m:ee,r:Te,mt,mc:b,pc:ue,pbc:C,n:X,o:n};let tt,ct;return e&&([tt,ct]=e(Ne)),{render:xe,hydrate:tt,createApp:HA(xe,tt)}}function Ef({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function yo({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function n1(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function mm(n,e,t=!1){const r=n.children,s=e.children;if(Ke(r)&&Ke(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=yi(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&mm(o,a)),a.type===gh&&(a.el=o.el),a.type===Fs&&!a.el&&(a.el=o.el)}}function r1(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<c?i=a+1:o=a;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function wb(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:wb(e)}function Lv(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const s1=Symbol.for("v-scx"),i1=()=>Ur(s1);function wt(n,e,t){return xb(n,e,t)}function xb(n,e,t=Nt){const{immediate:r,deep:s,flush:i,once:o}=t,a=Dn({},t),l=e&&r||!e&&i!=="post";let c;if(Du){if(i==="sync"){const y=i1();c=y.__watcherHandles||(y.__watcherHandles=[])}else if(!l){const y=()=>{};return y.stop=$r,y.resume=$r,y.pause=$r,y}}const h=Kn;a.call=(y,I,S)=>ls(y,h,I,S);let f=!1;i==="post"?a.scheduler=y=>{Xn(y,h&&h.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(y,I)=>{I?y():cm(y)}),a.augmentJob=y=>{e&&(y.flags|=4),f&&(y.flags|=2,h&&(y.id=h.uid,y.i=h))};const g=_A(n,e,a);return Du&&(c?c.push(g):l&&g()),g}function o1(n,e,t){const r=this.proxy,s=gn(n)?n.includes(".")?Ib(r,n):()=>r[n]:n.bind(r,r);let i;Ze(e)?i=e:(i=e.handler,t=e);const o=oc(this),a=xb(s,i.bind(r),t);return o(),a}function Ib(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const a1=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Cr(e)}Modifiers`]||n[`${Gi(e)}Modifiers`];function l1(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||Nt;let s=t;const i=e.startsWith("update:"),o=i&&a1(r,e.slice(7));o&&(o.trim&&(s=t.map(h=>gn(h)?h.trim():h)),o.number&&(s=t.map(Pd)));let a,l=r[a=yf(e)]||r[a=yf(Cr(e))];!l&&i&&(l=r[a=yf(Gi(e))]),l&&ls(l,n,6,s);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,ls(c,n,6,s)}}function Eb(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!Ze(n)){const l=c=>{const h=Eb(c,e,!0);h&&(a=!0,Dn(o,h))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?($t(n)&&r.set(n,null),null):(Ke(i)?i.forEach(l=>o[l]=null):Dn(o,i),$t(n)&&r.set(n,o),o)}function mh(n,e){return!n||!ah(e)?!1:(e=e.slice(2).replace(/Once$/,""),St(n,e[0].toLowerCase()+e.slice(1))||St(n,Gi(e))||St(n,e))}function Tf(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:c,renderCache:h,props:f,data:g,setupState:y,ctx:I,inheritAttrs:S}=n,E=Dd(n);let $,F;try{if(t.shapeFlag&4){const L=s||r,re=L;$=es(c.call(re,L,h,f,y,g,I)),F=a}else{const L=e;$=es(L.length>1?L(f,{attrs:a,slots:o,emit:l}):L(f,null)),F=e.props?a:u1(a)}}catch(L){gu.length=0,fh(L,n,1),$=Qe(Fs)}let M=$;if(F&&S!==!1){const L=Object.keys(F),{shapeFlag:re}=M;L.length&&re&7&&(i&&L.some(Zp)&&(F=c1(F,i)),M=Ba(M,F,!1,!0))}return t.dirs&&(M=Ba(M,null,!1,!0),M.dirs=M.dirs?M.dirs.concat(t.dirs):t.dirs),t.transition&&dm(M,t.transition),$=M,Dd(E),$}const u1=n=>{let e;for(const t in n)(t==="class"||t==="style"||ah(t))&&((e||(e={}))[t]=n[t]);return e},c1=(n,e)=>{const t={};for(const r in n)(!Zp(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function d1(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?$v(r,o,c):!!o;if(l&8){const h=e.dynamicProps;for(let f=0;f<h.length;f++){const g=h[f];if(o[g]!==r[g]&&!mh(c,g))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?$v(r,o,c):!0:!!o;return!1}function $v(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!mh(t,i))return!0}return!1}function h1({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const Tb=n=>n.__isSuspense;function f1(n,e){e&&e.pendingBranch?Ke(n)?e.effects.push(...n):e.effects.push(n):xA(n)}const ot=Symbol.for("v-fgt"),gh=Symbol.for("v-txt"),Fs=Symbol.for("v-cmt"),cd=Symbol.for("v-stc"),gu=[];let xr=null;function D(n=!1){gu.push(xr=n?null:[])}function p1(){gu.pop(),xr=gu[gu.length-1]||null}let Cu=1;function Fv(n,e=!1){Cu+=n,n<0&&xr&&e&&(xr.hasOnce=!0)}function Ab(n){return n.dynamicChildren=Cu>0?xr||ka:null,p1(),Cu>0&&xr&&xr.push(n),n}function V(n,e,t,r,s,i){return Ab(d(n,e,t,r,s,i,!0))}function Ns(n,e,t,r,s){return Ab(Qe(n,e,t,r,s,!0))}function ku(n){return n?n.__v_isVNode===!0:!1}function Gl(n,e){return n.type===e.type&&n.key===e.key}const Sb=({key:n})=>n??null,dd=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?gn(n)||Gn(n)||Ze(n)?{i:$n,r:n,k:e,f:!!t}:n:null);function d(n,e=null,t=null,r=0,s=null,i=n===ot?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&Sb(e),ref:e&&dd(e),scopeId:eb,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:$n};return a?(gm(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=gn(t)?8:16),Cu>0&&!o&&xr&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&xr.push(l),l}const Qe=m1;function m1(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===LA)&&(n=Fs),ku(n)){const a=Ba(n,e,!0);return t&&gm(a,t),Cu>0&&!i&&xr&&(a.shapeFlag&6?xr[xr.indexOf(n)]=a:xr.push(a)),a.patchFlag=-2,a}if(A1(n)&&(n=n.__vccOpts),e){e=g1(e);let{class:a,style:l}=e;a&&!gn(a)&&(e.class=Xt(a)),$t(l)&&(um(l)&&!Ke(l)&&(l=Dn({},l)),e.style=br(l))}const o=gn(n)?1:Tb(n)?128:EA(n)?64:$t(n)?4:Ze(n)?2:0;return d(n,e,t,r,s,o,i,!0)}function g1(n){return n?um(n)||mb(n)?Dn({},n):n:null}function Ba(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,c=e?v1(s||{},e):s,h={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&Sb(c),ref:e&&e.ref?t&&i?Ke(i)?i.concat(dd(e)):[i,dd(e)]:dd(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==ot?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Ba(n.ssContent),ssFallback:n.ssFallback&&Ba(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&dm(h,l.clone(h)),h}function Ct(n=" ",e=0){return Qe(gh,null,n,e)}function Rn(n,e){const t=Qe(cd,null,n);return t.staticCount=e,t}function ce(n="",e=!1){return e?(D(),Ns(Fs,null,n)):Qe(Fs,null,n)}function es(n){return n==null||typeof n=="boolean"?Qe(Fs):Ke(n)?Qe(ot,null,n.slice()):ku(n)?yi(n):Qe(gh,null,String(n))}function yi(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:Ba(n)}function gm(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(Ke(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),gm(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!mb(e)?e._ctx=$n:s===3&&$n&&($n.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else Ze(e)?(e={default:e,_ctx:$n},t=32):(e=String(e),r&64?(t=16,e=[Ct(e)]):t=8);n.children=e,n.shapeFlag|=t}function v1(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=Xt([e.class,r.class]));else if(s==="style")e.style=br([e.style,r.style]);else if(ah(s)){const i=e[s],o=r[s];o&&i!==o&&!(Ke(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function Xr(n,e,t,r=null){ls(n,e,7,[t,r])}const y1=hb();let _1=0;function b1(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||y1,i={uid:_1++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new GT(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:vb(r,s),emitsOptions:Eb(r,s),emit:null,emitted:null,propsDefaults:Nt,inheritAttrs:r.inheritAttrs,ctx:Nt,data:Nt,props:Nt,attrs:Nt,slots:Nt,refs:Nt,setupState:Nt,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=l1.bind(null,i),n.ce&&n.ce(i),i}let Kn=null,Vd,cp;{const n=ch(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};Vd=e("__VUE_INSTANCE_SETTERS__",t=>Kn=t),cp=e("__VUE_SSR_SETTERS__",t=>Du=t)}const oc=n=>{const e=Kn;return Vd(n),n.scope.on(),()=>{n.scope.off(),Vd(e)}},Uv=()=>{Kn&&Kn.scope.off(),Vd(null)};function Pb(n){return n.vnode.shapeFlag&4}let Du=!1;function w1(n,e=!1,t=!1){e&&cp(e);const{props:r,children:s}=n.vnode,i=Pb(n);WA(n,r,i,e),XA(n,s,t||e);const o=i?x1(n,e):void 0;return e&&cp(!1),o}function x1(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,UA);const{setup:r}=t;if(r){Ls();const s=n.setupContext=r.length>1?E1(n):null,i=oc(n),o=ic(r,n,0,[n.props,s]),a=A_(o);if($s(),i(),(a||n.sp)&&!Oa(n)&&ib(n),a){if(o.then(Uv,Uv),e)return o.then(l=>{jv(n,l,e)}).catch(l=>{fh(l,n,0)});n.asyncDep=o}else jv(n,o,e)}else Rb(n,e)}function jv(n,e,t){Ze(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:$t(e)&&(n.setupState=Q_(e)),Rb(n,t)}let qv;function Rb(n,e,t){const r=n.type;if(!n.render){if(!e&&qv&&!r.render){const s=r.template||hm(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,c=Dn(Dn({isCustomElement:i,delimiters:a},o),l);r.render=qv(s,c)}}n.render=r.render||$r}{const s=oc(n);Ls();try{jA(n)}finally{$s(),s()}}}const I1={get(n,e){return zn(n,"get",""),n[e]}};function E1(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,I1),slots:n.slots,emit:n.emit,expose:e}}function vh(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(Q_(hA(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in mu)return mu[t](n)},has(e,t){return t in e||t in mu}})):n.proxy}function T1(n,e=!0){return Ze(n)?n.displayName||n.name:n.name||e&&n.__name}function A1(n){return Ze(n)&&"__vccOpts"in n}const Ue=(n,e)=>vA(n,e,Du);function Cb(n,e,t){const r=arguments.length;return r===2?$t(e)&&!Ke(e)?ku(e)?Qe(n,null,[e]):Qe(n,e):Qe(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&ku(t)&&(t=[t]),Qe(n,e,t))}const S1="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let dp;const Bv=typeof window<"u"&&window.trustedTypes;if(Bv)try{dp=Bv.createPolicy("vue",{createHTML:n=>n})}catch{}const kb=dp?n=>dp.createHTML(n):n=>n,P1="http://www.w3.org/2000/svg",R1="http://www.w3.org/1998/Math/MathML",Ts=typeof document<"u"?document:null,zv=Ts&&Ts.createElement("template"),C1={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?Ts.createElementNS(P1,n):e==="mathml"?Ts.createElementNS(R1,n):t?Ts.createElement(n,{is:t}):Ts.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>Ts.createTextNode(n),createComment:n=>Ts.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Ts.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{zv.innerHTML=kb(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=zv.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},k1=Symbol("_vtc");function D1(n,e,t){const r=n[k1];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const Od=Symbol("_vod"),Db=Symbol("_vsh"),Af={beforeMount(n,{value:e},{transition:t}){n[Od]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):Hl(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),Hl(n,!0),r.enter(n)):r.leave(n,()=>{Hl(n,!1)}):Hl(n,e))},beforeUnmount(n,{value:e}){Hl(n,e)}};function Hl(n,e){n.style.display=e?n[Od]:"none",n[Db]=!e}const N1=Symbol(""),V1=/(^|;)\s*display\s*:/;function O1(n,e,t){const r=n.style,s=gn(t);let i=!1;if(t&&!s){if(e)if(gn(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&hd(r,a,"")}else for(const o in e)t[o]==null&&hd(r,o,"");for(const o in t)o==="display"&&(i=!0),hd(r,o,t[o])}else if(s){if(e!==t){const o=r[N1];o&&(t+=";"+o),r.cssText=t,i=V1.test(t)}}else e&&n.removeAttribute("style");Od in n&&(n[Od]=i?r.display:"",n[Db]&&(r.display="none"))}const Kv=/\s*!important$/;function hd(n,e,t){if(Ke(t))t.forEach(r=>hd(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=M1(n,e);Kv.test(t)?n.setProperty(Gi(r),t.replace(Kv,""),"important"):n[r]=t}}const Gv=["Webkit","Moz","ms"],Sf={};function M1(n,e){const t=Sf[e];if(t)return t;let r=Cr(e);if(r!=="filter"&&r in n)return Sf[e]=r;r=uh(r);for(let s=0;s<Gv.length;s++){const i=Gv[s]+r;if(i in n)return Sf[e]=i}return e}const Hv="http://www.w3.org/1999/xlink";function Wv(n,e,t,r,s,i=zT(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(Hv,e.slice(6,e.length)):n.setAttributeNS(Hv,e,t):t==null||i&&!R_(t)?n.removeAttribute(e):n.setAttribute(e,i?"":jr(t)?String(t):t)}function Qv(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?kb(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=R_(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function bi(n,e,t,r){n.addEventListener(e,t,r)}function L1(n,e,t,r){n.removeEventListener(e,t,r)}const Jv=Symbol("_vei");function $1(n,e,t,r,s=null){const i=n[Jv]||(n[Jv]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=F1(e);if(r){const c=i[e]=q1(r,s);bi(n,a,c,l)}else o&&(L1(n,a,o,l),i[e]=void 0)}}const Yv=/(?:Once|Passive|Capture)$/;function F1(n){let e;if(Yv.test(n)){e={};let r;for(;r=n.match(Yv);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Gi(n.slice(2)),e]}let Pf=0;const U1=Promise.resolve(),j1=()=>Pf||(U1.then(()=>Pf=0),Pf=Date.now());function q1(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;ls(B1(r,t.value),e,5,[r])};return t.value=n,t.attached=j1(),t}function B1(n,e){if(Ke(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const Xv=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,z1=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?D1(n,r,o):e==="style"?O1(n,t,r):ah(e)?Zp(e)||$1(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):K1(n,e,r,o))?(Qv(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Wv(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!gn(r))?Qv(n,Cr(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),Wv(n,e,r,o))};function K1(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&Xv(e)&&Ze(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Xv(e)&&gn(t)?!1:e in n}const za=n=>{const e=n.props["onUpdate:modelValue"]||!1;return Ke(e)?t=>ad(e,t):e};function G1(n){n.target.composing=!0}function Zv(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Vs=Symbol("_assign"),Lt={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[Vs]=za(s);const i=r||s.props&&s.props.type==="number";bi(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=Pd(a)),n[Vs](a)}),t&&bi(n,"change",()=>{n.value=n.value.trim()}),e||(bi(n,"compositionstart",G1),bi(n,"compositionend",Zv),bi(n,"change",Zv))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[Vs]=za(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?Pd(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},Pi={deep:!0,created(n,e,t){n[Vs]=za(t),bi(n,"change",()=>{const r=n._modelValue,s=Nu(n),i=n.checked,o=n[Vs];if(Ke(r)){const a=nm(r,s),l=a!==-1;if(i&&!l)o(r.concat(s));else if(!i&&l){const c=[...r];c.splice(a,1),o(c)}}else if(cl(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o(Nb(n,i))})},mounted:ey,beforeUpdate(n,e,t){n[Vs]=za(t),ey(n,e,t)}};function ey(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(Ke(e))s=nm(e,r.props.value)>-1;else if(cl(e))s=e.has(r.props.value);else{if(e===t)return;s=sc(e,Nb(n,!0))}n.checked!==s&&(n.checked=s)}const H1={deep:!0,created(n,{value:e,modifiers:{number:t}},r){const s=cl(e);bi(n,"change",()=>{const i=Array.prototype.filter.call(n.options,o=>o.selected).map(o=>t?Pd(Nu(o)):Nu(o));n[Vs](n.multiple?s?new Set(i):i:i[0]),n._assigning=!0,Ht(()=>{n._assigning=!1})}),n[Vs]=za(r)},mounted(n,{value:e}){ty(n,e)},beforeUpdate(n,e,t){n[Vs]=za(t)},updated(n,{value:e}){n._assigning||ty(n,e)}};function ty(n,e){const t=n.multiple,r=Ke(e);if(!(t&&!r&&!cl(e))){for(let s=0,i=n.options.length;s<i;s++){const o=n.options[s],a=Nu(o);if(t)if(r){const l=typeof a;l==="string"||l==="number"?o.selected=e.some(c=>String(c)===String(a)):o.selected=nm(e,a)>-1}else o.selected=e.has(a);else if(sc(Nu(o),e)){n.selectedIndex!==s&&(n.selectedIndex=s);return}}!t&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function Nu(n){return"_value"in n?n._value:n.value}function Nb(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const W1=["ctrl","shift","alt","meta"],Q1={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>W1.some(t=>n[`${t}Key`]&&!e.includes(t))},dt=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=Q1[e[o]];if(a&&a(s,e))return}return n(s,...i)})},J1={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},qn=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=Gi(s.key);if(e.some(o=>o===i||J1[o]===i))return n(s)})},Y1=Dn({patchProp:z1},C1);let ny;function X1(){return ny||(ny=e1(Y1))}const Z1=(...n)=>{const e=X1().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=tS(r);if(!s)return;const i=e._component;!Ze(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,eS(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function eS(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function tS(n){return gn(n)?document.querySelector(n):n}const nS={key:2,class:"fixed bottom-4 right-4 z-50 rounded-full bg-green-600 text-white px-4 py-2 shadow-lg"},rS={__name:"App",setup(n){const e=P(null),t=P(!1),r=P(!1),s=P(!1);function i(c){c.preventDefault(),e.value=c,t.value=!0}async function o(){e.value&&(e.value.prompt(),await e.value.userChoice,t.value=!1,e.value=null)}function a(){t.value=!1,e.value=null}function l(){s.value=!0,"serviceWorker"in navigator&&navigator.serviceWorker.postMessage({type:"SKIP_WAITING"}),window.location.reload()}return fn(()=>{window.addEventListener("beforeinstallprompt",i),window.addEventListener("appinstalled",a),"serviceWorker"in navigator&&(navigator.serviceWorker.addEventListener("controllerchange",()=>{s.value||(r.value=!0)}),setInterval(()=>{navigator.serviceWorker.getRegistration().then(c=>{c&&c.update()})},60*60*1e3))}),lb(()=>{window.removeEventListener("beforeinstallprompt",i),window.removeEventListener("appinstalled",a)}),(c,h)=>{const f=MA("router-view");return D(),V(ot,null,[Qe(f),t.value?(D(),V("button",{key:0,class:"fixed bottom-4 right-4 z-50 rounded-full bg-sky-600 text-white px-4 py-2 shadow-lg hover:bg-sky-700 active:bg-sky-800",onClick:o}," Installer l’app ")):ce("",!0),r.value&&!s.value?(D(),V("button",{key:1,class:"fixed bottom-4 right-4 z-50 rounded-full bg-green-600 text-white px-4 py-2 shadow-lg hover:bg-green-700 active:bg-green-800",onClick:l}," 🔄 Mettre à jour ")):ce("",!0),s.value?(D(),V("div",nS," 🔄 Mise à jour... ")):ce("",!0)],64)}}};/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const Aa=typeof document<"u";function Vb(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function sS(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&Vb(n.default)}const Tt=Object.assign;function Rf(n,e){const t={};for(const r in e){const s=e[r];t[r]=qr(s)?s.map(n):n(s)}return t}const vu=()=>{},qr=Array.isArray,Ob=/#/g,iS=/&/g,oS=/\//g,aS=/=/g,lS=/\?/g,Mb=/\+/g,uS=/%5B/g,cS=/%5D/g,Lb=/%5E/g,dS=/%60/g,$b=/%7B/g,hS=/%7C/g,Fb=/%7D/g,fS=/%20/g;function vm(n){return encodeURI(""+n).replace(hS,"|").replace(uS,"[").replace(cS,"]")}function pS(n){return vm(n).replace($b,"{").replace(Fb,"}").replace(Lb,"^")}function hp(n){return vm(n).replace(Mb,"%2B").replace(fS,"+").replace(Ob,"%23").replace(iS,"%26").replace(dS,"`").replace($b,"{").replace(Fb,"}").replace(Lb,"^")}function mS(n){return hp(n).replace(aS,"%3D")}function gS(n){return vm(n).replace(Ob,"%23").replace(lS,"%3F")}function vS(n){return n==null?"":gS(n).replace(oS,"%2F")}function Vu(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const yS=/\/$/,_S=n=>n.replace(yS,"");function Cf(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=IS(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:Vu(o)}}function bS(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function ry(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function wS(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&Ka(e.matched[r],t.matched[s])&&Ub(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function Ka(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function Ub(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!xS(n[t],e[t]))return!1;return!0}function xS(n,e){return qr(n)?sy(n,e):qr(e)?sy(e,n):n===e}function sy(n,e){return qr(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function IS(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const fi={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Ou;(function(n){n.pop="pop",n.push="push"})(Ou||(Ou={}));var yu;(function(n){n.back="back",n.forward="forward",n.unknown=""})(yu||(yu={}));function ES(n){if(!n)if(Aa){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),_S(n)}const TS=/^[^#]+#/;function AS(n,e){return n.replace(TS,"#")+e}function SS(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const yh=()=>({left:window.scrollX,top:window.scrollY});function PS(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=SS(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function iy(n,e){return(history.state?history.state.position-e:-1)+n}const fp=new Map;function RS(n,e){fp.set(n,e)}function CS(n){const e=fp.get(n);return fp.delete(n),e}let kS=()=>location.protocol+"//"+location.host;function jb(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),ry(l,"")}return ry(t,n)+r+s}function DS(n,e,t,r){let s=[],i=[],o=null;const a=({state:g})=>{const y=jb(n,location),I=t.value,S=e.value;let E=0;if(g){if(t.value=y,e.value=g,o&&o===I){o=null;return}E=S?g.position-S.position:0}else r(y);s.forEach($=>{$(t.value,I,{delta:E,type:Ou.pop,direction:E?E>0?yu.forward:yu.back:yu.unknown})})};function l(){o=t.value}function c(g){s.push(g);const y=()=>{const I=s.indexOf(g);I>-1&&s.splice(I,1)};return i.push(y),y}function h(){const{history:g}=window;g.state&&g.replaceState(Tt({},g.state,{scroll:yh()}),"")}function f(){for(const g of i)g();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",h)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",h,{passive:!0}),{pauseListeners:l,listen:c,destroy:f}}function oy(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?yh():null}}function NS(n){const{history:e,location:t}=window,r={value:jb(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,c,h){const f=n.indexOf("#"),g=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:kS()+n+l;try{e[h?"replaceState":"pushState"](c,"",g),s.value=c}catch(y){console.error(y),t[h?"replace":"assign"](g)}}function o(l,c){const h=Tt({},e.state,oy(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});i(l,h,!0),r.value=l}function a(l,c){const h=Tt({},s.value,e.state,{forward:l,scroll:yh()});i(h.current,h,!0);const f=Tt({},oy(r.value,l,null),{position:h.position+1},c);i(l,f,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function VS(n){n=ES(n);const e=NS(n),t=DS(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=Tt({location:"",base:n,go:r,createHref:AS.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function OS(n){return typeof n=="string"||n&&typeof n=="object"}function qb(n){return typeof n=="string"||typeof n=="symbol"}const Bb=Symbol("");var ay;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(ay||(ay={}));function Ga(n,e){return Tt(new Error,{type:n,[Bb]:!0},e)}function Es(n,e){return n instanceof Error&&Bb in n&&(e==null||!!(n.type&e))}const ly="[^/]+?",MS={sensitive:!1,strict:!1,start:!0,end:!0},LS=/[.+*?^${}()[\]/\\]/g;function $S(n,e){const t=Tt({},MS,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const h=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let f=0;f<c.length;f++){const g=c[f];let y=40+(t.sensitive?.25:0);if(g.type===0)f||(s+="/"),s+=g.value.replace(LS,"\\$&"),y+=40;else if(g.type===1){const{value:I,repeatable:S,optional:E,regexp:$}=g;i.push({name:I,repeatable:S,optional:E});const F=$||ly;if(F!==ly){y+=10;try{new RegExp(`(${F})`)}catch(L){throw new Error(`Invalid custom RegExp for param "${I}" (${F}): `+L.message)}}let M=S?`((?:${F})(?:/(?:${F}))*)`:`(${F})`;f||(M=E&&c.length<2?`(?:/${M})`:"/"+M),E&&(M+="?"),s+=M,y+=20,E&&(y+=-8),S&&(y+=-20),F===".*"&&(y+=-50)}h.push(y)}r.push(h)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const h=c.match(o),f={};if(!h)return null;for(let g=1;g<h.length;g++){const y=h[g]||"",I=i[g-1];f[I.name]=y&&I.repeatable?y.split("/"):y}return f}function l(c){let h="",f=!1;for(const g of n){(!f||!h.endsWith("/"))&&(h+="/"),f=!1;for(const y of g)if(y.type===0)h+=y.value;else if(y.type===1){const{value:I,repeatable:S,optional:E}=y,$=I in c?c[I]:"";if(qr($)&&!S)throw new Error(`Provided param "${I}" is an array but it is not repeatable (* or + modifiers)`);const F=qr($)?$.join("/"):$;if(!F)if(E)g.length<2&&(h.endsWith("/")?h=h.slice(0,-1):f=!0);else throw new Error(`Missing required param "${I}"`);h+=F}}return h||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function FS(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function zb(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=FS(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(uy(r))return 1;if(uy(s))return-1}return s.length-r.length}function uy(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const US={type:0,value:""},jS=/[a-zA-Z0-9_]/;function qS(n){if(!n)return[[]];if(n==="/")return[[US]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(y){throw new Error(`ERR (${t})/"${c}": ${y}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,c="",h="";function f(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:h,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function g(){c+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(c&&f(),o()):l===":"?(f(),t=1):g();break;case 4:g(),t=r;break;case 1:l==="("?t=2:jS.test(l)?g():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?h[h.length-1]=="\\"?h=h.slice(0,-1)+l:t=3:h+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,h="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),f(),o(),s}function BS(n,e,t){const r=$S(qS(n.path),t),s=Tt(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function zS(n,e){const t=[],r=new Map;e=fy({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,g,y){const I=!y,S=dy(f);S.aliasOf=y&&y.record;const E=fy(e,f),$=[S];if("alias"in f){const L=typeof f.alias=="string"?[f.alias]:f.alias;for(const re of L)$.push(dy(Tt({},S,{components:y?y.record.components:S.components,path:re,aliasOf:y?y.record:S})))}let F,M;for(const L of $){const{path:re}=L;if(g&&re[0]!=="/"){const W=g.record.path,x=W[W.length-1]==="/"?"":"/";L.path=g.record.path+(re&&x+re)}if(F=BS(L,g,E),y?y.alias.push(F):(M=M||F,M!==F&&M.alias.push(F),I&&f.name&&!hy(F)&&o(f.name)),Kb(F)&&l(F),S.children){const W=S.children;for(let x=0;x<W.length;x++)i(W[x],F,y&&y.children[x])}y=y||F}return M?()=>{o(M)}:vu}function o(f){if(qb(f)){const g=r.get(f);g&&(r.delete(f),t.splice(t.indexOf(g),1),g.children.forEach(o),g.alias.forEach(o))}else{const g=t.indexOf(f);g>-1&&(t.splice(g,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function l(f){const g=HS(f,t);t.splice(g,0,f),f.record.name&&!hy(f)&&r.set(f.record.name,f)}function c(f,g){let y,I={},S,E;if("name"in f&&f.name){if(y=r.get(f.name),!y)throw Ga(1,{location:f});E=y.record.name,I=Tt(cy(g.params,y.keys.filter(M=>!M.optional).concat(y.parent?y.parent.keys.filter(M=>M.optional):[]).map(M=>M.name)),f.params&&cy(f.params,y.keys.map(M=>M.name))),S=y.stringify(I)}else if(f.path!=null)S=f.path,y=t.find(M=>M.re.test(S)),y&&(I=y.parse(S),E=y.record.name);else{if(y=g.name?r.get(g.name):t.find(M=>M.re.test(g.path)),!y)throw Ga(1,{location:f,currentLocation:g});E=y.record.name,I=Tt({},g.params,f.params),S=y.stringify(I)}const $=[];let F=y;for(;F;)$.unshift(F.record),F=F.parent;return{name:E,path:S,params:I,matched:$,meta:GS($)}}n.forEach(f=>i(f));function h(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:o,clearRoutes:h,getRoutes:a,getRecordMatcher:s}}function cy(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function dy(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:KS(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function KS(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function hy(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function GS(n){return n.reduce((e,t)=>Tt(e,t.meta),{})}function fy(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function HS(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;zb(n,e[i])<0?r=i:t=i+1}const s=WS(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function WS(n){let e=n;for(;e=e.parent;)if(Kb(e)&&zb(n,e)===0)return e}function Kb({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function QS(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(Mb," "),o=i.indexOf("="),a=Vu(o<0?i:i.slice(0,o)),l=o<0?null:Vu(i.slice(o+1));if(a in e){let c=e[a];qr(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function py(n){let e="";for(let t in n){const r=n[t];if(t=mS(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(qr(r)?r.map(i=>i&&hp(i)):[r&&hp(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function JS(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=qr(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const YS=Symbol(""),my=Symbol(""),_h=Symbol(""),ym=Symbol(""),pp=Symbol("");function Wl(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function _i(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const c=g=>{g===!1?l(Ga(4,{from:t,to:e})):g instanceof Error?l(g):OS(g)?l(Ga(2,{from:e,to:g})):(o&&r.enterCallbacks[s]===o&&typeof g=="function"&&o.push(g),a())},h=i(()=>n.call(r&&r.instances[s],e,t,c));let f=Promise.resolve(h);n.length<3&&(f=f.then(c)),f.catch(g=>l(g))})}function kf(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(Vb(l)){const h=(l.__vccOpts||l)[e];h&&i.push(_i(h,t,r,o,a,s))}else{let c=l();i.push(()=>c.then(h=>{if(!h)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=sS(h)?h.default:h;o.mods[a]=h,o.components[a]=f;const y=(f.__vccOpts||f)[e];return y&&_i(y,t,r,o,a,s)()}))}}return i}function gy(n){const e=Ur(_h),t=Ur(ym),r=Ue(()=>{const l=ss(n.to);return e.resolve(l)}),s=Ue(()=>{const{matched:l}=r.value,{length:c}=l,h=l[c-1],f=t.matched;if(!h||!f.length)return-1;const g=f.findIndex(Ka.bind(null,h));if(g>-1)return g;const y=vy(l[c-2]);return c>1&&vy(h)===y&&f[f.length-1].path!==y?f.findIndex(Ka.bind(null,l[c-2])):g}),i=Ue(()=>s.value>-1&&nP(t.params,r.value.params)),o=Ue(()=>s.value>-1&&s.value===t.matched.length-1&&Ub(t.params,r.value.params));function a(l={}){if(tP(l)){const c=e[ss(n.replace)?"replace":"push"](ss(n.to)).catch(vu);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:Ue(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function XS(n){return n.length===1?n[0]:n}const ZS=sb({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:gy,setup(n,{slots:e}){const t=hh(gy(n)),{options:r}=Ur(_h),s=Ue(()=>({[yy(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[yy(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&XS(e.default(t));return n.custom?i:Cb("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),eP=ZS;function tP(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function nP(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!qr(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function vy(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const yy=(n,e,t)=>n??e??t,rP=sb({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=Ur(pp),s=Ue(()=>n.route||r.value),i=Ur(my,0),o=Ue(()=>{let c=ss(i);const{matched:h}=s.value;let f;for(;(f=h[c])&&!f.components;)c++;return c}),a=Ue(()=>s.value.matched[o.value]);ud(my,Ue(()=>o.value+1)),ud(YS,a),ud(pp,s);const l=P();return wt(()=>[l.value,a.value,n.name],([c,h,f],[g,y,I])=>{h&&(h.instances[f]=c,y&&y!==h&&c&&c===g&&(h.leaveGuards.size||(h.leaveGuards=y.leaveGuards),h.updateGuards.size||(h.updateGuards=y.updateGuards))),c&&h&&(!y||!Ka(h,y)||!g)&&(h.enterCallbacks[f]||[]).forEach(S=>S(c))},{flush:"post"}),()=>{const c=s.value,h=n.name,f=a.value,g=f&&f.components[h];if(!g)return _y(t.default,{Component:g,route:c});const y=f.props[h],I=y?y===!0?c.params:typeof y=="function"?y(c):y:null,E=Cb(g,Tt({},I,e,{onVnodeUnmounted:$=>{$.component.isUnmounted&&(f.instances[h]=null)},ref:l}));return _y(t.default,{Component:E,route:c})||E}}});function _y(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const sP=rP;function iP(n){const e=zS(n.routes,n),t=n.parseQuery||QS,r=n.stringifyQuery||py,s=n.history,i=Wl(),o=Wl(),a=Wl(),l=fA(fi);let c=fi;Aa&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const h=Rf.bind(null,X=>""+X),f=Rf.bind(null,vS),g=Rf.bind(null,Vu);function y(X,Ae){let xe,Ne;return qb(X)?(xe=e.getRecordMatcher(X),Ne=Ae):Ne=X,e.addRoute(Ne,xe)}function I(X){const Ae=e.getRecordMatcher(X);Ae&&e.removeRoute(Ae)}function S(){return e.getRoutes().map(X=>X.record)}function E(X){return!!e.getRecordMatcher(X)}function $(X,Ae){if(Ae=Tt({},Ae||l.value),typeof X=="string"){const k=Cf(t,X,Ae.path),K=e.resolve({path:k.path},Ae),G=s.createHref(k.fullPath);return Tt(k,K,{params:g(K.params),hash:Vu(k.hash),redirectedFrom:void 0,href:G})}let xe;if(X.path!=null)xe=Tt({},X,{path:Cf(t,X.path,Ae.path).path});else{const k=Tt({},X.params);for(const K in k)k[K]==null&&delete k[K];xe=Tt({},X,{params:f(k)}),Ae.params=f(Ae.params)}const Ne=e.resolve(xe,Ae),tt=X.hash||"";Ne.params=h(g(Ne.params));const ct=bS(r,Tt({},X,{hash:pS(tt),path:Ne.path})),T=s.createHref(ct);return Tt({fullPath:ct,hash:tt,query:r===py?JS(X.query):X.query||{}},Ne,{redirectedFrom:void 0,href:T})}function F(X){return typeof X=="string"?Cf(t,X,l.value.path):Tt({},X)}function M(X,Ae){if(c!==X)return Ga(8,{from:Ae,to:X})}function L(X){return x(X)}function re(X){return L(Tt(F(X),{replace:!0}))}function W(X){const Ae=X.matched[X.matched.length-1];if(Ae&&Ae.redirect){const{redirect:xe}=Ae;let Ne=typeof xe=="function"?xe(X):xe;return typeof Ne=="string"&&(Ne=Ne.includes("?")||Ne.includes("#")?Ne=F(Ne):{path:Ne},Ne.params={}),Tt({query:X.query,hash:X.hash,params:Ne.path!=null?{}:X.params},Ne)}}function x(X,Ae){const xe=c=$(X),Ne=l.value,tt=X.state,ct=X.force,T=X.replace===!0,k=W(xe);if(k)return x(Tt(F(k),{state:typeof k=="object"?Tt({},tt,k.state):tt,force:ct,replace:T}),Ae||xe);const K=xe;K.redirectedFrom=Ae;let G;return!ct&&wS(r,Ne,xe)&&(G=Ga(16,{to:K,from:Ne}),ee(Ne,Ne,!0,!1)),(G?Promise.resolve(G):C(K,Ne)).catch(te=>Es(te)?Es(te,2)?te:De(te):ue(te,K,Ne)).then(te=>{if(te){if(Es(te,2))return x(Tt({replace:T},F(te.to),{state:typeof te.to=="object"?Tt({},tt,te.to.state):tt,force:ct}),Ae||K)}else te=U(K,Ne,!0,T,tt);return O(K,Ne,te),te})}function b(X,Ae){const xe=M(X,Ae);return xe?Promise.reject(xe):Promise.resolve()}function A(X){const Ae=He.values().next().value;return Ae&&typeof Ae.runWithContext=="function"?Ae.runWithContext(X):X()}function C(X,Ae){let xe;const[Ne,tt,ct]=oP(X,Ae);xe=kf(Ne.reverse(),"beforeRouteLeave",X,Ae);for(const k of Ne)k.leaveGuards.forEach(K=>{xe.push(_i(K,X,Ae))});const T=b.bind(null,X,Ae);return xe.push(T),Ot(xe).then(()=>{xe=[];for(const k of i.list())xe.push(_i(k,X,Ae));return xe.push(T),Ot(xe)}).then(()=>{xe=kf(tt,"beforeRouteUpdate",X,Ae);for(const k of tt)k.updateGuards.forEach(K=>{xe.push(_i(K,X,Ae))});return xe.push(T),Ot(xe)}).then(()=>{xe=[];for(const k of ct)if(k.beforeEnter)if(qr(k.beforeEnter))for(const K of k.beforeEnter)xe.push(_i(K,X,Ae));else xe.push(_i(k.beforeEnter,X,Ae));return xe.push(T),Ot(xe)}).then(()=>(X.matched.forEach(k=>k.enterCallbacks={}),xe=kf(ct,"beforeRouteEnter",X,Ae,A),xe.push(T),Ot(xe))).then(()=>{xe=[];for(const k of o.list())xe.push(_i(k,X,Ae));return xe.push(T),Ot(xe)}).catch(k=>Es(k,8)?k:Promise.reject(k))}function O(X,Ae,xe){a.list().forEach(Ne=>A(()=>Ne(X,Ae,xe)))}function U(X,Ae,xe,Ne,tt){const ct=M(X,Ae);if(ct)return ct;const T=Ae===fi,k=Aa?history.state:{};xe&&(Ne||T?s.replace(X.fullPath,Tt({scroll:T&&k&&k.scroll},tt)):s.push(X.fullPath,tt)),l.value=X,ee(X,Ae,xe,T),De()}let R;function mt(){R||(R=s.listen((X,Ae,xe)=>{if(!lt.listening)return;const Ne=$(X),tt=W(Ne);if(tt){x(Tt(tt,{replace:!0,force:!0}),Ne).catch(vu);return}c=Ne;const ct=l.value;Aa&&RS(iy(ct.fullPath,xe.delta),yh()),C(Ne,ct).catch(T=>Es(T,12)?T:Es(T,2)?(x(Tt(F(T.to),{force:!0}),Ne).then(k=>{Es(k,20)&&!xe.delta&&xe.type===Ou.pop&&s.go(-1,!1)}).catch(vu),Promise.reject()):(xe.delta&&s.go(-xe.delta,!1),ue(T,Ne,ct))).then(T=>{T=T||U(Ne,ct,!1),T&&(xe.delta&&!Es(T,8)?s.go(-xe.delta,!1):xe.type===Ou.pop&&Es(T,20)&&s.go(-1,!1)),O(Ne,ct,T)}).catch(vu)}))}let gt=Wl(),be=Wl(),ne;function ue(X,Ae,xe){De(X);const Ne=be.list();return Ne.length?Ne.forEach(tt=>tt(X,Ae,xe)):console.error(X),Promise.reject(X)}function ie(){return ne&&l.value!==fi?Promise.resolve():new Promise((X,Ae)=>{gt.add([X,Ae])})}function De(X){return ne||(ne=!X,mt(),gt.list().forEach(([Ae,xe])=>X?xe(X):Ae()),gt.reset()),X}function ee(X,Ae,xe,Ne){const{scrollBehavior:tt}=n;if(!Aa||!tt)return Promise.resolve();const ct=!xe&&CS(iy(X.fullPath,0))||(Ne||!xe)&&history.state&&history.state.scroll||null;return Ht().then(()=>tt(X,Ae,ct)).then(T=>T&&PS(T)).catch(T=>ue(T,X,Ae))}const J=X=>s.go(X);let Te;const He=new Set,lt={currentRoute:l,listening:!0,addRoute:y,removeRoute:I,clearRoutes:e.clearRoutes,hasRoute:E,getRoutes:S,resolve:$,options:n,push:L,replace:re,go:J,back:()=>J(-1),forward:()=>J(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:be.add,isReady:ie,install(X){const Ae=this;X.component("RouterLink",eP),X.component("RouterView",sP),X.config.globalProperties.$router=Ae,Object.defineProperty(X.config.globalProperties,"$route",{enumerable:!0,get:()=>ss(l)}),Aa&&!Te&&l.value===fi&&(Te=!0,L(s.location).catch(tt=>{}));const xe={};for(const tt in fi)Object.defineProperty(xe,tt,{get:()=>l.value[tt],enumerable:!0});X.provide(_h,Ae),X.provide(ym,G_(xe)),X.provide(pp,l);const Ne=X.unmount;He.add(X),X.unmount=function(){He.delete(X),He.size<1&&(c=fi,R&&R(),R=null,l.value=fi,Te=!1,ne=!1),Ne()}}};function Ot(X){return X.reduce((Ae,xe)=>Ae.then(()=>A(xe)),Promise.resolve())}return lt}function oP(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(c=>Ka(c,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>Ka(c,l))||s.push(l))}return[t,r,s]}function dl(){return Ur(_h)}function Qo(n){return Ur(ym)}const aP="modulepreload",lP=function(n){return"/"+n},by={},Zt=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=lP(i),i in by)return;by[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const f=s[h];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":aP,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((h,f)=>{c.addEventListener("load",h),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};function uP(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:r,onRegistered:s,onRegisteredSW:i,onRegisterError:o}=n;let a,l;const c=async(f=!0)=>{await l};async function h(){if("serviceWorker"in navigator){const{Workbox:f}=await Zt(()=>import("./workbox-window.prod.es5-5ffdab76.js"),[]);a=new f("/service-worker.js",{scope:"/",type:"classic"}),a.addEventListener("activated",g=>{(g.isUpdate||g.isExternal)&&window.location.reload()}),a.addEventListener("installed",g=>{g.isUpdate||r==null||r()}),a.register({immediate:e}).then(g=>{i?i("/service-worker.js",g):s==null||s(g)}).catch(g=>{o==null||o(g)})}}return l=h(),c}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gb=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},cP=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},Hb={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let g=(a&15)<<2|c>>6,y=c&63;l||(y=64,o||(g=64)),r.push(t[h],t[f],t[g],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Gb(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):cP(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||f==null)throw new dP;const g=i<<2|a>>4;if(r.push(g),c!==64){const y=a<<4&240|c>>2;if(r.push(y),f!==64){const I=c<<6&192|f;r.push(I)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class dP extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const hP=function(n){const e=Gb(n);return Hb.encodeByteArray(e,!0)},Md=function(n){return hP(n).replace(/\./g,"")},Wb=function(n){try{return Hb.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fP(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pP=()=>fP().__FIREBASE_DEFAULTS__,mP=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},gP=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Wb(n[1]);return e&&JSON.parse(e)},bh=()=>{try{return pP()||mP()||gP()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Qb=n=>{var e,t;return(t=(e=bh())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},vP=n=>{const e=Qb(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Jb=()=>{var n;return(n=bh())===null||n===void 0?void 0:n.config},Yb=n=>{var e;return(e=bh())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yP{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _P(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[Md(JSON.stringify(t)),Md(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function bP(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(xn())}function wP(){var n;const e=(n=bh())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function xP(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function IP(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function EP(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function TP(){const n=xn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Xb(){return!wP()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function _m(){try{return typeof indexedDB=="object"}catch{return!1}}function Zb(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}function AP(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SP="FirebaseError";class ds extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=SP,Object.setPrototypeOf(this,ds.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Jo.prototype.create)}}class Jo{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?PP(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new ds(s,a,r)}}function PP(n,e){return n.replace(RP,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const RP=/\{\$([^}]+)}/g;function CP(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Li(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(wy(i)&&wy(o)){if(!Li(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function wy(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hl(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function ru(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function su(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function kP(n,e){const t=new DP(n,e);return t.subscribe.bind(t)}class DP{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");NP(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Df),s.error===void 0&&(s.error=Df),s.complete===void 0&&(s.complete=Df);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function NP(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Df(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function je(n){return n&&n._delegate?n._delegate:n}class Br{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wo="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VP{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new yP;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(MP(e))try{this.getOrInitializeService({instanceIdentifier:wo})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=wo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=wo){return this.instances.has(e)}getOptions(e=wo){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:OP(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=wo){return this.component?this.component.multipleInstances?e:wo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function OP(n){return n===wo?void 0:n}function MP(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LP{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new VP(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ht;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(ht||(ht={}));const $P={debug:ht.DEBUG,verbose:ht.VERBOSE,info:ht.INFO,warn:ht.WARN,error:ht.ERROR,silent:ht.SILENT},FP=ht.INFO,UP={[ht.DEBUG]:"log",[ht.VERBOSE]:"log",[ht.INFO]:"info",[ht.WARN]:"warn",[ht.ERROR]:"error"},jP=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=UP[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class bm{constructor(e){this.name=e,this._logLevel=FP,this._logHandler=jP,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ht))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?$P[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ht.DEBUG,...e),this._logHandler(this,ht.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ht.VERBOSE,...e),this._logHandler(this,ht.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ht.INFO,...e),this._logHandler(this,ht.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ht.WARN,...e),this._logHandler(this,ht.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ht.ERROR,...e),this._logHandler(this,ht.ERROR,...e)}}const qP=(n,e)=>e.some(t=>n instanceof t);let xy,Iy;function BP(){return xy||(xy=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function zP(){return Iy||(Iy=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ew=new WeakMap,mp=new WeakMap,tw=new WeakMap,Nf=new WeakMap,wm=new WeakMap;function KP(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Os(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&ew.set(t,n)}).catch(()=>{}),wm.set(e,n),e}function GP(n){if(mp.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});mp.set(n,e)}let gp={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return mp.get(n);if(e==="objectStoreNames")return n.objectStoreNames||tw.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Os(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function HP(n){gp=n(gp)}function WP(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Vf(this),e,...t);return tw.set(r,e.sort?e.sort():[e]),Os(r)}:zP().includes(n)?function(...e){return n.apply(Vf(this),e),Os(ew.get(this))}:function(...e){return Os(n.apply(Vf(this),e))}}function QP(n){return typeof n=="function"?WP(n):(n instanceof IDBTransaction&&GP(n),qP(n,BP())?new Proxy(n,gp):n)}function Os(n){if(n instanceof IDBRequest)return KP(n);if(Nf.has(n))return Nf.get(n);const e=QP(n);return e!==n&&(Nf.set(n,e),wm.set(e,n)),e}const Vf=n=>wm.get(n);function wh(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=Os(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Os(o.result),l.oldVersion,l.newVersion,Os(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function Of(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),Os(t).then(()=>{})}const JP=["get","getKey","getAll","getAllKeys","count"],YP=["put","add","delete","clear"],Mf=new Map;function Ey(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Mf.get(e))return Mf.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=YP.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||JP.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return Mf.set(e,i),i}HP(n=>({...n,get:(e,t,r)=>Ey(e,t)||n.get(e,t,r),has:(e,t)=>!!Ey(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XP{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(ZP(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function ZP(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const vp="@firebase/app",Ty="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Us=new bm("@firebase/app"),eR="@firebase/app-compat",tR="@firebase/analytics-compat",nR="@firebase/analytics",rR="@firebase/app-check-compat",sR="@firebase/app-check",iR="@firebase/auth",oR="@firebase/auth-compat",aR="@firebase/database",lR="@firebase/data-connect",uR="@firebase/database-compat",cR="@firebase/functions",dR="@firebase/functions-compat",hR="@firebase/installations",fR="@firebase/installations-compat",pR="@firebase/messaging",mR="@firebase/messaging-compat",gR="@firebase/performance",vR="@firebase/performance-compat",yR="@firebase/remote-config",_R="@firebase/remote-config-compat",bR="@firebase/storage",wR="@firebase/storage-compat",xR="@firebase/firestore",IR="@firebase/vertexai-preview",ER="@firebase/firestore-compat",TR="firebase",AR="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ld="[DEFAULT]",SR={[vp]:"fire-core",[eR]:"fire-core-compat",[nR]:"fire-analytics",[tR]:"fire-analytics-compat",[sR]:"fire-app-check",[rR]:"fire-app-check-compat",[iR]:"fire-auth",[oR]:"fire-auth-compat",[aR]:"fire-rtdb",[lR]:"fire-data-connect",[uR]:"fire-rtdb-compat",[cR]:"fire-fn",[dR]:"fire-fn-compat",[hR]:"fire-iid",[fR]:"fire-iid-compat",[pR]:"fire-fcm",[mR]:"fire-fcm-compat",[gR]:"fire-perf",[vR]:"fire-perf-compat",[yR]:"fire-rc",[_R]:"fire-rc-compat",[bR]:"fire-gcs",[wR]:"fire-gcs-compat",[xR]:"fire-fst",[ER]:"fire-fst-compat",[IR]:"fire-vertex","fire-js":"fire-js",[TR]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $d=new Map,PR=new Map,yp=new Map;function Ay(n,e){try{n.container.addComponent(e)}catch(t){Us.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function us(n){const e=n.name;if(yp.has(e))return Us.debug(`There were multiple attempts to register component ${e}.`),!1;yp.set(e,n);for(const t of $d.values())Ay(t,n);for(const t of PR.values())Ay(t,n);return!0}function Hi(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function RR(n,e,t=Ld){Hi(n,e).clearInstance(t)}function hn(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CR={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Di=new Jo("app","Firebase",CR);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kR{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Br("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Di.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fl=AR;function nw(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Ld,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Di.create("bad-app-name",{appName:String(s)});if(t||(t=Jb()),!t)throw Di.create("no-options");const i=$d.get(s);if(i){if(Li(t,i.options)&&Li(r,i.config))return i;throw Di.create("duplicate-app",{appName:s})}const o=new LP(s);for(const l of yp.values())o.addComponent(l);const a=new kR(t,r,o);return $d.set(s,a),a}function xm(n=Ld){const e=$d.get(n);if(!e&&n===Ld&&Jb())return nw();if(!e)throw Di.create("no-app",{appName:n});return e}function Rr(n,e,t){var r;let s=(r=SR[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Us.warn(a.join(" "));return}us(new Br(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DR="firebase-heartbeat-database",NR=1,Mu="firebase-heartbeat-store";let Lf=null;function rw(){return Lf||(Lf=wh(DR,NR,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Mu)}catch(t){console.warn(t)}}}}).catch(n=>{throw Di.create("idb-open",{originalErrorMessage:n.message})})),Lf}async function VR(n){try{const t=(await rw()).transaction(Mu),r=await t.objectStore(Mu).get(sw(n));return await t.done,r}catch(e){if(e instanceof ds)Us.warn(e.message);else{const t=Di.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Us.warn(t.message)}}}async function Sy(n,e){try{const r=(await rw()).transaction(Mu,"readwrite");await r.objectStore(Mu).put(e,sw(n)),await r.done}catch(t){if(t instanceof ds)Us.warn(t.message);else{const r=Di.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Us.warn(r.message)}}}function sw(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OR=1024,MR=30*24*60*60*1e3;class LR{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new FR(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Py();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=MR}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Us.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Py(),{heartbeatsToSend:r,unsentEntries:s}=$R(this._heartbeatsCache.heartbeats),i=Md(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Us.warn(t),""}}}function Py(){return new Date().toISOString().substring(0,10)}function $R(n,e=OR){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),Ry(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Ry(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class FR{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return _m()?Zb().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await VR(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Sy(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Sy(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Ry(n){return Md(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UR(n){us(new Br("platform-logger",e=>new XP(e),"PRIVATE")),us(new Br("heartbeat",e=>new LR(e),"PRIVATE")),Rr(vp,Ty,n),Rr(vp,Ty,"esm2017"),Rr("fire-js","")}UR("");var jR="firebase",qR="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Rr(jR,qR,"app");var Cy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var No,iw;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(x,b){function A(){}A.prototype=b.prototype,x.D=b.prototype,x.prototype=new A,x.prototype.constructor=x,x.C=function(C,O,U){for(var R=Array(arguments.length-2),mt=2;mt<arguments.length;mt++)R[mt-2]=arguments[mt];return b.prototype[O].apply(C,R)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(x,b,A){A||(A=0);var C=Array(16);if(typeof b=="string")for(var O=0;16>O;++O)C[O]=b.charCodeAt(A++)|b.charCodeAt(A++)<<8|b.charCodeAt(A++)<<16|b.charCodeAt(A++)<<24;else for(O=0;16>O;++O)C[O]=b[A++]|b[A++]<<8|b[A++]<<16|b[A++]<<24;b=x.g[0],A=x.g[1],O=x.g[2];var U=x.g[3],R=b+(U^A&(O^U))+C[0]+3614090360&4294967295;b=A+(R<<7&4294967295|R>>>25),R=U+(O^b&(A^O))+C[1]+3905402710&4294967295,U=b+(R<<12&4294967295|R>>>20),R=O+(A^U&(b^A))+C[2]+606105819&4294967295,O=U+(R<<17&4294967295|R>>>15),R=A+(b^O&(U^b))+C[3]+3250441966&4294967295,A=O+(R<<22&4294967295|R>>>10),R=b+(U^A&(O^U))+C[4]+4118548399&4294967295,b=A+(R<<7&4294967295|R>>>25),R=U+(O^b&(A^O))+C[5]+1200080426&4294967295,U=b+(R<<12&4294967295|R>>>20),R=O+(A^U&(b^A))+C[6]+2821735955&4294967295,O=U+(R<<17&4294967295|R>>>15),R=A+(b^O&(U^b))+C[7]+4249261313&4294967295,A=O+(R<<22&4294967295|R>>>10),R=b+(U^A&(O^U))+C[8]+1770035416&4294967295,b=A+(R<<7&4294967295|R>>>25),R=U+(O^b&(A^O))+C[9]+2336552879&4294967295,U=b+(R<<12&4294967295|R>>>20),R=O+(A^U&(b^A))+C[10]+4294925233&4294967295,O=U+(R<<17&4294967295|R>>>15),R=A+(b^O&(U^b))+C[11]+2304563134&4294967295,A=O+(R<<22&4294967295|R>>>10),R=b+(U^A&(O^U))+C[12]+1804603682&4294967295,b=A+(R<<7&4294967295|R>>>25),R=U+(O^b&(A^O))+C[13]+4254626195&4294967295,U=b+(R<<12&4294967295|R>>>20),R=O+(A^U&(b^A))+C[14]+2792965006&4294967295,O=U+(R<<17&4294967295|R>>>15),R=A+(b^O&(U^b))+C[15]+1236535329&4294967295,A=O+(R<<22&4294967295|R>>>10),R=b+(O^U&(A^O))+C[1]+4129170786&4294967295,b=A+(R<<5&4294967295|R>>>27),R=U+(A^O&(b^A))+C[6]+3225465664&4294967295,U=b+(R<<9&4294967295|R>>>23),R=O+(b^A&(U^b))+C[11]+643717713&4294967295,O=U+(R<<14&4294967295|R>>>18),R=A+(U^b&(O^U))+C[0]+3921069994&4294967295,A=O+(R<<20&4294967295|R>>>12),R=b+(O^U&(A^O))+C[5]+3593408605&4294967295,b=A+(R<<5&4294967295|R>>>27),R=U+(A^O&(b^A))+C[10]+38016083&4294967295,U=b+(R<<9&4294967295|R>>>23),R=O+(b^A&(U^b))+C[15]+3634488961&4294967295,O=U+(R<<14&4294967295|R>>>18),R=A+(U^b&(O^U))+C[4]+3889429448&4294967295,A=O+(R<<20&4294967295|R>>>12),R=b+(O^U&(A^O))+C[9]+568446438&4294967295,b=A+(R<<5&4294967295|R>>>27),R=U+(A^O&(b^A))+C[14]+3275163606&4294967295,U=b+(R<<9&4294967295|R>>>23),R=O+(b^A&(U^b))+C[3]+4107603335&4294967295,O=U+(R<<14&4294967295|R>>>18),R=A+(U^b&(O^U))+C[8]+1163531501&4294967295,A=O+(R<<20&4294967295|R>>>12),R=b+(O^U&(A^O))+C[13]+2850285829&4294967295,b=A+(R<<5&4294967295|R>>>27),R=U+(A^O&(b^A))+C[2]+4243563512&4294967295,U=b+(R<<9&4294967295|R>>>23),R=O+(b^A&(U^b))+C[7]+1735328473&4294967295,O=U+(R<<14&4294967295|R>>>18),R=A+(U^b&(O^U))+C[12]+2368359562&4294967295,A=O+(R<<20&4294967295|R>>>12),R=b+(A^O^U)+C[5]+4294588738&4294967295,b=A+(R<<4&4294967295|R>>>28),R=U+(b^A^O)+C[8]+2272392833&4294967295,U=b+(R<<11&4294967295|R>>>21),R=O+(U^b^A)+C[11]+1839030562&4294967295,O=U+(R<<16&4294967295|R>>>16),R=A+(O^U^b)+C[14]+4259657740&4294967295,A=O+(R<<23&4294967295|R>>>9),R=b+(A^O^U)+C[1]+2763975236&4294967295,b=A+(R<<4&4294967295|R>>>28),R=U+(b^A^O)+C[4]+1272893353&4294967295,U=b+(R<<11&4294967295|R>>>21),R=O+(U^b^A)+C[7]+4139469664&4294967295,O=U+(R<<16&4294967295|R>>>16),R=A+(O^U^b)+C[10]+3200236656&4294967295,A=O+(R<<23&4294967295|R>>>9),R=b+(A^O^U)+C[13]+681279174&4294967295,b=A+(R<<4&4294967295|R>>>28),R=U+(b^A^O)+C[0]+3936430074&4294967295,U=b+(R<<11&4294967295|R>>>21),R=O+(U^b^A)+C[3]+3572445317&4294967295,O=U+(R<<16&4294967295|R>>>16),R=A+(O^U^b)+C[6]+76029189&4294967295,A=O+(R<<23&4294967295|R>>>9),R=b+(A^O^U)+C[9]+3654602809&4294967295,b=A+(R<<4&4294967295|R>>>28),R=U+(b^A^O)+C[12]+3873151461&4294967295,U=b+(R<<11&4294967295|R>>>21),R=O+(U^b^A)+C[15]+530742520&4294967295,O=U+(R<<16&4294967295|R>>>16),R=A+(O^U^b)+C[2]+3299628645&4294967295,A=O+(R<<23&4294967295|R>>>9),R=b+(O^(A|~U))+C[0]+4096336452&4294967295,b=A+(R<<6&4294967295|R>>>26),R=U+(A^(b|~O))+C[7]+1126891415&4294967295,U=b+(R<<10&4294967295|R>>>22),R=O+(b^(U|~A))+C[14]+2878612391&4294967295,O=U+(R<<15&4294967295|R>>>17),R=A+(U^(O|~b))+C[5]+4237533241&4294967295,A=O+(R<<21&4294967295|R>>>11),R=b+(O^(A|~U))+C[12]+1700485571&4294967295,b=A+(R<<6&4294967295|R>>>26),R=U+(A^(b|~O))+C[3]+2399980690&4294967295,U=b+(R<<10&4294967295|R>>>22),R=O+(b^(U|~A))+C[10]+4293915773&4294967295,O=U+(R<<15&4294967295|R>>>17),R=A+(U^(O|~b))+C[1]+2240044497&4294967295,A=O+(R<<21&4294967295|R>>>11),R=b+(O^(A|~U))+C[8]+1873313359&4294967295,b=A+(R<<6&4294967295|R>>>26),R=U+(A^(b|~O))+C[15]+4264355552&4294967295,U=b+(R<<10&4294967295|R>>>22),R=O+(b^(U|~A))+C[6]+2734768916&4294967295,O=U+(R<<15&4294967295|R>>>17),R=A+(U^(O|~b))+C[13]+1309151649&4294967295,A=O+(R<<21&4294967295|R>>>11),R=b+(O^(A|~U))+C[4]+4149444226&4294967295,b=A+(R<<6&4294967295|R>>>26),R=U+(A^(b|~O))+C[11]+3174756917&4294967295,U=b+(R<<10&4294967295|R>>>22),R=O+(b^(U|~A))+C[2]+718787259&4294967295,O=U+(R<<15&4294967295|R>>>17),R=A+(U^(O|~b))+C[9]+3951481745&4294967295,x.g[0]=x.g[0]+b&4294967295,x.g[1]=x.g[1]+(O+(R<<21&4294967295|R>>>11))&4294967295,x.g[2]=x.g[2]+O&4294967295,x.g[3]=x.g[3]+U&4294967295}r.prototype.u=function(x,b){b===void 0&&(b=x.length);for(var A=b-this.blockSize,C=this.B,O=this.h,U=0;U<b;){if(O==0)for(;U<=A;)s(this,x,U),U+=this.blockSize;if(typeof x=="string"){for(;U<b;)if(C[O++]=x.charCodeAt(U++),O==this.blockSize){s(this,C),O=0;break}}else for(;U<b;)if(C[O++]=x[U++],O==this.blockSize){s(this,C),O=0;break}}this.h=O,this.o+=b},r.prototype.v=function(){var x=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);x[0]=128;for(var b=1;b<x.length-8;++b)x[b]=0;var A=8*this.o;for(b=x.length-8;b<x.length;++b)x[b]=A&255,A/=256;for(this.u(x),x=Array(16),b=A=0;4>b;++b)for(var C=0;32>C;C+=8)x[A++]=this.g[b]>>>C&255;return x};function i(x,b){var A=a;return Object.prototype.hasOwnProperty.call(A,x)?A[x]:A[x]=b(x)}function o(x,b){this.h=b;for(var A=[],C=!0,O=x.length-1;0<=O;O--){var U=x[O]|0;C&&U==b||(A[O]=U,C=!1)}this.g=A}var a={};function l(x){return-128<=x&&128>x?i(x,function(b){return new o([b|0],0>b?-1:0)}):new o([x|0],0>x?-1:0)}function c(x){if(isNaN(x)||!isFinite(x))return f;if(0>x)return E(c(-x));for(var b=[],A=1,C=0;x>=A;C++)b[C]=x/A|0,A*=4294967296;return new o(b,0)}function h(x,b){if(x.length==0)throw Error("number format error: empty string");if(b=b||10,2>b||36<b)throw Error("radix out of range: "+b);if(x.charAt(0)=="-")return E(h(x.substring(1),b));if(0<=x.indexOf("-"))throw Error('number format error: interior "-" character');for(var A=c(Math.pow(b,8)),C=f,O=0;O<x.length;O+=8){var U=Math.min(8,x.length-O),R=parseInt(x.substring(O,O+U),b);8>U?(U=c(Math.pow(b,U)),C=C.j(U).add(c(R))):(C=C.j(A),C=C.add(c(R)))}return C}var f=l(0),g=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(S(this))return-E(this).m();for(var x=0,b=1,A=0;A<this.g.length;A++){var C=this.i(A);x+=(0<=C?C:4294967296+C)*b,b*=4294967296}return x},n.toString=function(x){if(x=x||10,2>x||36<x)throw Error("radix out of range: "+x);if(I(this))return"0";if(S(this))return"-"+E(this).toString(x);for(var b=c(Math.pow(x,6)),A=this,C="";;){var O=L(A,b).g;A=$(A,O.j(b));var U=((0<A.g.length?A.g[0]:A.h)>>>0).toString(x);if(A=O,I(A))return U+C;for(;6>U.length;)U="0"+U;C=U+C}},n.i=function(x){return 0>x?0:x<this.g.length?this.g[x]:this.h};function I(x){if(x.h!=0)return!1;for(var b=0;b<x.g.length;b++)if(x.g[b]!=0)return!1;return!0}function S(x){return x.h==-1}n.l=function(x){return x=$(this,x),S(x)?-1:I(x)?0:1};function E(x){for(var b=x.g.length,A=[],C=0;C<b;C++)A[C]=~x.g[C];return new o(A,~x.h).add(g)}n.abs=function(){return S(this)?E(this):this},n.add=function(x){for(var b=Math.max(this.g.length,x.g.length),A=[],C=0,O=0;O<=b;O++){var U=C+(this.i(O)&65535)+(x.i(O)&65535),R=(U>>>16)+(this.i(O)>>>16)+(x.i(O)>>>16);C=R>>>16,U&=65535,R&=65535,A[O]=R<<16|U}return new o(A,A[A.length-1]&-2147483648?-1:0)};function $(x,b){return x.add(E(b))}n.j=function(x){if(I(this)||I(x))return f;if(S(this))return S(x)?E(this).j(E(x)):E(E(this).j(x));if(S(x))return E(this.j(E(x)));if(0>this.l(y)&&0>x.l(y))return c(this.m()*x.m());for(var b=this.g.length+x.g.length,A=[],C=0;C<2*b;C++)A[C]=0;for(C=0;C<this.g.length;C++)for(var O=0;O<x.g.length;O++){var U=this.i(C)>>>16,R=this.i(C)&65535,mt=x.i(O)>>>16,gt=x.i(O)&65535;A[2*C+2*O]+=R*gt,F(A,2*C+2*O),A[2*C+2*O+1]+=U*gt,F(A,2*C+2*O+1),A[2*C+2*O+1]+=R*mt,F(A,2*C+2*O+1),A[2*C+2*O+2]+=U*mt,F(A,2*C+2*O+2)}for(C=0;C<b;C++)A[C]=A[2*C+1]<<16|A[2*C];for(C=b;C<2*b;C++)A[C]=0;return new o(A,0)};function F(x,b){for(;(x[b]&65535)!=x[b];)x[b+1]+=x[b]>>>16,x[b]&=65535,b++}function M(x,b){this.g=x,this.h=b}function L(x,b){if(I(b))throw Error("division by zero");if(I(x))return new M(f,f);if(S(x))return b=L(E(x),b),new M(E(b.g),E(b.h));if(S(b))return b=L(x,E(b)),new M(E(b.g),b.h);if(30<x.g.length){if(S(x)||S(b))throw Error("slowDivide_ only works with positive integers.");for(var A=g,C=b;0>=C.l(x);)A=re(A),C=re(C);var O=W(A,1),U=W(C,1);for(C=W(C,2),A=W(A,2);!I(C);){var R=U.add(C);0>=R.l(x)&&(O=O.add(A),U=R),C=W(C,1),A=W(A,1)}return b=$(x,O.j(b)),new M(O,b)}for(O=f;0<=x.l(b);){for(A=Math.max(1,Math.floor(x.m()/b.m())),C=Math.ceil(Math.log(A)/Math.LN2),C=48>=C?1:Math.pow(2,C-48),U=c(A),R=U.j(b);S(R)||0<R.l(x);)A-=C,U=c(A),R=U.j(b);I(U)&&(U=g),O=O.add(U),x=$(x,R)}return new M(O,x)}n.A=function(x){return L(this,x).h},n.and=function(x){for(var b=Math.max(this.g.length,x.g.length),A=[],C=0;C<b;C++)A[C]=this.i(C)&x.i(C);return new o(A,this.h&x.h)},n.or=function(x){for(var b=Math.max(this.g.length,x.g.length),A=[],C=0;C<b;C++)A[C]=this.i(C)|x.i(C);return new o(A,this.h|x.h)},n.xor=function(x){for(var b=Math.max(this.g.length,x.g.length),A=[],C=0;C<b;C++)A[C]=this.i(C)^x.i(C);return new o(A,this.h^x.h)};function re(x){for(var b=x.g.length+1,A=[],C=0;C<b;C++)A[C]=x.i(C)<<1|x.i(C-1)>>>31;return new o(A,x.h)}function W(x,b){var A=b>>5;b%=32;for(var C=x.g.length-A,O=[],U=0;U<C;U++)O[U]=0<b?x.i(U+A)>>>b|x.i(U+A+1)<<32-b:x.i(U+A);return new o(O,x.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,iw=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=h,No=o}).apply(typeof Cy<"u"?Cy:typeof self<"u"?self:typeof window<"u"?window:{});var Yc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ow,iu,aw,fd,_p,lw,uw,cw;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,p,v){return u==Array.prototype||u==Object.prototype||(u[p]=v.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof Yc=="object"&&Yc];for(var p=0;p<u.length;++p){var v=u[p];if(v&&v.Math==Math)return v}throw Error("Cannot find global object")}var r=t(this);function s(u,p){if(p)e:{var v=r;u=u.split(".");for(var w=0;w<u.length-1;w++){var q=u[w];if(!(q in v))break e;v=v[q]}u=u[u.length-1],w=v[u],p=p(w),p!=w&&p!=null&&e(v,u,{configurable:!0,writable:!0,value:p})}}function i(u,p){u instanceof String&&(u+="");var v=0,w=!1,q={next:function(){if(!w&&v<u.length){var Y=v++;return{value:p(Y,u[Y]),done:!1}}return w=!0,{done:!0,value:void 0}}};return q[Symbol.iterator]=function(){return q},q}s("Array.prototype.values",function(u){return u||function(){return i(this,function(p,v){return v})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var p=typeof u;return p=p!="object"?p:u?Array.isArray(u)?"array":p:"null",p=="array"||p=="object"&&typeof u.length=="number"}function c(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function h(u,p,v){return u.call.apply(u.bind,arguments)}function f(u,p,v){if(!u)throw Error();if(2<arguments.length){var w=Array.prototype.slice.call(arguments,2);return function(){var q=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(q,w),u.apply(p,q)}}return function(){return u.apply(p,arguments)}}function g(u,p,v){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,g.apply(null,arguments)}function y(u,p){var v=Array.prototype.slice.call(arguments,1);return function(){var w=v.slice();return w.push.apply(w,arguments),u.apply(this,w)}}function I(u,p){function v(){}v.prototype=p.prototype,u.aa=p.prototype,u.prototype=new v,u.prototype.constructor=u,u.Qb=function(w,q,Y){for(var Se=Array(arguments.length-2),xt=2;xt<arguments.length;xt++)Se[xt-2]=arguments[xt];return p.prototype[q].apply(w,Se)}}function S(u){const p=u.length;if(0<p){const v=Array(p);for(let w=0;w<p;w++)v[w]=u[w];return v}return[]}function E(u,p){for(let v=1;v<arguments.length;v++){const w=arguments[v];if(l(w)){const q=u.length||0,Y=w.length||0;u.length=q+Y;for(let Se=0;Se<Y;Se++)u[q+Se]=w[Se]}else u.push(w)}}class ${constructor(p,v){this.i=p,this.j=v,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function F(u){return/^[\s\xa0]*$/.test(u)}function M(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function L(u){return L[" "](u),u}L[" "]=function(){};var re=M().indexOf("Gecko")!=-1&&!(M().toLowerCase().indexOf("webkit")!=-1&&M().indexOf("Edge")==-1)&&!(M().indexOf("Trident")!=-1||M().indexOf("MSIE")!=-1)&&M().indexOf("Edge")==-1;function W(u,p,v){for(const w in u)p.call(v,u[w],w,u)}function x(u,p){for(const v in u)p.call(void 0,u[v],v,u)}function b(u){const p={};for(const v in u)p[v]=u[v];return p}const A="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function C(u,p){let v,w;for(let q=1;q<arguments.length;q++){w=arguments[q];for(v in w)u[v]=w[v];for(let Y=0;Y<A.length;Y++)v=A[Y],Object.prototype.hasOwnProperty.call(w,v)&&(u[v]=w[v])}}function O(u){var p=1;u=u.split(":");const v=[];for(;0<p&&u.length;)v.push(u.shift()),p--;return u.length&&v.push(u.join(":")),v}function U(u){a.setTimeout(()=>{throw u},0)}function R(){var u=ie;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class mt{constructor(){this.h=this.g=null}add(p,v){const w=gt.get();w.set(p,v),this.h?this.h.next=w:this.g=w,this.h=w}}var gt=new $(()=>new be,u=>u.reset());class be{constructor(){this.next=this.g=this.h=null}set(p,v){this.h=p,this.g=v,this.next=null}reset(){this.next=this.g=this.h=null}}let ne,ue=!1,ie=new mt,De=()=>{const u=a.Promise.resolve(void 0);ne=()=>{u.then(ee)}};var ee=()=>{for(var u;u=R();){try{u.h.call(u.g)}catch(v){U(v)}var p=gt;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}ue=!1};function J(){this.s=this.s,this.C=this.C}J.prototype.s=!1,J.prototype.ma=function(){this.s||(this.s=!0,this.N())},J.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Te(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}Te.prototype.h=function(){this.defaultPrevented=!0};var He=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const v=()=>{};a.addEventListener("test",v,p),a.removeEventListener("test",v,p)}catch{}return u}();function lt(u,p){if(Te.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var v=this.type=u.type,w=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(re){e:{try{L(p.nodeName);var q=!0;break e}catch{}q=!1}q||(p=null)}}else v=="mouseover"?p=u.fromElement:v=="mouseout"&&(p=u.toElement);this.relatedTarget=p,w?(this.clientX=w.clientX!==void 0?w.clientX:w.pageX,this.clientY=w.clientY!==void 0?w.clientY:w.pageY,this.screenX=w.screenX||0,this.screenY=w.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:Ot[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&lt.aa.h.call(this)}}I(lt,Te);var Ot={2:"touch",3:"pen",4:"mouse"};lt.prototype.h=function(){lt.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var X="closure_listenable_"+(1e6*Math.random()|0),Ae=0;function xe(u,p,v,w,q){this.listener=u,this.proxy=null,this.src=p,this.type=v,this.capture=!!w,this.ha=q,this.key=++Ae,this.da=this.fa=!1}function Ne(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function tt(u){this.src=u,this.g={},this.h=0}tt.prototype.add=function(u,p,v,w,q){var Y=u.toString();u=this.g[Y],u||(u=this.g[Y]=[],this.h++);var Se=T(u,p,w,q);return-1<Se?(p=u[Se],v||(p.fa=!1)):(p=new xe(p,this.src,Y,!!w,q),p.fa=v,u.push(p)),p};function ct(u,p){var v=p.type;if(v in u.g){var w=u.g[v],q=Array.prototype.indexOf.call(w,p,void 0),Y;(Y=0<=q)&&Array.prototype.splice.call(w,q,1),Y&&(Ne(p),u.g[v].length==0&&(delete u.g[v],u.h--))}}function T(u,p,v,w){for(var q=0;q<u.length;++q){var Y=u[q];if(!Y.da&&Y.listener==p&&Y.capture==!!v&&Y.ha==w)return q}return-1}var k="closure_lm_"+(1e6*Math.random()|0),K={};function G(u,p,v,w,q){if(w&&w.once)return ye(u,p,v,w,q);if(Array.isArray(p)){for(var Y=0;Y<p.length;Y++)G(u,p[Y],v,w,q);return null}return v=z(v),u&&u[X]?u.K(p,v,c(w)?!!w.capture:!!w,q):te(u,p,v,!1,w,q)}function te(u,p,v,w,q,Y){if(!p)throw Error("Invalid event type");var Se=c(q)?!!q.capture:!!q,xt=Pe(u);if(xt||(u[k]=xt=new tt(u)),v=xt.add(p,v,w,Se,Y),v.proxy)return v;if(w=de(),v.proxy=w,w.src=u,w.listener=v,u.addEventListener)He||(q=Se),q===void 0&&(q=!1),u.addEventListener(p.toString(),w,q);else if(u.attachEvent)u.attachEvent(ge(p.toString()),w);else if(u.addListener&&u.removeListener)u.addListener(w);else throw Error("addEventListener and attachEvent are unavailable.");return v}function de(){function u(v){return p.call(u.src,u.listener,v)}const p=$e;return u}function ye(u,p,v,w,q){if(Array.isArray(p)){for(var Y=0;Y<p.length;Y++)ye(u,p[Y],v,w,q);return null}return v=z(v),u&&u[X]?u.L(p,v,c(w)?!!w.capture:!!w,q):te(u,p,v,!0,w,q)}function ve(u,p,v,w,q){if(Array.isArray(p))for(var Y=0;Y<p.length;Y++)ve(u,p[Y],v,w,q);else w=c(w)?!!w.capture:!!w,v=z(v),u&&u[X]?(u=u.i,p=String(p).toString(),p in u.g&&(Y=u.g[p],v=T(Y,v,w,q),-1<v&&(Ne(Y[v]),Array.prototype.splice.call(Y,v,1),Y.length==0&&(delete u.g[p],u.h--)))):u&&(u=Pe(u))&&(p=u.g[p.toString()],u=-1,p&&(u=T(p,v,w,q)),(v=-1<u?p[u]:null)&&Ie(v))}function Ie(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[X])ct(p.i,u);else{var v=u.type,w=u.proxy;p.removeEventListener?p.removeEventListener(v,w,u.capture):p.detachEvent?p.detachEvent(ge(v),w):p.addListener&&p.removeListener&&p.removeListener(w),(v=Pe(p))?(ct(v,u),v.h==0&&(v.src=null,p[k]=null)):Ne(u)}}}function ge(u){return u in K?K[u]:K[u]="on"+u}function $e(u,p){if(u.da)u=!0;else{p=new lt(p,this);var v=u.listener,w=u.ha||u.src;u.fa&&Ie(u),u=v.call(w,p)}return u}function Pe(u){return u=u[k],u instanceof tt?u:null}var Oe="__closure_events_fn_"+(1e9*Math.random()>>>0);function z(u){return typeof u=="function"?u:(u[Oe]||(u[Oe]=function(p){return u.handleEvent(p)}),u[Oe])}function j(){J.call(this),this.i=new tt(this),this.M=this,this.F=null}I(j,J),j.prototype[X]=!0,j.prototype.removeEventListener=function(u,p,v,w){ve(this,u,p,v,w)};function _e(u,p){var v,w=u.F;if(w)for(v=[];w;w=w.F)v.push(w);if(u=u.M,w=p.type||p,typeof p=="string")p=new Te(p,u);else if(p instanceof Te)p.target=p.target||u;else{var q=p;p=new Te(w,u),C(p,q)}if(q=!0,v)for(var Y=v.length-1;0<=Y;Y--){var Se=p.g=v[Y];q=we(Se,w,!0,p)&&q}if(Se=p.g=u,q=we(Se,w,!0,p)&&q,q=we(Se,w,!1,p)&&q,v)for(Y=0;Y<v.length;Y++)Se=p.g=v[Y],q=we(Se,w,!1,p)&&q}j.prototype.N=function(){if(j.aa.N.call(this),this.i){var u=this.i,p;for(p in u.g){for(var v=u.g[p],w=0;w<v.length;w++)Ne(v[w]);delete u.g[p],u.h--}}this.F=null},j.prototype.K=function(u,p,v,w){return this.i.add(String(u),p,!1,v,w)},j.prototype.L=function(u,p,v,w){return this.i.add(String(u),p,!0,v,w)};function we(u,p,v,w){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();for(var q=!0,Y=0;Y<p.length;++Y){var Se=p[Y];if(Se&&!Se.da&&Se.capture==v){var xt=Se.listener,wn=Se.ha||Se.src;Se.fa&&ct(u.i,Se),q=xt.call(wn,w)!==!1&&q}}return q&&!w.defaultPrevented}function We(u,p,v){if(typeof u=="function")v&&(u=g(u,v));else if(u&&typeof u.handleEvent=="function")u=g(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(u,p||0)}function Ye(u){u.g=We(()=>{u.g=null,u.i&&(u.i=!1,Ye(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class bt extends J{constructor(p,v){super(),this.m=p,this.l=v,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:Ye(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function rt(u){J.call(this),this.h=u,this.g={}}I(rt,J);var Er=[];function Tr(u){W(u.g,function(p,v){this.g.hasOwnProperty(v)&&Ie(p)},u),u.g={}}rt.prototype.N=function(){rt.aa.N.call(this),Tr(this)},rt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var jt=a.JSON.stringify,nn=a.JSON.parse,Un=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function nr(){}nr.prototype.h=null;function qt(u){return u.h||(u.h=u.i())}function ra(){}var Jn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function vn(){Te.call(this,"d")}I(vn,Te);function hs(){Te.call(this,"c")}I(hs,Te);var Nr={},eo=null;function fs(){return eo=eo||new j}Nr.La="serverreachability";function to(u){Te.call(this,Nr.La,u)}I(to,Te);function ps(u){const p=fs();_e(p,new to(p))}Nr.STAT_EVENT="statevent";function ms(u,p){Te.call(this,Nr.STAT_EVENT,u),this.stat=p}I(ms,Te);function bn(u){const p=fs();_e(p,new ms(p,u))}Nr.Ma="timingevent";function no(u,p){Te.call(this,Nr.Ma,u),this.size=p}I(no,Te);function gs(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},p)}function vs(){this.g=!0}vs.prototype.xa=function(){this.g=!1};function Rc(u,p,v,w,q,Y){u.info(function(){if(u.g)if(Y)for(var Se="",xt=Y.split("&"),wn=0;wn<xt.length;wn++){var yt=xt[wn].split("=");if(1<yt.length){var Tn=yt[0];yt=yt[1];var An=Tn.split("_");Se=2<=An.length&&An[1]=="type"?Se+(Tn+"="+yt+"&"):Se+(Tn+"=redacted&")}}else Se=null;else Se=Y;return"XMLHTTP REQ ("+w+") [attempt "+q+"]: "+p+`
`+v+`
`+Se})}function lf(u,p,v,w,q,Y,Se){u.info(function(){return"XMLHTTP RESP ("+w+") [ attempt "+q+"]: "+p+`
`+v+`
`+Y+" "+Se})}function zr(u,p,v,w){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+cf(u,v)+(w?" "+w:"")})}function uf(u,p){u.info(function(){return"TIMEOUT: "+p})}vs.prototype.info=function(){};function cf(u,p){if(!u.g)return p;if(!p)return null;try{var v=JSON.parse(p);if(v){for(u=0;u<v.length;u++)if(Array.isArray(v[u])){var w=v[u];if(!(2>w.length)){var q=w[1];if(Array.isArray(q)&&!(1>q.length)){var Y=q[0];if(Y!="noop"&&Y!="stop"&&Y!="close")for(var Se=1;Se<q.length;Se++)q[Se]=""}}}}return jt(v)}catch{return p}}var sa={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Cc={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ia;function oa(){}I(oa,nr),oa.prototype.g=function(){return new XMLHttpRequest},oa.prototype.i=function(){return{}},ia=new oa;function Vr(u,p,v,w){this.j=u,this.i=p,this.l=v,this.R=w||1,this.U=new rt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new kc}function kc(){this.i=null,this.g="",this.h=!1}var Cl={},kl={};function Ar(u,p,v){u.L=1,u.v=io(sr(p)),u.m=v,u.P=!0,Kr(u,null)}function Kr(u,p){u.F=Date.now(),pr(u),u.A=sr(u.v);var v=u.A,w=u.R;Array.isArray(w)||(w=[String(w)]),Lc(v.i,"t",w),u.C=0,v=u.j.J,u.h=new kc,u.g=ql(u.j,v?p:null,!u.m),0<u.O&&(u.M=new bt(g(u.Y,u,u.g),u.O)),p=u.U,v=u.g,w=u.ca;var q="readystatechange";Array.isArray(q)||(q&&(Er[0]=q.toString()),q=Er);for(var Y=0;Y<q.length;Y++){var Se=G(v,q[Y],w||p.handleEvent,!1,p.h||p);if(!Se)break;p.g[Se.key]=Se}p=u.H?b(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),ps(),Rc(u.i,u.u,u.A,u.l,u.R,u.m)}Vr.prototype.ca=function(u){u=u.target;const p=this.M;p&&ln(u)==3?p.j():this.Y(u)},Vr.prototype.Y=function(u){try{if(u==this.g)e:{const An=ln(this.g);var p=this.g.Ba();const hi=this.g.Z();if(!(3>An)&&(An!=3||this.g&&(this.h.h||this.g.oa()||Fc(this.g)))){this.J||An!=4||p==7||(p==8||0>=hi?ps(3):ps(2)),ei(this);var v=this.g.Z();this.X=v;t:if(Or(this)){var w=Fc(this.g);u="";var q=w.length,Y=ln(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ys(this),Mr(this);var Se="";break t}this.h.i=new a.TextDecoder}for(p=0;p<q;p++)this.h.h=!0,u+=this.h.i.decode(w[p],{stream:!(Y&&p==q-1)});w.length=0,this.h.g+=u,this.C=0,Se=this.h.g}else Se=this.g.oa();if(this.o=v==200,lf(this.i,this.u,this.A,this.l,this.R,An,v),this.o){if(this.T&&!this.K){t:{if(this.g){var xt,wn=this.g;if((xt=wn.g?wn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!F(xt)){var yt=xt;break t}}yt=null}if(v=yt)zr(this.i,this.l,v,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,rr(this,v);else{this.o=!1,this.s=3,bn(12),ys(this),Mr(this);break e}}if(this.P){v=!0;let vr;for(;!this.J&&this.C<Se.length;)if(vr=Zs(this,Se),vr==kl){An==4&&(this.s=4,bn(14),v=!1),zr(this.i,this.l,null,"[Incomplete Response]");break}else if(vr==Cl){this.s=4,bn(15),zr(this.i,this.l,Se,"[Invalid Chunk]"),v=!1;break}else zr(this.i,this.l,vr,null),rr(this,vr);if(Or(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),An!=4||Se.length!=0||this.h.h||(this.s=1,bn(16),v=!1),this.o=this.o&&v,!v)zr(this.i,this.l,Se,"[Invalid Chunked Response]"),ys(this),Mr(this);else if(0<Se.length&&!this.W){this.W=!0;var Tn=this.j;Tn.g==this&&Tn.ba&&!Tn.M&&(Tn.j.info("Great, no buffering proxy detected. Bytes received: "+Se.length),ga(Tn),Tn.M=!0,bn(11))}}else zr(this.i,this.l,Se,null),rr(this,Se);An==4&&ys(this),this.o&&!this.J&&(An==4?ho(this.j,this):(this.o=!1,pr(this)))}else $l(this.g),v==400&&0<Se.indexOf("Unknown SID")?(this.s=3,bn(12)):(this.s=0,bn(13)),ys(this),Mr(this)}}}catch{}finally{}};function Or(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function Zs(u,p){var v=u.C,w=p.indexOf(`
`,v);return w==-1?kl:(v=Number(p.substring(v,w)),isNaN(v)?Cl:(w+=1,w+v>p.length?kl:(p=p.slice(w,w+v),u.C=w+v,p)))}Vr.prototype.cancel=function(){this.J=!0,ys(this)};function pr(u){u.S=Date.now()+u.I,Dl(u,u.I)}function Dl(u,p){if(u.B!=null)throw Error("WatchDog timer not null");u.B=gs(g(u.ba,u),p)}function ei(u){u.B&&(a.clearTimeout(u.B),u.B=null)}Vr.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(uf(this.i,this.A),this.L!=2&&(ps(),bn(17)),ys(this),this.s=2,Mr(this)):Dl(this,this.S-u)};function Mr(u){u.j.G==0||u.J||ho(u.j,u)}function ys(u){ei(u);var p=u.M;p&&typeof p.ma=="function"&&p.ma(),u.M=null,Tr(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function rr(u,p){try{var v=u.j;if(v.G!=0&&(v.g==u||Nn(v.h,u))){if(!u.K&&Nn(v.h,u)&&v.G==3){try{var w=v.Da.g.parse(p)}catch{w=null}if(Array.isArray(w)&&w.length==3){var q=w;if(q[0]==0){e:if(!v.u){if(v.g)if(v.g.F+3e3<u.F)ci(v),lo(v);else break e;jl(v),bn(18)}}else v.za=q[1],0<v.za-v.T&&37500>q[2]&&v.F&&v.v==0&&!v.C&&(v.C=gs(g(v.Za,v),6e3));if(1>=Nc(v.h)&&v.ca){try{v.ca()}catch{}v.ca=void 0}}else Yr(v,11)}else if((u.K||v.g==u)&&ci(v),!F(p))for(q=v.Da.g.parse(p),p=0;p<q.length;p++){let yt=q[p];if(v.T=yt[0],yt=yt[1],v.G==2)if(yt[0]=="c"){v.K=yt[1],v.ia=yt[2];const Tn=yt[3];Tn!=null&&(v.la=Tn,v.j.info("VER="+v.la));const An=yt[4];An!=null&&(v.Aa=An,v.j.info("SVER="+v.Aa));const hi=yt[5];hi!=null&&typeof hi=="number"&&0<hi&&(w=1.5*hi,v.L=w,v.j.info("backChannelRequestTimeoutMs_="+w)),w=v;const vr=u.g;if(vr){const yr=vr.g?vr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(yr){var Y=w.h;Y.g||yr.indexOf("spdy")==-1&&yr.indexOf("quic")==-1&&yr.indexOf("h2")==-1||(Y.j=Y.l,Y.g=new Set,Y.h&&(ti(Y,Y.h),Y.h=null))}if(w.D){const Bl=vr.g?vr.g.getResponseHeader("X-HTTP-Session-Id"):null;Bl&&(w.ya=Bl,Dt(w.I,w.D,Bl))}}v.G=3,v.l&&v.l.ua(),v.ba&&(v.R=Date.now()-u.F,v.j.info("Handshake RTT: "+v.R+"ms")),w=v;var Se=u;if(w.qa=Bc(w,w.J?w.ia:null,w.W),Se.K){mr(w.h,Se);var xt=Se,wn=w.L;wn&&(xt.I=wn),xt.B&&(ei(xt),pr(xt)),w.g=Se}else ma(w);0<v.i.length&&ui(v)}else yt[0]!="stop"&&yt[0]!="close"||Yr(v,7);else v.G==3&&(yt[0]=="stop"||yt[0]=="close"?yt[0]=="stop"?Yr(v,7):Fl(v):yt[0]!="noop"&&v.l&&v.l.ta(yt),v.v=0)}}ps(4)}catch{}}var Dc=class{constructor(u,p){this.g=u,this.map=p}};function Nl(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function aa(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function Nc(u){return u.h?1:u.g?u.g.size:0}function Nn(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function ti(u,p){u.g?u.g.add(p):u.h=p}function mr(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}Nl.prototype.cancel=function(){if(this.i=Vl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function Vl(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const v of u.g.values())p=p.concat(v.D);return p}return S(u.i)}function Vc(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var p=[],v=u.length,w=0;w<v;w++)p.push(u[w]);return p}p=[],v=0;for(w in u)p[v++]=u[w];return p}function ro(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var p=[];u=u.length;for(var v=0;v<u;v++)p.push(v);return p}p=[],v=0;for(const w in u)p[v++]=w;return p}}}function ni(u,p){if(u.forEach&&typeof u.forEach=="function")u.forEach(p,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,p,void 0);else for(var v=ro(u),w=Vc(u),q=w.length,Y=0;Y<q;Y++)p.call(void 0,w[Y],v&&v[Y],u)}var so=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ri(u,p){if(u){u=u.split("&");for(var v=0;v<u.length;v++){var w=u[v].indexOf("="),q=null;if(0<=w){var Y=u[v].substring(0,w);q=u[v].substring(w+1)}else Y=u[v];p(Y,q?decodeURIComponent(q.replace(/\+/g," ")):"")}}}function Gr(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof Gr){this.h=u.h,ir(this,u.j),this.o=u.o,this.g=u.g,la(this,u.s),this.l=u.l;var p=u.i,v=new ii;v.i=p.i,p.g&&(v.g=new Map(p.g),v.h=p.h),Oc(this,v),this.m=u.m}else u&&(p=String(u).match(so))?(this.h=!1,ir(this,p[1]||"",!0),this.o=Hr(p[2]||""),this.g=Hr(p[3]||"",!0),la(this,p[4]),this.l=Hr(p[5]||"",!0),Oc(this,p[6]||"",!0),this.m=Hr(p[7]||"")):(this.h=!1,this.i=new ii(null,this.h))}Gr.prototype.toString=function(){var u=[],p=this.j;p&&u.push(Wr(p,Fe,!0),":");var v=this.g;return(v||p=="file")&&(u.push("//"),(p=this.o)&&u.push(Wr(p,Fe,!0),"@"),u.push(encodeURIComponent(String(v)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),v=this.s,v!=null&&u.push(":",String(v))),(v=this.l)&&(this.g&&v.charAt(0)!="/"&&u.push("/"),u.push(Wr(v,v.charAt(0)=="/"?gr:vt,!0))),(v=this.i.toString())&&u.push("?",v),(v=this.m)&&u.push("#",Wr(v,df)),u.join("")};function sr(u){return new Gr(u)}function ir(u,p,v){u.j=v?Hr(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function la(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function Oc(u,p,v){p instanceof ii?(u.i=p,ca(u.i,u.h)):(v||(p=Wr(p,si)),u.i=new ii(p,u.h))}function Dt(u,p,v){u.i.set(p,v)}function io(u){return Dt(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function Hr(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function Wr(u,p,v){return typeof u=="string"?(u=encodeURI(u).replace(p,Ol),v&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function Ol(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var Fe=/[#\/\?@]/g,vt=/[#\?:]/g,gr=/[#\?]/g,si=/[#\?@]/g,df=/#/g;function ii(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function Qr(u){u.g||(u.g=new Map,u.h=0,u.i&&ri(u.i,function(p,v){u.add(decodeURIComponent(p.replace(/\+/g," ")),v)}))}n=ii.prototype,n.add=function(u,p){Qr(this),this.i=null,u=Sr(this,u);var v=this.g.get(u);return v||this.g.set(u,v=[]),v.push(p),this.h+=1,this};function Mc(u,p){Qr(u),p=Sr(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function ua(u,p){return Qr(u),p=Sr(u,p),u.g.has(p)}n.forEach=function(u,p){Qr(this),this.g.forEach(function(v,w){v.forEach(function(q){u.call(p,q,w,this)},this)},this)},n.na=function(){Qr(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),v=[];for(let w=0;w<p.length;w++){const q=u[w];for(let Y=0;Y<q.length;Y++)v.push(p[w])}return v},n.V=function(u){Qr(this);let p=[];if(typeof u=="string")ua(this,u)&&(p=p.concat(this.g.get(Sr(this,u))));else{u=Array.from(this.g.values());for(let v=0;v<u.length;v++)p=p.concat(u[v])}return p},n.set=function(u,p){return Qr(this),this.i=null,u=Sr(this,u),ua(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},n.get=function(u,p){return u?(u=this.V(u),0<u.length?String(u[0]):p):p};function Lc(u,p,v){Mc(u,p),0<v.length&&(u.i=null,u.g.set(Sr(u,p),S(v)),u.h+=v.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var v=0;v<p.length;v++){var w=p[v];const Y=encodeURIComponent(String(w)),Se=this.V(w);for(w=0;w<Se.length;w++){var q=Y;Se[w]!==""&&(q+="="+encodeURIComponent(String(Se[w]))),u.push(q)}}return this.i=u.join("&")};function Sr(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function ca(u,p){p&&!u.j&&(Qr(u),u.i=null,u.g.forEach(function(v,w){var q=w.toLowerCase();w!=q&&(Mc(this,w),Lc(this,q,v))},u)),u.j=p}function oi(u,p){const v=new vs;if(a.Image){const w=new Image;w.onload=y(or,v,"TestLoadImage: loaded",!0,p,w),w.onerror=y(or,v,"TestLoadImage: error",!1,p,w),w.onabort=y(or,v,"TestLoadImage: abort",!1,p,w),w.ontimeout=y(or,v,"TestLoadImage: timeout",!1,p,w),a.setTimeout(function(){w.ontimeout&&w.ontimeout()},1e4),w.src=u}else p(!1)}function ai(u,p){const v=new vs,w=new AbortController,q=setTimeout(()=>{w.abort(),or(v,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:w.signal}).then(Y=>{clearTimeout(q),Y.ok?or(v,"TestPingServer: ok",!0,p):or(v,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(q),or(v,"TestPingServer: error",!1,p)})}function or(u,p,v,w,q){try{q&&(q.onload=null,q.onerror=null,q.onabort=null,q.ontimeout=null),w(v)}catch{}}function oo(){this.g=new Un}function da(u,p,v){const w=v||"";try{ni(u,function(q,Y){let Se=q;c(q)&&(Se=jt(q)),p.push(w+Y+"="+encodeURIComponent(Se))})}catch(q){throw p.push(w+"type="+encodeURIComponent("_badmap")),q}}function ha(u){this.l=u.Ub||null,this.j=u.eb||!1}I(ha,nr),ha.prototype.g=function(){return new fa(this.l,this.j)},ha.prototype.i=function(u){return function(){return u}}({});function fa(u,p){j.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}I(fa,j),n=fa.prototype,n.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,Ge(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,li(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,Ge(this)),this.g&&(this.readyState=3,Ge(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;$c(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function $c(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?li(this):Ge(this),this.readyState==3&&$c(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,li(this))},n.Qa=function(u){this.g&&(this.response=u,li(this))},n.ga=function(){this.g&&li(this)};function li(u){u.readyState=4,u.l=null,u.j=null,u.v=null,Ge(u)}n.setRequestHeader=function(u,p){this.u.append(u,p)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var v=p.next();!v.done;)v=v.value,u.push(v[0]+": "+v[1]),v=p.next();return u.join(`\r
`)};function Ge(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(fa.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function st(u){let p="";return W(u,function(v,w){p+=w,p+=":",p+=v,p+=`\r
`}),p}function Gt(u,p,v){e:{for(w in v){var w=!1;break e}w=!0}w||(v=st(v),typeof u=="string"?v!=null&&encodeURIComponent(String(v)):Dt(u,p,v))}function ze(u){j.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}I(ze,j);var hf=/^https?$/i,Ml=["POST","PUT"];n=ze.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,p,v,w){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ia.g(),this.v=this.o?qt(this.o):qt(ia),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(Y){Ll(this,Y);return}if(u=v||"",v=new Map(this.headers),w)if(Object.getPrototypeOf(w)===Object.prototype)for(var q in w)v.set(q,w[q]);else if(typeof w.keys=="function"&&typeof w.get=="function")for(const Y of w.keys())v.set(Y,w.get(Y));else throw Error("Unknown input type for opt_headers: "+String(w));w=Array.from(v.keys()).find(Y=>Y.toLowerCase()=="content-type"),q=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(Ml,p,void 0))||w||q||v.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Y,Se]of v)this.g.setRequestHeader(Y,Se);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{bs(this),this.u=!0,this.g.send(u),this.u=!1}catch(Y){Ll(this,Y)}};function Ll(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,_s(u),pa(u)}function _s(u){u.A||(u.A=!0,_e(u,"complete"),_e(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,_e(this,"complete"),_e(this,"abort"),pa(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),pa(this,!0)),ze.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Jr(this):this.bb())},n.bb=function(){Jr(this)};function Jr(u){if(u.h&&typeof o<"u"&&(!u.v[1]||ln(u)!=4||u.Z()!=2)){if(u.u&&ln(u)==4)We(u.Ea,0,u);else if(_e(u,"readystatechange"),ln(u)==4){u.h=!1;try{const Se=u.Z();e:switch(Se){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var v;if(!(v=p)){var w;if(w=Se===0){var q=String(u.D).match(so)[1]||null;!q&&a.self&&a.self.location&&(q=a.self.location.protocol.slice(0,-1)),w=!hf.test(q?q.toLowerCase():"")}v=w}if(v)_e(u,"complete"),_e(u,"success");else{u.m=6;try{var Y=2<ln(u)?u.g.statusText:""}catch{Y=""}u.l=Y+" ["+u.Z()+"]",_s(u)}}finally{pa(u)}}}}function pa(u,p){if(u.g){bs(u);const v=u.g,w=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||_e(u,"ready");try{v.onreadystatechange=w}catch{}}}function bs(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function ln(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<ln(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),nn(p)}};function Fc(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function $l(u){const p={};u=(u.g&&2<=ln(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let w=0;w<u.length;w++){if(F(u[w]))continue;var v=O(u[w]);const q=v[0];if(v=v[1],typeof v!="string")continue;v=v.trim();const Y=p[q]||[];p[q]=Y,Y.push(v)}x(p,function(w){return w.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ao(u,p,v){return v&&v.internalChannelParams&&v.internalChannelParams[u]||p}function Uc(u){this.Aa=0,this.i=[],this.j=new vs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ao("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ao("baseRetryDelayMs",5e3,u),this.cb=ao("retryDelaySeedMs",1e4,u),this.Wa=ao("forwardChannelMaxRetries",2,u),this.wa=ao("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new Nl(u&&u.concurrentRequestLimit),this.Da=new oo,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Uc.prototype,n.la=8,n.G=1,n.connect=function(u,p,v,w){bn(0),this.W=u,this.H=p||{},v&&w!==void 0&&(this.H.OSID=v,this.H.OAID=w),this.F=this.X,this.I=Bc(this,null,this.W),ui(this)};function Fl(u){if(uo(u),u.G==3){var p=u.U++,v=sr(u.I);if(Dt(v,"SID",u.K),Dt(v,"RID",p),Dt(v,"TYPE","terminate"),co(u,v),p=new Vr(u,u.j,p),p.L=2,p.v=io(sr(v)),v=!1,a.navigator&&a.navigator.sendBeacon)try{v=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!v&&a.Image&&(new Image().src=p.v,v=!0),v||(p.g=ql(p.j,null),p.g.ea(p.v)),p.F=Date.now(),pr(p)}qc(u)}function lo(u){u.g&&(ga(u),u.g.cancel(),u.g=null)}function uo(u){lo(u),u.u&&(a.clearTimeout(u.u),u.u=null),ci(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function ui(u){if(!aa(u.h)&&!u.s){u.s=!0;var p=u.Ga;ne||De(),ue||(ne(),ue=!0),ie.add(p,u),u.B=0}}function ar(u,p){return Nc(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=p.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=gs(g(u.Ga,u,p),fo(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const q=new Vr(this,this.j,u);let Y=this.o;if(this.S&&(Y?(Y=b(Y),C(Y,this.S)):Y=this.S),this.m!==null||this.O||(q.H=Y,Y=null),this.P)e:{for(var p=0,v=0;v<this.i.length;v++){t:{var w=this.i[v];if("__data__"in w.map&&(w=w.map.__data__,typeof w=="string")){w=w.length;break t}w=void 0}if(w===void 0)break;if(p+=w,4096<p){p=v;break e}if(p===4096||v===this.i.length-1){p=v+1;break e}}p=1e3}else p=1e3;p=Ul(this,q,p),v=sr(this.I),Dt(v,"RID",u),Dt(v,"CVER",22),this.D&&Dt(v,"X-HTTP-Session-Id",this.D),co(this,v),Y&&(this.O?p="headers="+encodeURIComponent(String(st(Y)))+"&"+p:this.m&&Gt(v,this.m,Y)),ti(this.h,q),this.Ua&&Dt(v,"TYPE","init"),this.P?(Dt(v,"$req",p),Dt(v,"SID","null"),q.T=!0,Ar(q,v,null)):Ar(q,v,p),this.G=2}}else this.G==3&&(u?jc(this,u):this.i.length==0||aa(this.h)||jc(this))};function jc(u,p){var v;p?v=p.l:v=u.U++;const w=sr(u.I);Dt(w,"SID",u.K),Dt(w,"RID",v),Dt(w,"AID",u.T),co(u,w),u.m&&u.o&&Gt(w,u.m,u.o),v=new Vr(u,u.j,v,u.B+1),u.m===null&&(v.H=u.o),p&&(u.i=p.D.concat(u.i)),p=Ul(u,v,1e3),v.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),ti(u.h,v),Ar(v,w,p)}function co(u,p){u.H&&W(u.H,function(v,w){Dt(p,w,v)}),u.l&&ni({},function(v,w){Dt(p,w,v)})}function Ul(u,p,v){v=Math.min(u.i.length,v);var w=u.l?g(u.l.Na,u.l,u):null;e:{var q=u.i;let Y=-1;for(;;){const Se=["count="+v];Y==-1?0<v?(Y=q[0].g,Se.push("ofs="+Y)):Y=0:Se.push("ofs="+Y);let xt=!0;for(let wn=0;wn<v;wn++){let yt=q[wn].g;const Tn=q[wn].map;if(yt-=Y,0>yt)Y=Math.max(0,q[wn].g-100),xt=!1;else try{da(Tn,Se,"req"+yt+"_")}catch{w&&w(Tn)}}if(xt){w=Se.join("&");break e}}}return u=u.i.splice(0,v),p.D=u,w}function ma(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;ne||De(),ue||(ne(),ue=!0),ie.add(p,u),u.v=0}}function jl(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=gs(g(u.Fa,u),fo(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,ws(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=gs(g(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,bn(10),lo(this),ws(this))};function ga(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function ws(u){u.g=new Vr(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var p=sr(u.qa);Dt(p,"RID","rpc"),Dt(p,"SID",u.K),Dt(p,"AID",u.T),Dt(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&Dt(p,"TO",u.ja),Dt(p,"TYPE","xmlhttp"),co(u,p),u.m&&u.o&&Gt(p,u.m,u.o),u.L&&(u.g.I=u.L);var v=u.g;u=u.ia,v.L=1,v.v=io(sr(p)),v.m=null,v.P=!0,Kr(v,u)}n.Za=function(){this.C!=null&&(this.C=null,lo(this),jl(this),bn(19))};function ci(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function ho(u,p){var v=null;if(u.g==p){ci(u),ga(u),u.g=null;var w=2}else if(Nn(u.h,p))v=p.D,mr(u.h,p),w=1;else return;if(u.G!=0){if(p.o)if(w==1){v=p.m?p.m.length:0,p=Date.now()-p.F;var q=u.B;w=fs(),_e(w,new no(w,v)),ui(u)}else ma(u);else if(q=p.s,q==3||q==0&&0<p.X||!(w==1&&ar(u,p)||w==2&&jl(u)))switch(v&&0<v.length&&(p=u.h,p.i=p.i.concat(v)),q){case 1:Yr(u,5);break;case 4:Yr(u,10);break;case 3:Yr(u,6);break;default:Yr(u,2)}}}function fo(u,p){let v=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(v*=2),v*p}function Yr(u,p){if(u.j.info("Error code "+p),p==2){var v=g(u.fb,u),w=u.Xa;const q=!w;w=new Gr(w||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||ir(w,"https"),io(w),q?oi(w.toString(),v):ai(w.toString(),v)}else bn(2);u.G=0,u.l&&u.l.sa(p),qc(u),uo(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),bn(2)):(this.j.info("Failed to ping google.com"),bn(1))};function qc(u){if(u.G=0,u.ka=[],u.l){const p=Vl(u.h);(p.length!=0||u.i.length!=0)&&(E(u.ka,p),E(u.ka,u.i),u.h.i.length=0,S(u.i),u.i.length=0),u.l.ra()}}function Bc(u,p,v){var w=v instanceof Gr?sr(v):new Gr(v);if(w.g!="")p&&(w.g=p+"."+w.g),la(w,w.s);else{var q=a.location;w=q.protocol,p=p?p+"."+q.hostname:q.hostname,q=+q.port;var Y=new Gr(null);w&&ir(Y,w),p&&(Y.g=p),q&&la(Y,q),v&&(Y.l=v),w=Y}return v=u.D,p=u.ya,v&&p&&Dt(w,v,p),Dt(w,"VER",u.la),co(u,w),w}function ql(u,p,v){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Ca&&!u.pa?new ze(new ha({eb:v})):new ze(u.pa),p.Ha(u.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function va(){}n=va.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function xs(){}xs.prototype.g=function(u,p){return new En(u,p)};function En(u,p){j.call(this),this.g=new Uc(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!F(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!F(p)&&(this.g.D=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new di(this)}I(En,j),En.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},En.prototype.close=function(){Fl(this.g)},En.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var v={};v.__data__=u,u=v}else this.u&&(v={},v.__data__=jt(u),u=v);p.i.push(new Dc(p.Ya++,u)),p.G==3&&ui(p)},En.prototype.N=function(){this.g.l=null,delete this.j,Fl(this.g),delete this.g,En.aa.N.call(this)};function zc(u){vn.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const v in p){u=v;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}I(zc,vn);function Kc(){hs.call(this),this.status=1}I(Kc,hs);function di(u){this.g=u}I(di,va),di.prototype.ua=function(){_e(this.g,"a")},di.prototype.ta=function(u){_e(this.g,new zc(u))},di.prototype.sa=function(u){_e(this.g,new Kc)},di.prototype.ra=function(){_e(this.g,"b")},xs.prototype.createWebChannel=xs.prototype.g,En.prototype.send=En.prototype.o,En.prototype.open=En.prototype.m,En.prototype.close=En.prototype.close,cw=function(){return new xs},uw=function(){return fs()},lw=Nr,_p={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},sa.NO_ERROR=0,sa.TIMEOUT=8,sa.HTTP_ERROR=6,fd=sa,Cc.COMPLETE="complete",aw=Cc,ra.EventType=Jn,Jn.OPEN="a",Jn.CLOSE="b",Jn.ERROR="c",Jn.MESSAGE="d",j.prototype.listen=j.prototype.K,iu=ra,ze.prototype.listenOnce=ze.prototype.L,ze.prototype.getLastError=ze.prototype.Ka,ze.prototype.getLastErrorCode=ze.prototype.Ba,ze.prototype.getStatus=ze.prototype.Z,ze.prototype.getResponseJson=ze.prototype.Oa,ze.prototype.getResponseText=ze.prototype.oa,ze.prototype.send=ze.prototype.ea,ze.prototype.setWithCredentials=ze.prototype.Ha,ow=ze}).apply(typeof Yc<"u"?Yc:typeof self<"u"?self:typeof window<"u"?window:{});const ky="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Pn.UNAUTHENTICATED=new Pn(null),Pn.GOOGLE_CREDENTIALS=new Pn("google-credentials-uid"),Pn.FIRST_PARTY=new Pn("first-party-uid"),Pn.MOCK_USER=new Pn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pl="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $i=new bm("@firebase/firestore");function Sa(){return $i.logLevel}function bB(n){$i.setLogLevel(n)}function fe(n,...e){if($i.logLevel<=ht.DEBUG){const t=e.map(Im);$i.debug(`Firestore (${pl}): ${n}`,...t)}}function dn(n,...e){if($i.logLevel<=ht.ERROR){const t=e.map(Im);$i.error(`Firestore (${pl}): ${n}`,...t)}}function kr(n,...e){if($i.logLevel<=ht.WARN){const t=e.map(Im);$i.warn(`Firestore (${pl}): ${n}`,...t)}}function Im(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ve(n="Unexpected state"){const e=`FIRESTORE (${pl}) INTERNAL ASSERTION FAILED: `+n;throw dn(e),new Error(e)}function Le(n,e){n||Ve()}function wB(n,e){n||Ve()}function Ce(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class pe extends ds{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dw{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class BR{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Pn.UNAUTHENTICATED))}shutdown(){}}class zR{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class KR{constructor(e){this.t=e,this.currentUser=Pn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Le(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new Cn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Cn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{fe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(fe("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Cn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(fe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Le(typeof r.accessToken=="string"),new dw(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Le(e===null||typeof e=="string"),new Pn(e)}}class GR{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Pn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class HR{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new GR(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Pn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class hw{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class WR{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Le(this.o===void 0);const r=i=>{i.error!=null&&fe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,fe("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{fe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):fe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Le(typeof t.token=="string"),this.R=t.token,new hw(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class xB{getToken(){return Promise.resolve(new hw(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QR(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fw{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=QR(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Je(n,e){return n<e?-1:n>e?1:0}function Ha(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function pw(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class en{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new pe(Q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new pe(Q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new pe(Q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new pe(Q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return en.fromMillis(Date.now())}static fromDate(e){return en.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new en(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Je(this.nanoseconds,e.nanoseconds):Je(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qe{constructor(e){this.timestamp=e}static fromTimestamp(e){return new qe(e)}static min(){return new qe(new en(0,0))}static max(){return new qe(new en(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lu{constructor(e,t,r){t===void 0?t=0:t>e.length&&Ve(),r===void 0?r=e.length-t:r>e.length-t&&Ve(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Lu.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Lu?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ft extends Lu{construct(e,t,r){return new ft(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new pe(Q.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new ft(t)}static emptyPath(){return new ft([])}}const JR=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Qt extends Lu{construct(e,t,r){return new Qt(e,t,r)}static isValidIdentifier(e){return JR.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Qt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Qt(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new pe(Q.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new pe(Q.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new pe(Q.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new pe(Q.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Qt(t)}static emptyPath(){return new Qt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ke{constructor(e){this.path=e}static fromPath(e){return new ke(ft.fromString(e))}static fromName(e){return new ke(ft.fromString(e).popFirst(5))}static empty(){return new ke(ft.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ft.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ft.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ke(new ft(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wa{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function bp(n){return n.fields.find(e=>e.kind===2)}function xo(n){return n.fields.filter(e=>e.kind!==2)}function YR(n,e){let t=Je(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=XR(n.fields[r],e.fields[r]),t!==0)return t;return Je(n.fields.length,e.fields.length)}Wa.UNKNOWN_ID=-1;class Vo{constructor(e,t){this.fieldPath=e,this.kind=t}}function XR(n,e){const t=Qt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Je(n.kind,e.kind)}class Qa{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Qa(0,Ir.min())}}function mw(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=qe.fromTimestamp(r===1e9?new en(t+1,0):new en(t,r));return new Ir(s,ke.empty(),e)}function gw(n){return new Ir(n.readTime,n.key,-1)}class Ir{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Ir(qe.min(),ke.empty(),-1)}static max(){return new Ir(qe.max(),ke.empty(),-1)}}function Em(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=ke.comparator(n.documentKey,e.documentKey),t!==0?t:Je(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vw="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class yw{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wi(n){if(n.code!==Q.FAILED_PRECONDITION||n.message!==vw)throw n;fe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ve(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new B((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof B?t:B.resolve(t)}catch(t){return B.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):B.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):B.reject(t)}static resolve(e){return new B((t,r)=>{t(e)})}static reject(e){return new B((t,r)=>{r(e)})}static waitFor(e){return new B((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=B.resolve(!1);for(const r of e)t=t.next(s=>s?B.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new B((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(h=>{o[c]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new B((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xh{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Cn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new _u(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=Tm(r.target.error);this.V.reject(new _u(e,s))}}static open(e,t,r,s){try{return new xh(t,e.transaction(s,r))}catch(i){throw new _u(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(fe("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new eC(t)}}class is{constructor(e,t,r){this.name=e,this.version=t,this.p=r,is.S(xn())===12.2&&dn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return fe("SimpleDb","Removing database:",e),To(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!_m())return!1;if(is.v())return!0;const e=xn(),t=is.S(e),r=0<t&&t<10,s=_w(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(fe("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new _u(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new pe(Q.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new pe(Q.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new _u(e,o))},s.onupgradeneeded=i=>{fe("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{fe("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=xh.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),B.reject(c))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(fe("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function _w(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class ZR{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return To(this.B.delete())}}class _u extends pe{constructor(e,t){super(Q.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Qi(n){return n.name==="IndexedDbTransactionError"}class eC{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(fe("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(fe("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),To(r)}add(e){return fe("SimpleDb","ADD",this.store.name,e,e),To(this.store.add(e))}get(e){return To(this.store.get(e)).next(t=>(t===void 0&&(t=null),fe("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return fe("SimpleDb","DELETE",this.store.name,e),To(this.store.delete(e))}count(){return fe("SimpleDb","COUNT",this.store.name),To(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new B((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new B((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){fe("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new B((r,s)=>{t.onerror=i=>{const o=Tm(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new B((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new ZR(a),c=t(a.primaryKey,a.value,l);if(c instanceof B){const h=c.catch(f=>(l.done(),B.reject(f)));r.push(h)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>B.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function To(n){return new B((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=Tm(r.target.error);t(s)}})}let Dy=!1;function Tm(n){const e=is.S(xn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new pe("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Dy||(Dy=!0,setTimeout(()=>{throw r},0)),r}}return n}class tC{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){fe("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{fe("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){Qi(t)?fe("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await Wi(t)}await this.X(6e4)})}}class nC{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return B.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return fe("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(fe("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=gw(i);Em(o,r)>0&&(r=o)}),new Ir(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}cr.oe=-1;function ac(n){return n==null}function $u(n){return n===0&&1/n==-1/0}function bw(n){return typeof n=="number"&&Number.isInteger(n)&&!$u(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hn(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Ny(e)),e=rC(n.get(t),e);return Ny(e)}function rC(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function Ny(n){return n+""}function ts(n){const e=n.length;if(Le(e>=2),e===2)return Le(n.charAt(0)===""&&n.charAt(1)===""),ft.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&Ve(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:Ve()}i=o+2}return new ft(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vy=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pd(n,e){return[n,Hn(e)]}function ww(n,e,t){return[n,Hn(e),t]}const sC={},iC=["prefixPath","collectionGroup","readTime","documentId"],oC=["prefixPath","collectionGroup","documentId"],aC=["collectionGroup","readTime","prefixPath","documentId"],lC=["canonicalId","targetId"],uC=["targetId","path"],cC=["path","targetId"],dC=["collectionId","parent"],hC=["indexId","uid"],fC=["uid","sequenceNumber"],pC=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],mC=["indexId","uid","orderedDocumentKey"],gC=["userId","collectionPath","documentId"],vC=["userId","collectionPath","largestBatchId"],yC=["userId","collectionGroup","largestBatchId"],xw=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],_C=[...xw,"documentOverlays"],Iw=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Ew=Iw,Am=[...Ew,"indexConfiguration","indexState","indexEntries"],bC=Am,wC=[...Am,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wp extends yw{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function In(n,e){const t=Ce(n);return is.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oy(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ji(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Tw(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function Aw(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ft{constructor(e,t){this.comparator=e,this.root=t||On.EMPTY}insert(e,t){return new Ft(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,On.BLACK,null,null))}remove(e){return new Ft(this.comparator,this.root.remove(e,this.comparator).copy(null,null,On.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Xc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Xc(this.root,e,this.comparator,!1)}getReverseIterator(){return new Xc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Xc(this.root,e,this.comparator,!0)}}class Xc{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class On{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??On.RED,this.left=s??On.EMPTY,this.right=i??On.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new On(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return On.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return On.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,On.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,On.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ve();const e=this.left.check();if(e!==this.right.check())throw Ve();return e+(this.isRed()?0:1)}}On.EMPTY=null,On.RED=!0,On.BLACK=!1;On.EMPTY=new class{constructor(){this.size=0}get key(){throw Ve()}get value(){throw Ve()}get color(){throw Ve()}get left(){throw Ve()}get right(){throw Ve()}copy(e,t,r,s,i){return this}insert(e,t,r){return new On(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kt{constructor(e){this.comparator=e,this.data=new Ft(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new My(this.data.getIterator())}getIteratorFrom(e){return new My(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof kt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new kt(this.comparator);return t.data=e,t}}class My{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function wa(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dr{constructor(e){this.fields=e,e.sort(Qt.comparator)}static empty(){return new dr([])}unionWith(e){let t=new kt(Qt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new dr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ha(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sw extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EB(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class on{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Sw("Invalid base64 string: "+i):i}}(e);return new on(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new on(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Je(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}on.EMPTY_BYTE_STRING=new on("");const xC=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function js(n){if(Le(!!n),typeof n=="string"){let e=0;const t=xC.exec(n);if(Le(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Wt(n.seconds),nanos:Wt(n.nanos)}}function Wt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function qs(n){return typeof n=="string"?on.fromBase64String(n):on.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ih(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Eh(n){const e=n.mapValue.fields.__previous_value__;return Ih(e)?Eh(e):e}function Fu(n){const e=js(n.mapValue.fields.__local_write_time__.timestampValue);return new en(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IC{constructor(e,t,r,s,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class Lo{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Lo("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Lo&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ri={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},md={nullValue:"NULL_VALUE"};function Fi(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Ih(n)?4:Pw(n)?9007199254740991:Th(n)?10:11:Ve()}function cs(n,e){if(n===e)return!0;const t=Fi(n);if(t!==Fi(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Fu(n).isEqual(Fu(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=js(s.timestampValue),a=js(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return qs(s.bytesValue).isEqual(qs(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Wt(s.geoPointValue.latitude)===Wt(i.geoPointValue.latitude)&&Wt(s.geoPointValue.longitude)===Wt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Wt(s.integerValue)===Wt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Wt(s.doubleValue),a=Wt(i.doubleValue);return o===a?$u(o)===$u(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Ha(n.arrayValue.values||[],e.arrayValue.values||[],cs);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(Oy(o)!==Oy(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!cs(o[l],a[l])))return!1;return!0}(n,e);default:return Ve()}}function Uu(n,e){return(n.values||[]).find(t=>cs(t,e))!==void 0}function Ui(n,e){if(n===e)return 0;const t=Fi(n),r=Fi(e);if(t!==r)return Je(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Je(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=Wt(i.integerValue||i.doubleValue),l=Wt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return Ly(n.timestampValue,e.timestampValue);case 4:return Ly(Fu(n),Fu(e));case 5:return Je(n.stringValue,e.stringValue);case 6:return function(i,o){const a=qs(i),l=qs(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const h=Je(a[c],l[c]);if(h!==0)return h}return Je(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Je(Wt(i.latitude),Wt(o.latitude));return a!==0?a:Je(Wt(i.longitude),Wt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return $y(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,c,h;const f=i.fields||{},g=o.fields||{},y=(a=f.value)===null||a===void 0?void 0:a.arrayValue,I=(l=g.value)===null||l===void 0?void 0:l.arrayValue,S=Je(((c=y==null?void 0:y.values)===null||c===void 0?void 0:c.length)||0,((h=I==null?void 0:I.values)===null||h===void 0?void 0:h.length)||0);return S!==0?S:$y(y,I)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Ri.mapValue&&o===Ri.mapValue)return 0;if(i===Ri.mapValue)return 1;if(o===Ri.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},h=Object.keys(c);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const g=Je(l[f],h[f]);if(g!==0)return g;const y=Ui(a[l[f]],c[h[f]]);if(y!==0)return y}return Je(l.length,h.length)}(n.mapValue,e.mapValue);default:throw Ve()}}function Ly(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Je(n,e);const t=js(n),r=js(e),s=Je(t.seconds,r.seconds);return s!==0?s:Je(t.nanos,r.nanos)}function $y(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Ui(t[s],r[s]);if(i)return i}return Je(t.length,r.length)}function Ja(n){return xp(n)}function xp(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=js(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return qs(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return ke.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=xp(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${xp(t.fields[o])}`;return s+"}"}(n.mapValue):Ve()}function gd(n){switch(Fi(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Eh(n);return e?16+gd(e):16;case 5:return 2*n.stringValue.length;case 6:return qs(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+gd(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Ji(r.fields,(i,o)=>{s+=i.length+gd(o)}),s}(n.mapValue);default:throw Ve()}}function $o(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ip(n){return!!n&&"integerValue"in n}function ju(n){return!!n&&"arrayValue"in n}function Fy(n){return!!n&&"nullValue"in n}function Uy(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function vd(n){return!!n&&"mapValue"in n}function Th(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function bu(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Ji(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=bu(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=bu(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Pw(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const Rw={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function EC(n){return"nullValue"in n?md:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?$o(Lo.empty(),ke.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Th(n)?Rw:{mapValue:{}}:Ve()}function TC(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?$o(Lo.empty(),ke.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?Rw:"mapValue"in n?Th(n)?{mapValue:{}}:Ri:Ve()}function jy(n,e){const t=Ui(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function qy(n,e){const t=Ui(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ln{constructor(e){this.value=e}static empty(){return new Ln({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!vd(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=bu(t)}setAll(e){let t=Qt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=bu(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());vd(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return cs(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];vd(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Ji(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Ln(bu(this.value))}}function Cw(n){const e=[];return Ji(n.fields,(t,r)=>{const s=new Qt([t]);if(vd(r)){const i=Cw(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new dr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bt{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Bt(e,0,qe.min(),qe.min(),qe.min(),Ln.empty(),0)}static newFoundDocument(e,t,r,s){return new Bt(e,1,t,qe.min(),r,s,0)}static newNoDocument(e,t){return new Bt(e,2,t,qe.min(),qe.min(),Ln.empty(),0)}static newUnknownDocument(e,t){return new Bt(e,3,t,qe.min(),qe.min(),Ln.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(qe.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ln.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ln.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=qe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Bt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Bt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ji{constructor(e,t){this.position=e,this.inclusive=t}}function By(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=ke.comparator(ke.fromName(o.referenceValue),t.key):r=Ui(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function zy(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!cs(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qu{constructor(e,t="asc"){this.field=e,this.dir=t}}function AC(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kw{}class pt extends kw{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new SC(e,t,r):t==="array-contains"?new CC(e,r):t==="in"?new Lw(e,r):t==="not-in"?new kC(e,r):t==="array-contains-any"?new DC(e,r):new pt(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new PC(e,r):new RC(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Ui(t,this.value)):t!==null&&Fi(this.value)===Fi(t)&&this.matchesComparison(Ui(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ve()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Rt extends kw{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Rt(e,t)}matches(e){return Ya(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Ya(n){return n.op==="and"}function Ep(n){return n.op==="or"}function Sm(n){return Dw(n)&&Ya(n)}function Dw(n){for(const e of n.filters)if(e instanceof Rt)return!1;return!0}function Tp(n){if(n instanceof pt)return n.field.canonicalString()+n.op.toString()+Ja(n.value);if(Sm(n))return n.filters.map(e=>Tp(e)).join(",");{const e=n.filters.map(t=>Tp(t)).join(",");return`${n.op}(${e})`}}function Nw(n,e){return n instanceof pt?function(r,s){return s instanceof pt&&r.op===s.op&&r.field.isEqual(s.field)&&cs(r.value,s.value)}(n,e):n instanceof Rt?function(r,s){return s instanceof Rt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&Nw(o,s.filters[a]),!0):!1}(n,e):void Ve()}function Vw(n,e){const t=n.filters.concat(e);return Rt.create(t,n.op)}function Ow(n){return n instanceof pt?function(t){return`${t.field.canonicalString()} ${t.op} ${Ja(t.value)}`}(n):n instanceof Rt?function(t){return t.op.toString()+" {"+t.getFilters().map(Ow).join(" ,")+"}"}(n):"Filter"}class SC extends pt{constructor(e,t,r){super(e,t,r),this.key=ke.fromName(r.referenceValue)}matches(e){const t=ke.comparator(e.key,this.key);return this.matchesComparison(t)}}class PC extends pt{constructor(e,t){super(e,"in",t),this.keys=Mw("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class RC extends pt{constructor(e,t){super(e,"not-in",t),this.keys=Mw("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Mw(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>ke.fromName(r.referenceValue))}class CC extends pt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ju(t)&&Uu(t.arrayValue,this.value)}}class Lw extends pt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Uu(this.value.arrayValue,t)}}class kC extends pt{constructor(e,t){super(e,"not-in",t)}matches(e){if(Uu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Uu(this.value.arrayValue,t)}}class DC extends pt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ju(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Uu(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NC{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function Ap(n,e=null,t=[],r=[],s=null,i=null,o=null){return new NC(n,e,t,r,s,i,o)}function Fo(n){const e=Ce(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Tp(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),ac(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ja(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ja(r)).join(",")),e.ue=t}return e.ue}function lc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!AC(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Nw(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!zy(n.startAt,e.startAt)&&zy(n.endAt,e.endAt)}function Fd(n){return ke.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Ud(n,e){return n.filters.filter(t=>t instanceof pt&&t.field.isEqual(e))}function Ky(n,e,t){let r=md,s=!0;for(const i of Ud(n,e)){let o=md,a=!0;switch(i.op){case"<":case"<=":o=EC(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=md}jy({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];jy({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function Gy(n,e,t){let r=Ri,s=!0;for(const i of Ud(n,e)){let o=Ri,a=!0;switch(i.op){case">=":case">":o=TC(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Ri}qy({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];qy({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hs{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function $w(n,e,t,r,s,i,o,a){return new Hs(n,e,t,r,s,i,o,a)}function ml(n){return new Hs(n)}function Hy(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Pm(n){return n.collectionGroup!==null}function La(n){const e=Ce(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new kt(Qt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new qu(i,r))}),t.has(Qt.keyField().canonicalString())||e.ce.push(new qu(Qt.keyField(),r))}return e.ce}function Wn(n){const e=Ce(n);return e.le||(e.le=Uw(e,La(n))),e.le}function Fw(n){const e=Ce(n);return e.he||(e.he=Uw(e,n.explicitOrderBy)),e.he}function Uw(n,e){if(n.limitType==="F")return Ap(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new qu(s.field,i)});const t=n.endAt?new ji(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ji(n.startAt.position,n.startAt.inclusive):null;return Ap(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Sp(n,e){const t=n.filters.concat([e]);return new Hs(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function jd(n,e,t){return new Hs(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function uc(n,e){return lc(Wn(n),Wn(e))&&n.limitType===e.limitType}function jw(n){return`${Fo(Wn(n))}|lt:${n.limitType}`}function Pa(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>Ow(s)).join(", ")}]`),ac(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Ja(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Ja(s)).join(",")),`Target(${r})`}(Wn(n))}; limitType=${n.limitType})`}function cc(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):ke.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of La(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=By(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,La(r),s)||r.endAt&&!function(o,a,l){const c=By(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,La(r),s))}(n,e)}function qw(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Bw(n){return(e,t)=>{let r=!1;for(const s of La(n)){const i=VC(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function VC(n,e,t){const r=n.field.isKeyField()?ke.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?Ui(l,c):Ve()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Ve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ws{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Ji(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return Aw(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OC=new Ft(ke.comparator);function hr(){return OC}const zw=new Ft(ke.comparator);function ou(...n){let e=zw;for(const t of n)e=e.insert(t.key,t);return e}function Kw(n){let e=zw;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function ns(){return wu()}function Gw(){return wu()}function wu(){return new Ws(n=>n.toString(),(n,e)=>n.isEqual(e))}const MC=new Ft(ke.comparator),LC=new kt(ke.comparator);function nt(...n){let e=LC;for(const t of n)e=e.add(t);return e}const $C=new kt(Je);function Rm(){return $C}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cm(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:$u(e)?"-0":e}}function Hw(n){return{integerValue:""+n}}function Ww(n,e){return bw(e)?Hw(e):Cm(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ah{constructor(){this._=void 0}}function FC(n,e,t){return n instanceof Xa?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Ih(i)&&(i=Eh(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof Uo?Jw(n,e):n instanceof jo?Yw(n,e):function(s,i){const o=Qw(s,i),a=Wy(o)+Wy(s.Pe);return Ip(o)&&Ip(s.Pe)?Hw(a):Cm(s.serializer,a)}(n,e)}function UC(n,e,t){return n instanceof Uo?Jw(n,e):n instanceof jo?Yw(n,e):t}function Qw(n,e){return n instanceof Za?function(r){return Ip(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Xa extends Ah{}class Uo extends Ah{constructor(e){super(),this.elements=e}}function Jw(n,e){const t=Xw(e);for(const r of n.elements)t.some(s=>cs(s,r))||t.push(r);return{arrayValue:{values:t}}}class jo extends Ah{constructor(e){super(),this.elements=e}}function Yw(n,e){let t=Xw(e);for(const r of n.elements)t=t.filter(s=>!cs(s,r));return{arrayValue:{values:t}}}class Za extends Ah{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Wy(n){return Wt(n.integerValue||n.doubleValue)}function Xw(n){return ju(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dc{constructor(e,t){this.field=e,this.transform=t}}function jC(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof Uo&&s instanceof Uo||r instanceof jo&&s instanceof jo?Ha(r.elements,s.elements,cs):r instanceof Za&&s instanceof Za?cs(r.Pe,s.Pe):r instanceof Xa&&s instanceof Xa}(n.transform,e.transform)}class qC{constructor(e,t){this.version=e,this.transformResults=t}}class Jt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Jt}static exists(e){return new Jt(void 0,e)}static updateTime(e){return new Jt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function yd(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Sh{}function Zw(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new vl(n.key,Jt.none()):new gl(n.key,n.data,Jt.none());{const t=n.data,r=Ln.empty();let s=new kt(Qt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Qs(n.key,r,new dr(s.toArray()),Jt.none())}}function BC(n,e,t){n instanceof gl?function(s,i,o){const a=s.value.clone(),l=Jy(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Qs?function(s,i,o){if(!yd(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=Jy(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(ex(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function xu(n,e,t,r){return n instanceof gl?function(i,o,a,l){if(!yd(i.precondition,o))return a;const c=i.value.clone(),h=Yy(i.fieldTransforms,l,o);return c.setAll(h),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof Qs?function(i,o,a,l){if(!yd(i.precondition,o))return a;const c=Yy(i.fieldTransforms,l,o),h=o.data;return h.setAll(ex(i)),h.setAll(c),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return yd(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function zC(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Qw(r.transform,s||null);i!=null&&(t===null&&(t=Ln.empty()),t.set(r.field,i))}return t||null}function Qy(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Ha(r,s,(i,o)=>jC(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class gl extends Sh{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Qs extends Sh{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function ex(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Jy(n,e,t){const r=new Map;Le(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,UC(o,a,t[s]))}return r}function Yy(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,FC(i,o,e))}return r}class vl extends Sh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class km extends Sh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dm{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&BC(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=xu(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=xu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Gw();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=Zw(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(qe.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),nt())}isEqual(e){return this.batchId===e.batchId&&Ha(this.mutations,e.mutations,(t,r)=>Qy(t,r))&&Ha(this.baseMutations,e.baseMutations,(t,r)=>Qy(t,r))}}class Nm{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Le(e.mutations.length===r.length);let s=function(){return MC}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Nm(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vm{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tx{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KC{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var yn,_t;function nx(n){switch(n){default:return Ve();case Q.CANCELLED:case Q.UNKNOWN:case Q.DEADLINE_EXCEEDED:case Q.RESOURCE_EXHAUSTED:case Q.INTERNAL:case Q.UNAVAILABLE:case Q.UNAUTHENTICATED:return!1;case Q.INVALID_ARGUMENT:case Q.NOT_FOUND:case Q.ALREADY_EXISTS:case Q.PERMISSION_DENIED:case Q.FAILED_PRECONDITION:case Q.ABORTED:case Q.OUT_OF_RANGE:case Q.UNIMPLEMENTED:case Q.DATA_LOSS:return!0}}function rx(n){if(n===void 0)return dn("GRPC error has no .code"),Q.UNKNOWN;switch(n){case yn.OK:return Q.OK;case yn.CANCELLED:return Q.CANCELLED;case yn.UNKNOWN:return Q.UNKNOWN;case yn.DEADLINE_EXCEEDED:return Q.DEADLINE_EXCEEDED;case yn.RESOURCE_EXHAUSTED:return Q.RESOURCE_EXHAUSTED;case yn.INTERNAL:return Q.INTERNAL;case yn.UNAVAILABLE:return Q.UNAVAILABLE;case yn.UNAUTHENTICATED:return Q.UNAUTHENTICATED;case yn.INVALID_ARGUMENT:return Q.INVALID_ARGUMENT;case yn.NOT_FOUND:return Q.NOT_FOUND;case yn.ALREADY_EXISTS:return Q.ALREADY_EXISTS;case yn.PERMISSION_DENIED:return Q.PERMISSION_DENIED;case yn.FAILED_PRECONDITION:return Q.FAILED_PRECONDITION;case yn.ABORTED:return Q.ABORTED;case yn.OUT_OF_RANGE:return Q.OUT_OF_RANGE;case yn.UNIMPLEMENTED:return Q.UNIMPLEMENTED;case yn.DATA_LOSS:return Q.DATA_LOSS;default:return Ve()}}(_t=yn||(yn={}))[_t.OK=0]="OK",_t[_t.CANCELLED=1]="CANCELLED",_t[_t.UNKNOWN=2]="UNKNOWN",_t[_t.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",_t[_t.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",_t[_t.NOT_FOUND=5]="NOT_FOUND",_t[_t.ALREADY_EXISTS=6]="ALREADY_EXISTS",_t[_t.PERMISSION_DENIED=7]="PERMISSION_DENIED",_t[_t.UNAUTHENTICATED=16]="UNAUTHENTICATED",_t[_t.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",_t[_t.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",_t[_t.ABORTED=10]="ABORTED",_t[_t.OUT_OF_RANGE=11]="OUT_OF_RANGE",_t[_t.UNIMPLEMENTED=12]="UNIMPLEMENTED",_t[_t.INTERNAL=13]="INTERNAL",_t[_t.UNAVAILABLE=14]="UNAVAILABLE",_t[_t.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let qd=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sx(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GC=new No([4294967295,4294967295],0);function Xy(n){const e=sx().encode(n),t=new iw;return t.update(e),new Uint8Array(t.digest())}function Zy(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new No([t,r],0),new No([s,i],0)]}class Om{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new au(`Invalid padding: ${t}`);if(r<0)throw new au(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new au(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new au(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=No.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(No.fromNumber(r)));return s.compare(GC)===1&&(s=new No([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=Xy(e),[r,s]=Zy(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Om(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=Xy(e),[r,s]=Zy(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class au extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hc{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,fc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new hc(qe.min(),s,new Ft(Je),hr(),nt())}}class fc{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new fc(r,t,nt(),nt(),nt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _d{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class ix{constructor(e,t){this.targetId=e,this.me=t}}class ox{constructor(e,t,r=on.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class e0{constructor(){this.fe=0,this.ge=n0(),this.pe=on.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=nt(),t=nt(),r=nt();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:Ve()}}),new fc(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=n0()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Le(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class HC{constructor(e){this.Le=e,this.Be=new Map,this.ke=hr(),this.qe=t0(),this.Qe=new Ft(Je)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:Ve()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(Fd(i))if(r===0){const o=new ke(i.path);this.Ue(t,o,Bt.newNoDocument(o,qe.min()))}else Le(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}qd==null||qd.et(function(h,f,g,y,I){var S,E,$,F,M,L;const re={localCacheCount:h,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},W=f.unchangedNames;return W&&(re.bloomFilter={applied:I===0,hashCount:(S=W==null?void 0:W.hashCount)!==null&&S!==void 0?S:0,bitmapLength:(F=($=(E=W==null?void 0:W.bits)===null||E===void 0?void 0:E.bitmap)===null||$===void 0?void 0:$.length)!==null&&F!==void 0?F:0,padding:(L=(M=W==null?void 0:W.bits)===null||M===void 0?void 0:M.padding)!==null&&L!==void 0?L:0,mightContain:x=>{var b;return(b=y==null?void 0:y.mightContain(x))!==null&&b!==void 0&&b}}),re}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=qs(r).toUint8Array()}catch(l){if(l instanceof Sw)return kr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Om(o,s,i)}catch(l){return kr(l instanceof au?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&Fd(a.target)){const l=new ke(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,Bt.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=nt();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Je(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new hc(e,t,this.Qe,this.ke,r);return this.ke=hr(),this.qe=t0(),this.Qe=new Ft(Je),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new e0,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new kt(Je),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||fe("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new e0),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function t0(){return new Ft(ke.comparator)}function n0(){return new Ft(ke.comparator)}const WC=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),QC=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),JC=(()=>({and:"AND",or:"OR"}))();class YC{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Pp(n,e){return n.useProto3Json||ac(e)?e:{value:e}}function el(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ax(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function XC(n,e){return el(n,e.toTimestamp())}function pn(n){return Le(!!n),qe.fromTimestamp(function(t){const r=js(t);return new en(r.seconds,r.nanos)}(n))}function Mm(n,e){return Rp(n,e).canonicalString()}function Rp(n,e){const t=function(s){return new ft(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function lx(n){const e=ft.fromString(n);return Le(yx(e)),e}function Bu(n,e){return Mm(n.databaseId,e.path)}function os(n,e){const t=lx(e);if(t.get(1)!==n.databaseId.projectId)throw new pe(Q.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new pe(Q.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new ke(dx(t))}function ux(n,e){return Mm(n.databaseId,e)}function cx(n){const e=lx(n);return e.length===4?ft.emptyPath():dx(e)}function Cp(n){return new ft(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function dx(n){return Le(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function r0(n,e,t){return{name:Bu(n,e),fields:t.value.mapValue.fields}}function hx(n,e,t){const r=os(n,e.name),s=pn(e.updateTime),i=e.createTime?pn(e.createTime):qe.min(),o=new Ln({mapValue:{fields:e.fields}}),a=Bt.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function ZC(n,e){return"found"in e?function(r,s){Le(!!s.found),s.found.name,s.found.updateTime;const i=os(r,s.found.name),o=pn(s.found.updateTime),a=s.found.createTime?pn(s.found.createTime):qe.min(),l=new Ln({mapValue:{fields:s.found.fields}});return Bt.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){Le(!!s.missing),Le(!!s.readTime);const i=os(r,s.missing),o=pn(s.readTime);return Bt.newNoDocument(i,o)}(n,e):Ve()}function ek(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:Ve()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,h){return c.useProto3Json?(Le(h===void 0||typeof h=="string"),on.fromBase64String(h||"")):(Le(h===void 0||h instanceof Buffer||h instanceof Uint8Array),on.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const h=c.code===void 0?Q.UNKNOWN:rx(c.code);return new pe(h,c.message||"")}(o);t=new ox(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=os(n,r.document.name),i=pn(r.document.updateTime),o=r.document.createTime?pn(r.document.createTime):qe.min(),a=new Ln({mapValue:{fields:r.document.fields}}),l=Bt.newFoundDocument(s,i,o,a),c=r.targetIds||[],h=r.removedTargetIds||[];t=new _d(c,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=os(n,r.document),i=r.readTime?pn(r.readTime):qe.min(),o=Bt.newNoDocument(s,i),a=r.removedTargetIds||[];t=new _d([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=os(n,r.document),i=r.removedTargetIds||[];t=new _d([],i,s,null)}else{if(!("filter"in e))return Ve();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new KC(s,i),a=r.targetId;t=new ix(a,o)}}return t}function zu(n,e){let t;if(e instanceof gl)t={update:r0(n,e.key,e.value)};else if(e instanceof vl)t={delete:Bu(n,e.key)};else if(e instanceof Qs)t={update:r0(n,e.key,e.data),updateMask:ok(e.fieldMask)};else{if(!(e instanceof km))return Ve();t={verify:Bu(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof Xa)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Uo)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof jo)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Za)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw Ve()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:XC(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Ve()}(n,e.precondition)),t}function kp(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?Jt.updateTime(pn(i.updateTime)):i.exists!==void 0?Jt.exists(i.exists):Jt.none()}(e.currentDocument):Jt.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Le(a.setToServerValue==="REQUEST_TIME"),l=new Xa;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new Uo(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new jo(h)}else"increment"in a?l=new Za(o,a.increment):Ve();const c=Qt.fromServerFormat(a.fieldPath);return new dc(c,l)}(n,s)):[];if(e.update){e.update.name;const s=os(n,e.update.name),i=new Ln({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new dr(c.map(h=>Qt.fromServerFormat(h)))}(e.updateMask);return new Qs(s,i,o,t,r)}return new gl(s,i,t,r)}if(e.delete){const s=os(n,e.delete);return new vl(s,t)}if(e.verify){const s=os(n,e.verify);return new km(s,t)}return Ve()}function tk(n,e){return n&&n.length>0?(Le(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?pn(s.updateTime):pn(i);return o.isEqual(qe.min())&&(o=pn(i)),new qC(o,s.transformResults||[])}(t,e))):[]}function fx(n,e){return{documents:[ux(n,e.path)]}}function Ph(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=ux(n,s);const i=function(c){if(c.length!==0)return vx(Rt.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(h=>function(g){return{field:wi(g.field),direction:rk(g.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Pp(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function px(n,e,t,r){const{_t:s,parent:i}=Ph(n,e),o={},a=[];let l=0;return t.forEach(c=>{const h=r?c.alias:"aggregate_"+l++;o[h]=c.alias,c.aggregateType==="count"?a.push({alias:h,count:{}}):c.aggregateType==="avg"?a.push({alias:h,avg:{field:wi(c.fieldPath)}}):c.aggregateType==="sum"&&a.push({alias:h,sum:{field:wi(c.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function mx(n){let e=cx(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Le(r===1);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const g=gx(f);return g instanceof Rt&&Sm(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(I){return new qu(Ra(I.field),function(E){switch(E){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(I.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,ac(g)?null:g}(t.limit));let l=null;t.startAt&&(l=function(f){const g=!!f.before,y=f.values||[];return new ji(y,g)}(t.startAt));let c=null;return t.endAt&&(c=function(f){const g=!f.before,y=f.values||[];return new ji(y,g)}(t.endAt)),$w(e,s,o,i,a,"F",l,c)}function nk(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ve()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function gx(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Ra(t.unaryFilter.field);return pt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Ra(t.unaryFilter.field);return pt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Ra(t.unaryFilter.field);return pt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Ra(t.unaryFilter.field);return pt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Ve()}}(n):n.fieldFilter!==void 0?function(t){return pt.create(Ra(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ve()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Rt.create(t.compositeFilter.filters.map(r=>gx(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Ve()}}(t.compositeFilter.op))}(n):Ve()}function rk(n){return WC[n]}function sk(n){return QC[n]}function ik(n){return JC[n]}function wi(n){return{fieldPath:n.canonicalString()}}function Ra(n){return Qt.fromServerFormat(n.fieldPath)}function vx(n){return n instanceof pt?function(t){if(t.op==="=="){if(Uy(t.value))return{unaryFilter:{field:wi(t.field),op:"IS_NAN"}};if(Fy(t.value))return{unaryFilter:{field:wi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Uy(t.value))return{unaryFilter:{field:wi(t.field),op:"IS_NOT_NAN"}};if(Fy(t.value))return{unaryFilter:{field:wi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:wi(t.field),op:sk(t.op),value:t.value}}}(n):n instanceof Rt?function(t){const r=t.getFilters().map(s=>vx(s));return r.length===1?r[0]:{compositeFilter:{op:ik(t.op),filters:r}}}(n):Ve()}function ok(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function yx(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rs{constructor(e,t,r,s,i=qe.min(),o=qe.min(),a=on.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Rs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Rs(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Rs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Rs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _x{constructor(e){this.ct=e}}function ak(n,e){let t;if(e.document)t=hx(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=ke.fromSegments(e.noDocument.path),s=Bo(e.noDocument.readTime);t=Bt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Ve();{const r=ke.fromSegments(e.unknownDocument.path),s=Bo(e.unknownDocument.version);t=Bt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new en(s[0],s[1]);return qe.fromTimestamp(i)}(e.readTime)),t}function s0(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Bd(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:Bu(i,o.key),fields:o.data.value.mapValue.fields,updateTime:el(i,o.version.toTimestamp()),createTime:el(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:qo(e.version)};else{if(!e.isUnknownDocument())return Ve();r.unknownDocument={path:t.path.toArray(),version:qo(e.version)}}return r}function Bd(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function qo(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Bo(n){const e=new en(n.seconds,n.nanoseconds);return qe.fromTimestamp(e)}function Ao(n,e){const t=(e.baseMutations||[]).map(i=>kp(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>kp(n.ct,i)),s=en.fromMillis(e.localWriteTimeMs);return new Dm(e.batchId,s,t,r)}function lu(n){const e=Bo(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Bo(n.lastLimboFreeSnapshotVersion):qe.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return Le(i.documents.length===1),Wn(ml(cx(i.documents[0])))}(n.query):function(i){return Wn(mx(i))}(n.query),new Rs(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,on.fromBase64String(n.resumeToken))}function bx(n,e){const t=qo(e.snapshotVersion),r=qo(e.lastLimboFreeSnapshotVersion);let s;s=Fd(e.target)?fx(n.ct,e.target):Ph(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Fo(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Lm(n){const e=mx({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?jd(e,e.limit,"L"):e}function $f(n,e){return new Vm(e.largestBatchId,kp(n.ct,e.overlayMutation))}function i0(n,e){const t=e.path.lastSegment();return[n,Hn(e.path.popLast()),t]}function o0(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:qo(r.readTime),documentKey:Hn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lk{getBundleMetadata(e,t){return a0(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:Bo(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return a0(e).put(function(s){return{bundleId:s.id,createTime:qo(pn(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return l0(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Lm(i.bundledQuery),readTime:Bo(i.readTime)}}(r)})}saveNamedQuery(e,t){return l0(e).put(function(s){return{name:s.name,readTime:qo(pn(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function a0(n){return In(n,"bundles")}function l0(n){return In(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rh{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new Rh(e,r)}getOverlay(e,t){return Ql(e).get(i0(this.userId,t)).next(r=>r?$f(this.serializer,r):null)}getOverlays(e,t){const r=ns();return B.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Vm(t,o);s.push(this.ht(e,a))}),B.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(Hn(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(Ql(e).j("collectionPathOverlayIndex",a))}),B.waitFor(i)}getOverlaysForCollection(e,t,r){const s=ns(),i=Hn(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Ql(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=$f(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=ns();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Ql(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,h)=>{const f=$f(this.serializer,c);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}ht(e,t){return Ql(e).put(function(s,i,o){const[a,l,c]=i0(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:zu(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function Ql(n){return In(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uk{Pt(e){return In(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?on.fromUint8Array(r):on.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class So{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Wt(e.integerValue));else if("doubleValue"in e){const r=Wt(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),$u(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=js(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(qs(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?Pw(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Th(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Ve()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(Wt(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),ke.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}So.vt=new So;function ck(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function u0(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=ck(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class dk{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=u0(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=u0(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class hk{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class fk{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class Jl{constructor(){this.jt=new dk,this.Ht=new hk(this.jt),this.Jt=new fk(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Po{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Po(this.indexId,this.documentKey,this.arrayValue,r)}}function pi(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=c0(n.arrayValue,e.arrayValue),t!==0?t:(t=c0(n.directionalValue,e.directionalValue),t!==0?t:ke.comparator(n.documentKey,e.documentKey)))}function c0(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d0{constructor(e){this.Xt=new kt((t,r)=>Qt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Le(e.collectionGroup===this.collectionId),this.nn)return!1;const t=bp(e);if(t!==void 0&&!this.sn(t))return!1;const r=xo(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new kt(Qt.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Vo(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Vo(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Vo(r.field,r.dir==="asc"?0:1)));return new Wa(Wa.UNKNOWN_ID,this.collectionId,t,Qa.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wx(n){var e,t;if(Le(n instanceof pt||n instanceof Rt),n instanceof pt){if(n instanceof Lw){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>pt.create(n.field,"==",i)))||[];return Rt.create(s,"or")}return n}const r=n.filters.map(s=>wx(s));return Rt.create(r,n.op)}function pk(n){if(n.getFilters().length===0)return[];const e=Vp(wx(n));return Le(xx(e)),Dp(e)||Np(e)?[e]:e.getFilters()}function Dp(n){return n instanceof pt}function Np(n){return n instanceof Rt&&Sm(n)}function xx(n){return Dp(n)||Np(n)||function(t){if(t instanceof Rt&&Ep(t)){for(const r of t.getFilters())if(!Dp(r)&&!Np(r))return!1;return!0}return!1}(n)}function Vp(n){if(Le(n instanceof pt||n instanceof Rt),n instanceof pt)return n;if(n.filters.length===1)return Vp(n.filters[0]);const e=n.filters.map(r=>Vp(r));let t=Rt.create(e,n.op);return t=zd(t),xx(t)?t:(Le(t instanceof Rt),Le(Ya(t)),Le(t.filters.length>1),t.filters.reduce((r,s)=>$m(r,s)))}function $m(n,e){let t;return Le(n instanceof pt||n instanceof Rt),Le(e instanceof pt||e instanceof Rt),t=n instanceof pt?e instanceof pt?function(s,i){return Rt.create([s,i],"and")}(n,e):h0(n,e):e instanceof pt?h0(e,n):function(s,i){if(Le(s.filters.length>0&&i.filters.length>0),Ya(s)&&Ya(i))return Vw(s,i.getFilters());const o=Ep(s)?s:i,a=Ep(s)?i:s,l=o.filters.map(c=>$m(c,a));return Rt.create(l,"or")}(n,e),zd(t)}function h0(n,e){if(Ya(e))return Vw(e,n.getFilters());{const t=e.filters.map(r=>$m(n,r));return Rt.create(t,"or")}}function zd(n){if(Le(n instanceof pt||n instanceof Rt),n instanceof pt)return n;const e=n.getFilters();if(e.length===1)return zd(e[0]);if(Dw(n))return n;const t=e.map(s=>zd(s)),r=[];return t.forEach(s=>{s instanceof pt?r.push(s):s instanceof Rt&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Rt.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mk{constructor(){this.un=new Fm}addToCollectionParentIndex(e,t){return this.un.add(t),B.resolve()}getCollectionParents(e,t){return B.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return B.resolve()}deleteFieldIndex(e,t){return B.resolve()}deleteAllFieldIndexes(e){return B.resolve()}createTargetIndexes(e,t){return B.resolve()}getDocumentsMatchingTarget(e,t){return B.resolve(null)}getIndexType(e,t){return B.resolve(0)}getFieldIndexes(e,t){return B.resolve([])}getNextCollectionGroupToUpdate(e){return B.resolve(null)}getMinOffset(e,t){return B.resolve(Ir.min())}getMinOffsetFromCollectionGroup(e,t){return B.resolve(Ir.min())}updateCollectionGroup(e,t,r){return B.resolve()}updateIndexEntries(e,t){return B.resolve()}}class Fm{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new kt(ft.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new kt(ft.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zc=new Uint8Array(0);class gk{constructor(e,t){this.databaseId=t,this.cn=new Fm,this.ln=new Ws(r=>Fo(r),(r,s)=>lc(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:Hn(s)};return f0(e).put(i)}return B.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[pw(t),""],!1,!0);return f0(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(ts(o.parent))}return r})}addFieldIndex(e,t){const r=Yl(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Ia(e);return i.next(a=>{o.put(o0(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=Yl(e),s=Ia(e),i=xa(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Yl(e),r=xa(e),s=Ia(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return B.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new d0(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=xa(e);let s=!0;const i=new Map;return B.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=nt();const a=[];return B.forEach(i,(l,c)=>{fe("IndexedDbIndexManager",`Using index ${function(M){return`id=${M.indexId}|cg=${M.collectionGroup}|f=${M.fields.map(L=>`${L.fieldPath}:${L.kind}`).join(",")}`}(l)} to execute ${Fo(t)}`);const h=function(M,L){const re=bp(L);if(re===void 0)return null;for(const W of Ud(M,re.fieldPath))switch(W.op){case"array-contains-any":return W.value.arrayValue.values||[];case"array-contains":return[W.value]}return null}(c,l),f=function(M,L){const re=new Map;for(const W of xo(L))for(const x of Ud(M,W.fieldPath))switch(x.op){case"==":case"in":re.set(W.fieldPath.canonicalString(),x.value);break;case"not-in":case"!=":return re.set(W.fieldPath.canonicalString(),x.value),Array.from(re.values())}return null}(c,l),g=function(M,L){const re=[];let W=!0;for(const x of xo(L)){const b=x.kind===0?Ky(M,x.fieldPath,M.startAt):Gy(M,x.fieldPath,M.startAt);re.push(b.value),W&&(W=b.inclusive)}return new ji(re,W)}(c,l),y=function(M,L){const re=[];let W=!0;for(const x of xo(L)){const b=x.kind===0?Gy(M,x.fieldPath,M.endAt):Ky(M,x.fieldPath,M.endAt);re.push(b.value),W&&(W=b.inclusive)}return new ji(re,W)}(c,l),I=this.In(l,c,g),S=this.In(l,c,y),E=this.Tn(l,c,f),$=this.En(l.indexId,h,I,g.inclusive,S,y.inclusive,E);return B.forEach($,F=>r.G(F,t.limit).next(M=>{M.forEach(L=>{const re=ke.fromSegments(L.documentKey);o.has(re)||(o=o.add(re),a.push(re))})}))}).next(()=>a)}return B.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=pk(Rt.create(e.filters,"and")).map(r=>Ap(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),c=l/(t!=null?t.length:1),h=[];for(let f=0;f<l;++f){const g=t?this.dn(t[f/c]):Zc,y=this.An(e,g,r[f%c],s),I=this.Rn(e,g,i[f%c],o),S=a.map(E=>this.An(e,g,E,!0));h.push(...this.createRange(y,I,S))}return h}An(e,t,r,s){const i=new Po(e,ke.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new Po(e,ke.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new d0(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return B.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new kt(Qt.comparator),h=!1;for(const f of l.filters)for(const g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?h=!0:c=c.add(g.field));for(const f of l.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new Jl;for(const s of xo(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);So.vt.It(i,o)}return r.zt()}dn(e){const t=new Jl;return So.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new Jl;return So.vt.It($o(this.databaseId,t),r.Yt(function(i){const o=xo(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new Jl);let i=0;for(const o of xo(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&ju(a))s=this.gn(s,o,a);else{const c=l.Yt(o.kind);So.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new Jl;l.seed(a.zt()),So.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof pt&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=Yl(e),s=Ia(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return B.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(h,f){const g=f?new Qa(f.sequenceNumber,new Ir(Bo(f.readTime),new ke(ts(f.documentKey)),f.largestBatchId)):Qa.empty(),y=h.fields.map(([I,S])=>new Vo(Qt.fromServerFormat(I),S));return new Wa(h.indexId,h.collectionGroup,y,g)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Je(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=Yl(e),i=Ia(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>B.forEach(a,l=>i.put(o0(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return B.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?B.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),B.forEach(a,l=>this.wn(e,s,l).next(c=>{const h=this.Sn(i,l);return c.isEqual(h)?B.resolve():this.bn(e,i,l,c,h)}))))})}Dn(e,t,r,s){return xa(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return xa(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=xa(e);let i=new kt(pi);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new Po(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new kt(pi);const s=this.Vn(t,e);if(s==null)return r;const i=bp(t);if(i!=null){const o=e.data.field(i.fieldPath);if(ju(o))for(const a of o.arrayValue.values||[])r=r.add(new Po(t.indexId,e.key,this.dn(a),s))}else r=r.add(new Po(t.indexId,e.key,Zc,s));return r}bn(e,t,r,s,i){fe("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,c,h,f,g){const y=l.getIterator(),I=c.getIterator();let S=wa(y),E=wa(I);for(;S||E;){let $=!1,F=!1;if(S&&E){const M=h(S,E);M<0?F=!0:M>0&&($=!0)}else S!=null?F=!0:$=!0;$?(f(E),E=wa(I)):F?(g(S),S=wa(y)):(S=wa(y),E=wa(I))}}(s,i,pi,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),B.waitFor(o)}yn(e){let t=1;return Ia(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>pi(o,a)).filter((o,a,l)=>!a||pi(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=pi(o,e),l=pi(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Zc,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Zc,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return pi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(p0)}getMinOffset(e,t){return B.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||Ve())).next(p0)}}function f0(n){return In(n,"collectionParents")}function xa(n){return In(n,"indexEntries")}function Yl(n){return In(n,"indexConfiguration")}function Ia(n){return In(n,"indexState")}function p0(n){Le(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Em(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Ir(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m0={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Bn{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Bn(e,Bn.DEFAULT_COLLECTION_PERCENTILE,Bn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ix(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(h,f,g)=>(a++,g.delete()));i.push(l.next(()=>{Le(a===1)}));const c=[];for(const h of t.mutations){const f=ww(e,h.key.path,t.batchId);i.push(s.delete(f)),c.push(h.key)}return B.waitFor(i).next(()=>c)}function Kd(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Ve();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Bn.DEFAULT_COLLECTION_PERCENTILE=10,Bn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Bn.DEFAULT=new Bn(41943040,Bn.DEFAULT_COLLECTION_PERCENTILE,Bn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Bn.DISABLED=new Bn(-1,0,0);class Ch{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){Le(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new Ch(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return mi(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Ca(e),o=mi(e);return o.add({}).next(a=>{Le(typeof a=="number");const l=new Dm(a,t,r,s),c=function(y,I,S){const E=S.baseMutations.map(F=>zu(y.ct,F)),$=S.mutations.map(F=>zu(y.ct,F));return{userId:I,batchId:S.batchId,localWriteTimeMs:S.localWriteTime.toMillis(),baseMutations:E,mutations:$}}(this.serializer,this.userId,l),h=[];let f=new kt((g,y)=>Je(g.canonicalString(),y.canonicalString()));for(const g of s){const y=ww(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),h.push(o.put(c)),h.push(i.put(y,sC))}return f.forEach(g=>{h.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),B.waitFor(h).next(()=>l)})}lookupMutationBatch(e,t){return mi(e).get(t).next(r=>r?(Le(r.userId===this.userId),Ao(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?B.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return mi(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(Le(a.batchId>=r),i=Ao(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return mi(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return mi(e).U("userMutationsIndex",t).next(r=>r.map(s=>Ao(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=pd(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Ca(e).J({range:s},(o,a,l)=>{const[c,h,f]=o,g=ts(h);if(c===this.userId&&t.path.isEqual(g))return mi(e).get(f).next(y=>{if(!y)throw Ve();Le(y.userId===this.userId),i.push(Ao(this.serializer,y))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new kt(Je);const s=[];return t.forEach(i=>{const o=pd(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Ca(e).J({range:a},(c,h,f)=>{const[g,y,I]=c,S=ts(y);g===this.userId&&i.path.isEqual(S)?r=r.add(I):f.done()});s.push(l)}),B.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=pd(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new kt(Je);return Ca(e).J({range:o},(l,c,h)=>{const[f,g,y]=l,I=ts(g);f===this.userId&&r.isPrefixOf(I)?I.length===s&&(a=a.add(y)):h.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(mi(e).get(i).next(o=>{if(o===null)throw Ve();Le(o.userId===this.userId),r.push(Ao(this.serializer,o))}))}),B.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return Ix(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),B.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return B.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Ca(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=ts(i[1]);s.push(l)}else a.done()}).next(()=>{Le(s.length===0)})})}containsKey(e,t){return Ex(e,this.userId,t)}Nn(e){return Tx(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Ex(n,e,t){const r=pd(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Ca(n).J({range:i,H:!0},(a,l,c)=>{const[h,f,g]=a;h===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function mi(n){return In(n,"mutations")}function Ca(n){return In(n,"documentMutations")}function Tx(n){return In(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zo{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new zo(0)}static kn(){return new zo(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vk{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new zo(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>qe.fromTimestamp(new en(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ea(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Le(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Ea(e).J((o,a)=>{const l=lu(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>B.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Ea(e).J((r,s)=>{const i=lu(s);t(i)})}qn(e){return g0(e).get("targetGlobalKey").next(t=>(Le(t!==null),t))}Qn(e,t){return g0(e).put("targetGlobalKey",t)}Kn(e,t){return Ea(e).put(bx(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Fo(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Ea(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const c=lu(a);lc(t,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=xi(e);return t.forEach(o=>{const a=Hn(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),B.waitFor(s)}removeMatchingKeys(e,t,r){const s=xi(e);return B.forEach(t,i=>{const o=Hn(i.path);return B.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=xi(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=xi(e);let i=nt();return s.J({range:r,H:!0},(o,a,l)=>{const c=ts(o[1]),h=new ke(c);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=Hn(t.path),s=IDBKeyRange.bound([r],[pw(r)],!1,!0);let i=0;return xi(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return Ea(e).get(t).next(r=>r?lu(r):null)}}function Ea(n){return In(n,"targets")}function g0(n){return In(n,"targetGlobal")}function xi(n){return In(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v0([n,e],[t,r]){const s=Je(n,t);return s===0?Je(e,r):s}class yk{constructor(e){this.Un=e,this.buffer=new kt(v0),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();v0(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Ax{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){fe("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Qi(t)?fe("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Wi(t)}await this.Hn(3e5)})}}class _k{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return B.resolve(cr.oe);const r=new yk(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(fe("LruGarbageCollector","Garbage collection skipped; disabled"),B.resolve(m0)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(fe("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),m0):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,c;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(fe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),Sa()<=ht.DEBUG&&fe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(c-l)+`ms
Total Duration: ${c-h}ms`),B.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function Sx(n,e){return new _k(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bk{constructor(e,t){this.db=e,this.garbageCollector=Sx(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return ed(e,r)}removeReference(e,t,r){return ed(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return ed(e,t)}nr(e,t){return function(s,i){let o=!1;return Tx(s).Y(a=>Ex(s,a,i).next(l=>(l&&(o=!0),B.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,qe.min()),xi(e).delete(function(f){return[0,Hn(f.path)]}(o))))});s.push(l)}}).next(()=>B.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return ed(e,t)}tr(e,t){const r=xi(e);let s,i=cr.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==cr.oe&&t(new ke(ts(s)),i),i=c,s=l):i=cr.oe}).next(()=>{i!==cr.oe&&t(new ke(ts(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ed(n,e){return xi(n).put(function(r,s){return{targetId:0,path:Hn(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Px{constructor(){this.changes=new Ws(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Bt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?B.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return _o(e).put(r)}removeEntry(e,t,r){return _o(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Bd(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=Bt.newInvalidDocument(t);return _o(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Xl(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:Bt.newInvalidDocument(t)};return _o(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Xl(t))},(s,i)=>{r={document:this.ir(t,i),size:Kd(i)}}).next(()=>r)}getEntries(e,t){let r=hr();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=hr(),s=new Ft(ke.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,Kd(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return B.resolve();let s=new kt(b0);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(Xl(s.first()),Xl(s.last())),o=s.getIterator();let a=o.getNext();return _o(e).J({index:"documentKeyIndex",range:i},(l,c,h)=>{const f=ke.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&b0(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?h.$(Xl(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Bd(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return _o(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let h=hr();for(const f of c){const g=this.ir(ke.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&(cc(t,g)||s.has(g.key))&&(h=h.insert(g.key,g))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=hr();const o=_0(t,r),a=_0(t,Ir.max());return _o(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,h)=>{const f=this.ir(ke.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new xk(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return y0(e).get("remoteDocumentGlobalKey").next(t=>(Le(!!t),t))}rr(e,t){return y0(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=ak(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(qe.min())))return r}return Bt.newInvalidDocument(e)}}function Rx(n){return new wk(n)}class xk extends Px{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Ws(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new kt((i,o)=>Je(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=s0(this.cr.serializer,o);s=s.add(i.path.popLast());const c=Kd(l);r+=c-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=s0(this.cr.serializer,o.convertToNoDocument(qe.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),B.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function y0(n){return In(n,"remoteDocumentGlobal")}function _o(n){return In(n,"remoteDocumentsV14")}function Xl(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function _0(n,e){const t=e.documentKey.path.toArray();return[n,Bd(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function b0(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Je(t[i],r[i]),s)return s;return s=Je(t.length,r.length),s||(s=Je(t[t.length-2],r[r.length-2]),s||Je(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ik{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cx{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&xu(r.mutation,s,dr.empty(),en.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,nt()).next(()=>r))}getLocalViewOfDocuments(e,t,r=nt()){const s=ns();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=ou();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=ns();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,nt()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=hr();const o=wu(),a=function(){return wu()}();return t.forEach((l,c)=>{const h=r.get(c.key);s.has(c.key)&&(h===void 0||h.mutation instanceof Qs)?i=i.insert(c.key,c):h!==void 0?(o.set(c.key,h.mutation.getFieldMask()),xu(h.mutation,c,h.mutation.getFieldMask(),en.now())):o.set(c.key,dr.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,h)=>o.set(c,h)),t.forEach((c,h)=>{var f;return a.set(c,new Ik(h,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=wu();let s=new Ft((o,a)=>o-a),i=nt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let h=r.get(l)||dr.empty();h=a.applyToLocalView(c,h),r.set(l,h);const f=(s.get(a.batchId)||nt()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,h=l.value,f=Gw();h.forEach(g=>{if(!i.has(g)){const y=Zw(t.get(g),r.get(g));y!==null&&f.set(g,y),i=i.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return B.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return ke.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Pm(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):B.resolve(ns());let a=-1,l=i;return o.next(c=>B.forEach(c,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?B.resolve():this.remoteDocumentCache.getEntry(e,h).next(g=>{l=l.insert(h,g)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,nt())).next(h=>({batchId:a,changes:Kw(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ke(t)).next(r=>{let s=ou();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=ou();return this.indexManager.getCollectionParents(e,i).next(a=>B.forEach(a,l=>{const c=function(f,g){return new Hs(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(h=>{h.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const h=c.getKey();o.get(h)===null&&(o=o.insert(h,Bt.newInvalidDocument(h)))});let a=ou();return o.forEach((l,c)=>{const h=i.get(l);h!==void 0&&xu(h.mutation,c,dr.empty(),en.now()),cc(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ek{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return B.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:pn(s.createTime)}}(t)),B.resolve()}getNamedQuery(e,t){return B.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:Lm(s.bundledQuery),readTime:pn(s.readTime)}}(t)),B.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tk{constructor(){this.overlays=new Ft(ke.comparator),this.Ir=new Map}getOverlay(e,t){return B.resolve(this.overlays.get(t))}getOverlays(e,t){const r=ns();return B.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),B.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),B.resolve()}getOverlaysForCollection(e,t,r){const s=ns(),i=t.length+1,o=new ke(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return B.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Ft((c,h)=>c-h);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let h=i.get(c.largestBatchId);h===null&&(h=ns(),i=i.insert(c.largestBatchId,h)),h.set(c.getKey(),c)}}const a=ns(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,h)=>a.set(c,h)),!(a.size()>=s)););return B.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Vm(t,r));let i=this.Ir.get(t);i===void 0&&(i=nt(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ak{constructor(){this.sessionToken=on.EMPTY_BYTE_STRING}getSessionToken(e){return B.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,B.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Um{constructor(){this.Tr=new kt(Sn.Er),this.dr=new kt(Sn.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new Sn(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new Sn(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new ke(new ft([])),r=new Sn(t,e),s=new Sn(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new ke(new ft([])),r=new Sn(t,e),s=new Sn(t,e+1);let i=nt();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Sn(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Sn{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return ke.comparator(e.key,t.key)||Je(e.wr,t.wr)}static Ar(e,t){return Je(e.wr,t.wr)||ke.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sk{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new kt(Sn.Er)}checkEmpty(e){return B.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Dm(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new Sn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return B.resolve(o)}lookupMutationBatch(e,t){return B.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return B.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return B.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return B.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Sn(t,0),s=new Sn(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),B.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new kt(Je);return t.forEach(s=>{const i=new Sn(s,0),o=new Sn(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),B.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;ke.isDocumentKey(i)||(i=i.child(""));const o=new Sn(new ke(i),0);let a=new kt(Je);return this.br.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.wr)),!0)},o),B.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Le(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return B.forEach(t.mutations,s=>{const i=new Sn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new Sn(t,0),s=this.br.firstAfterOrEqual(r);return B.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,B.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pk{constructor(e){this.Mr=e,this.docs=function(){return new Ft(ke.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return B.resolve(r?r.document.mutableCopy():Bt.newInvalidDocument(t))}getEntries(e,t){let r=hr();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Bt.newInvalidDocument(s))}),B.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=hr();const o=t.path,a=new ke(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:h}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Em(gw(h),r)<=0||(s.has(h.key)||cc(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return B.resolve(i)}getAllFromCollectionGroup(e,t,r,s){Ve()}Or(e,t){return B.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Rk(this)}getSize(e){return B.resolve(this.size)}}class Rk extends Px{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),B.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ck{constructor(e){this.persistence=e,this.Nr=new Ws(t=>Fo(t),lc),this.lastRemoteSnapshotVersion=qe.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Um,this.targetCount=0,this.kr=zo.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),B.resolve()}getLastRemoteSnapshotVersion(e){return B.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return B.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),B.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),B.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new zo(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,B.resolve()}updateTargetData(e,t){return this.Kn(t),B.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,B.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),B.waitFor(i).next(()=>s)}getTargetCount(e){return B.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return B.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),B.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),B.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),B.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return B.resolve(r)}containsKey(e,t){return B.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jm{constructor(e,t){this.qr={},this.overlays={},this.Qr=new cr(0),this.Kr=!1,this.Kr=!0,this.$r=new Ak,this.referenceDelegate=e(this),this.Ur=new Ck(this),this.indexManager=new mk,this.remoteDocumentCache=function(s){return new Pk(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new _x(t),this.Gr=new Ek(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Tk,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new Sk(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){fe("MemoryPersistence","Starting transaction:",e);const s=new kk(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return B.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class kk extends yw{constructor(e){super(),this.currentSequenceNumber=e}}class kh{constructor(e){this.persistence=e,this.Jr=new Um,this.Yr=null}static Zr(e){return new kh(e)}get Xr(){if(this.Yr)return this.Yr;throw Ve()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),B.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),B.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),B.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return B.forEach(this.Xr,r=>{const s=ke.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,qe.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return B.or([()=>B.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class Gd{constructor(e,t){this.persistence=e,this.ti=new Ws(r=>Hn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=Sx(this,t)}static Zr(e,t){return new Gd(e,t)}zr(){}jr(e){return B.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return B.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?B.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,qe.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),B.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),B.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),B.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),B.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=gd(e.data.value)),t}nr(e,t,r){return B.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return B.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dk{constructor(e){this.serializer=e}O(e,t,r,s){const i=new xh("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Vy,{unique:!0}),l.createObjectStore("documentMutations")}(e),w0(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=B.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),w0(e)),o=o.next(()=>function(l){const c=l.store("targetGlobal"),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:qe.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store("mutations").U().next(h=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Vy,{unique:!0});const f=c.store("mutations"),g=h.map(y=>f.put(y));return B.waitFor(g)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore("documentOverlays",{keyPath:gC});c.createIndex("collectionPathOverlayIndex",vC,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",yC,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore("remoteDocumentsV14",{keyPath:iC});c.createIndex("documentKeyIndex",oC),c.createIndex("collectionGroupIndex",aC)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:hC}).createIndex("sequenceNumberIndex",fC,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:pC}).createIndex("documentKeyIndex",mC,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=Kd(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>B.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>B.forEach(a,l=>{Le(l.userId===i.userId);const c=Ao(this.serializer,l);return Ix(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new ft(o),c=function(f){return[0,Hn(f)]}(l);i.push(t.get(c).next(h=>h?B.resolve():(f=>t.put({targetId:0,path:Hn(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>B.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:dC});const r=t.store("collectionParents"),s=new Fm,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Hn(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new ft(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],c)=>{const h=ts(a);return i(h.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=lu(s),o=bx(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new ke(ft.fromString(f.document.name).popFirst(5)):f.noDocument?ke.fromSegments(f.noDocument.path):f.unknownDocument?ke.fromSegments(f.unknownDocument.path):Ve()}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>B.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=Rx(this.serializer),i=new jm(kh.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var c;let h=(c=a.get(l.userId))!==null&&c!==void 0?c:nt();Ao(this.serializer,l).keys().forEach(f=>h=h.add(f)),a.set(l.userId,h)}),B.forEach(a,(l,c)=>{const h=new Pn(c),f=Rh.lt(this.serializer,h),g=i.getIndexManager(h),y=Ch.lt(h,this.serializer,g,i.referenceDelegate);return new Cx(s,y,f,g).recalculateAndSaveOverlaysForDocumentKeys(new wp(t,cr.oe),l).next()})})}}function w0(n){n.createObjectStore("targetDocuments",{keyPath:uC}).createIndex("documentTargetsIndex",cC,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",lC,{unique:!0}),n.createObjectStore("targetGlobal")}const Ff="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class qm{constructor(e,t,r,s,i,o,a,l,c,h,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=h,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=g=>Promise.resolve(),!qm.D())throw new pe(Q.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new bk(this,s),this.Ai=t+"main",this.serializer=new _x(l),this.Ri=new is(this.Ai,this.hi,new Dk(this.serializer)),this.$r=new uk,this.Ur=new vk(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Rx(this.serializer),this.Gr=new lk,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,h===!1&&dn("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new pe(Q.FAILED_PRECONDITION,Ff);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new cr(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>td(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Qi(e))return fe("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return fe("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Zl(e).get("owner").next(t=>B.resolve(this.vi(t)))}Ci(e){return td(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=In(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return B.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?B.resolve(!0):Zl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new pe(Q.FAILED_PRECONDITION,Ff);return!1}}return!(!this.networkEnabled||!this.inForeground)||td(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&fe("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new wp(e,cr.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>td(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Ch.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new gk(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Rh.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){fe("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?wC:l===16?bC:l===15?Am:l===14?Ew:l===13?Iw:l===12?_C:l===11?xw:void Ve()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new wp(a,this.Qr?this.Qr.next():cr.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw dn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new pe(Q.FAILED_PRECONDITION,vw);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return Zl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new pe(Q.FAILED_PRECONDITION,Ff)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Zl(e).put("owner",t)}static D(){return is.D()}bi(e){const t=Zl(e);return t.get("owner").next(r=>this.vi(r)?(fe("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):B.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(dn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;Xb()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return fe("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return dn("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){dn("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Zl(n){return In(n,"owner")}function td(n){return In(n,"clientMetadata")}function Bm(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zm{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=nt(),s=nt();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new zm(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nk{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kx{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Xb()?8:_w(xn())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new Nk;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(Sa()<=ht.DEBUG&&fe("QueryEngine","SDK will not create cache indexes for query:",Pa(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),B.resolve()):(Sa()<=ht.DEBUG&&fe("QueryEngine","Query:",Pa(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Sa()<=ht.DEBUG&&fe("QueryEngine","The SDK decides to create cache indexes for query:",Pa(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Wn(t))):B.resolve())}Yi(e,t){if(Hy(t))return B.resolve(null);let r=Wn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=jd(t,null,"F"),r=Wn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=nt(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ts(t,a);return this.ns(t,c,o,l.readTime)?this.Yi(e,jd(t,null,"F")):this.rs(e,c,t,l)}))})))}Zi(e,t,r,s){return Hy(t)||s.isEqual(qe.min())?B.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?B.resolve(null):(Sa()<=ht.DEBUG&&fe("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Pa(t)),this.rs(e,o,t,mw(s,-1)).next(a=>a))})}ts(e,t){let r=new kt(Bw(e));return t.forEach((s,i)=>{cc(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return Sa()<=ht.DEBUG&&fe("QueryEngine","Using full collection scan to execute query:",Pa(t)),this.Ji.getDocumentsMatchingQuery(e,t,Ir.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vk{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Ft(Je),this._s=new Ws(i=>Fo(i),lc),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Cx(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function Dx(n,e,t,r){return new Vk(n,e,t,r)}async function Nx(n,e){const t=Ce(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=nt();for(const c of s){o.push(c.batchId);for(const h of c.mutations)l=l.add(h.key)}for(const c of i){a.push(c.batchId);for(const h of c.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function Ok(n,e){const t=Ce(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,h){const f=c.batch,g=f.keys();let y=B.resolve();return g.forEach(I=>{y=y.next(()=>h.getEntry(l,I)).next(S=>{const E=c.docVersions.get(I);Le(E!==null),S.version.compareTo(E)<0&&(f.applyToRemoteDocument(S,c),S.isValidDocument()&&(S.setReadTime(c.commitVersion),h.addEntry(S)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=nt();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function Vx(n){const e=Ce(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function Mk(n,e){const t=Ce(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((h,f)=>{const g=s.get(f);if(!g)return;a.push(t.Ur.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,h.addedDocuments,f)));let y=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(on.EMPTY_BYTE_STRING,qe.min()).withLastLimboFreeSnapshotVersion(qe.min()):h.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(h.resumeToken,r)),s=s.insert(f,y),function(S,E,$){return S.resumeToken.approximateByteSize()===0||E.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=3e8?!0:$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0}(g,y,h)&&a.push(t.Ur.updateTargetData(i,y))});let l=hr(),c=nt();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(Ox(i,o,e.documentUpdates).next(h=>{l=h.Ps,c=h.Is})),!r.isEqual(qe.min())){const h=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return B.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.os=s,i))}function Ox(n,e,t){let r=nt(),s=nt();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=hr();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(qe.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):fe("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function Lk(n,e){const t=Ce(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function tl(n,e){const t=Ce(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,B.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new Rs(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function nl(n,e,t){const r=Ce(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Qi(o))throw o;fe("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Hd(n,e,t){const r=Ce(n);let s=qe.min(),i=nt();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,h){const f=Ce(l),g=f._s.get(h);return g!==void 0?B.resolve(f.os.get(g)):f.Ur.getTargetData(c,h)}(r,o,Wn(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:qe.min(),t?i:nt())).next(a=>($x(r,qw(e),a),{documents:a,Ts:i})))}function Mx(n,e){const t=Ce(n),r=Ce(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function Lx(n,e){const t=Ce(n),r=t.us.get(e)||qe.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,mw(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>($x(t,e,s),s))}function $x(n,e,t){let r=n.us.get(e)||qe.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function $k(n,e,t,r){const s=Ce(n);let i=nt(),o=hr();for(const c of t){const h=e.Es(c.metadata.name);c.document&&(i=i.add(h));const f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(h,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await tl(s,function(h){return Wn(ml(ft.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>Ox(c,a,o).next(h=>(a.apply(c),h)).next(h=>s.Ur.removeMatchingKeysForTargetId(c,l.targetId).next(()=>s.Ur.addMatchingKeys(c,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,h.Ps,h.Is)).next(()=>h.Ps)))}async function Fk(n,e,t=nt()){const r=await tl(n,Wn(Lm(e.bundledQuery))),s=Ce(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=pn(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(on.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function x0(n,e){return`firestore_clients_${n}_${e}`}function I0(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Uf(n,e){return`firestore_targets_${n}_${e}`}class Wd{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new pe(s.error.code,s.error.message))),o?new Wd(e,t,s.state,i):(dn("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Iu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new pe(r.error.code,r.error.message))),i?new Iu(e,r.state,s):(dn("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Qd{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Rm();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=bw(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Qd(e,i):(dn("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Km{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Km(t.clientId,t.onlineState):(dn("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Op{constructor(){this.activeTargetIds=Rm()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class jf{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Ft(Je),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=x0(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Op),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(x0(this.persistenceKey,r));if(s){const i=Qd.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Uf(this.persistenceKey,e));if(s){const i=Iu.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Uf(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return fe("SharedClientState","READ",e,t),t}setItem(e,t){fe("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){fe("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(fe("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void dn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=cr.oe;if(i!=null)try{const a=JSON.parse(i);Le(typeof a=="number"),o=a}catch(a){dn("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==cr.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new Wd(this.currentUser,e,t,r),i=I0(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=I0(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=Uf(this.persistenceKey,e),i=new Iu(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return Qd.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return Wd.Rs(new Pn(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return Iu.Rs(s,t)}Ls(e){return Km.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);fe("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Rm();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class Fx{constructor(){this.so=new Op,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Op,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uk{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E0{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){fe("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){fe("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nd=null;function qf(){return nd===null?nd=function(){return 268435456+Math.round(2147483648*Math.random())}():nd++,"0x"+nd.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jk={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qk{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jn="WebChannelConnection";class Bk extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=qf(),l=this.xo(t,r.toUriEncodedString());fe("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,l,c,s).then(h=>(fe("RestConnection",`Received RPC '${t}' ${a}: `,h),h),h=>{throw kr("RestConnection",`RPC '${t}' ${a} failed with error: `,h,"url: ",l,"request:",s),h})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+pl}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=jk[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=qf();return new Promise((o,a)=>{const l=new ow;l.setWithCredentials(!0),l.listenOnce(aw.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case fd.NO_ERROR:const h=l.getResponseJson();fe(jn,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(h)),o(h);break;case fd.TIMEOUT:fe(jn,`RPC '${e}' ${i} timed out`),a(new pe(Q.DEADLINE_EXCEEDED,"Request time out"));break;case fd.HTTP_ERROR:const f=l.getStatus();if(fe(jn,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let g=l.getResponseJson();Array.isArray(g)&&(g=g[0]);const y=g==null?void 0:g.error;if(y&&y.status&&y.message){const I=function(E){const $=E.toLowerCase().replace(/_/g,"-");return Object.values(Q).indexOf($)>=0?$:Q.UNKNOWN}(y.status);a(new pe(I,y.message))}else a(new pe(Q.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new pe(Q.UNAVAILABLE,"Connection failed."));break;default:Ve()}}finally{fe(jn,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);fe(jn,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=qf(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=cw(),a=uw(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const h=i.join("");fe(jn,`Creating RPC '${e}' stream ${s}: ${h}`,l);const f=o.createWebChannel(h,l);let g=!1,y=!1;const I=new qk({Io:E=>{y?fe(jn,`Not sending because RPC '${e}' stream ${s} is closed:`,E):(g||(fe(jn,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),fe(jn,`RPC '${e}' stream ${s} sending:`,E),f.send(E))},To:()=>f.close()}),S=(E,$,F)=>{E.listen($,M=>{try{F(M)}catch(L){setTimeout(()=>{throw L},0)}})};return S(f,iu.EventType.OPEN,()=>{y||(fe(jn,`RPC '${e}' stream ${s} transport opened.`),I.yo())}),S(f,iu.EventType.CLOSE,()=>{y||(y=!0,fe(jn,`RPC '${e}' stream ${s} transport closed`),I.So())}),S(f,iu.EventType.ERROR,E=>{y||(y=!0,kr(jn,`RPC '${e}' stream ${s} transport errored:`,E),I.So(new pe(Q.UNAVAILABLE,"The operation could not be completed")))}),S(f,iu.EventType.MESSAGE,E=>{var $;if(!y){const F=E.data[0];Le(!!F);const M=F,L=M.error||(($=M[0])===null||$===void 0?void 0:$.error);if(L){fe(jn,`RPC '${e}' stream ${s} received error:`,L);const re=L.status;let W=function(A){const C=yn[A];if(C!==void 0)return rx(C)}(re),x=L.message;W===void 0&&(W=Q.INTERNAL,x="Unknown error status: "+re+" with message "+L.message),y=!0,I.So(new pe(W,x)),f.close()}else fe(jn,`RPC '${e}' stream ${s} received:`,F),I.bo(F)}}),S(a,lw.STAT_EVENT,E=>{E.stat===_p.PROXY?fe(jn,`RPC '${e}' stream ${s} detected buffering proxy`):E.stat===_p.NOPROXY&&fe(jn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{I.wo()},0),I}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ux(){return typeof window<"u"?window:null}function bd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pc(n){return new YC(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gm{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&fe("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jx{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Gm(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===Q.RESOURCE_EXHAUSTED?(dn(t.toString()),dn("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===Q.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new pe(Q.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return fe("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(fe("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class zk extends jx{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=ek(this.serializer,e),r=function(i){if(!("targetChange"in i))return qe.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?qe.min():o.readTime?pn(o.readTime):qe.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=Cp(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=Fd(l)?{documents:fx(i,l)}:{query:Ph(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=ax(i,o.resumeToken);const c=Pp(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(qe.min())>0){a.readTime=el(i,o.snapshotVersion.toTimestamp());const c=Pp(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=nk(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=Cp(this.serializer),t.removeTarget=e,this.a_(t)}}class Kk extends jx{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Le(!!e.streamToken),this.lastStreamToken=e.streamToken,Le(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Le(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=tk(e.writeResults,e.commitTime),r=pn(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=Cp(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>zu(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gk extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new pe(Q.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,Rp(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===Q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new pe(Q.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,Rp(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===Q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new pe(Q.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Hk{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(dn(t),this.D_=!1):fe("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wk{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{Yi(this)&&(fe("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=Ce(l);c.L_.add(4),await yl(c),c.q_.set("Unknown"),c.L_.delete(4),await mc(c)}(this))})}),this.q_=new Hk(r,s)}}async function mc(n){if(Yi(n))for(const e of n.B_)await e(!0)}async function yl(n){for(const e of n.B_)await e(!1)}function Dh(n,e){const t=Ce(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Qm(t)?Wm(t):bl(t).r_()&&Hm(t,e))}function rl(n,e){const t=Ce(n),r=bl(t);t.N_.delete(e),r.r_()&&qx(t,e),t.N_.size===0&&(r.r_()?r.o_():Yi(t)&&t.q_.set("Unknown"))}function Hm(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(qe.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}bl(n).A_(e)}function qx(n,e){n.Q_.xe(e),bl(n).R_(e)}function Wm(n){n.Q_=new HC({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),bl(n).start(),n.q_.v_()}function Qm(n){return Yi(n)&&!bl(n).n_()&&n.N_.size>0}function Yi(n){return Ce(n).L_.size===0}function Bx(n){n.Q_=void 0}async function Qk(n){n.q_.set("Online")}async function Jk(n){n.N_.forEach((e,t)=>{Hm(n,e)})}async function Yk(n,e){Bx(n),Qm(n)?(n.q_.M_(e),Wm(n)):n.q_.set("Unknown")}async function Xk(n,e,t){if(n.q_.set("Online"),e instanceof ox&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){fe("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Jd(n,r)}else if(e instanceof _d?n.Q_.Ke(e):e instanceof ix?n.Q_.He(e):n.Q_.We(e),!t.isEqual(qe.min()))try{const r=await Vx(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.N_.get(c);h&&i.N_.set(c,h.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const h=i.N_.get(l);if(!h)return;i.N_.set(l,h.withResumeToken(on.EMPTY_BYTE_STRING,h.snapshotVersion)),qx(i,l);const f=new Rs(h.target,l,c,h.sequenceNumber);Hm(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){fe("RemoteStore","Failed to raise snapshot:",r),await Jd(n,r)}}async function Jd(n,e,t){if(!Qi(e))throw e;n.L_.add(1),await yl(n),n.q_.set("Offline"),t||(t=()=>Vx(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{fe("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await mc(n)})}function zx(n,e){return e().catch(t=>Jd(n,t,e))}async function _l(n){const e=Ce(n),t=qi(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;Zk(e);)try{const s=await Lk(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,e2(e,s)}catch(s){await Jd(e,s)}Kx(e)&&Gx(e)}function Zk(n){return Yi(n)&&n.O_.length<10}function e2(n,e){n.O_.push(e);const t=qi(n);t.r_()&&t.V_&&t.m_(e.mutations)}function Kx(n){return Yi(n)&&!qi(n).n_()&&n.O_.length>0}function Gx(n){qi(n).start()}async function t2(n){qi(n).p_()}async function n2(n){const e=qi(n);for(const t of n.O_)e.m_(t.mutations)}async function r2(n,e,t){const r=n.O_.shift(),s=Nm.from(r,e,t);await zx(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await _l(n)}async function s2(n,e){e&&qi(n).V_&&await async function(r,s){if(function(o){return nx(o)&&o!==Q.ABORTED}(s.code)){const i=r.O_.shift();qi(r).s_(),await zx(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await _l(r)}}(n,e),Kx(n)&&Gx(n)}async function T0(n,e){const t=Ce(n);t.asyncQueue.verifyOperationInProgress(),fe("RemoteStore","RemoteStore received new credentials");const r=Yi(t);t.L_.add(3),await yl(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await mc(t)}async function Mp(n,e){const t=Ce(n);e?(t.L_.delete(2),await mc(t)):e||(t.L_.add(2),await yl(t),t.q_.set("Unknown"))}function bl(n){return n.K_||(n.K_=function(t,r,s){const i=Ce(t);return i.w_(),new zk(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:Qk.bind(null,n),Ro:Jk.bind(null,n),mo:Yk.bind(null,n),d_:Xk.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Qm(n)?Wm(n):n.q_.set("Unknown")):(await n.K_.stop(),Bx(n))})),n.K_}function qi(n){return n.U_||(n.U_=function(t,r,s){const i=Ce(t);return i.w_(),new Kk(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:t2.bind(null,n),mo:s2.bind(null,n),f_:n2.bind(null,n),g_:r2.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await _l(n)):(await n.U_.stop(),n.O_.length>0&&(fe("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jm{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Cn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Jm(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new pe(Q.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function wl(n,e){if(dn("AsyncQueue",`${e}: ${n}`),Qi(n))return new pe(Q.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $a{constructor(e){this.comparator=e?(t,r)=>e(t,r)||ke.comparator(t.key,r.key):(t,r)=>ke.comparator(t.key,r.key),this.keyedMap=ou(),this.sortedSet=new Ft(this.comparator)}static emptySet(e){return new $a(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof $a)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new $a;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A0{constructor(){this.W_=new Ft(ke.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Ve():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class sl{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new sl(e,t,$a.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&uc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i2{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class o2{constructor(){this.queries=S0(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=Ce(t),i=s.queries;s.queries=S0(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new pe(Q.ABORTED,"Firestore shutting down"))}}function S0(){return new Ws(n=>jw(n),uc)}async function Ym(n,e){const t=Ce(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new i2,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=wl(o,`Initialization of query '${Pa(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Zm(t)}async function Xm(n,e){const t=Ce(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function a2(n,e){const t=Ce(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&Zm(t)}function l2(n,e,t){const r=Ce(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function Zm(n){n.Y_.forEach(e=>{e.next()})}var Lp,P0;(P0=Lp||(Lp={})).ea="default",P0.Cache="cache";class eg{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new sl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=sl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Lp.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u2{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R0{constructor(e){this.serializer=e}Es(e){return os(this.serializer,e)}ds(e){return e.metadata.exists?hx(this.serializer,e.document,!1):Bt.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return pn(e)}}class c2{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Hx(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=ft.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new R0(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||nt()).add(i);t.set(o,a)}}return t}async complete(){const e=await $k(this.localStore,new R0(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await Fk(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function Hx(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wx{constructor(e){this.key=e}}class Qx{constructor(e){this.key=e}}class Jx{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=nt(),this.mutatedKeys=nt(),this.Aa=Bw(e),this.Ra=new $a(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new A0,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const g=s.get(h),y=cc(this.query,f)?f:null,I=!!g&&this.mutatedKeys.has(g.key),S=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let E=!1;g&&y?g.data.isEqual(y.data)?I!==S&&(r.track({type:3,doc:y}),E=!0):this.ga(g,y)||(r.track({type:2,doc:y}),E=!0,(l&&this.Aa(y,l)>0||c&&this.Aa(y,c)<0)&&(a=!0)):!g&&y?(r.track({type:0,doc:y}),E=!0):g&&!y&&(r.track({type:1,doc:g}),E=!0,(l||c)&&(a=!0)),E&&(y?(o=o.add(y),i=S?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((h,f)=>function(y,I){const S=E=>{switch(E){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ve()}};return S(y)-S(I)}(h.type,f.type)||this.Aa(h.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,c=l!==this.Ea;return this.Ea=l,o.length!==0||c?{snapshot:new sl(this.query,e.Ra,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new A0,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=nt(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new Qx(r))}),this.da.forEach(r=>{e.has(r)||t.push(new Wx(r))}),t}ba(e){this.Ta=e.Ts,this.da=nt();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return sl.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class d2{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class h2{constructor(e){this.key=e,this.va=!1}}class f2{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Ws(a=>jw(a),uc),this.Ma=new Map,this.xa=new Set,this.Oa=new Ft(ke.comparator),this.Na=new Map,this.La=new Um,this.Ba={},this.ka=new Map,this.qa=zo.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function p2(n,e,t=!0){const r=Nh(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await Yx(r,e,t,!0),s}async function m2(n,e){const t=Nh(n);await Yx(t,e,!0,!1)}async function Yx(n,e,t,r){const s=await tl(n.localStore,Wn(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await tg(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&Dh(n.remoteStore,s),a}async function tg(n,e,t,r,s){n.Ka=(f,g,y)=>async function(S,E,$,F){let M=E.view.ma($);M.ns&&(M=await Hd(S.localStore,E.query,!1).then(({documents:x})=>E.view.ma(x,M)));const L=F&&F.targetChanges.get(E.targetId),re=F&&F.targetMismatches.get(E.targetId)!=null,W=E.view.applyChanges(M,S.isPrimaryClient,L,re);return $p(S,E.targetId,W.wa),W.snapshot}(n,f,g,y);const i=await Hd(n.localStore,e,!0),o=new Jx(e,i.Ts),a=o.ma(i.documents),l=fc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);$p(n,t,c.wa);const h=new d2(e,t,o);return n.Fa.set(e,h),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function g2(n,e,t){const r=Ce(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!uc(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await nl(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&rl(r.remoteStore,s.targetId),il(r,s.targetId)}).catch(Wi)):(il(r,s.targetId),await nl(r.localStore,s.targetId,!0))}async function v2(n,e){const t=Ce(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),rl(t.remoteStore,r.targetId))}async function y2(n,e,t){const r=ig(n);try{const s=await function(o,a){const l=Ce(o),c=en.now(),h=a.reduce((y,I)=>y.add(I.key),nt());let f,g;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let I=hr(),S=nt();return l.cs.getEntries(y,h).next(E=>{I=E,I.forEach(($,F)=>{F.isValidDocument()||(S=S.add($))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,I)).next(E=>{f=E;const $=[];for(const F of a){const M=zC(F,f.get(F.key).overlayedDocument);M!=null&&$.push(new Qs(F.key,M,Cw(M.value.mapValue),Jt.exists(!0)))}return l.mutationQueue.addMutationBatch(y,c,$,a)}).next(E=>{g=E;const $=E.applyToLocalDocumentSet(f,S);return l.documentOverlayCache.saveOverlays(y,E.batchId,$)})}).then(()=>({batchId:g.batchId,changes:Kw(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Ba[o.currentUser.toKey()];c||(c=new Ft(Je)),c=c.insert(a,l),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await Js(r,s.changes),await _l(r.remoteStore)}catch(s){const i=wl(s,"Failed to persist write");t.reject(i)}}async function Xx(n,e){const t=Ce(n);try{const r=await Mk(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(Le(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Le(o.va):s.removedDocuments.size>0&&(Le(o.va),o.va=!1))}),await Js(t,r,e)}catch(r){await Wi(r)}}function C0(n,e,t){const r=Ce(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=Ce(o);l.onlineState=a;let c=!1;l.queries.forEach((h,f)=>{for(const g of f.j_)g.Z_(a)&&(c=!0)}),c&&Zm(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function _2(n,e,t){const r=Ce(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Ft(ke.comparator);o=o.insert(i,Bt.newNoDocument(i,qe.min()));const a=nt().add(i),l=new hc(qe.min(),new Map,new Ft(Je),o,a);await Xx(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),sg(r)}else await nl(r.localStore,e,!1).then(()=>il(r,e,t)).catch(Wi)}async function b2(n,e){const t=Ce(n),r=e.batch.batchId;try{const s=await Ok(t.localStore,e);rg(t,r,null),ng(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Js(t,s)}catch(s){await Wi(s)}}async function w2(n,e,t){const r=Ce(n);try{const s=await function(o,a){const l=Ce(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let h;return l.mutationQueue.lookupMutationBatch(c,a).next(f=>(Le(f!==null),h=f.keys(),l.mutationQueue.removeMutationBatch(c,f))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,h,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,h)).next(()=>l.localDocuments.getDocuments(c,h))})}(r.localStore,e);rg(r,e,t),ng(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Js(r,s)}catch(s){await Wi(s)}}async function x2(n,e){const t=Ce(n);Yi(t.remoteStore)||fe("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=Ce(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=wl(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function ng(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function rg(n,e,t){const r=Ce(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function il(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||Zx(n,r)})}function Zx(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(rl(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),sg(n))}function $p(n,e,t){for(const r of t)r instanceof Wx?(n.La.addReference(r.key,e),I2(n,r)):r instanceof Qx?(fe("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||Zx(n,r.key)):Ve()}function I2(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(fe("SyncEngine","New document in limbo: "+t),n.xa.add(r),sg(n))}function sg(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new ke(ft.fromString(e)),r=n.qa.next();n.Na.set(r,new h2(t)),n.Oa=n.Oa.insert(t,r),Dh(n.remoteStore,new Rs(Wn(ml(t.path)),r,"TargetPurposeLimboResolution",cr.oe))}}async function Js(n,e,t){const r=Ce(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(c=>{var h;if((c||t)&&r.isPrimaryClient){const f=c?!c.fromCache:(h=t==null?void 0:t.targetChanges.get(l.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(c){s.push(c);const f=zm.Wi(l.targetId,c);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,c){const h=Ce(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>B.forEach(c,g=>B.forEach(g.$i,y=>h.persistence.referenceDelegate.addReference(f,g.targetId,y)).next(()=>B.forEach(g.Ui,y=>h.persistence.referenceDelegate.removeReference(f,g.targetId,y)))))}catch(f){if(!Qi(f))throw f;fe("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const g=f.targetId;if(!f.fromCache){const y=h.os.get(g),I=y.snapshotVersion,S=y.withLastLimboFreeSnapshotVersion(I);h.os=h.os.insert(g,S)}}}(r.localStore,i))}async function E2(n,e){const t=Ce(n);if(!t.currentUser.isEqual(e)){fe("SyncEngine","User change. New user:",e.toKey());const r=await Nx(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new pe(Q.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Js(t,r.hs)}}function T2(n,e){const t=Ce(n),r=t.Na.get(e);if(r&&r.va)return nt().add(r.key);{let s=nt();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function A2(n,e){const t=Ce(n),r=await Hd(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&$p(t,e.targetId,s.wa),s}async function S2(n,e){const t=Ce(n);return Lx(t.localStore,e).then(r=>Js(t,r))}async function P2(n,e,t,r){const s=Ce(n),i=await function(a,l){const c=Ce(a),h=Ce(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.Mn(f,l).next(g=>g?c.localDocuments.getDocuments(f,g):B.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await _l(s.remoteStore):t==="acknowledged"||t==="rejected"?(rg(s,e,r||null),ng(s,e),function(a,l){Ce(Ce(a).mutationQueue).On(l)}(s.localStore,e)):Ve(),await Js(s,i)):fe("SyncEngine","Cannot apply mutation batch with id: "+e)}async function R2(n,e){const t=Ce(n);if(Nh(t),ig(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await k0(t,r.toArray());t.Qa=!0,await Mp(t.remoteStore,!0);for(const i of s)Dh(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(il(t,o),nl(t.localStore,o,!0))),rl(t.remoteStore,o)}),await s,await k0(t,r),function(o){const a=Ce(o);a.Na.forEach((l,c)=>{rl(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new Ft(ke.comparator)}(t),t.Qa=!1,await Mp(t.remoteStore,!1)}}async function k0(n,e,t){const r=Ce(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await tl(r.localStore,Wn(l[0]));for(const c of l){const h=r.Fa.get(c),f=await A2(r,h);f.snapshot&&i.push(f.snapshot)}}else{const c=await Mx(r.localStore,o);a=await tl(r.localStore,c),await tg(r,eI(c),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function eI(n){return $w(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function C2(n){return function(t){return Ce(Ce(t).persistence).Qi()}(Ce(n).localStore)}async function k2(n,e,t,r){const s=Ce(n);if(s.Qa)return void fe("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await Lx(s.localStore,qw(i[0])),a=hc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",on.EMPTY_BYTE_STRING);await Js(s,o,a);break}case"rejected":await nl(s.localStore,e,!0),il(s,e,r);break;default:Ve()}}async function D2(n,e,t){const r=Nh(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){fe("SyncEngine","Adding an already active target "+s);continue}const i=await Mx(r.localStore,s),o=await tl(r.localStore,i);await tg(r,eI(i),o.targetId,!1,o.resumeToken),Dh(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await nl(r.localStore,s,!1).then(()=>{rl(r.remoteStore,s),il(r,s)}).catch(Wi)}}function Nh(n){const e=Ce(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Xx.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=T2.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=_2.bind(null,e),e.Ca.d_=a2.bind(null,e.eventManager),e.Ca.$a=l2.bind(null,e.eventManager),e}function ig(n){const e=Ce(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=b2.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=w2.bind(null,e),e}function N2(n,e,t){const r=Ce(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(y,I){const S=Ce(y),E=pn(I.createTime);return S.persistence.runTransaction("hasNewerBundle","readonly",$=>S.Gr.getBundleMetadata($,I.id)).then($=>!!$&&$.createTime.compareTo(E)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(Hx(l));const c=new c2(l,i.localStore,o.serializer);let h=await o.Ua();for(;h;){const g=await c.la(h);g&&a._updateProgress(g),h=await o.Ua()}const f=await c.complete();return await Js(i,f.Ia,void 0),await function(y,I){const S=Ce(y);return S.persistence.runTransaction("Save bundle","readwrite",E=>S.Gr.saveBundleMetadata(E,I))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(l){return kr("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class Bi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=pc(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return Dx(this.persistence,new kx,e.initialUser,this.serializer)}Ga(e){return new jm(kh.Zr,this.serializer)}Wa(e){return new Fx}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Bi.provider={build:()=>new Bi};class V2 extends Bi{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){Le(this.persistence.referenceDelegate instanceof Gd);const r=this.persistence.referenceDelegate.garbageCollector;return new Ax(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?Bn.withCacheSize(this.cacheSizeBytes):Bn.DEFAULT;return new jm(r=>Gd.Zr(r,t),this.serializer)}}class og extends Bi{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await ig(this.Ja.syncEngine),await _l(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return Dx(this.persistence,new kx,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new Ax(r,e.asyncQueue,t)}Ha(e,t){const r=new nC(t,this.persistence);return new tC(e.asyncQueue,r)}Ga(e){const t=Bm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Bn.withCacheSize(this.cacheSizeBytes):Bn.DEFAULT;return new qm(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Ux(),bd(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new Fx}}class tI extends og{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof jf&&(this.sharedClientState.syncEngine={no:P2.bind(null,t),ro:k2.bind(null,t),io:D2.bind(null,t),Qi:C2.bind(null,t),eo:S2.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await R2(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=Ux();if(!jf.D(t))throw new pe(Q.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Bm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new jf(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class zi{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>C0(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=E2.bind(null,this.syncEngine),await Mp(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new o2}()}createDatastore(e){const t=pc(e.databaseInfo.databaseId),r=function(i){return new Bk(i)}(e.databaseInfo);return function(i,o,a,l){return new Gk(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new Wk(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>C0(this.syncEngine,t,0),function(){return E0.D()?new E0:new Uk}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,h){const f=new f2(s,i,o,a,l,c);return h&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=Ce(s);fe("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await yl(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}zi.provider={build:()=>new zi};function D0(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):dn("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O2{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new Cn,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new u2(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M2{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new pe(Q.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=Ce(s),a={documents:i.map(f=>Bu(o.serializer,f))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,ft.emptyPath(),a,i.length),c=new Map;l.forEach(f=>{const g=ZC(o.serializer,f);c.set(g.key.toString(),g)});const h=[];return i.forEach(f=>{const g=c.get(f.toString());Le(!!g),h.push(g)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new vl(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=ke.fromPath(r);this.mutations.push(new km(s,this.precondition(s)))}),await async function(r,s){const i=Ce(r),o={writes:s.map(a=>zu(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,ft.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Ve();t=qe.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new pe(Q.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(qe.min())?Jt.exists(!1):Jt.updateTime(t):Jt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(qe.min()))throw new pe(Q.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Jt.updateTime(t)}return Jt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L2{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new Gm(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new M2(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!ac(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!nx(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $2{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Pn.UNAUTHENTICATED,this.clientId=fw.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{fe("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(fe("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Cn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=wl(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Bf(n,e){n.asyncQueue.verifyOperationInProgress(),fe("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await Nx(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function N0(n,e){n.asyncQueue.verifyOperationInProgress();const t=await ag(n);fe("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>T0(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>T0(e.remoteStore,s)),n._onlineComponents=e}async function ag(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){fe("FirestoreClient","Using user provided OfflineComponentProvider");try{await Bf(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===Q.FAILED_PRECONDITION||s.code===Q.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;kr("Error using user provided cache. Falling back to memory cache: "+t),await Bf(n,new Bi)}}else fe("FirestoreClient","Using default OfflineComponentProvider"),await Bf(n,new Bi);return n._offlineComponents}async function Oh(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(fe("FirestoreClient","Using user provided OnlineComponentProvider"),await N0(n,n._uninitializedComponentsProvider._online)):(fe("FirestoreClient","Using default OnlineComponentProvider"),await N0(n,new zi))),n._onlineComponents}function nI(n){return ag(n).then(e=>e.persistence)}function xl(n){return ag(n).then(e=>e.localStore)}function rI(n){return Oh(n).then(e=>e.remoteStore)}function lg(n){return Oh(n).then(e=>e.syncEngine)}function sI(n){return Oh(n).then(e=>e.datastore)}async function ol(n){const e=await Oh(n),t=e.eventManager;return t.onListen=p2.bind(null,e.syncEngine),t.onUnlisten=g2.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=m2.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=v2.bind(null,e.syncEngine),t}function F2(n){return n.asyncQueue.enqueue(async()=>{const e=await nI(n),t=await rI(n);return e.setNetworkEnabled(!0),function(s){const i=Ce(s);return i.L_.delete(0),mc(i)}(t)})}function U2(n){return n.asyncQueue.enqueue(async()=>{const e=await nI(n),t=await rI(n);return e.setNetworkEnabled(!1),async function(s){const i=Ce(s);i.L_.add(0),await yl(i),i.q_.set("Offline")}(t)})}function j2(n,e){const t=new Cn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(c,h){const f=Ce(c);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new pe(Q.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=wl(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await xl(n),e,t)),t.promise}function iI(n,e,t={}){const r=new Cn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const h=new Vh({next:g=>{h.Za(),o.enqueueAndForget(()=>Xm(i,f));const y=g.docs.has(a);!y&&g.fromCache?c.reject(new pe(Q.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&g.fromCache&&l&&l.source==="server"?c.reject(new pe(Q.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new eg(ml(a.path),h,{includeMetadataChanges:!0,_a:!0});return Ym(i,f)}(await ol(n),n.asyncQueue,e,t,r)),r.promise}function q2(n,e){const t=new Cn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await Hd(s,i,!0),l=new Jx(i,a.Ts),c=l.ma(a.documents),h=l.applyChanges(c,!1);o.resolve(h.snapshot)}catch(a){const l=wl(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await xl(n),e,t)),t.promise}function oI(n,e,t={}){const r=new Cn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const h=new Vh({next:g=>{h.Za(),o.enqueueAndForget(()=>Xm(i,f)),g.fromCache&&l.source==="server"?c.reject(new pe(Q.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new eg(a,h,{includeMetadataChanges:!0,_a:!0});return Ym(i,f)}(await ol(n),n.asyncQueue,e,t,r)),r.promise}function B2(n,e,t){const r=new Cn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await sI(n);r.resolve(async function(o,a,l){var c;const h=Ce(o),{request:f,ut:g,parent:y}=px(h.serializer,Fw(a),l);h.connection.Fo||delete f.parent;const I=(await h.Lo("RunAggregationQuery",h.serializer.databaseId,y,f,1)).filter(E=>!!E.result);Le(I.length===1);const S=(c=I[0].result)===null||c===void 0?void 0:c.aggregateFields;return Object.keys(S).reduce((E,$)=>(E[g[$]]=S[$],E),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function z2(n,e){const t=new Vh(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){Ce(s).Y_.add(i),i.next()}(await ol(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){Ce(s).Y_.delete(i)}(await ol(n),t))}}function K2(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?sx().encode(o):o,function(h,f){return new O2(h,f)}(function(h,f){if(h instanceof Uint8Array)return D0(h,f);if(h instanceof ArrayBuffer)return D0(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,pc(e));n.asyncQueue.enqueueAndForget(async()=>{N2(await lg(n),s,r)})}function G2(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=Ce(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await xl(n),e))}function H2(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=Ce(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(c=>function(f,g,y,I,S){f=[...f],g=[...g],f.sort(y),g.sort(y);const E=f.length,$=g.length;let F=0,M=0;for(;F<$&&M<E;){const L=y(f[M],g[F]);L<0?S(f[M++]):L>0?I(g[F++]):(F++,M++)}for(;F<$;)I(g[F++]);for(;M<E;)S(f[M++])}(c,s,YR,h=>{a.push(o.addFieldIndex(l,h))},h=>{a.push(o.deleteFieldIndex(l,h))})).next(()=>B.waitFor(a)))}(await xl(n),e))}function W2(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){Ce(r).ss.zi=s}(await xl(n),e))}function Q2(n){return n.asyncQueue.enqueue(async()=>function(t){const r=Ce(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await xl(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aI(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V0=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ug(n,e,t){if(!t)throw new pe(Q.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function J2(n,e,t,r){if(e===!0&&r===!0)throw new pe(Q.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function O0(n){if(!ke.isDocumentKey(n))throw new pe(Q.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function M0(n){if(ke.isDocumentKey(n))throw new pe(Q.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Mh(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Ve()}function ut(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new pe(Q.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Mh(n);throw new pe(Q.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function lI(n,e){if(e<=0)throw new pe(Q.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L0{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new pe(Q.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new pe(Q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}J2("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=aI((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new pe(Q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new pe(Q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new pe(Q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class gc{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new L0({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new pe(Q.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new pe(Q.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new L0(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new BR;switch(r.type){case"firstParty":return new HR(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new pe(Q.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=V0.get(t);r&&(fe("ComponentProvider","Removing Datastore"),V0.delete(t),r.terminate())}(this),Promise.resolve()}}function Y2(n,e,t,r={}){var s;const i=(n=ut(n,gc))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&kr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=Pn.MOCK_USER;else{a=_P(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new pe(Q.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Pn(c)}n._authCredentials=new zR(new dw(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Fn(this.firestore,e,this._query)}}class mn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new as(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new mn(this.firestore,e,this._key)}}class as extends Fn{constructor(e,t,r){super(e,t,ml(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new mn(this.firestore,null,new ke(e))}withConverter(e){return new as(this.firestore,e,this._path)}}function et(n,e,...t){if(n=je(n),ug("collection","path",e),n instanceof gc){const r=ft.fromString(e,...t);return M0(r),new as(n,null,r)}{if(!(n instanceof mn||n instanceof as))throw new pe(Q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ft.fromString(e,...t));return M0(r),new as(n.firestore,null,r)}}function SB(n,e){if(n=ut(n,gc),ug("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new pe(Q.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Fn(n,null,function(r){return new Hs(ft.emptyPath(),r)}(e))}function Re(n,e,...t){if(n=je(n),arguments.length===1&&(e=fw.newId()),ug("doc","path",e),n instanceof gc){const r=ft.fromString(e,...t);return O0(r),new mn(n,null,new ke(r))}{if(!(n instanceof mn||n instanceof as))throw new pe(Q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ft.fromString(e,...t));return O0(r),new mn(n.firestore,n instanceof as?n.converter:null,new ke(r))}}function PB(n,e){return n=je(n),e=je(e),(n instanceof mn||n instanceof as)&&(e instanceof mn||e instanceof as)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function uI(n,e){return n=je(n),e=je(e),n instanceof Fn&&e instanceof Fn&&n.firestore===e.firestore&&uc(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $0{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Gm(this,"async_queue_retry"),this.Vu=()=>{const r=bd();r&&fe("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=bd();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=bd();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new Cn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Qi(e))throw e;fe("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw dn("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Jm.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&Ve()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function Fp(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class X2{constructor(){this._progressObserver={},this._taskCompletionResolver=new Cn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RB=-1;class Vt extends gc{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new $0,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new $0(e),this._firestoreClient=void 0,await e}}}function CB(n,e,t){t||(t="(default)");const r=Hi(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(Li(i,e))return s;throw new pe(Q.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new pe(Q.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new pe(Q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function Z2(n,e){const t=typeof n=="object"?n:xm(),r=typeof n=="string"?n:e||"(default)",s=Hi(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=vP("firestore");i&&Y2(s,...i)}return s}function tn(n){if(n._terminated)throw new pe(Q.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||cI(n),n._firestoreClient}function cI(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,c,h){return new IC(a,l,c,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,aI(h.experimentalLongPollingOptions),h.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new $2(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function eD(n,e){kr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return dI(n,zi.provider,{build:r=>new og(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function kB(n){kr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();dI(n,zi.provider,{build:t=>new tI(t,e.cacheSizeBytes)})}function dI(n,e,t){if((n=ut(n,Vt))._firestoreClient||n._terminated)throw new pe(Q.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new pe(Q.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},cI(n)}function DB(n){if(n._initialized&&!n._terminated)throw new pe(Q.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Cn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!is.D())return Promise.resolve();const s=r+"main";await is.delete(s)}(Bm(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function NB(n){return function(t){const r=new Cn;return t.asyncQueue.enqueueAndForget(async()=>x2(await lg(t),r)),r.promise}(tn(n=ut(n,Vt)))}function VB(n){return F2(tn(n=ut(n,Vt)))}function OB(n){return U2(tn(n=ut(n,Vt)))}function MB(n){return RR(n.app,"firestore",n._databaseId.database),n._delete()}function LB(n,e){const t=tn(n=ut(n,Vt)),r=new X2;return K2(t,n._databaseId,e,r),r}function $B(n,e){return G2(tn(n=ut(n,Vt)),e).then(t=>t?new Fn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ku{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class tD{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ko{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ko(on.fromBase64String(e))}catch(t){throw new pe(Q.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ko(on.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yo{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new pe(Q.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Qt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function FB(){return new Yo("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xo{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cg{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new pe(Q.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new pe(Q.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Je(this._lat,e._lat)||Je(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lh{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nD=/^__.*__$/;class rD{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Qs(e,this.data,this.fieldMask,t,this.fieldTransforms):new gl(e,this.data,t,this.fieldTransforms)}}class hI{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Qs(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function fI(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ve()}}class $h{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new $h(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Yd(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(fI(this.Cu)&&nD.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class sD{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||pc(e)}Qu(e,t,r,s=!1){return new $h({Cu:e,methodName:t,qu:r,path:Qt.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Zo(n){const e=n._freezeSettings(),t=pc(n._databaseId);return new sD(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Fh(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);vg("Data must be an object, but it was:",o,r);const a=gI(r,o);let l,c;if(i.merge)l=new dr(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const g=Gu(e,f,t);if(!o.contains(g))throw new pe(Q.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);yI(h,g)||h.push(g)}l=new dr(h),c=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,c=o.fieldTransforms;return new rD(new Ln(a),l,c)}class vc extends Xo{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof vc}}function pI(n,e,t){return new $h({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class dg extends Xo{_toFieldTransform(e){return new dc(e.path,new Xa)}isEqual(e){return e instanceof dg}}class hg extends Xo{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=pI(this,e,!0),r=this.Ku.map(i=>ea(i,t)),s=new Uo(r);return new dc(e.path,s)}isEqual(e){return e instanceof hg&&Li(this.Ku,e.Ku)}}class fg extends Xo{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=pI(this,e,!0),r=this.Ku.map(i=>ea(i,t)),s=new jo(r);return new dc(e.path,s)}isEqual(e){return e instanceof fg&&Li(this.Ku,e.Ku)}}class pg extends Xo{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new Za(e.serializer,Ww(e.serializer,this.$u));return new dc(e.path,t)}isEqual(e){return e instanceof pg&&this.$u===e.$u}}function mg(n,e,t,r){const s=n.Qu(1,e,t);vg("Data must be an object, but it was:",s,r);const i=[],o=Ln.empty();Ji(r,(l,c)=>{const h=Uh(e,l,t);c=je(c);const f=s.Nu(h);if(c instanceof vc)i.push(h);else{const g=ea(c,f);g!=null&&(i.push(h),o.set(h,g))}});const a=new dr(i);return new hI(o,a,s.fieldTransforms)}function gg(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[Gu(e,r,t)],l=[s];if(i.length%2!=0)throw new pe(Q.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)a.push(Gu(e,i[g])),l.push(i[g+1]);const c=[],h=Ln.empty();for(let g=a.length-1;g>=0;--g)if(!yI(c,a[g])){const y=a[g];let I=l[g];I=je(I);const S=o.Nu(y);if(I instanceof vc)c.push(y);else{const E=ea(I,S);E!=null&&(c.push(y),h.set(y,E))}}const f=new dr(c);return new hI(h,f,o.fieldTransforms)}function mI(n,e,t,r=!1){return ea(t,n.Qu(r?4:3,e))}function ea(n,e){if(vI(n=je(n)))return vg("Unsupported field value:",e,n),gI(n,e);if(n instanceof Xo)return function(r,s){if(!fI(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=ea(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=je(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Ww(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=en.fromDate(r);return{timestampValue:el(s.serializer,i)}}if(r instanceof en){const i=new en(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:el(s.serializer,i)}}if(r instanceof cg)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Ko)return{bytesValue:ax(s.serializer,r._byteString)};if(r instanceof mn){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Mm(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Lh)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return Cm(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${Mh(r)}`)}(n,e)}function gI(n,e){const t={};return Aw(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ji(n,(r,s)=>{const i=ea(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function vI(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof en||n instanceof cg||n instanceof Ko||n instanceof mn||n instanceof Xo||n instanceof Lh)}function vg(n,e,t){if(!vI(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=Mh(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function Gu(n,e,t){if((e=je(e))instanceof Yo)return e._internalPath;if(typeof e=="string")return Uh(n,e);throw Yd("Field path arguments must be of type string or ",n,!1,void 0,t)}const iD=new RegExp("[~\\*/\\[\\]]");function Uh(n,e,t){if(e.search(iD)>=0)throw Yd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Yo(...e.split("."))._internalPath}catch{throw Yd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Yd(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new pe(Q.INVALID_ARGUMENT,a+n+l)}function yI(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hu{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new mn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new oD(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(jh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class oD extends Hu{data(){return super.data()}}function jh(n,e){return typeof e=="string"?Uh(n,e):e instanceof Yo?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _I(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new pe(Q.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class yg{}class yc extends yg{}function Wu(n,e,...t){let r=[];e instanceof yg&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof Il).length,a=i.filter(l=>l instanceof _c).length;if(o>1||o>0&&a>0)throw new pe(Q.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class _c extends yc{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new _c(e,t,r)}_apply(e){const t=this._parse(e);return wI(e._query,t),new Fn(e.firestore,e.converter,Sp(e._query,t))}_parse(e){const t=Zo(e.firestore);return function(i,o,a,l,c,h,f){let g;if(c.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new pe(Q.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){U0(f,h);const y=[];for(const I of f)y.push(F0(l,i,I));g={arrayValue:{values:y}}}else g=F0(l,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||U0(f,h),g=mI(a,o,f,h==="in"||h==="not-in");return pt.create(c,h,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Xd(n,e,t){const r=e,s=jh("where",n);return _c._create(s,r,t)}class Il extends yg{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Il(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Rt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)wI(o,l),o=Sp(o,l)}(e._query,t),new Fn(e.firestore,e.converter,Sp(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function UB(...n){return n.forEach(e=>xI("or",e)),Il._create("or",n)}function jB(...n){return n.forEach(e=>xI("and",e)),Il._create("and",n)}class _g extends yc{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new _g(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new pe(Q.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new pe(Q.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new qu(i,o)}(e._query,this._field,this._direction);return new Fn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Hs(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function aD(n,e="asc"){const t=e,r=jh("orderBy",n);return _g._create(r,t)}class qh extends yc{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new qh(e,t,r)}_apply(e){return new Fn(e.firestore,e.converter,jd(e._query,this._limit,this._limitType))}}function qB(n){return lI("limit",n),qh._create("limit",n,"F")}function BB(n){return lI("limitToLast",n),qh._create("limitToLast",n,"L")}class Bh extends yc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Bh(e,t,r)}_apply(e){const t=bI(e,this.type,this._docOrFields,this._inclusive);return new Fn(e.firestore,e.converter,function(s,i){return new Hs(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function zB(...n){return Bh._create("startAt",n,!0)}function KB(...n){return Bh._create("startAfter",n,!1)}class zh extends yc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new zh(e,t,r)}_apply(e){const t=bI(e,this.type,this._docOrFields,this._inclusive);return new Fn(e.firestore,e.converter,function(s,i){return new Hs(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function GB(...n){return zh._create("endBefore",n,!1)}function HB(...n){return zh._create("endAt",n,!0)}function bI(n,e,t,r){if(t[0]=je(t[0]),t[0]instanceof Hu)return function(i,o,a,l,c){if(!l)throw new pe(Q.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of La(i))if(f.field.isKeyField())h.push($o(o,l.key));else{const g=l.data.field(f.field);if(Ih(g))throw new pe(Q.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){const y=f.field.canonicalString();throw new pe(Q.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}h.push(g)}return new ji(h,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Zo(n.firestore);return function(o,a,l,c,h,f){const g=o.explicitOrderBy;if(h.length>g.length)throw new pe(Q.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let I=0;I<h.length;I++){const S=h[I];if(g[I].field.isKeyField()){if(typeof S!="string")throw new pe(Q.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof S}`);if(!Pm(o)&&S.indexOf("/")!==-1)throw new pe(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${S}' contains a slash.`);const E=o.path.child(ft.fromString(S));if(!ke.isDocumentKey(E))throw new pe(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${E}' is not because it contains an odd number of segments.`);const $=new ke(E);y.push($o(a,$))}else{const E=mI(l,c,S);y.push(E)}}return new ji(y,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function F0(n,e,t){if(typeof(t=je(t))=="string"){if(t==="")throw new pe(Q.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Pm(e)&&t.indexOf("/")!==-1)throw new pe(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(ft.fromString(t));if(!ke.isDocumentKey(r))throw new pe(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return $o(n,new ke(r))}if(t instanceof mn)return $o(n,t._key);throw new pe(Q.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Mh(t)}.`)}function U0(n,e){if(!Array.isArray(n)||n.length===0)throw new pe(Q.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function wI(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new pe(Q.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new pe(Q.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function xI(n,e){if(!(e instanceof _c||e instanceof Il))throw new pe(Q.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class II{convertValue(e,t="none"){switch(Fi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Wt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(qs(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ve()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Ji(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>Wt(o.doubleValue));return new Lh(i)}convertGeoPoint(e){return new cg(Wt(e.latitude),Wt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Eh(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Fu(e));default:return null}}convertTimestamp(e){const t=js(e);return new en(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ft.fromString(e);Le(yx(r));const s=new Lo(r.get(1),r.get(3)),i=new ke(r.popFirst(5));return s.isEqual(t)||dn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kh(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class lD extends II{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ko(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new mn(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WB(n){return new Ku("sum",Gu("sum",n))}function QB(n){return new Ku("avg",Gu("average",n))}function uD(){return new Ku("count")}function JB(n,e){var t,r;return n instanceof Ku&&e instanceof Ku&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function YB(n,e){return uI(n.query,e.query)&&Li(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ro{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class al extends Hu{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new wd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(jh("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class wd extends al{data(e={}){return super.data(e)}}class ll{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Ro(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new wd(this._firestore,this._userDataWriter,r.key,r,new Ro(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new pe(Q.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new wd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Ro(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new wd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Ro(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,h=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:cD(a.type),doc:l,oldIndex:c,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function cD(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ve()}}function XB(n,e){return n instanceof al&&e instanceof al?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof ll&&e instanceof ll&&n._firestore===e._firestore&&uI(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ut(n){n=ut(n,mn);const e=ut(n.firestore,Vt);return iI(tn(e),n._key).then(t=>bg(e,n,t))}class Xi extends II{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ko(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new mn(this.firestore,null,t)}}function ZB(n){n=ut(n,mn);const e=ut(n.firestore,Vt),t=tn(e),r=new Xi(e);return j2(t,n._key).then(s=>new al(e,r,n._key,s,new Ro(s!==null&&s.hasLocalMutations,!0),n.converter))}function e9(n){n=ut(n,mn);const e=ut(n.firestore,Vt);return iI(tn(e),n._key,{source:"server"}).then(t=>bg(e,n,t))}function Pt(n){n=ut(n,Fn);const e=ut(n.firestore,Vt),t=tn(e),r=new Xi(e);return _I(n._query),oI(t,n._query).then(s=>new ll(e,r,n,s))}function t9(n){n=ut(n,Fn);const e=ut(n.firestore,Vt),t=tn(e),r=new Xi(e);return q2(t,n._query).then(s=>new ll(e,r,n,s))}function n9(n){n=ut(n,Fn);const e=ut(n.firestore,Vt),t=tn(e),r=new Xi(e);return oI(t,n._query,{source:"server"}).then(s=>new ll(e,r,n,s))}function sn(n,e,t){n=ut(n,mn);const r=ut(n.firestore,Vt),s=Kh(n.converter,e,t);return bc(r,[Fh(Zo(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Jt.none())])}function El(n,e,t,...r){n=ut(n,mn);const s=ut(n.firestore,Vt),i=Zo(s);let o;return o=typeof(e=je(e))=="string"||e instanceof Yo?gg(i,"updateDoc",n._key,e,t,r):mg(i,"updateDoc",n._key,e),bc(s,[o.toMutation(n._key,Jt.exists(!0))])}function ul(n){return bc(ut(n.firestore,Vt),[new vl(n._key,Jt.none())])}function Tl(n,e){const t=ut(n.firestore,Vt),r=Re(n),s=Kh(n.converter,e);return bc(t,[Fh(Zo(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Jt.exists(!1))]).then(()=>r)}function r9(n,...e){var t,r,s;n=je(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Fp(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Fp(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,c,h;if(n instanceof mn)c=ut(n.firestore,Vt),h=ml(n._key.path),l={next:f=>{e[o]&&e[o](bg(c,n,f))},error:e[o+1],complete:e[o+2]};else{const f=ut(n,Fn);c=ut(f.firestore,Vt),h=f._query;const g=new Xi(c);l={next:y=>{e[o]&&e[o](new ll(c,g,f,y))},error:e[o+1],complete:e[o+2]},_I(n._query)}return function(g,y,I,S){const E=new Vh(S),$=new eg(y,E,I);return g.asyncQueue.enqueueAndForget(async()=>Ym(await ol(g),$)),()=>{E.Za(),g.asyncQueue.enqueueAndForget(async()=>Xm(await ol(g),$))}}(tn(c),h,a,l)}function s9(n,e){return z2(tn(n=ut(n,Vt)),Fp(e)?e:{next:e})}function bc(n,e){return function(r,s){const i=new Cn;return r.asyncQueue.enqueueAndForget(async()=>y2(await lg(r),s,i)),i.promise}(tn(n),e)}function bg(n,e,t){const r=t.docs.get(e._key),s=new Xi(n);return new al(n,s,e._key,r,new Ro(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i9(n){return dD(n,{count:uD()})}function dD(n,e){const t=ut(n.firestore,Vt),r=tn(t),s=Tw(e,(i,o)=>new tx(o,i.aggregateType,i._internalFieldPath));return B2(r,n._query,s).then(i=>function(a,l,c){const h=new Xi(a);return new tD(l,h,c)}(t,n,i))}class hD{constructor(e){this.kind="memory",this._onlineComponentProvider=zi.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=Bi.provider}toJSON(){return{kind:this.kind}}}class fD{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=yD(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class pD{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Bi.provider}toJSON(){return{kind:this.kind}}}class mD{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new V2(e)}}toJSON(){return{kind:this.kind}}}function o9(){return new pD}function a9(n){return new mD(n==null?void 0:n.cacheSizeBytes)}function l9(n){return new hD(n)}function u9(n){return new fD(n)}class gD{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=zi.provider,this._offlineComponentProvider={build:t=>new og(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class vD{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=zi.provider,this._offlineComponentProvider={build:t=>new tI(t,e==null?void 0:e.cacheSizeBytes)}}}function yD(n){return new gD(n==null?void 0:n.forceOwnership)}function c9(){return new vD}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _D={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bD{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Zo(e)}set(e,t,r){this._verifyNotCommitted();const s=Ii(e,this._firestore),i=Kh(s.converter,t,r),o=Fh(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,Jt.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=Ii(e,this._firestore);let o;return o=typeof(t=je(t))=="string"||t instanceof Yo?gg(this._dataReader,"WriteBatch.update",i._key,t,r,s):mg(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Jt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Ii(e,this._firestore);return this._mutations=this._mutations.concat(new vl(t._key,Jt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new pe(Q.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Ii(n,e){if((n=je(n)).firestore!==e)throw new pe(Q.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wD extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Zo(t)}get(t){const r=Ii(t,this._firestore),s=new lD(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return Ve();const o=i[0];if(o.isFoundDocument())return new Hu(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new Hu(this._firestore,s,r._key,null,r.converter);throw Ve()})}set(t,r,s){const i=Ii(t,this._firestore),o=Kh(i.converter,r,s),a=Fh(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=Ii(t,this._firestore);let a;return a=typeof(r=je(r))=="string"||r instanceof Yo?gg(this._dataReader,"Transaction.update",o._key,r,s,i):mg(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=Ii(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Ii(e,this._firestore),r=new Xi(this._firestore);return super.get(e).then(s=>new al(this._firestore,r,t._key,s._document,new Ro(!1,!1),t.converter))}}function h9(n,e,t){n=ut(n,Vt);const r=Object.assign(Object.assign({},_D),t);return function(i){if(i.maxAttempts<1)throw new pe(Q.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new Cn;return i.asyncQueue.enqueueAndForget(async()=>{const c=await sI(i);new L2(i.asyncQueue,c,a,o,l).au()}),l.promise}(tn(n),s=>e(new wD(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f9(){return new vc("deleteField")}function Zi(){return new dg("serverTimestamp")}function xD(...n){return new hg("arrayUnion",n)}function p9(...n){return new fg("arrayRemove",n)}function m9(n){return new pg("increment",n)}function g9(n){return new Lh(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wg(n){return tn(n=ut(n,Vt)),new bD(n,e=>bc(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v9(n,e){const t=tn(n=ut(n,Vt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return kr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(c){try{return JSON.parse(c)}catch(h){throw new pe(Q.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const c=j0(l,"collectionGroup"),h=[];if(Array.isArray(l.fields))for(const f of l.fields){const g=Uh("setIndexConfiguration",j0(f,"fieldPath"));f.arrayConfig==="CONTAINS"?h.push(new Vo(g,2)):f.order==="ASCENDING"?h.push(new Vo(g,0)):f.order==="DESCENDING"&&h.push(new Vo(g,1))}a.push(new Wa(Wa.UNKNOWN_ID,c,h,Qa.empty()))}return a}(e);return H2(t,r)}function j0(n,e){if(typeof n[e]!="string")throw new pe(Q.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ID{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function y9(n){var e;n=ut(n,Vt);const t=q0.get(n);if(t)return t;if(((e=tn(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new ID(n);return q0.set(n,r),r}function _9(n){EI(n,!0)}function b9(n){EI(n,!1)}function w9(n){Q2(tn(n._firestore)).then(e=>fe("deleting all persistent cache indexes succeeded")).catch(e=>kr("deleting all persistent cache indexes failed",e))}function EI(n,e){W2(tn(n._firestore),e).then(t=>fe(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>kr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const q0=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x9(n){var e;const t=(e=tn(ut(n.firestore,Vt))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:Ph(t,Wn(n._query))._t}function I9(n,e){var t;const r=Tw(e,(i,o)=>new tx(o,i.aggregateType,i._internalFieldPath)),s=(t=tn(ut(n.firestore,Vt))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:px(s,Fw(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E9{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return xg.instance.onExistenceFilterMismatch(e)}}class xg{constructor(){this.Uu=new Map}static get instance(){return rd||(rd=new xg,function(t){if(qd)throw new Error("a TestingHooksSpi instance is already set");qd=t}(rd)),rd}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let rd=null;(function(e,t=!0){(function(s){pl=s})(fl),us(new Br("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Vt(new KR(r.getProvider("auth-internal")),new WR(r.getProvider("app-check-internal")),function(c,h){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new pe(Q.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Lo(c.options.projectId,h)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Rr(ky,"4.7.3",e),Rr(ky,"4.7.3","esm2017")})();function Ig(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T9={PHONE:"phone",TOTP:"totp"},A9={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},S9={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},P9={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},R9={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ED(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function TI(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const C9=ED,TD=TI,AI=new Jo("auth","Firebase",TI()),k9={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zd=new bm("@firebase/auth");function AD(n,...e){Zd.logLevel<=ht.WARN&&Zd.warn(`Auth (${fl}): ${n}`,...e)}function xd(n,...e){Zd.logLevel<=ht.ERROR&&Zd.error(`Auth (${fl}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fr(n,...e){throw Tg(n,...e)}function er(n,...e){return Tg(n,...e)}function Eg(n,e,t){const r=Object.assign(Object.assign({},TD()),{[e]:t});return new Jo("auth","Firebase",r).create(e,{appName:n.name})}function kn(n){return Eg(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Al(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&fr(n,"argument-error"),Eg(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Tg(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return AI.create(n,...e)}function Ee(n,e,...t){if(!n)throw Tg(e,...t)}function rs(n){const e="INTERNAL ASSERTION FAILED: "+n;throw xd(e),new Error(e)}function Bs(n,e){n||rs(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qu(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Ag(){return B0()==="http:"||B0()==="https:"}function B0(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SD(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Ag()||IP()||"connection"in navigator)?navigator.onLine:!0}function PD(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wc{constructor(e,t){this.shortDelay=e,this.longDelay=t,Bs(t>e,"Short delay should be less than long delay!"),this.isMobile=bP()||EP()}get(){return SD()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sg(n,e){Bs(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SI{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;rs("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;rs("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;rs("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RD={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CD=new wc(3e4,6e4);function zt(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Kt(n,e,t,r,s={}){return PI(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=hl(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},i);return xP()||(c.referrerPolicy="no-referrer"),SI.fetch()(RI(n,n.config.apiHost,t,a),c)})}async function PI(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},RD),e);try{const s=new DD(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw uu(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw uu(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw uu(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw uu(n,"user-disabled",o);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw Eg(n,h,c);fr(n,h)}}catch(s){if(s instanceof ds)throw s;fr(n,"network-request-failed",{message:String(s)})}}async function Ys(n,e,t,r,s={}){const i=await Kt(n,e,t,r,s);return"mfaPendingCredential"in i&&fr(n,"multi-factor-auth-required",{_serverResponse:i}),i}function RI(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?Sg(n.config,s):`${n.config.apiScheme}://${s}`}function kD(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class DD{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(er(this.auth,"network-request-failed")),CD.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function uu(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=er(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z0(n){return n!==void 0&&n.getResponse!==void 0}function K0(n){return n!==void 0&&n.enterprise!==void 0}class CI{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return kD(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ND(n){return(await Kt(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function kI(n,e){return Kt(n,"GET","/v2/recaptchaConfig",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VD(n,e){return Kt(n,"POST","/v1/accounts:delete",e)}async function OD(n,e){return Kt(n,"POST","/v1/accounts:update",e)}async function DI(n,e){return Kt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eu(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D9(n,e=!1){return je(n).getIdToken(e)}async function MD(n,e=!1){const t=je(n),r=await t.getIdToken(e),s=Gh(r);Ee(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Eu(zf(s.auth_time)),issuedAtTime:Eu(zf(s.iat)),expirationTime:Eu(zf(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function zf(n){return Number(n)*1e3}function Gh(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return xd("JWT malformed, contained fewer than 3 sections"),null;try{const s=Wb(t);return s?JSON.parse(s):(xd("Failed to decode base64 JWT payload"),null)}catch(s){return xd("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function G0(n){const e=Gh(n);return Ee(e,"internal-error"),Ee(typeof e.exp<"u","internal-error"),Ee(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zs(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof ds&&LD(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function LD({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $D{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Up{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Eu(this.lastLoginAt),this.creationTime=Eu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ju(n){var e;const t=n.auth,r=await n.getIdToken(),s=await zs(n,DI(t,{idToken:r}));Ee(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?NI(i.providerUserInfo):[],a=UD(n.providerData,o),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),h=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Up(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,f)}async function FD(n){const e=je(n);await Ju(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function UD(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function NI(n){return n.map(e=>{var{providerId:t}=e,r=Ig(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jD(n,e){const t=await PI(n,{},async()=>{const r=hl({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=RI(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",SI.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function qD(n,e){return Kt(n,"POST","/v2/accounts:revokeToken",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fa{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ee(e.idToken,"internal-error"),Ee(typeof e.idToken<"u","internal-error"),Ee(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):G0(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ee(e.length!==0,"internal-error");const t=G0(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Ee(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await jD(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new Fa;return r&&(Ee(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(Ee(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(Ee(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Fa,this.toJSON())}_performRefresh(){return rs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gi(n,e){Ee(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Cs{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=Ig(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new $D(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Up(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await zs(this,this.stsTokenManager.getToken(this.auth,e));return Ee(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return MD(this,e)}reload(){return FD(this)}_assign(e){this!==e&&(Ee(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Cs(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Ee(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Ju(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(hn(this.auth.app))return Promise.reject(kn(this.auth));const e=await this.getIdToken();return await zs(this,VD(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,c,h;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,g=(s=t.email)!==null&&s!==void 0?s:void 0,y=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,I=(o=t.photoURL)!==null&&o!==void 0?o:void 0,S=(a=t.tenantId)!==null&&a!==void 0?a:void 0,E=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,$=(c=t.createdAt)!==null&&c!==void 0?c:void 0,F=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:M,emailVerified:L,isAnonymous:re,providerData:W,stsTokenManager:x}=t;Ee(M&&x,e,"internal-error");const b=Fa.fromJSON(this.name,x);Ee(typeof M=="string",e,"internal-error"),gi(f,e.name),gi(g,e.name),Ee(typeof L=="boolean",e,"internal-error"),Ee(typeof re=="boolean",e,"internal-error"),gi(y,e.name),gi(I,e.name),gi(S,e.name),gi(E,e.name),gi($,e.name),gi(F,e.name);const A=new Cs({uid:M,auth:e,email:g,emailVerified:L,displayName:f,isAnonymous:re,photoURL:I,phoneNumber:y,tenantId:S,stsTokenManager:b,createdAt:$,lastLoginAt:F});return W&&Array.isArray(W)&&(A.providerData=W.map(C=>Object.assign({},C))),E&&(A._redirectEventId=E),A}static async _fromIdTokenResponse(e,t,r=!1){const s=new Fa;s.updateFromServerResponse(t);const i=new Cs({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Ju(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];Ee(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?NI(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new Fa;a.updateFromIdToken(r);const l=new Cs({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Up(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H0=new Map;function ks(n){Bs(n instanceof Function,"Expected a class definition");let e=H0.get(n);return e?(Bs(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,H0.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VI{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}VI.type="NONE";const W0=VI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Id(n,e,t){return`firebase:${n}:${e}:${t}`}class Ua{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Id(this.userKey,s.apiKey,i),this.fullPersistenceKey=Id("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Cs._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Ua(ks(W0),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||ks(W0);const o=Id(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const h=await c._get(o);if(h){const f=Cs._fromJSON(e,h);c!==i&&(a=f),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Ua(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new Ua(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q0(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if($I(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(OI(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(UI(e))return"Blackberry";if(jI(e))return"Webos";if(MI(e))return"Safari";if((e.includes("chrome/")||LI(e))&&!e.includes("edge/"))return"Chrome";if(FI(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function OI(n=xn()){return/firefox\//i.test(n)}function MI(n=xn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function LI(n=xn()){return/crios\//i.test(n)}function $I(n=xn()){return/iemobile/i.test(n)}function FI(n=xn()){return/android/i.test(n)}function UI(n=xn()){return/blackberry/i.test(n)}function jI(n=xn()){return/webos/i.test(n)}function Pg(n=xn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function BD(n=xn()){var e;return Pg(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function zD(){return TP()&&document.documentMode===10}function qI(n=xn()){return Pg(n)||FI(n)||jI(n)||UI(n)||/windows phone/i.test(n)||$I(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BI(n,e=[]){let t;switch(n){case"Browser":t=Q0(xn());break;case"Worker":t=`${Q0(xn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${fl}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KD{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GD(n,e={}){return Kt(n,"GET","/v2/passwordPolicy",zt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HD=6;class WD{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:HD,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QD{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new J0(this),this.idTokenSubscription=new J0(this),this.beforeStateQueue=new KD(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=AI,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ks(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await Ua.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await DI(this,{idToken:e}),r=await Cs._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(hn(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return Ee(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ju(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=PD()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(hn(this.app))return Promise.reject(kn(this));const t=e?je(e):null;return t&&Ee(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ee(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return hn(this.app)?Promise.reject(kn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return hn(this.app)?Promise.reject(kn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ks(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await GD(this),t=new WD(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Jo("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await qD(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ks(e)||this._popupRedirectResolver;Ee(t,this,"argument-error"),this.redirectPersistenceManager=await Ua.create(this,[ks(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ee(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ee(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=BI(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&AD(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function an(n){return je(n)}class J0{constructor(e){this.auth=e,this.observer=null,this.addObserver=kP(t=>this.observer=t)}get next(){return Ee(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function JD(n){xc=n}function Rg(n){return xc.loadJS(n)}function YD(){return xc.recaptchaV2Script}function XD(){return xc.recaptchaEnterpriseScript}function ZD(){return xc.gapiScript}function zI(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const eN="recaptcha-enterprise",tN="NO_RECAPTCHA";class KI{constructor(e){this.type=eN,this.auth=an(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{kI(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new CI(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;K0(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(tN)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&K0(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=XD();l.length!==0&&(l+=a),Rg(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function Y0(n,e,t,r=!1){const s=new KI(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Yu(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Y0(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await Y0(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function nN(n){const e=an(n),t=await kI(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new CI(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new KI(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rN(n,e){const t=Hi(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Li(i,e??{}))return s;fr(s,"already-initialized")}return t.initialize({options:e})}function sN(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(ks);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function iN(n,e,t){const r=an(n);Ee(r._canInitEmulator,r,"emulator-config-failed"),Ee(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=GI(e),{host:o,port:a}=oN(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||aN()}function GI(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function oN(n){const e=GI(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:X0(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:X0(o)}}}function X0(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function aN(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ic{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return rs("not implemented")}_getIdTokenResponse(e){return rs("not implemented")}_linkToIdToken(e,t){return rs("not implemented")}_getReauthenticationResolver(e){return rs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HI(n,e){return Kt(n,"POST","/v1/accounts:resetPassword",zt(n,e))}async function lN(n,e){return Kt(n,"POST","/v1/accounts:update",e)}async function uN(n,e){return Kt(n,"POST","/v1/accounts:signUp",e)}async function cN(n,e){return Kt(n,"POST","/v1/accounts:update",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dN(n,e){return Ys(n,"POST","/v1/accounts:signInWithPassword",zt(n,e))}async function Hh(n,e){return Kt(n,"POST","/v1/accounts:sendOobCode",zt(n,e))}async function hN(n,e){return Hh(n,e)}async function fN(n,e){return Hh(n,e)}async function pN(n,e){return Hh(n,e)}async function mN(n,e){return Hh(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gN(n,e){return Ys(n,"POST","/v1/accounts:signInWithEmailLink",zt(n,e))}async function vN(n,e){return Ys(n,"POST","/v1/accounts:signInWithEmailLink",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xu extends Ic{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Xu(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Xu(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Yu(e,t,"signInWithPassword",dN);case"emailLink":return gN(e,{email:this._email,oobCode:this._password});default:fr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Yu(e,r,"signUpPassword",uN);case"emailLink":return vN(e,{idToken:t,email:this._email,oobCode:this._password});default:fr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ms(n,e){return Ys(n,"POST","/v1/accounts:signInWithIdp",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yN="http://localhost";class Ks extends Ic{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ks(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):fr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=Ig(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new Ks(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Ms(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Ms(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ms(e,t)}buildRequest(){const e={requestUri:yN,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=hl(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _N(n,e){return Kt(n,"POST","/v1/accounts:sendVerificationCode",zt(n,e))}async function bN(n,e){return Ys(n,"POST","/v1/accounts:signInWithPhoneNumber",zt(n,e))}async function wN(n,e){const t=await Ys(n,"POST","/v1/accounts:signInWithPhoneNumber",zt(n,e));if(t.temporaryProof)throw uu(n,"account-exists-with-different-credential",t);return t}const xN={USER_NOT_FOUND:"user-not-found"};async function IN(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return Ys(n,"POST","/v1/accounts:signInWithPhoneNumber",zt(n,t),xN)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oo extends Ic{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Oo({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Oo({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return bN(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return wN(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return IN(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new Oo({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EN(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function TN(n){const e=ru(su(n)).link,t=e?ru(su(e)).deep_link_id:null,r=ru(su(n)).deep_link_id;return(r?ru(su(r)).link:null)||r||t||e||n}class Ec{constructor(e){var t,r,s,i,o,a;const l=ru(su(e)),c=(t=l.apiKey)!==null&&t!==void 0?t:null,h=(r=l.oobCode)!==null&&r!==void 0?r:null,f=EN((s=l.mode)!==null&&s!==void 0?s:null);Ee(c&&h&&f,"argument-error"),this.apiKey=c,this.operation=f,this.code=h,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=TN(e);try{return new Ec(t)}catch{return null}}}function N9(n){return Ec.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ta{constructor(){this.providerId=ta.PROVIDER_ID}static credential(e,t){return Xu._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Ec.parseLink(t);return Ee(r,"argument-error"),Xu._fromEmailAndCode(e,r.code,r.tenantId)}}ta.PROVIDER_ID="password";ta.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ta.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xs{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sl extends Xs{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Ed extends Sl{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return Ee("providerId"in t&&"signInMethod"in t,"argument-error"),Ks._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return Ee(e.idToken||e.accessToken,"argument-error"),Ks._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Ed.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Ed.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new Ed(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ei extends Sl{constructor(){super("facebook.com")}static credential(e){return Ks._fromParams({providerId:Ei.PROVIDER_ID,signInMethod:Ei.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ei.credentialFromTaggedObject(e)}static credentialFromError(e){return Ei.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ei.credential(e.oauthAccessToken)}catch{return null}}}Ei.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ei.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ti extends Sl{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ks._fromParams({providerId:Ti.PROVIDER_ID,signInMethod:Ti.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ti.credentialFromTaggedObject(e)}static credentialFromError(e){return Ti.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Ti.credential(t,r)}catch{return null}}}Ti.GOOGLE_SIGN_IN_METHOD="google.com";Ti.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ai extends Sl{constructor(){super("github.com")}static credential(e){return Ks._fromParams({providerId:Ai.PROVIDER_ID,signInMethod:Ai.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ai.credentialFromTaggedObject(e)}static credentialFromError(e){return Ai.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ai.credential(e.oauthAccessToken)}catch{return null}}}Ai.GITHUB_SIGN_IN_METHOD="github.com";Ai.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AN="http://localhost";class Zu extends Ic{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Ms(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Ms(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ms(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new Zu(r,i)}static _create(e,t){return new Zu(e,t)}buildRequest(){return{requestUri:AN,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SN="saml.";class jp extends Xs{constructor(e){Ee(e.startsWith(SN),"argument-error"),super(e)}static credentialFromResult(e){return jp.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return jp.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Zu.fromJSON(e);return Ee(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Zu._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Si extends Sl{constructor(){super("twitter.com")}static credential(e,t){return Ks._fromParams({providerId:Si.PROVIDER_ID,signInMethod:Si.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Si.credentialFromTaggedObject(e)}static credentialFromError(e){return Si.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Si.credential(t,r)}catch{return null}}}Si.TWITTER_SIGN_IN_METHOD="twitter.com";Si.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WI(n,e){return Ys(n,"POST","/v1/accounts:signUp",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Cs._fromIdTokenResponse(e,r,s),o=Z0(r);return new Dr({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=Z0(r);return new Dr({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function Z0(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PN(n){var e;if(hn(n.app))return Promise.reject(kn(n));const t=an(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new Dr({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await WI(t,{returnSecureToken:!0}),s=await Dr._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eh extends ds{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,eh.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new eh(e,t,r,s)}}function QI(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?eh._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JI(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function V9(n,e){const t=je(n);await Wh(!0,t,e);const{providerUserInfo:r}=await OD(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=JI(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Cg(n,e,t=!1){const r=await zs(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Dr._forOperation(n,"link",r)}async function Wh(n,e,t){await Ju(e);const r=JI(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";Ee(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YI(n,e,t=!1){const{auth:r}=n;if(hn(r.app))return Promise.reject(kn(r));const s="reauthenticate";try{const i=await zs(n,QI(r,s,e,n),t);Ee(i.idToken,r,"internal-error");const o=Gh(i.idToken);Ee(o,r,"internal-error");const{sub:a}=o;return Ee(n.uid===a,r,"user-mismatch"),Dr._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&fr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XI(n,e,t=!1){if(hn(n.app))return Promise.reject(kn(n));const r="signIn",s=await QI(n,r,e),i=await Dr._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function kg(n,e){return XI(an(n),e)}async function RN(n,e){const t=je(n);return await Wh(!1,t,e.providerId),Cg(t,e)}async function CN(n,e){return YI(je(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kN(n,e){return Ys(n,"POST","/v1/accounts:signInWithCustomToken",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function O9(n,e){if(hn(n.app))return Promise.reject(kn(n));const t=an(n),r=await kN(t,{token:e,returnSecureToken:!0}),s=await Dr._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tc{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Dg._fromServerResponse(e,t):"totpInfo"in t?Ng._fromServerResponse(e,t):fr(e,"internal-error")}}class Dg extends Tc{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Dg(t)}}class Ng extends Tc{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Ng(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qh(n,e,t){var r;Ee(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),Ee(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(Ee(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(Ee(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vg(n){const e=an(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function DN(n,e,t){const r=an(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Qh(r,s,t),await Yu(r,s,"getOobCode",fN)}async function NN(n,e,t){await HI(je(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Vg(n),r})}async function M9(n,e){await cN(je(n),{oobCode:e})}async function VN(n,e){const t=je(n),r=await HI(t,{oobCode:e}),s=r.requestType;switch(Ee(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":Ee(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":Ee(r.mfaInfo,t,"internal-error");default:Ee(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Tc._fromServerResponse(an(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function L9(n,e){const{data:t}=await VN(je(n),e);return t.email}async function ON(n,e,t){if(hn(n.app))return Promise.reject(kn(n));const r=an(n),o=await Yu(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",WI).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Vg(n),l}),a=await Dr._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function MN(n,e,t){return hn(n.app)?Promise.reject(kn(n)):kg(je(n),ta.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Vg(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $9(n,e,t){const r=an(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){Ee(a.handleCodeInApp,r,"argument-error"),a&&Qh(r,o,a)}i(s,t),await Yu(r,s,"getOobCode",pN)}function F9(n,e){const t=Ec.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function U9(n,e,t){if(hn(n.app))return Promise.reject(kn(n));const r=je(n),s=ta.credentialWithLink(e,t||Qu());return Ee(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),kg(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LN(n,e){return Kt(n,"POST","/v1/accounts:createAuthUri",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function j9(n,e){const t=Ag()?Qu():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await LN(je(n),r);return s||[]}async function q9(n,e){const t=je(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Qh(t.auth,s,e);const{email:i}=await hN(t.auth,s);i!==n.email&&await n.reload()}async function B9(n,e,t){const r=je(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Qh(r.auth,i,t);const{email:o}=await mN(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $N(n,e){return Kt(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function z9(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=je(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await zs(r,$N(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function FN(n,e){const t=je(n);return hn(t.auth.app)?Promise.reject(kn(t.auth)):ZI(t,e,null)}function UN(n,e){return ZI(je(n),null,e)}async function ZI(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await zs(n,lN(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jN(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=Gh(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new ja(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new qN(i,s);case"github.com":return new BN(i,s);case"google.com":return new zN(i,s);case"twitter.com":return new KN(i,s,n.screenName||null);case"custom":case"anonymous":return new ja(i,null);default:return new ja(i,r,s)}}class ja{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class eE extends ja{constructor(e,t,r,s){super(e,t,r),this.username=s}}class qN extends ja{constructor(e,t){super(e,"facebook.com",t)}}class BN extends eE{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class zN extends ja{constructor(e,t){super(e,"google.com",t)}}class KN extends eE{constructor(e,t,r){super(e,"twitter.com",t,r)}}function K9(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:jN(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GN(n,e){return je(n).setPersistence(e)}function G9(n){return nN(n)}async function H9(n,e){return an(n).validatePassword(e)}function HN(n,e,t,r){return je(n).onIdTokenChanged(e,t,r)}function WN(n,e,t){return je(n).beforeAuthStateChanged(e,t)}function QN(n,e,t,r){return je(n).onAuthStateChanged(e,t,r)}function W9(n){je(n).useDeviceLanguage()}function Q9(n,e){return je(n).updateCurrentUser(e)}function JN(n){return je(n).signOut()}function J9(n,e){return an(n).revokeAccessToken(e)}async function Y9(n){return je(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Co{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new Co("enroll",e,t)}static _fromMfaPendingCredential(e){return new Co("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return Co._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return Co._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Og{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=an(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Tc._fromServerResponse(r,a));Ee(s.mfaPendingCredential,r,"internal-error");const o=Co._fromMfaPendingCredential(s.mfaPendingCredential);return new Og(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const c=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const h=await Dr._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return Ee(t.user,r,"internal-error"),Dr._forOperation(t.user,t.operationType,c);default:fr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function X9(n,e){var t;const r=je(n),s=e;return Ee(e.customData.operationType,r,"argument-error"),Ee((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),Og._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YN(n,e){return Kt(n,"POST","/v2/accounts/mfaEnrollment:start",zt(n,e))}function XN(n,e){return Kt(n,"POST","/v2/accounts/mfaEnrollment:finalize",zt(n,e))}function ZN(n,e){return Kt(n,"POST","/v2/accounts/mfaEnrollment:start",zt(n,e))}function eV(n,e){return Kt(n,"POST","/v2/accounts/mfaEnrollment:finalize",zt(n,e))}function tV(n,e){return Kt(n,"POST","/v2/accounts/mfaEnrollment:withdraw",zt(n,e))}class Mg{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Tc._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new Mg(e)}async getSession(){return Co._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await zs(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await zs(this.user,tV(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const Kf=new WeakMap;function Z9(n){const e=je(n);return Kf.has(e)||Kf.set(e,Mg._fromUser(e)),Kf.get(e)}const th="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tE{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(th,"1"),this.storage.removeItem(th),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nV=1e3,rV=10;class nE extends tE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=qI(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);zD()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,rV):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},nV)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}nE.type="LOCAL";const rE=nE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sE extends tE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}sE.type="SESSION";const iE=sE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sV(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Jh(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await sV(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Jh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yh(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iV{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=Yh("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const g=f;if(g.data.eventId===c)switch(g.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(g.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _n(){return window}function oV(n){_n().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lg(){return typeof _n().WorkerGlobalScope<"u"&&typeof _n().importScripts=="function"}async function aV(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function lV(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function uV(){return Lg()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oE="firebaseLocalStorageDb",cV=1,nh="firebaseLocalStorage",aE="fbase_key";class Ac{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Xh(n,e){return n.transaction([nh],e?"readwrite":"readonly").objectStore(nh)}function dV(){const n=indexedDB.deleteDatabase(oE);return new Ac(n).toPromise()}function qp(){const n=indexedDB.open(oE,cV);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(nh,{keyPath:aE})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(nh)?e(r):(r.close(),await dV(),e(await qp()))})})}async function e_(n,e,t){const r=Xh(n,!0).put({[aE]:e,value:t});return new Ac(r).toPromise()}async function hV(n,e){const t=Xh(n,!1).get(e),r=await new Ac(t).toPromise();return r===void 0?null:r.value}function t_(n,e){const t=Xh(n,!0).delete(e);return new Ac(t).toPromise()}const fV=800,pV=3;class lE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await qp(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>pV)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Lg()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Jh._getInstance(uV()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await aV(),!this.activeServiceWorker)return;this.sender=new iV(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||lV()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await qp();return await e_(e,th,"1"),await t_(e,th),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>e_(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>hV(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>t_(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Xh(s,!1).getAll();return new Ac(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),fV)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}lE.type="LOCAL";const mV=lE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gV(n,e){return Kt(n,"POST","/v2/accounts/mfaSignIn:start",zt(n,e))}function vV(n,e){return Kt(n,"POST","/v2/accounts/mfaSignIn:finalize",zt(n,e))}function yV(n,e){return Kt(n,"POST","/v2/accounts/mfaSignIn:finalize",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _V=500,bV=6e4,sd=1e12;class wV{constructor(e){this.auth=e,this.counter=sd,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new xV(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||sd;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||sd;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||sd;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class xV{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;Ee(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=IV(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},bV)},_V))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function IV(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gf=zI("rcb"),EV=new wc(3e4,6e4);class TV{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=_n().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return Ee(AV(t),e,"argument-error"),this.shouldResolveImmediately(t)&&z0(_n().grecaptcha)?Promise.resolve(_n().grecaptcha):new Promise((r,s)=>{const i=_n().setTimeout(()=>{s(er(e,"network-request-failed"))},EV.get());_n()[Gf]=()=>{_n().clearTimeout(i),delete _n()[Gf];const a=_n().grecaptcha;if(!a||!z0(a)){s(er(e,"internal-error"));return}const l=a.render;a.render=(c,h)=>{const f=l(c,h);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${YD()}?${hl({onload:Gf,render:"explicit",hl:t})}`;Rg(o).catch(()=>{clearTimeout(i),s(er(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=_n().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function AV(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class SV{async load(e){return new wV(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uE="recaptcha",PV={theme:"light",type:"image"};class ez{constructor(e,t,r=Object.assign({},PV)){this.parameters=r,this.type=uE,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=an(e),this.isInvisible=this.parameters.size==="invisible",Ee(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;Ee(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new SV:new TV,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){Ee(!this.parameters.sitekey,this.auth,"argument-error"),Ee(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Ee(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=_n()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){Ee(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Ee(Ag()&&!Lg(),this.auth,"internal-error"),await RV(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await ND(this.auth);Ee(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Ee(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function RV(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $g{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Oo._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function tz(n,e,t){if(hn(n.app))return Promise.reject(kn(n));const r=an(n),s=await Zh(r,e,je(t));return new $g(s,i=>kg(r,i))}async function nz(n,e,t){const r=je(n);await Wh(!1,r,"phone");const s=await Zh(r.auth,e,je(t));return new $g(s,i=>RN(r,i))}async function rz(n,e,t){const r=je(n);if(hn(r.auth.app))return Promise.reject(kn(r.auth));const s=await Zh(r.auth,e,je(t));return new $g(s,i=>CN(r,i))}async function Zh(n,e,t){var r;const s=await t.verify();try{Ee(typeof s=="string",n,"argument-error"),Ee(t.type===uE,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return Ee(o.type==="enroll",n,"internal-error"),(await YN(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{Ee(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return Ee(a,n,"missing-multi-factor-info"),(await gV(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await _N(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function sz(n,e){const t=je(n);if(hn(t.auth.app))return Promise.reject(kn(t.auth));await Cg(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qa{constructor(e){this.providerId=qa.PROVIDER_ID,this.auth=an(e)}verifyPhoneNumber(e,t){return Zh(this.auth,e,je(t))}static credential(e,t){return Oo._fromVerification(e,t)}static credentialFromResult(e){const t=e;return qa.credentialFromTaggedObject(t)}static credentialFromError(e){return qa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Oo._fromTokenResponse(t,r):null}}qa.PROVIDER_ID="phone";qa.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function na(n,e){return e?ks(e):(Ee(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fg extends Ic{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ms(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ms(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ms(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function CV(n){return XI(n.auth,new Fg(n),n.bypassAuthState)}function kV(n){const{auth:e,user:t}=n;return Ee(t,e,"internal-error"),YI(t,new Fg(n),n.bypassAuthState)}async function DV(n){const{auth:e,user:t}=n;return Ee(t,e,"internal-error"),Cg(t,new Fg(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cE{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return CV;case"linkViaPopup":case"linkViaRedirect":return DV;case"reauthViaPopup":case"reauthViaRedirect":return kV;default:fr(this.auth,"internal-error")}}resolve(e){Bs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Bs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NV=new wc(2e3,1e4);async function iz(n,e,t){if(hn(n.app))return Promise.reject(er(n,"operation-not-supported-in-this-environment"));const r=an(n);Al(n,e,Xs);const s=na(r,t);return new Ds(r,"signInViaPopup",e,s).executeNotNull()}async function oz(n,e,t){const r=je(n);if(hn(r.auth.app))return Promise.reject(er(r.auth,"operation-not-supported-in-this-environment"));Al(r.auth,e,Xs);const s=na(r.auth,t);return new Ds(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function az(n,e,t){const r=je(n);Al(r.auth,e,Xs);const s=na(r.auth,t);return new Ds(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class Ds extends cE{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Ds.currentPopupAction&&Ds.currentPopupAction.cancel(),Ds.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ee(e,this.auth,"internal-error"),e}async onExecution(){Bs(this.filter.length===1,"Popup operations only handle one event");const e=Yh();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(er(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(er(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ds.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(er(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,NV.get())};e()}}Ds.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VV="pendingRedirect",Td=new Map;class OV extends cE{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Td.get(this.auth._key());if(!e){try{const r=await MV(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Td.set(this.auth._key(),e)}return this.bypassAuthState||Td.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function MV(n,e){const t=hE(e),r=dE(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function Ug(n,e){return dE(n)._set(hE(e),"true")}function LV(n,e){Td.set(n._key(),e)}function dE(n){return ks(n._redirectPersistence)}function hE(n){return Id(VV,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lz(n,e,t){return $V(n,e,t)}async function $V(n,e,t){if(hn(n.app))return Promise.reject(kn(n));const r=an(n);Al(n,e,Xs),await r._initializationPromise;const s=na(r,t);return await Ug(s,r),s._openRedirect(r,e,"signInViaRedirect")}function uz(n,e,t){return FV(n,e,t)}async function FV(n,e,t){const r=je(n);if(Al(r.auth,e,Xs),hn(r.auth.app))return Promise.reject(kn(r.auth));await r.auth._initializationPromise;const s=na(r.auth,t);await Ug(s,r.auth);const i=await pE(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function cz(n,e,t){return UV(n,e,t)}async function UV(n,e,t){const r=je(n);Al(r.auth,e,Xs),await r.auth._initializationPromise;const s=na(r.auth,t);await Wh(!1,r,e.providerId),await Ug(s,r.auth);const i=await pE(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function dz(n,e){return await an(n)._initializationPromise,fE(n,e,!1)}async function fE(n,e,t=!1){if(hn(n.app))return Promise.reject(kn(n));const r=an(n),s=na(r,e),o=await new OV(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function pE(n){const e=Yh(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jV=10*60*1e3;class qV{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!BV(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!mE(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(er(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=jV&&this.cachedEventUids.clear(),this.cachedEventUids.has(n_(e))}saveEventToCache(e){this.cachedEventUids.add(n_(e)),this.lastProcessedEventTime=Date.now()}}function n_(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function mE({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function BV(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return mE(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zV(n,e={}){return Kt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KV=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,GV=/^https?/;async function HV(n){if(n.config.emulator)return;const{authorizedDomains:e}=await zV(n);for(const t of e)try{if(WV(t))return}catch{}fr(n,"unauthorized-domain")}function WV(n){const e=Qu(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!GV.test(t))return!1;if(KV.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QV=new wc(3e4,6e4);function r_(){const n=_n().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function JV(n){return new Promise((e,t)=>{var r,s,i;function o(){r_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{r_(),t(er(n,"network-request-failed"))},timeout:QV.get()})}if(!((s=(r=_n().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=_n().gapi)===null||i===void 0)&&i.load)o();else{const a=zI("iframefcb");return _n()[a]=()=>{gapi.load?o():t(er(n,"network-request-failed"))},Rg(`${ZD()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw Ad=null,e})}let Ad=null;function YV(n){return Ad=Ad||JV(n),Ad}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XV=new wc(5e3,15e3),ZV="__/auth/iframe",eO="emulator/auth/iframe",tO={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},nO=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function rO(n){const e=n.config;Ee(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Sg(e,eO):`https://${n.config.authDomain}/${ZV}`,r={apiKey:e.apiKey,appName:n.name,v:fl},s=nO.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${hl(r).slice(1)}`}async function sO(n){const e=await YV(n),t=_n().gapi;return Ee(t,n,"internal-error"),e.open({where:document.body,url:rO(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:tO,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=er(n,"network-request-failed"),a=_n().setTimeout(()=>{i(o)},XV.get());function l(){_n().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iO={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},oO=500,aO=600,lO="_blank",uO="http://localhost";class s_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function cO(n,e,t,r=oO,s=aO){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},iO),{width:r.toString(),height:s.toString(),top:i,left:o}),c=xn().toLowerCase();t&&(a=LI(c)?lO:t),OI(c)&&(e=e||uO,l.scrollbars="yes");const h=Object.entries(l).reduce((g,[y,I])=>`${g}${y}=${I},`,"");if(BD(c)&&a!=="_self")return dO(e||"",a),new s_(null);const f=window.open(e||"",a,h);Ee(f,n,"popup-blocked");try{f.focus()}catch{}return new s_(f)}function dO(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hO="__/auth/handler",fO="emulator/auth/handler",pO=encodeURIComponent("fac");async function i_(n,e,t,r,s,i){Ee(n.config.authDomain,n,"auth-domain-config-required"),Ee(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:fl,eventId:s};if(e instanceof Xs){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",CP(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))o[h]=f}if(e instanceof Sl){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),c=l?`#${pO}=${encodeURIComponent(l)}`:"";return`${mO(n)}?${hl(a).slice(1)}${c}`}function mO({config:n}){return n.emulator?Sg(n,fO):`https://${n.authDomain}/${hO}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hf="webStorageSupport";class gO{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=iE,this._completeRedirectFn=fE,this._overrideRedirectResult=LV}async _openPopup(e,t,r,s){var i;Bs((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await i_(e,t,r,Qu(),s);return cO(e,o,Yh())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await i_(e,t,r,Qu(),s);return oV(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Bs(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await sO(e),r=new qV(e);return t.register("authEvent",s=>(Ee(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Hf,{type:Hf},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[Hf];o!==void 0&&t(!!o),fr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=HV(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return qI()||MI()||Pg()}}const vO=gO;class gE{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return rs("unexpected MultiFactorSessionType")}}}class jg extends gE{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new jg(e)}_finalizeEnroll(e,t,r){return XN(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return vV(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class yO{constructor(){}static assertion(e){return jg._fromCredential(e)}}yO.FACTOR_ID="phone";class _O{static assertionForEnrollment(e,t){return ec._fromSecret(e,t)}static assertionForSignIn(e,t){return ec._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;Ee(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await ZN(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return qg._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}_O.FACTOR_ID="totp";class ec extends gE{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new ec(t,void 0,e)}static _fromEnrollmentId(e,t){return new ec(t,e)}async _finalizeEnroll(e,t,r){return Ee(typeof this.secret<"u",e,"argument-error"),eV(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){Ee(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return yV(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class qg{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new qg(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(id(e)||id(t))&&(s=!0),s&&(id(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),id(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function id(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var o_="@firebase/auth",a_="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bO{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ee(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wO(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function xO(n){us(new Br("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;Ee(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:BI(n)},c=new QD(r,s,i,l);return sN(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),us(new Br("auth-internal",e=>{const t=an(e.getProvider("auth").getImmediate());return(r=>new bO(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Rr(o_,a_,wO(n)),Rr(o_,a_,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IO=5*60,EO=Yb("authIdTokenMaxAge")||IO;let l_=null;const TO=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>EO)return;const s=t==null?void 0:t.token;l_!==s&&(l_=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function AO(n=xm()){const e=Hi(n,"auth");if(e.isInitialized())return e.getImmediate();const t=rN(n,{popupRedirectResolver:vO,persistence:[mV,rE,iE]}),r=Yb("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=TO(i.toString());WN(t,o,()=>o(t.currentUser)),HN(t,a=>o(a))}}const s=Qb("auth");return s&&iN(t,`http://${s}`),t}function SO(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}JD({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=er("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",SO().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});xO("Browser");const PO={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},ef=nw(PO),le=Z2(ef),Be=AO(ef);try{eD(le)}catch{}try{GN(Be,rE)}catch{}QN(Be,n=>{n||PN(Be)});async function RO(n,e){try{return(await ON(Be,n,e)).user}catch(t){throw t}}async function vE(n,e){try{return(await MN(Be,n,e)).user}catch(t){throw t}}async function Bg(n){try{await DN(Be,n)}catch(e){throw e}}async function CO(n){try{const e=Be.currentUser;if(e)await UN(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const Ni=Object.freeze(Object.defineProperty({__proto__:null,app:ef,auth:Be,createPlayerAccount:RO,db:le,resetPlayerPassword:Bg,signInPlayer:vE,updatePlayerPassword:CO},Symbol.toStringTag,{value:"Module"})),Pl="seasons";async function kO(n,e,t){return await Tl(et(le,Pl),{name:n,slug:e,pinCode:t,createdAt:Zi()})}async function DO(n){return await ul(Re(le,Pl,n))}async function Sd(){const n=Wu(et(le,Pl),aD("createdAt","desc"));return(await Pt(n)).docs.map(t=>({id:t.id,...t.data()}))}async function rh(n,e){const t=await Ut(Re(le,Pl,n));return t.exists()?t.data().pinCode===e:!1}async function Bp(n){const e=await Ut(Re(le,Pl,n));return e.exists()?e.data().pinCode:null}async function eu(n,e){const t=Re(le,Pl,n);await El(t,{sortOrder:e})}const NO=["pin","pinCode","password","motdepasse","mdp","token","oobCode","apiKey","apikey","key","secret","authorization","auth","bearer"];function VO(){var t,r,s,i;const n=((r=(t=import.meta)==null?void 0:t.env)==null?void 0:r.MODE)==="development"?"debug":"warn";return((i=(s=import.meta)==null?void 0:s.env)==null?void 0:i.VITE_LOG_LEVEL)||n}function yE(n){switch(n){case"debug":return 10;case"info":return 20;case"warn":return 30;case"error":return 40;case"silent":return 100;default:return 30}}function OO(n){return typeof n!="string"?n:n.length<=2?"••":n.length>=8?`${n.slice(0,2)}••••${n.slice(-2)}`:"••••"}function _E(n){if(!n)return!1;const e=String(n).toLowerCase();return NO.some(t=>e.includes(t.toLowerCase()))}function zp(n){if(n==null)return n;if(typeof n=="string"){if(n.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){const[r,s]=n.split("@"),i=r.length<=2?"••":`${r.slice(0,2)}••`,o=s.split("."),a=o[0].length<=2?"••":`${o[0].slice(0,2)}••`;return`${i}@${a}.${o.slice(1).join(".")}`}return n.length>=12&&!/\s/.test(n)?OO(n):n}if(typeof n=="number"){const e=String(n);return/^\d{4,6}$/.test(e)?"••••":n}if(Array.isArray(n))return n.map(e=>zp(e));if(typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=_E(t)?"••••":zp(r);return e}return n}function MO(n){const e=[];for(let t=0;t<n.length;t+=1){const r=n[t],s=t>0?n[t-1]:null;if(typeof s=="string"&&_E(s)&&(typeof r=="string"||typeof r=="number")){e.push("••••");continue}e.push(zp(r))}return e}const LO=yE(VO());function od(n,e){const t=yE(n);return(...r)=>{if(t<LO)return;const s=MO(r);console[e](...s)}}const ae={debug:od("debug","log"),info:od("info","info"),warn:od("warn","warn"),error:od("error","error")},zg="lastVisitedSeason",bE="lastVisitedSeasonTimestamp";async function $O(n){if(n)try{const e=Be.currentUser,t=e==null?void 0:e.email;try{localStorage.setItem(zg,n),localStorage.setItem(bE,Date.now().toString())}catch(r){ae.warn("Erreur lors de la sauvegarde localStorage",r)}if(t)try{const r=Re(le,"userPreferences",t);await sn(r,{lastVisitedSeason:n,lastVisitedSeasonTimestamp:Date.now()},{merge:!0}),ae.debug("Préférence de saison sauvegardée dans Firebase",{seasonSlug:n,userEmail:t})}catch(r){ae.warn("Erreur lors de la sauvegarde Firebase",r)}}catch(e){ae.error("Erreur lors de la mémorisation de la saison",e)}}async function wE(){try{const n=Be.currentUser,e=n==null?void 0:n.email;if(e)try{const t=Re(le,"userPreferences",e),r=await Ut(t);if(r.exists()){const s=r.data();if(s.lastVisitedSeason)return ae.debug("Préférence de saison récupérée depuis Firebase",{seasonSlug:s.lastVisitedSeason}),s.lastVisitedSeason}}catch(t){ae.warn("Erreur lors de la récupération Firebase",t)}try{const t=localStorage.getItem(zg);if(t)return ae.debug("Préférence de saison récupérée depuis localStorage",{seasonSlug:t}),t}catch(t){ae.warn("Erreur lors de la lecture localStorage",t)}return null}catch(n){return ae.error("Erreur lors de la récupération de la dernière saison",n),null}}async function FO(n=null){var e;try{const t=n||((e=Be.currentUser)==null?void 0:e.email);try{localStorage.removeItem(zg),localStorage.removeItem(bE)}catch(r){ae.warn("Erreur lors du nettoyage localStorage",r)}if(t)try{const r=Re(le,"userPreferences",t);await sn(r,{lastVisitedSeason:null,lastVisitedSeasonTimestamp:null},{merge:!0}),ae.debug("Préférence de saison nettoyée dans Firebase",{userEmail:t})}catch(r){ae.warn("Erreur lors du nettoyage Firebase",r)}}catch(t){ae.error("Erreur lors du nettoyage des préférences",t)}}function UO(n,e){return!n||!e||!Array.isArray(e)?!1:e.some(t=>t.slug===n)}const jO={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center"},qO={class:"text-center"},BO={class:"text-white text-lg"},zO={__name:"SeasonResolver",setup(n){const e=dl(),t=P("Chargement...");return fn(async()=>{try{t.value="Vérification de votre session...",await new Promise(o=>{const a=Be.onAuthStateChanged(l=>{a(),o(l)})});const r=Be.currentUser,s=r==null?void 0:r.email;if(!s){ae.info("Utilisateur non connecté, redirection vers /seasons"),e.replace("/seasons");return}t.value="Récupération de vos préférences...";const i=await wE();if(!i){ae.info("Aucune saison mémorisée, redirection vers /seasons"),e.replace("/seasons");return}t.value="Vérification de la saison...";try{const o=await Sd();if(!UO(i,o)){ae.info("Saison mémorisée n'existe plus, redirection vers /seasons"),await FO(s),e.replace("/seasons");return}}catch(o){ae.error("Erreur lors de la vérification des saisons",o),e.replace("/seasons");return}ae.info("Redirection vers la saison mémorisée",{seasonSlug:i}),e.replace(`/season/${i}`)}catch(r){ae.error("Erreur lors de la résolution de la saison",r),e.replace("/seasons")}}),(r,s)=>(D(),V("div",jO,[d("div",qO,[s[0]||(s[0]=d("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"},null,-1)),d("p",BO,se(t.value),1)])]))}},KO="/logos/hatcast-mask.png",xE="/logos/hatcast-logo-mobile.png",Wf=7*24*60*60*1e3,tu="impro_selector_pin_session";class GO{constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(tu);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<Wf){try{t.timestamp=Date.now(),localStorage.setItem(tu,JSON.stringify(t))}catch{}return t}else this.clearSession()}}catch{console.error("Erreur lors du chargement de la session PIN")}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(tu,JSON.stringify(r)),this.sessionData=r}catch{console.error("Erreur lors de la sauvegarde de la session PIN")}}isPinCached(e){if(!this.sessionData)return!1;const t=this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<Wf;if(t)try{this.sessionData.timestamp=Date.now(),localStorage.setItem(tu,JSON.stringify(this.sessionData))}catch{}return t}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(tu),this.sessionData=null}catch{console.error("Erreur lors de la suppression de la session PIN")}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=Wf-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const Vn=new GO,HO={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},WO={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},QO={class:"text-center mb-6"},JO={class:"text-gray-300"},YO={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},XO={class:"text-sm text-green-400"},ZO={class:"mb-6"},eM={class:"mb-4"},tM={key:0,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},nM={class:"flex justify-end space-x-3"},rM=["disabled"],IE={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=P(""),i=P(""),o=P(null);wt(()=>t.show,h=>{h&&(s.value="",i.value="",Ht(()=>{var f;(f=o.value)==null||f.focus()}))});function a(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function l(){s.value.length===4&&r("submit",s.value)}function c(){r("cancel")}return(h,f)=>n.show?(D(),V("div",HO,[d("div",WO,[d("div",QO,[f[1]||(f[1]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔒")],-1)),f[2]||(f[2]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),d("p",JO,se(n.message),1),n.sessionInfo?(D(),V("div",YO,[d("p",XO," Session active : "+se(n.sessionInfo.timeRemaining)+" min restantes ",1)])):ce("",!0)]),d("div",ZO,[d("div",eM,[f[3]||(f[3]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),at(d("input",{"onUpdate:modelValue":f[0]||(f[0]=g=>s.value=g),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:a,onKeydown:[qn(l,["enter"]),qn(c,["escape"])],ref_key:"pinInput",ref:o},null,544),[[Lt,s.value]])]),f[4]||(f[4]=d("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))]),i.value||t.error?(D(),V("div",tM,se(i.value||t.error),1)):ce("",!0),d("div",nM,[d("button",{onClick:c,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:l,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,rM)])])])):ce("",!0)}},u_="impro_selector_trusted_players",c_=180*24*60*60*1e3;class sM{constructor(){this.trustedMap=this.load()}load(){try{const e=localStorage.getItem(u_);if(!e)return{};const t=JSON.parse(e);return typeof t=="object"&&t!==null?t:{}}catch{return{}}}persist(){try{localStorage.setItem(u_,JSON.stringify(this.trustedMap))}catch{}}isPasswordCached(e){if(!e)return!1;const t=this.trustedMap[e];if(!t)return!1;const r=Date.now(),s=r-t<c_;return s?(this.trustedMap[e]=r,this.persist()):(delete this.trustedMap[e],this.persist()),s}getCachedPassword(e){return null}saveSession(e,t){e&&(this.trustedMap[e]=Date.now(),this.persist())}clearSession(e){e&&(delete this.trustedMap[e],this.persist())}clearExpiredSessions(){const e=Date.now();let t=!1;for(const[r,s]of Object.entries(this.trustedMap))e-s>c_&&(delete this.trustedMap[r],t=!0);t&&this.persist()}clearAllSessions(){this.trustedMap={},this.persist()}}const Ki=new sM,iM={class:"mt-4"},oM={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-2"},EE={__name:"AccountBenefitsHint",setup(n){const e=P(!1);return(t,r)=>(D(),V("div",iM,[d("button",{onClick:r[0]||(r[0]=s=>e.value=!e.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[r[1]||(r[1]=d("h3",{class:"text-sm font-semibold text-blue-300"},"💡 A quoi sert un compte ?",-1)),d("span",{class:Xt(["text-blue-300 transition-transform duration-200",{"rotate-180":e.value}])},"▼",2)]),e.value?(D(),V("div",oM,r[2]||(r[2]=[d("div",{class:"text-gray-300"},"Ça fonctionne très bien sans compte. Mais si vous en créez un, vous aurez quelques trucs sympas en plus :",-1),d("div",null,[Ct("• "),d("span",{class:"text-blue-300"},"Protégez vos saisies :"),Ct(" vous êtes sûr que personne n'a changé vos dispos car vous êtes le seul à pouvoir les modifier")],-1),d("div",null,[Ct("• "),d("span",{class:"text-blue-300"},"Notifications :"),Ct(" nouveaux spectacles, disponibilités et sélections dans votre boite mail")],-1),d("div",null,[Ct("• "),d("span",{class:"text-blue-300"},"Saisie simplifiée :"),Ct(" votre joueur reste toujours en haut de la liste")],-1)]))):ce("",!0)]))}},aM={class:"space-y-4"},lM={class:"flex items-center justify-between"},uM={class:"flex items-center gap-2 text-gray-300 text-sm"},cM={key:0,class:"p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},dM={key:1,class:"p-3 bg-green-500/20 border border-green-500/30 rounded-lg text-green-300 text-sm"},hM={class:"flex justify-center gap-3 mt-2"},fM=["disabled"],pM={key:0,class:"animate-spin"},mM={key:1},TE={__name:"AccountLoginModal",props:{show:{type:Boolean,default:!1}},emits:["close","success"],setup(n,{emit:e}){const t=e,r=P(""),s=P(""),i=P(!1),o=P(""),a=P(""),l=P(!0),c=Ue(()=>!!r.value&&r.value.includes("@")&&!!s.value);async function h(){if(c.value){i.value=!0,o.value="",a.value="";try{if(await vE(r.value.trim(),s.value),l.value)try{Ki.saveSession(r.value.trim())}catch{}t("success")}catch{o.value="Email ou mot de passe incorrect"}finally{i.value=!1}}}async function f(){if(!r.value||!r.value.includes("@")){o.value="Saisissez votre email pour recevoir un lien de réinitialisation",setTimeout(()=>{o.value=""},2500);return}i.value=!0,o.value="",a.value="";try{await Bg(r.value.trim()),a.value="Email de réinitialisation envoyé"}catch{o.value="Impossible d'envoyer l'email de réinitialisation"}finally{i.value=!1}}return(g,y)=>n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[170] p-4",onClick:y[6]||(y[6]=I=>g.$emit("close"))},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:y[5]||(y[5]=dt(()=>{},["stop"]))},[d("button",{onClick:y[0]||(y[0]=I=>g.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),y[10]||(y[10]=Rn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Se connecter</h2><p class="text-sm text-gray-300">Connectez-vous pour gérer votre compte et vos préférences</p></div>',1)),d("div",aM,[Qe(EE),d("div",null,[y[7]||(y[7]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Email",-1)),at(d("input",{"onUpdate:modelValue":y[1]||(y[1]=I=>r.value=I),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Lt,r.value]])]),d("div",null,[y[8]||(y[8]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),at(d("input",{"onUpdate:modelValue":y[2]||(y[2]=I=>s.value=I),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe"},null,512),[[Lt,s.value]])]),d("div",lM,[d("label",uM,[at(d("input",{type:"checkbox","onUpdate:modelValue":y[3]||(y[3]=I=>l.value=I),class:"w-4 h-4"},null,512),[[Pi,l.value]]),y[9]||(y[9]=d("span",null,"Rester connecté sur cet appareil",-1))]),d("button",{onClick:f,class:"text-sm text-blue-400 hover:text-blue-300 underline"},"Mot de passe oublié ?")]),o.value?(D(),V("div",cM,se(o.value),1)):ce("",!0),a.value?(D(),V("div",dM,se(a.value),1)):ce("",!0),d("div",hM,[d("button",{onClick:h,disabled:!c.value||i.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(D(),V("span",pM,"⏳")):(D(),V("span",mM,"Se connecter"))],8,fM),d("button",{onClick:y[4]||(y[4]=I=>g.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])])):ce("",!0)}},tf="magicLinks";function nf({seasonId:n,playerId:e,eventId:t,action:r}){return`${n}__${e}__${t}__${r}`}function Kg(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function Kp({seasonId:n,playerId:e,eventId:t,action:r}){const s=nf({seasonId:n,playerId:e,eventId:t,action:r}),i=Kg(40),o=Re(le,tf,s),a=Date.now()+1e3*60*60*24*7;await sn(o,{seasonId:n,playerId:e,eventId:t,token:i,action:r,expiresAt:a});const c=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(i)}&a=${encodeURIComponent(r)}`;return{id:s,token:i,url:c}}async function AE({seasonId:n,playerId:e,email:t}){const r="protection",s="verify_email",i=nf({seasonId:n,playerId:e,eventId:r,action:s}),o=Kg(40),a=Re(le,tf,i),l=Date.now()+1e3*60*60*24*7;await sn(a,{seasonId:n,playerId:e,eventId:r,token:o,action:s,email:t,expiresAt:l});const h=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(s)}`;return{id:i,token:o,url:h}}async function SE({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=nf({seasonId:n,playerId:e,eventId:t,action:s}),o=Re(le,tf,i),a=await Ut(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function Gp({seasonId:n,playerId:e,eventId:t,action:r}){const s=nf({seasonId:n,playerId:e,eventId:t,action:r}),i=Re(le,tf,s);await ul(i)}const Gg="accountMagicLinks";function rf(n){return`account__${n}`}async function PE({currentEmail:n,newEmail:e}){const t=Kg(40),r=rf(t),s=Re(le,Gg,r),i=Date.now()+1e3*60*60*24*7;await sn(s,{token:t,currentEmail:n,newEmail:e,action:"account_email_update",expiresAt:i});const a=`${window.location.origin+"/"}magic?a=account_email_update&t=${encodeURIComponent(t)}`;return{id:r,token:t,url:a}}async function RE({token:n}){const e=rf(n),t=Re(le,Gg,e),r=await Ut(t);if(!r.exists())return{valid:!1,reason:"not_found"};const s=r.data();return s.token!==n?{valid:!1,reason:"token_mismatch"}:typeof s.expiresAt=="number"&&Date.now()>s.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:s}}async function CE({token:n}){const e=rf(n),t=Re(le,Gg,e);await ul(t)}const gM=Object.freeze(Object.defineProperty({__proto__:null,buildAccountId:rf,consumeAccountEmailUpdateLink:CE,consumeMagicLink:Gp,createAccountEmailUpdateLink:PE,createEmailVerificationLink:AE,createMagicLink:Kp,verifyAccountEmailUpdateLink:RE,verifyMagicLink:SE},Symbol.toStringTag,{value:"Module"}));async function Sc({toEmail:n,title:e,body:t,data:r={},reason:s="generic"}){if(!n)return{success:!1,error:"missing_toEmail"};const i={to:n,title:e,body:t,data:r,reason:s,createdAt:Zi()};return await Tl(et(le,"pushQueue"),i),{success:!0}}async function vM({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,eventUrl:o=void 0,reason:a="new_event",fromEmail:l=void 0}){try{const g=Re(le,"userPreferences",n),y=await Ut(g);if(y.exists()){const I=y.data();if((I==null?void 0:I.notifyAvailability)===!1)return{success:!0,skipped:!0}}}catch{}const c=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p><strong>Nouvel événement programmé!</strong></p>
      <p style="margin: 12px 0 2px 0; font-weight: 600;">${t}</p>
      <p style="margin: 0 0 16px 0; color:#374151;">${r}</p>
      <p>Nous avons besoin de savoir si tu es disponible.</p>
      <p style="margin-top: 12px;">
        <a href="${s}" style="display:inline-block;padding:10px 12px;margin-right:8px;border:2px solid #16a34a;color:#16a34a;border-radius:8px;text-decoration:none;">✅ Dispo</a>
        <a href="${i}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Pas dispo</a>
      </p>
      <p style="margin-top: 16px;">Merci!!</p>
    </div>
  `,h=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,f={to:n,message:{subject:h,html:c},createdAt:Zi(),meta:{reason:a,eventTitle:t,eventDate:r,playerName:e}};l&&(f.from=l,f.replyTo=l),await Tl(et(le,"mail"),f);try{const g=Re(le,"userPreferences",n),y=await Ut(g),I=y.exists()?y.data():{};if((I==null?void 0:I.notifyAvailabilityPush)!==!1){const S=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,E=`${e}, t'es dispo ?`;await Sc({toEmail:n,title:S,body:E,data:{url:o||window.location.origin,yesUrl:s,noUrl:i,reason:a},reason:a==="reminder"?"availability_reminder":"availability_request"})}}catch{}return{success:!0}}async function kE({toEmail:n,verifyUrl:e,purpose:t="player_protection",displayName:r="utilisateur",fromEmail:s=void 0}){const i=t==="account_email_update",o=i?"Vérification de votre nouvelle adresse email":"Vérification de votre email",a=`Bonjour ${r},`,l=i?"Pour sécuriser votre compte, merci de confirmer que vous avez accès à cette nouvelle adresse email.":"Pour sécuriser votre joueur, merci de confirmer que vous avez accès à cette adresse email.",c=i?"Confirmer mon adresse email":"Vérifier mon email",h=i?"Confirmez votre nouvelle adresse email":"Confirmez votre email pour activer la protection",f=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>${o}</h2>
      <p>${a}</p>
      <p>${l}</p>
      <p>
        <a href="${e}" style="display:inline-block;padding:10px 16px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;">${c}</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Ce lien expirera dans 7 jours.</p>
    </div>
  `,g={to:n,message:{subject:h,html:f},createdAt:Zi(),meta:{reason:t,displayName:r}};s&&(g.from=s,g.replyTo=s),await Tl(et(le,"mail"),g)}async function yM({toEmail:n,playerName:e,verifyUrl:t,fromEmail:r=void 0}){return kE({toEmail:n,verifyUrl:t,purpose:"player_protection",displayName:e,fromEmail:r})}async function _M({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,html:i=void 0,subject:o=void 0,fromEmail:a=void 0}){try{const f=Re(le,"userPreferences",n),g=await Ut(f);if(g.exists()){const y=g.data();if((y==null?void 0:y.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}ae.debug("queueSelectionEmail",{forPlayer:e,hasCustomHtml:!!i,hasCustomSubject:!!o});const l=i||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>Bonjour ${e},</p>
      <p>Félicitations ! Tu as été sélectionné(e) pour <strong>${t}</strong> (${r}).</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Tu recevras bientôt plus d'informations sur l'organisation.</p>
    </div>
  `,c=o||`🎭 Sélection confirmée · ${t}`;ae.debug("queueSelectionEmail html/subject ready");const h={to:n,message:{subject:c,html:l},createdAt:Zi(),meta:{reason:"selection",eventTitle:t,eventDate:r,playerName:e}};a&&(h.from=a,h.replyTo=a),ae.debug("queueSelectionEmail firestore payload ready");try{await Tl(et(le,"mail"),h);try{const f=Re(le,"userPreferences",n),g=await Ut(f),y=g.exists()?g.data():{};(y==null?void 0:y.notifySelectionPush)!==!1&&await Sc({toEmail:n,title:"🎭 Sélection confirmée",body:`${e}, tu as été sélectionné(e) pour ${t} (${r}) 🎉`,data:{url:s||window.location.origin},reason:"selection"})}catch{}return ae.info("Email ajouté à la queue Firestore",{playerName:e}),{success:!0}}catch(f){throw ae.error("Erreur lors de l'ajout à Firestore",{playerName:e,error:f}),f}}async function bM({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,newSelectedPlayers:i=[],html:o=void 0,subject:a=void 0,fromEmail:l=void 0}){try{const y=Re(le,"userPreferences",n),I=await Ut(y);if(I.exists()){const S=I.data();if((S==null?void 0:S.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}const c=Array.isArray(i)?i.join(", "):"",h=o||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>🎭 Sélection mise à jour</h2>
      <p>Bonjour ${e},</p>
      <p>La sélection pour <strong>${t}</strong> (${r}) a été mise à jour et tu n'en fais plus partie 😔.</p>
      ${c?`<p>Nouvelle sélection: <strong>${c}</strong>.</p>`:""}
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#6b7280;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: mise à jour de sélection (relance auto ou ajustement manuel).</p>
    </div>
  `,f=a||`🎭 Tu n'es plus dans la sélection · ${t}`,g={to:n,message:{subject:f,html:h},createdAt:Zi(),meta:{reason:"deselection",eventTitle:t,eventDate:r,playerName:e,newSelectedPlayers:i}};l&&(g.from=l,g.replyTo=l),await Tl(et(le,"mail"),g);try{const y=Re(le,"userPreferences",n),I=await Ut(y),S=I.exists()?I.data():{};(S==null?void 0:S.notifySelectionPush)!==!1&&await Sc({toEmail:n,title:"🎭 Sélection mise à jour",body:`${e}, tu n'es plus sélectionné(e) pour ${t} (${r}) 😔`,data:{url:s||window.location.origin,noUrl:s&&s.includes("/event/")?s.replace("/event/","/magic?auto=no&event="):void 0},reason:"deselection"})}catch{}return{success:!0}}async function wM({eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,players:i}){if(ae.info("sendSelectionEmailsForEvent",{eventId:n,seasonId:r,seasonSlug:s,playersCount:i==null?void 0:i.length,selectedCount:t==null?void 0:t.length}),!e||!t||t.length===0)throw new Error("Données manquantes pour l'envoi des emails de sélection");const{getPlayerEmail:o}=await Zt(()=>Promise.resolve().then(()=>Pc),void 0),{createMagicLink:a}=await Zt(()=>Promise.resolve().then(()=>gM),void 0),l=`${window.location.origin}/season/${s}/event/${n}`;t.join(", ");const c=`🎭 Sélection confirmée · ${e.title}`,h=[];for(const f of t){ae.debug("Traitement du joueur",{playerName:f});try{const g=i==null?void 0:i.find(F=>F.name===f);if(!g){ae.warn("Joueur non trouvé",{playerName:f});continue}ae.debug("Joueur trouvé");const y=await o(g.id,r);if(!y){ae.warn("Pas d'email pour le joueur",{playerName:f});continue}ae.debug("Email trouvé pour joueur");const S=`${(await a({seasonId:r,playerId:g.id,eventId:n,action:"no"})).url}&slug=${encodeURIComponent(s)}`,E=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu as été sélectionné(e) pour <strong>${e.title}</strong> (${sh(e.date)}).</p>
          <p>Un imprévu ?</p>
          <p>
            <a href="${S}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;margin-right:8px;">❌ Plus dispo</a>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
          </p>
        </div>
      `;ae.debug("HTML généré pour joueur");const $=_M({toEmail:y,playerName:f,eventTitle:e.title,eventDate:sh(e.date),eventUrl:l,html:E,subject:c});h.push($),ae.info("Email ajouté à la queue",{playerName:f})}catch(g){ae.error("Erreur lors de l'envoi de l'email de sélection",{playerName:f,error:g})}}return ae.info("Nombre total d'emails à envoyer",{count:h.length}),await Promise.all(h),ae.info("Tous les emails ont été envoyés avec succès"),{success:!0,count:h.length}}async function xM({eventId:n,eventData:e,removedPlayers:t,newSelectedPlayers:r,seasonId:s,seasonSlug:i,players:o}){if(ae.info("sendDeselectionEmailsForEvent",{eventId:n,seasonId:s,removedCount:t==null?void 0:t.length}),!e||!t||t.length===0)return{success:!0,count:0};const{getPlayerEmail:a}=await Zt(()=>Promise.resolve().then(()=>Pc),void 0),l=`${window.location.origin}/season/${i}/event/${n}`,c=[],h=Array.isArray(r)?r.join(", "):"";for(const f of t)try{const g=o==null?void 0:o.find(S=>S.name===f);if(!g){ae.warn("Joueur retiré non trouvé",{playerName:f});continue}const y=await a(g.id,s);if(!y){ae.warn("Pas d'email pour le joueur retiré",{playerName:f});continue}const I=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2>🎭 Sélection mise à jour</h2>
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu n'es plus sélectionné(e) pour <strong>${e.title}</strong> (${sh(e.date)}) 😔.</p>
          ${h?`<p>Nouvelle sélection: <strong>${h}</strong>.</p>`:""}
          <p>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #6b7280;color:#6b7280;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
          </p>
        </div>
      `;c.push(bM({toEmail:y,playerName:f,eventTitle:e.title,eventDate:sh(e.date),eventUrl:l,newSelectedPlayers:r,html:I}))}catch(g){ae.error("Erreur lors de l'envoi de l'email de désélection",{playerName:f,error:g})}return await Promise.all(c),ae.info("Emails de désélection envoyés",{count:c.length}),{success:!0,count:c.length}}function sh(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function Hg(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}function DE(n){return`seasonPreferredPlayer:${n||"global"}`}function Hp(n,e){try{const t=DE(n),r=localStorage.getItem(t);if(!r){localStorage.setItem(t,JSON.stringify([e]));return}if(r.startsWith("[")){const s=JSON.parse(r);s.includes(e)||(s.push(e),localStorage.setItem(t,JSON.stringify(s)))}else r!==e&&localStorage.setItem(t,JSON.stringify([r,e]))}catch{}}function IM(n,e){try{const t=DE(n),r=localStorage.getItem(t);if(!r)return;if(r.startsWith("[")){const s=JSON.parse(r).filter(i=>i!==e);s.length===0?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(s))}else r===e&&localStorage.removeItem(t)}catch{}}async function NE(n,e,t,r=null){try{ae.info("Début protectPlayer",{playerId:n,seasonId:r});const s=await Rl(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:l}=await Zt(()=>import("./index.esm-fc5a1acc.js"),[]),{db:c}=await Zt(()=>Promise.resolve().then(()=>Ni),void 0),h=r?i(c,"seasons",r,"playerProtection"):i(c,"playerProtection"),f=o(h,a("email","==",e)),g=await l(f);if(!g.empty&&g.docs.find(M=>M.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");ae.debug("Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:y}=await Zt(()=>import("./index.esm-cde78a5a.js"),[]),{auth:I}=await Zt(()=>Promise.resolve().then(()=>Ni),void 0),S=await y(I,e,t);ae.info("Compte Firebase Auth créé",{uid:S.user.uid});const E=Hg(t),$=r?Re(c,"seasons",r,"playerProtection",n):Re(c,"playerProtection",n);return await sn($,{playerId:n,email:e,passwordHash:E,firebaseUid:S.user.uid,isProtected:!0,createdAt:new Date}),ae.info("Protection sauvegardée dans Firestore"),r&&Hp(r,n),{success:!0}}catch(s){throw ae.error("Erreur lors de la protection du joueur",s),s}}async function VE({playerId:n,email:e,seasonId:t=null}){const r=t?Re(le,"seasons",t,"playerProtection",n):Re(le,"playerProtection",n);(await Ut(r)).exists()?await El(r,{email:e,updatedAt:new Date}):await sn(r,{playerId:n,email:e,isProtected:!1,createdAt:new Date});const{url:i}=await AE({seasonId:t,playerId:n,email:e});return{success:!0,url:i}}async function OE({playerId:n,seasonId:e=null}){const t=e?Re(le,"seasons",e,"playerProtection",n):Re(le,"playerProtection",n);if(!(await Ut(t)).exists())throw new Error("Protection introuvable");return await El(t,{emailVerifiedAt:new Date}),{success:!0}}async function ME({playerId:n,seasonId:e=null}){const t=e?Re(le,"seasons",e,"playerProtection",n):Re(le,"playerProtection",n);return await El(t,{emailVerifiedAt:null}),{success:!0}}async function LE(n,e=null){try{const t=e?Re(le,"seasons",e,"playerProtection",n):Re(le,"playerProtection",n);return await sn(t,{playerId:n,email:"",isProtected:!1,emailVerifiedAt:null,updatedAt:new Date}),e&&IM(e,n),{success:!0,email:""}}catch(t){throw ae.error("Erreur lors de la suppression de la protection",t),t}}async function Vi(n,e=null){try{const t=e?Re(le,"seasons",e,"playerProtection",n):Re(le,"playerProtection",n),r=await Ut(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return ae.error("Erreur lors de la vérification de protection",t),!1}}async function Rl(n,e=null){try{const t=e?Re(le,"seasons",e,"playerProtection",n):Re(le,"playerProtection",n),r=await Ut(t);return r.exists()?r.data():null}catch(t){return ae.error("Erreur lors de la récupération des données de protection",t),null}}async function $E(n,e=null){try{const t=await Rl(n,e);return(t==null?void 0:t.email)||""}catch(t){return ae.error("Erreur lors de la récupération de l'email",t),""}}async function Wp(n=null){try{const e=n?et(le,"seasons",n,"playerProtection"):et(le,"playerProtection");return(await Pt(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return ae.error("Erreur lors du chargement des protections",e),[]}}async function sf(n){try{const e=[],t=Wu(et(le,"playerProtection"),Xd("email","==",n));(await Pt(t)).forEach(i=>{const o=i.data();o!=null&&o.isProtected&&e.push({seasonId:null,playerId:i.id,...o})});const s=await Pt(et(le,"seasons"));for(const i of s.docs){const o=i.id,a=Wu(et(le,"seasons",o,"playerProtection"),Xd("email","==",n));(await Pt(a)).forEach(c=>{var f;const h=c.data();h!=null&&h.isProtected&&e.push({seasonId:o,seasonName:(f=i.data())==null?void 0:f.name,playerId:c.id,...h})})}return e}catch(e){return ae.error("Erreur listAssociationsForEmail",e),[]}}async function FE(n,e,t=null){try{const r=await Rl(n,t);if(!r||!r.isProtected)return!1;if(r.email){ae.debug("Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await Zt(()=>import("./index.esm-cde78a5a.js"),[]),{auth:i}=await Zt(()=>Promise.resolve().then(()=>Ni),void 0);return await s(i,r.email,e),ae.debug("Mot de passe Firebase Auth valide"),Ki.saveSession(n),t&&Hp(t,n),!0}catch(s){return ae.debug("Mot de passe Firebase Auth invalide",{code:s.code}),!1}}else{ae.debug("Vérification avec hash local");const s=Hg(e),i=r.passwordHash===s;return i&&(Ki.saveSession(n),t&&Hp(t,n)),i}}catch(r){return ae.error("Erreur lors de la vérification du mot de passe",r),!1}}async function UE({playerId:n,seasonId:e=null}){const t=e?Re(le,"seasons",e,"playerProtection",n):Re(le,"playerProtection",n),r=await Ut(t);if(!r.exists())throw new Error("Protection introuvable");const s=r.data();if(s!=null&&s.email)return await El(t,{isProtected:!0,updatedAt:new Date}),{success:!0};throw new Error("Email non défini pour cette protection")}function Mo(n){return Ki.isPasswordCached(n)}function EM(n){return null}async function jE(n,e=null){try{ae.info("Début sendPasswordResetEmail",{playerId:n,seasonId:e});const t=await Rl(n,e);if(ae.debug("Protection data disponible"),!t||!t.isProtected)throw new Error("Joueur non protégé");if(ae.debug("Email à utiliser (masqué)"),t.firebaseUid){ae.debug("Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await Zt(()=>import("./index.esm-cde78a5a.js"),[]),{auth:s}=await Zt(()=>Promise.resolve().then(()=>Ni),void 0);ae.debug("Tentative d'envoi d'email"),await r(s,t.email),ae.info("Email envoyé avec succès via Firebase Auth")}else{ae.debug("Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await Zt(()=>import("./index.esm-cde78a5a.js"),[]),{auth:i}=await Zt(()=>Promise.resolve().then(()=>Ni),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);ae.info("Compte temporaire créé",{uid:a.user.uid}),await s(i,t.email),ae.info("Email envoyé avec succès");const{updateDoc:l}=await Zt(()=>import("./index.esm-fc5a1acc.js"),[]),{db:c}=await Zt(()=>Promise.resolve().then(()=>Ni),void 0),h=e?Re(c,"seasons",e,"playerProtection",n):Re(c,"playerProtection",n);await l(h,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")ae.debug("Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),ae.info("Email envoyé avec succès");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw ae.error("Erreur lors de l'envoi de l'email de réinitialisation",{error:t}),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}async function TM(n,e,t=null){try{const r=Hg(e),s=t?Re(le,"seasons",t,"playerProtection",n):Re(le,"playerProtection",n);return await El(s,{passwordHash:r,updatedAt:new Date}),{success:!0}}catch(r){throw ae.error("Erreur lors de la mise à jour du mot de passe",r),r}}async function AM(n){return new Promise((e,t)=>{ae.debug("Demande de mot de passe pour disponibilité"),t(new Error("Gestion de mot de passe à implémenter côté composant"))})}const Pc=Object.freeze(Object.defineProperty({__proto__:null,clearEmailVerificationForProtection:ME,finalizeProtectionAfterVerification:UE,getCachedPlayerPassword:EM,getPlayerEmail:$E,getPlayerProtectionData:Rl,isPlayerPasswordCached:Mo,isPlayerProtected:Vi,listAssociationsForEmail:sf,listProtectedPlayers:Wp,markEmailVerifiedForProtection:OE,protectPlayer:NE,requirePlayerPasswordForAvailability:AM,sendPasswordResetEmail:jE,startEmailVerificationForProtection:VE,unprotectPlayer:LE,updatePlayerPasswordInFirestore:TM,verifyPlayerPassword:FE},Symbol.toStringTag,{value:"Module"})),SM={class:"mb-4 md:mb-6"},PM={class:"flex items-start gap-4"},RM={class:"flex items-center gap-3"},CM={class:"space-y-2"},kM={class:"flex items-center gap-2"},DM={class:"text-gray-400 text-xs md:text-sm"},NM={key:0,class:"flex items-center gap-2"},VM=["title"],OM={class:"text-blue-200"},MM={class:"space-y-4 md:space-y-6"},LM={class:"space-y-2 md:space-y-3"},$M={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5"},FM=["disabled"],UM={key:0,class:"mt-2 text-xs text-red-300"},jM={key:1,class:"mt-2 text-xs text-green-300"},qM={class:"space-y-2 md:space-y-3"},BM={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5"},zM={class:"flex items-center justify-between mb-4"},KM={class:"space-y-4"},GM=["disabled"],HM={key:0,class:"text-xs text-red-300 text-center"},WM={key:1,class:"text-xs text-green-300 text-center"},QM={class:"flex items-center justify-between mb-4"},JM={class:"text-lg md:text-xl font-semibold text-white flex items-center gap-2"},YM={class:"space-y-3"},XM={key:0,class:"text-sm text-gray-400 text-center py-4"},ZM={key:1,class:"space-y-2"},eL={class:"flex items-center gap-2 min-w-0 flex-1"},tL={class:"truncate"},nL={class:"text-white font-medium text-sm"},rL={class:"text-gray-400 text-xs"},sL=["onClick"],qE={__name:"AccountMenu",props:{show:{type:Boolean,default:!1},seasonId:{type:String,default:null}},emits:["close","delete-account","open-player"],setup(n,{emit:e}){const t=n,r=e,s=P(""),i=P(""),o=P(!1),a=P(""),l=P(""),c=P(!1),h=P(!1),f=P(""),g=P(""),y=P([]),I=P(!1),S=P(!1);wt(s,x=>{i.value=x||""}),wt(i,x=>{c.value=!!x&&x.includes("@")&&x!==s.value});async function E(){if(c.value){o.value=!0,a.value="",l.value="";try{const x=await PE({currentEmail:s.value,newEmail:i.value.trim()});await kE({toEmail:i.value.trim(),verifyUrl:x.url,purpose:"account_email_update",displayName:"utilisateur"}),l.value=`Un email de vérification a été envoyé à ${i.value.trim()}. Cliquez sur le lien pour confirmer le changement.`}catch(x){a.value=(x==null?void 0:x.code)==="auth/requires-recent-login"?"Veuillez vous reconnecter pour modifier votre email":"Impossible de mettre à jour l'email"}finally{o.value=!1}}}async function $(){if(s.value){h.value=!0,f.value="",g.value="";try{await Bg(s.value),g.value="Email de réinitialisation envoyé. Vérifiez votre boîte de réception."}catch{f.value="Impossible d'envoyer l'email de réinitialisation. Veuillez réessayer."}finally{h.value=!1}}}function F(x){return`${x.seasonId||"global"}__${x.playerId}`}async function M(){try{const x=s.value?await sf(s.value):[],b=[];for(const A of x){let C=A.playerId,O=A.seasonId||"—";try{if(A.seasonId){const U=Re(le,"seasons",A.seasonId,"players",A.playerId),R=await Ut(U);R.exists()&&(C=R.data().name||C);const mt=Re(le,"seasons",A.seasonId),gt=await Ut(mt);gt.exists()&&(O=gt.data().name||O)}}catch{}b.push({...A,playerName:C,seasonName:O})}y.value=b}catch{y.value=[]}}async function L(x){if(confirm(`Êtes-vous sûr de vouloir dissocier le joueur "${x.playerName}" de votre compte ?`))try{const{deleteDoc:b}=await Zt(()=>import("./index.esm-fc5a1acc.js"),[]);if(x.seasonId){const C=Re(le,"seasons",x.seasonId,"playerProtection",x.playerId);await b(C)}else{const C=Re(le,"playerProtection",x.playerId);await b(C)}try{if(x.seasonId){const C=`seasonPreferredPlayer:${x.seasonId}`,O=localStorage.getItem(C);if(O)if(O.startsWith("[")){const R=(JSON.parse(O)||[]).filter(mt=>mt!==x.playerId);localStorage.setItem(C,JSON.stringify(R))}else O===x.playerId&&localStorage.removeItem(C)}}catch{}await M();const A=`Joueur "${x.playerName}" dissocié avec succès`}catch(b){console.error("Erreur lors de la dissociation:",b),alert(`Erreur lors de la dissociation: ${b.message||"Veuillez réessayer"}`)}}function re(x){r("open-player",x),W()}function W(){r("close")}return wt(()=>t.show,x=>{var b;if(x)try{s.value=((b=Be==null?void 0:Be.currentUser)==null?void 0:b.email)||"",M()}catch{}}),fn(()=>{var x;if(t.show)try{s.value=((x=Be==null?void 0:Be.currentUser)==null?void 0:x.email)||"",M()}catch{}}),(x,b)=>n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-2 md:p-4",onClick:W},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-lg md:max-w-xl max-h-[90vh] overflow-y-auto",onClick:b[3]||(b[3]=dt(()=>{},["stop"]))},[d("button",{onClick:W,class:"absolute right-2 md:right-3 top-2 md:top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),d("div",SM,[d("div",PM,[d("div",RM,[b[13]||(b[13]=d("div",{class:"w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full flex items-center justify-center flex-shrink-0"},[d("span",{class:"text-lg md:text-xl"},"👤")],-1)),d("div",CM,[b[12]||(b[12]=d("h3",{class:"text-white font-semibold text-base md:text-lg"},"Mon compte",-1)),d("div",kM,[d("span",DM,se(s.value||"Non défini"),1),d("button",{onClick:b[0]||(b[0]=A=>I.value=!0),class:"text-indigo-400 hover:text-indigo-300 transition-colors p-1 hover:bg-indigo-400/10 rounded flex-shrink-0",title:"Modifier l'email","aria-label":"Modifier l'email"}," ✏️ ")]),y.value.length>0?(D(),V("div",NM,[d("button",{onClick:b[1]||(b[1]=A=>y.value.length===1?re(y.value[0]):S.value=!0),class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-xs md:text-sm hover:bg-blue-500/30 transition-colors cursor-pointer",title:y.value.length===1?`Voir ${y.value[0].playerName}`:"Gérer mes joueurs"},[b[11]||(b[11]=d("span",{class:"text-blue-300"},"⭐",-1)),d("span",OM,se(y.value.length===1?y.value[0].playerName:`${y.value.length} joueurs`),1)],8,VM)])):ce("",!0)])])])]),b[18]||(b[18]=d("div",{class:"border-t border-white/10 mb-4 md:mb-6"},null,-1)),d("div",MM,[d("div",LM,[b[15]||(b[15]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-green-400"},"🔑"),Ct(" Mot de passe ")],-1)),d("div",$M,[b[14]||(b[14]=d("p",{class:"text-xs md:text-sm text-gray-400 mb-3"},"Vous pouvez changer votre mot de passe pour sécuriser vos opérations sensibles.",-1)),d("button",{onClick:$,disabled:h.value,class:"w-full px-3 md:px-4 py-2 md:py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm"},se(h.value?"⏳":"Changer de mot de passe"),9,FM),f.value?(D(),V("div",UM,se(f.value),1)):ce("",!0),g.value?(D(),V("div",jM,se(g.value),1)):ce("",!0)])]),d("div",qM,[b[17]||(b[17]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-red-400"},"⚠️"),Ct(" Suppression de compte ")],-1)),d("div",BM,[b[16]||(b[16]=d("p",{class:"text-xs md:text-sm text-gray-400 mb-3"},"Cette action est irréversible et supprimera définitivement votre compte.",-1)),d("button",{onClick:b[2]||(b[2]=A=>x.$emit("delete-account")),class:"w-full px-3 md:px-4 py-2 md:py-3 rounded-lg bg-red-600 text-white hover:bg-red-500 text-sm"},"Supprimer mon compte")])])]),d("div",{class:"mt-4 md:mt-6 text-center"},[d("button",{onClick:W,class:"px-4 md:px-6 py-2 md:py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 text-sm"},"Fermer")])]),I.value?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:b[7]||(b[7]=A=>I.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-md",onClick:b[6]||(b[6]=dt(()=>{},["stop"]))},[d("div",zM,[b[19]||(b[19]=d("h3",{class:"text-lg md:text-xl font-semibold text-white flex items-center gap-2"},[d("span",{class:"text-blue-400"},"📧"),Ct(" Modifier l'email ")],-1)),d("button",{onClick:b[4]||(b[4]=A=>I.value=!1),class:"text-white/80 hover:text-white"},"✖️")]),d("div",KM,[d("div",null,[b[20]||(b[20]=d("label",{class:"block text-xs text-gray-400 mb-2"},"Nouvelle adresse email",-1)),at(d("input",{"onUpdate:modelValue":b[5]||(b[5]=A=>i.value=A),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white placeholder-gray-400 text-sm",placeholder:"nouvel@email.com"},null,512),[[Lt,i.value]])]),d("button",{onClick:E,disabled:!c.value||o.value,class:"w-full px-4 py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm"},se(o.value?"⏳":"Mettre à jour"),9,GM),a.value?(D(),V("div",HM,se(a.value),1)):ce("",!0),l.value?(D(),V("div",WM,se(l.value),1)):ce("",!0)])])])):ce("",!0),S.value?(D(),V("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:b[10]||(b[10]=A=>S.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-lg",onClick:b[9]||(b[9]=dt(()=>{},["stop"]))},[d("div",QM,[d("h3",JM,[b[21]||(b[21]=d("span",{class:"text-yellow-400"},"⭐",-1)),Ct(" "+se(y.value.length<=1?"Mon joueur":"Mes joueurs"),1)]),d("button",{onClick:b[8]||(b[8]=A=>S.value=!1),class:"text-white/80 hover:text-white"},"✖️")]),d("div",YM,[y.value.length===0?(D(),V("div",XM," Aucun joueur associé pour le moment. ")):(D(),V("div",ZM,[(D(!0),V(ot,null,wr(y.value,A=>(D(),V("div",{key:F(A),class:"flex items-center justify-between p-3 bg-gray-800/30 rounded-lg"},[d("div",eL,[b[22]||(b[22]=d("span",{class:"text-yellow-400 text-sm"},"⭐",-1)),d("div",tL,[d("div",nL,se(A.playerName||"—"),1),d("div",rL,se(A.seasonName||A.seasonId||"—"),1)])]),d("button",{onClick:C=>L(A),class:"p-1.5 rounded bg-red-600/20 text-red-400 hover:bg-red-600/30 hover:text-red-300 transition-colors duration-200 flex-shrink-0",title:"Dissocier ce joueur","aria-label":"Dissocier ce joueur"}," 🗑️ ",8,sL)]))),128))]))])])])):ce("",!0)])):ce("",!0)}},iL="/logos/hatcast-logo-desktop.png",oL={key:0,class:"w-10 h-10 bg-gray-600 animate-pulse rounded-full"},aL=["aria-expanded"],Qp={__name:"AccountDropdown",props:{isConnected:{type:Boolean,default:!1},buttonClass:{type:String,default:"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700"}},emits:["open-account-menu","open-help","open-notifications","logout","open-login"],setup(n,{emit:e}){const t=n,r=e,s=P(!1),i=P(!0),o=P(null),a=P({});wt(()=>t.isConnected,E=>{i.value=!1},{immediate:!0}),fn(()=>{i.value=!1});function l(){r("open-login")}function c(){s.value=!s.value,s.value&&Ht(()=>h())}function h(){if(o.value){const E=o.value.getBoundingClientRect();a.value={top:`${E.bottom+8}px`,right:`${window.innerWidth-E.right}px`}}}function f(){s.value=!1,r("open-account-menu")}function g(){s.value=!1,r("open-help")}function y(){s.value=!1,r("open-notifications")}async function I(){s.value=!1;try{await Be.signOut(),r("logout")}catch(E){console.error("Erreur lors de la déconnexion:",E)}}function S(){s.value=!1}return fn(()=>{document.addEventListener("click",S),window.addEventListener("resize",h),window.addEventListener("scroll",h,{passive:!0})}),ki(()=>{document.removeEventListener("click",S),window.removeEventListener("resize",h),window.removeEventListener("scroll",h)}),(E,$)=>(D(),V("div",{class:"relative",onClick:$[0]||($[0]=dt(()=>{},["stop"]))},[i.value?(D(),V("div",oL)):n.isConnected?(D(),V("button",{key:2,onClick:c,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Mon compte","aria-label":"Mon compte","aria-expanded":s.value,"aria-haspopup":"true",ref_key:"dropdownButton",ref:o},$[1]||($[1]=[d("span",{class:"text-2xl"},"👤",-1)]),8,aL)):(D(),V("button",{key:1,onClick:l,class:Xt(["px-4 py-2 rounded-lg transition-all duration-300 border transition-colors",n.buttonClass])}," Connexion ",2)),(D(),Ns(Ru,{to:"body"},[s.value&&n.isConnected?(D(),V("div",{key:0,class:"fixed w-auto min-w-[180px] max-w-[200px] md:min-w-[200px] md:max-w-[240px] bg-gray-900 border border-white/20 rounded-lg shadow-xl py-1 z-[9999]",style:br(a.value),role:"menu"},[d("button",{onClick:f,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},$[2]||($[2]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"👤",-1),d("span",{class:"truncate"},"Mon compte",-1)])),d("button",{onClick:y,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},$[3]||($[3]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"🔔",-1),d("span",{class:"truncate"},"Notifications",-1)])),d("button",{onClick:g,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},$[4]||($[4]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"❓",-1),d("span",{class:"truncate"},"Aide",-1)])),$[6]||($[6]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:I,class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},$[5]||($[5]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"🚪",-1),d("span",{class:"truncate"},"Se déconnecter",-1)]))],4)):ce("",!0)]))]))}},lL={class:"container mx-auto px-4 py-4"},uL={class:"flex items-center justify-between"},cL={class:"flex items-center gap-2"},dL={__name:"AppHeader",props:{isScrolled:{type:Boolean,default:!1}},emits:["open-account-menu","open-help","open-notifications","open-players","logout","open-login"],setup(n,{emit:e}){const t=n,r=e,s=Qo(),i=P(null),o=Ue(()=>{var E;return!!i.value&&!((E=i.value)!=null&&E.isAnonymous)}),a=Ue(()=>t.isScrolled?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700":"bg-white/10 hover:bg-white/20 text-white border-white/20 hover:border-white/40");function l(E){i.value=E}function c(){i.value=Be.currentUser}fn(()=>{i.value=Be.currentUser;const E=Be.onAuthStateChanged(l);window._appHeaderUnsubscribe=E}),wt(()=>s.path,()=>{setTimeout(()=>{c()},100)}),ki(()=>{window._appHeaderUnsubscribe&&(window._appHeaderUnsubscribe(),delete window._appHeaderUnsubscribe)});function h(){r("open-account-menu")}function f(){r("open-help")}function g(){r("open-notifications")}function y(){r("open-players")}function I(){r("logout")}function S(){r("open-login")}return(E,$)=>(D(),V("header",{class:Xt(["fixed top-0 left-0 right-0 z-50 transition-all duration-300",n.isScrolled?"bg-white/95 backdrop-blur-md border-b border-gray-200/50 shadow-lg":"bg-gray-900/20 backdrop-blur-sm"])},[d("nav",lL,[d("div",uL,[$[0]||($[0]=Rn('<div class="flex items-center"><a href="/" class="flex items-center"><div class="relative w-48 h-12 md:w-56 md:h-14"><img src="'+xE+'" alt="Logo HatCast - Retour à l&#39;accueil" class="w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 md:hidden"><img src="'+iL+'" alt="Logo HatCast - Retour à l&#39;accueil" class="w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 hidden md:block"></div></a></div>',1)),d("div",cL,[Qe(Qp,{"is-connected":o.value,"button-class":a.value,onOpenAccountMenu:h,onOpenHelp:f,onOpenNotifications:g,onOpenPlayers:y,onLogout:I,onOpenLogin:S},null,8,["is-connected","button-class"]),FA(E.$slots,"actions")])])])],2))}},BE="@firebase/installations",Wg="0.6.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zE=1e4,KE=`w:${Wg}`,GE="FIS_v2",hL="https://firebaseinstallations.googleapis.com/v1",fL=60*60*1e3,pL="installations",mL="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gL={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Go=new Jo(pL,mL,gL);function HE(n){return n instanceof ds&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WE({projectId:n}){return`${hL}/projects/${n}/installations`}function QE(n){return{token:n.token,requestStatus:2,expiresIn:yL(n.expiresIn),creationTime:Date.now()}}async function JE(n,e){const r=(await e.json()).error;return Go.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function YE({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function vL(n,{refreshToken:e}){const t=YE(n);return t.append("Authorization",_L(e)),t}async function XE(n){const e=await n();return e.status>=500&&e.status<600?n():e}function yL(n){return Number(n.replace("s","000"))}function _L(n){return`${GE} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bL({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=WE(n),s=YE(n),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={fid:t,authVersion:GE,appId:n.appId,sdkVersion:KE},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await XE(()=>fetch(r,a));if(l.ok){const c=await l.json();return{fid:c.fid||t,registrationStatus:2,refreshToken:c.refreshToken,authToken:QE(c.authToken)}}else throw await JE("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZE(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wL(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xL=/^[cdef][\w-]{21}$/,Jp="";function IL(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=EL(n);return xL.test(t)?t:Jp}catch{return Jp}}function EL(n){return wL(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function of(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eT=new Map;function tT(n,e){const t=of(n);nT(t,e),TL(t,e)}function nT(n,e){const t=eT.get(n);if(t)for(const r of t)r(e)}function TL(n,e){const t=AL();t&&t.postMessage({key:n,fid:e}),SL()}let ko=null;function AL(){return!ko&&"BroadcastChannel"in self&&(ko=new BroadcastChannel("[Firebase] FID Change"),ko.onmessage=n=>{nT(n.data.key,n.data.fid)}),ko}function SL(){eT.size===0&&ko&&(ko.close(),ko=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PL="firebase-installations-database",RL=1,Ho="firebase-installations-store";let Qf=null;function Qg(){return Qf||(Qf=wh(PL,RL,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Ho)}}})),Qf}async function ih(n,e){const t=of(n),s=(await Qg()).transaction(Ho,"readwrite"),i=s.objectStore(Ho),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&tT(n,e.fid),e}async function rT(n){const e=of(n),r=(await Qg()).transaction(Ho,"readwrite");await r.objectStore(Ho).delete(e),await r.done}async function af(n,e){const t=of(n),s=(await Qg()).transaction(Ho,"readwrite"),i=s.objectStore(Ho),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&tT(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jg(n){let e;const t=await af(n.appConfig,r=>{const s=CL(r),i=kL(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===Jp?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function CL(n){const e=n||{fid:IL(),registrationStatus:0};return sT(e)}function kL(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Go.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=DL(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:NL(n)}:{installationEntry:e}}async function DL(n,e){try{const t=await bL(n,e);return ih(n.appConfig,t)}catch(t){throw HE(t)&&t.customData.serverCode===409?await rT(n.appConfig):await ih(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function NL(n){let e=await d_(n.appConfig);for(;e.registrationStatus===1;)await ZE(100),e=await d_(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await Jg(n);return r||t}return e}function d_(n){return af(n,e=>{if(!e)throw Go.create("installation-not-found");return sT(e)})}function sT(n){return VL(n)?{fid:n.fid,registrationStatus:0}:n}function VL(n){return n.registrationStatus===1&&n.registrationTime+zE<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OL({appConfig:n,heartbeatServiceProvider:e},t){const r=ML(n,t),s=vL(n,t),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={installation:{sdkVersion:KE,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await XE(()=>fetch(r,a));if(l.ok){const c=await l.json();return QE(c)}else throw await JE("Generate Auth Token",l)}function ML(n,{fid:e}){return`${WE(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yg(n,e=!1){let t;const r=await af(n.appConfig,i=>{if(!iT(i))throw Go.create("not-registered");const o=i.authToken;if(!e&&FL(o))return i;if(o.requestStatus===1)return t=LL(n,e),i;{if(!navigator.onLine)throw Go.create("app-offline");const a=jL(i);return t=$L(n,a),a}});return t?await t:r.authToken}async function LL(n,e){let t=await h_(n.appConfig);for(;t.authToken.requestStatus===1;)await ZE(100),t=await h_(n.appConfig);const r=t.authToken;return r.requestStatus===0?Yg(n,e):r}function h_(n){return af(n,e=>{if(!iT(e))throw Go.create("not-registered");const t=e.authToken;return qL(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function $L(n,e){try{const t=await OL(n,e),r=Object.assign(Object.assign({},e),{authToken:t});return await ih(n.appConfig,r),t}catch(t){if(HE(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await rT(n.appConfig);else{const r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await ih(n.appConfig,r)}throw t}}function iT(n){return n!==void 0&&n.registrationStatus===2}function FL(n){return n.requestStatus===2&&!UL(n)}function UL(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+fL}function jL(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function qL(n){return n.requestStatus===1&&n.requestTime+zE<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BL(n){const e=n,{installationEntry:t,registrationPromise:r}=await Jg(e);return r?r.catch(console.error):Yg(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zL(n,e=!1){const t=n;return await KL(t),(await Yg(t,e)).token}async function KL(n){const{registrationPromise:e}=await Jg(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GL(n){if(!n||!n.options)throw Jf("App Configuration");if(!n.name)throw Jf("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Jf(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Jf(n){return Go.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oT="installations",HL="installations-internal",WL=n=>{const e=n.getProvider("app").getImmediate(),t=GL(e),r=Hi(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},QL=n=>{const e=n.getProvider("app").getImmediate(),t=Hi(e,oT).getImmediate();return{getId:()=>BL(t),getToken:s=>zL(t,s)}};function JL(){us(new Br(oT,WL,"PUBLIC")),us(new Br(HL,QL,"PRIVATE"))}JL();Rr(BE,Wg);Rr(BE,Wg,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YL="/firebase-messaging-sw.js",XL="/firebase-cloud-messaging-push-scope",aT="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",ZL="https://fcmregistrations.googleapis.com/v1",lT="google.c.a.c_id",e4="google.c.a.c_l",t4="google.c.a.ts",n4="google.c.a.e";var f_;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(f_||(f_={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var tc;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(tc||(tc={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function As(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function r4(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),s=new Uint8Array(r.length);for(let i=0;i<r.length;++i)s[i]=r.charCodeAt(i);return s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yf="fcm_token_details_db",s4=5,p_="fcm_token_object_Store";async function i4(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(i=>i.name).includes(Yf))return null;let e=null;return(await wh(Yf,s4,{upgrade:async(r,s,i,o)=>{var a;if(s<2||!r.objectStoreNames.contains(p_))return;const l=o.objectStore(p_),c=await l.index("fcmSenderId").get(n);if(await l.clear(),!!c){if(s===2){const h=c;if(!h.auth||!h.p256dh||!h.endpoint)return;e={token:h.fcmToken,createTime:(a=h.createTime)!==null&&a!==void 0?a:Date.now(),subscriptionOptions:{auth:h.auth,p256dh:h.p256dh,endpoint:h.endpoint,swScope:h.swScope,vapidKey:typeof h.vapidKey=="string"?h.vapidKey:As(h.vapidKey)}}}else if(s===3){const h=c;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:As(h.auth),p256dh:As(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:As(h.vapidKey)}}}else if(s===4){const h=c;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:As(h.auth),p256dh:As(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:As(h.vapidKey)}}}}}})).close(),await Of(Yf),await Of("fcm_vapid_details_db"),await Of("undefined"),o4(e)?e:null}function o4(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a4="firebase-messaging-database",l4=1,nc="firebase-messaging-store";let Xf=null;function uT(){return Xf||(Xf=wh(a4,l4,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(nc)}}})),Xf}async function u4(n){const e=cT(n),r=await(await uT()).transaction(nc).objectStore(nc).get(e);if(r)return r;{const s=await i4(n.appConfig.senderId);if(s)return await Xg(n,s),s}}async function Xg(n,e){const t=cT(n),s=(await uT()).transaction(nc,"readwrite");return await s.objectStore(nc).put(e,t),await s.done,e}function cT({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c4={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},tr=new Jo("messaging","Messaging",c4);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function d4(n,e){const t=await ev(n),r=dT(e),s={method:"POST",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(Zg(n.appConfig),s)).json()}catch(o){throw tr.create("token-subscribe-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw tr.create("token-subscribe-failed",{errorInfo:o})}if(!i.token)throw tr.create("token-subscribe-no-token");return i.token}async function h4(n,e){const t=await ev(n),r=dT(e.subscriptionOptions),s={method:"PATCH",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(`${Zg(n.appConfig)}/${e.token}`,s)).json()}catch(o){throw tr.create("token-update-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw tr.create("token-update-failed",{errorInfo:o})}if(!i.token)throw tr.create("token-update-no-token");return i.token}async function f4(n,e){const r={method:"DELETE",headers:await ev(n)};try{const i=await(await fetch(`${Zg(n.appConfig)}/${e}`,r)).json();if(i.error){const o=i.error.message;throw tr.create("token-unsubscribe-failed",{errorInfo:o})}}catch(s){throw tr.create("token-unsubscribe-failed",{errorInfo:s==null?void 0:s.toString()})}}function Zg({projectId:n}){return`${ZL}/projects/${n}/registrations`}async function ev({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function dT({p256dh:n,auth:e,endpoint:t,vapidKey:r}){const s={web:{endpoint:t,auth:e,p256dh:n}};return r!==aT&&(s.web.applicationPubKey=r),s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p4=7*24*60*60*1e3;async function m4(n){const e=await v4(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:As(e.getKey("auth")),p256dh:As(e.getKey("p256dh"))},r=await u4(n.firebaseDependencies);if(r){if(y4(r.subscriptionOptions,t))return Date.now()>=r.createTime+p4?g4(n,{token:r.token,createTime:Date.now(),subscriptionOptions:t}):r.token;try{await f4(n.firebaseDependencies,r.token)}catch(s){console.warn(s)}return m_(n.firebaseDependencies,t)}else return m_(n.firebaseDependencies,t)}async function g4(n,e){try{const t=await h4(n.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:t,createTime:Date.now()});return await Xg(n.firebaseDependencies,r),t}catch(t){throw t}}async function m_(n,e){const r={token:await d4(n,e),createTime:Date.now(),subscriptionOptions:e};return await Xg(n,r),r.token}async function v4(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:r4(e)})}function y4(n,e){const t=e.vapidKey===n.vapidKey,r=e.endpoint===n.endpoint,s=e.auth===n.auth,i=e.p256dh===n.p256dh;return t&&r&&s&&i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g_(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return _4(e,n),b4(e,n),w4(e,n),e}function _4(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const r=e.notification.body;r&&(n.notification.body=r);const s=e.notification.image;s&&(n.notification.image=s);const i=e.notification.icon;i&&(n.notification.icon=i)}function b4(n,e){e.data&&(n.data=e.data)}function w4(n,e){var t,r,s,i,o;if(!e.fcmOptions&&!(!((t=e.notification)===null||t===void 0)&&t.click_action))return;n.fcmOptions={};const a=(s=(r=e.fcmOptions)===null||r===void 0?void 0:r.link)!==null&&s!==void 0?s:(i=e.notification)===null||i===void 0?void 0:i.click_action;a&&(n.fcmOptions.link=a);const l=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;l&&(n.fcmOptions.analyticsLabel=l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x4(n){return typeof n=="object"&&!!n&&lT in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */I4("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function I4(n,e){const t=[];for(let r=0;r<n.length;r++)t.push(n.charAt(r)),r<e.length&&t.push(e.charAt(r));return t.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E4(n){if(!n||!n.options)throw Zf("App Configuration Object");if(!n.name)throw Zf("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const r of e)if(!t[r])throw Zf(r);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function Zf(n){return tr.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T4{constructor(e,t,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const s=E4(e);this.firebaseDependencies={app:e,appConfig:s,installations:t,analyticsProvider:r}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function A4(n){try{n.swRegistration=await navigator.serviceWorker.register(YL,{scope:XL}),n.swRegistration.update().catch(()=>{})}catch(e){throw tr.create("failed-service-worker-registration",{browserErrorMessage:e==null?void 0:e.message})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function S4(n,e){if(!e&&!n.swRegistration&&await A4(n),!(!e&&n.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw tr.create("invalid-sw-registration");n.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function P4(n,e){e?n.vapidKey=e:n.vapidKey||(n.vapidKey=aT)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hT(n,e){if(!navigator)throw tr.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw tr.create("permission-blocked");return await P4(n,e==null?void 0:e.vapidKey),await S4(n,e==null?void 0:e.serviceWorkerRegistration),m4(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function R4(n,e,t){const r=C4(e);(await n.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:t[lT],message_name:t[e4],message_time:t[t4],message_device_time:Math.floor(Date.now()/1e3)})}function C4(n){switch(n){case tc.NOTIFICATION_CLICKED:return"notification_open";case tc.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function k4(n,e){const t=e.data;if(!t.isFirebaseMessaging)return;n.onMessageHandler&&t.messageType===tc.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(g_(t)):n.onMessageHandler.next(g_(t)));const r=t.data;x4(r)&&r[n4]==="1"&&await R4(n,t.messageType,r)}const v_="@firebase/messaging",y_="0.12.12";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D4=n=>{const e=new T4(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>k4(e,t)),e},N4=n=>{const e=n.getProvider("messaging").getImmediate();return{getToken:r=>hT(e,r)}};function V4(){us(new Br("messaging",D4,"PUBLIC")),us(new Br("messaging-internal",N4,"PRIVATE")),Rr(v_,y_),Rr(v_,y_,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fT(){try{await Zb()}catch{return!1}return typeof window<"u"&&_m()&&AP()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O4(n=xm()){return fT().then(e=>{if(!e)throw tr.create("unsupported-browser")},e=>{throw tr.create("indexed-db-unsupported")}),Hi(je(n),"messaging").getImmediate()}async function M4(n,e){return n=je(n),hT(n,e)}V4();const __="BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8";async function pT(){try{return await fT()}catch{return!1}}async function L4(){if(typeof navigator>"u"||!navigator.serviceWorker)return null;const n=await navigator.serviceWorker.ready;if(n!=null&&n.active&&n.active.state==="activated")return n;const e=(n==null?void 0:n.installing)||(n==null?void 0:n.waiting);return!e||e.state==="activated"||await new Promise(t=>{const r=()=>{e.state==="activated"&&(e.removeEventListener("statechange",r),t())};e.addEventListener("statechange",r)}),n}async function $4(n){var i;if(!await pT()||await Notification.requestPermission()!=="granted")return null;const t=O4(ef);let r=n||await L4();const s=await M4(t,r?{vapidKey:__,serviceWorkerRegistration:r}:{vapidKey:__});try{const o=((i=Be==null?void 0:Be.currentUser)==null?void 0:i.email)||"anonymous";o&&s&&await sn(Re(le,"userPushTokens",o),{tokens:xD(s),lastToken:s,email:o,updatedAt:Zi(),userAgent:navigator.userAgent},{merge:!0})}catch{}return s}const F4={class:"space-y-3"},U4={class:"p-3 rounded-lg border border-white/10 bg-white/5 space-y-3"},j4={class:"flex items-center justify-between"},q4={class:"flex items-center gap-2"},B4={class:"flex items-center justify-between"},z4={class:"flex items-center gap-2"},K4={class:"p-3 rounded-lg border border-white/10 bg-white/5 space-y-3"},G4={class:"flex items-center justify-between"},H4={class:"flex items-center gap-2"},W4={class:"flex items-center justify-between"},Q4={class:"flex items-center gap-2"},J4={class:"flex items-center justify-between pt-2 border-t border-white/10"},Y4=["disabled"],X4={key:1,class:"inline-flex items-center text-xs text-gray-300"},Z4={class:"flex items-center justify-between pt-2"},e3=["disabled"],t3={key:0,class:"text-xs text-green-300"},n3={key:1,class:"text-xs text-red-300"},r3={key:2,class:"text-[10px] text-gray-400 break-all"},s3={class:"text-[10px] text-gray-500"},i3={class:"text-right"},o3=["disabled"],a3={key:0,class:"text-xs text-red-300"},l3={key:1,class:"text-xs text-green-300"},mT={__name:"NotificationsModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=n,r=e,s=P(""),i=P({notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}),o=P(!1),a=P(""),l=P(""),c=P(!1),h=P(""),f=P(""),g=P(!1),y=P(localStorage.getItem("fcmToken")||""),I=P(!1),S=function(W){try{return W?W.length>20?W.slice(0,8)+"…"+W.slice(-6):W:""}catch{return""}}("BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8");async function E(){try{if(!s.value)return;const re=Re(le,"userPreferences",s.value),W=await Ut(re);if(W.exists()){const x=W.data()||{};i.value.notifyAvailability=x.notifyAvailability!==!1,i.value.notifySelection=x.notifySelection!==!1,i.value.notifySelectionPush=x.notifySelectionPush!==!1,i.value.notifyAvailabilityPush=x.notifyAvailabilityPush!==!1}else i.value={notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}}catch{}}async function $(){if(s.value){c.value=!0,f.value="",h.value="";try{await Sc({toEmail:s.value,title:"Test Impro Selector",body:"Ceci est un test de notification",data:{url:"/"},reason:"manual_test"}),h.value="OK"}catch{f.value="Échec de l'envoi du test"}finally{c.value=!1}}}async function F(){try{if(g.value=!0,!await pT()){f.value="Push non supporté sur cet appareil";return}const W=window.__swReg,x=await $4(W);if(x){y.value=x;try{localStorage.setItem("fcmToken",x)}catch{}I.value=!0}}catch(re){const W=typeof Notification<"u"?Notification.permission:"unknown",x=re&&(re.message||re.code)?` (${re.message||re.code})`:"";f.value=`Activation impossible – permission: ${W}${x}`}finally{g.value=!1}}async function M(){if(s.value){o.value=!0,a.value="",l.value="";try{const re=Re(le,"userPreferences",s.value);await sn(re,{...i.value},{merge:!0}),l.value="Préférences sauvegardées"}catch{a.value="Impossible de sauvegarder vos préférences"}finally{o.value=!1}}}function L(){r("close")}return wt(()=>t.show,re=>{re&&E()}),fn(()=>{var re;try{s.value=((re=Be==null?void 0:Be.currentUser)==null?void 0:re.email)||"",I.value=typeof Notification<"u"&&Notification.permission==="granted"&&!!localStorage.getItem("fcmToken")}catch{}t.show&&E()}),(re,W)=>n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:L},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:W[4]||(W[4]=dt(()=>{},["stop"]))},[d("button",{onClick:L,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),W[15]||(W[15]=Rn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔔</span></div><h2 class="text-2xl font-bold text-white mb-1">Notifications</h2><p class="text-sm text-gray-300">Gérez vos préférences de notifications</p></div>',1)),d("div",F4,[d("div",U4,[W[7]||(W[7]=d("div",{class:"text-white font-semibold text-sm mb-1"},"Emails",-1)),d("div",j4,[d("label",q4,[at(d("input",{type:"checkbox","onUpdate:modelValue":W[0]||(W[0]=x=>i.value.notifyAvailability=x),class:"w-4 h-4"},null,512),[[Pi,i.value.notifyAvailability]]),W[5]||(W[5]=d("span",null,"M'envoyer un email lorsqu'un événement a besoin de joueurs",-1))])]),d("div",B4,[d("label",z4,[at(d("input",{type:"checkbox","onUpdate:modelValue":W[1]||(W[1]=x=>i.value.notifySelection=x),class:"w-4 h-4"},null,512),[[Pi,i.value.notifySelection]]),W[6]||(W[6]=d("span",null,"M'envoyer un email lorsque je suis concerné par une sélection",-1))])])]),d("div",K4,[W[13]||(W[13]=d("div",{class:"text-white font-semibold text-sm mb-1"},"Push (expérimental)",-1)),W[14]||(W[14]=d("div",{class:"text-xs text-emerald-200 mb-1"},"Fonctionnalité en test: activable uniquement ici.",-1)),d("div",G4,[d("label",H4,[at(d("input",{type:"checkbox","onUpdate:modelValue":W[2]||(W[2]=x=>i.value.notifySelectionPush=x),class:"w-4 h-4"},null,512),[[Pi,i.value.notifySelectionPush]]),W[8]||(W[8]=d("span",null,"Me notifier lorsque je suis concerné par une sélection",-1))])]),d("div",W4,[d("label",Q4,[at(d("input",{type:"checkbox","onUpdate:modelValue":W[3]||(W[3]=x=>i.value.notifyAvailabilityPush=x),class:"w-4 h-4"},null,512),[[Pi,i.value.notifyAvailabilityPush]]),W[9]||(W[9]=d("span",null,"Me notifier lorsqu'un événement a besoin de joueurs",-1))])]),d("div",J4,[W[11]||(W[11]=d("div",{class:"text-xs text-gray-400"},"Notifications sur cet appareil",-1)),I.value?(D(),V("span",X4,W[10]||(W[10]=[d("span",{class:"mr-1 text-emerald-400"},"✓",-1),Ct(" Actif ")]))):(D(),V("button",{key:0,onClick:F,disabled:g.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},se(g.value?"...":"Activer"),9,Y4))]),d("div",Z4,[W[12]||(W[12]=d("div",{class:"text-xs text-gray-400"},"Test de notification push",-1)),d("button",{onClick:$,disabled:c.value||!s.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},se(c.value?"Envoi…":"Envoyer un test"),9,e3)]),h.value?(D(),V("div",t3,"Notification test envoyée (vérifiez votre appareil)")):ce("",!0),f.value?(D(),V("div",n3,se(f.value),1)):ce("",!0),y.value?(D(),V("div",r3,"FCM token: "+se(y.value),1)):ce("",!0),d("div",s3,"VAPID: "+se(ss(S)||"indisponible"),1)]),d("div",i3,[d("button",{onClick:M,disabled:o.value,class:"px-4 py-2 rounded-lg bg-emerald-600 text-white hover:bg-emerald-500 disabled:opacity-50"},se(o.value?"⏳":"Sauvegarder"),9,o3)]),a.value?(D(),V("div",a3,se(a.value),1)):ce("",!0),l.value?(D(),V("div",l3,se(l.value),1)):ce("",!0)]),d("div",{class:"mt-6 text-center"},[d("button",{onClick:L,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):ce("",!0)}},u3={class:"space-y-3"},c3={key:0,class:"text-sm text-gray-400"},d3={key:1,class:"space-y-2"},h3={class:"flex items-center justify-between gap-3"},f3={class:"truncate"},p3={class:"text-white font-semibold"},m3={class:"text-gray-400 text-xs"},g3=["onClick"],gT={__name:"PlayersModal",props:{show:{type:Boolean,default:!1}},emits:["close","manage-player"],setup(n,{emit:e}){const t=n,r=e,s=P(""),i=P([]);function o(h){return`${h.seasonId||"global"}__${h.playerId}`}async function a(){var h;try{s.value=((h=Be==null?void 0:Be.currentUser)==null?void 0:h.email)||""}catch{}try{const f=s.value?await sf(s.value):[],g=[];for(const y of f){let I=y.playerId;try{if(y.seasonId){const S=Re(le,"seasons",y.seasonId,"players",y.playerId),E=await Ut(S);E.exists()&&(I=E.data().name||I)}}catch{}g.push({...y,playerName:I})}i.value=g}catch{i.value=[]}}function l(h){r("manage-player",h),c()}function c(){r("close")}return wt(()=>t.show,h=>{h&&a()}),fn(()=>{t.show&&a()}),(h,f)=>n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:c},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:f[0]||(f[0]=dt(()=>{},["stop"]))},[d("button",{onClick:c,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),f[2]||(f[2]=Rn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👥</span></div><h2 class="text-2xl font-bold text-white mb-1">Mes joueurs</h2><p class="text-sm text-gray-300">Gérez vos associations de joueurs</p></div>',1)),d("div",u3,[f[1]||(f[1]=d("h3",{class:"text-white font-semibold mb-2"},"Mes joueurs associés",-1)),i.value.length===0?(D(),V("div",c3,"Aucun joueur associé pour le moment.")):(D(),V("ul",d3,[(D(!0),V(ot,null,wr(i.value,g=>(D(),V("li",{key:o(g),class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},[d("div",h3,[d("div",f3,[d("div",p3,se(g.seasonName||g.seasonId||"—"),1),d("div",m3,"Joueur : "+se(g.playerName||"—"),1)]),d("button",{onClick:y=>l(g),class:"px-3 py-2 rounded-lg bg-gray-700 text-white hover:bg-gray-600 text-xs"},"Gérer",8,g3)])]))),128))]))]),d("div",{class:"mt-6 text-center"},[d("button",{onClick:c,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):ce("",!0)}};let Qn="mock",Oi=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],Wo=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function tv(n){Qn=n}async function v3(){if(Qn!=="firebase"||!(await Pt(et(le,"seasons"))).empty)return;const e=Re(et(le,"seasons"));await sn(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:Zi()});const t=await Pt(et(le,"players"));for(const o of t.docs)await sn(Re(e,"players",o.id),o.data());const r=await Pt(et(le,"events"));for(const o of r.docs)await sn(Re(e,"events",o.id),o.data());const s=await Pt(et(le,"availability"));for(const o of s.docs)await sn(Re(e,"availability",o.id),o.data());const i=await Pt(et(le,"selections"));for(const o of i.docs)await sn(Re(e,"selections",o.id),o.data())}async function vT(){Qn==="firebase"&&await v3()}async function oh(n=null){return(Qn==="firebase"?n?(await Pt(et(le,"seasons",n,"events"))).docs.map(t=>({id:t.id,...t.data()})):(await Pt(et(le,"events"))).docs.map(t=>({id:t.id,...t.data()})):Wo).sort((t,r)=>{const s=c=>{if(!c)return null;if(c instanceof Date)return c;if(typeof(c==null?void 0:c.toDate)=="function")return c.toDate();const h=new Date(c);return isNaN(h.getTime())?null:h},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,l=o?o.getTime():Number.POSITIVE_INFINITY;return a!==l?a-l:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function Tu(n=null){return(Qn==="firebase"?n?(await Pt(et(le,"seasons",n,"players"))).docs.map(t=>({id:t.id,...t.data()})):(await Pt(et(le,"players"))).docs.map(t=>({id:t.id,...t.data()})):Oi).sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function yT(n,e=null){if(Qn==="firebase"){const t=Re(e?et(le,"seasons",e,"players"):et(le,"players"));return await sn(t,{name:n}),t.id}else{const t=`p${Oi.length+1}`;return Oi.push({id:t,name:n}),t}}async function y3(n,e=null){if(Qn==="firebase"){const t=e?Re(le,"seasons",e,"players",n):Re(le,"players",n);await ul(t);const r=e?await Pt(et(le,"seasons",e,"availability")):await Pt(et(le,"availability")),s=wg(le);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else Oi=Oi.filter(t=>t.id!==n)}async function _3(n,e,t=null){if(Qn==="firebase"){const r=t?Re(le,"seasons",t,"players",n):Re(le,"players",n),s=await Ut(r),i=s.exists()&&s.data().name||null;if(await sn(r,{name:e},{merge:!0}),i&&i!==e){const o=wg(le);try{const a=t?Re(le,"seasons",t,"availability",i):Re(le,"availability",i),l=await Ut(a);if(l.exists()){const c=l.data()||{},h=t?Re(le,"seasons",t,"availability",e):Re(le,"availability",e);o.set(h,c,{merge:!0}),o.delete(a)}}catch{}try{const a=t?et(le,"seasons",t,"selections"):et(le,"selections");(await Pt(a)).forEach(c=>{var f;const h=Array.isArray((f=c.data())==null?void 0:f.players)?c.data().players:[];if(h.includes(i)){const g=h.map(y=>y===i?e:y);o.update(c.ref,{players:g})}})}catch{}await o.commit()}}else{const r=Oi.findIndex(s=>s.id===n);r!==-1&&(Oi[r]={...Oi[r],name:e})}}async function Io(n,e,t=null){if(Qn==="firebase"){const r=t?await Pt(et(le,"seasons",t,"availability")):await Pt(et(le,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function Eo(n=null){if(Qn==="firebase"){const e=n?await Pt(et(le,"seasons",n,"selections")):await Pt(et(le,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function b_(n,e,t=null){if(Qn==="firebase"){const r=t?Re(le,"seasons",t,"availability",n):Re(le,"availability",n);await sn(r,e)}}async function b3({seasonId:n,playerName:e,eventId:t,value:r}){if(Qn!=="firebase")return;const s=n?Re(le,"seasons",n,"availability",e):Re(le,"availability",e),i=await Ut(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await sn(s,a)}async function Yp(n,e,t=null){if(Qn==="firebase"){const r=t?Re(le,"seasons",t,"selections",n):Re(le,"selections",n);await sn(r,{players:e})}}async function w3(n,e=null){if(ae.info("Suppression de l'événement",{eventId:n}),Qn==="firebase")try{ae.debug("Suppression de l'événement dans Firestore");const t=e?Re(le,"seasons",e,"events",n):Re(le,"events",n);await ul(t),ae.debug("Suppression de la sélection associée");const r=e?Re(le,"seasons",e,"selections",n):Re(le,"selections",n);await ul(r),ae.debug("Suppression des disponibilités");const s=e?await Pt(et(le,"seasons",e,"availability")):await Pt(et(le,"availability")),i=wg(le);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){ae.debug("Mise à jour de la disponibilité pour un joueur");const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),ae.info("Opérations de suppression terminées avec succès")}catch(t){throw ae.error("Erreur lors de la suppression",t),t}else Wo=Wo.filter(t=>t.id!==n)}async function x3(n,e=null){if(Qn==="firebase"){const t=Re(e?et(le,"seasons",e,"events"):et(le,"events"));return await sn(t,n),t.id}else{const t=`event${Wo.length+1}`;return Wo.push({id:t,...n}),t}}async function w_(n,e,t=null){if(Qn==="firebase"){const r=t?Re(le,"seasons",t,"events",n):Re(le,"events",n);await sn(r,e,{merge:!0})}else{const r=Wo.findIndex(s=>s.id===n);r!==-1&&(Wo[r]={id:n,...e})}}const I3={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},E3={class:"hero-section relative overflow-hidden pt-24"},T3={class:"hero-content py-16 md:py-24 px-4 relative z-10"},A3={class:"container mx-auto"},S3={class:"grid grid-cols-1 lg:grid-cols-2 gap-16 lg:gap-24 items-center"},P3={class:"text-center lg:text-left order-1 lg:order-2"},R3={class:"hero-cta mb-10"},C3={class:"flex flex-col sm:flex-row gap-4 items-center justify-center"},k3={class:"seasons-section py-16"},D3={class:"container mx-auto px-4"},N3=["aria-busy"],V3={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center animate-pulse"},O3={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center"},M3=["onClick"],L3={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},$3={class:"flex justify-center gap-6 text-sm"},F3={class:"text-center"},U3={class:"text-white font-semibold"},j3={class:"text-center"},q3={class:"text-white font-semibold"},B3={class:"absolute top-4 right-4"},z3=["onClick","aria-expanded"],K3={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},G3=["onClick"],H3=["onClick"],W3=["onClick"],Q3=["onClick"],J3={class:"text-center mt-12"},Y3={key:2,class:"text-center py-16"},X3={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},Z3={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},e$={class:"mb-6"},t$={class:"mb-6"},n$={class:"mb-6"},r$={class:"flex justify-end space-x-3"},s$=["disabled"],i$={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},o$={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},a$={class:"text-center mb-6"},l$={class:"text-gray-300"},u$={__name:"Seasons",setup(n){const e=P([]),t=P(!0),r=dl(),s=P(null),i=P(!1),o=P(!1),a=P(""),l=P(""),c=P(""),h=P(null),f=P(!1),g=P(null),y=P(""),I=P(null),S=P(!1),E=P(!1),$=P(!1),F=P(!1),M=P(!1);fn(async()=>{var _e;try{if(tv("firebase"),await vT(),Be!=null&&Be.currentUser&&(I.value=Be.currentUser),e.value=await Sd(),ae.info("Saisons chargées",{count:((_e=e.value)==null?void 0:_e.length)||0}),e.value.length>0){const we=await Promise.all(e.value.map(async We=>{try{const[Ye,bt]=await Promise.all([oh(We.id),Tu(We.id)]);return ae.debug(`Saison ${We.name}: ${(Ye==null?void 0:Ye.length)||0} événements, ${(bt==null?void 0:bt.length)||0} joueurs`),{...We,events:Ye||[],players:bt||[]}}catch(Ye){return ae.warn(`Erreur lors du chargement des données pour la saison ${We.id}`,Ye),{...We,events:[],players:[]}}}));e.value=we,ae.info("Données des saisons chargées",{count:e.value.length})}C().catch(we=>ae.error("Migration sortOrder échouée",we))}finally{t.value=!1}const z=()=>{M.value=window.scrollY>10};window.addEventListener("scroll",z,{passive:!0});const j=Be.onAuthStateChanged(we=>{I.value=we});return()=>{window.removeEventListener("scroll",z),j&&j()}});const L=Ue(()=>[...e.value].sort((z,j)=>{var bt,rt;const _e=typeof z.sortOrder=="number"?z.sortOrder:Number.MAX_SAFE_INTEGER,we=typeof j.sortOrder=="number"?j.sortOrder:Number.MAX_SAFE_INTEGER;if(_e!==we)return _e-we;const We=(bt=z.createdAt)!=null&&bt.toMillis?z.createdAt.toMillis():0,Ye=(rt=j.createdAt)!=null&&rt.toMillis?j.createdAt.toMillis():0;return We!==Ye?Ye-We:(z.name||"").localeCompare(j.name||"")}));function re(z){r.push(`/season/${z}`)}function W(z){s.value=s.value===z?null:z}function x(){s.value=null}function b(){const z=document.querySelector(".help-section");z&&z.scrollIntoView({behavior:"smooth"})}function A(){const z=document.querySelector(".seasons-section");z&&z.scrollIntoView({behavior:"smooth"})}async function C(){if(!e.value.length)return;const z=e.value.map(_e=>typeof _e.sortOrder=="number"?_e.sortOrder:null).filter(_e=>_e!==null);let j=z.length?Math.max(...z):0;for(const _e of e.value)if(typeof _e.sortOrder!="number"){j+=1;try{await eu(_e.id,j),_e.sortOrder=j}catch(we){ae.error("Erreur migration sortOrder",{seasonName:_e==null?void 0:_e.name,error:we})}}}async function O(z){try{if(!(z!=null&&z.id)){alert("Saison introuvable");return}const[j,_e]=await Promise.all([oh(z.id),Tu(z.id)]),[we,We]=await Promise.all([Io(_e,j,z.id),Eo(z.id)]),Ye=["Joueur",...j.map(nr=>R(nr))],bt=[];for(const nr of _e){const qt=(nr==null?void 0:nr.name)||"",ra=(we==null?void 0:we[qt])||{},Jn=[qt,...j.map(vn=>ue(ra[vn.id],We==null?void 0:We[vn.id],qt))];bt.push(Jn)}const rt=gt([Ye,...bt]),Er=new Blob(["\uFEFF"+rt],{type:"text/csv;charset=utf-8;"}),Tr=(z==null?void 0:z.name)||(z==null?void 0:z.slug)||"saison",jt=`${ne(Tr)}-disponibilites.csv`,nn=URL.createObjectURL(Er),Un=document.createElement("a");Un.href=nn,Un.download=jt,document.body.appendChild(Un),Un.click(),document.body.removeChild(Un),URL.revokeObjectURL(nn),ae.info("Export CSV saison",{seasonId:z.id,events:j.length,players:_e.length})}catch(j){ae.error("Erreur export CSV",j),alert("Erreur lors de l'export CSV. Veuillez réessayer.")}}function U(z){if(!z)return null;if(z instanceof Date)return z;if(typeof(z==null?void 0:z.toDate)=="function")return z.toDate();if(typeof z=="string"||typeof z=="number"){const j=new Date(z);return isNaN(j.getTime())?null:j}return null}function R(z){const j=U(z==null?void 0:z.date),_e=j?`${j.getFullYear()}-${String(j.getMonth()+1).padStart(2,"0")}-${String(j.getDate()).padStart(2,"0")}`:"",we=(z==null?void 0:z.title)||"Sans titre";return`${_e} · ${we}`.trim()}function mt(z){return z===!0||z==="oui"?"disponible":z===!1||z==="non"?"non disponible":""}function gt(z){return z.map(j=>j.map(be).join(",")).join(`
`)}function be(z){const j=String(z??"");return/[",\n\r]/.test(j)?'"'+j.replace(/"/g,'""')+'"':j}function ne(z){return String(z||"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9\-_. ]+/g,"-").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$|^\.+|\.+$/g,"")||"fichier"}function ue(z,j,_e){return Array.isArray(j)&&j.includes(_e)?z===!1||z==="non"?"non disponible":"sélectionné":mt(z)}async function ie(z){if(x(),z<=0)return;const j=[...L.value],_e=j[z],we=j[z-1],We=_e.sortOrder;_e.sortOrder=we.sortOrder,we.sortOrder=We;try{await Promise.all([eu(_e.id,_e.sortOrder),eu(we.id,we.sortOrder)])}catch(Ye){ae.error("Erreur lors du déplacement vers le haut",Ye)}}async function De(z){x();const j=[...L.value];if(z>=j.length-1)return;const _e=j[z],we=j[z+1],We=_e.sortOrder;_e.sortOrder=we.sortOrder,we.sortOrder=We;try{await Promise.all([eu(_e.id,_e.sortOrder),eu(we.id,we.sortOrder)])}catch(Ye){ae.error("Erreur lors du déplacement vers le bas",Ye)}}function ee(){a.value&&(l.value=a.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function J(){c.value=c.value.replace(/[^0-9]/g,""),c.value.length>4&&(c.value=c.value.slice(0,4))}async function Te(){if(!a.value.trim()||!l.value.trim()||!c.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(c.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await kO(a.value.trim(),l.value.trim(),c.value.trim()),e.value=await Sd(),await C(),He()}catch(z){ae.error("Erreur lors de la création de la saison",z),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function He(){i.value=!1,a.value="",l.value="",c.value=""}function lt(z){h.value=z,o.value=!0}async function Ot(){o.value=!1,await xe({type:"deleteSeason",data:{seasonId:h.value.id,seasonName:h.value.name}})}function X(){o.value=!1,h.value=null}function Ae(){return g.value?{deleteSeason:"Suppression de saison - Code PIN requis"}[g.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function xe(z){if(Vn.isPinCached(h.value.id)){const j=Vn.getCachedPin(h.value.id);if(ae.debug("PIN en cache trouvé, utilisation automatique"),await rh(h.value.id,j)){await T(z);return}else Vn.clearSession()}g.value=z,f.value=!0}async function Ne(z){var j,_e,we,We;ae.debug("PIN soumis pour l'opération",{operationType:(j=g.value)==null?void 0:j.type});try{const Ye=((we=(_e=g.value)==null?void 0:_e.data)==null?void 0:we.seasonId)||((We=h.value)==null?void 0:We.id),bt=await rh(Ye,z);if(ae.debug("PIN validé",{valid:bt}),bt){Vn.saveSession(Ye,z),ae.debug("PIN correct, fermeture de la modal et exécution de l'opération"),f.value=!1;const rt=g.value;g.value=null,ae.debug("Appel de executePendingOperation",{operationType:rt==null?void 0:rt.type}),await T(rt)}else y.value="Code PIN incorrect",setTimeout(()=>{y.value=""},3e3)}catch(Ye){ae.error("Erreur lors de la vérification du PIN",Ye),y.value="Erreur lors de la vérification du code PIN"}}function tt(){f.value=!1,g.value=null,y.value=""}function ct(){return h.value&&Vn.isPinCached(h.value.id)?{timeRemaining:Vn.getTimeRemaining(),isExpiringSoon:Vn.isExpiringSoon()}:null}async function T(z){var we;if(ae.debug("executePendingOperation appelé",{hasOperation:!!z}),!z){ae.warn("Aucune opération à exécuter");return}const{type:j,data:_e}=z;ae.info("Exécution de l'opération",{type:j});try{switch(j){case"deleteSeason":ae.info("Suppression de la saison",{seasonId:_e.seasonId}),await DO(_e.seasonId),ae.info("Saison supprimée, rechargement de la liste"),e.value=await Sd(),ae.info("Liste des saisons rechargée",{count:((we=e.value)==null?void 0:we.length)||0});break;default:ae.warn("Type d'opération non reconnu",{type:j})}}catch(We){ae.error("Erreur lors de l'exécution de l'opération",We),alert("Erreur lors de l'opération. Veuillez réessayer.")}}function k(z){I.value=z,ae.debug("État de connexion changé",{isLoggedIn:!!z,email:(z==null?void 0:z.email)||"non connecté"})}function K(){S.value=!0}function G(){S.value=!1}function te(){S.value=!1,Oe()}function de(){E.value=!0}function ye(){E.value=!1}function ve(){$.value=!0}function Ie(){$.value=!1}function ge(){F.value=!0}function $e(){F.value=!1}async function Pe(){try{await Be.signOut(),E.value=!1,I.value=null,ae.info("Utilisateur déconnecté avec succès")}catch(z){ae.error("Erreur lors de la déconnexion",z),alert("Erreur lors de la déconnexion. Veuillez réessayer.")}}async function Oe(){try{const z=await wE();if(z){r.push(`/season/${z}`);return}}catch(z){ae.warn("Impossible de récupérer la saison préférée",z)}A()}return fn(()=>{I.value=Be.currentUser;const z=Be.onAuthStateChanged(k);return()=>{z()}}),(z,j)=>{var _e;return D(),V("div",I3,[Qe(dL,{"is-scrolled":M.value,onOpenAccountMenu:de,onOpenHelp:b,onOpenNotifications:ve,onOpenPlayers:ge,onLogout:Pe,onOpenLogin:K},null,8,["is-scrolled"]),d("section",E3,[d("div",T3,[d("div",A3,[d("div",S3,[j[10]||(j[10]=Rn('<div class="text-center order-2 lg:order-1"><div class="hero-content-wrapper"><div class="hero-illustration relative hidden lg:block"><div class="relative mx-auto lg:mx-0 w-full max-w-lg"><div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-4 shadow-2xl border border-white/10 relative overflow-hidden"><div class="absolute inset-0 bg-gradient-to-br from-pink-500/10 via-purple-500/10 to-cyan-500/10 rounded-3xl blur-xl"></div><div class="relative z-10"><div class="flex items-center gap-3 mb-4"><div class="flex gap-2"><div class="w-3 h-3 bg-red-500 rounded-full"></div><div class="w-3 h-3 bg-yellow-500 rounded-full"></div><div class="w-3 h-3 bg-green-500 rounded-full"></div></div><div class="text-gray-400 text-sm">HatCast - Grille des disponibilités</div></div></div><div class="bg-gray-700 rounded-2xl p-4 min-h-[300px]"><div class="grid grid-cols-4 gap-2 mb-4"><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">15 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">22 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">29 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">5 Fév</div></div><div class="space-y-2"><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Marie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-gray-500/20 border border-gray-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Pierre</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Sophie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div></div></div></div></div><div class="absolute -top-4 -right-4 w-20 h-20 bg-gradient-to-r from-pink-400 to-purple-500 rounded-2xl shadow-xl transform rotate-12 z-30"></div><div class="absolute -bottom-4 -left-4 w-16 h-16 bg-gradient-to-r from-cyan-400 to-blue-500 rounded-2xl shadow-xl transform -rotate-12 z-30 flex items-center justify-center"><img src="'+KO+'" alt="Masque HatCast" class="w-10 h-10 object-contain transform rotate-12"></div></div></div></div>',1)),d("div",P3,[j[9]||(j[9]=Rn('<div class="hero-title mb-8"><h1 class="text-4xl md:text-6xl font-bold text-white mb-6 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent leading-tight"> Faites vos équipes d&#39;impro…<br>en un clin d&#39;œil </h1></div><div class="hero-subtitle mb-10"><p class="text-xl md:text-2xl text-gray-300 leading-relaxed max-w-2xl"> Plus de casse-tête pour savoir qui joue quand. Chacun indique ses dispos, <strong class="text-white">HatCast compose l&#39;équipe pour vous</strong>, équitablement et sans tension. </p></div>',2)),d("div",R3,[d("div",C3,[d("button",{onClick:j[0]||(j[0]=we=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-5 px-10 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105 text-lg md:text-xl"}," 🚀 Démarrez "),d("button",{onClick:b,class:"inline-flex items-center gap-2 text-cyan-300 hover:text-cyan-200 font-medium py-3 px-6 rounded-lg hover:bg-cyan-500/10 transition-all duration-300 border border-cyan-500/30 hover:border-cyan-400/50"},j[7]||(j[7]=[d("span",null,"ℹ️",-1),Ct(" En savoir plus ")]))])]),d("div",{class:"hero-hint text-center"},[d("button",{onClick:A,class:"inline-flex items-center gap-2 text-gray-400 hover:text-cyan-300 transition-all duration-300 text-sm cursor-pointer group"},j[8]||(j[8]=[d("span",{class:"group-hover:animate-bounce"},"↓",-1),d("span",null,"Vos saisons ci-dessous",-1),d("span",{class:"group-hover:animate-bounce"},"↓",-1)]))])])])])]),j[11]||(j[11]=d("div",{class:"hero-background absolute inset-0 z-0"},[d("div",{class:"absolute top-20 left-10 w-32 h-32 bg-pink-500/10 rounded-full blur-3xl"}),d("div",{class:"absolute bottom-20 right-10 w-40 h-40 bg-purple-500/10 rounded-full blur-3xl"}),d("div",{class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-cyan-500/5 rounded-full blur-3xl"})],-1))]),d("section",k3,[d("div",D3,[j[24]||(j[24]=d("div",{class:"text-center mb-12"},[d("h2",{class:"text-3xl md:text-4xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"}," Saisons en cours "),d("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto"}," Sélectionnez une saison pour gérer les disponibilités et équipes. ")],-1)),d("div",{class:"pb-16","aria-busy":t.value},[t.value?(D(),V("div",V3,[(D(),V(ot,null,wr(8,we=>d("div",{key:"skeleton-"+we,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8 w-full max-w-sm"},j[12]||(j[12]=[d("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),d("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),d("div",{class:"h-px bg-white/10 mb-4"},null,-1),d("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(D(),V("div",O3,[(D(!0),V(ot,null,wr(L.value,(we,We)=>{var Ye,bt;return D(),V("div",{key:we.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20 w-full max-w-sm"},[d("div",{onClick:rt=>re(we.slug),class:"text-center cursor-pointer"},[j[15]||(j[15]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg"},[d("span",{class:"text-2xl"},"🎭")],-1)),d("h2",L3,se(we.name),1),j[16]||(j[16]=d("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),d("div",$3,[d("div",F3,[d("div",U3,se(((Ye=we.events)==null?void 0:Ye.length)||0),1),j[13]||(j[13]=d("div",{class:"text-gray-400 text-xs"},"Événements",-1))]),d("div",j3,[d("div",q3,se(((bt=we.players)==null?void 0:bt.length)||0),1),j[14]||(j[14]=d("div",{class:"text-gray-400 text-xs"},"Joueurs",-1))])])],8,M3),d("div",B3,[d("div",{class:"relative",onClick:j[1]||(j[1]=dt(()=>{},["stop"]))},[d("button",{onClick:rt=>W(We),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===We,"aria-haspopup":"true",title:"Options"},j[17]||(j[17]=[d("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,z3),s.value===We?(D(),V("div",K3,[d("button",{onClick:rt=>{O(we),x()},class:"w-full text-left px-4 py-2 text-sm text-emerald-300 hover:bg-white/10",role:"menuitem"}," Exporter CSV ",8,G3),j[18]||(j[18]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:rt=>ie(We),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Monter ",8,H3),d("button",{onClick:rt=>De(We),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Descendre ",8,W3),j[19]||(j[19]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:rt=>lt(we),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10",role:"menuitem"}," Supprimer ",8,Q3)])):ce("",!0)])])])}),128))])):ce("",!0),d("div",J3,[d("button",{onClick:j[2]||(j[2]=we=>i.value=!0),class:"inline-flex items-center gap-3 bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-semibold py-4 px-8 rounded-xl text-lg hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-pink-500/25"},j[20]||(j[20]=[d("span",null,"➕",-1),Ct(" Nouvelle saison ")]))]),!t.value&&e.value.length===0?(D(),V("div",Y3,[j[21]||(j[21]=d("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[d("span",{class:"text-4xl"},"🎪")],-1)),j[22]||(j[22]=d("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),j[23]||(j[23]=d("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),d("button",{onClick:j[3]||(j[3]=we=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):ce("",!0)],8,N3)])]),i.value?(D(),V("div",X3,[d("div",Z3,[j[29]||(j[29]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),d("div",e$,[j[25]||(j[25]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),at(d("input",{"onUpdate:modelValue":j[4]||(j[4]=we=>a.value=we),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:ee},null,544),[[Lt,a.value]])]),d("div",t$,[j[26]||(j[26]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),at(d("input",{"onUpdate:modelValue":j[5]||(j[5]=we=>l.value=we),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[Lt,l.value]])]),d("div",n$,[j[27]||(j[27]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),at(d("input",{"onUpdate:modelValue":j[6]||(j[6]=we=>c.value=we),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:J},null,544),[[Lt,c.value]]),j[28]||(j[28]=d("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),d("div",r$,[d("button",{onClick:He,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:Te,disabled:!a.value.trim()||!l.value.trim()||!c.value.trim()||c.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,s$)])])])):ce("",!0),o.value?(D(),V("div",i$,[d("div",o$,[d("div",a$,[j[30]||(j[30]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"⚠️")],-1)),j[31]||(j[31]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),d("p",l$,'Êtes-vous sûr de vouloir supprimer la saison "'+se((_e=h.value)==null?void 0:_e.name)+'" ?',1)]),j[32]||(j[32]=d("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:X,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:Ot,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ce("",!0),Qe(IE,{show:f.value,message:Ae(),error:y.value,"session-info":ct(),onSubmit:Ne,onCancel:tt},null,8,["show","message","error","session-info"]),j[33]||(j[33]=Rn('<section class="help-section py-20 bg-gradient-to-br from-gray-900/50 to-gray-800/50 border-t border-white/10"><div class="container mx-auto px-4"><div class="max-w-6xl mx-auto"><div class="text-center mb-16"><h2 class="text-4xl md:text-5xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"> Qu&#39;est-ce que HatCast ? </h2><p class="text-xl text-purple-300 max-w-3xl mx-auto"> L&#39;appli pour sélectionner vos joueurs d&#39;impro simplement, équitablement et sans prise de tête </p></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16"><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-pink-500/20 to-purple-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-pink-500/30"><span class="text-4xl">🎭</span></div><h3 class="text-xl font-bold text-white mb-3">Gestion des saisons</h3><p class="text-gray-300 text-sm leading-relaxed"> Déclarez tous vos spectacles et indiquez combien de joueurs vous aurez besoin. Organisez votre saison d&#39;impro de A à Z. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-purple-500/20 to-cyan-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-purple-500/30"><span class="text-4xl">📅</span></div><h3 class="text-xl font-bold text-white mb-3">Sondage de disponibilités</h3><p class="text-gray-300 text-sm leading-relaxed"> Créez des sondages pour vos événements. Chaque joueur indique ses disponibilités et HatCast optimise la composition des équipes. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-cyan-500/20 to-pink-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-cyan-500/30"><span class="text-4xl">🎲</span></div><h3 class="text-xl font-bold text-white mb-3">Sélection auto ou manuelle</h3><p class="text-gray-300 text-sm leading-relaxed"> Laissez le hasard pondéré décider ou reprenez la main à tout moment. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-green-500/20 to-blue-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-green-500/30"><span class="text-4xl">📱</span></div><h3 class="text-xl font-bold text-white mb-3">Pensé pour le mobile</h3><p class="text-gray-300 text-sm leading-relaxed"> Utilisez HatCast facilement sur smartphone ou tablette, où que vous soyez. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-blue-500/20 to-indigo-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-blue-500/30"><span class="text-4xl">🔐</span></div><h3 class="text-xl font-bold text-white mb-3">Comptes facultatifs</h3><p class="text-gray-300 text-sm leading-relaxed"> Créez un compte pour recevoir des rappels et sécuriser vos infos. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-emerald-500/20 to-teal-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-emerald-500/30"><span class="text-4xl">🔔</span></div><h3 class="text-xl font-bold text-white mb-3">Notifications intelligentes</h3><p class="text-gray-300 text-sm leading-relaxed"> Recevez des alertes par email et push pour les événements et sélections. Restez informé sans être submergé. </p></div></div></div></div></section><footer class="border-t border-white/10 bg-gradient-to-br from-gray-900/50 to-gray-800/50"><div class="container mx-auto px-4 py-12"><div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8"><div class="col-span-1 md:col-span-2"><div class="flex items-center gap-3 mb-4"><div class="relative w-32 h-8"><img src="'+xE+'" alt="Logo HatCast" class="w-full h-full opacity-80"></div></div><p class="text-gray-400 text-sm leading-relaxed max-w-md"> L&#39;appli pour sélectionner vos joueurs d&#39;impro simplement, équitablement et sans prise de tête. </p></div><div><h4 class="text-white font-semibold mb-4 text-sm uppercase tracking-wider">Contact</h4><div class="space-y-2"><a href="mailto:contact@hatcast.app" class="block text-gray-400 hover:text-blue-300 transition-colors text-sm"> 📧 contact@hatcast.app </a><p class="text-gray-500 text-xs">Retours et suggestions bienvenus</p></div></div><div><h4 class="text-white font-semibold mb-4 text-sm uppercase tracking-wider">Ressources</h4><div class="space-y-2"><a href="#" class="block text-gray-400 hover:text-blue-300 transition-colors text-sm"> 📚 Guide utilisateur </a><a href="https://github.com/plamarque/hatcast" target="_blank" rel="noopener noreferrer" class="block text-gray-400 hover:text-blue-300 transition-colors text-sm"> 🔗 Code source </a><p class="text-gray-500 text-xs">Documentation en cours</p></div></div></div><div class="border-t border-white/10 mb-6"></div><div class="flex flex-col sm:flex-row items-center justify-between text-xs text-gray-500"><div class="flex items-center gap-4 mb-4 sm:mb-0"><span>© Patrice Lamarque 2025</span><span class="hidden sm:inline">•</span><span>Licence MIT</span></div><div class="flex items-center gap-4"><span class="text-gray-600">En cours de développement</span><a href="https://github.com/plamarque/hatcast" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-blue-300 transition-colors underline decoration-gray-600 hover:decoration-blue-300"> GitHub </a></div></div></div></footer>',2)),Qe(TE,{show:S.value,onClose:G,onSuccess:te},null,8,["show"]),Qe(qE,{show:E.value,onClose:ye,onLogoutDevice:Pe},null,8,["show"]),Qe(mT,{show:$.value,onClose:Ie},null,8,["show"]),Qe(gT,{show:F.value,onClose:$e,onManagePlayer:z.handleManagePlayer},null,8,["show","onManagePlayer"])])}}};function c$({reason:n,recipientName:e,eventTitle:t,eventDate:r,urls:s={},prefs:i={},extra:o={}}){const a={email:null,push:null};if(n==="availability_request"||n==="availability_reminder"){const l=(i==null?void 0:i.notifyAvailability)!==!1,c=(i==null?void 0:i.notifyAvailabilityPush)!==!1;a.email={enabled:l,subject:n==="availability_reminder"?`Rappel disponibilité · ${t} (${r})`:`Disponibilité demandée · ${t} (${r})`},a.push={enabled:c,title:n==="availability_reminder"?"⏰ Rappel disponibilité":"🗓️ Disponibilité demandée",body:`${e}, ${t} (${r})`,data:{url:s.eventUrl,yesUrl:s.yesUrl,noUrl:s.noUrl,reason:n}}}if(n==="selection"){const l=(i==null?void 0:i.notifySelection)!==!1,c=(i==null?void 0:i.notifySelectionPush)!==!1;a.email={enabled:l,subject:`🎭 Sélection confirmée · ${t}`},a.push={enabled:c,title:"🎭 Sélection confirmée",body:`${e}, tu as été sélectionné(e) pour ${t} (${r}) 🎉`,data:{url:s.eventUrl}}}return a}async function d$({reason:n,recipientEmail:e,recipientName:t,eventTitle:r,eventDate:s,urls:i={},extra:o={}}){if(!e)return{success:!1,skipped:!0,reason:"missing_email"};const a=await Ut(Re(le,"userPreferences",e)).catch(()=>null),l=a!=null&&a.exists()?a.data():{},c=c$({reason:n,recipientName:t,eventTitle:r,eventDate:s,urls:i,prefs:l,extra:o}),h=[];return c.email&&c.email.enabled&&(n==="availability_request"||n==="availability_reminder"?await vM({toEmail:e,playerName:t,eventTitle:r,eventDate:s,yesUrl:i.yesUrl,noUrl:i.noUrl,eventUrl:i.eventUrl,reason:n==="availability_reminder"?"reminder":"new_event"}).then(()=>h.push({channel:"email",success:!0})).catch(g=>{ae.error("notifyRecipientAcrossChannels email error",g),h.push({channel:"email",success:!1})}):n==="selection"&&h.push({channel:"email",success:!0,skipped:!0,note:"batch_handled_elsewhere"})),c.push&&c.push.enabled&&await Sc({toEmail:e,title:c.push.title,body:c.push.body,data:c.push.data||{},reason:n}).then(()=>h.push({channel:"push",success:!0})).catch(g=>{ae.error("notifyRecipientAcrossChannels push error",g),h.push({channel:"push",success:!1})}),{success:h.some(g=>g.success),results:h}}async function x_({eventId:n,eventData:e,players:t,seasonId:r,seasonSlug:s,createMagicLink:i,reminder:o=!1,getAvailabilityForEvent:a=null}){const l=[],c=`${window.location.origin}/season/${s}/event/${n}`;for(const h of t)try{if(o&&typeof a=="function"){const y=await Promise.resolve(a(h.name,n));if(y===!0||y===!1)continue}const f={};if(typeof i=="function"){const y=await i({seasonId:r,playerId:h.id,eventId:n,action:"yes"}),I=await i({seasonId:r,playerId:h.id,eventId:n,action:"no"});f.yesUrl=`${y.url}&slug=${encodeURIComponent(s)}`,f.noUrl=`${I.url}&slug=${encodeURIComponent(s)}`}f.eventUrl=c,(await d$({reason:o?"availability_reminder":"availability_request",recipientEmail:h.email,recipientName:h.name,eventTitle:e.title,eventDate:h$(e.date),urls:f})).success||l.push(h.id)}catch{l.push(h.id)}return{success:!0,failures:l}}async function I_(n){return wM(n)}function h$(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function f$(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Impro Selector//Calendar Event//FR","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${n.id}@hatcast.app`,`DTSTAMP:${new Date().toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTSTART:${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTEND:${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`SUMMARY:${n.title}`,`DESCRIPTION:${n.description||""}${e?`\\n\\nSaison : ${e}`:""}`,"STATUS:CONFIRMED","SEQUENCE:0","BEGIN:VALARM","TRIGGER:-PT1H","ACTION:DISPLAY",`DESCRIPTION:Rappel : ${n.title}`,"END:VALARM","END:VEVENT","END:VCALENDAR"].join(`\r
`)}function p$(n,e=""){const t=f$(n,e),r=new Blob([t],{type:"text/calendar;charset=utf-8"}),s=URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=`${n.title.replace(/[^a-z0-9]/gi,"_")}_${n.date}.ics`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)}function m$(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://calendar.google.com/calendar/render?${new URLSearchParams({action:"TEMPLATE",text:n.title,dates:`${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z/${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,details:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"Impro Selector",sf:"true",output:"xml"}).toString()}`}function g$(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://outlook.live.com/calendar/0/deeplink/compose?${new URLSearchParams({subject:n.title,startdt:r.toISOString(),enddt:s.toISOString(),body:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"Impro Selector",allday:"false"}).toString()}`}function v$(n,e=""){const t=m$(n,e);window.open(t,"_blank")}function y$(n,e=""){const t=g$(n,e);window.open(t,"_blank")}function _$(n,e,t=""){switch(n){case"ics":p$(e,t);break;case"google":v$(e,t);break;case"outlook":y$(e,t);break;default:console.warn("Type de calendrier non supporté:",n)}}const b$="/icons/manifest-icon-192.maskable.png",w$={class:"relative p-5 pb-4 border-b border-white/10"},x$={class:"text-xl md:text-2xl font-bold text-white pr-10 flex items-center gap-2"},I$={key:0,class:"text-sm text-purple-300 mt-1"},E$={class:"px-4 md:px-6 py-4 md:py-6 space-y-6 overflow-y-auto"},T$={class:"space-y-4"},A$={class:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2"},S$={key:0,class:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-3"},P$={class:"bg-gray-800 border border-gray-600 rounded-lg p-3"},R$={key:0,class:"space-y-2"},C$={class:"flex flex-wrap gap-2"},k$=["onClick","title"],D$={key:1,class:"text-amber-400 text-sm"},N$={class:"inline-flex bg-gray-800 rounded-lg overflow-hidden border border-gray-700 mb-3"},V$={class:"text-sm text-gray-300"},O$={class:"text-sm text-gray-300"},M$={class:"text-sm text-gray-300"},L$=["innerHTML"],$$=["value"],F$={class:"mt-3"},U$={class:"text-lg font-semibold leading-snug"},j$={class:"mt-2 text-base whitespace-pre-line text-white/90"},q$={class:"mt-4 flex items-center gap-4 text-base"},B$={key:1,class:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-gray-100 text-gray-900 border border-white/20"},z$={class:"bg-yellow-500/10 border border-yellow-500/30 text-yellow-200 rounded-md p-3 text-sm mb-2"},K$=["value"],G$={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},H$={class:"flex items-center gap-2 w-full"},W$=["disabled"],Q$={key:0},J$={class:"hidden sm:inline"},Y$={key:1,class:"inline-flex items-center gap-2"},X$=["title"],Z$={key:0},eF={key:1},_T={__name:"EventAnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},mode:{type:String,default:"event",validator:n=>["event","selection"].includes(n)},selectedPlayers:{type:Array,default:()=>[]},sending:{type:Boolean,default:!1},availabilityByPlayer:{type:Object,default:()=>({})}},emits:["close","notifications-sent","send-notifications"],setup(n,{emit:e}){const t=n,r=e;P("notify");const s=P(!1),i=P("Copier le message"),o=P(!1),a=Ue(()=>t.sending||o.value),l=P(!1),c=P("email"),h=Ue(()=>!t.event||!t.seasonSlug?"":`${window.location.origin}/season/${t.seasonSlug}/event/${t.event.id}`),f=Ue(()=>{if(!t.event)return"";if(c.value==="push"){const ne=E.value,ue=$.value;if(t.mode==="event"){const ie=`

Lien direct: ${h.value}`;return`${ne}
${ue}
✅ Dispo
❌ Pas dispo${ie}`}return`${ne}
${ue}
Ouvrir`}const be=`

Lien direct: ${h.value}`;return`Objet: ${g.value}

${S.value}${be}`}),g=Ue(()=>{var ne,ue,ie;const be=U((ne=t.event)==null?void 0:ne.date);return t.mode==="event"?`${(ue=t.event)==null?void 0:ue.title} (${be})`:`🎭 Sélectionné pour ${(ie=t.event)==null?void 0:ie.title}`}),y=Ue(()=>"contact@hatcast.app"),I=Ue(()=>{var ue,ie,De,ee,J,Te,He;const be=((ue=L.value)==null?void 0:ue.id)==="ALL"?"<joueur>":((ie=L.value)==null?void 0:ie.name)||"[Nom du joueur]",ne=U((De=t.event)==null?void 0:De.date);return L.value&&L.value.id&&L.value.id!=="ALL"&&!((ee=W.value.find(lt=>lt.id===L.value.id))!=null&&ee.hasContact)?`
      <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
        <p><strong>${be}</strong> n'a pas configuré d'email. Utilise la fonction « Copier le message » et envoie-lui ces informations par un autre canal.</p>
        <p style="margin-top: 8px; font-weight: 600;">${(J=t.event)==null?void 0:J.title}</p>
        <p style="color:#374151;">${ne}</p>
        <p style="margin-top: 8px;">Lien direct : ${h.value}</p>
      </div>
    `:t.mode==="event"?`
      <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
        <p><strong>${be}</strong>, un nouvel événement est prévu.</p>
        <p style="margin: 12px 0 2px 0; font-weight: 600;">${(Te=t.event)==null?void 0:Te.title}</p>
        <p style="margin: 0 0 16px 0; color:#374151;">${ne}</p>
        <p>Nous avons besoin de savoir si tu es disponible.</p>
        <p style="margin-top: 12px;">
          <a href="#yes" style="display:inline-block;padding:10px 12px;margin-right:8px;border:2px solid #16a34a;color:#16a34a;border-radius:8px;text-decoration:none;">✅ Dispo</a>
          <a href="#no" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Pas dispo</a>
        </p>
        <p style="margin-top: 16px;">Merci!!</p>
      </div>
    `:`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p><strong>${be}</strong>, tu as été sélectionné pour <strong>${(He=t.event)==null?void 0:He.title}</strong> le <strong>${ne}</strong>!</p>
      <p style="margin-top: 16px; font-weight: 600;">Actions rapides :</p>
      <p style="margin-top: 8px;">
        <a href="#no" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Pas dispo</a>
      </p>
    </div>
  `}),S=Ue(()=>I.value.replace(/<\/?div[^>]*>/g,`
`).replace(/<\/?p[^>]*>/g,`
`).replace(/<br\s*\/?>(\n)?/g,`
`).replace(/<[^>]+>/g,"").replace(/\n{3,}/g,`

`).trim()),E=Ue(()=>{var be,ne;return t.mode==="event"?`${(be=t.event)==null?void 0:be.title} (${U((ne=t.event)==null?void 0:ne.date)})`:"🎭 Sélectionné pour"}),$=Ue(()=>{var De,ee,J,Te,He,lt;const be=U((De=t.event)==null?void 0:De.date),ne=((ee=L.value)==null?void 0:ee.id)==="ALL"?"<joueur>":((J=L.value)==null?void 0:J.name)||"[Nom du joueur]",ue=L.value&&L.value.id&&L.value.id!=="ALL",ie=ue?!!((Te=W.value.find(Ot=>Ot.id===L.value.id))!=null&&Te.hasContact):!0;return ue&&!ie?`${ne} n'a pas installé l'appli. Envoie-lui ce message manuellement.
${(He=t.event)==null?void 0:He.title} (${be})
Lien: ${h.value}`:t.mode==="event"?`${ne}, t'es dispo ?`:`${ne}, tu as été sélectionné pour ${(lt=t.event)==null?void 0:lt.title} le ${be}!

[ Afficher les Détails]

Un imprévu ?
❌ Pas dispo`}),F=P([]),M=P([]),L=P(null),re=P([]),W=Ue(()=>{const be=M.value.map(ue=>({...ue,hasContact:ue.id!=="ALL",missingReason:""})),ne=re.value.map(ue=>({...ue,hasContact:!1,missingReason:"Aucun canal actif"}));return[{id:"ALL",name:"Tous",hasContact:!0},...be.filter(ue=>ue.id!=="ALL"),...ne]}),x=Ue(()=>{if(!L.value||L.value.id==="ALL")return!0;const be=W.value.find(ne=>(ne.id||ne.name)===(L.value.id||L.value.name));return!!(be!=null&&be.hasContact)}),b=Ue(()=>{var ue,ie,De,ee,J;const be=((ue=L.value)==null?void 0:ue.id)==="ALL"?"<joueur>":((ie=L.value)==null?void 0:ie.name)||"[Nom du joueur]",ne=U((De=t.event)==null?void 0:De.date);return t.mode==="selection"?`Bonjour ${be},
Tu as été sélectionné(e) pour ${(ee=t.event)==null?void 0:ee.title} (${ne})
Un imprévu ? ${A.value}
Détails : ${h.value}`:`Bonjour ${be},
${(J=t.event)==null?void 0:J.title} (${ne})
Peux-tu indiquer ta disponibilité ?
Lien : ${h.value}`}),A=Ue(()=>{var be,ne;try{const ue=(be=L.value)!=null&&be.id&&L.value.id!=="ALL"?t.players.find(ie=>ie.id===L.value.id):null;return!ue||!((ne=t.event)!=null&&ne.id)||!t.seasonId?"[lien désistement]":`${window.location.origin}/magic?auto=no&season=${encodeURIComponent(t.seasonId)}&player=${encodeURIComponent(ue.id)}&event=${encodeURIComponent(t.event.id)}&slug=${encodeURIComponent(t.seasonSlug||"")}`}catch{return"[lien désistement]"}});async function C(){if(!t.seasonId)return;let be=[];t.mode==="selection"?be=t.players.filter(De=>t.selectedPlayers.includes(De.name)):be=t.players.filter(De=>{var J;return typeof((J=t.availabilityByPlayer)==null?void 0:J[De.name])>"u"});const ne=[];for(const De of be)try{const{getPlayerEmail:ee}=await Zt(()=>Promise.resolve().then(()=>Pc),void 0),J=await ee(De.id,t.seasonId);J&&ne.push({...De,email:J})}catch(ee){console.warn(`Impossible de charger l'email pour ${De.name}:`,ee)}F.value=ne;const ue={id:"ALL",name:"Tous"};M.value=[ue,...ne];const ie=be.filter(De=>!ne.find(ee=>ee.id===De.id)).map(De=>({id:De.id,name:De.name}));re.value=ie,L.value||(L.value=ue)}function O(){r("close")}function U(be){var ue;return be?(typeof be=="string"?new Date(be):((ue=be.toDate)==null?void 0:ue.call(be))||be).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function R(){const be=f.value;navigator.clipboard.writeText(be).then(()=>{s.value=!0,i.value="Copié !",setTimeout(()=>{s.value=!1,i.value="Copier le message"},2e3)}).catch(ne=>{console.warn("Erreur lors de la copie du texte"),alert("Impossible de copier le message.")})}function mt(be){L.value=be}async function gt(){if(!(!t.event||M.value.length===0)){o.value=!0;try{const be=L.value&&L.value.id!=="ALL"?"single":"all",ne=be==="single"?{id:L.value.id,name:L.value.name,email:L.value.email}:null;t.mode==="selection"?r("send-notifications",{eventId:t.event.id,eventData:t.event,reason:"selection",selectedPlayers:t.selectedPlayers,scope:be,recipient:ne}):r("send-notifications",{eventId:t.event.id,eventData:t.event,reason:"manual",scope:be,recipient:ne})}catch{console.error("Erreur lors de l'envoi des notifications"),alert("Erreur lors de l'envoi des notifications. Veuillez réessayer.")}}}return fn(()=>{t.show&&C()}),wt(()=>t.show,be=>{be&&C()}),wt(()=>t.selectedPlayers,()=>{t.show&&t.mode==="selection"&&C()}),wt(()=>t.availabilityByPlayer,()=>{t.show&&t.mode==="event"&&C()},{deep:!0}),wt(()=>t.sending,be=>{be||(o.value=!1)}),(be,ne)=>{var ue,ie,De,ee,J;return n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:O},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] flex flex-col",onClick:ne[3]||(ne[3]=dt(()=>{},["stop"]))},[d("div",w$,[d("button",{onClick:O,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("h2",x$,[d("span",null,se(n.mode==="selection"?"📣":"📢"),1),d("span",null,se(n.mode==="selection"?"Annoncer la sélection":"Annoncer l'événement"),1)]),n.event?(D(),V("p",I$,se(n.event.title)+" — "+se(U(n.event.date)),1)):ce("",!0)]),d("div",E$,[d("div",T$,[d("div",null,[d("label",A$,[ne[4]||(ne[4]=Ct(" Personnes à Prévenir ")),d("button",{onClick:ne[0]||(ne[0]=Te=>l.value=!l.value),class:"text-blue-400 hover:text-blue-300 text-lg cursor-help",title:"Cliquer pour plus d'information"}," ? ")]),l.value?(D(),V("div",S$,ne[5]||(ne[5]=[d("p",{class:"text-blue-200 text-sm"},[Ct(" Cette liste montre tous les joueurs ciblés: "),d("span",{class:"text-purple-300"},"« Tous »"),Ct(", "),d("span",{class:"text-gray-200"},"ceux notifiables (email/push actifs)"),Ct(" et "),d("span",{class:"text-yellow-300"},"ceux en jaune sans canal actif"),Ct(". Les joueurs en jaune ne peuvent pas être notifiés automatiquement. Utilise « Copier le message » pour leur écrire via un autre moyen (l'URL de l'événement est incluse). ")],-1)]))):ce("",!0),d("div",P$,[W.value.length>0?(D(),V("div",R$,[d("div",C$,[(D(!0),V(ot,null,wr(W.value,Te=>(D(),V("button",{key:Te.id||Te.name,type:"button",onClick:He=>mt(Te),class:Xt(["px-3 py-1 rounded text-sm border transition-colors",L.value&&L.value.id===Te.id?"bg-purple-600 border-purple-500 text-white":Te.hasContact?"bg-gray-700 border-gray-600 text-white hover:bg-gray-600":"bg-yellow-900/20 border-yellow-600/40 text-yellow-200 hover:bg-yellow-900/30 opacity-75 cursor-not-allowed"]),title:Te.hasContact?"Prévisualiser pour "+Te.name:Te.missingReason||"Aucun canal actif"},se(Te.name),11,k$))),128))])])):(D(),V("div",D$," ⚠️ Aucun destinataire disponible. "))])]),d("div",null,[ne[13]||(ne[13]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Aperçu du message :",-1)),d("div",N$,[d("button",{class:Xt(["px-3 py-1.5 text-sm transition-colors",c.value==="email"?"bg-purple-600 text-white":"text-gray-300 hover:bg-gray-700"]),onClick:ne[1]||(ne[1]=Te=>c.value="email"),title:"Prévisualiser l'email"},"📧",2),d("button",{class:Xt(["px-3 py-1.5 text-sm transition-colors",c.value==="push"?"bg-purple-600 text-white":"text-gray-300 hover:bg-gray-700"]),onClick:ne[2]||(ne[2]=Te=>c.value="push"),title:"Prévisualiser la notification push"},"🔔",2)]),c.value==="email"?(D(),V("div",{key:0,class:Xt(x.value||((ue=L.value)==null?void 0:ue.id)==="ALL"?"bg-gray-800 border border-gray-600 rounded-lg p-4 text-white space-y-3":"space-y-3")},[x.value||((ie=L.value)==null?void 0:ie.id)==="ALL"?(D(),V(ot,{key:0},[d("div",V$,[ne[6]||(ne[6]=d("span",{class:"font-semibold"},"De:",-1)),Ct(" "+se(y.value),1)]),d("div",O$,[ne[7]||(ne[7]=d("span",{class:"font-semibold"},"À:",-1)),Ct(" "+se(((De=L.value)==null?void 0:De.id)==="ALL"?"<joueur>":((ee=L.value)==null?void 0:ee.name)||"[Nom du joueur]"),1)]),d("div",M$,[ne[8]||(ne[8]=d("span",{class:"font-semibold"},"Objet:",-1)),Ct(" "+se(g.value),1)]),d("div",{class:"bg-white text-black rounded-md p-4",innerHTML:I.value},null,8,L$)],64)):(D(),V(ot,{key:1},[ne[9]||(ne[9]=d("div",{class:"bg-yellow-500/10 border border-yellow-500/30 text-yellow-200 rounded-md p-3 text-sm"}," Ce joueur n'a pas configuré d'email. Utilise la fonction « Copier le message » et envoie-lui ces informations par un autre canal. ",-1)),d("textarea",{class:"w-full mt-2 p-3 bg-gray-900 border border-gray-700 rounded-md text-white text-sm",value:b.value,rows:"5",readonly:""},null,8,$$)],64))],2)):(D(),V("div",{key:1,class:Xt(L.value&&L.value.id!=="ALL"&&!x.value?"text-white":"bg-gray-900 border border-gray-700 rounded-xl p-4 text-white")},[L.value&&L.value.id!=="ALL"&&!x.value?(D(),V(ot,{key:1},[d("div",z$,se((J=L.value)==null?void 0:J.name)+" n'a pas installé l'appli. Envoie-lui ce message manuellement. ",1),d("textarea",{class:"w-full p-3 bg-gray-800 border border-gray-700 rounded-md text-white text-sm",value:b.value,rows:"5",readonly:""},null,8,K$)],64)):(D(),V(ot,{key:0},[ne[12]||(ne[12]=Rn('<div class="flex items-center justify-between text-xs text-white/70"><div class="flex items-center gap-2 min-w-0"><div class="w-6 h-6 rounded-full bg-white/10 flex items-center justify-center">🔔</div><div class="truncate">Impropick</div><span class="opacity-60">•</span><span>il y a 1 min</span></div><img src="'+b$+'" alt="App icon" class="w-10 h-10 rounded-full shadow"></div>',1)),d("div",F$,[d("div",U$,se(E.value),1),d("div",j$,se($.value),1)]),d("div",q$,[t.mode==="event"?(D(),V(ot,{key:0},[ne[10]||(ne[10]=d("span",{class:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-green-600/20 text-green-300 border border-green-600/40"},"✅ Dispo",-1)),ne[11]||(ne[11]=d("span",{class:"text-red-600/20 text-red-300 border border-red-600/40"},"❌ Pas dispo",-1))],64)):(D(),V("span",B$,"Ouvrir"))])],64))],2))])])]),d("div",G$,[d("div",H$,[d("button",{onClick:gt,disabled:M.value.length===0||a.value||L.value&&L.value.id!=="ALL"&&!x.value,class:"h-12 px-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600 flex-1"},[a.value?(D(),V("span",Y$,ne[17]||(ne[17]=[d("svg",{class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[d("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),d("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),Ct(" Envoi en cours... ")]))):(D(),V("span",Q$,[L.value&&L.value.id!=="ALL"?(D(),V("span",{key:0,class:Xt(x.value?"":"opacity-60")},[d("span",J$,"🔔 Notifier "+se(L.value.name),1),ne[14]||(ne[14]=d("span",{class:"sm:hidden"},"🔔 Notifier",-1))],2)):(D(),V(ot,{key:1},[ne[15]||(ne[15]=d("span",{class:"hidden sm:inline"},"🔔 Envoyer les notifications",-1)),ne[16]||(ne[16]=d("span",{class:"sm:hidden"},"🔔 Envoyer",-1))],64))]))],8,W$),d("button",{onClick:R,class:"h-12 px-6 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300",title:i.value},[s.value?(D(),V("span",eF,"✅ Copié")):(D(),V("span",Z$,ne[18]||(ne[18]=[d("span",{class:"hidden sm:inline"},"📋 Copier le message",-1),d("span",{class:"sm:hidden"},"📋 Copier",-1)])))],8,X$)]),d("button",{onClick:O,class:"h-12 px-4 bg-gray-700 text-white rounded-lg"}," Fermer ")])])])):ce("",!0)}}},tF={class:"relative p-6 pb-4 border-b border-white/10"},nF={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},rF={__name:"AppHelpModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[95] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=dt(()=>{},["stop"]))},[d("div",tF,[d("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=d("div",{class:"flex items-center gap-3"},[d("div",{class:"w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-2xl"},"❓"),d("div",null,[d("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Kezako ?"),d("p",{class:"text-sm text-purple-300"},"L'appli pour sélectionner les joueurs d'impro de manière simple et apaisée")])],-1))]),s[5]||(s[5]=Rn('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">C&#39;est quoi ?</h3><p> Tu joues quand ? est une appli conçue pour faciliter <span class="text-white">la sélection des joueurs d&#39;impro</span> pour les spectacles. L&#39;idée est née au sein de <span class="text-purple-300">La Malice</span> pour <span class="text-white">dépersonnaliser une tâche délicate</span> qui créait des tensions depuis des années. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">Comment ça marche</h3><p> L&#39;asso déclare ses dates et le nombre de personnes nécessaires. Les joueurs indiquent leurs disponibilités. L&#39;appli propose des sélections. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Sélection auto ou manuelle</h3><p> Le <span class="text-white">mode sélection auto</span> s&#39;appuie sur le hasard (pondéré) pour simplifier la vie. Vous pouvez aussi repasser en mode <span class="text-white">manuel</span> si besoin. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Pensée mobile • Libre d&#39;utilisation</h3><p> L&#39;appli est <span class="text-white">pensée pour le mobile</span> et peut être utilisée librement par La Malice ou <span class="text-white">toute autre troupe</span>. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Comptes (facultatif)</h3><p> Les joueurs qui le souhaitent peuvent créer un compte via leur email pour <span class="text-white">recevoir des notifications</span>, <span class="text-white">protéger leurs saisies</span> et bénéficier d&#39;un meilleur confort d&#39;utilisation. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2 text-sm"><h3 class="text-white font-semibold">Statut &amp; licence</h3><p> Application <span class="text-white">en cours de développement</span>, <span class="text-white">sans garanties</span> à ce stade. Licence libre <span class="text-white">MIT</span>. </p><p>Contact &amp; retours : <a href="mailto:contact@hatcast.app" class="text-blue-300 underline">contact@hatcast.app</a></p></div></div>',1)),d("div",nF,[d("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ce("",!0)}},sF={class:"text-center mb-6"},iF={class:"text-lg text-gray-300"},oF={class:"mb-6"},aF={class:"space-y-4"},lF={class:"flex items-center gap-2 text-gray-300 text-sm"},uF=["disabled"],cF={key:0,class:"animate-spin"},dF={key:1},hF={class:"mb-6 text-center"},fF={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},pF={class:"text-red-300 text-sm"},mF={class:"text-center mb-6"},gF={class:"text-lg text-gray-300"},vF={class:"mb-6"},yF=["disabled"],_F={key:0,class:"animate-spin"},bF={key:1},wF={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},xF={class:"text-red-300 text-sm"},IF={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},EF={class:"text-green-300 text-sm"},TF={class:"flex justify-center"},nv={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=P(""),i=P(!1),o=P(""),a=P(!1),l=P(""),c=P(""),h=P(null),f=P(!0);async function g(){if(s.value){i.value=!0,o.value="";try{const S=await Bp(t.seasonId);if(s.value===S){if(f.value)try{Ki.saveSession(t.player.id)}catch{}r("verified",{type:"season_pin"}),I();return}if(await FE(t.player.id,s.value,t.seasonId)){if(f.value)try{Ki.saveSession(t.player.id)}catch{}r("verified",{type:"player_password"}),I()}else o.value="Mot de passe incorrect. Veuillez réessayer."}catch(S){ae.error("Erreur lors de la vérification",S),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function y(){i.value=!0,l.value="",c.value="";try{const S=await jE(t.player.id,t.seasonId);c.value=S.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(S){ae.error("Erreur lors de l'envoi de l'email",S),l.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function I(){r("close"),s.value="",o.value="",a.value=!1,l.value="",c.value=""}return wt(()=>t.show,S=>{S&&Ht(()=>{h.value&&h.value.focus()})}),(S,E)=>{var $,F;return D(),V(ot,null,[n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:I},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:E[3]||(E[3]=dt(()=>{},["stop"]))},[d("div",sF,[E[7]||(E[7]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔐")],-1)),E[8]||(E[8]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Vérification requise",-1)),d("p",iF,se(($=n.player)==null?void 0:$.name),1),E[9]||(E[9]=d("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protégé par mot de passe",-1))]),d("div",oF,[d("div",aF,[d("div",null,[E[10]||(E[10]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),at(d("input",{"onUpdate:modelValue":E[0]||(E[0]=M=>s.value=M),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:qn(g,["enter"]),ref_key:"passwordInput",ref:h},null,544),[[Lt,s.value]])]),d("div",lF,[at(d("input",{id:"staySignedIn",type:"checkbox","onUpdate:modelValue":E[1]||(E[1]=M=>f.value=M),class:"w-4 h-4"},null,512),[[Pi,f.value]]),E[11]||(E[11]=d("label",{for:"staySignedIn"},"Rester connecté sur cet appareil",-1))])]),d("button",{onClick:g,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(D(),V("span",cF,"⏳")):(D(),V("span",dF,"🔓")),d("span",null,se(i.value?"Vérification...":"Vérifier"),1)],8,uF)]),d("div",hF,[d("button",{onClick:E[2]||(E[2]=M=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(D(),V("div",fF,[d("div",pF,se(o.value),1)])):ce("",!0),d("div",{class:"flex justify-center"},[d("button",{onClick:I,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ce("",!0),a.value?(D(),V("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:E[6]||(E[6]=M=>a.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:E[5]||(E[5]=dt(()=>{},["stop"]))},[d("div",mF,[E[12]||(E[12]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"📧")],-1)),E[13]||(E[13]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oublié",-1)),d("p",gF,se((F=n.player)==null?void 0:F.name),1)]),d("div",vF,[E[14]||(E[14]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),d("button",{onClick:y,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(D(),V("span",_F,"⏳")):(D(),V("span",bF,"📧")),d("span",null,se(i.value?"Envoi...":"Envoyer l'email"),1)],8,yF)]),l.value?(D(),V("div",wF,[d("div",xF,se(l.value),1)])):ce("",!0),c.value?(D(),V("div",IF,[d("div",EF,se(c.value),1)])):ce("",!0),d("div",TF,[d("button",{onClick:E[4]||(E[4]=M=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0)],64)}}},AF={class:"text-center mb-6"},SF={class:"text-sm text-gray-300"},PF={key:0,class:"space-y-4"},RF={key:0,class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},CF={key:1,class:"space-y-4"},kF=["disabled"],DF={key:0,class:"animate-spin"},NF={key:1},VF={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},OF={class:"mt-6 flex justify-center gap-3"},MF=["disabled"],LF={key:0,class:"animate-spin"},$F={key:1},bT={__name:"AccountClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=e,s=P(1),i=P(""),o=P(""),a=P(""),l=P(!1),c=P(""),h=P(!1),f=Qo(),g=Ue(()=>i.value&&i.value.includes("@")),y=Ue(()=>o.value&&a.value&&o.value===a.value&&o.value.length>=6);async function I(){var F,M,L;if(!(!g.value||!((F=t.player)!=null&&F.id))){l.value=!0,c.value="";try{const re=await VE({playerId:t.player.id,email:i.value.trim(),seasonId:t.seasonId}),W=(M=f.params)==null?void 0:M.slug,x=`${re.url}${W?`&slug=${encodeURIComponent(W)}`:""}&player=${encodeURIComponent(t.player.id)}&open=protection`;await yM({toEmail:i.value,playerName:((L=t.player)==null?void 0:L.name)||"joueur",verifyUrl:x}),h.value=!0}catch{c.value="Impossible d'envoyer l'email de vérification"}finally{l.value=!1}}}async function S(){try{await ME({playerId:t.player.id,seasonId:t.seasonId})}catch{}s.value=1,h.value=!1,i.value="",o.value="",a.value=""}async function E(){var F;try{const M=await Rl((F=t.player)==null?void 0:F.id,t.seasonId);M!=null&&M.email&&(M!=null&&M.emailVerifiedAt)?s.value=2:s.value=1}catch{s.value=1}}fn(()=>{E()}),wt(()=>t.show,F=>{F&&E()});async function $(){if(y.value){l.value=!0,c.value="";try{await NE(t.player.id,i.value.trim(),o.value,t.seasonId),r("success")}catch(F){c.value=(F==null?void 0:F.message)||"Erreur lors de l'association"}finally{l.value=!1}}}return(F,M)=>{var L;return n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:M[6]||(M[6]=re=>F.$emit("close"))},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:M[5]||(M[5]=dt(()=>{},["stop"]))},[d("button",{onClick:M[0]||(M[0]=re=>F.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),d("div",AF,[M[7]||(M[7]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"👤")],-1)),M[8]||(M[8]=d("h2",{class:"text-2xl font-bold text-white mb-1"},"Associer un compte",-1)),d("p",SF,"Pour sécuriser les saisies de "+se((L=n.player)==null?void 0:L.name),1),Qe(EE)]),s.value===1?(D(),V("div",PF,[d("div",null,[M[9]||(M[9]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),at(d("input",{"onUpdate:modelValue":M[1]||(M[1]=re=>i.value=re),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Lt,i.value]])]),h.value?(D(),V("div",RF,[M[10]||(M[10]=d("span",null,"✅",-1)),d("span",null,"Un email a été envoyé à "+se(i.value)+". Cliquez sur le lien contenu dans l'email pour continuer.",1)])):ce("",!0)])):s.value===2?(D(),V("div",CF,[d("div",{class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},[M[11]||(M[11]=d("span",null,"✅",-1)),M[12]||(M[12]=d("span",null,"Adresse email vérifiée",-1)),d("button",{type:"button",onClick:S,title:"Changer d'adresse email",class:"ml-auto px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-colors"},"✏️")]),d("div",null,[M[13]||(M[13]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),at(d("input",{"onUpdate:modelValue":M[2]||(M[2]=re=>o.value=re),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé (min. 6 caractères)"},null,512),[[Lt,o.value]])]),d("div",null,[M[14]||(M[14]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),at(d("input",{"onUpdate:modelValue":M[3]||(M[3]=re=>a.value=re),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[Lt,a.value]])]),d("button",{onClick:$,disabled:!y.value||l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(D(),V("span",DF,"⏳")):(D(),V("span",NF,"🔒")),d("span",null,se(l.value?"Association...":"Associer ce joueur"),1)],8,kF)])):ce("",!0),c.value?(D(),V("div",VF,se(c.value),1)):ce("",!0),d("div",OF,[s.value===1?(D(),V("button",{key:0,onClick:I,disabled:!g.value||l.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(D(),V("span",LF,"⏳")):(D(),V("span",$F,"✉️")),d("span",null,se(l.value?"Envoi...":"Envoyer le lien de vérification"),1)],8,MF)):ce("",!0),d("button",{onClick:M[4]||(M[4]=re=>F.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])):ce("",!0)}}},FF={class:"text-center mb-6"},UF={class:"text-2xl font-bold text-white mb-2"},jF={class:"text-lg text-gray-300"},qF={class:"mb-6"},BF={class:"flex items-center space-x-3"},zF={class:"text-2xl"},KF={class:"font-semibold text-white"},GF={class:"text-sm text-gray-300"},HF={key:0,class:"mb-6"},WF={key:1,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},QF={class:"text-red-300 text-sm"},JF={key:2,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},YF={class:"text-green-300 text-sm"},XF={class:"flex justify-center gap-3"},ZF=["disabled"],e6={__name:"PlayerClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null},onboarding:{type:Boolean,default:!1}},emits:["close","update","onboarding-finished"],setup(n,{emit:e}){const t=n,r=e,s=P(!1),i=P(!1),o=P(!1),a=P(""),l=P(""),c=P(!1);Qo();const h=P(!1);Ue(()=>!1),Ue(()=>!1);function f(){l.value="Compte créé et joueur associé !",s.value=!0,c.value=!1,r("update")}async function g(){var $;if(($=t.player)!=null&&$.id){s.value=await Vi(t.player.id,t.seasonId);try{const{isPlayerPasswordCached:F}=await Zt(()=>Promise.resolve().then(()=>Pc),void 0);i.value=F(t.player.id)}catch{i.value=!1}}}function y(){var $;a.value="";try{if(($=t.player)!=null&&$.id&&Mo(t.player.id)){I();return}}catch{}h.value=!0}async function I(){o.value=!0,a.value="",l.value="";try{const $=await LE(t.player.id,t.seasonId);l.value="Joueur déverrouillé!",s.value=!1,$.email&&(email.value=$.email),r("update")}catch($){logger.error("Erreur lors de la désactivation de la protection",$),a.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{o.value=!1}}function S(){h.value=!1,I()}function E(){r("close")}return wt(()=>t.player,()=>{t.show&&t.player&&g()},{immediate:!0}),wt(()=>t.show,$=>{$&&t.player&&(a.value="",l.value="",h.value=!1,g(),t.onboarding&&Ht(()=>{}))}),($,F)=>{var M;return D(),V(ot,null,[n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:E},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:F[1]||(F[1]=dt(()=>{},["stop"]))},[d("button",{onClick:E,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),d("div",FF,[F[4]||(F[4]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔒")],-1)),d("h2",UF,se(s.value?"Déverrouiller ce joueur":"Verrouiller ce joueur"),1),d("p",jF,se((M=n.player)==null?void 0:M.name),1)]),d("div",qF,[d("div",{class:Xt(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[d("div",BF,[d("span",zF,se(s.value?"🔒":"🔓"),1),d("div",null,[d("div",KF,se(s.value?i.value?"Joueur associé à votre compte":"Ce joueur est associé à un compte utilisateur":"Joueur sans compte"),1),d("div",GF,se(s.value?i.value?"Seul vous pouvez modifier":"Seul le titulaire peut modifier les disponibilités":"Tout le monde peut modifier les disponibilités"),1)])])],2)]),s.value?ce("",!0):(D(),V("div",HF,F[5]||(F[5]=[d("div",{class:"text-sm text-gray-300"},"Vous pouvez protéger vos saisies de disponibilités avec un compte utilisateur.",-1)]))),a.value?(D(),V("div",WF,[d("div",QF,se(a.value),1)])):ce("",!0),l.value?(D(),V("div",JF,[d("div",YF,se(l.value),1)])):ce("",!0),d("div",XF,[s.value?(D(),V("button",{key:1,onClick:y,disabled:o.value,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," 🔓 Dissocier ",8,ZF)):(D(),V("button",{key:0,onClick:F[0]||(F[0]=L=>c.value=!0),class:"px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300"}," Associer un compte ")),d("button",{onClick:E,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0),Qe(bT,{show:c.value,player:n.player,"season-id":n.seasonId,onClose:F[2]||(F[2]=L=>c.value=!1),onSuccess:f},null,8,["show","player","season-id"]),Qe(nv,{show:h.value,player:n.player,seasonId:n.seasonId,onClose:F[3]||(F[3]=L=>h.value=!1),onVerified:S},null,8,["show","player","seasonId"])],64)}}};const t6=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},n6={class:"relative p-4 md:p-6 border-b border-white/10"},r6={class:"flex items-start gap-4 md:gap-6"},s6={class:"flex-1 min-w-0"},i6={class:"flex items-center gap-3 mb-2"},o6={class:"text-xl md:text-2xl font-bold text-white leading-tight"},a6={class:"flex items-center gap-2"},l6={key:0,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border border-yellow-500/30 rounded-full"},u6={key:1,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30 rounded-full"},c6={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},d6={class:"grid grid-cols-3 gap-3 md:gap-4"},h6={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},f6={class:"text-xl md:text-2xl font-bold text-white"},p6={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},m6={class:"text-xl md:text-2xl font-bold text-white"},g6={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30 text-center"},v6={class:"text-xl md:text-2xl font-bold text-white"},y6={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},_6={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},b6={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},w6={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},x6={class:"mb-6"},I6={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null},onboardingStep:{type:Number,default:0},onboardingPlayerId:{type:[String,null],default:null},isProtected:{type:Boolean,default:!1},isPreferred:{type:Boolean,default:!1}},emits:["close","update","delete","refresh","advance-onboarding"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=P(!1),o=P(""),a=P(null),l=P(!1),c=P(!1),h=P(null);P(!1);const f=P(!1),g=P(!1),y=P(null),I=P(null),S=P({position:"fixed",top:"0px",left:"0px"}),E=P(null),$=P({position:"fixed",top:"0px",left:"0px"}),F=P(!1),M=P(!1);function L(){s("close"),f.value=!1,g.value=!1,S.value={position:"fixed",top:"0px",left:"0px"},$.value={position:"fixed",top:"0px",left:"0px"}}function re(){var ue;o.value=((ue=r.player)==null?void 0:ue.name)||"",i.value=!0,Ht(()=>{a.value&&a.value.focus()})}function W(){i.value=!1,o.value=""}async function x(){var ie,De;if(!o.value.trim())return;if(await Vi((ie=r.player)==null?void 0:ie.id,r.seasonId)){Mo((De=r.player)==null?void 0:De.id)?b():(h.value="update",c.value=!0);return}b()}function b(){var ue;s("update",{playerId:(ue=r.player)==null?void 0:ue.id,newName:o.value.trim()}),i.value=!1,o.value=""}async function A(){var ie,De;if(await Vi((ie=r.player)==null?void 0:ie.id,r.seasonId)){Mo((De=r.player)==null?void 0:De.id)?C():(h.value="delete",c.value=!0);return}C()}function C(){var ue;s("delete",(ue=r.player)==null?void 0:ue.id)}function O(){s("refresh")}function U(ue){h.value==="update"?b():h.value==="delete"&&C(),h.value=null}function R(){try{const ue=y.value;if(!ue)return;const ie=ue.getBoundingClientRect(),De=8;if(window.innerWidth>768){const ee=Math.max(De,Math.round(ie.top-De)),J=Math.max(De,Math.round(ie.left));S.value={position:"fixed",top:`${ee}px`,left:`${J}px`,zIndex:400}}else{const ee=Math.min(window.innerHeight-De,Math.round(ie.bottom+De)),J=Math.max(De,Math.round(ie.left));S.value={position:"fixed",top:`${ee}px`,left:`${J}px`,zIndex:400}}}catch{}}function mt(){try{const ee=Math.max(8,window.innerHeight-8-48-120),J=Math.max(8,Math.round(window.innerWidth-200-8));$.value={position:"fixed",top:`${ee}px`,left:`${J}px`,zIndex:400}}catch{}}function gt(){f.value=!f.value,f.value&&Ht(()=>R())}function be(){g.value=!g.value,g.value&&Ht(()=>mt())}wt(()=>r.show,ue=>{var ie;ue||(i.value=!1,o.value="",h.value=null,l.value=!1,f.value=!1,g.value=!1),ue&&((ie=r.player)!=null&&ie.id)&&(Vi(r.player.id,r.seasonId).then(De=>{F.value=!!De}),Zt(()=>Promise.resolve().then(()=>Pc),void 0).then(De=>{try{M.value=!!De.isPlayerPasswordCached(r.player.id)}catch{M.value=!1}}))}),fn(()=>{document.addEventListener("click",ue=>{if(f.value){const ie=y.value,De=I.value,ee=ie&&ie.contains(ue.target),J=De&&De.contains(ue.target);!ee&&!J&&(f.value=!1)}if(g.value){const ie=E.value;ie&&ie.contains(ue.target)||(g.value=!1)}}),document.addEventListener("keydown",ue=>{ue.key==="Escape"&&(f.value&&(f.value=!1),g.value&&(g.value=!1))}),window.addEventListener("resize",()=>{f.value&&R(),g.value&&mt()}),window.addEventListener("scroll",()=>{f.value&&R(),g.value&&mt()},{passive:!0})}),e({openProtection(){l.value=!0}});const ne=P({position:null});return wt(()=>r.show,ue=>{ue&&r.onboardingStep===4?Ht(()=>{const ie=document.querySelectorAll("button");let De=null;if(ie.forEach(ee=>{!De&&ee.textContent&&ee.textContent.includes("Protection")&&(De=ee)}),De){const ee=De.getBoundingClientRect();ne.value.position={x:Math.round(ee.right+8),y:Math.round(ee.top+window.scrollY-4)}}}):ue||(ne.value.position=null)}),(ue,ie)=>{var De;return D(),V(ot,null,[n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:L},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-xl max-h-[92vh] flex flex-col",onClick:ie[6]||(ie[6]=dt(()=>{},["stop"]))},[d("div",n6,[d("button",{onClick:L,class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",r6,[ie[15]||(ie[15]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"👤")],-1)),d("div",s6,[d("div",i6,[d("h2",o6,se((De=n.player)==null?void 0:De.name),1),d("div",a6,[n.isProtected?(D(),V("div",l6,ie[13]||(ie[13]=[d("span",{class:"text-yellow-400 text-sm"},"🔒",-1),d("span",{class:"text-yellow-300 text-xs font-medium"},"Protégé",-1)]))):ce("",!0),n.isPreferred?(D(),V("div",u6,ie[14]||(ie[14]=[d("span",{class:"text-purple-400 text-sm"},"⭐",-1),d("span",{class:"text-purple-300 text-xs font-medium"},"Favori",-1)]))):ce("",!0)])])])])]),d("div",c6,[d("div",null,[d("div",d6,[d("div",h6,[d("div",f6,se(r.stats.availability),1),ie[16]||(ie[16]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibilités",-1))]),d("div",p6,[d("div",m6,se(r.stats.selection),1),ie[17]||(ie[17]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélections",-1))]),d("div",g6,[d("div",v6,se(r.stats.ratio),1),ie[18]||(ie[18]=d("div",{class:"text-xs md:text-sm text-gray-300"},"% de sélection",-1))])])]),d("div",y6,[d("button",{onClick:ie[0]||(ie[0]=ee=>l.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},[d("span",null,se(F.value?"🔓":"🔒"),1),d("span",null,se(F.value?"Déverrouiller":"Verrouiller"),1)]),d("div",{class:"relative",ref_key:"playerMoreActionsRef",ref:y},[d("button",{onClick:ie[1]||(ie[1]=ee=>gt()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},ie[19]||(ie[19]=[d("span",null,"⋯",-1),d("span",null,"Plus",-1)]))],512),d("button",{onClick:L,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer "),(D(),Ns(Ru,{to:"body"},[f.value?(D(),V("div",{key:0,ref_key:"playerMoreActionsDropdownRef",ref:I,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:br(S.value)},[d("button",{onClick:ie[2]||(ie[2]=ee=>{re(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},ie[20]||(ie[20]=[d("span",null,"✏️",-1),d("span",null,"Renommer",-1)])),d("button",{onClick:ie[3]||(ie[3]=ee=>{A(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},ie[21]||(ie[21]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ce("",!0)]))])]),d("div",_6,[d("button",{onClick:ie[4]||(ie[4]=ee=>l.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"},se(F.value?"🔓 Déverrouiller":"🔒 Verrouiller"),1),d("button",{onClick:ie[5]||(ie[5]=ee=>be()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ "),d("button",{onClick:L,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer ")])])])):ce("",!0),(D(),Ns(Ru,{to:"body"},[g.value?(D(),V("div",{key:0,ref_key:"playerMoreActionsMobileDropdownRef",ref:E,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:br($.value)},[d("button",{onClick:ie[7]||(ie[7]=ee=>{re(),g.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},ie[22]||(ie[22]=[d("span",null,"✏️",-1),d("span",null,"Renommer",-1)])),d("button",{onClick:ie[8]||(ie[8]=ee=>{A(),g.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},ie[23]||(ie[23]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ce("",!0)])),i.value?(D(),V("div",b6,[d("div",w6,[ie[25]||(ie[25]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Renommer le joueur",-1)),d("div",x6,[ie[24]||(ie[24]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),at(d("input",{"onUpdate:modelValue":ie[9]||(ie[9]=ee=>o.value=ee),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[qn(W,["esc"]),qn(x,["enter"])],ref_key:"editNameInput",ref:a},null,544),[[Lt,o.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:W,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:x,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ce("",!0),Qe(e6,{show:l.value,player:n.player,seasonId:n.seasonId,onboarding:n.onboardingStep===4,onClose:ie[10]||(ie[10]=ee=>l.value=!1),onUpdate:O,onOnboardingFinished:ie[11]||(ie[11]=ee=>ue.$emit("advance-onboarding",5))},null,8,["show","player","seasonId","onboarding"]),Qe(nv,{show:c.value,player:n.player,seasonId:n.seasonId,onClose:ie[12]||(ie[12]=ee=>c.value=!1),onVerified:U},null,8,["show","player","seasonId"])],64)}}},E6=t6(I6,[["__scopeId","data-v-8237d7ee"]]),T6={class:"relative p-6 pb-4 border-b border-white/10"},A6={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},S6={__name:"HowItWorksModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=dt(()=>{},["stop"]))},[d("div",T6,[d("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=d("div",{class:"flex items-center gap-3"},[d("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-2xl"},"❓"),d("div",null,[d("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Comment fonctionne la sélection automatique ?"),d("p",{class:"text-sm text-blue-300"},"Tirage au sort pondéré pour favoriser l'équité")])],-1))]),s[5]||(s[5]=Rn('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">En bref</h3><p>On tire au sort uniquement parmi les joueurs <span class="text-green-300">disponibles</span>. Ceux qui ont <span class="text-purple-300">moins joué</span> ont plus de chances d&#39;être tirés. À long terme, tout le monde joue à peu près autant.</p></div><div class="space-y-3"><h3 class="text-white font-semibold">Détails du tirage</h3><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><span class="text-white">Qui participe ?</span> Tous les joueurs marqués « ✅ Disponible » pour l’événement.</li><li><span class="text-white">Un coup de pouce aux moins joués</span> : si vous avez moins joué récemment, le tirage vous favorise un peu plus.</li><li><span class="text-white">Comment se fait le tirage ?</span> On tire un nom au hasard en tenant compte de cet avantage, on le met de côté, puis on recommence jusqu’à avoir assez de joueurs.</li><li><span class="text-white">Si on relance</span> : on garde les joueurs encore disponibles et on complète seulement les places manquantes.</li><li><span class="text-white">Indisponibles</span> : ils ne sont jamais tirés au sort.</li></ol></div><div class="space-y-2"><h3 class="text-white font-semibold">Estimation des chances</h3><p>L’application peut afficher un pourcentage indicatif pour aider à comprendre : si Alice a moins joué que Bob, elle aura un pourcentage plus élevé. C’est une indication, pas une promesse : deux tirages peuvent donner des résultats différents.</p></div><div class="space-y-2"><h3 class="text-white font-semibold">Pourquoi c’est juste</h3><ul class="list-disc list-inside space-y-1 text-gray-300"><li>Ceux qui ont moins joué ont automatiquement plus de chances.</li><li>Après une sélection, vos chances diminuent un peu pour laisser la place aux autres.</li><li>Sur la durée, les sélections s’<span class="text-green-300">équilibrent naturellement</span>.</li></ul></div><div class="space-y-2"><h3 class="text-white font-semibold">Exemples rapides</h3><p> • Alice n’a encore jamais été sélectionnée, Bob a été sélectionné une fois, Charlie plusieurs fois. Pour 1 place, on aura environ : Alice 57 %, Bob 29 %, Charlie 14 %.<br> • S’il y a 2 places, les chances de chacun augmentent, mais l’ordre reste aléatoire : un tirage peut donner Alice + Bob, un autre Alice + Charlie. </p></div><div class="text-xs text-gray-400"> Remarque : l’algorithme favorise l’équité à long terme, mais <span class="text-gray-300">n’assure pas</span> une rotation parfaite à chaque événement. </div></div>',1)),d("div",A6,[d("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ce("",!0)}},P6={class:"relative p-4 md:p-6 border-b border-white/10"},R6={class:"flex items-start gap-4 md:gap-6"},C6={class:"flex-1 min-w-0"},k6={class:"text-xl md:text-2xl font-bold text-white leading-tight mb-2"},D6={class:"flex items-center gap-3"},N6={class:"text-base md:text-lg text-purple-300"},V6={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},O6={class:"text-blue-200"},M6={key:0,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm flex items-center gap-1",title:"Prêt pour la sélection"},L6={key:1,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded text-sm flex items-center gap-1",title:"Sélection complète"},$6={key:2,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded text-sm flex items-center gap-1",title:"Sélection incomplète"},F6={key:3,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded text-sm flex items-center gap-1",title:"Pas assez de joueurs disponibles"},U6={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},j6={class:"grid grid-cols-3 gap-3 md:gap-4 mb-4"},q6={class:"bg-gradient-to-r from-yellow-500/20 to-orange-500/20 p-3 md:p-4 rounded-lg border border-yellow-500/30 text-center"},B6={class:"text-xl md:text-2xl font-bold text-yellow-300"},z6={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},K6={class:"text-xl md:text-2xl font-bold text-white"},G6={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},H6={class:"text-xl md:text-2xl font-bold text-white"},W6={class:"mb-3"},Q6={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},J6={key:0,class:"flex items-center justify-between gap-2"},Y6=["title"],X6={key:0,class:"text-purple-400 mr-2"},Z6={key:1,class:"text-green-400 mr-2"},e5={key:2,class:"text-red-400 mr-2"},t5={key:3,class:"text-gray-400 mr-2"},n5=["onClick"],r5={key:1,class:"flex items-center justify-center"},s5=["onChange"],i5=["value"],o5=["onClick"],a5={key:0,class:"mb-3"},l5={key:1,class:"mb-3"},u5={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},c5={class:"flex-1"},d5={class:"text-blue-300 text-sm font-medium"},h5={class:"sticky bottom-0 w-full p-3 bg-gray-900/80 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},f5=["disabled","title"],p5=["disabled"],m5={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]}},emits:["close","selection","perfect","send-notifications","updateSelection"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=P(!1),o=P("Copier le message"),a=P(!1),l=P(!1),c=P(""),h=P(!1),f=P(!1),g=Ue(()=>{var ee;return((ee=r.event)==null?void 0:ee.playerCount)||6}),y=P([]),I=P(null),S=Ue(()=>(r.players||[]).map(ee=>ee.name).filter(ee=>{var J;return((J=r.playerAvailability)==null?void 0:J[ee])===!0}).sort((ee,J)=>ee.localeCompare(J,"fr",{sensitivity:"base"})));function E(ee){const J=new Set(y.value.filter(Boolean)),Te=y.value[ee];return Te&&J.delete(Te),S.value.filter(He=>!J.has(He))}function $(ee){I.value=ee}function F(){I.value=null}async function M(ee,J){var He;const Te=((He=ee==null?void 0:ee.target)==null?void 0:He.value)||"";Te&&(y.value[J]=Te,await O()),I.value=null}async function L(ee){y.value[ee]=null,await O()}Ue(()=>(E(-1).length<g.value,""));const re=Ue(()=>r.currentSelection&&r.currentSelection.length>0);function W(){var He;const ee=r.currentSelection||[],J=((He=r.event)==null?void 0:He.playerCount)||6,Te=r.availableCount||0;if(ee.length>0){const lt=ee.some(X=>!gt(X)),Ot=Te<J;if(lt||Ot)return{type:"incomplete",hasUnavailablePlayers:lt,hasInsufficientPlayers:Ot,unavailablePlayers:ee.filter(X=>!gt(X)),availableCount:Te,requiredCount:J}}return Te<J?{type:"insufficient",availableCount:Te,requiredCount:J}:ee.length===0?{type:"ready",availableCount:Te,requiredCount:J}:{type:"complete",availableCount:Te,requiredCount:J}}const x=Ue(()=>{var He;if(!re.value)return!1;const ee=r.currentSelection.some(lt=>!gt(lt)),J=((He=r.event)==null?void 0:He.playerCount)||6,Te=r.availableCount<J;return ee||Te});Ue(()=>{var Te;if(!x.value)return"";const ee=r.currentSelection.filter(He=>!gt(He)),J=((Te=r.event)==null?void 0:Te.playerCount)||6;return ee.length>0?ee.length===1?`${ee[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${ee.length} joueurs ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<J?`Seulement ${r.availableCount} joueurs disponibles pour ${J} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de joueurs à sélectionner.`:"Sélection incomplète"}),Ue(()=>{if(!r.event||!re.value)return"";const ee=b(r.event.date),J=r.currentSelection.join(", ");return`Sélection pour ${r.event.title} du ${ee} : ${J}`}),wt(()=>r.show,ee=>{if(ee){i.value=!1,o.value="Copier le message",l.value=!1,c.value="",h.value=!1,a.value=!1;const J=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],Te=g.value;y.value=Array.from({length:Te},(He,lt)=>J[lt]||null),I.value=null}}),wt([g,()=>r.currentSelection,()=>{var ee;return(ee=r.event)==null?void 0:ee.id}],()=>{if(!r.show)return;const ee=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],J=g.value,Te=Array.from({length:J},(He,lt)=>ee[lt]||y.value[lt]||null);y.value=Te.slice(0,J)});function b(ee){var Te;return ee?(typeof ee=="string"?new Date(ee):((Te=ee.toDate)==null?void 0:Te.call(ee))||ee).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function A(){s("selection")}function C(){s("perfect")}async function O(){var ee;if(!(!((ee=r.event)!=null&&ee.id)||!r.seasonId))try{const J=y.value.filter(Boolean);await Yp(r.event.id,J,r.seasonId),console.debug("Sélection sauvegardée automatiquement")}catch(J){console.error("Erreur lors de la sauvegarde automatique:",J)}}function U(){s("close")}function R(){a.value=!0}function mt(){f.value=!0}function gt(ee){return r.playerAvailability[ee]===!0}function be(ee){return r.playerAvailability[ee]===!1}function ne(ee){return r.currentSelection.includes(ee)&&gt(ee)}function ue(ee=!1,J=!1){if(h.value=ee,ee){const Te=b(r.event.date),He=r.currentSelection.join(", ");J?c.value=`Sélection mise à jour pour ${r.event.title} du ${Te} : ${He}. Pensez à prévenir les joueurs via le bouton "Annoncer" !`:c.value=`Nouvelle sélection pour ${r.event.title} du ${Te} : ${He}. Pensez à prévenir les joueurs via le bouton "Annoncer" !`}else c.value="Sélection effectuée avec succès !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function ie(){l.value=!1}e({showSuccess:ue});function De(ee){s("send-notifications",ee)}return(ee,J)=>{var Te,He,lt,Ot;return D(),V(ot,null,[n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:U},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:J[1]||(J[1]=dt(()=>{},["stop"]))},[d("div",P6,[d("button",{onClick:U,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",R6,[J[9]||(J[9]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),d("div",C6,[d("h2",k6,"Sélection pour "+se((Te=n.event)==null?void 0:Te.title),1),d("div",D6,[d("p",N6,se(b((He=n.event)==null?void 0:He.date)),1),d("div",V6,[J[4]||(J[4]=d("span",{class:"text-blue-300"},"👥",-1)),d("span",O6,se(((lt=n.event)==null?void 0:lt.playerCount)||6)+" joueurs",1)]),W().type==="ready"?(D(),V("div",M6,J[5]||(J[5]=[d("span",{class:"text-blue-300 text-xs"},"🆕",-1),d("span",{class:"text-blue-200 text-xs"},"Nouveau",-1)]))):W().type==="complete"?(D(),V("div",L6,J[6]||(J[6]=[d("span",{class:"text-green-300 text-xs"},"✅",-1),d("span",{class:"text-green-200 text-xs"},"Complet",-1)]))):W().type==="incomplete"?(D(),V("div",$6,J[7]||(J[7]=[d("span",{class:"text-orange-300 text-xs"},"⚠️",-1),d("span",{class:"text-orange-200 text-xs"},"À finaliser",-1)]))):W().type==="insufficient"?(D(),V("div",F6,J[8]||(J[8]=[d("span",{class:"text-red-300 text-xs"},"❌",-1),d("span",{class:"text-red-200 text-xs"},"Manque",-1)]))):ce("",!0)])])])]),d("div",U6,[d("div",j6,[d("div",q6,[d("div",B6,se(Math.max((((Ot=n.event)==null?void 0:Ot.playerCount)||6)-n.selectedCount,0)),1),J[10]||(J[10]=d("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))]),d("div",z6,[d("div",K6,se(n.availableCount),1),J[11]||(J[11]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),d("div",G6,[d("div",H6,se(n.selectedCount),1),J[12]||(J[12]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))])]),d("div",W6,[d("div",{class:"flex items-center gap-2 mb-2"},[J[14]||(J[14]=d("h3",{class:"text-base md:text-lg font-semibold text-white"},"Joueurs sélectionnés",-1)),d("button",{onClick:mt,class:"text-blue-300 hover:text-blue-200 p-1 rounded-full hover:bg-blue-500/10 transition-colors",title:"Comment fonctionne la sélection automatique ?"},J[13]||(J[13]=[d("span",{class:"text-sm"},"❓",-1)]))]),d("div",Q6,[(D(!0),V(ot,null,wr(y.value,(X,Ae)=>(D(),V("div",{key:"sel-slot-"+Ae,class:Xt(["relative p-3 rounded-lg border text-center transition-colors",X?["bg-gradient-to-r",be(X)?"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":gt(X)?"from-green-500/20 to-emerald-500/20 border-green-500/30":"from-red-500/20 to-red-600/20 border-red-500/30"]:"border-dashed border-white/20 hover:border-white/40 bg-white/5"])},[X?(D(),V("div",J6,[d("div",{class:"flex-1 text-white font-medium truncate",title:X},[ne(X)?(D(),V("span",X6,"🎭")):gt(X)?(D(),V("span",Z6,"✅")):be(X)?(D(),V("span",e5,"❌")):(D(),V("span",t5,"–")),Ct(" "+se(X),1)],8,Y6),d("button",{onClick:xe=>L(Ae),class:"text-white/80 hover:text-white rounded-full hover:bg-white/10 px-2 py-1",title:"Retirer ce joueur"}," × ",8,n5)])):(D(),V("div",r5,[I.value===Ae?(D(),V("select",{key:0,class:"w-full bg-gray-800 text-white rounded-md p-2 border border-white/20 focus:outline-none",onChange:xe=>M(xe,Ae),onBlur:J[0]||(J[0]=xe=>F())},[J[15]||(J[15]=d("option",{value:""},"— Choisir —",-1)),(D(!0),V(ot,null,wr(E(Ae),xe=>(D(),V("option",{key:xe,value:xe},se(xe),9,i5))),128))],40,s5)):(D(),V("button",{key:1,onClick:xe=>$(Ae),class:"flex items-center gap-2 text-white/80 hover:text-white px-2 py-1 rounded-md hover:bg-white/10",title:"Ajouter un joueur"},J[16]||(J[16]=[d("span",{class:"text-lg"},"＋",-1),d("span",{class:"text-sm"},"Ajouter",-1)]),8,o5))]))],2))),128))])]),re.value?(D(),V("div",a5,J[17]||(J[17]=[d("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[d("div",{class:"text-yellow-400"},"⚠️"),d("div",{class:"text-yellow-200 text-sm"},"Pensez à prévenir les gens de vos changements !")],-1)]))):ce("",!0),l.value?(D(),V("div",l5,[d("div",u5,[J[19]||(J[19]=d("div",{class:"text-blue-400 text-xl"},"✨",-1)),d("div",c5,[d("p",d5,se(c.value),1)]),d("button",{onClick:ie,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},J[18]||(J[18]=[d("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):ce("",!0)]),d("div",h5,[d("button",{onClick:A,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":re.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},J[20]||(J[20]=[Ct(" ✨ "),d("span",{class:"hidden sm:inline"},"Sélection Auto",-1),d("span",{class:"sm:hidden"},"Auto",-1)]),8,f5),d("button",{onClick:R,disabled:!re.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},J[21]||(J[21]=[Ct(" 📣 "),d("span",{class:"hidden sm:inline"},"Annoncer",-1),d("span",{class:"sm:hidden"},"Annoncer",-1)]),8,p5),d("button",{onClick:C,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 whitespace-nowrap"},J[22]||(J[22]=[d("span",{class:"hidden sm:inline"},"Fermer",-1),d("span",{class:"sm:hidden"},"Fermer",-1)]))])])])):ce("",!0),Qe(_T,{show:a.value,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,mode:"selection","selected-players":n.currentSelection,onClose:J[2]||(J[2]=X=>a.value=!1),onSendNotifications:De},null,8,["show","event","season-id","season-slug","players","selected-players"]),Qe(S6,{show:f.value,onClose:J[3]||(J[3]=X=>f.value=!1)},null,8,["show"])],64)}}},g5={class:"flex items-center justify-center"},v5=["title"],y5={key:0,class:"text-center"},_5={key:1,class:"text-center"},b5={key:2,class:"text-center"},w5={key:3,class:"text-center text-gray-400"},E_={__name:"AvailabilityCell",props:{playerName:{type:String,required:!0},compact:{type:Boolean,default:!1},eventId:{type:String,required:!0},isAvailable:{type:Boolean,default:null},isSelected:{type:Boolean,default:!1},chancePercent:{type:Number,default:null},showSelectedChance:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["toggle"],setup(n,{emit:e}){const t=n,r=e,s=P(!1),i=Ue(()=>!(t.chancePercent==null||t.isAvailable!==!0||t.isSelected&&!t.showSelectedChance)),o=Ue(()=>t.disabled?"Événement archivé — désarchivez pour modifier":t.isSelected&&t.isAvailable===!0?i.value?`${t.playerName} est sélectionné pour cet événement • avait ~${t.chancePercent}% de chances`:`${t.playerName} est sélectionné pour cet événement`:t.isAvailable===!0?t.chancePercent!=null?`${t.playerName} est disponible • ~${t.chancePercent}% de chances d'être sélectionné`:`${t.playerName} est disponible`:t.isAvailable===!1?`${t.playerName} n'est pas disponible`:`Cliquer pour indiquer la disponibilité de ${t.playerName}`);function a(){t.disabled||r("toggle",t.playerName,t.eventId)}return(l,c)=>(D(),V("div",{class:Xt(["flex items-center justify-center transition-all duration-200 rounded font-medium text-white mx-0.5 my-0.25",[n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer hover:scale-105",n.compact?"min-h-0 p-1 md:p-2 text-xs":"min-h-20 p-2 md:p-3 text-sm",n.isSelected&&n.isAvailable===!0?"bg-gradient-to-br from-purple-500/60 to-pink-500/60":"",!n.isSelected&&n.isAvailable===!0?"bg-green-500/60":"",n.isAvailable===!1?"bg-red-500/60":"",n.isAvailable===null||n.isAvailable===void 0?"bg-gray-500/40":""]]),onClick:a,onMouseenter:c[0]||(c[0]=h=>s.value=!0),onMouseleave:c[1]||(c[1]=h=>s.value=!1)},[d("div",g5,[i.value&&s.value?(D(),V("span",{key:0,class:"text-[11px] md:text-xs px-2 py-0.5 rounded-full bg-emerald-500/15 border border-emerald-400/40 text-emerald-200",title:o.value},se(n.chancePercent)+"% ",9,v5)):(D(),V(ot,{key:1},[n.isSelected&&n.isAvailable===!0?(D(),V("span",y5," Joue ")):n.isAvailable===!0?(D(),V("span",_5," Disponible ")):n.isAvailable===!1?(D(),V("span",b5," Pas disponible ")):(D(),V("span",w5," – "))],64))])],34))}},x5={key:0,class:"fixed inset-0 z-[130] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},I5={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},E5={class:"text-2xl md:text-3xl font-bold text-white mb-3"},T5={class:"text-gray-300 mb-6"},A5={class:"flex flex-col items-stretch justify-center gap-3"},S5=["value"],P5={__name:"CreatorOnboardingModal",props:{seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},onboardingDone:{type:Boolean,default:!1}},emits:["create-event","add-player","copy-link","dismissed"],setup(n,{emit:e}){const t=n,r=e,s=window.location.origin,i=Ue(()=>`${s}/season/${t.seasonSlug}`),o=P(!1);try{t.seasonId&&(o.value=!!localStorage.getItem(`dismissCreatorOnboarding:${t.seasonId}`))}catch{}const a=Ue(()=>t.onboardingDone?0:t.eventsCount===0&&t.playersCount===0?1:t.eventsCount>0&&t.playersCount===0?2:t.eventsCount>0&&t.playersCount>0&&!o.value?3:0),l=Ue(()=>a.value>0),c=P(l.value);wt(a,E=>{c.value=E>0});const h=Ue(()=>{switch(a.value){case 1:return"Commençons par créer votre premier événement";case 2:return"Super ! Ajoutez votre premier joueur";case 3:return"Vous y êtes presque! Maintenant, invitez vos joueurs.";default:return""}}),f=Ue(()=>{switch(a.value){case 1:return"Un titre, une date... et c’est parti.";case 2:return"Ajoutez au moins un joueur pour commencer à saisir des disponibilités.";case 3:return"Laissez vos membres s’inscrire eux-même et indiquer leurs disponibilités en leur envoyant le lien direct.";default:return""}});function g(){c.value=!1,r("create-event")}function y(){c.value=!1,r("add-player")}function I(){var E;try{(E=navigator.clipboard)==null||E.writeText(i.value)}catch{}r("copy-link")}async function S(){try{if(t.seasonId){const{db:E}=await Zt(()=>Promise.resolve().then(()=>Ni),void 0),{doc:$,updateDoc:F}=await Zt(()=>import("./index.esm-fc5a1acc.js"),[]);await F($(E,"seasons",t.seasonId),{onboardingCreatorDone:!0})}else localStorage.setItem("dismissCreatorOnboarding","1")}catch{}o.value=!0,c.value=!1,r("dismissed")}return(E,$)=>l.value&&c.value?(D(),V("div",x5,[d("div",I5,[$[1]||($[1]=d("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[d("span",{class:"text-3xl"},"🎬")],-1)),d("h2",E5,se(h.value),1),d("p",T5,se(f.value),1),d("div",A5,[a.value===1?(D(),V("button",{key:0,onClick:g,class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all"}," ✨ Créer un événement ")):a.value===2?(D(),V("button",{key:1,onClick:y,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"}," 👤 Ajouter un joueur ")):a.value===3?(D(),V(ot,{key:2},[d("input",{value:i.value,type:"text",readonly:"",class:"w-full px-3 py-2 bg-gray-800 border border-white/20 rounded-lg text-white text-sm select-all",onFocus:$[0]||($[0]=F=>F.target.select())},null,40,S5),d("div",{class:"flex gap-3 justify-center"},[d("button",{onClick:I,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"}," 🔗 Copier le lien "),d("button",{onClick:S,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"}," J’ai compris ")])],64)):ce("",!0)])])])):ce("",!0)}},R5={class:"sticky top-0 z-[60] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},C5={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},k5={class:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2"},D5={class:"hidden md:flex items-center gap-2"},N5={class:"md:hidden"},V5={__name:"SeasonHeader",props:{seasonName:{type:String,default:""},isScrolled:{type:Boolean,default:!1}},emits:["go-back","open-account-menu","open-help","open-notifications","open-players","logout","open-login","open-account"],setup(n,{emit:e}){const t=n,r=e,s=P(null),i=Ue(()=>{var S;return!!s.value&&!((S=s.value)!=null&&S.isAnonymous)}),o=Ue(()=>t.isScrolled?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700":"bg-white/10 hover:bg-white/20 text-white border-white/20 hover:border-white/40");function a(S){s.value=S}fn(()=>{s.value=Be.currentUser;const S=Be.onAuthStateChanged(a);window._seasonHeaderUnsubscribe=S}),ki(()=>{window._seasonHeaderUnsubscribe&&(window._seasonHeaderUnsubscribe(),delete window._seasonHeaderUnsubscribe)});function l(){r("go-back")}function c(){r("open-account-menu")}function h(){r("open-login")}function f(){r("open-help")}function g(){r("open-notifications")}function y(){r("open-players")}function I(){r("logout")}return(S,E)=>(D(),V("div",R5,[d("button",{onClick:l,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour aux saisons"},E[0]||(E[0]=[d("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),d("h1",C5,se(n.seasonName?n.seasonName:"Chargement..."),1),d("div",k5,[d("div",D5,[Qe(Qp,{"is-connected":i.value,"button-class":o.value,onOpenAccountMenu:c,onOpenHelp:f,onOpenNotifications:g,onOpenPlayers:y,onLogout:I,onOpenLogin:h},null,8,["is-connected","button-class"]),i.value?ce("",!0):(D(),V("button",{key:0,onClick:f,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Kezako ?","aria-label":"Kezako ?"},E[1]||(E[1]=[d("span",{class:"text-2xl"},"❓",-1)])))]),d("div",N5,[Qe(Qp,{"is-connected":i.value,"button-class":o.value,onOpenAccountMenu:c,onOpenHelp:f,onOpenNotifications:g,onOpenPlayers:y,onLogout:I,onOpenLogin:h},null,8,["is-connected","button-class"])])])]))}};const O5={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},M5={class:"w-full px-0 md:px-0 pb-0 pt-[72px] md:pt-[80px] -mt-[72px] md:-mt-[80px] bg-gray-900"},L5={class:"flex items-stretch relative"},$5={key:0,class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},F5={class:"flex-1 overflow-hidden"},U5=["data-event-id"],j5=["title","onClick"],q5={class:"flex flex-col items-center flex-1 justify-center"},B5={class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2 group-hover:text-purple-300 transition-colors duration-200"},z5={key:0,class:"mt-1 text-xs text-gray-400"},K5={class:"relative"},G5=["onClick","title"],H5={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},W5={class:"p-2"},Q5=["onClick"],J5=["onClick"],Y5=["onClick"],X5={class:"flex flex-col items-center mt-2"},Z5={key:0,class:"px-2 py-1 bg-gray-500/20 border border-gray-400/30 rounded-md mx-auto flex items-center justify-center",title:"Événement archivé"},eU=["title","onClick"],tU=["title","onClick"],nU=["title","onClick"],rU=["title","onClick"],sU=["title","aria-label"],iU={class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},oU={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3l18 18"},aU={key:0,class:"pointer-events-none"},lU={class:"flex items-center justify-between"},uU={key:1,class:"pointer-events-none"},cU={id:"coachmark-avail",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-pink-500/40 rounded-xl shadow-2xl p-3 text-white relative"},dU={class:"flex items-center justify-between"},hU={key:2,class:"pointer-events-none"},fU={id:"coachmark-name",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-yellow-500/40 rounded-xl shadow-2xl p-3 text-white relative"},pU={class:"flex items-center justify-between"},mU={class:"table-auto border-separate border-spacing-0 table-fixed w-auto min-w-max"},gU=["data-player-id"],vU={class:"px-0 py-4 md:py-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900 left-col-td"},yU={class:"px-4 md:px-5 font-bold text-xl md:text-2xl flex items-center w-full min-w-0"},_U={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Mon joueur"},bU={key:1,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protégé par mot de passe"},wU=["onClick","title"],xU={class:"group-hover:text-purple-300 transition-colors duration-200"},IU=["data-event-id"],EU={class:"border-t border-white/10"},TU={class:"px-0 py-4 md:py-5 sticky left-0 z-40 bg-gray-900 left-col-td"},AU={class:"px-4 md:px-5 flex items-center"},SU=["data-event-id"],PU={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},RU={class:"text-center"},CU={class:"text-white text-lg"},kU={class:"mt-3 w-64 h-2 bg-white/10 rounded-full overflow-hidden"},DU={class:"text-white/60 text-xs mt-2"},NU={key:3,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-[200]"},VU={class:"flex items-center space-x-2"},OU={key:4,class:"fixed bottom-4 left-4 bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl shadow-2xl border border-red-400/30 backdrop-blur-sm z-[200]"},MU={class:"flex items-center space-x-2"},LU={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},$U={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},FU={class:"mb-6"},UU={class:"mb-6"},jU={class:"mb-6"},qU={class:"mb-6 flex items-center gap-3"},BU={class:"mb-6"},zU={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},KU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},GU={class:"mb-6"},HU={class:"flex justify-end space-x-3"},WU={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},QU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},JU={class:"flex justify-end space-x-3"},YU={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},XU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},ZU={class:"flex justify-end space-x-3"},ej={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},tj={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},nj={class:"text-center mb-6"},rj={class:"text-gray-300"},sj={key:0},ij={key:1},oj={class:"relative p-4 md:p-6 border-b border-white/10"},aj={class:"flex items-start gap-4 md:gap-6"},lj={class:"flex-1 min-w-0"},uj={class:"flex items-center gap-3 mb-2"},cj={class:"text-xl md:text-2xl font-bold text-white leading-tight"},dj={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},hj={class:"text-blue-200"},fj={class:"flex items-center gap-3 mb-3"},pj={class:"text-base md:text-lg text-purple-300"},mj={class:"relative"},gj={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},vj={class:"p-2"},yj={key:0,class:"text-sm text-gray-300 bg-gray-800/30 p-3 rounded-lg border border-gray-600/30"},_j={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},bj={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},wj={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},xj={class:"text-xl md:text-2xl font-bold text-white"},Ij={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},Ej={class:"text-xl md:text-2xl font-bold text-white"},Tj={class:"p-3 md:p-4 rounded-lg border border-yellow-500/30 bg-yellow-500/10 text-center"},Aj={class:"text-xl md:text-2xl font-bold text-yellow-300"},Sj={key:0,class:"mb-4 md:mb-6"},Pj={class:"mb-3 flex items-center"},Rj=["title"],Cj={class:"truncate"},kj={class:"space-y-0.5"},Dj={class:"flex items-center min-w-0 gap-1.5"},Nj={key:0,class:"text-yellow-400 mr-1 text-xs",title:"Mon joueur"},Vj={key:1,class:"text-yellow-400 mr-1 text-xs",title:"Joueur protégé par mot de passe"},Oj=["title"],Mj={class:"flex-0 p-0"},Lj={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},$j=["disabled","title"],Fj=["title"],Uj={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},jj=["disabled","title"],qj={key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},Bj={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},zj={class:"mb-6"},Kj={class:"mb-6"},Gj={class:"mb-6"},Hj={class:"mb-6 flex items-center gap-3"},Wj={class:"mb-6"},Qj={key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},Jj={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},Yj={class:"mb-6"},Xj={class:"space-y-4"},Zj=["disabled"],eq={key:0,class:"animate-spin"},tq={key:1},nq={class:"mb-6 text-center"},rq={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},sq={class:"text-red-300 text-sm"},iq={key:13,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},oq={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},aq={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},lq={class:"space-y-4"},uq={class:"mt-2 text-center"},cq={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},dq={class:"text-red-300 text-sm"},hq={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},fq=["disabled"],pq={key:0,class:"animate-spin"},mq={key:1},gq={class:"mb-6"},vq=["disabled"],yq={key:0,class:"animate-spin"},_q={key:1},bq={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},wq={class:"text-red-300 text-sm"},xq={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},Iq={class:"text-green-300 text-sm"},Eq={class:"flex justify-center"},Tq={class:"mb-6"},Aq=["disabled"],Sq={key:0,class:"animate-spin"},Pq={key:1},Rq={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Cq={class:"text-red-300 text-sm"},kq={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},Dq={class:"text-green-300 text-sm"},Nq={class:"flex justify-center"},Vq={key:16,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},Oq={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl max-w-md"},Mq={class:"flex gap-3"},T_={__name:"GridBoard",props:{slug:{type:String,required:!0},eventId:{type:String,required:!1}},setup(n){const e=n,t=dl(),r=Qo(),s=e.slug,i=P(""),o=P(""),a=P({}),l=P(!1),c=P(!1),h=P(null),f=P(null),g=P(""),y=P(""),I=P(6),S=P(!1),E=P(""),$=P(null),F=P(null),M=P(null),L=P({position:null,side:null}),re=P({position:null}),W=P({position:null}),x=P(!1),b=P(null),A=P(!1),C=P(null),O=P(null),U=P(!1),R=P(null),mt=P(""),gt=P(!1),be=P(null),ne=P(""),ue=P(""),ie=P(!1),De=P(null),ee=P(!1),J=P(null),Te=P(""),He=P(""),lt=P(!1),Ot=P(null),X=P(!1),Ae=P(!1),xe=P(""),Ne=P(""),tt=P(!1),ct=P(!1),T=P(""),k=P(""),K=P(!1),G=P(null),te=P(""),de=P(!1),ye=P(!1),ve=P(!1),Ie=P(null),ge=P(null),$e=P({position:"fixed",top:"0px",left:"0px"}),Pe=P(null),Oe=P({position:"fixed",top:"0px",left:"0px"}),z=P(null),j=P(!1);function _e(){try{const _=Ie.value;if(!_)return;const m=_.getBoundingClientRect(),N=8;if(window.innerWidth>768){const Z=Math.max(N,Math.round(m.top-N)),oe=Math.max(N,Math.round(m.left));$e.value={position:"fixed",top:`${Z}px`,left:`${oe}px`,zIndex:400}}else{const Z=Math.min(window.innerHeight-N,Math.round(m.bottom+N)),oe=Math.max(N,Math.round(m.left));$e.value={position:"fixed",top:`${Z}px`,left:`${oe}px`,zIndex:400}}}catch{}}function we(){try{const Z=Math.max(8,window.innerHeight-8-48-200),oe=Math.max(8,Math.round(window.innerWidth-200-8));Oe.value={position:"fixed",top:`${Z}px`,left:`${oe}px`,zIndex:400}}catch{}}function We(){ve.value=!ve.value,ve.value&&Ht(()=>_e())}function Ye(){ye.value=!ye.value,ye.value&&Ht(()=>we())}function bt(_){z.value===_?z.value=null:z.value=_}function rt(){z.value=null}function Er(){j.value=!j.value}function Tr(){j.value=!1}const jt=P(!1),nn=P(null),Un=P(null),nr=P(null),qt=P(0);function ra(){var _;try{if(!o.value||!a.value||a.value.onboardingCreatorDone!==!0||Ge.value.length===0)return;const m=localStorage.getItem(`playerTourCompleted:${o.value}`);try{const Z=((_=Be==null?void 0:Be.currentUser)==null?void 0:_.email)||"";Z&&sf(Z).then(async oe=>{const me=oe.filter(he=>he.seasonId===o.value);if(me.length>0){const he=`seasonPreferredPlayer:${o.value}`,Me=localStorage.getItem(he);let Xe=[];if(Me)if(Me.startsWith("["))try{Xe=JSON.parse(Me)||[]}catch{}else Xe=[Me];const it=new Set(Xe);me.forEach(Yt=>it.add(Yt.playerId));const It=Array.from(it);localStorage.setItem(he,JSON.stringify(It))}}).catch(()=>{})}catch{}const N=localStorage.getItem(`startPlayerTour:${o.value}`);!m&&N&&(qt.value=1,localStorage.removeItem(`startPlayerTour:${o.value}`),Ht(()=>{const Z=document.querySelector('button[data-onboarding="add-player"]');if(Z){Z.scrollIntoView({behavior:"smooth",block:"end"});const oe=Z.getBoundingClientRect(),me=document.getElementById("coachmark-add"),he=280,Me=100,Xe=(me==null?void 0:me.offsetWidth)||he,it=(me==null?void 0:me.offsetHeight)||Me,It=Math.round(oe.right+12);if(It+Xe<=window.innerWidth-12){const un=oe.top+oe.height/2-it/2,cn=-14,Et=12,_r=window.innerHeight-it-12,Lr=Math.max(Et,Math.min(Math.round(un+cn),_r));L.value={position:{x:It,y:Lr},side:"right"}}else{const un=Math.round(oe.left+oe.width/2-Xe/2),cn=Math.round(oe.top-it-8),Et=8,_r=window.innerWidth-Xe-8;L.value={position:{x:Math.max(Et,Math.min(un,_r)),y:cn},side:null}}}}))}catch{}}const Jn=P(!1),vn=P(null),hs=P(null),Nr=P(!1),eo=P(null),fs=P(!1),to=P(null),ps=P(!1),ms=P(!1),bn=P(!1),no=P(!1),gs=P(!1),vs=P(!1),Rc=P(null);function lf(){ms.value=!0}function zr(){ms.value=!1}function uf(){gs.value=!0}function cf(){gs.value=!1}function sa(){vs.value=!0}function Cc(){vs.value=!1}function ia(){try{const _=Be==null?void 0:Be.currentUser;if(!_||_.isAnonymous){let m=null;if(Jr.value&&Jr.value.size>0){const N=Jr.value.values().next().value;m=st.value.find(Z=>Z.id===N)||null}m||(m=st.value[0]||null),no.value=!0,m&&(Rc.value=m);return}}catch{}ms.value=!0}async function oa(){var _;try{const m=(_=Be==null?void 0:Be.currentUser)==null?void 0:_.email;if(!m)return;const{resetPlayerPassword:N}=await Zt(()=>Promise.resolve().then(()=>Ni),void 0);await N(m),Fe.value=!0,vt.value="Email de réinitialisation envoyé.",setTimeout(()=>{Fe.value=!1},3e3)}catch{gr.value=!0,si.value="Impossible d'envoyer l'email de réinitialisation.",setTimeout(()=>{gr.value=!1},3e3)}}async function Vr(){try{await JN(Be),zr(),Fe.value=!0,vt.value="Déconnecté de cet appareil.",setTimeout(()=>{Fe.value=!1},2500)}catch{gr.value=!0,si.value="Déconnexion impossible.",setTimeout(()=>{gr.value=!1},3e3)}}async function kc(){alert("Suppression de compte: contactez l'organisateur pour dissocier vos joueurs. Fonction complète à venir.")}async function Cl(_){var m;zr();try{if(_.seasonId&&_.seasonId!==o.value){const N=Re(le,"seasons",_.seasonId),oe=(await Pt(et(le,"seasons"))).docs.find(he=>he.id===_.seasonId),me=(m=oe==null?void 0:oe.data())==null?void 0:m.slug;if(me){t.push(`/season/${me}?player=${encodeURIComponent(_.playerId)}&open=protection`);return}}else{const N=st.value.find(Z=>Z.id===_.playerId);if(N){pf(N);return}t.push(`?player=${encodeURIComponent(_.playerId)}&open=protection`)}}catch{}}fn(()=>{try{o.value&&localStorage.getItem(`dismissCreatorOnboarding:${o.value}`)&&(onboardingDismissedShare.value=!0)}catch{}const _=()=>{l.value=window.scrollY>10};window.addEventListener("scroll",_,{passive:!0}),document.addEventListener("click",m=>{if(ve.value){const N=Ie.value,Z=ge.value,oe=N&&N.contains(m.target),me=Z&&Z.contains(m.target);!oe&&!me&&(ve.value=!1)}if(ye.value){const N=Pe.value;N&&N.contains(m.target)||(ye.value=!1)}}),document.addEventListener("keydown",m=>{m.key==="Escape"&&(ve.value&&(ve.value=!1),ye.value&&(ye.value=!1))}),window.addEventListener("resize",()=>{ve.value&&_e(),ye.value&&we()}),window.addEventListener("scroll",()=>{ve.value&&_e(),ye.value&&we()},{passive:!0})});function kl(){Ht(()=>{Vl()})}const Ar=P(new Set),Kr=P(!0),Or=P(0),Zs=P("Préparation de la grille"),pr=P(e.eventId||null),Dl=P(!1),ei=P(null);wt(()=>e.eventId,_=>{if(_)if(pr.value=_,Ge.value.length>0)dv(_);else{const m=wt(Ge,N=>{N.length>0&&(dv(_),m())},{immediate:!0})}});const Mr=Ue(()=>st.value.map(_=>({..._,isProtected:Ar.value.has(_.id),email:null}))),ys=Ue(()=>pr.value?ln.value.findIndex(_=>_.id===pr.value):-1);Ue(()=>{if(!pr.value||ys.value===-1)return!1;if(window.innerWidth<=768){const _=document.querySelector(`[data-event-id="${pr.value}"]`);if(_){const m=_.getBoundingClientRect();return m.left>=0&&m.right<=window.innerWidth}}return!0});const rr=P(null),Dc=P(!1),Nl=P(!1),aa=P(0),Nc=P(null),Nn=P(null),ti=P(null);function mr(){const _=rr.value;if(!_)return;const{scrollLeft:m,scrollWidth:N,clientWidth:Z}=_;Dc.value=m>2,Nl.value=m<N-Z-2}function Vl(){var _;try{mr(),aa.value=((_=rr.value)==null?void 0:_.scrollLeft)||0}catch{}}function Vc(_){const m=rr.value;if(!m)return;let N=0;const Z=m.querySelector("tbody tr td[data-event-id]");if(Z)N=Z.getBoundingClientRect().width;else if(Nn!=null&&Nn.value){const me=Nn.value.querySelector(".col-event");me&&(N=me.getBoundingClientRect().width)}(!N||!isFinite(N))&&(N=m.clientWidth*.6);const oe=m.scrollLeft+_*N;m.scrollTo({left:oe,behavior:"smooth"})}const ro=P(null);P(0);const ni=P(!1),so=P(!1),ri=P(0);function Gr(_,m){m&&typeof m.preventDefault=="function"&&m.preventDefault(),ir(),Vc(_)}function sr(_,m){if(m&&typeof m.preventDefault=="function"&&m.preventDefault(),ni.value)return;ni.value=!0,ri.value=_,so.value=!1;const N=rr.value;if(!N)return;let Z=0;const oe=N.querySelector("tbody tr td[data-event-id]");if(oe)Z=oe.getBoundingClientRect().width;else if(Nn!=null&&Nn.value){const Xe=Nn.value.querySelector(".col-event");Xe&&(Z=Xe.getBoundingClientRect().width)}(!Z||!isFinite(Z))&&(Z=N.clientWidth*.6);const me=Z/6,he=120,Me=()=>{if(!ni.value||ri.value===0)return;so.value||(so.value=!0);const Xe=N.scrollLeft+ri.value*me;N.scrollTo({left:Xe,behavior:"auto"}),ro.value=window.setTimeout(Me,he)};ro.value=window.setTimeout(Me,250)}function ir(_){_&&typeof _.preventDefault=="function"&&_.preventDefault();const m=ni.value,N=so.value;if(ni.value=!1,ro.value&&(clearTimeout(ro.value),ro.value=null),_&&typeof _.type=="string"&&_.type.startsWith("touch")&&!N){const Z=ri.value||0;Z!==0&&Vc(Z),ri.value=0;return}ri.value=0,m&&N&&la()}function la(){const _=rr.value;if(!_)return;let m=0;const N=_.querySelector("tbody tr td[data-event-id]");if(N)m=N.getBoundingClientRect().width;else if(Nn!=null&&Nn.value){const he=Nn.value.querySelector(".col-event");he&&(m=he.getBoundingClientRect().width)}if(!m||!isFinite(m)||m<=0)return;const Z=_.scrollLeft,me=Math.round(Z/m)*m;_.scrollTo({left:me,behavior:"smooth"})}function Oc(_){$.value=_;const m=document.querySelector(`[data-player-id="${_}"]`);m&&m.scrollIntoView({behavior:"smooth",block:"center"}),Fe.value=!0,vt.value="Nouveau joueur ajouté !",setTimeout(()=>{Fe.value=!1},3e3)}function Dt(){if(qt.value!==1)return;const _=document.querySelector('button[data-onboarding="add-player"]');if(!_)return;const m=_.getBoundingClientRect(),N=document.getElementById("coachmark-add"),Z=280,oe=100,me=N!=null&&N.offsetWidth&&N.offsetWidth>0?N.offsetWidth:Z,he=N!=null&&N.offsetHeight&&N.offsetHeight>0?N.offsetHeight:oe,Me=Math.round(m.right+12);if(Me+me<=window.innerWidth-12){const it=m.top+m.height/2-he/2,Yt=io(it+-14,he);L.value={position:{x:Me,y:Yt},side:"right"}}else{const it=Math.round(m.left+m.width/2-me/2),It=io(m.top-he-8,he),Yt=8,un=window.innerWidth-me-8;L.value={position:{x:Math.max(Yt,Math.min(it,un)),y:It},side:null}}}function io(_,m){const N=pageHeaderRef==null?void 0:pageHeaderRef.value,Z=N?Math.max(0,Math.round(N.getBoundingClientRect().height||0)):0,oe=Math.max(12,Z+8),me=window.innerHeight-m-12;return Math.max(oe,Math.min(Math.round(_),me))}function Hr(){var _;qt.value===1&&((_=L.value)!=null&&_.position)&&Dt()}fn(()=>{window.addEventListener("scroll",Hr,{passive:!0}),window.addEventListener("resize",Hr)}),ki(()=>{window.removeEventListener("scroll",Hr),window.removeEventListener("resize",Hr),window.removeEventListener("scroll",handleScroll)});function Wr(_){return Ar.value.has(_)}async function Ol(){if(o.value)try{const _=await Wp(o.value),m=new Set;_.forEach(N=>{N.isProtected&&m.add(N.playerId||N.id)}),Ar.value=m}catch{const m=new Set;for(const N of st.value)await Vi(N.id,o.value)&&m.add(N.id);Ar.value=m}}const Fe=P(!1),vt=P(""),gr=P(!1),si=P("");function df(){try{const _=`${window.location.origin}/season/${s}`;navigator.clipboard.writeText(_),Fe.value=!0,vt.value="Lien copié dans le presse-papiers",setTimeout(()=>{Fe.value=!1},2500)}catch{gr.value=!0,si.value="Impossible de copier le lien",setTimeout(()=>{gr.value=!1},2500)}}async function ii(_){await w({type:"deleteEvent",data:{eventId:_}})}async function Qr(_=null){const m=_||h.value;if(console.debug("deleteEventConfirmed"),!m){console.error("Aucun événement à supprimer");return}try{await w3(m,o.value),Ge.value=Ge.value.filter(N=>N.id!==m),await Promise.all([oh(o.value),Io(st.value,Ge.value,o.value),Eo(o.value)]).then(([N,Z,oe])=>{Ge.value=N,Gt.value=Z,ze.value=oe}),c.value=!1,h.value=null,Fe.value=!0,vt.value="Événement supprimé avec succès !",setTimeout(()=>{Fe.value=!1},3e3)}catch{console.error("Erreur lors de la suppression de l'événement"),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function Mc(){c.value=!1,h.value=null}async function ua(){if(!f.value||!g.value.trim()||!y.value)return;const _=parseInt(I.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}try{const m={title:g.value.trim(),date:y.value,description:te.value.trim()||"",playerCount:_,archived:!!de.value};await w_(f.value,m,o.value),!m.archived&&st.value.length>0&&Ar.value.size>0&&(to.value={id:f.value,...m},fs.value=!0),await Promise.all([oh(o.value),Io(st.value,Ge.value,o.value),Eo(o.value)]).then(([N,Z,oe])=>{Ge.value=N,Gt.value=Z,ze.value=oe}),f.value=null,g.value="",y.value="",te.value="",I.value=6,de.value=!1,Fe.value=!0,vt.value="Événement mis à jour avec succès !",setTimeout(()=>{Fe.value=!1},3e3)}catch{console.error("Erreur lors de l'édition de l'événement"),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function Lc(){if(E.value.trim())try{const _=E.value.trim(),m=await yT(_,o.value);await Promise.all([Tu(o.value),Io(st.value,Ge.value,o.value),Eo(o.value)]).then(([N,Z,oe])=>{st.value=N,Gt.value=Z,ze.value=oe,Ol();const me=st.value.find(Me=>Me.id===m);Oc(m),F.value=m,M.value=ln.value&&ln.value[0]&&ln.value[0].id?ln.value[0].id:null;try{o.value&&localStorage.setItem(`lastAddedPlayerId:${o.value}`,m)}catch{}try{typeof qt<"u"&&(qt.value=2)}catch{}const he=document.querySelector(`[data-player-id="${m}"]`);he&&he.scrollIntoView({behavior:"smooth",block:"center"}),Ht(()=>{const Me=`[data-player-id="${F.value}"] td[data-event-id="${M.value}"]`,Xe=document.querySelector(Me);if(Xe){const it=Xe.getBoundingClientRect();re.value.position={x:Math.round(it.left),y:Math.round(it.top+window.scrollY-48)}}}),Fe.value=!0,vt.value="Joueur ajouté avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{Fe.value=!1},3e3),setTimeout(()=>{Fe.value=!1,vt.value=""},5e3)}),S.value=!1,E.value=""}catch{console.error("Erreur lors de l'ajout du joueur"),alert("Erreur lors de l'ajout du joueur. Veuillez réessayer.")}}function Sr(){f.value=null,g.value="",y.value="",te.value="",I.value=6}P(null);const ca=P(!1),oi=P(""),ai=P(""),or=P(""),oo=P(6),da=P(!1);async function ha(){if(!oi.value.trim()||!ai.value){alert("Veuillez remplir le titre et la date de l'événement");return}const _=parseInt(oo.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}const m={title:oi.value.trim(),date:ai.value,description:or.value.trim()||"",playerCount:_,archived:!!da.value};await fa(m)}async function fa(_){try{const m=await x3(_,o.value);Ge.value=[...Ge.value,{id:m,..._}];const N={};for(const Z of st.value)N[Z.name]=Gt.value[Z.name]||{},N[Z.name][m]=null,await b_(Z.name,N[Z.name],o.value);oi.value="",ai.value="",or.value="",oo.value=6,da.value=!1,ca.value=!1,await Promise.resolve(),Fe.value=!0,vt.value="Événement créé avec succès !",!_.archived&&st.value.length>0&&Ar.value.size>0&&(to.value={id:m,..._},fs.value=!0),setTimeout(()=>{Fe.value=!1},3e3)}catch{console.error("Erreur lors de la création de l'événement"),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function $c(){oi.value="",ai.value="",or.value="",oo.value=6,ca.value=!1}async function li(){await w({type:"addEvent",data:{}})}const Ge=P([]),st=P([]),Gt=P({}),ze=P({}),hf=P({}),Ml=P({});wt([()=>Ge.value.length,()=>st.value.length,Kr],()=>{Kr.value||Ht(()=>{Vl()})}),wt([()=>st.value.length,()=>Ge.value.length,o],()=>{ra()}),fn(async()=>{try{tv("firebase"),await vT();const m=Wu(et(le,"seasons"),Xd("slug","==",e.slug)),N=await Pt(m);if(N.empty){t.push("/seasons");return}else{const he=N.docs[0];o.value=he.id;const Me=he.data();i.value=Me.name,a.value=Me,document.title=`Saison : ${i.value}`,$O(e.slug)}if(o.value){Zs.value="Chargement des événements de la saison",Or.value=20;const he=await Pt(et(le,"seasons",o.value,"events"));Ge.value=he.docs.map(Et=>({id:Et.id,...Et.data(),playerCount:Et.data().playerCount||6})),Zs.value="Chargement des joueurs",Or.value=45;const Me=await Pt(et(le,"seasons",o.value,"players"));st.value=Me.docs.map(Et=>({id:Et.id,...Et.data()})),Zs.value="Chargement des disponibilités",Or.value=70;const Xe=await Pt(et(le,"seasons",o.value,"availability")),it={};Xe.docs.forEach(Et=>{const _r=Et.data(),Lr={};Object.keys(_r).forEach(go=>{const _a=_r[go];Lr[go]=_a==="oui"?!0:_a==="non"?!1:_a}),it[Et.id]=Lr}),Gt.value=it,Zs.value="Chargement des sélections",Or.value=85;const It=await Pt(et(le,"seasons",o.value,"selections")),Yt={};It.docs.forEach(Et=>{Yt[Et.id]=Et.data().players||[]}),ze.value=Yt;const un=await Wp(o.value),cn=new Set;Array.isArray(un)&&un.forEach(Et=>{Et.isProtected&&cn.add(Et.playerId||Et.id)}),Ar.value=cn}const Z=he=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>he()):setTimeout(he,0)};Zs.value="Préparation de l'interface",Or.value=95,Z(()=>{ql(),va()}),console.debug("players (deduplicated)"),console.debug("availability loaded"),await Ht(),Or.value=100,Kr.value=!1,Ht(()=>{mr(),requestAnimationFrame(()=>mr()),setTimeout(()=>mr(),250);const he=rr.value;he&&(he.addEventListener("scroll",Me=>{mr(),aa.value=he.scrollLeft||0},{passive:!0}),window.addEventListener("resize",mr),typeof ResizeObserver<"u"&&(ti.value=new ResizeObserver(()=>{mr()}),ti.value.observe(he)))});const oe=r.query.event;if(oe&&Ge.value.length>0){const he=Ge.value.find(Me=>Me.id===oe);he?(console.debug("Événement trouvé depuis l'URL"),await vf(oe,he)):(console.warn("Événement non trouvé avec l'ID"),gr.value=!0,si.value="Événement non trouvé",setTimeout(()=>{gr.value=!1},3e3))}const me=r.query.player;if(me&&st.value.length>0){const he=st.value.find(Me=>Me.id===me);he&&(pf(he),await Ht(),r.query.verified==="1"&&(Fe.value=!0,vt.value="Joueur associé à votre compte.",setTimeout(()=>{Fe.value=!1},2500)))}}catch(_){console.error("Erreur lors du chargement de la grille:",_),gr.value=!0,si.value="Erreur lors du chargement des données",setTimeout(()=>{gr.value=!1},5e3),Kr.value=!1}}),wt(()=>r.params.eventId,_=>{if(_){const m=()=>{const N=Ge.value.find(Z=>Z.id===_);return N?(rv(N),!0):!1};if(Ge.value.length>0)m();else{const N=wt(Ge,Z=>{Z.length>0&&m()&&N()},{immediate:!0})}}},{immediate:!0});function Ll(_){if(!_)return null;if(_ instanceof Date)return _;if(typeof(_==null?void 0:_.toDate)=="function")return _.toDate();if(typeof _=="string"||typeof _=="number"){const m=new Date(_);return isNaN(m.getTime())?null:m}return null}const _s=Ue(()=>{let _=null;try{o.value&&(_=localStorage.getItem(`seasonPreferredPlayer:${o.value}`))}catch{}const m=[...st.value].sort((he,Me)=>(he.name||"").localeCompare(Me.name||"","fr",{sensitivity:"base"}));if(!_)return m;let N=[];try{_.startsWith("[")?N=JSON.parse(_):_&&(N=[_])}catch{N=[]}const Z=new Set(N);if(Z.size===0)return m;const oe=m.filter(he=>Z.has(he.id)),me=m.filter(he=>!Z.has(he.id));return[...oe,...me]}),Jr=Ue(()=>{try{if(o.value){const _=localStorage.getItem(`seasonPreferredPlayer:${o.value}`);if(!_)return new Set;if(_.startsWith("[")){const m=JSON.parse(_);return new Set(Array.isArray(m)?m:[])}return new Set([_])}}catch{}return new Set}),pa=Ue(()=>[...Ge.value].sort((_,m)=>{const N=Ll(_.date),Z=Ll(m.date),oe=N?N.getTime():Number.POSITIVE_INFINITY,me=Z?Z.getTime():Number.POSITIVE_INFINITY;return oe!==me?oe-me:(_.title||"").localeCompare(m.title||"","fr",{sensitivity:"base"})})),bs=P(!1),ln=Ue(()=>{const _=pa.value;return bs.value?_:_.filter(m=>!m.archived)});function Fc(){bs.value=!bs.value}const $l=P("selected"),ao=Ue(()=>{var N;if(!G.value)return _s.value;const _=G.value.id,m=new Set(((N=ze.value)==null?void 0:N[_])||[]);return _s.value.filter(Z=>{var Me;const oe=Z.name,me=(Me=Gt.value[oe])==null?void 0:Me[_],he=m.has(oe);switch($l.value){case"selected":return he;case"available":return me===!0&&!he;case"unavailable":return me===!1;case"unknown":return me!==!0&&me!==!1;case"all":default:return!0}})}),Uc=Ue(()=>G.value?po(G.value.id):null),Fl=Ue(()=>{if(!G.value)return!1;const _=po(G.value.id);return _.type==="incomplete"||_.type==="insufficient"}),lo=Ue(()=>G.value?zl(G.value.id):"");async function uo(_,m){const N=st.value.find(me=>me.name===_);if(!N){console.error("Joueur non trouvé");return}const Z=Ge.value.find(me=>me.id===m);if(!Z){console.error("Événement non trouvé");return}if(Z.archived){Fe.value=!0,vt.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Fe.value=!1},3e3);return}if(Wr(N.id)){const me=Mo(N.id),he=nr.value===N.id;console.debug("Joueur protégé:",{playerId:N.id,hasCachedPassword:me,wasRecentlyVerified:he,recentlyVerifiedPlayer:nr.value}),me||he?(console.debug("Session active ou joueur récemment vérifié, procéder au toggle"),he&&(console.debug("Nettoyage du flag recentlyVerifiedPlayer"),nr.value=null),ui(N,m)):(console.debug("Pas de session, affichage de la modal de vérification"),Un.value={playerName:_,eventId:m},nn.value=N,jt.value=!0);return}ui(N,m)}function ui(_,m){var oe,me,he;const N=(oe=Gt.value[_.name])==null?void 0:oe[m];console.debug("toggleAvailability");let Z;N===!0?Z=!1:N===!1?Z=void 0:Z=!0,Z===void 0?Gt.value[_.name]&&delete Gt.value[_.name][m]:(Gt.value[_.name]||(Gt.value[_.name]={}),Gt.value[_.name][m]=Z);try{typeof qt<"u"&&qt.value===1&&_.id===(F.value||((me=_s.value[0])==null?void 0:me.id))&&m===(M.value||((he=ln.value[0])==null?void 0:he.id))&&(qt.value=3,Ht(()=>{const Xe=document.querySelector(`[data-player-id="${_.id}"]`);if(Xe){const it=Xe.querySelector(".player-name");if(it){const It=it.getBoundingClientRect();W.value.position={x:Math.round(It.right+8),y:Math.round(It.top+window.scrollY-4)}}}}),ki(()=>{try{window.removeEventListener("resize",mr)}catch{}try{ti.value&&ti.value.disconnect()}catch{}}))}catch{}b_(_.name,Gt.value[_.name],o.value).then(async()=>{await Ht(),va(),Fe.value=!0,vt.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{Fe.value=!1},3e3)}).catch(Me=>{console.error("Erreur lors de la mise à jour de la disponibilité"),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}function ar(_,m){var N;return(N=Gt.value[_])==null?void 0:N[m]}function jc(_,m){var oe;const N=ze.value[m]||[],Z=(oe=Gt.value[_])==null?void 0:oe[m];return N.includes(_)&&Z===!0}async function co(_,m=6){const N=Ge.value.find(he=>he.id===_),Z=(N==null?void 0:N.playerCount)||6,oe=ze.value[_]||[];if(oe.length>0&&oe.every(he=>ar(he,_))){console.debug("Tous les joueurs sélectionnés sont disponibles, nouveau tirage complet");const Me=st.value.filter(It=>ar(It.name,_)).map(It=>{const Yt=ws(It.name);return{name:It.name,weight:1/(1+Yt)}}),Xe=[],it=[...Me];for(;Xe.length<Z&&it.length>0;){const It=it.reduce((cn,Et)=>cn+Et.weight,0);let Yt=Math.random()*It;const un=it.findIndex(cn=>(Yt-=cn.weight,Yt<=0));un>=0&&(Xe.push(it[un].name),it.splice(un,1))}ze.value[_]=Xe}else{const he=oe.filter(Xe=>ar(Xe,_)),Me=Z-he.length;if(Me<=0)ze.value[_]=he;else{const Xe=new Set(he),It=st.value.filter(cn=>ar(cn.name,_)&&!Xe.has(cn.name)).map(cn=>{const Et=ws(cn.name);return{name:cn.name,weight:1/(1+Et)}}),Yt=[],un=[...It];for(;Yt.length<Me&&un.length>0;){const cn=un.reduce((Lr,go)=>Lr+go.weight,0);let Et=Math.random()*cn;const _r=un.findIndex(Lr=>(Et-=Lr.weight,Et<=0));_r>=0&&(Yt.push(un[_r].name),un.splice(_r,1))}ze.value[_]=[...he,...Yt]}}await Yp(_,ze.value[_],o.value),ql(),va()}async function Ul(_,m=6){var he,Me;console.debug("tirerProtected appelé"),console.debug("etat modal selection avant");const N=Jn.value,Z=(he=vn.value)==null?void 0:he.id,oe=ze.value[_]&&ze.value[_].length>0,me=oe?[...ze.value[_]]:[];if(await co(_,m),console.debug("etat modal selection apres"),N&&!Jn.value&&(console.debug("Restauration de la popin de sélection..."),Jn.value=!0,vn.value=Ge.value.find(Xe=>Xe.id===Z)),Jn.value&&((Me=vn.value)==null?void 0:Me.id)===_)if(console.debug("Popin de sélection ouverte, mise à jour..."),await Ht(),hs.value&&hs.value.showSuccess){console.debug("Appel de showSuccess sur la popin de sélection");const Xe=ze.value[_]||[],it=me.filter(Yt=>Xe.includes(Yt)),It=it.length>0&&it.length<me.length;hs.value.showSuccess(oe,It)}else console.debug("showSuccess indisponible");else console.debug("Popin de sélection fermée, affichage message global"),Fe.value=!0,Ge.value.find(Xe=>Xe.id===_),ze.value[_],oe?vt.value="Sélection mise à jour avec succès !":vt.value="Sélection effectuée avec succès !",setTimeout(()=>{Fe.value=!1},3e3)}function ma(_){_===0?L.value.position=null:_===1?re.value.position=null:_===2&&(W.value.position=null)}function jl(_){var N;return _?(typeof _=="string"?new Date(_):((N=_.toDate)==null?void 0:N.call(_))||_).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function ga(_){var N;return _?(typeof _=="string"?new Date(_):((N=_.toDate)==null?void 0:N.call(_))||_).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function ws(_){return Object.values(ze.value).filter(m=>m.includes(_)).length}function ci(_){const m=Gt.value[_]||{};return Object.values(m).filter(N=>N===!0).length}function ho(_){return _?Object.values(Gt.value).filter(m=>m[_]===!0).length:0}function fo(_){return _?(ze.value[_]||[]).length:0}function Yr(_){const m=Ge.value.find(Z=>Z.id===_),N=(m==null?void 0:m.playerCount)||6;return fo(_)>=N}function qc(_){const m=ci(_),N=ws(_);return m===0?0:N/m}function Bc(_){hf.value[_]={availability:ci(_),selection:ws(_),ratio:qc(_)}}function ql(){st.value.forEach(_=>Bc(_.name))}function va(){const _={};Ge.value.forEach(m=>{const N=m.playerCount||6,oe=st.value.filter(he=>ar(he.name,m.id)===!0).map(he=>{const Me=ws(he.name);return{name:he.name,weight:1/(1+Me)}}),me=oe.reduce((he,Me)=>he+Me.weight,0);oe.forEach(he=>{const Me=Math.min(1,he.weight/me*N);_[he.name]||(_[he.name]={}),_[he.name][m.id]=Math.round(Me*100)})}),Ml.value=_}const xs=P(null),En=P(!1);async function zc(_=null){const m=_||xs.value;if(!m){console.error("Aucun joueur à supprimer");return}try{await y3(m,o.value),st.value=st.value.filter(N=>N.id!==m),En.value=!1,xs.value=null,Fe.value=!0,vt.value="Joueur supprimé avec succès !",setTimeout(()=>{Fe.value=!1},3e3)}catch{console.error("Erreur lors de la suppression du joueur"),alert("Erreur lors de la suppression du joueur. Veuillez réessayer.")}}function Kc(){En.value=!1,xs.value=null}async function di(_){av(),await Vi(_,o.value)?await q({type:"deletePlayer",data:{playerId:_}}):await w({type:"deletePlayer",data:{playerId:_}})}async function u(){if(b.value){const _=Ge.value.find(N=>N.id===b.value),m=(_==null?void 0:_.playerCount)||6;await Ul(b.value,m),x.value=!1,b.value=null}}function p(){x.value=!1,b.value=null}function v(){return R.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis",toggleArchive:"Archivage d'événement - Code PIN requis",updateSelection:"Mise à jour de sélection - Code PIN requis"}[R.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function w(_){if(Vn.isPinCached(o.value)){const m=Vn.getCachedPin(o.value);if(console.debug("PIN en cache trouvé, utilisation automatique"),await rh(o.value,m)){await yr(_);return}else Vn.clearSession()}R.value=_,U.value=!0}async function q(_){const m=_.data.playerId;try{if(Vn.isPinCached(o.value)){console.debug("PIN de saison en cache — saut de la demande de mot de passe joueur"),await yr(_);return}}catch{}if(Mo(m)){console.debug("Mot de passe du joueur en cache trouvé, utilisation automatique"),await yr(_);return}be.value=_,gt.value=!0}async function Y(_){try{if(await rh(o.value,_)){Vn.saveSession(o.value,_),U.value=!1;const N=R.value;R.value=null,await yr(N)}else mt.value="Code PIN incorrect",setTimeout(()=>{mt.value=""},3e3)}catch{console.error("Erreur lors de la vérification du PIN"),mt.value="Erreur lors de la vérification du code PIN"}}function Se(){U.value=!1,R.value=null,mt.value=""}async function xt(_){if(_){ie.value=!0,ne.value="";try{const m=be.value.data.playerId,N=await Bp(o.value);if(_===N){try{Vn.saveSession(o.value,_)}catch{}try{Ki.saveSession(be.value.data.playerId)}catch{}gt.value=!1;const oe=be.value;be.value=null,ue.value="",await yr(oe);return}if(await verifyPlayerPassword(m,_,o.value)){gt.value=!1;const oe=be.value;be.value=null,ue.value="",await yr(oe)}else ne.value="Mot de passe incorrect",setTimeout(()=>{ne.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),ne.value="Erreur lors de la vérification du mot de passe"}finally{ie.value=!1}}}function wn(){gt.value=!1,be.value=null,ne.value="",ue.value="",ie.value=!1}async function yt(_){if(_){lt.value=!0,Te.value="";try{const m=J.value.data.player,N=await Bp(o.value);if(_===N){try{Vn.saveSession(o.value,_)}catch{}try{Ki.saveSession(J.value.data.player.id)}catch{}ee.value=!1;const oe=J.value;J.value=null,He.value="",await yr(oe);return}if(await verifyPlayerPassword(m.id,_,o.value)){ee.value=!1;const oe=J.value;J.value=null,He.value="",await yr(oe)}else Te.value="Mot de passe incorrect",setTimeout(()=>{Te.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),Te.value="Erreur lors de la vérification du mot de passe"}finally{lt.value=!1}}}function Tn(){ee.value=!1,J.value=null,Te.value="",He.value="",lt.value=!1}async function An(){Ae.value=!0,xe.value="",Ne.value="";try{const _=J.value.data.player,m=await sendPasswordResetEmail(_.id,o.value);Ne.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),xe.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{Ae.value=!1}}async function hi(){ct.value=!0,T.value="",k.value="";try{const _=be.value.data.playerId,m=await sendPasswordResetEmail(_,o.value);k.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),T.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{ct.value=!1}}function vr(){return Vn.isPinCached(o.value)?{timeRemaining:Vn.getTimeRemaining(),isExpiringSoon:Vn.isExpiringSoon()}:null}async function yr(_){var Z;if(!_)return;const{type:m,data:N}=_;try{switch(m){case"deleteEvent":console.debug("executePendingOperation - data.eventId reçu"),h.value=N.eventId,c.value=!0;break;case"addEvent":ca.value=!0;break;case"deletePlayer":xs.value=N.playerId,En.value=!0;break;case"launchSelection":ze.value[N.eventId]&&ze.value[N.eventId].length>0?(b.value=N.eventId,x.value=!0,K.value=!1):(await Ul(N.eventId,N.count),K.value=!1);break;case"toggleAvailability":ui(N.player,N.eventId);break;case"toggleArchive":await setEventArchived(N.eventId,N.archived,o.value);{const oe=Ge.value.findIndex(me=>me.id===N.eventId);oe!==-1&&(Ge.value[oe]={...Ge.value[oe],archived:!!N.archived}),de.value=!!N.archived}break;case"updateSelection":{const{eventId:oe,players:me}=N,he=[...ze.value[oe]||[]],Me=Array.isArray(me)?me:[];await Yp(oe,Me,o.value),ze.value[oe]=Me;try{const Xe=he.filter(it=>!Me.includes(it));if(Xe.length>0){const it=Ge.value.find(It=>It.id===oe);await xM({eventId:oe,eventData:it,removedPlayers:Xe,newSelectedPlayers:Me,seasonId:o.value,seasonSlug:s,players:Mr.value})}}catch{}try{(Z=hs.value)==null||Z.showSuccess(!0,!0)}catch{}}break}}catch{console.error("Erreur lors de l'exécution de l'opération"),Fe.value=!0,vt.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{Fe.value=!1},3e3)}}function Bl(){t.push("/seasons")}ki(()=>{const _=rr.value;_&&_.removeEventListener("scroll",mr),window.removeEventListener("resize",mr)});async function rv(_){G.value=_,te.value=_.description||"",de.value=!!_.archived;try{const[m,N]=await Promise.all([Io(st.value,Ge.value,o.value),Eo(o.value)]);Gt.value=m,ze.value=N}catch(m){console.warn("Impossible de rafraîchir les données avant ouverture des détails:",m)}K.value=!0}function ff(){K.value=!1,G.value=null,te.value="",ye.value=!1,ve.value=!1,rt(),Tr(),$e.value={position:"fixed",top:"0px",left:"0px"},Oe.value={position:"fixed",top:"0px",left:"0px"}}function ya(_,m=null){const N=m||G.value;if(N)try{_$(_,N,i.value),Fe.value=!0,_==="ics"?vt.value="Fichier .ics téléchargé ! Importez-le dans votre agenda":_==="google"?vt.value="Google Calendar ouvert dans un nouvel onglet":_==="outlook"&&(vt.value="Outlook ouvert dans un nouvel onglet"),setTimeout(()=>{Fe.value=!1},3e3)}catch(Z){console.error("Erreur lors de l'ajout au calendrier:",Z),Fe.value=!0,vt.value="Erreur lors de l'ajout au calendrier",setTimeout(()=>{Fe.value=!1},3e3)}}function sv(){ff(),r.params.eventId&&t.push(`/season/${e.slug}`)}async function xT(_,m){console.debug("handleAvailabilityToggle appelé");const N=st.value.find(me=>me.name===_);if(!N){console.error("Joueur non trouvé");return}const Z=Ge.value.find(me=>me.id===m);if(Z!=null&&Z.archived){Fe.value=!0,vt.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Fe.value=!1},3e3);return}console.debug("Joueur trouvé");const oe=Wr(N.id);if(console.debug("Joueur protégé"),oe){Mo(N.id)?(console.debug("Session active, procéder au toggle"),await uo(_,m)):(console.debug("Demande du mot de passe pour joueur protégé"),Un.value={playerName:_,eventId:m},nn.value=N,jt.value=!0);return}console.debug("Joueur non protégé, procéder au toggle"),await uo(_,m)}function IT(_,m){return(ze.value[m]||[]).includes(_)}async function ET(_){if(console.debug("Mot de passe vérifié"),nn.value&&(nr.value=nn.value.id,console.debug("Joueur marqué comme récemment vérifié")),Un.value){const{playerName:m,eventId:N}=Un.value;console.debug("Exécution de l'action en attente"),await uo(m,N),Un.value=null}else console.debug("Aucune action en attente trouvée");jt.value=!1,nn.value=null}function iv(){f.value=G.value.id,g.value=G.value.title,y.value=G.value.date,te.value=G.value.description||"",I.value=G.value.playerCount||6,K.value=!1}async function ov(){if(G.value)try{const _=!G.value.archived,m={...G.value,archived:_};await w_(G.value.id,m,o.value),G.value.archived=_;const N=Ge.value.findIndex(Z=>Z.id===G.value.id);N!==-1&&(Ge.value[N].archived=_),Fe.value=!0,vt.value=_?"Événement archivé avec succès !":"Événement désarchivé avec succès !",setTimeout(()=>{Fe.value=!1},3e3)}catch{console.error("Erreur lors de la modification de l'archivage"),alert("Erreur lors de la modification de l'archivage. Veuillez réessayer.")}}function pf(_){C.value=_,A.value=!0;try{typeof qt<"u"&&qt.value}catch{}}function av(){A.value=!1,C.value=null}async function TT({playerId:_,newName:m}){try{await _3(_,m,o.value),await Promise.all([Tu(o.value),Io(st.value,Ge.value,o.value),Eo(o.value)]).then(([N,Z,oe])=>{if(st.value=N,Gt.value=Z,ze.value=oe,Ol(),C.value&&C.value.id===_){const me=N.find(he=>he.id===_);me&&(C.value=me)}}),Fe.value=!0,vt.value="Joueur mis à jour avec succès !",setTimeout(()=>{Fe.value=!1},3e3)}catch{console.error("Erreur lors de l'édition du joueur"),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function AT(){try{await Promise.all([Tu(o.value),Io(st.value,Ge.value,o.value),Eo(o.value)]).then(([_,m,N])=>{if(st.value=_,Gt.value=m,ze.value=N,Ol(),C.value){const Z=_.find(oe=>oe.id===C.value.id);Z&&(C.value=Z)}}),Fe.value=!0,vt.value="Données mises à jour !",setTimeout(()=>{Fe.value=!1},3e3)}catch{console.error("Erreur lors du rafraîchissement")}}function ST(_){if(!_)return{availability:0,selection:0,ratio:0};const m=ci(_.name),N=ws(_.name),Z=m===0?0:Math.round(N/m*100);return{availability:m,selection:N,ratio:Z}}function po(_){const m=ze.value[_]||[],N=Ge.value.find(me=>me.id===_),Z=(N==null?void 0:N.playerCount)||6,oe=ho(_);if(m.length>0){const me=m.some(Me=>!ar(Me,_)),he=oe<Z;if(me||he)return{type:"incomplete",hasUnavailablePlayers:me,hasInsufficientPlayers:he,unavailablePlayers:m.filter(Me=>!ar(Me,_)),availableCount:oe,requiredCount:Z}}return oe<Z?{type:"insufficient",availableCount:oe,requiredCount:Z}:m.length===0?{type:"ready",availableCount:oe,requiredCount:Z}:{type:"complete",availableCount:oe,requiredCount:Z}}function zl(_){const m=po(_);switch(m.type){case"incomplete":return m.hasUnavailablePlayers?m.unavailablePlayers.length===1?`Sélection incomplète : ${m.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${m.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${m.availableCount} joueurs disponibles pour ${m.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${m.availableCount} disponibles pour ${m.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${m.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${m.availableCount} joueurs disponibles`;default:return""}}async function PT(){const _=[];for(const m of st.value){if(!await Vi(m.id,o.value))continue;const Z=await $E(m.id,o.value);Z&&_.push({...m,email:Z})}return _}function Gc(_){if(_!=null&&_.archived){Fe.value=!0,vt.value="Impossible d'annoncer un événement archivé",setTimeout(()=>{Fe.value=!1},3e3);return}lv(),eo.value=_,Nr.value=!0;try{const m=new URLSearchParams(window.location.search);m.set("modal","announce"),m.set("event",(_==null?void 0:_.id)||""),history.replaceState(null,"",`${window.location.pathname}?${m.toString()}`)}catch{}}function RT(){Nr.value=!1,eo.value=null;try{const _=new URLSearchParams(window.location.search);_.get("modal")==="announce"&&(_.delete("modal"),_.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${_.toString()}`))}catch{}}function lv(){fs.value=!1,to.value=null}const mf=P(!1);async function uv({eventId:_,eventData:m,reason:N,selectedPlayers:Z,scope:oe="all",recipient:me=null}){mf.value=!0;try{N==="selection"?(oe==="single"&&(me!=null&&me.email)?await I_({eventId:_,eventData:m,selectedPlayers:[me.name],seasonId:o.value,seasonSlug:s,players:Mr.value}):await I_({eventId:_,eventData:m,selectedPlayers:Z,seasonId:o.value,seasonSlug:s,players:Mr.value}),Fe.value=!0,vt.value=oe==="single"?`Notification envoyée à ${(me==null?void 0:me.name)||"1 joueur"}`:"Notifications de sélection envoyées à tous les joueurs sélectionnés !",setTimeout(()=>{Fe.value=!1},3e3)):(oe==="single"&&(me!=null&&me.email)?await x_({eventId:_,eventData:m,players:[me],seasonId:o.value,seasonSlug:s,createMagicLink:Kp,reminder:!1,getAvailabilityForEvent:(he,Me)=>ar(he,Me)}):await x_({eventId:_,eventData:m,players:await PT(),seasonId:o.value,seasonSlug:s,createMagicLink:Kp,reminder:!1,getAvailabilityForEvent:(he,Me)=>ar(he,Me)}),Fe.value=!0,vt.value=oe==="single"?`Notification envoyée à ${(me==null?void 0:me.name)||"1 joueur"}`:"Notifications envoyées à tous les joueurs protégés !",setTimeout(()=>{Fe.value=!1},3e3))}catch{console.error("Erreur lors de l'envoi des notifications"),Fe.value=!0,vt.value="Erreur lors de l'envoi des notifications",setTimeout(()=>{Fe.value=!1},3e3)}mf.value=!1}function gf(_){if(!_)return{};const m={};return st.value.forEach(N=>{m[N.name]=ar(N.name,_)}),m}function mo(_){if(_!=null&&_.archived){Fe.value=!0,vt.value="Impossible d'ouvrir la sélection sur un événement archivé",setTimeout(()=>{Fe.value=!1},3e3);return}vn.value=_,Jn.value=!0;try{const m=new URLSearchParams(window.location.search);m.set("modal","selection"),m.set("event",(_==null?void 0:_.id)||""),history.replaceState(null,"",`${window.location.pathname}?${m.toString()}`)}catch{}}function cv(){Jn.value=!1,vn.value=null;try{const _=new URLSearchParams(window.location.search);_.get("modal")==="selection"&&(_.delete("modal"),_.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${_.toString()}`))}catch{}}async function CT(){if(!vn.value)return;const _=vn.value.id,m=vn.value.playerCount||6;if(ho(_)===0){Fe.value=!0,vt.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{Fe.value=!1},3e3);return}await w({type:"launchSelection",data:{eventId:_,count:m}})}function kT(){cv(),Fe.value=!0,vt.value="Sélection validée !",setTimeout(()=>{Fe.value=!1},3e3)}async function DT(_){if(!_||!_.eventId)return;const{eventId:m,players:N}=_;await w({type:"updateSelection",data:{eventId:m,players:N}})}async function vf(_,m){if(!_||!m)return;hv(),pr.value=_,Dl.value=!0,await Ht();const N=document.querySelector(`[data-event-id="${_}"]`);if(!N){console.warn("Élément événement non trouvé dans le DOM");return}document.querySelectorAll(".focused-event-highlight").forEach(he=>{he.classList.remove("focused-event-highlight")});const Z=document.querySelectorAll(`[data-event-id="${_}"]`);Z.forEach(he=>{he.classList.add("focused-event-highlight")});const oe=Z[0],me=Z[Z.length-1];oe&&oe.classList.add("focused-event-column-start"),me&&me.classList.add("focused-event-column-end"),await NT(N),Fe.value=!0,vt.value=`Événement ciblé : ${m.title}`,setTimeout(()=>{Fe.value=!1},4e3),ei.value=setTimeout(()=>{hv()},8e3)}function dv(_){if(!_)return;const m=Ge.value.find(N=>N.id===_);if(!m){console.warn("Événement non trouvé dans la liste des événements"),setTimeout(()=>{const N=Ge.value.find(Z=>Z.id===_);N?vf(_,N):console.error("Événement toujours introuvable après retry")},500);return}vf(_,m)}wt(Ge,_=>{try{const m=new URLSearchParams(window.location.search),N=m.get("modal"),Z=m.get("event");if(!N||!Z)return;const oe=_.find(me=>me.id===Z);if(!oe)return;N==="announce"&&Gc(oe),N==="selection"&&mo(oe)}catch{}},{immediate:!0});async function NT(_){if(!_)return;if(await new Promise(N=>setTimeout(N,100)),window.innerWidth<=768){const N=rr.value;if(N){const Z=_.offsetLeft,oe=_.offsetWidth,me=N.clientWidth,he=Z-me/2+oe/2,Me=N.scrollWidth-me,Xe=Math.max(0,Math.min(he,Me));N.scrollTo({left:Xe,behavior:"smooth"}),setTimeout(()=>{const it=_.getBoundingClientRect();if(it.left<0||it.right>window.innerWidth){const It=Z-20;N.scrollTo({left:Math.max(0,It),behavior:"smooth"})}},500)}}else _.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const m=rr.value;m&&setTimeout(()=>{const N=document.querySelector(`[data-event-id="${pr.value}"]`);if(N&&N.closest("tbody")){const Z=N.offsetLeft,oe=N.offsetWidth,me=m.clientWidth,he=Z-me/2+oe/2,Me=m.scrollWidth-me,Xe=Math.max(0,Math.min(he,Me));m.scrollTo({left:Xe,behavior:"smooth"})}},300)}function hv(){ei.value&&(clearTimeout(ei.value),ei.value=null),pr.value=null,Dl.value=!1,document.querySelectorAll(".focused-event-highlight").forEach(_=>{_.classList.remove("focused-event-highlight")}),document.querySelectorAll(".focused-event-column-start, .focused-event-column-end").forEach(_=>{_.classList.remove("focused-event-column-start","focused-event-column-end")})}return(_,m)=>{var N,Z,oe,me,he,Me,Xe,it,It,Yt,un,cn,Et,_r,Lr,go,_a,fv,pv,mv,gv,vv,yv,_v;return D(),V(ot,null,[d("div",O5,[Qe(V5,{"season-name":i.value,"is-scrolled":l.value,onGoBack:Bl,onOpenAccountMenu:lf,onOpenHelp:m[0]||(m[0]=H=>ps.value=!0),onOpenNotifications:uf,onOpenPlayers:sa,onLogout:Vr,onOpenLogin:ia,onOpenAccount:ia},null,8,["season-name","is-scrolled"]),d("div",M5,[d("div",{ref_key:"headerBarRef",ref:Nc,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[d("div",L5,[Ge.value.length===0&&st.value.length===0?ce("",!0):(D(),V("div",$5,[d("div",{class:"flex items-center justify-center h-full gap-2"},[d("button",{onClick:li,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel événement"},m[74]||(m[74]=[d("span",{class:"text-lg"},"➕",-1),d("span",{class:"hidden sm:inline"},"Ajouter un événement",-1),d("span",{class:"sm:hidden"},"Événement",-1)]))])])),d("div",F5,[d("div",{ref_key:"headerEventsRef",ref:Nn,class:"flex relative z-[60]",style:br({transform:`translateX(-${aa.value}px)`})},[(D(!0),V(ot,null,wr(ln.value,H=>(D(),V("div",{key:"h-"+H.id,"data-event-id":H.id,class:Xt(["col-event flex-shrink-0 p-3 text-center flex flex-col justify-between",{"archived-header":H.archived}])},[d("div",{class:"flex flex-col items-center justify-between p-2 rounded-lg hover:bg-white/10 transition-colors duration-200 cursor-pointer group h-24",title:H.title+" - Cliquez pour voir les détails",onClick:dt(rn=>rv(H),["stop"])},[d("div",q5,[d("div",B5,se(H.title||"Sans titre"),1),H.archived?(D(),V("div",z5,"(Archivé)")):ce("",!0)]),d("div",K5,[d("div",{onClick:dt(rn=>bt(H.id),["stop"]),class:"header-date text-[16px] md:text-base text-gray-300 group-hover:text-purple-200 transition-colors duration-200 cursor-pointer hover:bg-white/10 px-2 py-1 rounded",title:ga(H.date)+" - Cliquez pour ajouter à votre agenda"},se(jl(H.date)),9,G5),z.value===H.id?(D(),V("div",H5,[d("div",W5,[d("button",{onClick:dt(rn=>{ya("google",H),rt()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},m[75]||(m[75]=[d("span",null,"🌐",-1),d("span",null,"Google Calendar",-1)]),8,Q5),d("button",{onClick:dt(rn=>{ya("outlook",H),rt()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},m[76]||(m[76]=[d("span",null,"📧",-1),d("span",null,"Outlook",-1)]),8,J5),d("button",{onClick:dt(rn=>{ya("ics",H),rt()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Télécharger un fichier .ics compatible avec tous les agendas"},m[77]||(m[77]=[d("span",null,"📥",-1),d("span",null,"Télécharger (.ics)",-1)]),8,Y5)])])):ce("",!0)])],8,j5),d("div",X5,[H.archived?(D(),V("div",Z5,m[78]||(m[78]=[d("span",{class:"text-xs text-gray-300 font-medium"},"📁",-1),d("span",{class:"text-xs text-gray-200 font-medium ml-1"},"Archivé",-1)]))):po(H.id).type==="ready"?(D(),V("div",{key:1,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-blue-500/30 transition-colors duration-200 cursor-pointer group",title:zl(H.id)+" - Cliquez pour ouvrir la sélection",onClick:dt(rn=>mo(H),["stop"])},m[79]||(m[79]=[d("span",{class:"text-xs text-blue-300 font-medium group-hover:text-blue-200"},"🆕",-1),d("span",{class:"text-xs text-blue-200 font-medium ml-1 group-hover:text-blue-100"},"Nouveau",-1)]),8,eU)):po(H.id).type==="complete"?(D(),V("div",{key:2,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-green-500/30 transition-colors duration-200 cursor-pointer group",title:zl(H.id)+" - Cliquez pour ouvrir la sélection",onClick:dt(rn=>mo(H),["stop"])},m[80]||(m[80]=[d("span",{class:"text-xs text-green-300 font-medium group-hover:text-green-200"},"✅",-1),d("span",{class:"text-xs text-green-200 font-medium ml-1 group-hover:text-green-100"},"Complet",-1)]),8,tU)):po(H.id).type==="incomplete"?(D(),V("div",{key:3,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-orange-500/30 transition-colors duration-200 cursor-pointer group",title:zl(H.id)+" - Cliquez pour ouvrir la sélection",onClick:dt(rn=>mo(H),["stop"])},m[81]||(m[81]=[d("span",{class:"text-xs text-orange-300 font-medium group-hover:text-orange-200"},"⚠️",-1),d("span",{class:"text-xs text-orange-200 font-medium ml-1 group-hover:text-orange-100"},"À finaliser",-1)]),8,nU)):po(H.id).type==="insufficient"?(D(),V("div",{key:4,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-red-500/30 transition-colors duration-200 cursor-pointer group",title:zl(H.id)+" - Cliquez pour ouvrir la sélection",onClick:dt(rn=>mo(H),["stop"])},m[82]||(m[82]=[d("span",{class:"text-xs text-red-300 font-medium group-hover:text-red-200"},"❌",-1),d("span",{class:"text-xs text-red-200 font-medium ml-1 group-hover:text-red-100"},"Manque",-1)]),8,rU)):ce("",!0)])],10,U5))),128))],4)]),m[85]||(m[85]=d("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),d("button",{onClick:Fc,class:"absolute right-2 top-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[86] backdrop-blur-sm",title:bs.value?"Masquer les événements archivés":"Afficher les événements archivés","aria-label":bs.value?"Masquer les événements archivés":"Afficher les événements archivés"},[(D(),V("svg",iU,[m[83]||(m[83]=d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.25 12c1.5-4 5.25-7.5 9.75-7.5S20.25 8 21.75 12c-1.5 4-5.25 7.5-9.75 7.5S3.75 16 2.25 12z"},null,-1)),m[84]||(m[84]=d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)),bs.value?ce("",!0):(D(),V("path",oU))]))],8,sU),at(d("button",{onClick:m[1]||(m[1]=dt(H=>Gr(-1,H),["prevent"])),onMousedown:m[2]||(m[2]=dt(H=>sr(-1,H),["prevent"])),onMouseup:m[3]||(m[3]=H=>ir(H)),onMouseleave:m[4]||(m[4]=H=>ir(H)),onTouchstart:m[5]||(m[5]=dt(H=>sr(-1,H),["prevent"])),onTouchend:m[6]||(m[6]=H=>ir(H)),onTouchcancel:m[7]||(m[7]=H=>ir(H)),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements précédents — cliquez pour défiler"}," ‹ ",544),[[Af,Dc.value]]),at(d("button",{onClick:m[8]||(m[8]=dt(H=>Gr(1,H),["prevent"])),onMousedown:m[9]||(m[9]=dt(H=>sr(1,H),["prevent"])),onMouseup:m[10]||(m[10]=H=>ir(H)),onMouseleave:m[11]||(m[11]=H=>ir(H)),onTouchstart:m[12]||(m[12]=dt(H=>sr(1,H),["prevent"])),onTouchend:m[13]||(m[13]=H=>ir(H)),onTouchcancel:m[14]||(m[14]=H=>ir(H)),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements suivants — cliquez pour défiler"}," › ",544),[[Af,Nl.value]])])],512),at(d("div",{ref_key:"gridboardRef",ref:rr,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[qt.value===1?(D(),V("div",aU,[L.value.position?(D(),V("div",{key:0,class:"fixed z-[400]",style:br({left:L.value.position.x+"px",top:L.value.position.y+"px"})},[d("div",{id:"coachmark-add",class:Xt(["coachmark pointer-events-auto max-w-sm bg-gray-900 border border-purple-500/40 rounded-xl shadow-2xl p-3 text-white relative",{"coachmark-right":L.value.side==="right","coachmark-left":L.value.side==="left"}])},[m[87]||(m[87]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ajoutez votre nom",-1)),m[88]||(m[88]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},'Cliquez sur "Ajouter un joueur" pour vous inscrire',-1)),d("div",lU,[m[86]||(m[86]=d("span",{class:"text-purple-300 text-base md:text-sm"},"Étape 1/4",-1)),d("button",{onClick:m[15]||(m[15]=H=>ma(0)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant >")])],2)],4)):ce("",!0)])):ce("",!0),qt.value===2&&F.value&&M.value?(D(),V("div",uU,[re.value.position?(D(),V("div",{key:0,class:"fixed z-[400]",style:br({position:"absolute",left:re.value.position.x+"px",top:re.value.position.y+"px"})},[d("div",cU,[m[90]||(m[90]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Indiquez vos disponibilités",-1)),m[91]||(m[91]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez cette case pour alterner Oui / Non / Vide",-1)),d("div",dU,[m[89]||(m[89]=d("span",{class:"text-pink-300 text-base md:text-sm"},"Étape 2/4",-1)),d("button",{onClick:m[16]||(m[16]=H=>ma(1)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ce("",!0)])):ce("",!0),qt.value===3&&F.value?(D(),V("div",hU,[W.value.position?(D(),V("div",{key:0,class:"fixed z-[400]",style:br({position:"absolute",left:W.value.position.x+"px",top:W.value.position.y+"px"})},[d("div",fU,[m[93]||(m[93]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ouvrez votre fiche",-1)),m[94]||(m[94]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez sur votre nom pour voir les détails et la protection",-1)),d("div",pU,[m[92]||(m[92]=d("span",{class:"text-yellow-300 text-base md:text-sm"},"Étape 3/4",-1)),d("button",{onClick:m[17]||(m[17]=H=>ma(2)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ce("",!0)])):ce("",!0),d("table",mU,[d("colgroup",null,[m[95]||(m[95]=d("col",{class:"col-left"},null,-1)),(D(!0),V(ot,null,wr(ln.value,(H,rn)=>(D(),V("col",{key:"c"+rn,class:"col-event"}))),128)),m[96]||(m[96]=d("col",{class:"col-right"},null,-1))]),m[100]||(m[100]=d("thead",{class:"hidden"},null,-1)),d("tbody",null,[(D(!0),V(ot,null,wr(_s.value,H=>{var rn;return D(),V("tr",{key:H.id,class:Xt(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":H.id===$.value,"preferred-player":Jr.value.has(H.id)}]),"data-player-id":H.id},[d("td",vU,[d("div",yU,[Jr.value.has(H.id)?(D(),V("span",_U," ⭐ ")):Wr(H.id)?(D(),V("span",bU," 🔒 ")):ce("",!0),d("div",{onClick:lr=>pf(H),class:Xt(["player-name hover:bg-white/10 rounded-lg p-2 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight block truncate max-w-full flex-1 min-w-0 group",{"inline-block rounded px-1 ring-2 ring-yellow-400 animate-pulse":qt.value===3&&H.id===(F.value||((rn=_s.value[0])==null?void 0:rn.id))}]),title:"Cliquez pour voir les détails : "+H.name},[d("span",xU,se(H.name),1)],10,wU)])]),(D(!0),V(ot,null,wr(ln.value,lr=>{var bv,wv,xv;return D(),V("td",{key:lr.id,"data-event-id":lr.id,class:Xt(["p-0",lr.archived?"archived-col":"",{"relative ring-2 ring-pink-400 rounded-md animate-pulse":qt.value===2&&H.id===(F.value||((bv=_s.value[0])==null?void 0:bv.id))&&lr.id===(M.value||((wv=ln.value[0])==null?void 0:wv.id))}])},[Qe(E_,{"player-name":H.name,"event-id":lr.id,"is-available":ar(H.name,lr.id),"is-selected":jc(H.name,lr.id),"chance-percent":((xv=Ml.value[H.name])==null?void 0:xv[lr.id])??null,"show-selected-chance":Yr(lr.id),disabled:lr.archived===!0,onToggle:uo},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])],10,IU)}),128)),m[97]||(m[97]=d("td",{class:"p-3 md:p-4"},null,-1))],10,gU)}),128)),d("tr",EU,[d("td",TU,[d("div",AU,[d("button",{onClick:m[18]||(m[18]=H=>S.value=!0),class:"w-full md:w-auto flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur","data-onboarding":"add-player"},m[98]||(m[98]=[d("span",{class:"text-lg"},"➕",-1),d("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),d("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(D(!0),V(ot,null,wr(ln.value,H=>(D(),V("td",{key:"add-row-"+H.id,"data-event-id":H.id,class:Xt(["p-3 md:p-5",H.archived?"archived-col":""])},null,10,SU))),128)),m[99]||(m[99]=d("td",{class:"p-3 md:p-4"},null,-1))])])])],512),[[Af,!Kr.value]])])]),Kr.value?(D(),V("div",PU,[d("div",RU,[m[101]||(m[101]=d("div",{class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"},[d("span",{class:"text-3xl"},"🎭")],-1)),d("p",CU,se(Zs.value)+"…",1),d("div",kU,[d("div",{class:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-300",style:br({width:Or.value+"%"})},null,4)]),d("p",DU,se(Or.value)+"%",1)])])):ce("",!0),Kr.value?ce("",!0):(D(),Ns(P5,{key:1,"season-id":o.value,"season-slug":ss(s),"players-count":st.value.length,"events-count":Ge.value.length,"onboarding-done":((N=a.value)==null?void 0:N.onboardingCreatorDone)===!0,onCreateEvent:li,onAddPlayer:m[19]||(m[19]=()=>{S.value=!0}),onCopyLink:df,onDismissed:kl},null,8,["season-id","season-slug","players-count","events-count","onboarding-done"])),ce("",!0),Fe.value?(D(),V("div",NU,[d("div",VU,[m[102]||(m[102]=d("span",{class:"text-xl"},"✨",-1)),d("span",null,se(vt.value),1)])])):ce("",!0),gr.value?(D(),V("div",OU,[d("div",MU,[m[103]||(m[103]=d("span",{class:"text-xl"},"⚠️",-1)),d("span",null,se(si.value),1)])])):ce("",!0),ca.value?(D(),V("div",LU,[d("div",$U,[m[109]||(m[109]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvel événement",-1)),d("div",FU,[m[104]||(m[104]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),at(d("input",{"onUpdate:modelValue":m[20]||(m[20]=H=>oi.value=H),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'événement"},null,512),[[Lt,oi.value]])]),d("div",UU,[m[105]||(m[105]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),at(d("input",{"onUpdate:modelValue":m[21]||(m[21]=H=>ai.value=H),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[Lt,ai.value]])]),d("div",jU,[m[106]||(m[106]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),at(d("textarea",{"onUpdate:modelValue":m[22]||(m[22]=H=>or.value=H),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)"},null,512),[[Lt,or.value]])]),d("div",qU,[at(d("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":m[23]||(m[23]=H=>da.value=H),class:"w-4 h-4"},null,512),[[Pi,da.value]]),m[107]||(m[107]=d("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Créer comme archivé",-1))]),d("div",BU,[m[108]||(m[108]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),at(d("input",{"onUpdate:modelValue":m[24]||(m[24]=H=>oo.value=H),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[Lt,oo.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:$c,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:ha,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):ce("",!0),S.value?(D(),V("div",zU,[d("div",KU,[m[111]||(m[111]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau joueur",-1)),d("div",GU,[m[110]||(m[110]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),at(d("input",{"onUpdate:modelValue":m[25]||(m[25]=H=>E.value=H),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[Lt,E.value]])]),d("div",HU,[d("button",{onClick:m[26]||(m[26]=H=>S.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:Lc,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):ce("",!0),c.value?(D(),V("div",WU,[d("div",QU,[m[112]||(m[112]=Rn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cet événement ?</p></div>',1)),d("div",JU,[d("button",{onClick:Mc,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:m[27]||(m[27]=()=>Qr()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ce("",!0),En.value?(D(),V("div",YU,[d("div",XU,[m[113]||(m[113]=Rn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce joueur ?</p></div>',1)),d("div",ZU,[d("button",{onClick:Kc,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{onClick:m[28]||(m[28]=()=>zc()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):ce("",!0),x.value?(D(),V("div",ej,[d("div",tj,[d("div",nj,[m[114]||(m[114]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🎭")],-1)),m[115]||(m[115]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),d("p",rj,[b.value&&ze.value[b.value]&&ze.value[b.value].every(H=>ar(H,b.value))?(D(),V("span",sj,"Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.")):(D(),V("span",ij,"La sélection sera mise à jour : les joueurs disponibles seront conservés, les slots vides seront complétés."))])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:p,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{onClick:u,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):ce("",!0),K.value?(D(),V("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:ff},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:m[42]||(m[42]=dt(()=>{},["stop"]))},[d("div",oj,[d("button",{onClick:ff,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",aj,[m[121]||(m[121]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),d("div",lj,[d("div",uj,[d("h2",cj,se((Z=G.value)==null?void 0:Z.title),1),d("div",dj,[m[116]||(m[116]=d("span",{class:"text-blue-300"},"👥",-1)),d("span",hj,se(((oe=G.value)==null?void 0:oe.playerCount)||6)+" joueurs",1)])]),d("div",fj,[d("p",pj,se(ga((me=G.value)==null?void 0:me.date)),1),d("div",mj,[d("button",{onClick:m[29]||(m[29]=H=>Er()),class:"px-3 py-1.5 hover:bg-white/20 rounded text-purple-300 hover:text-green-400 transition-colors duration-200 text-sm flex items-center gap-2 border border-purple-500/30",title:"Ajouter à votre agenda"},m[117]||(m[117]=[d("span",null,"📅",-1),d("span",null,"Agenda",-1)])),j.value?(D(),V("div",gj,[d("div",vj,[d("button",{onClick:m[30]||(m[30]=H=>{ya("google"),Tr()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},m[118]||(m[118]=[d("span",null,"🌐",-1),d("span",null,"Google Calendar",-1)])),d("button",{onClick:m[31]||(m[31]=H=>{ya("outlook"),Tr()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},m[119]||(m[119]=[d("span",null,"📧",-1),d("span",null,"Outlook",-1)])),d("button",{onClick:m[32]||(m[32]=H=>{ya("ics"),Tr()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Télécharger un fichier .ics compatible avec tous les agendas"},m[120]||(m[120]=[d("span",null,"📥",-1),d("span",null,"Télécharger (.ics)",-1)]))])])):ce("",!0)])]),(he=G.value)!=null&&he.description?(D(),V("div",yj,se(G.value.description),1)):ce("",!0)])])]),d("div",_j,[d("div",bj,[d("div",wj,[d("div",xj,se(ho((Me=G.value)==null?void 0:Me.id)),1),m[122]||(m[122]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),d("div",Ij,[d("div",Ej,se(fo((Xe=G.value)==null?void 0:Xe.id)),1),m[123]||(m[123]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),d("div",Tj,[d("div",Aj,se(Math.max((((it=G.value)==null?void 0:it.playerCount)||6)-fo((It=G.value)==null?void 0:It.id),0)),1),m[124]||(m[124]=d("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))])]),G.value?(D(),V("div",Sj,[d("div",Pj,[Fl.value?(D(),V("div",{key:0,class:Xt(["flex items-center gap-2 px-2 py-1 rounded-md border text-[11px] md:text-xs max-w-[70%] truncate",((Yt=Uc.value)==null?void 0:Yt.type)==="incomplete"?"bg-yellow-500/10 border-yellow-500/30 text-yellow-200":"bg-orange-500/10 border-orange-500/30 text-orange-200"]),title:lo.value},[m[125]||(m[125]=d("span",null,"⚠️",-1)),d("span",Cj,se(lo.value),1)],10,Rj)):ce("",!0),at(d("select",{"onUpdate:modelValue":m[33]||(m[33]=H=>$l.value=H),class:"ml-auto bg-gray-800 text-white rounded-md px-3 py-2 border border-white/10 focus:outline-none text-sm",title:"Filtrer les joueurs par statut"},m[126]||(m[126]=[Rn('<option value="selected">Sélectionnés</option><option value="available">Disponibles</option><option value="unavailable">Non Disponibles</option><option value="unknown">Pas de réponse</option><option value="all">Tous</option>',5)]),512),[[H1,$l.value]])]),d("div",kj,[(D(!0),V(ot,null,wr(ao.value,H=>{var rn,lr;return D(),V("div",{key:H.id,class:"flex items-center justify-between px-2 py-1.5 rounded-md hover:bg-gray-800/40 transition-colors"},[d("div",Dj,[Jr.value.has(H.id)?(D(),V("span",Nj," ⭐ ")):Wr(H.id)?(D(),V("span",Vj," 🔒 ")):ce("",!0),d("span",{class:"text-white text-sm md:text-base block truncate max-w-full flex-1 min-w-0",title:H.name},se(H.name),9,Oj)]),d("div",Mj,[Qe(E_,{"player-name":H.name,"event-id":G.value.id,"is-available":gf(G.value.id)[H.name],"is-selected":IT(H.name,G.value.id),"chance-percent":((rn=Ml.value[H.name])==null?void 0:rn[G.value.id])??null,"show-selected-chance":Yr(G.value.id),disabled:((lr=G.value)==null?void 0:lr.archived)===!0,compact:!0,onToggle:xT},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])])])}),128))])])):ce("",!0),d("div",Lj,[d("button",{onClick:m[34]||(m[34]=H=>mo(G.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},m[127]||(m[127]=[d("span",null,"🎭",-1),d("span",null,"Sélectionner",-1)])),d("button",{onClick:m[35]||(m[35]=H=>Gc(G.value)),disabled:(un=G.value)==null?void 0:un.archived,class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(cn=G.value)!=null&&cn.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[128]||(m[128]=[d("span",null,"📢",-1),d("span",null,"Annoncer",-1)]),8,$j),d("div",{class:"relative",ref_key:"eventMoreActionsRef",ref:Ie},[d("button",{onClick:m[36]||(m[36]=H=>We()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},m[129]||(m[129]=[d("span",null,"⋯",-1),d("span",null,"Plus",-1)]))],512),d("button",{onClick:sv,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),(D(),Ns(Ru,{to:"body"},[ve.value?(D(),V("div",{key:0,ref_key:"eventMoreActionsDropdownRef",ref:ge,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:br($e.value)},[d("button",{onClick:m[37]||(m[37]=H=>{iv(),ve.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},m[130]||(m[130]=[d("span",null,"✏️",-1),d("span",null,"Modifier",-1)])),d("button",{onClick:m[38]||(m[38]=H=>{ov(),ve.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10",title:(Et=G.value)!=null&&Et.archived?"Désarchiver cet événement":"Archiver cet événement"},[d("span",null,se((_r=G.value)!=null&&_r.archived?"📂":"📁"),1),d("span",null,se((Lr=G.value)!=null&&Lr.archived?"Désarchiver":"Archiver"),1)],8,Fj),d("button",{onClick:m[39]||(m[39]=H=>{var rn;ii((rn=G.value)==null?void 0:rn.id),ve.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[131]||(m[131]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ce("",!0)]))])]),d("div",Uj,[d("button",{onClick:m[40]||(m[40]=H=>mo(G.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélectionner"),d("button",{onClick:sv,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),d("button",{onClick:m[41]||(m[41]=H=>Ye()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):ce("",!0),(D(),Ns(Ru,{to:"body"},[ye.value?(D(),V("div",{key:0,ref_key:"eventMoreActionsMobileDropdownRef",ref:Pe,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:br(Oe.value)},[d("button",{onClick:m[43]||(m[43]=H=>{Gc(G.value),ye.value=!1}),disabled:(go=G.value)==null?void 0:go.archived,class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10 disabled:opacity-50 disabled:cursor-not-allowed",title:(_a=G.value)!=null&&_a.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[132]||(m[132]=[d("span",null,"📢",-1),d("span",null,"Annoncer",-1)]),8,jj),d("button",{onClick:m[44]||(m[44]=H=>{iv(),ye.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},m[133]||(m[133]=[d("span",null,"✏️",-1),d("span",null,"Modifier",-1)])),d("button",{onClick:m[45]||(m[45]=H=>{ov(),ye.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},[d("span",null,se((fv=G.value)!=null&&fv.archived?"📂":"📁"),1),d("span",null,se((pv=G.value)!=null&&pv.archived?"Désarchiver":"Archiver"),1)]),d("button",{onClick:m[46]||(m[46]=H=>{var rn;ii((rn=G.value)==null?void 0:rn.id),ye.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[134]||(m[134]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ce("",!0)])),Qe(nv,{show:jt.value,player:nn.value,seasonId:o.value,onClose:m[47]||(m[47]=H=>jt.value=!1),onVerified:ET},null,8,["show","player","seasonId"]),f.value?(D(),V("div",qj,[d("div",Bj,[m[140]||(m[140]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier l'événement",-1)),d("div",zj,[m[135]||(m[135]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),at(d("input",{"onUpdate:modelValue":m[48]||(m[48]=H=>g.value=H),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[qn(Sr,["esc"]),qn(ua,["enter"])],ref:"editTitleInput"},null,544),[[Lt,g.value]])]),d("div",Kj,[m[136]||(m[136]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),at(d("input",{"onUpdate:modelValue":m[49]||(m[49]=H=>y.value=H),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[qn(Sr,["esc"]),qn(ua,["enter"])]},null,544),[[Lt,y.value]])]),d("div",Gj,[m[137]||(m[137]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),at(d("textarea",{"onUpdate:modelValue":m[50]||(m[50]=H=>te.value=H),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)",onKeydown:qn(Sr,["esc"])},null,544),[[Lt,te.value]])]),d("div",Hj,[at(d("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":m[51]||(m[51]=H=>de.value=H),class:"w-4 h-4"},null,512),[[Pi,de.value]]),m[138]||(m[138]=d("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver cet événement",-1))]),d("div",Wj,[m[139]||(m[139]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),at(d("input",{"onUpdate:modelValue":m[52]||(m[52]=H=>I.value=H),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:qn(Sr,["esc"])},null,544),[[Lt,I.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:Sr,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:ua,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ce("",!0),Qe(IE,{show:U.value,message:v(),error:mt.value,"session-info":vr(),onSubmit:Y,onCancel:Se},null,8,["show","message","error","session-info"]),gt.value?(D(),V("div",Qj,[d("div",Jj,[m[142]||(m[142]=Rn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protégé par mot de passe</p></div>',1)),d("div",Yj,[d("div",Xj,[d("div",null,[m[141]||(m[141]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),at(d("input",{"onUpdate:modelValue":m[53]||(m[53]=H=>ue.value=H),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[54]||(m[54]=qn(H=>xt(ue.value),["enter"])),ref_key:"playerPasswordInputRef",ref:De},null,544),[[Lt,ue.value]])])]),d("button",{onClick:m[55]||(m[55]=H=>xt(ue.value)),disabled:!ue.value||ie.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[ie.value?(D(),V("span",eq,"⏳")):(D(),V("span",tq,"🔓")),d("span",null,se(ie.value?"Vérification...":"Vérifier et supprimer"),1)],8,Zj)]),d("div",nq,[d("button",{onClick:m[56]||(m[56]=H=>tt.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),ne.value?(D(),V("div",rq,[d("div",sq,se(ne.value),1)])):ce("",!0),d("div",{class:"flex justify-center"},[d("button",{onClick:wn,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ce("",!0),ee.value?(D(),V("div",iq,[d("div",oq,[m[145]||(m[145]=Rn('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protégé par mot de passe</p></div>',1)),d("div",aq,[d("div",lq,[d("div",null,[m[143]||(m[143]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),at(d("input",{"onUpdate:modelValue":m[57]||(m[57]=H=>He.value=H),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[58]||(m[58]=qn(H=>yt(He.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:Ot},null,544),[[Lt,He.value]])])]),d("div",uq,[d("button",{onClick:m[59]||(m[59]=H=>X.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),Te.value?(D(),V("div",cq,[d("div",dq,se(Te.value),1)])):ce("",!0)]),d("div",hq,[d("button",{onClick:Tn,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),d("button",{onClick:m[60]||(m[60]=H=>yt(He.value)),disabled:!He.value||lt.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[lt.value?(D(),V("span",pq,"⏳")):(D(),V("span",mq,"🔓")),d("span",null,[Ct(se(lt.value?"Vérification...":"Vérifier"),1),m[144]||(m[144]=d("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,fq)])])])):ce("",!0),X.value?(D(),V("div",{key:14,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[63]||(m[63]=H=>X.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[62]||(m[62]=dt(()=>{},["stop"]))},[m[147]||(m[147]=Rn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),d("div",gq,[m[146]||(m[146]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),d("button",{onClick:An,disabled:Ae.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[Ae.value?(D(),V("span",yq,"⏳")):(D(),V("span",_q,"📧")),d("span",null,se(Ae.value?"Envoi...":"Envoyer l'email"),1)],8,vq)]),xe.value?(D(),V("div",bq,[d("div",wq,se(xe.value),1)])):ce("",!0),Ne.value?(D(),V("div",xq,[d("div",Iq,se(Ne.value),1)])):ce("",!0),d("div",Eq,[d("button",{onClick:m[61]||(m[61]=H=>X.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0),tt.value?(D(),V("div",{key:15,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[66]||(m[66]=H=>tt.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[65]||(m[65]=dt(()=>{},["stop"]))},[m[149]||(m[149]=Rn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p></div>',1)),d("div",Tq,[m[148]||(m[148]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),d("button",{onClick:hi,disabled:ct.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[ct.value?(D(),V("span",Sq,"⏳")):(D(),V("span",Pq,"📧")),d("span",null,se(ct.value?"Envoi...":"Envoyer l'email"),1)],8,Aq)]),T.value?(D(),V("div",Rq,[d("div",Cq,se(T.value),1)])):ce("",!0),k.value?(D(),V("div",kq,[d("div",Dq,se(k.value),1)])):ce("",!0),d("div",Nq,[d("button",{onClick:m[64]||(m[64]=H=>tt.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0),Qe(E6,{ref_key:"playerModalRef",ref:O,show:A.value,player:C.value,stats:ST(C.value),seasonId:o.value,"onboarding-step":qt.value,"onboarding-player-id":F.value,"is-protected":C.value?Ar.value.has(C.value.id):!1,"is-preferred":C.value?Jr.value.has(C.value.id):!1,onClose:av,onUpdate:TT,onDelete:di,onRefresh:AT,onAdvanceOnboarding:m[67]||(m[67]=H=>{try{typeof qt.value<"u"&&(qt.value.value=H)}catch{}})},null,8,["show","player","stats","seasonId","onboarding-step","onboarding-player-id","is-protected","is-preferred"]),Qe(m5,{ref_key:"selectionModalRef",ref:hs,show:Jn.value,event:vn.value,"current-selection":ze.value[(mv=vn.value)==null?void 0:mv.id]||[],"available-count":ho((gv=vn.value)==null?void 0:gv.id),"selected-count":fo((vv=vn.value)==null?void 0:vv.id),"player-availability":gf((yv=vn.value)==null?void 0:yv.id),"season-id":o.value,"season-slug":ss(s),players:Mr.value,onClose:cv,onSelection:CT,onPerfect:kT,onSendNotifications:uv,onUpdateSelection:DT},null,8,["show","event","current-selection","available-count","selected-count","player-availability","season-id","season-slug","players"]),Qe(_T,{show:Nr.value,event:eo.value,"season-id":o.value,"season-slug":ss(s),players:Mr.value,sending:mf.value,"availability-by-player":gf((_v=eo.value)==null?void 0:_v.id),onClose:RT,onSendNotifications:uv},null,8,["show","event","season-id","season-slug","players","sending","availability-by-player"]),Qe(rF,{show:ps.value,onClose:m[68]||(m[68]=H=>ps.value=!1)},null,8,["show"]),Qe(qE,{show:ms.value,"season-id":o.value,onClose:zr,onManagePlayer:Cl,onChangePassword:oa,onLogoutDevice:Vr,onDeleteAccount:kc},null,8,["show","season-id"]),Qe(mT,{show:gs.value,onClose:cf},null,8,["show"]),Qe(gT,{show:vs.value,onClose:Cc,onManagePlayer:Cl},null,8,["show"]),Qe(bT,{show:bn.value,player:Rc.value,"season-id":o.value,onClose:m[69]||(m[69]=H=>bn.value=!1),onSuccess:m[70]||(m[70]=()=>{bn.value=!1,ms.value=!0})},null,8,["show","player","season-id"]),Qe(TE,{show:no.value,onClose:m[71]||(m[71]=H=>no.value=!1),onSuccess:m[72]||(m[72]=()=>{no.value=!1,ms.value=!0})},null,8,["show"]),fs.value?(D(),V("div",Vq,[d("div",Oq,[m[150]||(m[150]=d("h3",{class:"text-xl font-bold text-white mb-4 text-center"},"Voulez-vous annoncer cet événement ?",-1)),m[151]||(m[151]=d("p",{class:"text-gray-300 text-center mb-6"},"Envoyer des notifications aux joueurs pour qu'ils indiquent leur disponibilité",-1)),d("div",Mq,[d("button",{onClick:m[73]||(m[73]=H=>Gc(to.value)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300"}," 📢 Oui "),d("button",{onClick:lv,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300"}," Plus tard ")])])])):ce("",!0)],64)}}},Lq={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},$q={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},Fq={key:0,class:"text-center py-8"},Uq={key:1,class:"text-center py-8"},jq={class:"text-gray-300 mb-6"},qq={key:2,class:"space-y-6"},Bq={class:"text-center"},zq={class:"text-gray-300"},Kq={class:"font-semibold text-white"},Gq={class:"space-y-4"},Hq=["disabled"],Wq={key:0,class:"animate-spin"},Qq={key:1},Jq={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Yq={class:"text-red-300 text-sm"},Xq={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},Zq={class:"text-green-300 text-sm"},eB={__name:"PasswordReset",setup(n){const e=Qo(),t=dl(),r=P(!0),s=P(""),i=P(""),o=P(""),a=P(""),l=P(""),c=P(!1),h=P(""),f=P(""),g=Ue(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);fn(async()=>{try{const{oobCode:S}=e.query;if(ae.debug("Token reçu (masqué)"),!S){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=S,i.value="patrice.lamarque+ron@gmail.com",r.value=!1}catch(S){ae.error("Erreur lors de la vérification du lien",S),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function y(){if(g.value){c.value=!0,h.value="",f.value="";try{ae.debug("Début réinitialisation avec token (masqué)"),await NN(Be,o.value,a.value),ae.info("Mot de passe Firebase Auth mis à jour"),ae.info("Réinitialisation terminée avec Firebase Auth"),f.value="Mot de passe réinitialisé avec succès ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{I()},3e3)}catch(S){ae.error("Erreur lors de la réinitialisation",S),S.code==="auth/weak-password"?h.value="Le mot de passe doit contenir au moins 6 caractères":S.code==="auth/invalid-action-code"?h.value="Lien de réinitialisation invalide ou expiré":h.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{c.value=!1}}}function I(){t.push("/seasons")}return(S,E)=>(D(),V("div",Lq,[d("div",$q,[E[8]||(E[8]=Rn('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(D(),V("div",Fq,E[2]||(E[2]=[d("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),d("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(D(),V("div",Uq,[E[3]||(E[3]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"❌")],-1)),E[4]||(E[4]=d("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),d("p",jq,se(s.value),1),d("button",{onClick:I,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):i.value?(D(),V("div",qq,[d("div",Bq,[d("p",zq,[E[5]||(E[5]=Ct("Email : ")),d("span",Kq,se(i.value),1)])]),d("div",Gq,[d("div",null,[E[6]||(E[6]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),at(d("input",{"onUpdate:modelValue":E[0]||(E[0]=$=>a.value=$),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:qn(y,["enter"])},null,544),[[Lt,a.value]])]),d("div",null,[E[7]||(E[7]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),at(d("input",{"onUpdate:modelValue":E[1]||(E[1]=$=>l.value=$),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:qn(y,["enter"])},null,544),[[Lt,l.value]])])]),d("button",{onClick:y,disabled:!g.value||c.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[c.value?(D(),V("span",Wq,"⏳")):(D(),V("span",Qq,"🔑")),d("span",null,se(c.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,Hq),h.value?(D(),V("div",Jq,[d("div",Yq,se(h.value),1)])):ce("",!0),f.value?(D(),V("div",Xq,[d("div",Zq,se(f.value),1)])):ce("",!0)])):ce("",!0)])]))}},tB={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},nB={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},rB={class:"text-3xl"},sB={class:"text-2xl font-bold text-white mb-2"},iB={class:"text-gray-300 mb-6"},oB={__name:"MagicLink",setup(n){const e=Qo(),t=dl(),r=P("loading"),s=P("Traitement en cours..."),i=P("Merci de patienter pendant la validation du lien."),o=Ue(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/seasons")}return fn(async()=>{var l;try{tv("firebase");const c=String(e.query.sid||""),h=String(e.query.pid||"");let f=String(e.query.eid||"");const g=String(e.query.t||""),y=String(e.query.a||""),I=String(e.query.slug||"");if(!g||!y){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants.";return}if(y==="account_email_update"){const L=await RE({token:g});if(!L.valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}try{await FN(Be.currentUser,L.data.newEmail),await CE({token:g}),r.value="ok",s.value="Email mis à jour",i.value="Votre adresse email a été mise à jour avec succès."}catch{r.value="error",s.value="Action impossible",i.value="Veuillez vous reconnecter puis réessayer."}return}if(y==="verify_email"&&(f="protection"),!(await SE({seasonId:c,playerId:h,eventId:f,token:g,action:y})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}if(y==="verify_email"){await OE({playerId:h,seasonId:c});try{await UE({playerId:h,seasonId:c})}catch{}await Gp({seasonId:c,playerId:h,eventId:"protection",action:y}),r.value="ok",s.value="Email vérifié",i.value="Merci ! Vous pouvez maintenant définir votre mot de passe.",setTimeout(I?()=>t.push(`/season/${I}?player=${encodeURIComponent(h)}&verified=1`):()=>t.push("/seasons"),800);return}const E=Re(le,"seasons",c,"players",h),$=await Ut(E),F=$.exists()&&$.data().name||"";if(!F){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}if(await b3({seasonId:c,playerName:F,eventId:f,value:y==="yes"}),y==="no")try{const L=Re(le,"seasons",c,"selections",f),re=await Ut(L);if(re.exists()){const W=Array.isArray((l=re.data())==null?void 0:l.players)?re.data().players:[],x=W.filter(b=>b!==F);x.length!==W.length&&await setDoc(L,{players:x},{merge:!0})}}catch{}await Gp({seasonId:c,playerId:h,eventId:f,action:y}),r.value="ok",s.value="Merci !",i.value=y==="yes"?"Votre disponibilité a été enregistrée: Disponible.":"Votre disponibilité a été enregistrée: Non disponible. (Si vous étiez sélectionné(e), vous avez été retiré(e) de la sélection.)",setTimeout(I?()=>t.push(`/season/${I}/event/${f}`):()=>t.push("/seasons"),1200)}catch(c){ae.error("Magic link error",c),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,c)=>(D(),V("div",tB,[d("div",nB,[d("div",{class:Xt(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[d("span",rB,se(o.value),1)],2),d("h1",sB,se(s.value),1),d("p",iB,se(i.value),1),d("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},aB={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},lB={class:"text-center py-12 px-4"},uB={class:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},cB={class:"container mx-auto px-4 pb-16"},dB={class:"max-w-xl mx-auto bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl"},hB={class:"space-y-5"},fB=["onKeydown"],pB={class:"flex items-center justify-end gap-3 pt-2"},mB=["disabled"],gB={key:0,class:"mt-6 text-sm text-gray-200"},vB={__name:"JoinSeason",setup(n){const e=Qo(),t=dl(),r=e.params.slug,s=P(""),i=P(""),o=P(""),a=P(!1),l=P("");fn(async()=>{const f=Wu(et(le,"seasons"),Xd("slug","==",r)),g=await Pt(f);if(g.empty)l.value="Saison introuvable";else{const y=g.docs[0];s.value=y.id,i.value=y.data().name,document.title=`Rejoindre : ${i.value}`}});function c(){t.push(`/season/${r}`)}async function h(){if(!(!o.value.trim()||!s.value)){a.value=!0,l.value="";try{await yT(o.value.trim(),s.value),l.value="Inscription réussie. Vous pouvez maintenant indiquer vos disponibilités.";try{localStorage.setItem(`startPlayerTour:${s.value}`,"1"),localStorage.setItem(`dismissCreatorOnboarding:${s.value}`,"1")}catch{}setTimeout(()=>{c()},600)}catch(f){ae.error("Erreur inscription",f),l.value=`Erreur lors de l'inscription: ${(f==null?void 0:f.message)||"Veuillez réessayer"}`}finally{a.value=!1}}}return(f,g)=>(D(),V("div",aB,[d("div",lB,[d("h1",uB,se(i.value||"Rejoindre la saison"),1),g[1]||(g[1]=d("p",{class:"text-gray-300"},"Inscrivez-vous pour indiquer vos disponibilités aux événements",-1))]),d("div",cB,[d("div",dB,[g[3]||(g[3]=d("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Je rejoins la saison",-1)),d("div",hB,[d("div",null,[g[2]||(g[2]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Votre nom",-1)),at(d("input",{"onUpdate:modelValue":g[0]||(g[0]=y=>o.value=y),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: Marie Dupont",onKeydown:qn(dt(h,["prevent"]),["enter"])},null,40,fB),[[Lt,o.value]])]),d("div",pB,[d("button",{onClick:c,class:"px-5 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{disabled:!o.value.trim()||a.value,onClick:h,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Rejoindre ",8,mB)])]),l.value?(D(),V("div",gB,se(l.value),1)):ce("",!0)])])]))}};{const n=()=>{};console.debug=n,console.log=n,console.info=n}const yB=[{path:"/",component:zO},{path:"/seasons",component:u$},{path:"/season/:slug",component:T_,props:!0},{path:"/season/:slug/event/:eventId",component:T_,props:!0},{path:"/season/:slug/join",component:vB,props:!0},{path:"/reset-password",component:eB},{path:"/magic",component:oB}],_B=iP({history:VS("/"),routes:yB}),wT=Z1(rS);wT.use(_B);wT.mount("#app");uP({immediate:!0,onRegistered(n){window.__swReg=n}});export{et as $,II as A,Ko as B,as as C,mn as D,I9 as E,Yo as F,cg as G,x9 as H,EB as I,kr as J,J2 as K,X2 as L,Tl as M,JB as N,YB as O,ID as P,Fn as Q,jB as R,RB as S,en as T,p9 as U,Lh as V,bD as W,xD as X,QB as Y,DB as Z,fw as _,Ku as a,Ec as a$,SB as a0,Y2 as a1,uD as a2,w9 as a3,ul as a4,f9 as a5,OB as a6,b9 as a7,Re as a8,FB as a9,$B as aA,r9 as aB,s9 as aC,UB as aD,aD as aE,u9 as aF,c9 as aG,yD as aH,Wu as aI,uI as aJ,PB as aK,h9 as aL,Zi as aM,sn as aN,v9 as aO,bB as aP,XB as aQ,KB as aR,zB as aS,WB as aT,MB as aU,El as aV,g9 as aW,NB as aX,Xd as aY,wg as aZ,R9 as a_,eD as aa,kB as ab,VB as ac,_9 as ad,HB as ae,GB as af,tn as ag,bc as ah,dD as ai,i9 as aj,Ut as ak,ZB as al,e9 as am,Pt as an,t9 as ao,n9 as ap,Z2 as aq,y9 as ar,m9 as as,CB as at,qB as au,BB as av,LB as aw,o9 as ax,l9 as ay,a9 as az,tD as b,PN as b$,Ic as b0,k9 as b1,Xu as b2,ta as b3,Ei as b4,T9 as b5,Ai as b6,Ti as b7,Ks as b8,Ed as b9,MD as bA,X9 as bB,dz as bC,W0 as bD,mV as bE,rN as bF,G9 as bG,F9 as bH,RN as bI,nz as bJ,az as bK,cz as bL,Z9 as bM,QN as bN,HN as bO,N9 as bP,TD as bQ,CN as bR,rz as bS,oz as bT,uz as bU,FD as bV,J9 as bW,q9 as bX,DN as bY,$9 as bZ,GN as b_,P9 as ba,Oo as bb,qa as bc,yO as bd,A9 as be,ez as bf,jp as bg,S9 as bh,_O as bi,qg as bj,Si as bk,M9 as bl,WN as bm,rE as bn,vO as bo,iE as bp,VN as bq,NN as br,iN as bs,ON as bt,C9 as bu,Y9 as bv,j9 as bw,K9 as bx,AO as by,D9 as bz,al as c,kg as c0,O9 as c1,MN as c2,U9 as c3,tz as c4,iz as c5,lz as c6,JN as c7,V9 as c8,Q9 as c9,FN as ca,UN as cb,sz as cc,z9 as cd,W9 as ce,H9 as cf,B9 as cg,L9 as ch,Xo as d,Vt as e,pe as f,Il as g,yc as h,wd as i,zh as j,_c as k,qh as l,_g as m,ll as n,Bh as o,Ro as p,wD as q,on as r,Lo as s,ke as t,xB as u,BR as v,Qt as w,E9 as x,ut as y,wB as z};
