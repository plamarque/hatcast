(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function rm(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const Dt={},Oa=[],$r=()=>{},UT=()=>!1,hh=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),sm=n=>n.startsWith("onUpdate:"),kn=Object.assign,im=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},jT=Object.prototype.hasOwnProperty,At=(n,e)=>jT.call(n,e),ze=Array.isArray,Ma=n=>lc(n)==="[object Map]",ml=n=>lc(n)==="[object Set]",Pv=n=>lc(n)==="[object Date]",Ze=n=>typeof n=="function",mn=n=>typeof n=="string",qr=n=>typeof n=="symbol",Ft=n=>n!==null&&typeof n=="object",k_=n=>(Ft(n)||Ze(n))&&Ze(n.then)&&Ze(n.catch),D_=Object.prototype.toString,lc=n=>D_.call(n),qT=n=>lc(n).slice(8,-1),N_=n=>lc(n)==="[object Object]",om=n=>mn(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,mu=rm(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),fh=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},BT=/-(\w)/g,Cr=fh(n=>n.replace(BT,(e,t)=>t?t.toUpperCase():"")),zT=/\B([A-Z])/g,Qi=fh(n=>n.replace(zT,"-$1").toLowerCase()),ph=fh(n=>n.charAt(0).toUpperCase()+n.slice(1)),If=fh(n=>n?`on${ph(n)}`:""),Ni=(n,e)=>!Object.is(n,e),hd=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},ip=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},Dd=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let Rv;const mh=()=>Rv||(Rv=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function _r(n){if(ze(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=mn(r)?WT(r):_r(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(mn(n)||Ft(n))return n}const KT=/;(?![^(]*\))/g,GT=/:([^]+)/,HT=/\/\*[^]*?\*\//g;function WT(n){const e={};return n.replace(HT,"").split(KT).forEach(t=>{if(t){const r=t.split(GT);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function Zt(n){let e="";if(mn(n))e=n;else if(ze(n))for(let t=0;t<n.length;t++){const r=Zt(n[t]);r&&(e+=r+" ")}else if(Ft(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const QT="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",JT=rm(QT);function V_(n){return!!n||n===""}function YT(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=uc(n[r],e[r]);return t}function uc(n,e){if(n===e)return!0;let t=Pv(n),r=Pv(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=qr(n),r=qr(e),t||r)return n===e;if(t=ze(n),r=ze(e),t||r)return t&&r?YT(n,e):!1;if(t=Ft(n),r=Ft(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!uc(n[o],e[o]))return!1}}return String(n)===String(e)}function am(n,e){return n.findIndex(t=>uc(t,e))}const O_=n=>!!(n&&n.__v_isRef===!0),ie=n=>mn(n)?n:n==null?"":ze(n)||Ft(n)&&(n.toString===D_||!Ze(n.toString))?O_(n)?ie(n.value):JSON.stringify(n,M_,2):String(n),M_=(n,e)=>O_(e)?M_(n,e.value):Ma(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[Ef(r,i)+" =>"]=s,t),{})}:ml(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>Ef(t))}:qr(e)?Ef(e):Ft(e)&&!ze(e)&&!N_(e)?String(e):e,Ef=(n,e="")=>{var t;return qr(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let lr;class XT{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=lr,!e&&lr&&(this.index=(lr.scopes||(lr.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=lr;try{return lr=this,e()}finally{lr=t}}}on(){++this._on===1&&(this.prevScope=lr,lr=this)}off(){this._on>0&&--this._on===0&&(lr=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function ZT(){return lr}let Lt;const Tf=new WeakSet;class L_{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,lr&&lr.active&&lr.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Tf.has(this)&&(Tf.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||F_(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Cv(this),U_(this);const e=Lt,t=Fr;Lt=this,Fr=!0;try{return this.fn()}finally{j_(this),Lt=e,Fr=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)cm(e);this.deps=this.depsTail=void 0,Cv(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Tf.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){op(this)&&this.run()}get dirty(){return op(this)}}let $_=0,gu,vu;function F_(n,e=!1){if(n.flags|=8,e){n.next=vu,vu=n;return}n.next=gu,gu=n}function lm(){$_++}function um(){if(--$_>0)return;if(vu){let e=vu;for(vu=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;gu;){let e=gu;for(gu=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function U_(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function j_(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),cm(r),eA(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function op(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(q_(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function q_(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===ku)||(n.globalVersion=ku,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!op(n))))return;n.flags|=2;const e=n.dep,t=Lt,r=Fr;Lt=n,Fr=!0;try{U_(n);const s=n.fn(n._value);(e.version===0||Ni(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{Lt=t,Fr=r,j_(n),n.flags&=-3}}function cm(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)cm(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function eA(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let Fr=!0;const B_=[];function Fs(){B_.push(Fr),Fr=!1}function Us(){const n=B_.pop();Fr=n===void 0?!0:n}function Cv(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=Lt;Lt=void 0;try{e()}finally{Lt=t}}}let ku=0;class tA{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class dm{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Lt||!Fr||Lt===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Lt)t=this.activeLink=new tA(Lt,this),Lt.deps?(t.prevDep=Lt.depsTail,Lt.depsTail.nextDep=t,Lt.depsTail=t):Lt.deps=Lt.depsTail=t,z_(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=Lt.depsTail,t.nextDep=void 0,Lt.depsTail.nextDep=t,Lt.depsTail=t,Lt.deps===t&&(Lt.deps=r)}return t}trigger(e){this.version++,ku++,this.notify(e)}notify(e){lm();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{um()}}}function z_(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)z_(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const ap=new WeakMap,Oo=Symbol(""),lp=Symbol(""),Du=Symbol("");function Kn(n,e,t){if(Fr&&Lt){let r=ap.get(n);r||ap.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new dm),s.map=r,s.key=t),s.track()}}function Ss(n,e,t,r,s,i){const o=ap.get(n);if(!o){ku++;return}const a=l=>{l&&l.trigger()};if(lm(),e==="clear")o.forEach(a);else{const l=ze(n),c=l&&om(t);if(l&&t==="length"){const h=Number(r);o.forEach((f,g)=>{(g==="length"||g===Du||!qr(g)&&g>=h)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(Du)),e){case"add":l?c&&a(o.get("length")):(a(o.get(Oo)),Ma(n)&&a(o.get(lp)));break;case"delete":l||(a(o.get(Oo)),Ma(n)&&a(o.get(lp)));break;case"set":Ma(n)&&a(o.get(Oo));break}}um()}function Ia(n){const e=Tt(n);return e===n?e:(Kn(e,"iterate",Du),Pr(n)?e:e.map(Mn))}function gh(n){return Kn(n=Tt(n),"iterate",Du),n}const nA={__proto__:null,[Symbol.iterator](){return Af(this,Symbol.iterator,Mn)},concat(...n){return Ia(this).concat(...n.map(e=>ze(e)?Ia(e):e))},entries(){return Af(this,"entries",n=>(n[1]=Mn(n[1]),n))},every(n,e){return Is(this,"every",n,e,void 0,arguments)},filter(n,e){return Is(this,"filter",n,e,t=>t.map(Mn),arguments)},find(n,e){return Is(this,"find",n,e,Mn,arguments)},findIndex(n,e){return Is(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return Is(this,"findLast",n,e,Mn,arguments)},findLastIndex(n,e){return Is(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return Is(this,"forEach",n,e,void 0,arguments)},includes(...n){return Sf(this,"includes",n)},indexOf(...n){return Sf(this,"indexOf",n)},join(n){return Ia(this).join(n)},lastIndexOf(...n){return Sf(this,"lastIndexOf",n)},map(n,e){return Is(this,"map",n,e,void 0,arguments)},pop(){return Jl(this,"pop")},push(...n){return Jl(this,"push",n)},reduce(n,...e){return kv(this,"reduce",n,e)},reduceRight(n,...e){return kv(this,"reduceRight",n,e)},shift(){return Jl(this,"shift")},some(n,e){return Is(this,"some",n,e,void 0,arguments)},splice(...n){return Jl(this,"splice",n)},toReversed(){return Ia(this).toReversed()},toSorted(n){return Ia(this).toSorted(n)},toSpliced(...n){return Ia(this).toSpliced(...n)},unshift(...n){return Jl(this,"unshift",n)},values(){return Af(this,"values",Mn)}};function Af(n,e,t){const r=gh(n),s=r[e]();return r!==n&&!Pr(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const rA=Array.prototype;function Is(n,e,t,r,s,i){const o=gh(n),a=o!==n&&!Pr(n),l=o[e];if(l!==rA[e]){const f=l.apply(n,i);return a?Mn(f):f}let c=t;o!==n&&(a?c=function(f,g){return t.call(this,Mn(f),g,n)}:t.length>2&&(c=function(f,g){return t.call(this,f,g,n)}));const h=l.call(o,c,r);return a&&s?s(h):h}function kv(n,e,t,r){const s=gh(n);let i=t;return s!==n&&(Pr(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,Mn(a),l,n)}),s[e](i,...r)}function Sf(n,e,t){const r=Tt(n);Kn(r,"iterate",Du);const s=r[e](...t);return(s===-1||s===!1)&&pm(t[0])?(t[0]=Tt(t[0]),r[e](...t)):s}function Jl(n,e,t=[]){Fs(),lm();const r=Tt(n)[e].apply(n,t);return um(),Us(),r}const sA=rm("__proto__,__v_isRef,__isVue"),K_=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(qr));function iA(n){qr(n)||(n=String(n));const e=Tt(this);return Kn(e,"has",n),e.hasOwnProperty(n)}class G_{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?mA:J_:i?Q_:W_).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=ze(e);if(!s){let l;if(o&&(l=nA[t]))return l;if(t==="hasOwnProperty")return iA}const a=Reflect.get(e,t,Hn(e)?e:r);return(qr(t)?K_.has(t):sA(t))||(s||Kn(e,"get",t),i)?a:Hn(a)?o&&om(t)?a:a.value:Ft(a)?s?X_(a):vh(a):a}}class H_ extends G_{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=Fi(i);if(!Pr(r)&&!Fi(r)&&(i=Tt(i),r=Tt(r)),!ze(e)&&Hn(i)&&!Hn(r))return l?!1:(i.value=r,!0)}const o=ze(e)&&om(t)?Number(t)<e.length:At(e,t),a=Reflect.set(e,t,r,Hn(e)?e:s);return e===Tt(s)&&(o?Ni(r,i)&&Ss(e,"set",t,r):Ss(e,"add",t,r)),a}deleteProperty(e,t){const r=At(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&Ss(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!qr(t)||!K_.has(t))&&Kn(e,"has",t),r}ownKeys(e){return Kn(e,"iterate",ze(e)?"length":Oo),Reflect.ownKeys(e)}}class oA extends G_{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const aA=new H_,lA=new oA,uA=new H_(!0);const up=n=>n,Xc=n=>Reflect.getPrototypeOf(n);function cA(n,e,t){return function(...r){const s=this.__v_raw,i=Tt(s),o=Ma(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...r),h=t?up:e?Nd:Mn;return!e&&Kn(i,"iterate",l?lp:Oo),{next(){const{value:f,done:g}=c.next();return g?{value:f,done:g}:{value:a?[h(f[0]),h(f[1])]:h(f),done:g}},[Symbol.iterator](){return this}}}}function Zc(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function dA(n,e){const t={get(s){const i=this.__v_raw,o=Tt(i),a=Tt(s);n||(Ni(s,a)&&Kn(o,"get",s),Kn(o,"get",a));const{has:l}=Xc(o),c=e?up:n?Nd:Mn;if(l.call(o,s))return c(i.get(s));if(l.call(o,a))return c(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&Kn(Tt(s),"iterate",Oo),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=Tt(i),a=Tt(s);return n||(Ni(s,a)&&Kn(o,"has",s),Kn(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=Tt(a),c=e?up:n?Nd:Mn;return!n&&Kn(l,"iterate",Oo),a.forEach((h,f)=>s.call(i,c(h),c(f),o))}};return kn(t,n?{add:Zc("add"),set:Zc("set"),delete:Zc("delete"),clear:Zc("clear")}:{add(s){!e&&!Pr(s)&&!Fi(s)&&(s=Tt(s));const i=Tt(this);return Xc(i).has.call(i,s)||(i.add(s),Ss(i,"add",s,s)),this},set(s,i){!e&&!Pr(i)&&!Fi(i)&&(i=Tt(i));const o=Tt(this),{has:a,get:l}=Xc(o);let c=a.call(o,s);c||(s=Tt(s),c=a.call(o,s));const h=l.call(o,s);return o.set(s,i),c?Ni(i,h)&&Ss(o,"set",s,i):Ss(o,"add",s,i),this},delete(s){const i=Tt(this),{has:o,get:a}=Xc(i);let l=o.call(i,s);l||(s=Tt(s),l=o.call(i,s)),a&&a.call(i,s);const c=i.delete(s);return l&&Ss(i,"delete",s,void 0),c},clear(){const s=Tt(this),i=s.size!==0,o=s.clear();return i&&Ss(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=cA(s,n,e)}),t}function hm(n,e){const t=dA(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(At(t,s)&&s in r?t:r,s,i)}const hA={get:hm(!1,!1)},fA={get:hm(!1,!0)},pA={get:hm(!0,!1)};const W_=new WeakMap,Q_=new WeakMap,J_=new WeakMap,mA=new WeakMap;function gA(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function vA(n){return n.__v_skip||!Object.isExtensible(n)?0:gA(qT(n))}function vh(n){return Fi(n)?n:fm(n,!1,aA,hA,W_)}function Y_(n){return fm(n,!1,uA,fA,Q_)}function X_(n){return fm(n,!0,lA,pA,J_)}function fm(n,e,t,r,s){if(!Ft(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=vA(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function La(n){return Fi(n)?La(n.__v_raw):!!(n&&n.__v_isReactive)}function Fi(n){return!!(n&&n.__v_isReadonly)}function Pr(n){return!!(n&&n.__v_isShallow)}function pm(n){return n?!!n.__v_raw:!1}function Tt(n){const e=n&&n.__v_raw;return e?Tt(e):n}function yA(n){return!At(n,"__v_skip")&&Object.isExtensible(n)&&ip(n,"__v_skip",!0),n}const Mn=n=>Ft(n)?vh(n):n,Nd=n=>Ft(n)?X_(n):n;function Hn(n){return n?n.__v_isRef===!0:!1}function P(n){return Z_(n,!1)}function _A(n){return Z_(n,!0)}function Z_(n,e){return Hn(n)?n:new bA(n,e)}class bA{constructor(e,t){this.dep=new dm,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Tt(e),this._value=t?e:Mn(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||Pr(e)||Fi(e);e=r?e:Tt(e),Ni(e,t)&&(this._rawValue=e,this._value=r?e:Mn(e),this.dep.trigger())}}function Ur(n){return Hn(n)?n.value:n}const wA={get:(n,e,t)=>e==="__v_raw"?n:Ur(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return Hn(s)&&!Hn(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function eb(n){return La(n)?n:new Proxy(n,wA)}class xA{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new dm(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=ku-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&Lt!==this)return F_(this,!0),!0}get value(){const e=this.dep.track();return q_(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function IA(n,e,t=!1){let r,s;return Ze(n)?r=n:(r=n.get,s=n.set),new xA(r,s,t)}const ed={},Vd=new WeakMap;let Io;function EA(n,e=!1,t=Io){if(t){let r=Vd.get(t);r||Vd.set(t,r=[]),r.push(n)}}function TA(n,e,t=Dt){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,c=L=>s?L:Pr(L)||s===!1||s===0?Ps(L,1):Ps(L);let h,f,g,y,I=!1,A=!1;if(Hn(n)?(f=()=>n.value,I=Pr(n)):La(n)?(f=()=>c(n),I=!0):ze(n)?(A=!0,I=n.some(L=>La(L)||Pr(L)),f=()=>n.map(L=>{if(Hn(L))return L.value;if(La(L))return c(L);if(Ze(L))return l?l(L,2):L()})):Ze(n)?e?f=l?()=>l(n,2):n:f=()=>{if(g){Fs();try{g()}finally{Us()}}const L=Io;Io=h;try{return l?l(n,3,[y]):n(y)}finally{Io=L}}:f=$r,e&&s){const L=f,se=s===!0?1/0:s;f=()=>Ps(L(),se)}const S=ZT(),$=()=>{h.stop(),S&&S.active&&im(S.effects,h)};if(i&&e){const L=e;e=(...se)=>{L(...se),$()}}let U=A?new Array(n.length).fill(ed):ed;const M=L=>{if(!(!(h.flags&1)||!h.dirty&&!L))if(e){const se=h.run();if(s||I||(A?se.some((Q,x)=>Ni(Q,U[x])):Ni(se,U))){g&&g();const Q=Io;Io=h;try{const x=[se,U===ed?void 0:A&&U[0]===ed?[]:U,y];U=se,l?l(e,3,x):e(...x)}finally{Io=Q}}}else h.run()};return a&&a(M),h=new L_(f),h.scheduler=o?()=>o(M,!1):M,y=L=>EA(L,!1,h),g=h.onStop=()=>{const L=Vd.get(h);if(L){if(l)l(L,4);else for(const se of L)se();Vd.delete(h)}},e?r?M(!0):U=h.run():o?o(M.bind(null,!0),!0):h.run(),$.pause=h.pause.bind(h),$.resume=h.resume.bind(h),$.stop=$,$}function Ps(n,e=1/0,t){if(e<=0||!Ft(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,Hn(n))Ps(n.value,e,t);else if(ze(n))for(let r=0;r<n.length;r++)Ps(n[r],e,t);else if(ml(n)||Ma(n))n.forEach(r=>{Ps(r,e,t)});else if(N_(n)){for(const r in n)Ps(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&Ps(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function cc(n,e,t,r){try{return r?n(...r):n()}catch(s){yh(s,e,t)}}function ls(n,e,t,r){if(Ze(n)){const s=cc(n,e,t,r);return s&&k_(s)&&s.catch(i=>{yh(i,e,t)}),s}if(ze(n)){const s=[];for(let i=0;i<n.length;i++)s.push(ls(n[i],e,t,r));return s}}function yh(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||Dt;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const h=a.ec;if(h){for(let f=0;f<h.length;f++)if(h[f](n,l,c)===!1)return}a=a.parent}if(i){Fs(),cc(i,null,10,[n,l,c]),Us();return}}AA(n,t,s,r,o)}function AA(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const Zn=[];let es=-1;const $a=[];let _i=null,Pa=0;const tb=Promise.resolve();let Od=null;function Ht(n){const e=Od||tb;return n?e.then(this?n.bind(this):n):e}function SA(n){let e=es+1,t=Zn.length;for(;e<t;){const r=e+t>>>1,s=Zn[r],i=Nu(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function mm(n){if(!(n.flags&1)){const e=Nu(n),t=Zn[Zn.length-1];!t||!(n.flags&2)&&e>=Nu(t)?Zn.push(n):Zn.splice(SA(e),0,n),n.flags|=1,nb()}}function nb(){Od||(Od=tb.then(sb))}function PA(n){ze(n)?$a.push(...n):_i&&n.id===-1?_i.splice(Pa+1,0,n):n.flags&1||($a.push(n),n.flags|=1),nb()}function Dv(n,e,t=es+1){for(;t<Zn.length;t++){const r=Zn[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;Zn.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function rb(n){if($a.length){const e=[...new Set($a)].sort((t,r)=>Nu(t)-Nu(r));if($a.length=0,_i){_i.push(...e);return}for(_i=e,Pa=0;Pa<_i.length;Pa++){const t=_i[Pa];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}_i=null,Pa=0}}const Nu=n=>n.id==null?n.flags&2?-1:1/0:n.id;function sb(n){const e=$r;try{for(es=0;es<Zn.length;es++){const t=Zn[es];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),cc(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;es<Zn.length;es++){const t=Zn[es];t&&(t.flags&=-2)}es=-1,Zn.length=0,rb(),Od=null,(Zn.length||$a.length)&&sb()}}let $n=null,ib=null;function Md(n){const e=$n;return $n=n,ib=n&&n.type.__scopeId||null,e}function RA(n,e=$n,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&zv(-1);const i=Md(e);let o;try{o=n(...s)}finally{Md(i),r._d&&zv(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function ot(n,e){if($n===null)return n;const t=xh($n),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=Dt]=e[s];i&&(Ze(i)&&(i={mounted:i,updated:i}),i.deep&&Ps(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function bo(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(Fs(),ls(l,t,8,[n.el,a,n,e]),Us())}}const ob=Symbol("_vte"),CA=n=>n.__isTeleport,yu=n=>n&&(n.disabled||n.disabled===""),Nv=n=>n&&(n.defer||n.defer===""),Vv=n=>typeof SVGElement<"u"&&n instanceof SVGElement,Ov=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,cp=(n,e)=>{const t=n&&n.to;return mn(t)?e?e(t):null:t},ab={name:"Teleport",__isTeleport:!0,process(n,e,t,r,s,i,o,a,l,c){const{mc:h,pc:f,pbc:g,o:{insert:y,querySelector:I,createText:A,createComment:S}}=c,$=yu(e.props);let{shapeFlag:U,children:M,dynamicChildren:L}=e;if(n==null){const se=e.el=A(""),Q=e.anchor=A("");y(se,t,r),y(Q,t,r);const x=(E,C)=>{U&16&&(s&&s.isCE&&(s.ce._teleportTarget=E),h(M,E,C,s,i,o,a,l))},b=()=>{const E=e.target=cp(e.props,I),C=lb(E,e,A,y);E&&(o!=="svg"&&Vv(E)?o="svg":o!=="mathml"&&Ov(E)&&(o="mathml"),$||(x(E,C),fd(e,!1)))};$&&(x(t,Q),fd(e,!0)),Nv(e.props)?(e.el.__isMounted=!1,Xn(()=>{b(),delete e.el.__isMounted},i)):b()}else{if(Nv(e.props)&&n.el.__isMounted===!1){Xn(()=>{ab.process(n,e,t,r,s,i,o,a,l,c)},i);return}e.el=n.el,e.targetStart=n.targetStart;const se=e.anchor=n.anchor,Q=e.target=n.target,x=e.targetAnchor=n.targetAnchor,b=yu(n.props),E=b?t:Q,C=b?se:x;if(o==="svg"||Vv(Q)?o="svg":(o==="mathml"||Ov(Q))&&(o="mathml"),L?(g(n.dynamicChildren,L,E,s,i,o,a),bm(n,e,!0)):l||f(n,e,E,C,s,i,o,a,!1),$)b?e.props&&n.props&&e.props.to!==n.props.to&&(e.props.to=n.props.to):td(e,t,se,c,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const O=e.target=cp(e.props,I);O&&td(e,O,null,c,0)}else b&&td(e,Q,x,c,1);fd(e,$)}},remove(n,e,t,{um:r,o:{remove:s}},i){const{shapeFlag:o,children:a,anchor:l,targetStart:c,targetAnchor:h,target:f,props:g}=n;if(f&&(s(c),s(h)),i&&s(l),o&16){const y=i||!yu(g);for(let I=0;I<a.length;I++){const A=a[I];r(A,e,t,y,!!A.dynamicChildren)}}},move:td,hydrate:kA};function td(n,e,t,{o:{insert:r},m:s},i=2){i===0&&r(n.targetAnchor,e,t);const{el:o,anchor:a,shapeFlag:l,children:c,props:h}=n,f=i===2;if(f&&r(o,e,t),(!f||yu(h))&&l&16)for(let g=0;g<c.length;g++)s(c[g],e,t,2);f&&r(a,e,t)}function kA(n,e,t,r,s,i,{o:{nextSibling:o,parentNode:a,querySelector:l,insert:c,createText:h}},f){const g=e.target=cp(e.props,l);if(g){const y=yu(e.props),I=g._lpa||g.firstChild;if(e.shapeFlag&16)if(y)e.anchor=f(o(n),e,a(n),t,r,s,i),e.targetStart=I,e.targetAnchor=I&&o(I);else{e.anchor=o(n);let A=I;for(;A;){if(A&&A.nodeType===8){if(A.data==="teleport start anchor")e.targetStart=A;else if(A.data==="teleport anchor"){e.targetAnchor=A,g._lpa=e.targetAnchor&&o(e.targetAnchor);break}}A=o(A)}e.targetAnchor||lb(g,e,h,c),f(I&&o(I),e,g,t,r,s,i)}fd(e,y)}return e.anchor&&o(e.anchor)}const Vu=ab;function fd(n,e){const t=n.ctx;if(t&&t.ut){let r,s;for(e?(r=n.el,s=n.anchor):(r=n.targetStart,s=n.targetAnchor);r&&r!==s;)r.nodeType===1&&r.setAttribute("data-v-owner",t.uid),r=r.nextSibling;t.ut()}}function lb(n,e,t,r){const s=e.targetStart=t(""),i=e.targetAnchor=t("");return s[ob]=i,n&&(r(s,n),r(i,n)),i}function gm(n,e){n.shapeFlag&6&&n.component?(n.transition=e,gm(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}/*! #__NO_SIDE_EFFECTS__ */function ub(n,e){return Ze(n)?(()=>kn({name:n.name},e,{setup:n}))():n}function cb(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function _u(n,e,t,r,s=!1){if(ze(n)){n.forEach((I,A)=>_u(I,e&&(ze(e)?e[A]:e),t,r,s));return}if(Fa(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&_u(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?xh(r.component):r.el,o=s?null:i,{i:a,r:l}=n,c=e&&e.r,h=a.refs===Dt?a.refs={}:a.refs,f=a.setupState,g=Tt(f),y=f===Dt?()=>!1:I=>At(g,I);if(c!=null&&c!==l&&(mn(c)?(h[c]=null,y(c)&&(f[c]=null)):Hn(c)&&(c.value=null)),Ze(l))cc(l,a,12,[o,h]);else{const I=mn(l),A=Hn(l);if(I||A){const S=()=>{if(n.f){const $=I?y(l)?f[l]:h[l]:l.value;s?ze($)&&im($,i):ze($)?$.includes(i)||$.push(i):I?(h[l]=[i],y(l)&&(f[l]=h[l])):(l.value=[i],n.k&&(h[n.k]=l.value))}else I?(h[l]=o,y(l)&&(f[l]=o)):A&&(l.value=o,n.k&&(h[n.k]=o))};o?(S.id=-1,Xn(S,t)):S()}}}mh().requestIdleCallback;mh().cancelIdleCallback;const Fa=n=>!!n.type.__asyncLoader,db=n=>n.type.__isKeepAlive;function DA(n,e){hb(n,"a",e)}function NA(n,e){hb(n,"da",e)}function hb(n,e,t=Gn){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(_h(e,r,t),t){let s=t.parent;for(;s&&s.parent;)db(s.parent.vnode)&&VA(r,e,t,s),s=s.parent}}function VA(n,e,t,r){const s=_h(e,n,r,!0);Vi(()=>{im(r[e],s)},t)}function _h(n,e,t=Gn,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{Fs();const a=dc(t),l=ls(e,t,n,o);return a(),Us(),l});return r?s.unshift(i):s.push(i),i}}const Ws=n=>(e,t=Gn)=>{(!Lu||n==="sp")&&_h(n,(...r)=>e(...r),t)},OA=Ws("bm"),yn=Ws("m"),MA=Ws("bu"),LA=Ws("u"),fb=Ws("bum"),Vi=Ws("um"),$A=Ws("sp"),FA=Ws("rtg"),UA=Ws("rtc");function jA(n,e=Gn){_h("ec",n,e)}const pb="components";function qA(n,e){return zA(pb,n,!0,e)||n}const BA=Symbol.for("v-ndc");function zA(n,e,t=!0,r=!1){const s=$n||Gn;if(s){const i=s.type;if(n===pb){const a=k1(i,!1);if(a&&(a===e||a===Cr(e)||a===ph(Cr(e))))return i}const o=Mv(s[n]||i[n],e)||Mv(s.appContext[n],e);return!o&&r?i:o}}function Mv(n,e){return n&&(n[e]||n[Cr(e)]||n[ph(Cr(e))])}function br(n,e,t,r){let s;const i=t&&t[r],o=ze(n);if(o||mn(n)){const a=o&&La(n);let l=!1,c=!1;a&&(l=!Pr(n),c=Fi(n),n=gh(n)),s=new Array(n.length);for(let h=0,f=n.length;h<f;h++)s[h]=e(l?c?Nd(Mn(n[h])):Mn(n[h]):n[h],h,void 0,i&&i[h])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(Ft(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const h=a[l];s[l]=e(n[h],h,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}function KA(n,e,t={},r,s){if($n.ce||$n.parent&&Fa($n.parent)&&$n.parent.ce)return e!=="default"&&(t.name=e),D(),Vs(it,null,[Qe("slot",t,r&&r())],64);let i=n[e];i&&i._c&&(i._d=!1),D();const o=i&&mb(i(t)),a=t.key||o&&o.key,l=Vs(it,{key:(a&&!qr(a)?a:`_${e}`)+(!o&&r?"_fb":"")},o||(r?r():[]),o&&n._===1?64:-2);return!s&&l.scopeId&&(l.slotScopeIds=[l.scopeId+"-s"]),i&&i._c&&(i._d=!0),l}function mb(n){return n.some(e=>Mu(e)?!(e.type===js||e.type===it&&!mb(e.children)):!0)?n:null}const dp=n=>n?Nb(n)?xh(n):dp(n.parent):null,bu=kn(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>dp(n.parent),$root:n=>dp(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>vm(n),$forceUpdate:n=>n.f||(n.f=()=>{mm(n.update)}),$nextTick:n=>n.n||(n.n=Ht.bind(n.proxy)),$watch:n=>h1.bind(n)}),Pf=(n,e)=>n!==Dt&&!n.__isScriptSetup&&At(n,e),GA={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const y=o[e];if(y!==void 0)switch(y){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(Pf(r,e))return o[e]=1,r[e];if(s!==Dt&&At(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&At(c,e))return o[e]=3,i[e];if(t!==Dt&&At(t,e))return o[e]=4,t[e];hp&&(o[e]=0)}}const h=bu[e];let f,g;if(h)return e==="$attrs"&&Kn(n.attrs,"get",""),h(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==Dt&&At(t,e))return o[e]=4,t[e];if(g=l.config.globalProperties,At(g,e))return g[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return Pf(s,e)?(s[e]=t,!0):r!==Dt&&At(r,e)?(r[e]=t,!0):At(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==Dt&&At(n,o)||Pf(e,o)||(a=i[0])&&At(a,o)||At(r,o)||At(bu,o)||At(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:At(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function Lv(n){return ze(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let hp=!0;function HA(n){const e=vm(n),t=n.proxy,r=n.ctx;hp=!1,e.beforeCreate&&$v(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:c,created:h,beforeMount:f,mounted:g,beforeUpdate:y,updated:I,activated:A,deactivated:S,beforeDestroy:$,beforeUnmount:U,destroyed:M,unmounted:L,render:se,renderTracked:Q,renderTriggered:x,errorCaptured:b,serverPrefetch:E,expose:C,inheritAttrs:O,components:F,directives:R,filters:pt}=e;if(c&&WA(c,r,null),o)for(const re in o){const ue=o[re];Ze(ue)&&(r[re]=ue.bind(t))}if(s){const re=s.call(t,t);Ft(re)&&(n.data=vh(re))}if(hp=!0,i)for(const re in i){const ue=i[re],oe=Ze(ue)?ue.bind(t,t):Ze(ue.get)?ue.get.bind(t,t):$r,Ne=!Ze(ue)&&Ze(ue.set)?ue.set.bind(t):$r,te=Fe({get:oe,set:Ne});Object.defineProperty(r,re,{enumerable:!0,configurable:!0,get:()=>te.value,set:Y=>te.value=Y})}if(a)for(const re in a)gb(a[re],r,t,re);if(l){const re=Ze(l)?l.call(t):l;Reflect.ownKeys(re).forEach(ue=>{pd(ue,re[ue])})}h&&$v(h,n,"c");function we(re,ue){ze(ue)?ue.forEach(oe=>re(oe.bind(t))):ue&&re(ue.bind(t))}if(we(OA,f),we(yn,g),we(MA,y),we(LA,I),we(DA,A),we(NA,S),we(jA,b),we(UA,Q),we(FA,x),we(fb,U),we(Vi,L),we($A,E),ze(C))if(C.length){const re=n.exposed||(n.exposed={});C.forEach(ue=>{Object.defineProperty(re,ue,{get:()=>t[ue],set:oe=>t[ue]=oe})})}else n.exposed||(n.exposed={});se&&n.render===$r&&(n.render=se),O!=null&&(n.inheritAttrs=O),F&&(n.components=F),R&&(n.directives=R),E&&cb(n)}function WA(n,e,t=$r){ze(n)&&(n=fp(n));for(const r in n){const s=n[r];let i;Ft(s)?"default"in s?i=jr(s.from||r,s.default,!0):i=jr(s.from||r):i=jr(s),Hn(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function $v(n,e,t){ls(ze(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function gb(n,e,t,r){let s=r.includes(".")?Pb(t,r):()=>t[r];if(mn(n)){const i=e[n];Ze(i)&&bt(s,i)}else if(Ze(n))bt(s,n.bind(t));else if(Ft(n))if(ze(n))n.forEach(i=>gb(i,e,t,r));else{const i=Ze(n.handler)?n.handler.bind(t):e[n.handler];Ze(i)&&bt(s,i,n)}}function vm(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(c=>Ld(l,c,o,!0)),Ld(l,e,o)),Ft(e)&&i.set(e,l),l}function Ld(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&Ld(n,i,t,!0),s&&s.forEach(o=>Ld(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=QA[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const QA={data:Fv,props:Uv,emits:Uv,methods:au,computed:au,beforeCreate:Yn,created:Yn,beforeMount:Yn,mounted:Yn,beforeUpdate:Yn,updated:Yn,beforeDestroy:Yn,beforeUnmount:Yn,destroyed:Yn,unmounted:Yn,activated:Yn,deactivated:Yn,errorCaptured:Yn,serverPrefetch:Yn,components:au,directives:au,watch:YA,provide:Fv,inject:JA};function Fv(n,e){return e?n?function(){return kn(Ze(n)?n.call(this,this):n,Ze(e)?e.call(this,this):e)}:e:n}function JA(n,e){return au(fp(n),fp(e))}function fp(n){if(ze(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function Yn(n,e){return n?[...new Set([].concat(n,e))]:e}function au(n,e){return n?kn(Object.create(null),n,e):e}function Uv(n,e){return n?ze(n)&&ze(e)?[...new Set([...n,...e])]:kn(Object.create(null),Lv(n),Lv(e??{})):e}function YA(n,e){if(!n)return e;if(!e)return n;const t=kn(Object.create(null),n);for(const r in e)t[r]=Yn(n[r],e[r]);return t}function vb(){return{app:null,config:{isNativeTag:UT,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let XA=0;function ZA(n,e){return function(r,s=null){Ze(r)||(r=kn({},r)),s!=null&&!Ft(s)&&(s=null);const i=vb(),o=new WeakSet,a=[];let l=!1;const c=i.app={_uid:XA++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:N1,get config(){return i.config},set config(h){},use(h,...f){return o.has(h)||(h&&Ze(h.install)?(o.add(h),h.install(c,...f)):Ze(h)&&(o.add(h),h(c,...f))),c},mixin(h){return i.mixins.includes(h)||i.mixins.push(h),c},component(h,f){return f?(i.components[h]=f,c):i.components[h]},directive(h,f){return f?(i.directives[h]=f,c):i.directives[h]},mount(h,f,g){if(!l){const y=c._ceVNode||Qe(r,s);return y.appContext=i,g===!0?g="svg":g===!1&&(g=void 0),f&&e?e(y,h):n(y,h,g),l=!0,c._container=h,h.__vue_app__=c,xh(y.component)}},onUnmount(h){a.push(h)},unmount(){l&&(ls(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(h,f){return i.provides[h]=f,c},runWithContext(h){const f=Ua;Ua=c;try{return h()}finally{Ua=f}}};return c}}let Ua=null;function pd(n,e){if(Gn){let t=Gn.provides;const r=Gn.parent&&Gn.parent.provides;r===t&&(t=Gn.provides=Object.create(r)),t[n]=e}}function jr(n,e,t=!1){const r=Gn||$n;if(r||Ua){let s=Ua?Ua._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&Ze(e)?e.call(r&&r.proxy):e}}const yb={},_b=()=>Object.create(yb),bb=n=>Object.getPrototypeOf(n)===yb;function e1(n,e,t,r=!1){const s={},i=_b();n.propsDefaults=Object.create(null),wb(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:Y_(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function t1(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=Tt(s),[l]=n.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const h=n.vnode.dynamicProps;for(let f=0;f<h.length;f++){let g=h[f];if(bh(n.emitsOptions,g))continue;const y=e[g];if(l)if(At(i,g))y!==i[g]&&(i[g]=y,c=!0);else{const I=Cr(g);s[I]=pp(l,a,I,y,n,!1)}else y!==i[g]&&(i[g]=y,c=!0)}}}else{wb(n,e,s,i)&&(c=!0);let h;for(const f in a)(!e||!At(e,f)&&((h=Qi(f))===f||!At(e,h)))&&(l?t&&(t[f]!==void 0||t[h]!==void 0)&&(s[f]=pp(l,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!At(e,f))&&(delete i[f],c=!0)}c&&Ss(n.attrs,"set","")}function wb(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(mu(l))continue;const c=e[l];let h;s&&At(s,h=Cr(l))?!i||!i.includes(h)?t[h]=c:(a||(a={}))[h]=c:bh(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(i){const l=Tt(t),c=a||Dt;for(let h=0;h<i.length;h++){const f=i[h];t[f]=pp(s,l,f,c[f],n,!At(c,f))}}return o}function pp(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=At(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&Ze(l)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const h=dc(s);r=c[t]=l.call(null,e),h()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===Qi(t))&&(r=!0))}return r}const n1=new WeakMap;function xb(n,e,t=!1){const r=t?n1:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!Ze(n)){const h=f=>{l=!0;const[g,y]=xb(f,e,!0);kn(o,g),y&&a.push(...y)};!t&&e.mixins.length&&e.mixins.forEach(h),n.extends&&h(n.extends),n.mixins&&n.mixins.forEach(h)}if(!i&&!l)return Ft(n)&&r.set(n,Oa),Oa;if(ze(i))for(let h=0;h<i.length;h++){const f=Cr(i[h]);jv(f)&&(o[f]=Dt)}else if(i)for(const h in i){const f=Cr(h);if(jv(f)){const g=i[h],y=o[f]=ze(g)||Ze(g)?{type:g}:kn({},g),I=y.type;let A=!1,S=!0;if(ze(I))for(let $=0;$<I.length;++$){const U=I[$],M=Ze(U)&&U.name;if(M==="Boolean"){A=!0;break}else M==="String"&&(S=!1)}else A=Ze(I)&&I.name==="Boolean";y[0]=A,y[1]=S,(A||At(y,"default"))&&a.push(f)}}const c=[o,a];return Ft(n)&&r.set(n,c),c}function jv(n){return n[0]!=="$"&&!mu(n)}const ym=n=>n[0]==="_"||n==="$stable",_m=n=>ze(n)?n.map(ts):[ts(n)],r1=(n,e,t)=>{if(e._n)return e;const r=RA((...s)=>_m(e(...s)),t);return r._c=!1,r},Ib=(n,e,t)=>{const r=n._ctx;for(const s in n){if(ym(s))continue;const i=n[s];if(Ze(i))e[s]=r1(s,i,r);else if(i!=null){const o=_m(i);e[s]=()=>o}}},Eb=(n,e)=>{const t=_m(e);n.slots.default=()=>t},Tb=(n,e,t)=>{for(const r in e)(t||!ym(r))&&(n[r]=e[r])},s1=(n,e,t)=>{const r=n.slots=_b();if(n.vnode.shapeFlag&32){const s=e.__;s&&ip(r,"__",s,!0);const i=e._;i?(Tb(r,e,t),t&&ip(r,"_",i,!0)):Ib(e,r)}else e&&Eb(n,e)},i1=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=Dt;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:Tb(s,e,t):(i=!e.$stable,Ib(e,s)),o=e}else e&&(Eb(n,e),o={default:1});if(i)for(const a in s)!ym(a)&&o[a]==null&&delete s[a]},Xn=_1;function o1(n){return a1(n)}function a1(n,e){const t=mh();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:c,setElementText:h,parentNode:f,nextSibling:g,setScopeId:y=$r,insertStaticContent:I}=n,A=(T,k,G,H=null,ne=null,de=null,be=void 0,_e=null,Ie=!!k.dynamicChildren)=>{if(T===k)return;T&&!Yl(T,k)&&(H=Z(T),Y(T,ne,de,!0),T=null),k.patchFlag===-2&&(Ie=!1,k.dynamicChildren=null);const{type:ye,ref:$e,shapeFlag:Ce}=k;switch(ye){case wh:S(T,k,G,H);break;case js:$(T,k,G,H);break;case md:T==null&&U(k,G,H,be);break;case it:F(T,k,G,H,ne,de,be,_e,Ie);break;default:Ce&1?se(T,k,G,H,ne,de,be,_e,Ie):Ce&6?R(T,k,G,H,ne,de,be,_e,Ie):(Ce&64||Ce&128)&&ye.process(T,k,G,H,ne,de,be,_e,Ie,Ve)}$e!=null&&ne?_u($e,T&&T.ref,de,k||T,!k):$e==null&&T&&T.ref!=null&&_u(T.ref,null,de,T,!0)},S=(T,k,G,H)=>{if(T==null)r(k.el=a(k.children),G,H);else{const ne=k.el=T.el;k.children!==T.children&&c(ne,k.children)}},$=(T,k,G,H)=>{T==null?r(k.el=l(k.children||""),G,H):k.el=T.el},U=(T,k,G,H)=>{[T.el,T.anchor]=I(T.children,k,G,H,T.el,T.anchor)},M=({el:T,anchor:k},G,H)=>{let ne;for(;T&&T!==k;)ne=g(T),r(T,G,H),T=ne;r(k,G,H)},L=({el:T,anchor:k})=>{let G;for(;T&&T!==k;)G=g(T),s(T),T=G;s(k)},se=(T,k,G,H,ne,de,be,_e,Ie)=>{k.type==="svg"?be="svg":k.type==="math"&&(be="mathml"),T==null?Q(k,G,H,ne,de,be,_e,Ie):E(T,k,ne,de,be,_e,Ie)},Q=(T,k,G,H,ne,de,be,_e)=>{let Ie,ye;const{props:$e,shapeFlag:Ce,transition:B,dirs:j}=T;if(Ie=T.el=o(T.type,de,$e&&$e.is,$e),Ce&8?h(Ie,T.children):Ce&16&&b(T.children,Ie,null,H,ne,Rf(T,de),be,_e),j&&bo(T,null,H,"created"),x(Ie,T,T.scopeId,be,H),$e){for(const he in $e)he!=="value"&&!mu(he)&&i(Ie,he,null,$e[he],de,H);"value"in $e&&i(Ie,"value",null,$e.value,de),(ye=$e.onVnodeBeforeMount)&&Zr(ye,H,T)}j&&bo(T,null,H,"beforeMount");const ge=l1(ne,B);ge&&B.beforeEnter(Ie),r(Ie,k,G),((ye=$e&&$e.onVnodeMounted)||ge||j)&&Xn(()=>{ye&&Zr(ye,H,T),ge&&B.enter(Ie),j&&bo(T,null,H,"mounted")},ne)},x=(T,k,G,H,ne)=>{if(G&&y(T,G),H)for(let de=0;de<H.length;de++)y(T,H[de]);if(ne){let de=ne.subTree;if(k===de||Cb(de.type)&&(de.ssContent===k||de.ssFallback===k)){const be=ne.vnode;x(T,be,be.scopeId,be.slotScopeIds,ne.parent)}}},b=(T,k,G,H,ne,de,be,_e,Ie=0)=>{for(let ye=Ie;ye<T.length;ye++){const $e=T[ye]=_e?bi(T[ye]):ts(T[ye]);A(null,$e,k,G,H,ne,de,be,_e)}},E=(T,k,G,H,ne,de,be)=>{const _e=k.el=T.el;let{patchFlag:Ie,dynamicChildren:ye,dirs:$e}=k;Ie|=T.patchFlag&16;const Ce=T.props||Dt,B=k.props||Dt;let j;if(G&&wo(G,!1),(j=B.onVnodeBeforeUpdate)&&Zr(j,G,k,T),$e&&bo(k,T,G,"beforeUpdate"),G&&wo(G,!0),(Ce.innerHTML&&B.innerHTML==null||Ce.textContent&&B.textContent==null)&&h(_e,""),ye?C(T.dynamicChildren,ye,_e,G,H,Rf(k,ne),de):be||ue(T,k,_e,null,G,H,Rf(k,ne),de,!1),Ie>0){if(Ie&16)O(_e,Ce,B,G,ne);else if(Ie&2&&Ce.class!==B.class&&i(_e,"class",null,B.class,ne),Ie&4&&i(_e,"style",Ce.style,B.style,ne),Ie&8){const ge=k.dynamicProps;for(let he=0;he<ge.length;he++){const ke=ge[he],He=Ce[ke],Xe=B[ke];(Xe!==He||ke==="value")&&i(_e,ke,He,Xe,ne,G)}}Ie&1&&T.children!==k.children&&h(_e,k.children)}else!be&&ye==null&&O(_e,Ce,B,G,ne);((j=B.onVnodeUpdated)||$e)&&Xn(()=>{j&&Zr(j,G,k,T),$e&&bo(k,T,G,"updated")},H)},C=(T,k,G,H,ne,de,be)=>{for(let _e=0;_e<k.length;_e++){const Ie=T[_e],ye=k[_e],$e=Ie.el&&(Ie.type===it||!Yl(Ie,ye)||Ie.shapeFlag&198)?f(Ie.el):G;A(Ie,ye,$e,null,H,ne,de,be,!0)}},O=(T,k,G,H,ne)=>{if(k!==G){if(k!==Dt)for(const de in k)!mu(de)&&!(de in G)&&i(T,de,k[de],null,ne,H);for(const de in G){if(mu(de))continue;const be=G[de],_e=k[de];be!==_e&&de!=="value"&&i(T,de,_e,be,ne,H)}"value"in G&&i(T,"value",k.value,G.value,ne)}},F=(T,k,G,H,ne,de,be,_e,Ie)=>{const ye=k.el=T?T.el:a(""),$e=k.anchor=T?T.anchor:a("");let{patchFlag:Ce,dynamicChildren:B,slotScopeIds:j}=k;j&&(_e=_e?_e.concat(j):j),T==null?(r(ye,G,H),r($e,G,H),b(k.children||[],G,$e,ne,de,be,_e,Ie)):Ce>0&&Ce&64&&B&&T.dynamicChildren?(C(T.dynamicChildren,B,G,ne,de,be,_e),(k.key!=null||ne&&k===ne.subTree)&&bm(T,k,!0)):ue(T,k,G,$e,ne,de,be,_e,Ie)},R=(T,k,G,H,ne,de,be,_e,Ie)=>{k.slotScopeIds=_e,T==null?k.shapeFlag&512?ne.ctx.activate(k,G,H,be,Ie):pt(k,G,H,ne,de,be,Ie):mt(T,k,Ie)},pt=(T,k,G,H,ne,de,be)=>{const _e=T.component=A1(T,H,ne);if(db(T)&&(_e.ctx.renderer=Ve),S1(_e,!1,be),_e.asyncDep){if(ne&&ne.registerDep(_e,we,be),!T.el){const Ie=_e.subTree=Qe(js);$(null,Ie,k,G)}}else we(_e,T,k,G,ne,de,be)},mt=(T,k,G)=>{const H=k.component=T.component;if(v1(T,k,G))if(H.asyncDep&&!H.asyncResolved){re(H,k,G);return}else H.next=k,H.update();else k.el=T.el,H.vnode=k},we=(T,k,G,H,ne,de,be)=>{const _e=()=>{if(T.isMounted){let{next:Ce,bu:B,u:j,parent:ge,vnode:he}=T;{const Ot=Ab(T);if(Ot){Ce&&(Ce.el=he.el,re(T,Ce,be)),Ot.asyncDep.then(()=>{T.isUnmounted||_e()});return}}let ke=Ce,He;wo(T,!1),Ce?(Ce.el=he.el,re(T,Ce,be)):Ce=he,B&&hd(B),(He=Ce.props&&Ce.props.onVnodeBeforeUpdate)&&Zr(He,ge,Ce,he),wo(T,!0);const Xe=Cf(T),gt=T.subTree;T.subTree=Xe,A(gt,Xe,f(gt.el),Z(gt),T,ne,de),Ce.el=Xe.el,ke===null&&y1(T,Xe.el),j&&Xn(j,ne),(He=Ce.props&&Ce.props.onVnodeUpdated)&&Xn(()=>Zr(He,ge,Ce,he),ne)}else{let Ce;const{el:B,props:j}=k,{bm:ge,m:he,parent:ke,root:He,type:Xe}=T,gt=Fa(k);if(wo(T,!1),ge&&hd(ge),!gt&&(Ce=j&&j.onVnodeBeforeMount)&&Zr(Ce,ke,k),wo(T,!0),B&&lt){const Ot=()=>{T.subTree=Cf(T),lt(B,T.subTree,T,ne,null)};gt&&Xe.__asyncHydrate?Xe.__asyncHydrate(B,T,Ot):Ot()}else{He.ce&&He.ce._def.shadowRoot!==!1&&He.ce._injectChildStyle(Xe);const Ot=T.subTree=Cf(T);A(null,Ot,G,H,T,ne,de),k.el=Ot.el}if(he&&Xn(he,ne),!gt&&(Ce=j&&j.onVnodeMounted)){const Ot=k;Xn(()=>Zr(Ce,ke,Ot),ne)}(k.shapeFlag&256||ke&&Fa(ke.vnode)&&ke.vnode.shapeFlag&256)&&T.a&&Xn(T.a,ne),T.isMounted=!0,k=G=H=null}};T.scope.on();const Ie=T.effect=new L_(_e);T.scope.off();const ye=T.update=Ie.run.bind(Ie),$e=T.job=Ie.runIfDirty.bind(Ie);$e.i=T,$e.id=T.uid,Ie.scheduler=()=>mm($e),wo(T,!0),ye()},re=(T,k,G)=>{k.component=T;const H=T.vnode.props;T.vnode=k,T.next=null,t1(T,k.props,H,G),i1(T,k.children,G),Fs(),Dv(T),Us()},ue=(T,k,G,H,ne,de,be,_e,Ie=!1)=>{const ye=T&&T.children,$e=T?T.shapeFlag:0,Ce=k.children,{patchFlag:B,shapeFlag:j}=k;if(B>0){if(B&128){Ne(ye,Ce,G,H,ne,de,be,_e,Ie);return}else if(B&256){oe(ye,Ce,G,H,ne,de,be,_e,Ie);return}}j&8?($e&16&&Vt(ye,ne,de),Ce!==ye&&h(G,Ce)):$e&16?j&16?Ne(ye,Ce,G,H,ne,de,be,_e,Ie):Vt(ye,ne,de,!0):($e&8&&h(G,""),j&16&&b(Ce,G,H,ne,de,be,_e,Ie))},oe=(T,k,G,H,ne,de,be,_e,Ie)=>{T=T||Oa,k=k||Oa;const ye=T.length,$e=k.length,Ce=Math.min(ye,$e);let B;for(B=0;B<Ce;B++){const j=k[B]=Ie?bi(k[B]):ts(k[B]);A(T[B],j,G,null,ne,de,be,_e,Ie)}ye>$e?Vt(T,ne,de,!0,!1,Ce):b(k,G,H,ne,de,be,_e,Ie,Ce)},Ne=(T,k,G,H,ne,de,be,_e,Ie)=>{let ye=0;const $e=k.length;let Ce=T.length-1,B=$e-1;for(;ye<=Ce&&ye<=B;){const j=T[ye],ge=k[ye]=Ie?bi(k[ye]):ts(k[ye]);if(Yl(j,ge))A(j,ge,G,null,ne,de,be,_e,Ie);else break;ye++}for(;ye<=Ce&&ye<=B;){const j=T[Ce],ge=k[B]=Ie?bi(k[B]):ts(k[B]);if(Yl(j,ge))A(j,ge,G,null,ne,de,be,_e,Ie);else break;Ce--,B--}if(ye>Ce){if(ye<=B){const j=B+1,ge=j<$e?k[j].el:H;for(;ye<=B;)A(null,k[ye]=Ie?bi(k[ye]):ts(k[ye]),G,ge,ne,de,be,_e,Ie),ye++}}else if(ye>B)for(;ye<=Ce;)Y(T[ye],ne,de,!0),ye++;else{const j=ye,ge=ye,he=new Map;for(ye=ge;ye<=B;ye++){const Mt=k[ye]=Ie?bi(k[ye]):ts(k[ye]);Mt.key!=null&&he.set(Mt.key,ye)}let ke,He=0;const Xe=B-ge+1;let gt=!1,Ot=0;const Ir=new Array(Xe);for(ye=0;ye<Xe;ye++)Ir[ye]=0;for(ye=j;ye<=Ce;ye++){const Mt=T[ye];if(He>=Xe){Y(Mt,ne,de,!0);continue}let qt;if(Mt.key!=null)qt=he.get(Mt.key);else for(ke=ge;ke<=B;ke++)if(Ir[ke-ge]===0&&Yl(Mt,k[ke])){qt=ke;break}qt===void 0?Y(Mt,ne,de,!0):(Ir[qt-ge]=ye+1,qt>=Ot?Ot=qt:gt=!0,A(Mt,k[qt],G,null,ne,de,be,_e,Ie),He++)}const Er=gt?u1(Ir):Oa;for(ke=Er.length-1,ye=Xe-1;ye>=0;ye--){const Mt=ge+ye,qt=k[Mt],Un=Mt+1<$e?k[Mt+1].el:H;Ir[ye]===0?A(null,qt,G,Un,ne,de,be,_e,Ie):gt&&(ke<0||ye!==Er[ke]?te(qt,G,Un,2):ke--)}}},te=(T,k,G,H,ne=null)=>{const{el:de,type:be,transition:_e,children:Ie,shapeFlag:ye}=T;if(ye&6){te(T.component.subTree,k,G,H);return}if(ye&128){T.suspense.move(k,G,H);return}if(ye&64){be.move(T,k,G,Ve);return}if(be===it){r(de,k,G);for(let Ce=0;Ce<Ie.length;Ce++)te(Ie[Ce],k,G,H);r(T.anchor,k,G);return}if(be===md){M(T,k,G);return}if(H!==2&&ye&1&&_e)if(H===0)_e.beforeEnter(de),r(de,k,G),Xn(()=>_e.enter(de),ne);else{const{leave:Ce,delayLeave:B,afterLeave:j}=_e,ge=()=>{T.ctx.isUnmounted?s(de):r(de,k,G)},he=()=>{Ce(de,()=>{ge(),j&&j()})};B?B(de,ge,he):he()}else r(de,k,G)},Y=(T,k,G,H=!1,ne=!1)=>{const{type:de,props:be,ref:_e,children:Ie,dynamicChildren:ye,shapeFlag:$e,patchFlag:Ce,dirs:B,cacheIndex:j}=T;if(Ce===-2&&(ne=!1),_e!=null&&(Fs(),_u(_e,null,G,T,!0),Us()),j!=null&&(k.renderCache[j]=void 0),$e&256){k.ctx.deactivate(T);return}const ge=$e&1&&B,he=!Fa(T);let ke;if(he&&(ke=be&&be.onVnodeBeforeUnmount)&&Zr(ke,k,T),$e&6)at(T.component,G,H);else{if($e&128){T.suspense.unmount(G,H);return}ge&&bo(T,null,k,"beforeUnmount"),$e&64?T.type.remove(T,k,G,Ve,H):ye&&!ye.hasOnce&&(de!==it||Ce>0&&Ce&64)?Vt(ye,k,G,!1,!0):(de===it&&Ce&384||!ne&&$e&16)&&Vt(Ie,k,G),H&&Te(T)}(he&&(ke=be&&be.onVnodeUnmounted)||ge)&&Xn(()=>{ke&&Zr(ke,k,T),ge&&bo(T,null,k,"unmounted")},G)},Te=T=>{const{type:k,el:G,anchor:H,transition:ne}=T;if(k===it){We(G,H);return}if(k===md){L(T);return}const de=()=>{s(G),ne&&!ne.persisted&&ne.afterLeave&&ne.afterLeave()};if(T.shapeFlag&1&&ne&&!ne.persisted){const{leave:be,delayLeave:_e}=ne,Ie=()=>be(G,de);_e?_e(T.el,de,Ie):Ie()}else de()},We=(T,k)=>{let G;for(;T!==k;)G=g(T),s(T),T=G;s(k)},at=(T,k,G)=>{const{bum:H,scope:ne,job:de,subTree:be,um:_e,m:Ie,a:ye,parent:$e,slots:{__:Ce}}=T;qv(Ie),qv(ye),H&&hd(H),$e&&ze(Ce)&&Ce.forEach(B=>{$e.renderCache[B]=void 0}),ne.stop(),de&&(de.flags|=8,Y(be,T,k,G)),_e&&Xn(_e,k),Xn(()=>{T.isUnmounted=!0},k),k&&k.pendingBranch&&!k.isUnmounted&&T.asyncDep&&!T.asyncResolved&&T.suspenseId===k.pendingId&&(k.deps--,k.deps===0&&k.resolve())},Vt=(T,k,G,H=!1,ne=!1,de=0)=>{for(let be=de;be<T.length;be++)Y(T[be],k,G,H,ne)},Z=T=>{if(T.shapeFlag&6)return Z(T.component.subTree);if(T.shapeFlag&128)return T.suspense.next();const k=g(T.anchor||T.el),G=k&&k[ob];return G?g(G):k};let Ae=!1;const xe=(T,k,G)=>{T==null?k._vnode&&Y(k._vnode,null,null,!0):A(k._vnode||null,T,k,null,null,null,G),k._vnode=T,Ae||(Ae=!0,Dv(),rb(),Ae=!1)},Ve={p:A,um:Y,m:te,r:Te,mt:pt,mc:b,pc:ue,pbc:C,n:Z,o:n};let tt,lt;return e&&([tt,lt]=e(Ve)),{render:xe,hydrate:tt,createApp:ZA(xe,tt)}}function Rf({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function wo({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function l1(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function bm(n,e,t=!1){const r=n.children,s=e.children;if(ze(r)&&ze(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=bi(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&bm(o,a)),a.type===wh&&(a.el=o.el),a.type===js&&!a.el&&(a.el=o.el)}}function u1(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<c?i=a+1:o=a;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function Ab(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Ab(e)}function qv(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const c1=Symbol.for("v-scx"),d1=()=>jr(c1);function bt(n,e,t){return Sb(n,e,t)}function Sb(n,e,t=Dt){const{immediate:r,deep:s,flush:i,once:o}=t,a=kn({},t),l=e&&r||!e&&i!=="post";let c;if(Lu){if(i==="sync"){const y=d1();c=y.__watcherHandles||(y.__watcherHandles=[])}else if(!l){const y=()=>{};return y.stop=$r,y.resume=$r,y.pause=$r,y}}const h=Gn;a.call=(y,I,A)=>ls(y,h,I,A);let f=!1;i==="post"?a.scheduler=y=>{Xn(y,h&&h.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(y,I)=>{I?y():mm(y)}),a.augmentJob=y=>{e&&(y.flags|=4),f&&(y.flags|=2,h&&(y.id=h.uid,y.i=h))};const g=TA(n,e,a);return Lu&&(c?c.push(g):l&&g()),g}function h1(n,e,t){const r=this.proxy,s=mn(n)?n.includes(".")?Pb(r,n):()=>r[n]:n.bind(r,r);let i;Ze(e)?i=e:(i=e.handler,t=e);const o=dc(this),a=Sb(s,i.bind(r),t);return o(),a}function Pb(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const f1=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Cr(e)}Modifiers`]||n[`${Qi(e)}Modifiers`];function p1(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||Dt;let s=t;const i=e.startsWith("update:"),o=i&&f1(r,e.slice(7));o&&(o.trim&&(s=t.map(h=>mn(h)?h.trim():h)),o.number&&(s=t.map(Dd)));let a,l=r[a=If(e)]||r[a=If(Cr(e))];!l&&i&&(l=r[a=If(Qi(e))]),l&&ls(l,n,6,s);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,ls(c,n,6,s)}}function Rb(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!Ze(n)){const l=c=>{const h=Rb(c,e,!0);h&&(a=!0,kn(o,h))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(Ft(n)&&r.set(n,null),null):(ze(i)?i.forEach(l=>o[l]=null):kn(o,i),Ft(n)&&r.set(n,o),o)}function bh(n,e){return!n||!hh(e)?!1:(e=e.slice(2).replace(/Once$/,""),At(n,e[0].toLowerCase()+e.slice(1))||At(n,Qi(e))||At(n,e))}function Cf(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:c,renderCache:h,props:f,data:g,setupState:y,ctx:I,inheritAttrs:A}=n,S=Md(n);let $,U;try{if(t.shapeFlag&4){const L=s||r,se=L;$=ts(c.call(se,L,h,f,y,g,I)),U=a}else{const L=e;$=ts(L.length>1?L(f,{attrs:a,slots:o,emit:l}):L(f,null)),U=e.props?a:m1(a)}}catch(L){wu.length=0,yh(L,n,1),$=Qe(js)}let M=$;if(U&&A!==!1){const L=Object.keys(U),{shapeFlag:se}=M;L.length&&se&7&&(i&&L.some(sm)&&(U=g1(U,i)),M=Wa(M,U,!1,!0))}return t.dirs&&(M=Wa(M,null,!1,!0),M.dirs=M.dirs?M.dirs.concat(t.dirs):t.dirs),t.transition&&gm(M,t.transition),$=M,Md(S),$}const m1=n=>{let e;for(const t in n)(t==="class"||t==="style"||hh(t))&&((e||(e={}))[t]=n[t]);return e},g1=(n,e)=>{const t={};for(const r in n)(!sm(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function v1(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?Bv(r,o,c):!!o;if(l&8){const h=e.dynamicProps;for(let f=0;f<h.length;f++){const g=h[f];if(o[g]!==r[g]&&!bh(c,g))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?Bv(r,o,c):!0:!!o;return!1}function Bv(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!bh(t,i))return!0}return!1}function y1({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const Cb=n=>n.__isSuspense;function _1(n,e){e&&e.pendingBranch?ze(n)?e.effects.push(...n):e.effects.push(n):PA(n)}const it=Symbol.for("v-fgt"),wh=Symbol.for("v-txt"),js=Symbol.for("v-cmt"),md=Symbol.for("v-stc"),wu=[];let wr=null;function D(n=!1){wu.push(wr=n?null:[])}function b1(){wu.pop(),wr=wu[wu.length-1]||null}let Ou=1;function zv(n,e=!1){Ou+=n,n<0&&wr&&e&&(wr.hasOnce=!0)}function kb(n){return n.dynamicChildren=Ou>0?wr||Oa:null,b1(),Ou>0&&wr&&wr.push(n),n}function V(n,e,t,r,s,i){return kb(d(n,e,t,r,s,i,!0))}function Vs(n,e,t,r,s){return kb(Qe(n,e,t,r,s,!0))}function Mu(n){return n?n.__v_isVNode===!0:!1}function Yl(n,e){return n.type===e.type&&n.key===e.key}const Db=({key:n})=>n??null,gd=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?mn(n)||Hn(n)||Ze(n)?{i:$n,r:n,k:e,f:!!t}:n:null);function d(n,e=null,t=null,r=0,s=null,i=n===it?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&Db(e),ref:e&&gd(e),scopeId:ib,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:$n};return a?(wm(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=mn(t)?8:16),Ou>0&&!o&&wr&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&wr.push(l),l}const Qe=w1;function w1(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===BA)&&(n=js),Mu(n)){const a=Wa(n,e,!0);return t&&wm(a,t),Ou>0&&!i&&wr&&(a.shapeFlag&6?wr[wr.indexOf(n)]=a:wr.push(a)),a.patchFlag=-2,a}if(D1(n)&&(n=n.__vccOpts),e){e=x1(e);let{class:a,style:l}=e;a&&!mn(a)&&(e.class=Zt(a)),Ft(l)&&(pm(l)&&!ze(l)&&(l=kn({},l)),e.style=_r(l))}const o=mn(n)?1:Cb(n)?128:CA(n)?64:Ft(n)?4:Ze(n)?2:0;return d(n,e,t,r,s,o,i,!0)}function x1(n){return n?pm(n)||bb(n)?kn({},n):n:null}function Wa(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,c=e?I1(s||{},e):s,h={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&Db(c),ref:e&&e.ref?t&&i?ze(i)?i.concat(gd(e)):[i,gd(e)]:gd(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==it?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Wa(n.ssContent),ssFallback:n.ssFallback&&Wa(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&gm(h,l.clone(h)),h}function St(n=" ",e=0){return Qe(wh,null,n,e)}function Pn(n,e){const t=Qe(md,null,n);return t.staticCount=e,t}function ce(n="",e=!1){return e?(D(),Vs(js,null,n)):Qe(js,null,n)}function ts(n){return n==null||typeof n=="boolean"?Qe(js):ze(n)?Qe(it,null,n.slice()):Mu(n)?bi(n):Qe(wh,null,String(n))}function bi(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:Wa(n)}function wm(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(ze(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),wm(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!bb(e)?e._ctx=$n:s===3&&$n&&($n.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else Ze(e)?(e={default:e,_ctx:$n},t=32):(e=String(e),r&64?(t=16,e=[St(e)]):t=8);n.children=e,n.shapeFlag|=t}function I1(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=Zt([e.class,r.class]));else if(s==="style")e.style=_r([e.style,r.style]);else if(hh(s)){const i=e[s],o=r[s];o&&i!==o&&!(ze(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function Zr(n,e,t,r=null){ls(n,e,7,[t,r])}const E1=vb();let T1=0;function A1(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||E1,i={uid:T1++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new XT(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:xb(r,s),emitsOptions:Rb(r,s),emit:null,emitted:null,propsDefaults:Dt,inheritAttrs:r.inheritAttrs,ctx:Dt,data:Dt,props:Dt,attrs:Dt,slots:Dt,refs:Dt,setupState:Dt,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=p1.bind(null,i),n.ce&&n.ce(i),i}let Gn=null,$d,mp;{const n=mh(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};$d=e("__VUE_INSTANCE_SETTERS__",t=>Gn=t),mp=e("__VUE_SSR_SETTERS__",t=>Lu=t)}const dc=n=>{const e=Gn;return $d(n),n.scope.on(),()=>{n.scope.off(),$d(e)}},Kv=()=>{Gn&&Gn.scope.off(),$d(null)};function Nb(n){return n.vnode.shapeFlag&4}let Lu=!1;function S1(n,e=!1,t=!1){e&&mp(e);const{props:r,children:s}=n.vnode,i=Nb(n);e1(n,r,i,e),s1(n,s,t||e);const o=i?P1(n,e):void 0;return e&&mp(!1),o}function P1(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,GA);const{setup:r}=t;if(r){Fs();const s=n.setupContext=r.length>1?C1(n):null,i=dc(n),o=cc(r,n,0,[n.props,s]),a=k_(o);if(Us(),i(),(a||n.sp)&&!Fa(n)&&cb(n),a){if(o.then(Kv,Kv),e)return o.then(l=>{Gv(n,l,e)}).catch(l=>{yh(l,n,0)});n.asyncDep=o}else Gv(n,o,e)}else Vb(n,e)}function Gv(n,e,t){Ze(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:Ft(e)&&(n.setupState=eb(e)),Vb(n,t)}let Hv;function Vb(n,e,t){const r=n.type;if(!n.render){if(!e&&Hv&&!r.render){const s=r.template||vm(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,c=kn(kn({isCustomElement:i,delimiters:a},o),l);r.render=Hv(s,c)}}n.render=r.render||$r}{const s=dc(n);Fs();try{HA(n)}finally{Us(),s()}}}const R1={get(n,e){return Kn(n,"get",""),n[e]}};function C1(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,R1),slots:n.slots,emit:n.emit,expose:e}}function xh(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(eb(yA(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in bu)return bu[t](n)},has(e,t){return t in e||t in bu}})):n.proxy}function k1(n,e=!0){return Ze(n)?n.displayName||n.name:n.name||e&&n.__name}function D1(n){return Ze(n)&&"__vccOpts"in n}const Fe=(n,e)=>IA(n,e,Lu);function Ob(n,e,t){const r=arguments.length;return r===2?Ft(e)&&!ze(e)?Mu(e)?Qe(n,null,[e]):Qe(n,e):Qe(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&Mu(t)&&(t=[t]),Qe(n,e,t))}const N1="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let gp;const Wv=typeof window<"u"&&window.trustedTypes;if(Wv)try{gp=Wv.createPolicy("vue",{createHTML:n=>n})}catch{}const Mb=gp?n=>gp.createHTML(n):n=>n,V1="http://www.w3.org/2000/svg",O1="http://www.w3.org/1998/Math/MathML",Ts=typeof document<"u"?document:null,Qv=Ts&&Ts.createElement("template"),M1={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?Ts.createElementNS(V1,n):e==="mathml"?Ts.createElementNS(O1,n):t?Ts.createElement(n,{is:t}):Ts.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>Ts.createTextNode(n),createComment:n=>Ts.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Ts.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{Qv.innerHTML=Mb(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=Qv.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},L1=Symbol("_vtc");function $1(n,e,t){const r=n[L1];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const Fd=Symbol("_vod"),Lb=Symbol("_vsh"),kf={beforeMount(n,{value:e},{transition:t}){n[Fd]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):Xl(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),Xl(n,!0),r.enter(n)):r.leave(n,()=>{Xl(n,!1)}):Xl(n,e))},beforeUnmount(n,{value:e}){Xl(n,e)}};function Xl(n,e){n.style.display=e?n[Fd]:"none",n[Lb]=!e}const F1=Symbol(""),U1=/(^|;)\s*display\s*:/;function j1(n,e,t){const r=n.style,s=mn(t);let i=!1;if(t&&!s){if(e)if(mn(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&vd(r,a,"")}else for(const o in e)t[o]==null&&vd(r,o,"");for(const o in t)o==="display"&&(i=!0),vd(r,o,t[o])}else if(s){if(e!==t){const o=r[F1];o&&(t+=";"+o),r.cssText=t,i=U1.test(t)}}else e&&n.removeAttribute("style");Fd in n&&(n[Fd]=i?r.display:"",n[Lb]&&(r.display="none"))}const Jv=/\s*!important$/;function vd(n,e,t){if(ze(t))t.forEach(r=>vd(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=q1(n,e);Jv.test(t)?n.setProperty(Qi(r),t.replace(Jv,""),"important"):n[r]=t}}const Yv=["Webkit","Moz","ms"],Df={};function q1(n,e){const t=Df[e];if(t)return t;let r=Cr(e);if(r!=="filter"&&r in n)return Df[e]=r;r=ph(r);for(let s=0;s<Yv.length;s++){const i=Yv[s]+r;if(i in n)return Df[e]=i}return e}const Xv="http://www.w3.org/1999/xlink";function Zv(n,e,t,r,s,i=JT(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(Xv,e.slice(6,e.length)):n.setAttributeNS(Xv,e,t):t==null||i&&!V_(t)?n.removeAttribute(e):n.setAttribute(e,i?"":qr(t)?String(t):t)}function ey(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?Mb(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=V_(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function xi(n,e,t,r){n.addEventListener(e,t,r)}function B1(n,e,t,r){n.removeEventListener(e,t,r)}const ty=Symbol("_vei");function z1(n,e,t,r,s=null){const i=n[ty]||(n[ty]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=K1(e);if(r){const c=i[e]=W1(r,s);xi(n,a,c,l)}else o&&(B1(n,a,o,l),i[e]=void 0)}}const ny=/(?:Once|Passive|Capture)$/;function K1(n){let e;if(ny.test(n)){e={};let r;for(;r=n.match(ny);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Qi(n.slice(2)),e]}let Nf=0;const G1=Promise.resolve(),H1=()=>Nf||(G1.then(()=>Nf=0),Nf=Date.now());function W1(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;ls(Q1(r,t.value),e,5,[r])};return t.value=n,t.attached=H1(),t}function Q1(n,e){if(ze(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const ry=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,J1=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?$1(n,r,o):e==="style"?j1(n,t,r):hh(e)?sm(e)||z1(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):Y1(n,e,r,o))?(ey(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Zv(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!mn(r))?ey(n,Cr(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),Zv(n,e,r,o))};function Y1(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&ry(e)&&Ze(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return ry(e)&&mn(t)?!1:e in n}const Qa=n=>{const e=n.props["onUpdate:modelValue"]||!1;return ze(e)?t=>hd(e,t):e};function X1(n){n.target.composing=!0}function sy(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Os=Symbol("_assign"),$t={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[Os]=Qa(s);const i=r||s.props&&s.props.type==="number";xi(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=Dd(a)),n[Os](a)}),t&&xi(n,"change",()=>{n.value=n.value.trim()}),e||(xi(n,"compositionstart",X1),xi(n,"compositionend",sy),xi(n,"change",sy))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[Os]=Qa(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?Dd(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},Ci={deep:!0,created(n,e,t){n[Os]=Qa(t),xi(n,"change",()=>{const r=n._modelValue,s=$u(n),i=n.checked,o=n[Os];if(ze(r)){const a=am(r,s),l=a!==-1;if(i&&!l)o(r.concat(s));else if(!i&&l){const c=[...r];c.splice(a,1),o(c)}}else if(ml(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o($b(n,i))})},mounted:iy,beforeUpdate(n,e,t){n[Os]=Qa(t),iy(n,e,t)}};function iy(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(ze(e))s=am(e,r.props.value)>-1;else if(ml(e))s=e.has(r.props.value);else{if(e===t)return;s=uc(e,$b(n,!0))}n.checked!==s&&(n.checked=s)}const Z1={deep:!0,created(n,{value:e,modifiers:{number:t}},r){const s=ml(e);xi(n,"change",()=>{const i=Array.prototype.filter.call(n.options,o=>o.selected).map(o=>t?Dd($u(o)):$u(o));n[Os](n.multiple?s?new Set(i):i:i[0]),n._assigning=!0,Ht(()=>{n._assigning=!1})}),n[Os]=Qa(r)},mounted(n,{value:e}){oy(n,e)},beforeUpdate(n,e,t){n[Os]=Qa(t)},updated(n,{value:e}){n._assigning||oy(n,e)}};function oy(n,e){const t=n.multiple,r=ze(e);if(!(t&&!r&&!ml(e))){for(let s=0,i=n.options.length;s<i;s++){const o=n.options[s],a=$u(o);if(t)if(r){const l=typeof a;l==="string"||l==="number"?o.selected=e.some(c=>String(c)===String(a)):o.selected=am(e,a)>-1}else o.selected=e.has(a);else if(uc($u(o),e)){n.selectedIndex!==s&&(n.selectedIndex=s);return}}!t&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function $u(n){return"_value"in n?n._value:n.value}function $b(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const eS=["ctrl","shift","alt","meta"],tS={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>eS.some(t=>n[`${t}Key`]&&!e.includes(t))},ct=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=tS[e[o]];if(a&&a(s,e))return}return n(s,...i)})},nS={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Bn=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=Qi(s.key);if(e.some(o=>o===i||nS[o]===i))return n(s)})},rS=kn({patchProp:J1},M1);let ay;function sS(){return ay||(ay=o1(rS))}const iS=(...n)=>{const e=sS().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=aS(r);if(!s)return;const i=e._component;!Ze(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,oS(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function oS(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function aS(n){return mn(n)?document.querySelector(n):n}const lS={key:2,class:"fixed bottom-4 right-4 z-50 rounded-full bg-green-600 text-white px-4 py-2 shadow-lg"},uS={__name:"App",setup(n){const e=P(null),t=P(!1),r=P(!1),s=P(!1);function i(c){c.preventDefault(),e.value=c,t.value=!0}async function o(){e.value&&(e.value.prompt(),await e.value.userChoice,t.value=!1,e.value=null)}function a(){t.value=!1,e.value=null}function l(){s.value=!0,"serviceWorker"in navigator&&navigator.serviceWorker.postMessage({type:"SKIP_WAITING"}),window.location.reload()}return yn(()=>{window.addEventListener("beforeinstallprompt",i),window.addEventListener("appinstalled",a),"serviceWorker"in navigator&&(navigator.serviceWorker.addEventListener("controllerchange",()=>{s.value||(r.value=!0)}),setInterval(()=>{navigator.serviceWorker.getRegistration().then(c=>{c&&c.update()})},60*60*1e3))}),fb(()=>{window.removeEventListener("beforeinstallprompt",i),window.removeEventListener("appinstalled",a)}),(c,h)=>{const f=qA("router-view");return D(),V(it,null,[Qe(f),t.value?(D(),V("button",{key:0,class:"fixed bottom-4 right-4 z-50 rounded-full bg-sky-600 text-white px-4 py-2 shadow-lg hover:bg-sky-700 active:bg-sky-800",onClick:o}," Installer l’app ")):ce("",!0),r.value&&!s.value?(D(),V("button",{key:1,class:"fixed bottom-4 right-4 z-50 rounded-full bg-green-600 text-white px-4 py-2 shadow-lg hover:bg-green-700 active:bg-green-800",onClick:l}," 🔄 Mettre à jour ")):ce("",!0),s.value?(D(),V("div",lS," 🔄 Mise à jour... ")):ce("",!0)],64)}}};/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const Ra=typeof document<"u";function Fb(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function cS(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&Fb(n.default)}const Et=Object.assign;function Vf(n,e){const t={};for(const r in e){const s=e[r];t[r]=Br(s)?s.map(n):n(s)}return t}const xu=()=>{},Br=Array.isArray,Ub=/#/g,dS=/&/g,hS=/\//g,fS=/=/g,pS=/\?/g,jb=/\+/g,mS=/%5B/g,gS=/%5D/g,qb=/%5E/g,vS=/%60/g,Bb=/%7B/g,yS=/%7C/g,zb=/%7D/g,_S=/%20/g;function xm(n){return encodeURI(""+n).replace(yS,"|").replace(mS,"[").replace(gS,"]")}function bS(n){return xm(n).replace(Bb,"{").replace(zb,"}").replace(qb,"^")}function vp(n){return xm(n).replace(jb,"%2B").replace(_S,"+").replace(Ub,"%23").replace(dS,"%26").replace(vS,"`").replace(Bb,"{").replace(zb,"}").replace(qb,"^")}function wS(n){return vp(n).replace(fS,"%3D")}function xS(n){return xm(n).replace(Ub,"%23").replace(pS,"%3F")}function IS(n){return n==null?"":xS(n).replace(hS,"%2F")}function Fu(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const ES=/\/$/,TS=n=>n.replace(ES,"");function Of(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=RS(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:Fu(o)}}function AS(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function ly(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function SS(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&Ja(e.matched[r],t.matched[s])&&Kb(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function Ja(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function Kb(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!PS(n[t],e[t]))return!1;return!0}function PS(n,e){return Br(n)?uy(n,e):Br(e)?uy(e,n):n===e}function uy(n,e){return Br(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function RS(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const mi={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Uu;(function(n){n.pop="pop",n.push="push"})(Uu||(Uu={}));var Iu;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Iu||(Iu={}));function CS(n){if(!n)if(Ra){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),TS(n)}const kS=/^[^#]+#/;function DS(n,e){return n.replace(kS,"#")+e}function NS(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const Ih=()=>({left:window.scrollX,top:window.scrollY});function VS(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=NS(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function cy(n,e){return(history.state?history.state.position-e:-1)+n}const yp=new Map;function OS(n,e){yp.set(n,e)}function MS(n){const e=yp.get(n);return yp.delete(n),e}let LS=()=>location.protocol+"//"+location.host;function Gb(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),ly(l,"")}return ly(t,n)+r+s}function $S(n,e,t,r){let s=[],i=[],o=null;const a=({state:g})=>{const y=Gb(n,location),I=t.value,A=e.value;let S=0;if(g){if(t.value=y,e.value=g,o&&o===I){o=null;return}S=A?g.position-A.position:0}else r(y);s.forEach($=>{$(t.value,I,{delta:S,type:Uu.pop,direction:S?S>0?Iu.forward:Iu.back:Iu.unknown})})};function l(){o=t.value}function c(g){s.push(g);const y=()=>{const I=s.indexOf(g);I>-1&&s.splice(I,1)};return i.push(y),y}function h(){const{history:g}=window;g.state&&g.replaceState(Et({},g.state,{scroll:Ih()}),"")}function f(){for(const g of i)g();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",h)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",h,{passive:!0}),{pauseListeners:l,listen:c,destroy:f}}function dy(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?Ih():null}}function FS(n){const{history:e,location:t}=window,r={value:Gb(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,c,h){const f=n.indexOf("#"),g=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:LS()+n+l;try{e[h?"replaceState":"pushState"](c,"",g),s.value=c}catch(y){console.error(y),t[h?"replace":"assign"](g)}}function o(l,c){const h=Et({},e.state,dy(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});i(l,h,!0),r.value=l}function a(l,c){const h=Et({},s.value,e.state,{forward:l,scroll:Ih()});i(h.current,h,!0);const f=Et({},dy(r.value,l,null),{position:h.position+1},c);i(l,f,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function US(n){n=CS(n);const e=FS(n),t=$S(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=Et({location:"",base:n,go:r,createHref:DS.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function jS(n){return typeof n=="string"||n&&typeof n=="object"}function Hb(n){return typeof n=="string"||typeof n=="symbol"}const Wb=Symbol("");var hy;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(hy||(hy={}));function Ya(n,e){return Et(new Error,{type:n,[Wb]:!0},e)}function Es(n,e){return n instanceof Error&&Wb in n&&(e==null||!!(n.type&e))}const fy="[^/]+?",qS={sensitive:!1,strict:!1,start:!0,end:!0},BS=/[.+*?^${}()[\]/\\]/g;function zS(n,e){const t=Et({},qS,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const h=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let f=0;f<c.length;f++){const g=c[f];let y=40+(t.sensitive?.25:0);if(g.type===0)f||(s+="/"),s+=g.value.replace(BS,"\\$&"),y+=40;else if(g.type===1){const{value:I,repeatable:A,optional:S,regexp:$}=g;i.push({name:I,repeatable:A,optional:S});const U=$||fy;if(U!==fy){y+=10;try{new RegExp(`(${U})`)}catch(L){throw new Error(`Invalid custom RegExp for param "${I}" (${U}): `+L.message)}}let M=A?`((?:${U})(?:/(?:${U}))*)`:`(${U})`;f||(M=S&&c.length<2?`(?:/${M})`:"/"+M),S&&(M+="?"),s+=M,y+=20,S&&(y+=-8),A&&(y+=-20),U===".*"&&(y+=-50)}h.push(y)}r.push(h)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const h=c.match(o),f={};if(!h)return null;for(let g=1;g<h.length;g++){const y=h[g]||"",I=i[g-1];f[I.name]=y&&I.repeatable?y.split("/"):y}return f}function l(c){let h="",f=!1;for(const g of n){(!f||!h.endsWith("/"))&&(h+="/"),f=!1;for(const y of g)if(y.type===0)h+=y.value;else if(y.type===1){const{value:I,repeatable:A,optional:S}=y,$=I in c?c[I]:"";if(Br($)&&!A)throw new Error(`Provided param "${I}" is an array but it is not repeatable (* or + modifiers)`);const U=Br($)?$.join("/"):$;if(!U)if(S)g.length<2&&(h.endsWith("/")?h=h.slice(0,-1):f=!0);else throw new Error(`Missing required param "${I}"`);h+=U}}return h||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function KS(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function Qb(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=KS(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(py(r))return 1;if(py(s))return-1}return s.length-r.length}function py(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const GS={type:0,value:""},HS=/[a-zA-Z0-9_]/;function WS(n){if(!n)return[[]];if(n==="/")return[[GS]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(y){throw new Error(`ERR (${t})/"${c}": ${y}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,c="",h="";function f(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:h,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function g(){c+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(c&&f(),o()):l===":"?(f(),t=1):g();break;case 4:g(),t=r;break;case 1:l==="("?t=2:HS.test(l)?g():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?h[h.length-1]=="\\"?h=h.slice(0,-1)+l:t=3:h+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,h="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),f(),o(),s}function QS(n,e,t){const r=zS(WS(n.path),t),s=Et(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function JS(n,e){const t=[],r=new Map;e=yy({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,g,y){const I=!y,A=gy(f);A.aliasOf=y&&y.record;const S=yy(e,f),$=[A];if("alias"in f){const L=typeof f.alias=="string"?[f.alias]:f.alias;for(const se of L)$.push(gy(Et({},A,{components:y?y.record.components:A.components,path:se,aliasOf:y?y.record:A})))}let U,M;for(const L of $){const{path:se}=L;if(g&&se[0]!=="/"){const Q=g.record.path,x=Q[Q.length-1]==="/"?"":"/";L.path=g.record.path+(se&&x+se)}if(U=QS(L,g,S),y?y.alias.push(U):(M=M||U,M!==U&&M.alias.push(U),I&&f.name&&!vy(U)&&o(f.name)),Jb(U)&&l(U),A.children){const Q=A.children;for(let x=0;x<Q.length;x++)i(Q[x],U,y&&y.children[x])}y=y||U}return M?()=>{o(M)}:xu}function o(f){if(Hb(f)){const g=r.get(f);g&&(r.delete(f),t.splice(t.indexOf(g),1),g.children.forEach(o),g.alias.forEach(o))}else{const g=t.indexOf(f);g>-1&&(t.splice(g,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function l(f){const g=ZS(f,t);t.splice(g,0,f),f.record.name&&!vy(f)&&r.set(f.record.name,f)}function c(f,g){let y,I={},A,S;if("name"in f&&f.name){if(y=r.get(f.name),!y)throw Ya(1,{location:f});S=y.record.name,I=Et(my(g.params,y.keys.filter(M=>!M.optional).concat(y.parent?y.parent.keys.filter(M=>M.optional):[]).map(M=>M.name)),f.params&&my(f.params,y.keys.map(M=>M.name))),A=y.stringify(I)}else if(f.path!=null)A=f.path,y=t.find(M=>M.re.test(A)),y&&(I=y.parse(A),S=y.record.name);else{if(y=g.name?r.get(g.name):t.find(M=>M.re.test(g.path)),!y)throw Ya(1,{location:f,currentLocation:g});S=y.record.name,I=Et({},g.params,f.params),A=y.stringify(I)}const $=[];let U=y;for(;U;)$.unshift(U.record),U=U.parent;return{name:S,path:A,params:I,matched:$,meta:XS($)}}n.forEach(f=>i(f));function h(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:o,clearRoutes:h,getRoutes:a,getRecordMatcher:s}}function my(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function gy(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:YS(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function YS(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function vy(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function XS(n){return n.reduce((e,t)=>Et(e,t.meta),{})}function yy(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function ZS(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;Qb(n,e[i])<0?r=i:t=i+1}const s=eP(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function eP(n){let e=n;for(;e=e.parent;)if(Jb(e)&&Qb(n,e)===0)return e}function Jb({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function tP(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(jb," "),o=i.indexOf("="),a=Fu(o<0?i:i.slice(0,o)),l=o<0?null:Fu(i.slice(o+1));if(a in e){let c=e[a];Br(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function _y(n){let e="";for(let t in n){const r=n[t];if(t=wS(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(Br(r)?r.map(i=>i&&vp(i)):[r&&vp(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function nP(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=Br(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const rP=Symbol(""),by=Symbol(""),Eh=Symbol(""),Im=Symbol(""),_p=Symbol("");function Zl(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function wi(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const c=g=>{g===!1?l(Ya(4,{from:t,to:e})):g instanceof Error?l(g):jS(g)?l(Ya(2,{from:e,to:g})):(o&&r.enterCallbacks[s]===o&&typeof g=="function"&&o.push(g),a())},h=i(()=>n.call(r&&r.instances[s],e,t,c));let f=Promise.resolve(h);n.length<3&&(f=f.then(c)),f.catch(g=>l(g))})}function Mf(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(Fb(l)){const h=(l.__vccOpts||l)[e];h&&i.push(wi(h,t,r,o,a,s))}else{let c=l();i.push(()=>c.then(h=>{if(!h)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=cS(h)?h.default:h;o.mods[a]=h,o.components[a]=f;const y=(f.__vccOpts||f)[e];return y&&wi(y,t,r,o,a,s)()}))}}return i}function wy(n){const e=jr(Eh),t=jr(Im),r=Fe(()=>{const l=Ur(n.to);return e.resolve(l)}),s=Fe(()=>{const{matched:l}=r.value,{length:c}=l,h=l[c-1],f=t.matched;if(!h||!f.length)return-1;const g=f.findIndex(Ja.bind(null,h));if(g>-1)return g;const y=xy(l[c-2]);return c>1&&xy(h)===y&&f[f.length-1].path!==y?f.findIndex(Ja.bind(null,l[c-2])):g}),i=Fe(()=>s.value>-1&&lP(t.params,r.value.params)),o=Fe(()=>s.value>-1&&s.value===t.matched.length-1&&Kb(t.params,r.value.params));function a(l={}){if(aP(l)){const c=e[Ur(n.replace)?"replace":"push"](Ur(n.to)).catch(xu);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:Fe(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function sP(n){return n.length===1?n[0]:n}const iP=ub({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:wy,setup(n,{slots:e}){const t=vh(wy(n)),{options:r}=jr(Eh),s=Fe(()=>({[Iy(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[Iy(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&sP(e.default(t));return n.custom?i:Ob("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),oP=iP;function aP(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function lP(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!Br(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function xy(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const Iy=(n,e,t)=>n??e??t,uP=ub({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=jr(_p),s=Fe(()=>n.route||r.value),i=jr(by,0),o=Fe(()=>{let c=Ur(i);const{matched:h}=s.value;let f;for(;(f=h[c])&&!f.components;)c++;return c}),a=Fe(()=>s.value.matched[o.value]);pd(by,Fe(()=>o.value+1)),pd(rP,a),pd(_p,s);const l=P();return bt(()=>[l.value,a.value,n.name],([c,h,f],[g,y,I])=>{h&&(h.instances[f]=c,y&&y!==h&&c&&c===g&&(h.leaveGuards.size||(h.leaveGuards=y.leaveGuards),h.updateGuards.size||(h.updateGuards=y.updateGuards))),c&&h&&(!y||!Ja(h,y)||!g)&&(h.enterCallbacks[f]||[]).forEach(A=>A(c))},{flush:"post"}),()=>{const c=s.value,h=n.name,f=a.value,g=f&&f.components[h];if(!g)return Ey(t.default,{Component:g,route:c});const y=f.props[h],I=y?y===!0?c.params:typeof y=="function"?y(c):y:null,S=Ob(g,Et({},I,e,{onVnodeUnmounted:$=>{$.component.isUnmounted&&(f.instances[h]=null)},ref:l}));return Ey(t.default,{Component:S,route:c})||S}}});function Ey(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const cP=uP;function dP(n){const e=JS(n.routes,n),t=n.parseQuery||tP,r=n.stringifyQuery||_y,s=n.history,i=Zl(),o=Zl(),a=Zl(),l=_A(mi);let c=mi;Ra&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const h=Vf.bind(null,Z=>""+Z),f=Vf.bind(null,IS),g=Vf.bind(null,Fu);function y(Z,Ae){let xe,Ve;return Hb(Z)?(xe=e.getRecordMatcher(Z),Ve=Ae):Ve=Z,e.addRoute(Ve,xe)}function I(Z){const Ae=e.getRecordMatcher(Z);Ae&&e.removeRoute(Ae)}function A(){return e.getRoutes().map(Z=>Z.record)}function S(Z){return!!e.getRecordMatcher(Z)}function $(Z,Ae){if(Ae=Et({},Ae||l.value),typeof Z=="string"){const k=Of(t,Z,Ae.path),G=e.resolve({path:k.path},Ae),H=s.createHref(k.fullPath);return Et(k,G,{params:g(G.params),hash:Fu(k.hash),redirectedFrom:void 0,href:H})}let xe;if(Z.path!=null)xe=Et({},Z,{path:Of(t,Z.path,Ae.path).path});else{const k=Et({},Z.params);for(const G in k)k[G]==null&&delete k[G];xe=Et({},Z,{params:f(k)}),Ae.params=f(Ae.params)}const Ve=e.resolve(xe,Ae),tt=Z.hash||"";Ve.params=h(g(Ve.params));const lt=AS(r,Et({},Z,{hash:bS(tt),path:Ve.path})),T=s.createHref(lt);return Et({fullPath:lt,hash:tt,query:r===_y?nP(Z.query):Z.query||{}},Ve,{redirectedFrom:void 0,href:T})}function U(Z){return typeof Z=="string"?Of(t,Z,l.value.path):Et({},Z)}function M(Z,Ae){if(c!==Z)return Ya(8,{from:Ae,to:Z})}function L(Z){return x(Z)}function se(Z){return L(Et(U(Z),{replace:!0}))}function Q(Z){const Ae=Z.matched[Z.matched.length-1];if(Ae&&Ae.redirect){const{redirect:xe}=Ae;let Ve=typeof xe=="function"?xe(Z):xe;return typeof Ve=="string"&&(Ve=Ve.includes("?")||Ve.includes("#")?Ve=U(Ve):{path:Ve},Ve.params={}),Et({query:Z.query,hash:Z.hash,params:Ve.path!=null?{}:Z.params},Ve)}}function x(Z,Ae){const xe=c=$(Z),Ve=l.value,tt=Z.state,lt=Z.force,T=Z.replace===!0,k=Q(xe);if(k)return x(Et(U(k),{state:typeof k=="object"?Et({},tt,k.state):tt,force:lt,replace:T}),Ae||xe);const G=xe;G.redirectedFrom=Ae;let H;return!lt&&SS(r,Ve,xe)&&(H=Ya(16,{to:G,from:Ve}),te(Ve,Ve,!0,!1)),(H?Promise.resolve(H):C(G,Ve)).catch(ne=>Es(ne)?Es(ne,2)?ne:Ne(ne):ue(ne,G,Ve)).then(ne=>{if(ne){if(Es(ne,2))return x(Et({replace:T},U(ne.to),{state:typeof ne.to=="object"?Et({},tt,ne.to.state):tt,force:lt}),Ae||G)}else ne=F(G,Ve,!0,T,tt);return O(G,Ve,ne),ne})}function b(Z,Ae){const xe=M(Z,Ae);return xe?Promise.reject(xe):Promise.resolve()}function E(Z){const Ae=We.values().next().value;return Ae&&typeof Ae.runWithContext=="function"?Ae.runWithContext(Z):Z()}function C(Z,Ae){let xe;const[Ve,tt,lt]=hP(Z,Ae);xe=Mf(Ve.reverse(),"beforeRouteLeave",Z,Ae);for(const k of Ve)k.leaveGuards.forEach(G=>{xe.push(wi(G,Z,Ae))});const T=b.bind(null,Z,Ae);return xe.push(T),Vt(xe).then(()=>{xe=[];for(const k of i.list())xe.push(wi(k,Z,Ae));return xe.push(T),Vt(xe)}).then(()=>{xe=Mf(tt,"beforeRouteUpdate",Z,Ae);for(const k of tt)k.updateGuards.forEach(G=>{xe.push(wi(G,Z,Ae))});return xe.push(T),Vt(xe)}).then(()=>{xe=[];for(const k of lt)if(k.beforeEnter)if(Br(k.beforeEnter))for(const G of k.beforeEnter)xe.push(wi(G,Z,Ae));else xe.push(wi(k.beforeEnter,Z,Ae));return xe.push(T),Vt(xe)}).then(()=>(Z.matched.forEach(k=>k.enterCallbacks={}),xe=Mf(lt,"beforeRouteEnter",Z,Ae,E),xe.push(T),Vt(xe))).then(()=>{xe=[];for(const k of o.list())xe.push(wi(k,Z,Ae));return xe.push(T),Vt(xe)}).catch(k=>Es(k,8)?k:Promise.reject(k))}function O(Z,Ae,xe){a.list().forEach(Ve=>E(()=>Ve(Z,Ae,xe)))}function F(Z,Ae,xe,Ve,tt){const lt=M(Z,Ae);if(lt)return lt;const T=Ae===mi,k=Ra?history.state:{};xe&&(Ve||T?s.replace(Z.fullPath,Et({scroll:T&&k&&k.scroll},tt)):s.push(Z.fullPath,tt)),l.value=Z,te(Z,Ae,xe,T),Ne()}let R;function pt(){R||(R=s.listen((Z,Ae,xe)=>{if(!at.listening)return;const Ve=$(Z),tt=Q(Ve);if(tt){x(Et(tt,{replace:!0,force:!0}),Ve).catch(xu);return}c=Ve;const lt=l.value;Ra&&OS(cy(lt.fullPath,xe.delta),Ih()),C(Ve,lt).catch(T=>Es(T,12)?T:Es(T,2)?(x(Et(U(T.to),{force:!0}),Ve).then(k=>{Es(k,20)&&!xe.delta&&xe.type===Uu.pop&&s.go(-1,!1)}).catch(xu),Promise.reject()):(xe.delta&&s.go(-xe.delta,!1),ue(T,Ve,lt))).then(T=>{T=T||F(Ve,lt,!1),T&&(xe.delta&&!Es(T,8)?s.go(-xe.delta,!1):xe.type===Uu.pop&&Es(T,20)&&s.go(-1,!1)),O(Ve,lt,T)}).catch(xu)}))}let mt=Zl(),we=Zl(),re;function ue(Z,Ae,xe){Ne(Z);const Ve=we.list();return Ve.length?Ve.forEach(tt=>tt(Z,Ae,xe)):console.error(Z),Promise.reject(Z)}function oe(){return re&&l.value!==mi?Promise.resolve():new Promise((Z,Ae)=>{mt.add([Z,Ae])})}function Ne(Z){return re||(re=!Z,pt(),mt.list().forEach(([Ae,xe])=>Z?xe(Z):Ae()),mt.reset()),Z}function te(Z,Ae,xe,Ve){const{scrollBehavior:tt}=n;if(!Ra||!tt)return Promise.resolve();const lt=!xe&&MS(cy(Z.fullPath,0))||(Ve||!xe)&&history.state&&history.state.scroll||null;return Ht().then(()=>tt(Z,Ae,lt)).then(T=>T&&VS(T)).catch(T=>ue(T,Z,Ae))}const Y=Z=>s.go(Z);let Te;const We=new Set,at={currentRoute:l,listening:!0,addRoute:y,removeRoute:I,clearRoutes:e.clearRoutes,hasRoute:S,getRoutes:A,resolve:$,options:n,push:L,replace:se,go:Y,back:()=>Y(-1),forward:()=>Y(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:we.add,isReady:oe,install(Z){const Ae=this;Z.component("RouterLink",oP),Z.component("RouterView",cP),Z.config.globalProperties.$router=Ae,Object.defineProperty(Z.config.globalProperties,"$route",{enumerable:!0,get:()=>Ur(l)}),Ra&&!Te&&l.value===mi&&(Te=!0,L(s.location).catch(tt=>{}));const xe={};for(const tt in mi)Object.defineProperty(xe,tt,{get:()=>l.value[tt],enumerable:!0});Z.provide(Eh,Ae),Z.provide(Im,Y_(xe)),Z.provide(_p,l);const Ve=Z.unmount;We.add(Z),Z.unmount=function(){We.delete(Z),We.size<1&&(c=mi,R&&R(),R=null,l.value=mi,Te=!1,re=!1),Ve()}}};function Vt(Z){return Z.reduce((Ae,xe)=>Ae.then(()=>E(xe)),Promise.resolve())}return at}function hP(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(c=>Ja(c,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>Ja(c,l))||s.push(l))}return[t,r,s]}function gl(){return jr(Eh)}function Xo(n){return jr(Im)}const fP="modulepreload",pP=function(n){return"/"+n},Ty={},en=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=pP(i),i in Ty)return;Ty[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const f=s[h];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":fP,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((h,f)=>{c.addEventListener("load",h),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};function mP(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:r,onRegistered:s,onRegisteredSW:i,onRegisterError:o}=n;let a,l;const c=async(f=!0)=>{await l};async function h(){if("serviceWorker"in navigator){const{Workbox:f}=await en(()=>import("./workbox-window.prod.es5-5ffdab76.js"),[]);a=new f("/service-worker.js",{scope:"/",type:"classic"}),a.addEventListener("activated",g=>{(g.isUpdate||g.isExternal)&&window.location.reload()}),a.addEventListener("installed",g=>{g.isUpdate||r==null||r()}),a.register({immediate:e}).then(g=>{i?i("/service-worker.js",g):s==null||s(g)}).catch(g=>{o==null||o(g)})}}return l=h(),c}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yb=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},gP=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},Xb={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let g=(a&15)<<2|c>>6,y=c&63;l||(y=64,o||(g=64)),r.push(t[h],t[f],t[g],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Yb(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):gP(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||f==null)throw new vP;const g=i<<2|a>>4;if(r.push(g),c!==64){const y=a<<4&240|c>>2;if(r.push(y),f!==64){const I=c<<6&192|f;r.push(I)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class vP extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const yP=function(n){const e=Yb(n);return Xb.encodeByteArray(e,!0)},Ud=function(n){return yP(n).replace(/\./g,"")},Zb=function(n){try{return Xb.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _P(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bP=()=>_P().__FIREBASE_DEFAULTS__,wP=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},xP=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Zb(n[1]);return e&&JSON.parse(e)},Th=()=>{try{return bP()||wP()||xP()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},ew=n=>{var e,t;return(t=(e=Th())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},IP=n=>{const e=ew(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},tw=()=>{var n;return(n=Th())===null||n===void 0?void 0:n.config},nw=n=>{var e;return(e=Th())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EP{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TP(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[Ud(JSON.stringify(t)),Ud(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function AP(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(wn())}function SP(){var n;const e=(n=Th())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function PP(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function RP(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function CP(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function kP(){const n=wn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function rw(){return!SP()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Em(){try{return typeof indexedDB=="object"}catch{return!1}}function sw(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}function DP(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NP="FirebaseError";class ds extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=NP,Object.setPrototypeOf(this,ds.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Zo.prototype.create)}}class Zo{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?VP(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new ds(s,a,r)}}function VP(n,e){return n.replace(OP,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const OP=/\{\$([^}]+)}/g;function MP(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ui(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(Ay(i)&&Ay(o)){if(!Ui(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Ay(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vl(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function lu(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function uu(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function LP(n,e){const t=new $P(n,e);return t.subscribe.bind(t)}class $P{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");FP(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Lf),s.error===void 0&&(s.error=Lf),s.complete===void 0&&(s.complete=Lf);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function FP(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Lf(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function je(n){return n&&n._delegate?n._delegate:n}class zr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eo="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UP{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new EP;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(qP(e))try{this.getOrInitializeService({instanceIdentifier:Eo})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Eo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Eo){return this.instances.has(e)}getOptions(e=Eo){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:jP(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Eo){return this.component?this.component.multipleInstances?e:Eo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function jP(n){return n===Eo?void 0:n}function qP(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BP{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new UP(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var dt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(dt||(dt={}));const zP={debug:dt.DEBUG,verbose:dt.VERBOSE,info:dt.INFO,warn:dt.WARN,error:dt.ERROR,silent:dt.SILENT},KP=dt.INFO,GP={[dt.DEBUG]:"log",[dt.VERBOSE]:"log",[dt.INFO]:"info",[dt.WARN]:"warn",[dt.ERROR]:"error"},HP=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=GP[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Tm{constructor(e){this.name=e,this._logLevel=KP,this._logHandler=HP,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in dt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?zP[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,dt.DEBUG,...e),this._logHandler(this,dt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,dt.VERBOSE,...e),this._logHandler(this,dt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,dt.INFO,...e),this._logHandler(this,dt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,dt.WARN,...e),this._logHandler(this,dt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,dt.ERROR,...e),this._logHandler(this,dt.ERROR,...e)}}const WP=(n,e)=>e.some(t=>n instanceof t);let Sy,Py;function QP(){return Sy||(Sy=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function JP(){return Py||(Py=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const iw=new WeakMap,bp=new WeakMap,ow=new WeakMap,$f=new WeakMap,Am=new WeakMap;function YP(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Ms(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&iw.set(t,n)}).catch(()=>{}),Am.set(e,n),e}function XP(n){if(bp.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});bp.set(n,e)}let wp={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return bp.get(n);if(e==="objectStoreNames")return n.objectStoreNames||ow.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ms(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function ZP(n){wp=n(wp)}function eR(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Ff(this),e,...t);return ow.set(r,e.sort?e.sort():[e]),Ms(r)}:JP().includes(n)?function(...e){return n.apply(Ff(this),e),Ms(iw.get(this))}:function(...e){return Ms(n.apply(Ff(this),e))}}function tR(n){return typeof n=="function"?eR(n):(n instanceof IDBTransaction&&XP(n),WP(n,QP())?new Proxy(n,wp):n)}function Ms(n){if(n instanceof IDBRequest)return YP(n);if($f.has(n))return $f.get(n);const e=tR(n);return e!==n&&($f.set(n,e),Am.set(e,n)),e}const Ff=n=>Am.get(n);function Ah(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=Ms(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Ms(o.result),l.oldVersion,l.newVersion,Ms(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function Uf(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),Ms(t).then(()=>{})}const nR=["get","getKey","getAll","getAllKeys","count"],rR=["put","add","delete","clear"],jf=new Map;function Ry(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(jf.get(e))return jf.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=rR.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||nR.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return jf.set(e,i),i}ZP(n=>({...n,get:(e,t,r)=>Ry(e,t)||n.get(e,t,r),has:(e,t)=>!!Ry(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sR{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(iR(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function iR(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const xp="@firebase/app",Cy="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qs=new Tm("@firebase/app"),oR="@firebase/app-compat",aR="@firebase/analytics-compat",lR="@firebase/analytics",uR="@firebase/app-check-compat",cR="@firebase/app-check",dR="@firebase/auth",hR="@firebase/auth-compat",fR="@firebase/database",pR="@firebase/data-connect",mR="@firebase/database-compat",gR="@firebase/functions",vR="@firebase/functions-compat",yR="@firebase/installations",_R="@firebase/installations-compat",bR="@firebase/messaging",wR="@firebase/messaging-compat",xR="@firebase/performance",IR="@firebase/performance-compat",ER="@firebase/remote-config",TR="@firebase/remote-config-compat",AR="@firebase/storage",SR="@firebase/storage-compat",PR="@firebase/firestore",RR="@firebase/vertexai-preview",CR="@firebase/firestore-compat",kR="firebase",DR="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jd="[DEFAULT]",NR={[xp]:"fire-core",[oR]:"fire-core-compat",[lR]:"fire-analytics",[aR]:"fire-analytics-compat",[cR]:"fire-app-check",[uR]:"fire-app-check-compat",[dR]:"fire-auth",[hR]:"fire-auth-compat",[fR]:"fire-rtdb",[pR]:"fire-data-connect",[mR]:"fire-rtdb-compat",[gR]:"fire-fn",[vR]:"fire-fn-compat",[yR]:"fire-iid",[_R]:"fire-iid-compat",[bR]:"fire-fcm",[wR]:"fire-fcm-compat",[xR]:"fire-perf",[IR]:"fire-perf-compat",[ER]:"fire-rc",[TR]:"fire-rc-compat",[AR]:"fire-gcs",[SR]:"fire-gcs-compat",[PR]:"fire-fst",[CR]:"fire-fst-compat",[RR]:"fire-vertex","fire-js":"fire-js",[kR]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qd=new Map,VR=new Map,Ip=new Map;function ky(n,e){try{n.container.addComponent(e)}catch(t){qs.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function us(n){const e=n.name;if(Ip.has(e))return qs.debug(`There were multiple attempts to register component ${e}.`),!1;Ip.set(e,n);for(const t of qd.values())ky(t,n);for(const t of VR.values())ky(t,n);return!0}function Ji(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function OR(n,e,t=jd){Ji(n,e).clearInstance(t)}function hn(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MR={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Oi=new Zo("app","Firebase",MR);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LR{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new zr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Oi.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yl=DR;function aw(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:jd,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Oi.create("bad-app-name",{appName:String(s)});if(t||(t=tw()),!t)throw Oi.create("no-options");const i=qd.get(s);if(i){if(Ui(t,i.options)&&Ui(r,i.config))return i;throw Oi.create("duplicate-app",{appName:s})}const o=new BP(s);for(const l of Ip.values())o.addComponent(l);const a=new LR(t,r,o);return qd.set(s,a),a}function Sm(n=jd){const e=qd.get(n);if(!e&&n===jd&&tw())return aw();if(!e)throw Oi.create("no-app",{appName:n});return e}function Rr(n,e,t){var r;let s=(r=NR[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),qs.warn(a.join(" "));return}us(new zr(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $R="firebase-heartbeat-database",FR=1,ju="firebase-heartbeat-store";let qf=null;function lw(){return qf||(qf=Ah($R,FR,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(ju)}catch(t){console.warn(t)}}}}).catch(n=>{throw Oi.create("idb-open",{originalErrorMessage:n.message})})),qf}async function UR(n){try{const t=(await lw()).transaction(ju),r=await t.objectStore(ju).get(uw(n));return await t.done,r}catch(e){if(e instanceof ds)qs.warn(e.message);else{const t=Oi.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});qs.warn(t.message)}}}async function Dy(n,e){try{const r=(await lw()).transaction(ju,"readwrite");await r.objectStore(ju).put(e,uw(n)),await r.done}catch(t){if(t instanceof ds)qs.warn(t.message);else{const r=Oi.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});qs.warn(r.message)}}}function uw(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jR=1024,qR=30*24*60*60*1e3;class BR{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new KR(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Ny();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=qR}),this._storage.overwrite(this._heartbeatsCache))}catch(r){qs.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Ny(),{heartbeatsToSend:r,unsentEntries:s}=zR(this._heartbeatsCache.heartbeats),i=Ud(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return qs.warn(t),""}}}function Ny(){return new Date().toISOString().substring(0,10)}function zR(n,e=jR){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),Vy(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Vy(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class KR{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Em()?sw().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await UR(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Dy(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Dy(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Vy(n){return Ud(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GR(n){us(new zr("platform-logger",e=>new sR(e),"PRIVATE")),us(new zr("heartbeat",e=>new BR(e),"PRIVATE")),Rr(xp,Cy,n),Rr(xp,Cy,"esm2017"),Rr("fire-js","")}GR("");var HR="firebase",WR="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Rr(HR,WR,"app");var Oy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Mo,cw;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(x,b){function E(){}E.prototype=b.prototype,x.D=b.prototype,x.prototype=new E,x.prototype.constructor=x,x.C=function(C,O,F){for(var R=Array(arguments.length-2),pt=2;pt<arguments.length;pt++)R[pt-2]=arguments[pt];return b.prototype[O].apply(C,R)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(x,b,E){E||(E=0);var C=Array(16);if(typeof b=="string")for(var O=0;16>O;++O)C[O]=b.charCodeAt(E++)|b.charCodeAt(E++)<<8|b.charCodeAt(E++)<<16|b.charCodeAt(E++)<<24;else for(O=0;16>O;++O)C[O]=b[E++]|b[E++]<<8|b[E++]<<16|b[E++]<<24;b=x.g[0],E=x.g[1],O=x.g[2];var F=x.g[3],R=b+(F^E&(O^F))+C[0]+3614090360&4294967295;b=E+(R<<7&4294967295|R>>>25),R=F+(O^b&(E^O))+C[1]+3905402710&4294967295,F=b+(R<<12&4294967295|R>>>20),R=O+(E^F&(b^E))+C[2]+606105819&4294967295,O=F+(R<<17&4294967295|R>>>15),R=E+(b^O&(F^b))+C[3]+3250441966&4294967295,E=O+(R<<22&4294967295|R>>>10),R=b+(F^E&(O^F))+C[4]+4118548399&4294967295,b=E+(R<<7&4294967295|R>>>25),R=F+(O^b&(E^O))+C[5]+1200080426&4294967295,F=b+(R<<12&4294967295|R>>>20),R=O+(E^F&(b^E))+C[6]+2821735955&4294967295,O=F+(R<<17&4294967295|R>>>15),R=E+(b^O&(F^b))+C[7]+4249261313&4294967295,E=O+(R<<22&4294967295|R>>>10),R=b+(F^E&(O^F))+C[8]+1770035416&4294967295,b=E+(R<<7&4294967295|R>>>25),R=F+(O^b&(E^O))+C[9]+2336552879&4294967295,F=b+(R<<12&4294967295|R>>>20),R=O+(E^F&(b^E))+C[10]+4294925233&4294967295,O=F+(R<<17&4294967295|R>>>15),R=E+(b^O&(F^b))+C[11]+2304563134&4294967295,E=O+(R<<22&4294967295|R>>>10),R=b+(F^E&(O^F))+C[12]+1804603682&4294967295,b=E+(R<<7&4294967295|R>>>25),R=F+(O^b&(E^O))+C[13]+4254626195&4294967295,F=b+(R<<12&4294967295|R>>>20),R=O+(E^F&(b^E))+C[14]+2792965006&4294967295,O=F+(R<<17&4294967295|R>>>15),R=E+(b^O&(F^b))+C[15]+1236535329&4294967295,E=O+(R<<22&4294967295|R>>>10),R=b+(O^F&(E^O))+C[1]+4129170786&4294967295,b=E+(R<<5&4294967295|R>>>27),R=F+(E^O&(b^E))+C[6]+3225465664&4294967295,F=b+(R<<9&4294967295|R>>>23),R=O+(b^E&(F^b))+C[11]+643717713&4294967295,O=F+(R<<14&4294967295|R>>>18),R=E+(F^b&(O^F))+C[0]+3921069994&4294967295,E=O+(R<<20&4294967295|R>>>12),R=b+(O^F&(E^O))+C[5]+3593408605&4294967295,b=E+(R<<5&4294967295|R>>>27),R=F+(E^O&(b^E))+C[10]+38016083&4294967295,F=b+(R<<9&4294967295|R>>>23),R=O+(b^E&(F^b))+C[15]+3634488961&4294967295,O=F+(R<<14&4294967295|R>>>18),R=E+(F^b&(O^F))+C[4]+3889429448&4294967295,E=O+(R<<20&4294967295|R>>>12),R=b+(O^F&(E^O))+C[9]+568446438&4294967295,b=E+(R<<5&4294967295|R>>>27),R=F+(E^O&(b^E))+C[14]+3275163606&4294967295,F=b+(R<<9&4294967295|R>>>23),R=O+(b^E&(F^b))+C[3]+4107603335&4294967295,O=F+(R<<14&4294967295|R>>>18),R=E+(F^b&(O^F))+C[8]+1163531501&4294967295,E=O+(R<<20&4294967295|R>>>12),R=b+(O^F&(E^O))+C[13]+2850285829&4294967295,b=E+(R<<5&4294967295|R>>>27),R=F+(E^O&(b^E))+C[2]+4243563512&4294967295,F=b+(R<<9&4294967295|R>>>23),R=O+(b^E&(F^b))+C[7]+1735328473&4294967295,O=F+(R<<14&4294967295|R>>>18),R=E+(F^b&(O^F))+C[12]+2368359562&4294967295,E=O+(R<<20&4294967295|R>>>12),R=b+(E^O^F)+C[5]+4294588738&4294967295,b=E+(R<<4&4294967295|R>>>28),R=F+(b^E^O)+C[8]+2272392833&4294967295,F=b+(R<<11&4294967295|R>>>21),R=O+(F^b^E)+C[11]+1839030562&4294967295,O=F+(R<<16&4294967295|R>>>16),R=E+(O^F^b)+C[14]+4259657740&4294967295,E=O+(R<<23&4294967295|R>>>9),R=b+(E^O^F)+C[1]+2763975236&4294967295,b=E+(R<<4&4294967295|R>>>28),R=F+(b^E^O)+C[4]+1272893353&4294967295,F=b+(R<<11&4294967295|R>>>21),R=O+(F^b^E)+C[7]+4139469664&4294967295,O=F+(R<<16&4294967295|R>>>16),R=E+(O^F^b)+C[10]+3200236656&4294967295,E=O+(R<<23&4294967295|R>>>9),R=b+(E^O^F)+C[13]+681279174&4294967295,b=E+(R<<4&4294967295|R>>>28),R=F+(b^E^O)+C[0]+3936430074&4294967295,F=b+(R<<11&4294967295|R>>>21),R=O+(F^b^E)+C[3]+3572445317&4294967295,O=F+(R<<16&4294967295|R>>>16),R=E+(O^F^b)+C[6]+76029189&4294967295,E=O+(R<<23&4294967295|R>>>9),R=b+(E^O^F)+C[9]+3654602809&4294967295,b=E+(R<<4&4294967295|R>>>28),R=F+(b^E^O)+C[12]+3873151461&4294967295,F=b+(R<<11&4294967295|R>>>21),R=O+(F^b^E)+C[15]+530742520&4294967295,O=F+(R<<16&4294967295|R>>>16),R=E+(O^F^b)+C[2]+3299628645&4294967295,E=O+(R<<23&4294967295|R>>>9),R=b+(O^(E|~F))+C[0]+4096336452&4294967295,b=E+(R<<6&4294967295|R>>>26),R=F+(E^(b|~O))+C[7]+1126891415&4294967295,F=b+(R<<10&4294967295|R>>>22),R=O+(b^(F|~E))+C[14]+2878612391&4294967295,O=F+(R<<15&4294967295|R>>>17),R=E+(F^(O|~b))+C[5]+4237533241&4294967295,E=O+(R<<21&4294967295|R>>>11),R=b+(O^(E|~F))+C[12]+1700485571&4294967295,b=E+(R<<6&4294967295|R>>>26),R=F+(E^(b|~O))+C[3]+2399980690&4294967295,F=b+(R<<10&4294967295|R>>>22),R=O+(b^(F|~E))+C[10]+4293915773&4294967295,O=F+(R<<15&4294967295|R>>>17),R=E+(F^(O|~b))+C[1]+2240044497&4294967295,E=O+(R<<21&4294967295|R>>>11),R=b+(O^(E|~F))+C[8]+1873313359&4294967295,b=E+(R<<6&4294967295|R>>>26),R=F+(E^(b|~O))+C[15]+4264355552&4294967295,F=b+(R<<10&4294967295|R>>>22),R=O+(b^(F|~E))+C[6]+2734768916&4294967295,O=F+(R<<15&4294967295|R>>>17),R=E+(F^(O|~b))+C[13]+1309151649&4294967295,E=O+(R<<21&4294967295|R>>>11),R=b+(O^(E|~F))+C[4]+4149444226&4294967295,b=E+(R<<6&4294967295|R>>>26),R=F+(E^(b|~O))+C[11]+3174756917&4294967295,F=b+(R<<10&4294967295|R>>>22),R=O+(b^(F|~E))+C[2]+718787259&4294967295,O=F+(R<<15&4294967295|R>>>17),R=E+(F^(O|~b))+C[9]+3951481745&4294967295,x.g[0]=x.g[0]+b&4294967295,x.g[1]=x.g[1]+(O+(R<<21&4294967295|R>>>11))&4294967295,x.g[2]=x.g[2]+O&4294967295,x.g[3]=x.g[3]+F&4294967295}r.prototype.u=function(x,b){b===void 0&&(b=x.length);for(var E=b-this.blockSize,C=this.B,O=this.h,F=0;F<b;){if(O==0)for(;F<=E;)s(this,x,F),F+=this.blockSize;if(typeof x=="string"){for(;F<b;)if(C[O++]=x.charCodeAt(F++),O==this.blockSize){s(this,C),O=0;break}}else for(;F<b;)if(C[O++]=x[F++],O==this.blockSize){s(this,C),O=0;break}}this.h=O,this.o+=b},r.prototype.v=function(){var x=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);x[0]=128;for(var b=1;b<x.length-8;++b)x[b]=0;var E=8*this.o;for(b=x.length-8;b<x.length;++b)x[b]=E&255,E/=256;for(this.u(x),x=Array(16),b=E=0;4>b;++b)for(var C=0;32>C;C+=8)x[E++]=this.g[b]>>>C&255;return x};function i(x,b){var E=a;return Object.prototype.hasOwnProperty.call(E,x)?E[x]:E[x]=b(x)}function o(x,b){this.h=b;for(var E=[],C=!0,O=x.length-1;0<=O;O--){var F=x[O]|0;C&&F==b||(E[O]=F,C=!1)}this.g=E}var a={};function l(x){return-128<=x&&128>x?i(x,function(b){return new o([b|0],0>b?-1:0)}):new o([x|0],0>x?-1:0)}function c(x){if(isNaN(x)||!isFinite(x))return f;if(0>x)return S(c(-x));for(var b=[],E=1,C=0;x>=E;C++)b[C]=x/E|0,E*=4294967296;return new o(b,0)}function h(x,b){if(x.length==0)throw Error("number format error: empty string");if(b=b||10,2>b||36<b)throw Error("radix out of range: "+b);if(x.charAt(0)=="-")return S(h(x.substring(1),b));if(0<=x.indexOf("-"))throw Error('number format error: interior "-" character');for(var E=c(Math.pow(b,8)),C=f,O=0;O<x.length;O+=8){var F=Math.min(8,x.length-O),R=parseInt(x.substring(O,O+F),b);8>F?(F=c(Math.pow(b,F)),C=C.j(F).add(c(R))):(C=C.j(E),C=C.add(c(R)))}return C}var f=l(0),g=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(A(this))return-S(this).m();for(var x=0,b=1,E=0;E<this.g.length;E++){var C=this.i(E);x+=(0<=C?C:4294967296+C)*b,b*=4294967296}return x},n.toString=function(x){if(x=x||10,2>x||36<x)throw Error("radix out of range: "+x);if(I(this))return"0";if(A(this))return"-"+S(this).toString(x);for(var b=c(Math.pow(x,6)),E=this,C="";;){var O=L(E,b).g;E=$(E,O.j(b));var F=((0<E.g.length?E.g[0]:E.h)>>>0).toString(x);if(E=O,I(E))return F+C;for(;6>F.length;)F="0"+F;C=F+C}},n.i=function(x){return 0>x?0:x<this.g.length?this.g[x]:this.h};function I(x){if(x.h!=0)return!1;for(var b=0;b<x.g.length;b++)if(x.g[b]!=0)return!1;return!0}function A(x){return x.h==-1}n.l=function(x){return x=$(this,x),A(x)?-1:I(x)?0:1};function S(x){for(var b=x.g.length,E=[],C=0;C<b;C++)E[C]=~x.g[C];return new o(E,~x.h).add(g)}n.abs=function(){return A(this)?S(this):this},n.add=function(x){for(var b=Math.max(this.g.length,x.g.length),E=[],C=0,O=0;O<=b;O++){var F=C+(this.i(O)&65535)+(x.i(O)&65535),R=(F>>>16)+(this.i(O)>>>16)+(x.i(O)>>>16);C=R>>>16,F&=65535,R&=65535,E[O]=R<<16|F}return new o(E,E[E.length-1]&-2147483648?-1:0)};function $(x,b){return x.add(S(b))}n.j=function(x){if(I(this)||I(x))return f;if(A(this))return A(x)?S(this).j(S(x)):S(S(this).j(x));if(A(x))return S(this.j(S(x)));if(0>this.l(y)&&0>x.l(y))return c(this.m()*x.m());for(var b=this.g.length+x.g.length,E=[],C=0;C<2*b;C++)E[C]=0;for(C=0;C<this.g.length;C++)for(var O=0;O<x.g.length;O++){var F=this.i(C)>>>16,R=this.i(C)&65535,pt=x.i(O)>>>16,mt=x.i(O)&65535;E[2*C+2*O]+=R*mt,U(E,2*C+2*O),E[2*C+2*O+1]+=F*mt,U(E,2*C+2*O+1),E[2*C+2*O+1]+=R*pt,U(E,2*C+2*O+1),E[2*C+2*O+2]+=F*pt,U(E,2*C+2*O+2)}for(C=0;C<b;C++)E[C]=E[2*C+1]<<16|E[2*C];for(C=b;C<2*b;C++)E[C]=0;return new o(E,0)};function U(x,b){for(;(x[b]&65535)!=x[b];)x[b+1]+=x[b]>>>16,x[b]&=65535,b++}function M(x,b){this.g=x,this.h=b}function L(x,b){if(I(b))throw Error("division by zero");if(I(x))return new M(f,f);if(A(x))return b=L(S(x),b),new M(S(b.g),S(b.h));if(A(b))return b=L(x,S(b)),new M(S(b.g),b.h);if(30<x.g.length){if(A(x)||A(b))throw Error("slowDivide_ only works with positive integers.");for(var E=g,C=b;0>=C.l(x);)E=se(E),C=se(C);var O=Q(E,1),F=Q(C,1);for(C=Q(C,2),E=Q(E,2);!I(C);){var R=F.add(C);0>=R.l(x)&&(O=O.add(E),F=R),C=Q(C,1),E=Q(E,1)}return b=$(x,O.j(b)),new M(O,b)}for(O=f;0<=x.l(b);){for(E=Math.max(1,Math.floor(x.m()/b.m())),C=Math.ceil(Math.log(E)/Math.LN2),C=48>=C?1:Math.pow(2,C-48),F=c(E),R=F.j(b);A(R)||0<R.l(x);)E-=C,F=c(E),R=F.j(b);I(F)&&(F=g),O=O.add(F),x=$(x,R)}return new M(O,x)}n.A=function(x){return L(this,x).h},n.and=function(x){for(var b=Math.max(this.g.length,x.g.length),E=[],C=0;C<b;C++)E[C]=this.i(C)&x.i(C);return new o(E,this.h&x.h)},n.or=function(x){for(var b=Math.max(this.g.length,x.g.length),E=[],C=0;C<b;C++)E[C]=this.i(C)|x.i(C);return new o(E,this.h|x.h)},n.xor=function(x){for(var b=Math.max(this.g.length,x.g.length),E=[],C=0;C<b;C++)E[C]=this.i(C)^x.i(C);return new o(E,this.h^x.h)};function se(x){for(var b=x.g.length+1,E=[],C=0;C<b;C++)E[C]=x.i(C)<<1|x.i(C-1)>>>31;return new o(E,x.h)}function Q(x,b){var E=b>>5;b%=32;for(var C=x.g.length-E,O=[],F=0;F<C;F++)O[F]=0<b?x.i(F+E)>>>b|x.i(F+E+1)<<32-b:x.i(F+E);return new o(O,x.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,cw=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=h,Mo=o}).apply(typeof Oy<"u"?Oy:typeof self<"u"?self:typeof window<"u"?window:{});var nd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var dw,cu,hw,yd,Ep,fw,pw,mw;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,p,v){return u==Array.prototype||u==Object.prototype||(u[p]=v.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof nd=="object"&&nd];for(var p=0;p<u.length;++p){var v=u[p];if(v&&v.Math==Math)return v}throw Error("Cannot find global object")}var r=t(this);function s(u,p){if(p)e:{var v=r;u=u.split(".");for(var w=0;w<u.length-1;w++){var q=u[w];if(!(q in v))break e;v=v[q]}u=u[u.length-1],w=v[u],p=p(w),p!=w&&p!=null&&e(v,u,{configurable:!0,writable:!0,value:p})}}function i(u,p){u instanceof String&&(u+="");var v=0,w=!1,q={next:function(){if(!w&&v<u.length){var X=v++;return{value:p(X,u[X]),done:!1}}return w=!0,{done:!0,value:void 0}}};return q[Symbol.iterator]=function(){return q},q}s("Array.prototype.values",function(u){return u||function(){return i(this,function(p,v){return v})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var p=typeof u;return p=p!="object"?p:u?Array.isArray(u)?"array":p:"null",p=="array"||p=="object"&&typeof u.length=="number"}function c(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function h(u,p,v){return u.call.apply(u.bind,arguments)}function f(u,p,v){if(!u)throw Error();if(2<arguments.length){var w=Array.prototype.slice.call(arguments,2);return function(){var q=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(q,w),u.apply(p,q)}}return function(){return u.apply(p,arguments)}}function g(u,p,v){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,g.apply(null,arguments)}function y(u,p){var v=Array.prototype.slice.call(arguments,1);return function(){var w=v.slice();return w.push.apply(w,arguments),u.apply(this,w)}}function I(u,p){function v(){}v.prototype=p.prototype,u.aa=p.prototype,u.prototype=new v,u.prototype.constructor=u,u.Qb=function(w,q,X){for(var Se=Array(arguments.length-2),wt=2;wt<arguments.length;wt++)Se[wt-2]=arguments[wt];return p.prototype[q].apply(w,Se)}}function A(u){const p=u.length;if(0<p){const v=Array(p);for(let w=0;w<p;w++)v[w]=u[w];return v}return[]}function S(u,p){for(let v=1;v<arguments.length;v++){const w=arguments[v];if(l(w)){const q=u.length||0,X=w.length||0;u.length=q+X;for(let Se=0;Se<X;Se++)u[q+Se]=w[Se]}else u.push(w)}}class ${constructor(p,v){this.i=p,this.j=v,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function U(u){return/^[\s\xa0]*$/.test(u)}function M(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function L(u){return L[" "](u),u}L[" "]=function(){};var se=M().indexOf("Gecko")!=-1&&!(M().toLowerCase().indexOf("webkit")!=-1&&M().indexOf("Edge")==-1)&&!(M().indexOf("Trident")!=-1||M().indexOf("MSIE")!=-1)&&M().indexOf("Edge")==-1;function Q(u,p,v){for(const w in u)p.call(v,u[w],w,u)}function x(u,p){for(const v in u)p.call(void 0,u[v],v,u)}function b(u){const p={};for(const v in u)p[v]=u[v];return p}const E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function C(u,p){let v,w;for(let q=1;q<arguments.length;q++){w=arguments[q];for(v in w)u[v]=w[v];for(let X=0;X<E.length;X++)v=E[X],Object.prototype.hasOwnProperty.call(w,v)&&(u[v]=w[v])}}function O(u){var p=1;u=u.split(":");const v=[];for(;0<p&&u.length;)v.push(u.shift()),p--;return u.length&&v.push(u.join(":")),v}function F(u){a.setTimeout(()=>{throw u},0)}function R(){var u=oe;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class pt{constructor(){this.h=this.g=null}add(p,v){const w=mt.get();w.set(p,v),this.h?this.h.next=w:this.g=w,this.h=w}}var mt=new $(()=>new we,u=>u.reset());class we{constructor(){this.next=this.g=this.h=null}set(p,v){this.h=p,this.g=v,this.next=null}reset(){this.next=this.g=this.h=null}}let re,ue=!1,oe=new pt,Ne=()=>{const u=a.Promise.resolve(void 0);re=()=>{u.then(te)}};var te=()=>{for(var u;u=R();){try{u.h.call(u.g)}catch(v){F(v)}var p=mt;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}ue=!1};function Y(){this.s=this.s,this.C=this.C}Y.prototype.s=!1,Y.prototype.ma=function(){this.s||(this.s=!0,this.N())},Y.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Te(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}Te.prototype.h=function(){this.defaultPrevented=!0};var We=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const v=()=>{};a.addEventListener("test",v,p),a.removeEventListener("test",v,p)}catch{}return u}();function at(u,p){if(Te.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var v=this.type=u.type,w=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(se){e:{try{L(p.nodeName);var q=!0;break e}catch{}q=!1}q||(p=null)}}else v=="mouseover"?p=u.fromElement:v=="mouseout"&&(p=u.toElement);this.relatedTarget=p,w?(this.clientX=w.clientX!==void 0?w.clientX:w.pageX,this.clientY=w.clientY!==void 0?w.clientY:w.pageY,this.screenX=w.screenX||0,this.screenY=w.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:Vt[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&at.aa.h.call(this)}}I(at,Te);var Vt={2:"touch",3:"pen",4:"mouse"};at.prototype.h=function(){at.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var Z="closure_listenable_"+(1e6*Math.random()|0),Ae=0;function xe(u,p,v,w,q){this.listener=u,this.proxy=null,this.src=p,this.type=v,this.capture=!!w,this.ha=q,this.key=++Ae,this.da=this.fa=!1}function Ve(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function tt(u){this.src=u,this.g={},this.h=0}tt.prototype.add=function(u,p,v,w,q){var X=u.toString();u=this.g[X],u||(u=this.g[X]=[],this.h++);var Se=T(u,p,w,q);return-1<Se?(p=u[Se],v||(p.fa=!1)):(p=new xe(p,this.src,X,!!w,q),p.fa=v,u.push(p)),p};function lt(u,p){var v=p.type;if(v in u.g){var w=u.g[v],q=Array.prototype.indexOf.call(w,p,void 0),X;(X=0<=q)&&Array.prototype.splice.call(w,q,1),X&&(Ve(p),u.g[v].length==0&&(delete u.g[v],u.h--))}}function T(u,p,v,w){for(var q=0;q<u.length;++q){var X=u[q];if(!X.da&&X.listener==p&&X.capture==!!v&&X.ha==w)return q}return-1}var k="closure_lm_"+(1e6*Math.random()|0),G={};function H(u,p,v,w,q){if(w&&w.once)return be(u,p,v,w,q);if(Array.isArray(p)){for(var X=0;X<p.length;X++)H(u,p[X],v,w,q);return null}return v=j(v),u&&u[Z]?u.K(p,v,c(w)?!!w.capture:!!w,q):ne(u,p,v,!1,w,q)}function ne(u,p,v,w,q,X){if(!p)throw Error("Invalid event type");var Se=c(q)?!!q.capture:!!q,wt=Ce(u);if(wt||(u[k]=wt=new tt(u)),v=wt.add(p,v,w,Se,X),v.proxy)return v;if(w=de(),v.proxy=w,w.src=u,w.listener=v,u.addEventListener)We||(q=Se),q===void 0&&(q=!1),u.addEventListener(p.toString(),w,q);else if(u.attachEvent)u.attachEvent(ye(p.toString()),w);else if(u.addListener&&u.removeListener)u.addListener(w);else throw Error("addEventListener and attachEvent are unavailable.");return v}function de(){function u(v){return p.call(u.src,u.listener,v)}const p=$e;return u}function be(u,p,v,w,q){if(Array.isArray(p)){for(var X=0;X<p.length;X++)be(u,p[X],v,w,q);return null}return v=j(v),u&&u[Z]?u.L(p,v,c(w)?!!w.capture:!!w,q):ne(u,p,v,!0,w,q)}function _e(u,p,v,w,q){if(Array.isArray(p))for(var X=0;X<p.length;X++)_e(u,p[X],v,w,q);else w=c(w)?!!w.capture:!!w,v=j(v),u&&u[Z]?(u=u.i,p=String(p).toString(),p in u.g&&(X=u.g[p],v=T(X,v,w,q),-1<v&&(Ve(X[v]),Array.prototype.splice.call(X,v,1),X.length==0&&(delete u.g[p],u.h--)))):u&&(u=Ce(u))&&(p=u.g[p.toString()],u=-1,p&&(u=T(p,v,w,q)),(v=-1<u?p[u]:null)&&Ie(v))}function Ie(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[Z])lt(p.i,u);else{var v=u.type,w=u.proxy;p.removeEventListener?p.removeEventListener(v,w,u.capture):p.detachEvent?p.detachEvent(ye(v),w):p.addListener&&p.removeListener&&p.removeListener(w),(v=Ce(p))?(lt(v,u),v.h==0&&(v.src=null,p[k]=null)):Ve(u)}}}function ye(u){return u in G?G[u]:G[u]="on"+u}function $e(u,p){if(u.da)u=!0;else{p=new at(p,this);var v=u.listener,w=u.ha||u.src;u.fa&&Ie(u),u=v.call(w,p)}return u}function Ce(u){return u=u[k],u instanceof tt?u:null}var B="__closure_events_fn_"+(1e9*Math.random()>>>0);function j(u){return typeof u=="function"?u:(u[B]||(u[B]=function(p){return u.handleEvent(p)}),u[B])}function ge(){Y.call(this),this.i=new tt(this),this.M=this,this.F=null}I(ge,Y),ge.prototype[Z]=!0,ge.prototype.removeEventListener=function(u,p,v,w){_e(this,u,p,v,w)};function he(u,p){var v,w=u.F;if(w)for(v=[];w;w=w.F)v.push(w);if(u=u.M,w=p.type||p,typeof p=="string")p=new Te(p,u);else if(p instanceof Te)p.target=p.target||u;else{var q=p;p=new Te(w,u),C(p,q)}if(q=!0,v)for(var X=v.length-1;0<=X;X--){var Se=p.g=v[X];q=ke(Se,w,!0,p)&&q}if(Se=p.g=u,q=ke(Se,w,!0,p)&&q,q=ke(Se,w,!1,p)&&q,v)for(X=0;X<v.length;X++)Se=p.g=v[X],q=ke(Se,w,!1,p)&&q}ge.prototype.N=function(){if(ge.aa.N.call(this),this.i){var u=this.i,p;for(p in u.g){for(var v=u.g[p],w=0;w<v.length;w++)Ve(v[w]);delete u.g[p],u.h--}}this.F=null},ge.prototype.K=function(u,p,v,w){return this.i.add(String(u),p,!1,v,w)},ge.prototype.L=function(u,p,v,w){return this.i.add(String(u),p,!0,v,w)};function ke(u,p,v,w){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();for(var q=!0,X=0;X<p.length;++X){var Se=p[X];if(Se&&!Se.da&&Se.capture==v){var wt=Se.listener,bn=Se.ha||Se.src;Se.fa&&lt(u.i,Se),q=wt.call(bn,w)!==!1&&q}}return q&&!w.defaultPrevented}function He(u,p,v){if(typeof u=="function")v&&(u=g(u,v));else if(u&&typeof u.handleEvent=="function")u=g(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(u,p||0)}function Xe(u){u.g=He(()=>{u.g=null,u.i&&(u.i=!1,Xe(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class gt extends Y{constructor(p,v){super(),this.m=p,this.l=v,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:Xe(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ot(u){Y.call(this),this.h=u,this.g={}}I(Ot,Y);var Ir=[];function Er(u){Q(u.g,function(p,v){this.g.hasOwnProperty(v)&&Ie(p)},u),u.g={}}Ot.prototype.N=function(){Ot.aa.N.call(this),Er(this)},Ot.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Mt=a.JSON.stringify,qt=a.JSON.parse,Un=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function Tr(){}Tr.prototype.h=null;function Yt(u){return u.h||(u.h=u.i())}function oa(){}var jn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Dn(){Te.call(this,"d")}I(Dn,Te);function hs(){Te.call(this,"c")}I(hs,Te);var Nr={},ro=null;function fs(){return ro=ro||new ge}Nr.La="serverreachability";function so(u){Te.call(this,Nr.La,u)}I(so,Te);function ps(u){const p=fs();he(p,new so(p))}Nr.STAT_EVENT="statevent";function ms(u,p){Te.call(this,Nr.STAT_EVENT,u),this.stat=p}I(ms,Te);function _n(u){const p=fs();he(p,new ms(p,u))}Nr.Ma="timingevent";function io(u,p){Te.call(this,Nr.Ma,u),this.size=p}I(io,Te);function gs(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},p)}function vs(){this.g=!0}vs.prototype.xa=function(){this.g=!1};function Vc(u,p,v,w,q,X){u.info(function(){if(u.g)if(X)for(var Se="",wt=X.split("&"),bn=0;bn<wt.length;bn++){var yt=wt[bn].split("=");if(1<yt.length){var En=yt[0];yt=yt[1];var Tn=En.split("_");Se=2<=Tn.length&&Tn[1]=="type"?Se+(En+"="+yt+"&"):Se+(En+"=redacted&")}}else Se=null;else Se=X;return"XMLHTTP REQ ("+w+") [attempt "+q+"]: "+p+`
`+v+`
`+Se})}function ff(u,p,v,w,q,X,Se){u.info(function(){return"XMLHTTP RESP ("+w+") [ attempt "+q+"]: "+p+`
`+v+`
`+X+" "+Se})}function Kr(u,p,v,w){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+mf(u,v)+(w?" "+w:"")})}function pf(u,p){u.info(function(){return"TIMEOUT: "+p})}vs.prototype.info=function(){};function mf(u,p){if(!u.g)return p;if(!p)return null;try{var v=JSON.parse(p);if(v){for(u=0;u<v.length;u++)if(Array.isArray(v[u])){var w=v[u];if(!(2>w.length)){var q=w[1];if(Array.isArray(q)&&!(1>q.length)){var X=q[0];if(X!="noop"&&X!="stop"&&X!="close")for(var Se=1;Se<q.length;Se++)q[Se]=""}}}}return Mt(v)}catch{return p}}var aa={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Oc={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},la;function ua(){}I(ua,Tr),ua.prototype.g=function(){return new XMLHttpRequest},ua.prototype.i=function(){return{}},la=new ua;function Vr(u,p,v,w){this.j=u,this.i=p,this.l=v,this.R=w||1,this.U=new Ot(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Mc}function Mc(){this.i=null,this.g="",this.h=!1}var Ol={},Ml={};function Ar(u,p,v){u.L=1,u.v=lo(rr(p)),u.m=v,u.P=!0,Gr(u,null)}function Gr(u,p){u.F=Date.now(),fr(u),u.A=rr(u.v);var v=u.A,w=u.R;Array.isArray(w)||(w=[String(w)]),qc(v.i,"t",w),u.C=0,v=u.j.J,u.h=new Mc,u.g=Hl(u.j,v?p:null,!u.m),0<u.O&&(u.M=new gt(g(u.Y,u,u.g),u.O)),p=u.U,v=u.g,w=u.ca;var q="readystatechange";Array.isArray(q)||(q&&(Ir[0]=q.toString()),q=Ir);for(var X=0;X<q.length;X++){var Se=H(v,q[X],w||p.handleEvent,!1,p.h||p);if(!Se)break;p.g[Se.key]=Se}p=u.H?b(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),ps(),Vc(u.i,u.u,u.A,u.l,u.R,u.m)}Vr.prototype.ca=function(u){u=u.target;const p=this.M;p&&ln(u)==3?p.j():this.Y(u)},Vr.prototype.Y=function(u){try{if(u==this.g)e:{const Tn=ln(this.g);var p=this.g.Ba();const pi=this.g.Z();if(!(3>Tn)&&(Tn!=3||this.g&&(this.h.h||this.g.oa()||zc(this.g)))){this.J||Tn!=4||p==7||(p==8||0>=pi?ps(3):ps(2)),ni(this);var v=this.g.Z();this.X=v;t:if(Or(this)){var w=zc(this.g);u="";var q=w.length,X=ln(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ys(this),Mr(this);var Se="";break t}this.h.i=new a.TextDecoder}for(p=0;p<q;p++)this.h.h=!0,u+=this.h.i.decode(w[p],{stream:!(X&&p==q-1)});w.length=0,this.h.g+=u,this.C=0,Se=this.h.g}else Se=this.g.oa();if(this.o=v==200,ff(this.i,this.u,this.A,this.l,this.R,Tn,v),this.o){if(this.T&&!this.K){t:{if(this.g){var wt,bn=this.g;if((wt=bn.g?bn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(wt)){var yt=wt;break t}}yt=null}if(v=yt)Kr(this.i,this.l,v,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,nr(this,v);else{this.o=!1,this.s=3,_n(12),ys(this),Mr(this);break e}}if(this.P){v=!0;let gr;for(;!this.J&&this.C<Se.length;)if(gr=ti(this,Se),gr==Ml){Tn==4&&(this.s=4,_n(14),v=!1),Kr(this.i,this.l,null,"[Incomplete Response]");break}else if(gr==Ol){this.s=4,_n(15),Kr(this.i,this.l,Se,"[Invalid Chunk]"),v=!1;break}else Kr(this.i,this.l,gr,null),nr(this,gr);if(Or(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Tn!=4||Se.length!=0||this.h.h||(this.s=1,_n(16),v=!1),this.o=this.o&&v,!v)Kr(this.i,this.l,Se,"[Invalid Chunked Response]"),ys(this),Mr(this);else if(0<Se.length&&!this.W){this.W=!0;var En=this.j;En.g==this&&En.ba&&!En.M&&(En.j.info("Great, no buffering proxy detected. Bytes received: "+Se.length),_a(En),En.M=!0,_n(11))}}else Kr(this.i,this.l,Se,null),nr(this,Se);Tn==4&&ys(this),this.o&&!this.J&&(Tn==4?mo(this.j,this):(this.o=!1,fr(this)))}else Bl(this.g),v==400&&0<Se.indexOf("Unknown SID")?(this.s=3,_n(12)):(this.s=0,_n(13)),ys(this),Mr(this)}}}catch{}finally{}};function Or(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function ti(u,p){var v=u.C,w=p.indexOf(`
`,v);return w==-1?Ml:(v=Number(p.substring(v,w)),isNaN(v)?Ol:(w+=1,w+v>p.length?Ml:(p=p.slice(w,w+v),u.C=w+v,p)))}Vr.prototype.cancel=function(){this.J=!0,ys(this)};function fr(u){u.S=Date.now()+u.I,Ll(u,u.I)}function Ll(u,p){if(u.B!=null)throw Error("WatchDog timer not null");u.B=gs(g(u.ba,u),p)}function ni(u){u.B&&(a.clearTimeout(u.B),u.B=null)}Vr.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(pf(this.i,this.A),this.L!=2&&(ps(),_n(17)),ys(this),this.s=2,Mr(this)):Ll(this,this.S-u)};function Mr(u){u.j.G==0||u.J||mo(u.j,u)}function ys(u){ni(u);var p=u.M;p&&typeof p.ma=="function"&&p.ma(),u.M=null,Er(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function nr(u,p){try{var v=u.j;if(v.G!=0&&(v.g==u||Nn(v.h,u))){if(!u.K&&Nn(v.h,u)&&v.G==3){try{var w=v.Da.g.parse(p)}catch{w=null}if(Array.isArray(w)&&w.length==3){var q=w;if(q[0]==0){e:if(!v.u){if(v.g)if(v.g.F+3e3<u.F)hi(v),ho(v);else break e;Gl(v),_n(18)}}else v.za=q[1],0<v.za-v.T&&37500>q[2]&&v.F&&v.v==0&&!v.C&&(v.C=gs(g(v.Za,v),6e3));if(1>=$c(v.h)&&v.ca){try{v.ca()}catch{}v.ca=void 0}}else Xr(v,11)}else if((u.K||v.g==u)&&hi(v),!U(p))for(q=v.Da.g.parse(p),p=0;p<q.length;p++){let yt=q[p];if(v.T=yt[0],yt=yt[1],v.G==2)if(yt[0]=="c"){v.K=yt[1],v.ia=yt[2];const En=yt[3];En!=null&&(v.la=En,v.j.info("VER="+v.la));const Tn=yt[4];Tn!=null&&(v.Aa=Tn,v.j.info("SVER="+v.Aa));const pi=yt[5];pi!=null&&typeof pi=="number"&&0<pi&&(w=1.5*pi,v.L=w,v.j.info("backChannelRequestTimeoutMs_="+w)),w=v;const gr=u.g;if(gr){const vr=gr.g?gr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(vr){var X=w.h;X.g||vr.indexOf("spdy")==-1&&vr.indexOf("quic")==-1&&vr.indexOf("h2")==-1||(X.j=X.l,X.g=new Set,X.h&&(ri(X,X.h),X.h=null))}if(w.D){const Wl=gr.g?gr.g.getResponseHeader("X-HTTP-Session-Id"):null;Wl&&(w.ya=Wl,kt(w.I,w.D,Wl))}}v.G=3,v.l&&v.l.ua(),v.ba&&(v.R=Date.now()-u.F,v.j.info("Handshake RTT: "+v.R+"ms")),w=v;var Se=u;if(w.qa=Wc(w,w.J?w.ia:null,w.W),Se.K){pr(w.h,Se);var wt=Se,bn=w.L;bn&&(wt.I=bn),wt.B&&(ni(wt),fr(wt)),w.g=Se}else ya(w);0<v.i.length&&di(v)}else yt[0]!="stop"&&yt[0]!="close"||Xr(v,7);else v.G==3&&(yt[0]=="stop"||yt[0]=="close"?yt[0]=="stop"?Xr(v,7):zl(v):yt[0]!="noop"&&v.l&&v.l.ta(yt),v.v=0)}}ps(4)}catch{}}var Lc=class{constructor(u,p){this.g=u,this.map=p}};function $l(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ca(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function $c(u){return u.h?1:u.g?u.g.size:0}function Nn(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function ri(u,p){u.g?u.g.add(p):u.h=p}function pr(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}$l.prototype.cancel=function(){if(this.i=Fl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function Fl(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const v of u.g.values())p=p.concat(v.D);return p}return A(u.i)}function Fc(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var p=[],v=u.length,w=0;w<v;w++)p.push(u[w]);return p}p=[],v=0;for(w in u)p[v++]=u[w];return p}function oo(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var p=[];u=u.length;for(var v=0;v<u;v++)p.push(v);return p}p=[],v=0;for(const w in u)p[v++]=w;return p}}}function si(u,p){if(u.forEach&&typeof u.forEach=="function")u.forEach(p,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,p,void 0);else for(var v=oo(u),w=Fc(u),q=w.length,X=0;X<q;X++)p.call(void 0,w[X],v&&v[X],u)}var ao=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ii(u,p){if(u){u=u.split("&");for(var v=0;v<u.length;v++){var w=u[v].indexOf("="),q=null;if(0<=w){var X=u[v].substring(0,w);q=u[v].substring(w+1)}else X=u[v];p(X,q?decodeURIComponent(q.replace(/\+/g," ")):"")}}}function Hr(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof Hr){this.h=u.h,sr(this,u.j),this.o=u.o,this.g=u.g,da(this,u.s),this.l=u.l;var p=u.i,v=new ai;v.i=p.i,p.g&&(v.g=new Map(p.g),v.h=p.h),Uc(this,v),this.m=u.m}else u&&(p=String(u).match(ao))?(this.h=!1,sr(this,p[1]||"",!0),this.o=Wr(p[2]||""),this.g=Wr(p[3]||"",!0),da(this,p[4]),this.l=Wr(p[5]||"",!0),Uc(this,p[6]||"",!0),this.m=Wr(p[7]||"")):(this.h=!1,this.i=new ai(null,this.h))}Hr.prototype.toString=function(){var u=[],p=this.j;p&&u.push(Qr(p,Ue,!0),":");var v=this.g;return(v||p=="file")&&(u.push("//"),(p=this.o)&&u.push(Qr(p,Ue,!0),"@"),u.push(encodeURIComponent(String(v)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),v=this.s,v!=null&&u.push(":",String(v))),(v=this.l)&&(this.g&&v.charAt(0)!="/"&&u.push("/"),u.push(Qr(v,v.charAt(0)=="/"?mr:vt,!0))),(v=this.i.toString())&&u.push("?",v),(v=this.m)&&u.push("#",Qr(v,gf)),u.join("")};function rr(u){return new Hr(u)}function sr(u,p,v){u.j=v?Wr(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function da(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function Uc(u,p,v){p instanceof ai?(u.i=p,fa(u.i,u.h)):(v||(p=Qr(p,oi)),u.i=new ai(p,u.h))}function kt(u,p,v){u.i.set(p,v)}function lo(u){return kt(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function Wr(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function Qr(u,p,v){return typeof u=="string"?(u=encodeURI(u).replace(p,Ul),v&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function Ul(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var Ue=/[#\/\?@]/g,vt=/[#\?:]/g,mr=/[#\?]/g,oi=/[#\?@]/g,gf=/#/g;function ai(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function Jr(u){u.g||(u.g=new Map,u.h=0,u.i&&ii(u.i,function(p,v){u.add(decodeURIComponent(p.replace(/\+/g," ")),v)}))}n=ai.prototype,n.add=function(u,p){Jr(this),this.i=null,u=Sr(this,u);var v=this.g.get(u);return v||this.g.set(u,v=[]),v.push(p),this.h+=1,this};function jc(u,p){Jr(u),p=Sr(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function ha(u,p){return Jr(u),p=Sr(u,p),u.g.has(p)}n.forEach=function(u,p){Jr(this),this.g.forEach(function(v,w){v.forEach(function(q){u.call(p,q,w,this)},this)},this)},n.na=function(){Jr(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),v=[];for(let w=0;w<p.length;w++){const q=u[w];for(let X=0;X<q.length;X++)v.push(p[w])}return v},n.V=function(u){Jr(this);let p=[];if(typeof u=="string")ha(this,u)&&(p=p.concat(this.g.get(Sr(this,u))));else{u=Array.from(this.g.values());for(let v=0;v<u.length;v++)p=p.concat(u[v])}return p},n.set=function(u,p){return Jr(this),this.i=null,u=Sr(this,u),ha(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},n.get=function(u,p){return u?(u=this.V(u),0<u.length?String(u[0]):p):p};function qc(u,p,v){jc(u,p),0<v.length&&(u.i=null,u.g.set(Sr(u,p),A(v)),u.h+=v.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var v=0;v<p.length;v++){var w=p[v];const X=encodeURIComponent(String(w)),Se=this.V(w);for(w=0;w<Se.length;w++){var q=X;Se[w]!==""&&(q+="="+encodeURIComponent(String(Se[w]))),u.push(q)}}return this.i=u.join("&")};function Sr(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function fa(u,p){p&&!u.j&&(Jr(u),u.i=null,u.g.forEach(function(v,w){var q=w.toLowerCase();w!=q&&(jc(this,w),qc(this,q,v))},u)),u.j=p}function li(u,p){const v=new vs;if(a.Image){const w=new Image;w.onload=y(ir,v,"TestLoadImage: loaded",!0,p,w),w.onerror=y(ir,v,"TestLoadImage: error",!1,p,w),w.onabort=y(ir,v,"TestLoadImage: abort",!1,p,w),w.ontimeout=y(ir,v,"TestLoadImage: timeout",!1,p,w),a.setTimeout(function(){w.ontimeout&&w.ontimeout()},1e4),w.src=u}else p(!1)}function ui(u,p){const v=new vs,w=new AbortController,q=setTimeout(()=>{w.abort(),ir(v,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:w.signal}).then(X=>{clearTimeout(q),X.ok?ir(v,"TestPingServer: ok",!0,p):ir(v,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(q),ir(v,"TestPingServer: error",!1,p)})}function ir(u,p,v,w,q){try{q&&(q.onload=null,q.onerror=null,q.onabort=null,q.ontimeout=null),w(v)}catch{}}function uo(){this.g=new Un}function pa(u,p,v){const w=v||"";try{si(u,function(q,X){let Se=q;c(q)&&(Se=Mt(q)),p.push(w+X+"="+encodeURIComponent(Se))})}catch(q){throw p.push(w+"type="+encodeURIComponent("_badmap")),q}}function ma(u){this.l=u.Ub||null,this.j=u.eb||!1}I(ma,Tr),ma.prototype.g=function(){return new ga(this.l,this.j)},ma.prototype.i=function(u){return function(){return u}}({});function ga(u,p){ge.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}I(ga,ge),n=ga.prototype,n.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,Ke(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ci(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,Ke(this)),this.g&&(this.readyState=3,Ke(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Bc(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function Bc(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?ci(this):Ke(this),this.readyState==3&&Bc(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,ci(this))},n.Qa=function(u){this.g&&(this.response=u,ci(this))},n.ga=function(){this.g&&ci(this)};function ci(u){u.readyState=4,u.l=null,u.j=null,u.v=null,Ke(u)}n.setRequestHeader=function(u,p){this.u.append(u,p)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var v=p.next();!v.done;)v=v.value,u.push(v[0]+": "+v[1]),v=p.next();return u.join(`\r
`)};function Ke(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(ga.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function rt(u){let p="";return Q(u,function(v,w){p+=w,p+=":",p+=v,p+=`\r
`}),p}function Gt(u,p,v){e:{for(w in v){var w=!1;break e}w=!0}w||(v=rt(v),typeof u=="string"?v!=null&&encodeURIComponent(String(v)):kt(u,p,v))}function Be(u){ge.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}I(Be,ge);var vf=/^https?$/i,jl=["POST","PUT"];n=Be.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,p,v,w){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():la.g(),this.v=this.o?Yt(this.o):Yt(la),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(X){ql(this,X);return}if(u=v||"",v=new Map(this.headers),w)if(Object.getPrototypeOf(w)===Object.prototype)for(var q in w)v.set(q,w[q]);else if(typeof w.keys=="function"&&typeof w.get=="function")for(const X of w.keys())v.set(X,w.get(X));else throw Error("Unknown input type for opt_headers: "+String(w));w=Array.from(v.keys()).find(X=>X.toLowerCase()=="content-type"),q=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(jl,p,void 0))||w||q||v.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[X,Se]of v)this.g.setRequestHeader(X,Se);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{bs(this),this.u=!0,this.g.send(u),this.u=!1}catch(X){ql(this,X)}};function ql(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,_s(u),va(u)}function _s(u){u.A||(u.A=!0,he(u,"complete"),he(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,he(this,"complete"),he(this,"abort"),va(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),va(this,!0)),Be.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Yr(this):this.bb())},n.bb=function(){Yr(this)};function Yr(u){if(u.h&&typeof o<"u"&&(!u.v[1]||ln(u)!=4||u.Z()!=2)){if(u.u&&ln(u)==4)He(u.Ea,0,u);else if(he(u,"readystatechange"),ln(u)==4){u.h=!1;try{const Se=u.Z();e:switch(Se){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var v;if(!(v=p)){var w;if(w=Se===0){var q=String(u.D).match(ao)[1]||null;!q&&a.self&&a.self.location&&(q=a.self.location.protocol.slice(0,-1)),w=!vf.test(q?q.toLowerCase():"")}v=w}if(v)he(u,"complete"),he(u,"success");else{u.m=6;try{var X=2<ln(u)?u.g.statusText:""}catch{X=""}u.l=X+" ["+u.Z()+"]",_s(u)}}finally{va(u)}}}}function va(u,p){if(u.g){bs(u);const v=u.g,w=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||he(u,"ready");try{v.onreadystatechange=w}catch{}}}function bs(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function ln(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<ln(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),qt(p)}};function zc(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function Bl(u){const p={};u=(u.g&&2<=ln(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let w=0;w<u.length;w++){if(U(u[w]))continue;var v=O(u[w]);const q=v[0];if(v=v[1],typeof v!="string")continue;v=v.trim();const X=p[q]||[];p[q]=X,X.push(v)}x(p,function(w){return w.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function co(u,p,v){return v&&v.internalChannelParams&&v.internalChannelParams[u]||p}function Kc(u){this.Aa=0,this.i=[],this.j=new vs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=co("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=co("baseRetryDelayMs",5e3,u),this.cb=co("retryDelaySeedMs",1e4,u),this.Wa=co("forwardChannelMaxRetries",2,u),this.wa=co("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new $l(u&&u.concurrentRequestLimit),this.Da=new uo,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Kc.prototype,n.la=8,n.G=1,n.connect=function(u,p,v,w){_n(0),this.W=u,this.H=p||{},v&&w!==void 0&&(this.H.OSID=v,this.H.OAID=w),this.F=this.X,this.I=Wc(this,null,this.W),di(this)};function zl(u){if(fo(u),u.G==3){var p=u.U++,v=rr(u.I);if(kt(v,"SID",u.K),kt(v,"RID",p),kt(v,"TYPE","terminate"),po(u,v),p=new Vr(u,u.j,p),p.L=2,p.v=lo(rr(v)),v=!1,a.navigator&&a.navigator.sendBeacon)try{v=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!v&&a.Image&&(new Image().src=p.v,v=!0),v||(p.g=Hl(p.j,null),p.g.ea(p.v)),p.F=Date.now(),fr(p)}Hc(u)}function ho(u){u.g&&(_a(u),u.g.cancel(),u.g=null)}function fo(u){ho(u),u.u&&(a.clearTimeout(u.u),u.u=null),hi(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function di(u){if(!ca(u.h)&&!u.s){u.s=!0;var p=u.Ga;re||Ne(),ue||(re(),ue=!0),oe.add(p,u),u.B=0}}function or(u,p){return $c(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=p.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=gs(g(u.Ga,u,p),go(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const q=new Vr(this,this.j,u);let X=this.o;if(this.S&&(X?(X=b(X),C(X,this.S)):X=this.S),this.m!==null||this.O||(q.H=X,X=null),this.P)e:{for(var p=0,v=0;v<this.i.length;v++){t:{var w=this.i[v];if("__data__"in w.map&&(w=w.map.__data__,typeof w=="string")){w=w.length;break t}w=void 0}if(w===void 0)break;if(p+=w,4096<p){p=v;break e}if(p===4096||v===this.i.length-1){p=v+1;break e}}p=1e3}else p=1e3;p=Kl(this,q,p),v=rr(this.I),kt(v,"RID",u),kt(v,"CVER",22),this.D&&kt(v,"X-HTTP-Session-Id",this.D),po(this,v),X&&(this.O?p="headers="+encodeURIComponent(String(rt(X)))+"&"+p:this.m&&Gt(v,this.m,X)),ri(this.h,q),this.Ua&&kt(v,"TYPE","init"),this.P?(kt(v,"$req",p),kt(v,"SID","null"),q.T=!0,Ar(q,v,null)):Ar(q,v,p),this.G=2}}else this.G==3&&(u?Gc(this,u):this.i.length==0||ca(this.h)||Gc(this))};function Gc(u,p){var v;p?v=p.l:v=u.U++;const w=rr(u.I);kt(w,"SID",u.K),kt(w,"RID",v),kt(w,"AID",u.T),po(u,w),u.m&&u.o&&Gt(w,u.m,u.o),v=new Vr(u,u.j,v,u.B+1),u.m===null&&(v.H=u.o),p&&(u.i=p.D.concat(u.i)),p=Kl(u,v,1e3),v.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),ri(u.h,v),Ar(v,w,p)}function po(u,p){u.H&&Q(u.H,function(v,w){kt(p,w,v)}),u.l&&si({},function(v,w){kt(p,w,v)})}function Kl(u,p,v){v=Math.min(u.i.length,v);var w=u.l?g(u.l.Na,u.l,u):null;e:{var q=u.i;let X=-1;for(;;){const Se=["count="+v];X==-1?0<v?(X=q[0].g,Se.push("ofs="+X)):X=0:Se.push("ofs="+X);let wt=!0;for(let bn=0;bn<v;bn++){let yt=q[bn].g;const En=q[bn].map;if(yt-=X,0>yt)X=Math.max(0,q[bn].g-100),wt=!1;else try{pa(En,Se,"req"+yt+"_")}catch{w&&w(En)}}if(wt){w=Se.join("&");break e}}}return u=u.i.splice(0,v),p.D=u,w}function ya(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;re||Ne(),ue||(re(),ue=!0),oe.add(p,u),u.v=0}}function Gl(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=gs(g(u.Fa,u),go(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,ws(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=gs(g(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,_n(10),ho(this),ws(this))};function _a(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function ws(u){u.g=new Vr(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var p=rr(u.qa);kt(p,"RID","rpc"),kt(p,"SID",u.K),kt(p,"AID",u.T),kt(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&kt(p,"TO",u.ja),kt(p,"TYPE","xmlhttp"),po(u,p),u.m&&u.o&&Gt(p,u.m,u.o),u.L&&(u.g.I=u.L);var v=u.g;u=u.ia,v.L=1,v.v=lo(rr(p)),v.m=null,v.P=!0,Gr(v,u)}n.Za=function(){this.C!=null&&(this.C=null,ho(this),Gl(this),_n(19))};function hi(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function mo(u,p){var v=null;if(u.g==p){hi(u),_a(u),u.g=null;var w=2}else if(Nn(u.h,p))v=p.D,pr(u.h,p),w=1;else return;if(u.G!=0){if(p.o)if(w==1){v=p.m?p.m.length:0,p=Date.now()-p.F;var q=u.B;w=fs(),he(w,new io(w,v)),di(u)}else ya(u);else if(q=p.s,q==3||q==0&&0<p.X||!(w==1&&or(u,p)||w==2&&Gl(u)))switch(v&&0<v.length&&(p=u.h,p.i=p.i.concat(v)),q){case 1:Xr(u,5);break;case 4:Xr(u,10);break;case 3:Xr(u,6);break;default:Xr(u,2)}}}function go(u,p){let v=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(v*=2),v*p}function Xr(u,p){if(u.j.info("Error code "+p),p==2){var v=g(u.fb,u),w=u.Xa;const q=!w;w=new Hr(w||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||sr(w,"https"),lo(w),q?li(w.toString(),v):ui(w.toString(),v)}else _n(2);u.G=0,u.l&&u.l.sa(p),Hc(u),fo(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),_n(2)):(this.j.info("Failed to ping google.com"),_n(1))};function Hc(u){if(u.G=0,u.ka=[],u.l){const p=Fl(u.h);(p.length!=0||u.i.length!=0)&&(S(u.ka,p),S(u.ka,u.i),u.h.i.length=0,A(u.i),u.i.length=0),u.l.ra()}}function Wc(u,p,v){var w=v instanceof Hr?rr(v):new Hr(v);if(w.g!="")p&&(w.g=p+"."+w.g),da(w,w.s);else{var q=a.location;w=q.protocol,p=p?p+"."+q.hostname:q.hostname,q=+q.port;var X=new Hr(null);w&&sr(X,w),p&&(X.g=p),q&&da(X,q),v&&(X.l=v),w=X}return v=u.D,p=u.ya,v&&p&&kt(w,v,p),kt(w,"VER",u.la),po(u,w),w}function Hl(u,p,v){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Ca&&!u.pa?new Be(new ma({eb:v})):new Be(u.pa),p.Ha(u.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function ba(){}n=ba.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function xs(){}xs.prototype.g=function(u,p){return new In(u,p)};function In(u,p){ge.call(this),this.g=new Kc(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!U(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!U(p)&&(this.g.D=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new fi(this)}I(In,ge),In.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},In.prototype.close=function(){zl(this.g)},In.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var v={};v.__data__=u,u=v}else this.u&&(v={},v.__data__=Mt(u),u=v);p.i.push(new Lc(p.Ya++,u)),p.G==3&&di(p)},In.prototype.N=function(){this.g.l=null,delete this.j,zl(this.g),delete this.g,In.aa.N.call(this)};function Qc(u){Dn.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const v in p){u=v;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}I(Qc,Dn);function Jc(){hs.call(this),this.status=1}I(Jc,hs);function fi(u){this.g=u}I(fi,ba),fi.prototype.ua=function(){he(this.g,"a")},fi.prototype.ta=function(u){he(this.g,new Qc(u))},fi.prototype.sa=function(u){he(this.g,new Jc)},fi.prototype.ra=function(){he(this.g,"b")},xs.prototype.createWebChannel=xs.prototype.g,In.prototype.send=In.prototype.o,In.prototype.open=In.prototype.m,In.prototype.close=In.prototype.close,mw=function(){return new xs},pw=function(){return fs()},fw=Nr,Ep={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},aa.NO_ERROR=0,aa.TIMEOUT=8,aa.HTTP_ERROR=6,yd=aa,Oc.COMPLETE="complete",hw=Oc,oa.EventType=jn,jn.OPEN="a",jn.CLOSE="b",jn.ERROR="c",jn.MESSAGE="d",ge.prototype.listen=ge.prototype.K,cu=oa,Be.prototype.listenOnce=Be.prototype.L,Be.prototype.getLastError=Be.prototype.Ka,Be.prototype.getLastErrorCode=Be.prototype.Ba,Be.prototype.getStatus=Be.prototype.Z,Be.prototype.getResponseJson=Be.prototype.Oa,Be.prototype.getResponseText=Be.prototype.oa,Be.prototype.send=Be.prototype.ea,Be.prototype.setWithCredentials=Be.prototype.Ha,dw=Be}).apply(typeof nd<"u"?nd:typeof self<"u"?self:typeof window<"u"?window:{});const My="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Sn.UNAUTHENTICATED=new Sn(null),Sn.GOOGLE_CREDENTIALS=new Sn("google-credentials-uid"),Sn.FIRST_PARTY=new Sn("first-party-uid"),Sn.MOCK_USER=new Sn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _l="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ji=new Tm("@firebase/firestore");function Ca(){return ji.logLevel}function kB(n){ji.setLogLevel(n)}function pe(n,...e){if(ji.logLevel<=dt.DEBUG){const t=e.map(Pm);ji.debug(`Firestore (${_l}): ${n}`,...t)}}function dn(n,...e){if(ji.logLevel<=dt.ERROR){const t=e.map(Pm);ji.error(`Firestore (${_l}): ${n}`,...t)}}function kr(n,...e){if(ji.logLevel<=dt.WARN){const t=e.map(Pm);ji.warn(`Firestore (${_l}): ${n}`,...t)}}function Pm(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oe(n="Unexpected state"){const e=`FIRESTORE (${_l}) INTERNAL ASSERTION FAILED: `+n;throw dn(e),new Error(e)}function Le(n,e){n||Oe()}function DB(n,e){n||Oe()}function Re(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class me extends ds{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gw{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class QR{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Sn.UNAUTHENTICATED))}shutdown(){}}class JR{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class YR{constructor(e){this.t=e,this.currentUser=Sn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Le(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new Rn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Rn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{pe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(pe("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Rn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(pe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Le(typeof r.accessToken=="string"),new gw(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Le(e===null||typeof e=="string"),new Sn(e)}}class XR{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Sn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class ZR{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new XR(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Sn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class vw{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class eC{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Le(this.o===void 0);const r=i=>{i.error!=null&&pe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,pe("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{pe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):pe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Le(typeof t.token=="string"),this.R=t.token,new vw(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class NB{getToken(){return Promise.resolve(new vw(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tC(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yw{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=tC(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Je(n,e){return n<e?-1:n>e?1:0}function Xa(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function _w(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tn{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new me(J.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new me(J.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new me(J.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new me(J.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return tn.fromMillis(Date.now())}static fromDate(e){return tn.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new tn(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Je(this.nanoseconds,e.nanoseconds):Je(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qe{constructor(e){this.timestamp=e}static fromTimestamp(e){return new qe(e)}static min(){return new qe(new tn(0,0))}static max(){return new qe(new tn(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qu{constructor(e,t,r){t===void 0?t=0:t>e.length&&Oe(),r===void 0?r=e.length-t:r>e.length-t&&Oe(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return qu.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof qu?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ht extends qu{construct(e,t,r){return new ht(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new me(J.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new ht(t)}static emptyPath(){return new ht([])}}const nC=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Qt extends qu{construct(e,t,r){return new Qt(e,t,r)}static isValidIdentifier(e){return nC.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Qt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Qt(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new me(J.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new me(J.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new me(J.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new me(J.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Qt(t)}static emptyPath(){return new Qt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class De{constructor(e){this.path=e}static fromPath(e){return new De(ht.fromString(e))}static fromName(e){return new De(ht.fromString(e).popFirst(5))}static empty(){return new De(ht.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ht.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ht.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new De(new ht(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Za{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function Tp(n){return n.fields.find(e=>e.kind===2)}function To(n){return n.fields.filter(e=>e.kind!==2)}function rC(n,e){let t=Je(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=sC(n.fields[r],e.fields[r]),t!==0)return t;return Je(n.fields.length,e.fields.length)}Za.UNKNOWN_ID=-1;class Lo{constructor(e,t){this.fieldPath=e,this.kind=t}}function sC(n,e){const t=Qt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Je(n.kind,e.kind)}class el{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new el(0,xr.min())}}function bw(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=qe.fromTimestamp(r===1e9?new tn(t+1,0):new tn(t,r));return new xr(s,De.empty(),e)}function ww(n){return new xr(n.readTime,n.key,-1)}class xr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new xr(qe.min(),De.empty(),-1)}static max(){return new xr(qe.max(),De.empty(),-1)}}function Rm(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=De.comparator(n.documentKey,e.documentKey),t!==0?t:Je(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xw="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Iw{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yi(n){if(n.code!==J.FAILED_PRECONDITION||n.message!==xw)throw n;pe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Oe(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new z((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof z?t:z.resolve(t)}catch(t){return z.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):z.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):z.reject(t)}static resolve(e){return new z((t,r)=>{t(e)})}static reject(e){return new z((t,r)=>{r(e)})}static waitFor(e){return new z((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=z.resolve(!1);for(const r of e)t=t.next(s=>s?z.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new z((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(h=>{o[c]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new z((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sh{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Rn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Eu(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=Cm(r.target.error);this.V.reject(new Eu(e,s))}}static open(e,t,r,s){try{return new Sh(t,e.transaction(s,r))}catch(i){throw new Eu(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(pe("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new oC(t)}}class is{constructor(e,t,r){this.name=e,this.version=t,this.p=r,is.S(wn())===12.2&&dn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return pe("SimpleDb","Removing database:",e),Po(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Em())return!1;if(is.v())return!0;const e=wn(),t=is.S(e),r=0<t&&t<10,s=Ew(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(pe("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new Eu(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new me(J.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new me(J.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Eu(e,o))},s.onupgradeneeded=i=>{pe("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{pe("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=Sh.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),z.reject(c))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(pe("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Ew(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class iC{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Po(this.B.delete())}}class Eu extends me{constructor(e,t){super(J.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Xi(n){return n.name==="IndexedDbTransactionError"}class oC{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(pe("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(pe("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Po(r)}add(e){return pe("SimpleDb","ADD",this.store.name,e,e),Po(this.store.add(e))}get(e){return Po(this.store.get(e)).next(t=>(t===void 0&&(t=null),pe("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return pe("SimpleDb","DELETE",this.store.name,e),Po(this.store.delete(e))}count(){return pe("SimpleDb","COUNT",this.store.name),Po(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new z((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new z((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){pe("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new z((r,s)=>{t.onerror=i=>{const o=Cm(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new z((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new iC(a),c=t(a.primaryKey,a.value,l);if(c instanceof z){const h=c.catch(f=>(l.done(),z.reject(f)));r.push(h)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>z.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Po(n){return new z((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=Cm(r.target.error);t(s)}})}let Ly=!1;function Cm(n){const e=is.S(wn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new me("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ly||(Ly=!0,setTimeout(()=>{throw r},0)),r}}return n}class aC{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){pe("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{pe("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){Xi(t)?pe("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await Yi(t)}await this.X(6e4)})}}class lC{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return z.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return pe("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(pe("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=ww(i);Rm(o,r)>0&&(r=o)}),new xr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ur{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}ur.oe=-1;function hc(n){return n==null}function Bu(n){return n===0&&1/n==-1/0}function Tw(n){return typeof n=="number"&&Number.isInteger(n)&&!Bu(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wn(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=$y(e)),e=uC(n.get(t),e);return $y(e)}function uC(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function $y(n){return n+""}function ns(n){const e=n.length;if(Le(e>=2),e===2)return Le(n.charAt(0)===""&&n.charAt(1)===""),ht.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&Oe(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:Oe()}i=o+2}return new ht(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fy=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _d(n,e){return[n,Wn(e)]}function Aw(n,e,t){return[n,Wn(e),t]}const cC={},dC=["prefixPath","collectionGroup","readTime","documentId"],hC=["prefixPath","collectionGroup","documentId"],fC=["collectionGroup","readTime","prefixPath","documentId"],pC=["canonicalId","targetId"],mC=["targetId","path"],gC=["path","targetId"],vC=["collectionId","parent"],yC=["indexId","uid"],_C=["uid","sequenceNumber"],bC=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],wC=["indexId","uid","orderedDocumentKey"],xC=["userId","collectionPath","documentId"],IC=["userId","collectionPath","largestBatchId"],EC=["userId","collectionGroup","largestBatchId"],Sw=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],TC=[...Sw,"documentOverlays"],Pw=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Rw=Pw,km=[...Rw,"indexConfiguration","indexState","indexEntries"],AC=km,SC=[...km,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ap extends Iw{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function xn(n,e){const t=Re(n);return is.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uy(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Zi(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Cw(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function kw(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ut{constructor(e,t){this.comparator=e,this.root=t||On.EMPTY}insert(e,t){return new Ut(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,On.BLACK,null,null))}remove(e){return new Ut(this.comparator,this.root.remove(e,this.comparator).copy(null,null,On.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new rd(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new rd(this.root,e,this.comparator,!1)}getReverseIterator(){return new rd(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new rd(this.root,e,this.comparator,!0)}}class rd{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class On{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??On.RED,this.left=s??On.EMPTY,this.right=i??On.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new On(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return On.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return On.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,On.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,On.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Oe();const e=this.left.check();if(e!==this.right.check())throw Oe();return e+(this.isRed()?0:1)}}On.EMPTY=null,On.RED=!0,On.BLACK=!1;On.EMPTY=new class{constructor(){this.size=0}get key(){throw Oe()}get value(){throw Oe()}get color(){throw Oe()}get left(){throw Oe()}get right(){throw Oe()}copy(e,t,r,s,i){return this}insert(e,t,r){return new On(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ct{constructor(e){this.comparator=e,this.data=new Ut(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new jy(this.data.getIterator())}getIteratorFrom(e){return new jy(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Ct)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ct(this.comparator);return t.data=e,t}}class jy{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ea(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cr{constructor(e){this.fields=e,e.sort(Qt.comparator)}static empty(){return new cr([])}unionWith(e){let t=new Ct(Qt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new cr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Xa(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dw extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OB(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class on{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Dw("Invalid base64 string: "+i):i}}(e);return new on(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new on(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Je(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}on.EMPTY_BYTE_STRING=new on("");const PC=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Bs(n){if(Le(!!n),typeof n=="string"){let e=0;const t=PC.exec(n);if(Le(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Wt(n.seconds),nanos:Wt(n.nanos)}}function Wt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function zs(n){return typeof n=="string"?on.fromBase64String(n):on.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ph(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Rh(n){const e=n.mapValue.fields.__previous_value__;return Ph(e)?Rh(e):e}function zu(n){const e=Bs(n.mapValue.fields.__local_write_time__.timestampValue);return new tn(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RC{constructor(e,t,r,s,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class Uo{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Uo("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Uo&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ki={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},bd={nullValue:"NULL_VALUE"};function qi(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Ph(n)?4:Nw(n)?9007199254740991:Ch(n)?10:11:Oe()}function cs(n,e){if(n===e)return!0;const t=qi(n);if(t!==qi(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return zu(n).isEqual(zu(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Bs(s.timestampValue),a=Bs(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return zs(s.bytesValue).isEqual(zs(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Wt(s.geoPointValue.latitude)===Wt(i.geoPointValue.latitude)&&Wt(s.geoPointValue.longitude)===Wt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Wt(s.integerValue)===Wt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Wt(s.doubleValue),a=Wt(i.doubleValue);return o===a?Bu(o)===Bu(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Xa(n.arrayValue.values||[],e.arrayValue.values||[],cs);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(Uy(o)!==Uy(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!cs(o[l],a[l])))return!1;return!0}(n,e);default:return Oe()}}function Ku(n,e){return(n.values||[]).find(t=>cs(t,e))!==void 0}function Bi(n,e){if(n===e)return 0;const t=qi(n),r=qi(e);if(t!==r)return Je(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Je(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=Wt(i.integerValue||i.doubleValue),l=Wt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return qy(n.timestampValue,e.timestampValue);case 4:return qy(zu(n),zu(e));case 5:return Je(n.stringValue,e.stringValue);case 6:return function(i,o){const a=zs(i),l=zs(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const h=Je(a[c],l[c]);if(h!==0)return h}return Je(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Je(Wt(i.latitude),Wt(o.latitude));return a!==0?a:Je(Wt(i.longitude),Wt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return By(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,c,h;const f=i.fields||{},g=o.fields||{},y=(a=f.value)===null||a===void 0?void 0:a.arrayValue,I=(l=g.value)===null||l===void 0?void 0:l.arrayValue,A=Je(((c=y==null?void 0:y.values)===null||c===void 0?void 0:c.length)||0,((h=I==null?void 0:I.values)===null||h===void 0?void 0:h.length)||0);return A!==0?A:By(y,I)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===ki.mapValue&&o===ki.mapValue)return 0;if(i===ki.mapValue)return 1;if(o===ki.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},h=Object.keys(c);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const g=Je(l[f],h[f]);if(g!==0)return g;const y=Bi(a[l[f]],c[h[f]]);if(y!==0)return y}return Je(l.length,h.length)}(n.mapValue,e.mapValue);default:throw Oe()}}function qy(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Je(n,e);const t=Bs(n),r=Bs(e),s=Je(t.seconds,r.seconds);return s!==0?s:Je(t.nanos,r.nanos)}function By(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Bi(t[s],r[s]);if(i)return i}return Je(t.length,r.length)}function tl(n){return Sp(n)}function Sp(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Bs(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return zs(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return De.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=Sp(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${Sp(t.fields[o])}`;return s+"}"}(n.mapValue):Oe()}function wd(n){switch(qi(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Rh(n);return e?16+wd(e):16;case 5:return 2*n.stringValue.length;case 6:return zs(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+wd(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Zi(r.fields,(i,o)=>{s+=i.length+wd(o)}),s}(n.mapValue);default:throw Oe()}}function jo(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Pp(n){return!!n&&"integerValue"in n}function Gu(n){return!!n&&"arrayValue"in n}function zy(n){return!!n&&"nullValue"in n}function Ky(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function xd(n){return!!n&&"mapValue"in n}function Ch(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Tu(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Zi(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Tu(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Tu(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Nw(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const Vw={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function CC(n){return"nullValue"in n?bd:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?jo(Uo.empty(),De.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Ch(n)?Vw:{mapValue:{}}:Oe()}function kC(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?jo(Uo.empty(),De.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?Vw:"mapValue"in n?Ch(n)?{mapValue:{}}:ki:Oe()}function Gy(n,e){const t=Bi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Hy(n,e){const t=Bi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ln{constructor(e){this.value=e}static empty(){return new Ln({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!xd(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Tu(t)}setAll(e){let t=Qt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Tu(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());xd(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return cs(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];xd(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Zi(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Ln(Tu(this.value))}}function Ow(n){const e=[];return Zi(n.fields,(t,r)=>{const s=new Qt([t]);if(xd(r)){const i=Ow(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new cr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bt{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Bt(e,0,qe.min(),qe.min(),qe.min(),Ln.empty(),0)}static newFoundDocument(e,t,r,s){return new Bt(e,1,t,qe.min(),r,s,0)}static newNoDocument(e,t){return new Bt(e,2,t,qe.min(),qe.min(),Ln.empty(),0)}static newUnknownDocument(e,t){return new Bt(e,3,t,qe.min(),qe.min(),Ln.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(qe.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ln.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ln.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=qe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Bt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Bt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi{constructor(e,t){this.position=e,this.inclusive=t}}function Wy(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=De.comparator(De.fromName(o.referenceValue),t.key):r=Bi(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Qy(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!cs(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hu{constructor(e,t="asc"){this.field=e,this.dir=t}}function DC(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mw{}class ft extends Mw{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new NC(e,t,r):t==="array-contains"?new MC(e,r):t==="in"?new qw(e,r):t==="not-in"?new LC(e,r):t==="array-contains-any"?new $C(e,r):new ft(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new VC(e,r):new OC(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Bi(t,this.value)):t!==null&&qi(this.value)===qi(t)&&this.matchesComparison(Bi(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Oe()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Rt extends Mw{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Rt(e,t)}matches(e){return nl(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function nl(n){return n.op==="and"}function Rp(n){return n.op==="or"}function Dm(n){return Lw(n)&&nl(n)}function Lw(n){for(const e of n.filters)if(e instanceof Rt)return!1;return!0}function Cp(n){if(n instanceof ft)return n.field.canonicalString()+n.op.toString()+tl(n.value);if(Dm(n))return n.filters.map(e=>Cp(e)).join(",");{const e=n.filters.map(t=>Cp(t)).join(",");return`${n.op}(${e})`}}function $w(n,e){return n instanceof ft?function(r,s){return s instanceof ft&&r.op===s.op&&r.field.isEqual(s.field)&&cs(r.value,s.value)}(n,e):n instanceof Rt?function(r,s){return s instanceof Rt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&$w(o,s.filters[a]),!0):!1}(n,e):void Oe()}function Fw(n,e){const t=n.filters.concat(e);return Rt.create(t,n.op)}function Uw(n){return n instanceof ft?function(t){return`${t.field.canonicalString()} ${t.op} ${tl(t.value)}`}(n):n instanceof Rt?function(t){return t.op.toString()+" {"+t.getFilters().map(Uw).join(" ,")+"}"}(n):"Filter"}class NC extends ft{constructor(e,t,r){super(e,t,r),this.key=De.fromName(r.referenceValue)}matches(e){const t=De.comparator(e.key,this.key);return this.matchesComparison(t)}}class VC extends ft{constructor(e,t){super(e,"in",t),this.keys=jw("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class OC extends ft{constructor(e,t){super(e,"not-in",t),this.keys=jw("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function jw(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>De.fromName(r.referenceValue))}class MC extends ft{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Gu(t)&&Ku(t.arrayValue,this.value)}}class qw extends ft{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Ku(this.value.arrayValue,t)}}class LC extends ft{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ku(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Ku(this.value.arrayValue,t)}}class $C extends ft{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Gu(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Ku(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FC{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function kp(n,e=null,t=[],r=[],s=null,i=null,o=null){return new FC(n,e,t,r,s,i,o)}function qo(n){const e=Re(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Cp(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),hc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>tl(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>tl(r)).join(",")),e.ue=t}return e.ue}function fc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!DC(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!$w(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Qy(n.startAt,e.startAt)&&Qy(n.endAt,e.endAt)}function Bd(n){return De.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function zd(n,e){return n.filters.filter(t=>t instanceof ft&&t.field.isEqual(e))}function Jy(n,e,t){let r=bd,s=!0;for(const i of zd(n,e)){let o=bd,a=!0;switch(i.op){case"<":case"<=":o=CC(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=bd}Gy({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Gy({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function Yy(n,e,t){let r=ki,s=!0;for(const i of zd(n,e)){let o=ki,a=!0;switch(i.op){case">=":case">":o=kC(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=ki}Hy({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Hy({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qs{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Bw(n,e,t,r,s,i,o,a){return new Qs(n,e,t,r,s,i,o,a)}function bl(n){return new Qs(n)}function Xy(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Nm(n){return n.collectionGroup!==null}function ja(n){const e=Re(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Ct(Qt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new Hu(i,r))}),t.has(Qt.keyField().canonicalString())||e.ce.push(new Hu(Qt.keyField(),r))}return e.ce}function Qn(n){const e=Re(n);return e.le||(e.le=Kw(e,ja(n))),e.le}function zw(n){const e=Re(n);return e.he||(e.he=Kw(e,n.explicitOrderBy)),e.he}function Kw(n,e){if(n.limitType==="F")return kp(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Hu(s.field,i)});const t=n.endAt?new zi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new zi(n.startAt.position,n.startAt.inclusive):null;return kp(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Dp(n,e){const t=n.filters.concat([e]);return new Qs(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Kd(n,e,t){return new Qs(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function pc(n,e){return fc(Qn(n),Qn(e))&&n.limitType===e.limitType}function Gw(n){return`${qo(Qn(n))}|lt:${n.limitType}`}function ka(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>Uw(s)).join(", ")}]`),hc(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>tl(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>tl(s)).join(",")),`Target(${r})`}(Qn(n))}; limitType=${n.limitType})`}function mc(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):De.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of ja(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=Wy(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,ja(r),s)||r.endAt&&!function(o,a,l){const c=Wy(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,ja(r),s))}(n,e)}function Hw(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Ww(n){return(e,t)=>{let r=!1;for(const s of ja(n)){const i=UC(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function UC(n,e,t){const r=n.field.isKeyField()?De.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?Bi(l,c):Oe()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Oe()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Js{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Zi(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return kw(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jC=new Ut(De.comparator);function dr(){return jC}const Qw=new Ut(De.comparator);function du(...n){let e=Qw;for(const t of n)e=e.insert(t.key,t);return e}function Jw(n){let e=Qw;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function rs(){return Au()}function Yw(){return Au()}function Au(){return new Js(n=>n.toString(),(n,e)=>n.isEqual(e))}const qC=new Ut(De.comparator),BC=new Ct(De.comparator);function nt(...n){let e=BC;for(const t of n)e=e.add(t);return e}const zC=new Ct(Je);function Vm(){return zC}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Om(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Bu(e)?"-0":e}}function Xw(n){return{integerValue:""+n}}function Zw(n,e){return Tw(e)?Xw(e):Om(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kh{constructor(){this._=void 0}}function KC(n,e,t){return n instanceof rl?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Ph(i)&&(i=Rh(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof Bo?tx(n,e):n instanceof zo?nx(n,e):function(s,i){const o=ex(s,i),a=Zy(o)+Zy(s.Pe);return Pp(o)&&Pp(s.Pe)?Xw(a):Om(s.serializer,a)}(n,e)}function GC(n,e,t){return n instanceof Bo?tx(n,e):n instanceof zo?nx(n,e):t}function ex(n,e){return n instanceof sl?function(r){return Pp(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class rl extends kh{}class Bo extends kh{constructor(e){super(),this.elements=e}}function tx(n,e){const t=rx(e);for(const r of n.elements)t.some(s=>cs(s,r))||t.push(r);return{arrayValue:{values:t}}}class zo extends kh{constructor(e){super(),this.elements=e}}function nx(n,e){let t=rx(e);for(const r of n.elements)t=t.filter(s=>!cs(s,r));return{arrayValue:{values:t}}}class sl extends kh{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Zy(n){return Wt(n.integerValue||n.doubleValue)}function rx(n){return Gu(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gc{constructor(e,t){this.field=e,this.transform=t}}function HC(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof Bo&&s instanceof Bo||r instanceof zo&&s instanceof zo?Xa(r.elements,s.elements,cs):r instanceof sl&&s instanceof sl?cs(r.Pe,s.Pe):r instanceof rl&&s instanceof rl}(n.transform,e.transform)}class WC{constructor(e,t){this.version=e,this.transformResults=t}}class Jt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Jt}static exists(e){return new Jt(void 0,e)}static updateTime(e){return new Jt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Id(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Dh{}function sx(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new xl(n.key,Jt.none()):new wl(n.key,n.data,Jt.none());{const t=n.data,r=Ln.empty();let s=new Ct(Qt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Ys(n.key,r,new cr(s.toArray()),Jt.none())}}function QC(n,e,t){n instanceof wl?function(s,i,o){const a=s.value.clone(),l=t0(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Ys?function(s,i,o){if(!Id(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=t0(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(ix(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Su(n,e,t,r){return n instanceof wl?function(i,o,a,l){if(!Id(i.precondition,o))return a;const c=i.value.clone(),h=n0(i.fieldTransforms,l,o);return c.setAll(h),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof Ys?function(i,o,a,l){if(!Id(i.precondition,o))return a;const c=n0(i.fieldTransforms,l,o),h=o.data;return h.setAll(ix(i)),h.setAll(c),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Id(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function JC(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=ex(r.transform,s||null);i!=null&&(t===null&&(t=Ln.empty()),t.set(r.field,i))}return t||null}function e0(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Xa(r,s,(i,o)=>HC(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class wl extends Dh{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ys extends Dh{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function ix(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function t0(n,e,t){const r=new Map;Le(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,GC(o,a,t[s]))}return r}function n0(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,KC(i,o,e))}return r}class xl extends Dh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Mm extends Dh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lm{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&QC(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Su(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Su(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Yw();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=sx(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(qe.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),nt())}isEqual(e){return this.batchId===e.batchId&&Xa(this.mutations,e.mutations,(t,r)=>e0(t,r))&&Xa(this.baseMutations,e.baseMutations,(t,r)=>e0(t,r))}}class $m{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Le(e.mutations.length===r.length);let s=function(){return qC}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new $m(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fm{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ox{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YC{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var gn,_t;function ax(n){switch(n){default:return Oe();case J.CANCELLED:case J.UNKNOWN:case J.DEADLINE_EXCEEDED:case J.RESOURCE_EXHAUSTED:case J.INTERNAL:case J.UNAVAILABLE:case J.UNAUTHENTICATED:return!1;case J.INVALID_ARGUMENT:case J.NOT_FOUND:case J.ALREADY_EXISTS:case J.PERMISSION_DENIED:case J.FAILED_PRECONDITION:case J.ABORTED:case J.OUT_OF_RANGE:case J.UNIMPLEMENTED:case J.DATA_LOSS:return!0}}function lx(n){if(n===void 0)return dn("GRPC error has no .code"),J.UNKNOWN;switch(n){case gn.OK:return J.OK;case gn.CANCELLED:return J.CANCELLED;case gn.UNKNOWN:return J.UNKNOWN;case gn.DEADLINE_EXCEEDED:return J.DEADLINE_EXCEEDED;case gn.RESOURCE_EXHAUSTED:return J.RESOURCE_EXHAUSTED;case gn.INTERNAL:return J.INTERNAL;case gn.UNAVAILABLE:return J.UNAVAILABLE;case gn.UNAUTHENTICATED:return J.UNAUTHENTICATED;case gn.INVALID_ARGUMENT:return J.INVALID_ARGUMENT;case gn.NOT_FOUND:return J.NOT_FOUND;case gn.ALREADY_EXISTS:return J.ALREADY_EXISTS;case gn.PERMISSION_DENIED:return J.PERMISSION_DENIED;case gn.FAILED_PRECONDITION:return J.FAILED_PRECONDITION;case gn.ABORTED:return J.ABORTED;case gn.OUT_OF_RANGE:return J.OUT_OF_RANGE;case gn.UNIMPLEMENTED:return J.UNIMPLEMENTED;case gn.DATA_LOSS:return J.DATA_LOSS;default:return Oe()}}(_t=gn||(gn={}))[_t.OK=0]="OK",_t[_t.CANCELLED=1]="CANCELLED",_t[_t.UNKNOWN=2]="UNKNOWN",_t[_t.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",_t[_t.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",_t[_t.NOT_FOUND=5]="NOT_FOUND",_t[_t.ALREADY_EXISTS=6]="ALREADY_EXISTS",_t[_t.PERMISSION_DENIED=7]="PERMISSION_DENIED",_t[_t.UNAUTHENTICATED=16]="UNAUTHENTICATED",_t[_t.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",_t[_t.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",_t[_t.ABORTED=10]="ABORTED",_t[_t.OUT_OF_RANGE=11]="OUT_OF_RANGE",_t[_t.UNIMPLEMENTED=12]="UNIMPLEMENTED",_t[_t.INTERNAL=13]="INTERNAL",_t[_t.UNAVAILABLE=14]="UNAVAILABLE",_t[_t.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gd=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ux(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XC=new Mo([4294967295,4294967295],0);function r0(n){const e=ux().encode(n),t=new cw;return t.update(e),new Uint8Array(t.digest())}function s0(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Mo([t,r],0),new Mo([s,i],0)]}class Um{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new hu(`Invalid padding: ${t}`);if(r<0)throw new hu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new hu(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new hu(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Mo.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(Mo.fromNumber(r)));return s.compare(XC)===1&&(s=new Mo([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=r0(e),[r,s]=s0(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Um(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=r0(e),[r,s]=s0(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class hu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vc{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,yc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new vc(qe.min(),s,new Ut(Je),dr(),nt())}}class yc{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new yc(r,t,nt(),nt(),nt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ed{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class cx{constructor(e,t){this.targetId=e,this.me=t}}class dx{constructor(e,t,r=on.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class i0{constructor(){this.fe=0,this.ge=a0(),this.pe=on.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=nt(),t=nt(),r=nt();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:Oe()}}),new yc(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=a0()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Le(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class ZC{constructor(e){this.Le=e,this.Be=new Map,this.ke=dr(),this.qe=o0(),this.Qe=new Ut(Je)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:Oe()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(Bd(i))if(r===0){const o=new De(i.path);this.Ue(t,o,Bt.newNoDocument(o,qe.min()))}else Le(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}Gd==null||Gd.et(function(h,f,g,y,I){var A,S,$,U,M,L;const se={localCacheCount:h,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},Q=f.unchangedNames;return Q&&(se.bloomFilter={applied:I===0,hashCount:(A=Q==null?void 0:Q.hashCount)!==null&&A!==void 0?A:0,bitmapLength:(U=($=(S=Q==null?void 0:Q.bits)===null||S===void 0?void 0:S.bitmap)===null||$===void 0?void 0:$.length)!==null&&U!==void 0?U:0,padding:(L=(M=Q==null?void 0:Q.bits)===null||M===void 0?void 0:M.padding)!==null&&L!==void 0?L:0,mightContain:x=>{var b;return(b=y==null?void 0:y.mightContain(x))!==null&&b!==void 0&&b}}),se}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=zs(r).toUint8Array()}catch(l){if(l instanceof Dw)return kr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Um(o,s,i)}catch(l){return kr(l instanceof hu?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&Bd(a.target)){const l=new De(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,Bt.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=nt();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Je(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new vc(e,t,this.Qe,this.ke,r);return this.ke=dr(),this.qe=o0(),this.Qe=new Ut(Je),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new i0,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Ct(Je),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||pe("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new i0),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function o0(){return new Ut(De.comparator)}function a0(){return new Ut(De.comparator)}const ek=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),tk=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),nk=(()=>({and:"AND",or:"OR"}))();class rk{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Np(n,e){return n.useProto3Json||hc(e)?e:{value:e}}function il(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function hx(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function sk(n,e){return il(n,e.toTimestamp())}function fn(n){return Le(!!n),qe.fromTimestamp(function(t){const r=Bs(t);return new tn(r.seconds,r.nanos)}(n))}function jm(n,e){return Vp(n,e).canonicalString()}function Vp(n,e){const t=function(s){return new ht(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function fx(n){const e=ht.fromString(n);return Le(Ix(e)),e}function Wu(n,e){return jm(n.databaseId,e.path)}function os(n,e){const t=fx(e);if(t.get(1)!==n.databaseId.projectId)throw new me(J.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new me(J.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new De(gx(t))}function px(n,e){return jm(n.databaseId,e)}function mx(n){const e=fx(n);return e.length===4?ht.emptyPath():gx(e)}function Op(n){return new ht(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function gx(n){return Le(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function l0(n,e,t){return{name:Wu(n,e),fields:t.value.mapValue.fields}}function vx(n,e,t){const r=os(n,e.name),s=fn(e.updateTime),i=e.createTime?fn(e.createTime):qe.min(),o=new Ln({mapValue:{fields:e.fields}}),a=Bt.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function ik(n,e){return"found"in e?function(r,s){Le(!!s.found),s.found.name,s.found.updateTime;const i=os(r,s.found.name),o=fn(s.found.updateTime),a=s.found.createTime?fn(s.found.createTime):qe.min(),l=new Ln({mapValue:{fields:s.found.fields}});return Bt.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){Le(!!s.missing),Le(!!s.readTime);const i=os(r,s.missing),o=fn(s.readTime);return Bt.newNoDocument(i,o)}(n,e):Oe()}function ok(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:Oe()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,h){return c.useProto3Json?(Le(h===void 0||typeof h=="string"),on.fromBase64String(h||"")):(Le(h===void 0||h instanceof Buffer||h instanceof Uint8Array),on.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const h=c.code===void 0?J.UNKNOWN:lx(c.code);return new me(h,c.message||"")}(o);t=new dx(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=os(n,r.document.name),i=fn(r.document.updateTime),o=r.document.createTime?fn(r.document.createTime):qe.min(),a=new Ln({mapValue:{fields:r.document.fields}}),l=Bt.newFoundDocument(s,i,o,a),c=r.targetIds||[],h=r.removedTargetIds||[];t=new Ed(c,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=os(n,r.document),i=r.readTime?fn(r.readTime):qe.min(),o=Bt.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Ed([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=os(n,r.document),i=r.removedTargetIds||[];t=new Ed([],i,s,null)}else{if(!("filter"in e))return Oe();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new YC(s,i),a=r.targetId;t=new cx(a,o)}}return t}function Qu(n,e){let t;if(e instanceof wl)t={update:l0(n,e.key,e.value)};else if(e instanceof xl)t={delete:Wu(n,e.key)};else if(e instanceof Ys)t={update:l0(n,e.key,e.data),updateMask:hk(e.fieldMask)};else{if(!(e instanceof Mm))return Oe();t={verify:Wu(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof rl)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Bo)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof zo)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof sl)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw Oe()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:sk(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Oe()}(n,e.precondition)),t}function Mp(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?Jt.updateTime(fn(i.updateTime)):i.exists!==void 0?Jt.exists(i.exists):Jt.none()}(e.currentDocument):Jt.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Le(a.setToServerValue==="REQUEST_TIME"),l=new rl;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new Bo(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new zo(h)}else"increment"in a?l=new sl(o,a.increment):Oe();const c=Qt.fromServerFormat(a.fieldPath);return new gc(c,l)}(n,s)):[];if(e.update){e.update.name;const s=os(n,e.update.name),i=new Ln({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new cr(c.map(h=>Qt.fromServerFormat(h)))}(e.updateMask);return new Ys(s,i,o,t,r)}return new wl(s,i,t,r)}if(e.delete){const s=os(n,e.delete);return new xl(s,t)}if(e.verify){const s=os(n,e.verify);return new Mm(s,t)}return Oe()}function ak(n,e){return n&&n.length>0?(Le(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?fn(s.updateTime):fn(i);return o.isEqual(qe.min())&&(o=fn(i)),new WC(o,s.transformResults||[])}(t,e))):[]}function yx(n,e){return{documents:[px(n,e.path)]}}function Nh(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=px(n,s);const i=function(c){if(c.length!==0)return xx(Rt.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(h=>function(g){return{field:Ii(g.field),direction:uk(g.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Np(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function _x(n,e,t,r){const{_t:s,parent:i}=Nh(n,e),o={},a=[];let l=0;return t.forEach(c=>{const h=r?c.alias:"aggregate_"+l++;o[h]=c.alias,c.aggregateType==="count"?a.push({alias:h,count:{}}):c.aggregateType==="avg"?a.push({alias:h,avg:{field:Ii(c.fieldPath)}}):c.aggregateType==="sum"&&a.push({alias:h,sum:{field:Ii(c.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function bx(n){let e=mx(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Le(r===1);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const g=wx(f);return g instanceof Rt&&Dm(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(I){return new Hu(Da(I.field),function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(I.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,hc(g)?null:g}(t.limit));let l=null;t.startAt&&(l=function(f){const g=!!f.before,y=f.values||[];return new zi(y,g)}(t.startAt));let c=null;return t.endAt&&(c=function(f){const g=!f.before,y=f.values||[];return new zi(y,g)}(t.endAt)),Bw(e,s,o,i,a,"F",l,c)}function lk(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Oe()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function wx(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Da(t.unaryFilter.field);return ft.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Da(t.unaryFilter.field);return ft.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Da(t.unaryFilter.field);return ft.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Da(t.unaryFilter.field);return ft.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Oe()}}(n):n.fieldFilter!==void 0?function(t){return ft.create(Da(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Oe()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Rt.create(t.compositeFilter.filters.map(r=>wx(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Oe()}}(t.compositeFilter.op))}(n):Oe()}function uk(n){return ek[n]}function ck(n){return tk[n]}function dk(n){return nk[n]}function Ii(n){return{fieldPath:n.canonicalString()}}function Da(n){return Qt.fromServerFormat(n.fieldPath)}function xx(n){return n instanceof ft?function(t){if(t.op==="=="){if(Ky(t.value))return{unaryFilter:{field:Ii(t.field),op:"IS_NAN"}};if(zy(t.value))return{unaryFilter:{field:Ii(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Ky(t.value))return{unaryFilter:{field:Ii(t.field),op:"IS_NOT_NAN"}};if(zy(t.value))return{unaryFilter:{field:Ii(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ii(t.field),op:ck(t.op),value:t.value}}}(n):n instanceof Rt?function(t){const r=t.getFilters().map(s=>xx(s));return r.length===1?r[0]:{compositeFilter:{op:dk(t.op),filters:r}}}(n):Oe()}function hk(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Ix(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cs{constructor(e,t,r,s,i=qe.min(),o=qe.min(),a=on.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Cs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Cs(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Cs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Cs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ex{constructor(e){this.ct=e}}function fk(n,e){let t;if(e.document)t=vx(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=De.fromSegments(e.noDocument.path),s=Go(e.noDocument.readTime);t=Bt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Oe();{const r=De.fromSegments(e.unknownDocument.path),s=Go(e.unknownDocument.version);t=Bt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new tn(s[0],s[1]);return qe.fromTimestamp(i)}(e.readTime)),t}function u0(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Hd(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:Wu(i,o.key),fields:o.data.value.mapValue.fields,updateTime:il(i,o.version.toTimestamp()),createTime:il(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Ko(e.version)};else{if(!e.isUnknownDocument())return Oe();r.unknownDocument={path:t.path.toArray(),version:Ko(e.version)}}return r}function Hd(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Ko(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Go(n){const e=new tn(n.seconds,n.nanoseconds);return qe.fromTimestamp(e)}function Ro(n,e){const t=(e.baseMutations||[]).map(i=>Mp(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>Mp(n.ct,i)),s=tn.fromMillis(e.localWriteTimeMs);return new Lm(e.batchId,s,t,r)}function fu(n){const e=Go(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Go(n.lastLimboFreeSnapshotVersion):qe.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return Le(i.documents.length===1),Qn(bl(mx(i.documents[0])))}(n.query):function(i){return Qn(bx(i))}(n.query),new Cs(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,on.fromBase64String(n.resumeToken))}function Tx(n,e){const t=Ko(e.snapshotVersion),r=Ko(e.lastLimboFreeSnapshotVersion);let s;s=Bd(e.target)?yx(n.ct,e.target):Nh(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:qo(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function qm(n){const e=bx({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Kd(e,e.limit,"L"):e}function Bf(n,e){return new Fm(e.largestBatchId,Mp(n.ct,e.overlayMutation))}function c0(n,e){const t=e.path.lastSegment();return[n,Wn(e.path.popLast()),t]}function d0(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Ko(r.readTime),documentKey:Wn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pk{getBundleMetadata(e,t){return h0(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:Go(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return h0(e).put(function(s){return{bundleId:s.id,createTime:Ko(fn(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return f0(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:qm(i.bundledQuery),readTime:Go(i.readTime)}}(r)})}saveNamedQuery(e,t){return f0(e).put(function(s){return{name:s.name,readTime:Ko(fn(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function h0(n){return xn(n,"bundles")}function f0(n){return xn(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vh{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new Vh(e,r)}getOverlay(e,t){return eu(e).get(c0(this.userId,t)).next(r=>r?Bf(this.serializer,r):null)}getOverlays(e,t){const r=rs();return z.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Fm(t,o);s.push(this.ht(e,a))}),z.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(Wn(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(eu(e).j("collectionPathOverlayIndex",a))}),z.waitFor(i)}getOverlaysForCollection(e,t,r){const s=rs(),i=Wn(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return eu(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=Bf(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=rs();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return eu(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,h)=>{const f=Bf(this.serializer,c);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}ht(e,t){return eu(e).put(function(s,i,o){const[a,l,c]=c0(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Qu(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function eu(n){return xn(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mk{Pt(e){return xn(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?on.fromUint8Array(r):on.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Co{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Wt(e.integerValue));else if("doubleValue"in e){const r=Wt(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),Bu(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=Bs(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(zs(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?Nw(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Ch(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Oe()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(Wt(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),De.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}Co.vt=new Co;function gk(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function p0(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=gk(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class vk{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=p0(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=p0(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class yk{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class _k{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class tu{constructor(){this.jt=new vk,this.Ht=new yk(this.jt),this.Jt=new _k(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ko{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new ko(this.indexId,this.documentKey,this.arrayValue,r)}}function gi(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=m0(n.arrayValue,e.arrayValue),t!==0?t:(t=m0(n.directionalValue,e.directionalValue),t!==0?t:De.comparator(n.documentKey,e.documentKey)))}function m0(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g0{constructor(e){this.Xt=new Ct((t,r)=>Qt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Le(e.collectionGroup===this.collectionId),this.nn)return!1;const t=Tp(e);if(t!==void 0&&!this.sn(t))return!1;const r=To(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new Ct(Qt.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Lo(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Lo(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Lo(r.field,r.dir==="asc"?0:1)));return new Za(Za.UNKNOWN_ID,this.collectionId,t,el.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ax(n){var e,t;if(Le(n instanceof ft||n instanceof Rt),n instanceof ft){if(n instanceof qw){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>ft.create(n.field,"==",i)))||[];return Rt.create(s,"or")}return n}const r=n.filters.map(s=>Ax(s));return Rt.create(r,n.op)}function bk(n){if(n.getFilters().length===0)return[];const e=Fp(Ax(n));return Le(Sx(e)),Lp(e)||$p(e)?[e]:e.getFilters()}function Lp(n){return n instanceof ft}function $p(n){return n instanceof Rt&&Dm(n)}function Sx(n){return Lp(n)||$p(n)||function(t){if(t instanceof Rt&&Rp(t)){for(const r of t.getFilters())if(!Lp(r)&&!$p(r))return!1;return!0}return!1}(n)}function Fp(n){if(Le(n instanceof ft||n instanceof Rt),n instanceof ft)return n;if(n.filters.length===1)return Fp(n.filters[0]);const e=n.filters.map(r=>Fp(r));let t=Rt.create(e,n.op);return t=Wd(t),Sx(t)?t:(Le(t instanceof Rt),Le(nl(t)),Le(t.filters.length>1),t.filters.reduce((r,s)=>Bm(r,s)))}function Bm(n,e){let t;return Le(n instanceof ft||n instanceof Rt),Le(e instanceof ft||e instanceof Rt),t=n instanceof ft?e instanceof ft?function(s,i){return Rt.create([s,i],"and")}(n,e):v0(n,e):e instanceof ft?v0(e,n):function(s,i){if(Le(s.filters.length>0&&i.filters.length>0),nl(s)&&nl(i))return Fw(s,i.getFilters());const o=Rp(s)?s:i,a=Rp(s)?i:s,l=o.filters.map(c=>Bm(c,a));return Rt.create(l,"or")}(n,e),Wd(t)}function v0(n,e){if(nl(e))return Fw(e,n.getFilters());{const t=e.filters.map(r=>Bm(n,r));return Rt.create(t,"or")}}function Wd(n){if(Le(n instanceof ft||n instanceof Rt),n instanceof ft)return n;const e=n.getFilters();if(e.length===1)return Wd(e[0]);if(Lw(n))return n;const t=e.map(s=>Wd(s)),r=[];return t.forEach(s=>{s instanceof ft?r.push(s):s instanceof Rt&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Rt.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk{constructor(){this.un=new zm}addToCollectionParentIndex(e,t){return this.un.add(t),z.resolve()}getCollectionParents(e,t){return z.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return z.resolve()}deleteFieldIndex(e,t){return z.resolve()}deleteAllFieldIndexes(e){return z.resolve()}createTargetIndexes(e,t){return z.resolve()}getDocumentsMatchingTarget(e,t){return z.resolve(null)}getIndexType(e,t){return z.resolve(0)}getFieldIndexes(e,t){return z.resolve([])}getNextCollectionGroupToUpdate(e){return z.resolve(null)}getMinOffset(e,t){return z.resolve(xr.min())}getMinOffsetFromCollectionGroup(e,t){return z.resolve(xr.min())}updateCollectionGroup(e,t,r){return z.resolve()}updateIndexEntries(e,t){return z.resolve()}}class zm{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Ct(ht.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Ct(ht.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sd=new Uint8Array(0);class xk{constructor(e,t){this.databaseId=t,this.cn=new zm,this.ln=new Js(r=>qo(r),(r,s)=>fc(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:Wn(s)};return y0(e).put(i)}return z.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[_w(t),""],!1,!0);return y0(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(ns(o.parent))}return r})}addFieldIndex(e,t){const r=nu(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Aa(e);return i.next(a=>{o.put(d0(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=nu(e),s=Aa(e),i=Ta(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=nu(e),r=Ta(e),s=Aa(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return z.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new g0(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=Ta(e);let s=!0;const i=new Map;return z.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=nt();const a=[];return z.forEach(i,(l,c)=>{pe("IndexedDbIndexManager",`Using index ${function(M){return`id=${M.indexId}|cg=${M.collectionGroup}|f=${M.fields.map(L=>`${L.fieldPath}:${L.kind}`).join(",")}`}(l)} to execute ${qo(t)}`);const h=function(M,L){const se=Tp(L);if(se===void 0)return null;for(const Q of zd(M,se.fieldPath))switch(Q.op){case"array-contains-any":return Q.value.arrayValue.values||[];case"array-contains":return[Q.value]}return null}(c,l),f=function(M,L){const se=new Map;for(const Q of To(L))for(const x of zd(M,Q.fieldPath))switch(x.op){case"==":case"in":se.set(Q.fieldPath.canonicalString(),x.value);break;case"not-in":case"!=":return se.set(Q.fieldPath.canonicalString(),x.value),Array.from(se.values())}return null}(c,l),g=function(M,L){const se=[];let Q=!0;for(const x of To(L)){const b=x.kind===0?Jy(M,x.fieldPath,M.startAt):Yy(M,x.fieldPath,M.startAt);se.push(b.value),Q&&(Q=b.inclusive)}return new zi(se,Q)}(c,l),y=function(M,L){const se=[];let Q=!0;for(const x of To(L)){const b=x.kind===0?Yy(M,x.fieldPath,M.endAt):Jy(M,x.fieldPath,M.endAt);se.push(b.value),Q&&(Q=b.inclusive)}return new zi(se,Q)}(c,l),I=this.In(l,c,g),A=this.In(l,c,y),S=this.Tn(l,c,f),$=this.En(l.indexId,h,I,g.inclusive,A,y.inclusive,S);return z.forEach($,U=>r.G(U,t.limit).next(M=>{M.forEach(L=>{const se=De.fromSegments(L.documentKey);o.has(se)||(o=o.add(se),a.push(se))})}))}).next(()=>a)}return z.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=bk(Rt.create(e.filters,"and")).map(r=>kp(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),c=l/(t!=null?t.length:1),h=[];for(let f=0;f<l;++f){const g=t?this.dn(t[f/c]):sd,y=this.An(e,g,r[f%c],s),I=this.Rn(e,g,i[f%c],o),A=a.map(S=>this.An(e,g,S,!0));h.push(...this.createRange(y,I,A))}return h}An(e,t,r,s){const i=new ko(e,De.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new ko(e,De.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new g0(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return z.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new Ct(Qt.comparator),h=!1;for(const f of l.filters)for(const g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?h=!0:c=c.add(g.field));for(const f of l.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new tu;for(const s of To(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);Co.vt.It(i,o)}return r.zt()}dn(e){const t=new tu;return Co.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new tu;return Co.vt.It(jo(this.databaseId,t),r.Yt(function(i){const o=To(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new tu);let i=0;for(const o of To(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&Gu(a))s=this.gn(s,o,a);else{const c=l.Yt(o.kind);Co.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new tu;l.seed(a.zt()),Co.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof ft&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=nu(e),s=Aa(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return z.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(h,f){const g=f?new el(f.sequenceNumber,new xr(Go(f.readTime),new De(ns(f.documentKey)),f.largestBatchId)):el.empty(),y=h.fields.map(([I,A])=>new Lo(Qt.fromServerFormat(I),A));return new Za(h.indexId,h.collectionGroup,y,g)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Je(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=nu(e),i=Aa(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>z.forEach(a,l=>i.put(d0(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return z.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?z.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),z.forEach(a,l=>this.wn(e,s,l).next(c=>{const h=this.Sn(i,l);return c.isEqual(h)?z.resolve():this.bn(e,i,l,c,h)}))))})}Dn(e,t,r,s){return Ta(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return Ta(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=Ta(e);let i=new Ct(gi);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new ko(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new Ct(gi);const s=this.Vn(t,e);if(s==null)return r;const i=Tp(t);if(i!=null){const o=e.data.field(i.fieldPath);if(Gu(o))for(const a of o.arrayValue.values||[])r=r.add(new ko(t.indexId,e.key,this.dn(a),s))}else r=r.add(new ko(t.indexId,e.key,sd,s));return r}bn(e,t,r,s,i){pe("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,c,h,f,g){const y=l.getIterator(),I=c.getIterator();let A=Ea(y),S=Ea(I);for(;A||S;){let $=!1,U=!1;if(A&&S){const M=h(A,S);M<0?U=!0:M>0&&($=!0)}else A!=null?U=!0:$=!0;$?(f(S),S=Ea(I)):U?(g(A),A=Ea(y)):(A=Ea(y),S=Ea(I))}}(s,i,gi,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),z.waitFor(o)}yn(e){let t=1;return Aa(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>gi(o,a)).filter((o,a,l)=>!a||gi(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=gi(o,e),l=gi(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,sd,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,sd,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return gi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(_0)}getMinOffset(e,t){return z.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||Oe())).next(_0)}}function y0(n){return xn(n,"collectionParents")}function Ta(n){return xn(n,"indexEntries")}function nu(n){return xn(n,"indexConfiguration")}function Aa(n){return xn(n,"indexState")}function _0(n){Le(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Rm(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new xr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b0={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class zn{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new zn(e,zn.DEFAULT_COLLECTION_PERCENTILE,zn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Px(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(h,f,g)=>(a++,g.delete()));i.push(l.next(()=>{Le(a===1)}));const c=[];for(const h of t.mutations){const f=Aw(e,h.key.path,t.batchId);i.push(s.delete(f)),c.push(h.key)}return z.waitFor(i).next(()=>c)}function Qd(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Oe();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */zn.DEFAULT_COLLECTION_PERCENTILE=10,zn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,zn.DEFAULT=new zn(41943040,zn.DEFAULT_COLLECTION_PERCENTILE,zn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),zn.DISABLED=new zn(-1,0,0);class Oh{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){Le(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new Oh(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return vi(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Na(e),o=vi(e);return o.add({}).next(a=>{Le(typeof a=="number");const l=new Lm(a,t,r,s),c=function(y,I,A){const S=A.baseMutations.map(U=>Qu(y.ct,U)),$=A.mutations.map(U=>Qu(y.ct,U));return{userId:I,batchId:A.batchId,localWriteTimeMs:A.localWriteTime.toMillis(),baseMutations:S,mutations:$}}(this.serializer,this.userId,l),h=[];let f=new Ct((g,y)=>Je(g.canonicalString(),y.canonicalString()));for(const g of s){const y=Aw(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),h.push(o.put(c)),h.push(i.put(y,cC))}return f.forEach(g=>{h.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),z.waitFor(h).next(()=>l)})}lookupMutationBatch(e,t){return vi(e).get(t).next(r=>r?(Le(r.userId===this.userId),Ro(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?z.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return vi(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(Le(a.batchId>=r),i=Ro(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return vi(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return vi(e).U("userMutationsIndex",t).next(r=>r.map(s=>Ro(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=_d(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Na(e).J({range:s},(o,a,l)=>{const[c,h,f]=o,g=ns(h);if(c===this.userId&&t.path.isEqual(g))return vi(e).get(f).next(y=>{if(!y)throw Oe();Le(y.userId===this.userId),i.push(Ro(this.serializer,y))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ct(Je);const s=[];return t.forEach(i=>{const o=_d(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Na(e).J({range:a},(c,h,f)=>{const[g,y,I]=c,A=ns(y);g===this.userId&&i.path.isEqual(A)?r=r.add(I):f.done()});s.push(l)}),z.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=_d(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new Ct(Je);return Na(e).J({range:o},(l,c,h)=>{const[f,g,y]=l,I=ns(g);f===this.userId&&r.isPrefixOf(I)?I.length===s&&(a=a.add(y)):h.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(vi(e).get(i).next(o=>{if(o===null)throw Oe();Le(o.userId===this.userId),r.push(Ro(this.serializer,o))}))}),z.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return Px(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),z.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return z.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Na(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=ns(i[1]);s.push(l)}else a.done()}).next(()=>{Le(s.length===0)})})}containsKey(e,t){return Rx(e,this.userId,t)}Nn(e){return Cx(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Rx(n,e,t){const r=_d(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Na(n).J({range:i,H:!0},(a,l,c)=>{const[h,f,g]=a;h===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function vi(n){return xn(n,"mutations")}function Na(n){return xn(n,"documentMutations")}function Cx(n){return xn(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Ho(0)}static kn(){return new Ho(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ik{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new Ho(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>qe.fromTimestamp(new tn(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Sa(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Le(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Sa(e).J((o,a)=>{const l=fu(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>z.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Sa(e).J((r,s)=>{const i=fu(s);t(i)})}qn(e){return w0(e).get("targetGlobalKey").next(t=>(Le(t!==null),t))}Qn(e,t){return w0(e).put("targetGlobalKey",t)}Kn(e,t){return Sa(e).put(Tx(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=qo(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Sa(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const c=fu(a);fc(t,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=Ei(e);return t.forEach(o=>{const a=Wn(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),z.waitFor(s)}removeMatchingKeys(e,t,r){const s=Ei(e);return z.forEach(t,i=>{const o=Wn(i.path);return z.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=Ei(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=Ei(e);let i=nt();return s.J({range:r,H:!0},(o,a,l)=>{const c=ns(o[1]),h=new De(c);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=Wn(t.path),s=IDBKeyRange.bound([r],[_w(r)],!1,!0);let i=0;return Ei(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return Sa(e).get(t).next(r=>r?fu(r):null)}}function Sa(n){return xn(n,"targets")}function w0(n){return xn(n,"targetGlobal")}function Ei(n){return xn(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x0([n,e],[t,r]){const s=Je(n,t);return s===0?Je(e,r):s}class Ek{constructor(e){this.Un=e,this.buffer=new Ct(x0),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();x0(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class kx{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){pe("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Xi(t)?pe("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Yi(t)}await this.Hn(3e5)})}}class Tk{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return z.resolve(ur.oe);const r=new Ek(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(pe("LruGarbageCollector","Garbage collection skipped; disabled"),z.resolve(b0)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(pe("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),b0):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,c;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(pe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),Ca()<=dt.DEBUG&&pe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(c-l)+`ms
Total Duration: ${c-h}ms`),z.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function Dx(n,e){return new Tk(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ak{constructor(e,t){this.db=e,this.garbageCollector=Dx(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return id(e,r)}removeReference(e,t,r){return id(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return id(e,t)}nr(e,t){return function(s,i){let o=!1;return Cx(s).Y(a=>Rx(s,a,i).next(l=>(l&&(o=!0),z.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,qe.min()),Ei(e).delete(function(f){return[0,Wn(f.path)]}(o))))});s.push(l)}}).next(()=>z.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return id(e,t)}tr(e,t){const r=Ei(e);let s,i=ur.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==ur.oe&&t(new De(ns(s)),i),i=c,s=l):i=ur.oe}).next(()=>{i!==ur.oe&&t(new De(ns(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function id(n,e){return Ei(n).put(function(r,s){return{targetId:0,path:Wn(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nx{constructor(){this.changes=new Js(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Bt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?z.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sk{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return xo(e).put(r)}removeEntry(e,t,r){return xo(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Hd(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=Bt.newInvalidDocument(t);return xo(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ru(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:Bt.newInvalidDocument(t)};return xo(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ru(t))},(s,i)=>{r={document:this.ir(t,i),size:Qd(i)}}).next(()=>r)}getEntries(e,t){let r=dr();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=dr(),s=new Ut(De.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,Qd(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return z.resolve();let s=new Ct(T0);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(ru(s.first()),ru(s.last())),o=s.getIterator();let a=o.getNext();return xo(e).J({index:"documentKeyIndex",range:i},(l,c,h)=>{const f=De.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&T0(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?h.$(ru(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Hd(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return xo(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let h=dr();for(const f of c){const g=this.ir(De.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&(mc(t,g)||s.has(g.key))&&(h=h.insert(g.key,g))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=dr();const o=E0(t,r),a=E0(t,xr.max());return xo(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,h)=>{const f=this.ir(De.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new Pk(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return I0(e).get("remoteDocumentGlobalKey").next(t=>(Le(!!t),t))}rr(e,t){return I0(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=fk(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(qe.min())))return r}return Bt.newInvalidDocument(e)}}function Vx(n){return new Sk(n)}class Pk extends Nx{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Js(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new Ct((i,o)=>Je(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=u0(this.cr.serializer,o);s=s.add(i.path.popLast());const c=Qd(l);r+=c-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=u0(this.cr.serializer,o.convertToNoDocument(qe.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),z.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function I0(n){return xn(n,"remoteDocumentGlobal")}function xo(n){return xn(n,"remoteDocumentsV14")}function ru(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function E0(n,e){const t=e.documentKey.path.toArray();return[n,Hd(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function T0(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Je(t[i],r[i]),s)return s;return s=Je(t.length,r.length),s||(s=Je(t[t.length-2],r[r.length-2]),s||Je(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rk{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ox{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Su(r.mutation,s,cr.empty(),tn.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,nt()).next(()=>r))}getLocalViewOfDocuments(e,t,r=nt()){const s=rs();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=du();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=rs();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,nt()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=dr();const o=Au(),a=function(){return Au()}();return t.forEach((l,c)=>{const h=r.get(c.key);s.has(c.key)&&(h===void 0||h.mutation instanceof Ys)?i=i.insert(c.key,c):h!==void 0?(o.set(c.key,h.mutation.getFieldMask()),Su(h.mutation,c,h.mutation.getFieldMask(),tn.now())):o.set(c.key,cr.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,h)=>o.set(c,h)),t.forEach((c,h)=>{var f;return a.set(c,new Rk(h,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Au();let s=new Ut((o,a)=>o-a),i=nt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let h=r.get(l)||cr.empty();h=a.applyToLocalView(c,h),r.set(l,h);const f=(s.get(a.batchId)||nt()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,h=l.value,f=Yw();h.forEach(g=>{if(!i.has(g)){const y=sx(t.get(g),r.get(g));y!==null&&f.set(g,y),i=i.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return z.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return De.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Nm(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):z.resolve(rs());let a=-1,l=i;return o.next(c=>z.forEach(c,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?z.resolve():this.remoteDocumentCache.getEntry(e,h).next(g=>{l=l.insert(h,g)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,nt())).next(h=>({batchId:a,changes:Jw(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new De(t)).next(r=>{let s=du();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=du();return this.indexManager.getCollectionParents(e,i).next(a=>z.forEach(a,l=>{const c=function(f,g){return new Qs(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(h=>{h.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const h=c.getKey();o.get(h)===null&&(o=o.insert(h,Bt.newInvalidDocument(h)))});let a=du();return o.forEach((l,c)=>{const h=i.get(l);h!==void 0&&Su(h.mutation,c,cr.empty(),tn.now()),mc(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ck{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return z.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:fn(s.createTime)}}(t)),z.resolve()}getNamedQuery(e,t){return z.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:qm(s.bundledQuery),readTime:fn(s.readTime)}}(t)),z.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kk{constructor(){this.overlays=new Ut(De.comparator),this.Ir=new Map}getOverlay(e,t){return z.resolve(this.overlays.get(t))}getOverlays(e,t){const r=rs();return z.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),z.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),z.resolve()}getOverlaysForCollection(e,t,r){const s=rs(),i=t.length+1,o=new De(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return z.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Ut((c,h)=>c-h);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let h=i.get(c.largestBatchId);h===null&&(h=rs(),i=i.insert(c.largestBatchId,h)),h.set(c.getKey(),c)}}const a=rs(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,h)=>a.set(c,h)),!(a.size()>=s)););return z.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Fm(t,r));let i=this.Ir.get(t);i===void 0&&(i=nt(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dk{constructor(){this.sessionToken=on.EMPTY_BYTE_STRING}getSessionToken(e){return z.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,z.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Km{constructor(){this.Tr=new Ct(An.Er),this.dr=new Ct(An.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new An(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new An(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new De(new ht([])),r=new An(t,e),s=new An(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new De(new ht([])),r=new An(t,e),s=new An(t,e+1);let i=nt();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new An(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class An{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return De.comparator(e.key,t.key)||Je(e.wr,t.wr)}static Ar(e,t){return Je(e.wr,t.wr)||De.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nk{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Ct(An.Er)}checkEmpty(e){return z.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Lm(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new An(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return z.resolve(o)}lookupMutationBatch(e,t){return z.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return z.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return z.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return z.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new An(t,0),s=new An(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),z.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ct(Je);return t.forEach(s=>{const i=new An(s,0),o=new An(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),z.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;De.isDocumentKey(i)||(i=i.child(""));const o=new An(new De(i),0);let a=new Ct(Je);return this.br.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.wr)),!0)},o),z.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Le(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return z.forEach(t.mutations,s=>{const i=new An(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new An(t,0),s=this.br.firstAfterOrEqual(r);return z.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,z.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vk{constructor(e){this.Mr=e,this.docs=function(){return new Ut(De.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return z.resolve(r?r.document.mutableCopy():Bt.newInvalidDocument(t))}getEntries(e,t){let r=dr();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Bt.newInvalidDocument(s))}),z.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=dr();const o=t.path,a=new De(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:h}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Rm(ww(h),r)<=0||(s.has(h.key)||mc(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return z.resolve(i)}getAllFromCollectionGroup(e,t,r,s){Oe()}Or(e,t){return z.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Ok(this)}getSize(e){return z.resolve(this.size)}}class Ok extends Nx{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),z.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mk{constructor(e){this.persistence=e,this.Nr=new Js(t=>qo(t),fc),this.lastRemoteSnapshotVersion=qe.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Km,this.targetCount=0,this.kr=Ho.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),z.resolve()}getLastRemoteSnapshotVersion(e){return z.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return z.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),z.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),z.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Ho(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,z.resolve()}updateTargetData(e,t){return this.Kn(t),z.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,z.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),z.waitFor(i).next(()=>s)}getTargetCount(e){return z.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return z.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),z.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),z.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),z.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return z.resolve(r)}containsKey(e,t){return z.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gm{constructor(e,t){this.qr={},this.overlays={},this.Qr=new ur(0),this.Kr=!1,this.Kr=!0,this.$r=new Dk,this.referenceDelegate=e(this),this.Ur=new Mk(this),this.indexManager=new wk,this.remoteDocumentCache=function(s){return new Vk(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new Ex(t),this.Gr=new Ck(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new kk,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new Nk(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){pe("MemoryPersistence","Starting transaction:",e);const s=new Lk(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return z.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class Lk extends Iw{constructor(e){super(),this.currentSequenceNumber=e}}class Mh{constructor(e){this.persistence=e,this.Jr=new Km,this.Yr=null}static Zr(e){return new Mh(e)}get Xr(){if(this.Yr)return this.Yr;throw Oe()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),z.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),z.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),z.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return z.forEach(this.Xr,r=>{const s=De.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,qe.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return z.or([()=>z.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class Jd{constructor(e,t){this.persistence=e,this.ti=new Js(r=>Wn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=Dx(this,t)}static Zr(e,t){return new Jd(e,t)}zr(){}jr(e){return z.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return z.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?z.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,qe.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),z.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),z.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),z.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),z.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=wd(e.data.value)),t}nr(e,t,r){return z.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return z.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $k{constructor(e){this.serializer=e}O(e,t,r,s){const i=new Sh("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Fy,{unique:!0}),l.createObjectStore("documentMutations")}(e),A0(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=z.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),A0(e)),o=o.next(()=>function(l){const c=l.store("targetGlobal"),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:qe.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store("mutations").U().next(h=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Fy,{unique:!0});const f=c.store("mutations"),g=h.map(y=>f.put(y));return z.waitFor(g)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore("documentOverlays",{keyPath:xC});c.createIndex("collectionPathOverlayIndex",IC,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",EC,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore("remoteDocumentsV14",{keyPath:dC});c.createIndex("documentKeyIndex",hC),c.createIndex("collectionGroupIndex",fC)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:yC}).createIndex("sequenceNumberIndex",_C,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:bC}).createIndex("documentKeyIndex",wC,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=Qd(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>z.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>z.forEach(a,l=>{Le(l.userId===i.userId);const c=Ro(this.serializer,l);return Px(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new ht(o),c=function(f){return[0,Wn(f)]}(l);i.push(t.get(c).next(h=>h?z.resolve():(f=>t.put({targetId:0,path:Wn(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>z.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:vC});const r=t.store("collectionParents"),s=new zm,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Wn(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new ht(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],c)=>{const h=ns(a);return i(h.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=fu(s),o=Tx(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new De(ht.fromString(f.document.name).popFirst(5)):f.noDocument?De.fromSegments(f.noDocument.path):f.unknownDocument?De.fromSegments(f.unknownDocument.path):Oe()}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>z.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=Vx(this.serializer),i=new Gm(Mh.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var c;let h=(c=a.get(l.userId))!==null&&c!==void 0?c:nt();Ro(this.serializer,l).keys().forEach(f=>h=h.add(f)),a.set(l.userId,h)}),z.forEach(a,(l,c)=>{const h=new Sn(c),f=Vh.lt(this.serializer,h),g=i.getIndexManager(h),y=Oh.lt(h,this.serializer,g,i.referenceDelegate);return new Ox(s,y,f,g).recalculateAndSaveOverlaysForDocumentKeys(new Ap(t,ur.oe),l).next()})})}}function A0(n){n.createObjectStore("targetDocuments",{keyPath:mC}).createIndex("documentTargetsIndex",gC,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",pC,{unique:!0}),n.createObjectStore("targetGlobal")}const zf="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Hm{constructor(e,t,r,s,i,o,a,l,c,h,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=h,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=g=>Promise.resolve(),!Hm.D())throw new me(J.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Ak(this,s),this.Ai=t+"main",this.serializer=new Ex(l),this.Ri=new is(this.Ai,this.hi,new $k(this.serializer)),this.$r=new mk,this.Ur=new Ik(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Vx(this.serializer),this.Gr=new pk,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,h===!1&&dn("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new me(J.FAILED_PRECONDITION,zf);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new ur(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>od(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Xi(e))return pe("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return pe("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return su(e).get("owner").next(t=>z.resolve(this.vi(t)))}Ci(e){return od(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=xn(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return z.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?z.resolve(!0):su(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new me(J.FAILED_PRECONDITION,zf);return!1}}return!(!this.networkEnabled||!this.inForeground)||od(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&pe("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new Ap(e,ur.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>od(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Oh.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new xk(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Vh.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){pe("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?SC:l===16?AC:l===15?km:l===14?Rw:l===13?Pw:l===12?TC:l===11?Sw:void Oe()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new Ap(a,this.Qr?this.Qr.next():ur.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw dn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new me(J.FAILED_PRECONDITION,xw);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return su(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new me(J.FAILED_PRECONDITION,zf)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return su(e).put("owner",t)}static D(){return is.D()}bi(e){const t=su(e);return t.get("owner").next(r=>this.vi(r)?(pe("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):z.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(dn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;rw()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return pe("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return dn("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){dn("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function su(n){return xn(n,"owner")}function od(n){return xn(n,"clientMetadata")}function Wm(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=nt(),s=nt();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Qm(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fk{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mx{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return rw()?8:Ew(wn())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new Fk;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(Ca()<=dt.DEBUG&&pe("QueryEngine","SDK will not create cache indexes for query:",ka(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),z.resolve()):(Ca()<=dt.DEBUG&&pe("QueryEngine","Query:",ka(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Ca()<=dt.DEBUG&&pe("QueryEngine","The SDK decides to create cache indexes for query:",ka(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Qn(t))):z.resolve())}Yi(e,t){if(Xy(t))return z.resolve(null);let r=Qn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=Kd(t,null,"F"),r=Qn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=nt(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ts(t,a);return this.ns(t,c,o,l.readTime)?this.Yi(e,Kd(t,null,"F")):this.rs(e,c,t,l)}))})))}Zi(e,t,r,s){return Xy(t)||s.isEqual(qe.min())?z.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?z.resolve(null):(Ca()<=dt.DEBUG&&pe("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),ka(t)),this.rs(e,o,t,bw(s,-1)).next(a=>a))})}ts(e,t){let r=new Ct(Ww(e));return t.forEach((s,i)=>{mc(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return Ca()<=dt.DEBUG&&pe("QueryEngine","Using full collection scan to execute query:",ka(t)),this.Ji.getDocumentsMatchingQuery(e,t,xr.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uk{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Ut(Je),this._s=new Js(i=>qo(i),fc),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ox(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function Lx(n,e,t,r){return new Uk(n,e,t,r)}async function $x(n,e){const t=Re(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=nt();for(const c of s){o.push(c.batchId);for(const h of c.mutations)l=l.add(h.key)}for(const c of i){a.push(c.batchId);for(const h of c.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function jk(n,e){const t=Re(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,h){const f=c.batch,g=f.keys();let y=z.resolve();return g.forEach(I=>{y=y.next(()=>h.getEntry(l,I)).next(A=>{const S=c.docVersions.get(I);Le(S!==null),A.version.compareTo(S)<0&&(f.applyToRemoteDocument(A,c),A.isValidDocument()&&(A.setReadTime(c.commitVersion),h.addEntry(A)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=nt();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function Fx(n){const e=Re(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function qk(n,e){const t=Re(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((h,f)=>{const g=s.get(f);if(!g)return;a.push(t.Ur.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,h.addedDocuments,f)));let y=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(on.EMPTY_BYTE_STRING,qe.min()).withLastLimboFreeSnapshotVersion(qe.min()):h.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(h.resumeToken,r)),s=s.insert(f,y),function(A,S,$){return A.resumeToken.approximateByteSize()===0||S.snapshotVersion.toMicroseconds()-A.snapshotVersion.toMicroseconds()>=3e8?!0:$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0}(g,y,h)&&a.push(t.Ur.updateTargetData(i,y))});let l=dr(),c=nt();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(Ux(i,o,e.documentUpdates).next(h=>{l=h.Ps,c=h.Is})),!r.isEqual(qe.min())){const h=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return z.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.os=s,i))}function Ux(n,e,t){let r=nt(),s=nt();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=dr();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(qe.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):pe("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function Bk(n,e){const t=Re(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function ol(n,e){const t=Re(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,z.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new Cs(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function al(n,e,t){const r=Re(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Xi(o))throw o;pe("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Yd(n,e,t){const r=Re(n);let s=qe.min(),i=nt();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,h){const f=Re(l),g=f._s.get(h);return g!==void 0?z.resolve(f.os.get(g)):f.Ur.getTargetData(c,h)}(r,o,Qn(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:qe.min(),t?i:nt())).next(a=>(Bx(r,Hw(e),a),{documents:a,Ts:i})))}function jx(n,e){const t=Re(n),r=Re(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function qx(n,e){const t=Re(n),r=t.us.get(e)||qe.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,bw(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(Bx(t,e,s),s))}function Bx(n,e,t){let r=n.us.get(e)||qe.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function zk(n,e,t,r){const s=Re(n);let i=nt(),o=dr();for(const c of t){const h=e.Es(c.metadata.name);c.document&&(i=i.add(h));const f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(h,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await ol(s,function(h){return Qn(bl(ht.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>Ux(c,a,o).next(h=>(a.apply(c),h)).next(h=>s.Ur.removeMatchingKeysForTargetId(c,l.targetId).next(()=>s.Ur.addMatchingKeys(c,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,h.Ps,h.Is)).next(()=>h.Ps)))}async function Kk(n,e,t=nt()){const r=await ol(n,Qn(qm(e.bundledQuery))),s=Re(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=fn(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(on.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function S0(n,e){return`firestore_clients_${n}_${e}`}function P0(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Kf(n,e){return`firestore_targets_${n}_${e}`}class Xd{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new me(s.error.code,s.error.message))),o?new Xd(e,t,s.state,i):(dn("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Pu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new me(r.error.code,r.error.message))),i?new Pu(e,r.state,s):(dn("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Zd{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Vm();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=Tw(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Zd(e,i):(dn("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Jm{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Jm(t.clientId,t.onlineState):(dn("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Up{constructor(){this.activeTargetIds=Vm()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Gf{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Ut(Je),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=S0(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Up),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(S0(this.persistenceKey,r));if(s){const i=Zd.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Kf(this.persistenceKey,e));if(s){const i=Pu.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Kf(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return pe("SharedClientState","READ",e,t),t}setItem(e,t){pe("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){pe("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(pe("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void dn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=ur.oe;if(i!=null)try{const a=JSON.parse(i);Le(typeof a=="number"),o=a}catch(a){dn("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==ur.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new Xd(this.currentUser,e,t,r),i=P0(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=P0(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=Kf(this.persistenceKey,e),i=new Pu(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return Zd.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return Xd.Rs(new Sn(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return Pu.Rs(s,t)}Ls(e){return Jm.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);pe("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Vm();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class zx{constructor(){this.so=new Up,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Up,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gk{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R0{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){pe("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){pe("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ad=null;function Hf(){return ad===null?ad=function(){return 268435456+Math.round(2147483648*Math.random())}():ad++,"0x"+ad.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hk={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wk{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qn="WebChannelConnection";class Qk extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=Hf(),l=this.xo(t,r.toUriEncodedString());pe("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,l,c,s).then(h=>(pe("RestConnection",`Received RPC '${t}' ${a}: `,h),h),h=>{throw kr("RestConnection",`RPC '${t}' ${a} failed with error: `,h,"url: ",l,"request:",s),h})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+_l}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=Hk[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=Hf();return new Promise((o,a)=>{const l=new dw;l.setWithCredentials(!0),l.listenOnce(hw.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case yd.NO_ERROR:const h=l.getResponseJson();pe(qn,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(h)),o(h);break;case yd.TIMEOUT:pe(qn,`RPC '${e}' ${i} timed out`),a(new me(J.DEADLINE_EXCEEDED,"Request time out"));break;case yd.HTTP_ERROR:const f=l.getStatus();if(pe(qn,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let g=l.getResponseJson();Array.isArray(g)&&(g=g[0]);const y=g==null?void 0:g.error;if(y&&y.status&&y.message){const I=function(S){const $=S.toLowerCase().replace(/_/g,"-");return Object.values(J).indexOf($)>=0?$:J.UNKNOWN}(y.status);a(new me(I,y.message))}else a(new me(J.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new me(J.UNAVAILABLE,"Connection failed."));break;default:Oe()}}finally{pe(qn,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);pe(qn,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=Hf(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=mw(),a=pw(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const h=i.join("");pe(qn,`Creating RPC '${e}' stream ${s}: ${h}`,l);const f=o.createWebChannel(h,l);let g=!1,y=!1;const I=new Wk({Io:S=>{y?pe(qn,`Not sending because RPC '${e}' stream ${s} is closed:`,S):(g||(pe(qn,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),pe(qn,`RPC '${e}' stream ${s} sending:`,S),f.send(S))},To:()=>f.close()}),A=(S,$,U)=>{S.listen($,M=>{try{U(M)}catch(L){setTimeout(()=>{throw L},0)}})};return A(f,cu.EventType.OPEN,()=>{y||(pe(qn,`RPC '${e}' stream ${s} transport opened.`),I.yo())}),A(f,cu.EventType.CLOSE,()=>{y||(y=!0,pe(qn,`RPC '${e}' stream ${s} transport closed`),I.So())}),A(f,cu.EventType.ERROR,S=>{y||(y=!0,kr(qn,`RPC '${e}' stream ${s} transport errored:`,S),I.So(new me(J.UNAVAILABLE,"The operation could not be completed")))}),A(f,cu.EventType.MESSAGE,S=>{var $;if(!y){const U=S.data[0];Le(!!U);const M=U,L=M.error||(($=M[0])===null||$===void 0?void 0:$.error);if(L){pe(qn,`RPC '${e}' stream ${s} received error:`,L);const se=L.status;let Q=function(E){const C=gn[E];if(C!==void 0)return lx(C)}(se),x=L.message;Q===void 0&&(Q=J.INTERNAL,x="Unknown error status: "+se+" with message "+L.message),y=!0,I.So(new me(Q,x)),f.close()}else pe(qn,`RPC '${e}' stream ${s} received:`,U),I.bo(U)}}),A(a,fw.STAT_EVENT,S=>{S.stat===Ep.PROXY?pe(qn,`RPC '${e}' stream ${s} detected buffering proxy`):S.stat===Ep.NOPROXY&&pe(qn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{I.wo()},0),I}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kx(){return typeof window<"u"?window:null}function Td(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _c(n){return new rk(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ym{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&pe("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gx{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Ym(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===J.RESOURCE_EXHAUSTED?(dn(t.toString()),dn("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===J.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new me(J.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return pe("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(pe("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Jk extends Gx{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=ok(this.serializer,e),r=function(i){if(!("targetChange"in i))return qe.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?qe.min():o.readTime?fn(o.readTime):qe.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=Op(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=Bd(l)?{documents:yx(i,l)}:{query:Nh(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=hx(i,o.resumeToken);const c=Np(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(qe.min())>0){a.readTime=il(i,o.snapshotVersion.toTimestamp());const c=Np(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=lk(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=Op(this.serializer),t.removeTarget=e,this.a_(t)}}class Yk extends Gx{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Le(!!e.streamToken),this.lastStreamToken=e.streamToken,Le(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Le(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=ak(e.writeResults,e.commitTime),r=fn(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=Op(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Qu(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xk extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new me(J.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,Vp(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===J.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new me(J.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,Vp(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===J.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new me(J.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Zk{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(dn(t),this.D_=!1):pe("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e2{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{eo(this)&&(pe("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=Re(l);c.L_.add(4),await Il(c),c.q_.set("Unknown"),c.L_.delete(4),await bc(c)}(this))})}),this.q_=new Zk(r,s)}}async function bc(n){if(eo(n))for(const e of n.B_)await e(!0)}async function Il(n){for(const e of n.B_)await e(!1)}function Lh(n,e){const t=Re(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),eg(t)?Zm(t):Tl(t).r_()&&Xm(t,e))}function ll(n,e){const t=Re(n),r=Tl(t);t.N_.delete(e),r.r_()&&Hx(t,e),t.N_.size===0&&(r.r_()?r.o_():eo(t)&&t.q_.set("Unknown"))}function Xm(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(qe.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Tl(n).A_(e)}function Hx(n,e){n.Q_.xe(e),Tl(n).R_(e)}function Zm(n){n.Q_=new ZC({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Tl(n).start(),n.q_.v_()}function eg(n){return eo(n)&&!Tl(n).n_()&&n.N_.size>0}function eo(n){return Re(n).L_.size===0}function Wx(n){n.Q_=void 0}async function t2(n){n.q_.set("Online")}async function n2(n){n.N_.forEach((e,t)=>{Xm(n,e)})}async function r2(n,e){Wx(n),eg(n)?(n.q_.M_(e),Zm(n)):n.q_.set("Unknown")}async function s2(n,e,t){if(n.q_.set("Online"),e instanceof dx&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){pe("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await eh(n,r)}else if(e instanceof Ed?n.Q_.Ke(e):e instanceof cx?n.Q_.He(e):n.Q_.We(e),!t.isEqual(qe.min()))try{const r=await Fx(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.N_.get(c);h&&i.N_.set(c,h.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const h=i.N_.get(l);if(!h)return;i.N_.set(l,h.withResumeToken(on.EMPTY_BYTE_STRING,h.snapshotVersion)),Hx(i,l);const f=new Cs(h.target,l,c,h.sequenceNumber);Xm(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){pe("RemoteStore","Failed to raise snapshot:",r),await eh(n,r)}}async function eh(n,e,t){if(!Xi(e))throw e;n.L_.add(1),await Il(n),n.q_.set("Offline"),t||(t=()=>Fx(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{pe("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await bc(n)})}function Qx(n,e){return e().catch(t=>eh(n,t,e))}async function El(n){const e=Re(n),t=Ki(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;i2(e);)try{const s=await Bk(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,o2(e,s)}catch(s){await eh(e,s)}Jx(e)&&Yx(e)}function i2(n){return eo(n)&&n.O_.length<10}function o2(n,e){n.O_.push(e);const t=Ki(n);t.r_()&&t.V_&&t.m_(e.mutations)}function Jx(n){return eo(n)&&!Ki(n).n_()&&n.O_.length>0}function Yx(n){Ki(n).start()}async function a2(n){Ki(n).p_()}async function l2(n){const e=Ki(n);for(const t of n.O_)e.m_(t.mutations)}async function u2(n,e,t){const r=n.O_.shift(),s=$m.from(r,e,t);await Qx(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await El(n)}async function c2(n,e){e&&Ki(n).V_&&await async function(r,s){if(function(o){return ax(o)&&o!==J.ABORTED}(s.code)){const i=r.O_.shift();Ki(r).s_(),await Qx(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await El(r)}}(n,e),Jx(n)&&Yx(n)}async function C0(n,e){const t=Re(n);t.asyncQueue.verifyOperationInProgress(),pe("RemoteStore","RemoteStore received new credentials");const r=eo(t);t.L_.add(3),await Il(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await bc(t)}async function jp(n,e){const t=Re(n);e?(t.L_.delete(2),await bc(t)):e||(t.L_.add(2),await Il(t),t.q_.set("Unknown"))}function Tl(n){return n.K_||(n.K_=function(t,r,s){const i=Re(t);return i.w_(),new Jk(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:t2.bind(null,n),Ro:n2.bind(null,n),mo:r2.bind(null,n),d_:s2.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),eg(n)?Zm(n):n.q_.set("Unknown")):(await n.K_.stop(),Wx(n))})),n.K_}function Ki(n){return n.U_||(n.U_=function(t,r,s){const i=Re(t);return i.w_(),new Yk(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:a2.bind(null,n),mo:c2.bind(null,n),f_:l2.bind(null,n),g_:u2.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await El(n)):(await n.U_.stop(),n.O_.length>0&&(pe("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tg{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Rn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new tg(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new me(J.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Al(n,e){if(dn("AsyncQueue",`${e}: ${n}`),Xi(n))return new me(J.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qa{constructor(e){this.comparator=e?(t,r)=>e(t,r)||De.comparator(t.key,r.key):(t,r)=>De.comparator(t.key,r.key),this.keyedMap=du(),this.sortedSet=new Ut(this.comparator)}static emptySet(e){return new qa(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof qa)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new qa;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k0{constructor(){this.W_=new Ut(De.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Oe():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class ul{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new ul(e,t,qa.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&pc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d2{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class h2{constructor(){this.queries=D0(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=Re(t),i=s.queries;s.queries=D0(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new me(J.ABORTED,"Firestore shutting down"))}}function D0(){return new Js(n=>Gw(n),pc)}async function ng(n,e){const t=Re(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new d2,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Al(o,`Initialization of query '${ka(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&sg(t)}async function rg(n,e){const t=Re(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function f2(n,e){const t=Re(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&sg(t)}function p2(n,e,t){const r=Re(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function sg(n){n.Y_.forEach(e=>{e.next()})}var qp,N0;(N0=qp||(qp={})).ea="default",N0.Cache="cache";class ig{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new ul(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=ul.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==qp.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m2{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V0{constructor(e){this.serializer=e}Es(e){return os(this.serializer,e)}ds(e){return e.metadata.exists?vx(this.serializer,e.document,!1):Bt.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return fn(e)}}class g2{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Xx(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=ht.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new V0(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||nt()).add(i);t.set(o,a)}}return t}async complete(){const e=await zk(this.localStore,new V0(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await Kk(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function Xx(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zx{constructor(e){this.key=e}}class eI{constructor(e){this.key=e}}class tI{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=nt(),this.mutatedKeys=nt(),this.Aa=Ww(e),this.Ra=new qa(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new k0,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const g=s.get(h),y=mc(this.query,f)?f:null,I=!!g&&this.mutatedKeys.has(g.key),A=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let S=!1;g&&y?g.data.isEqual(y.data)?I!==A&&(r.track({type:3,doc:y}),S=!0):this.ga(g,y)||(r.track({type:2,doc:y}),S=!0,(l&&this.Aa(y,l)>0||c&&this.Aa(y,c)<0)&&(a=!0)):!g&&y?(r.track({type:0,doc:y}),S=!0):g&&!y&&(r.track({type:1,doc:g}),S=!0,(l||c)&&(a=!0)),S&&(y?(o=o.add(y),i=A?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((h,f)=>function(y,I){const A=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Oe()}};return A(y)-A(I)}(h.type,f.type)||this.Aa(h.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,c=l!==this.Ea;return this.Ea=l,o.length!==0||c?{snapshot:new ul(this.query,e.Ra,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new k0,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=nt(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new eI(r))}),this.da.forEach(r=>{e.has(r)||t.push(new Zx(r))}),t}ba(e){this.Ta=e.Ts,this.da=nt();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return ul.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class v2{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class y2{constructor(e){this.key=e,this.va=!1}}class _2{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Js(a=>Gw(a),pc),this.Ma=new Map,this.xa=new Set,this.Oa=new Ut(De.comparator),this.Na=new Map,this.La=new Km,this.Ba={},this.ka=new Map,this.qa=Ho.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function b2(n,e,t=!0){const r=$h(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await nI(r,e,t,!0),s}async function w2(n,e){const t=$h(n);await nI(t,e,!0,!1)}async function nI(n,e,t,r){const s=await ol(n.localStore,Qn(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await og(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&Lh(n.remoteStore,s),a}async function og(n,e,t,r,s){n.Ka=(f,g,y)=>async function(A,S,$,U){let M=S.view.ma($);M.ns&&(M=await Yd(A.localStore,S.query,!1).then(({documents:x})=>S.view.ma(x,M)));const L=U&&U.targetChanges.get(S.targetId),se=U&&U.targetMismatches.get(S.targetId)!=null,Q=S.view.applyChanges(M,A.isPrimaryClient,L,se);return Bp(A,S.targetId,Q.wa),Q.snapshot}(n,f,g,y);const i=await Yd(n.localStore,e,!0),o=new tI(e,i.Ts),a=o.ma(i.documents),l=yc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);Bp(n,t,c.wa);const h=new v2(e,t,o);return n.Fa.set(e,h),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function x2(n,e,t){const r=Re(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!pc(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await al(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&ll(r.remoteStore,s.targetId),cl(r,s.targetId)}).catch(Yi)):(cl(r,s.targetId),await al(r.localStore,s.targetId,!0))}async function I2(n,e){const t=Re(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ll(t.remoteStore,r.targetId))}async function E2(n,e,t){const r=cg(n);try{const s=await function(o,a){const l=Re(o),c=tn.now(),h=a.reduce((y,I)=>y.add(I.key),nt());let f,g;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let I=dr(),A=nt();return l.cs.getEntries(y,h).next(S=>{I=S,I.forEach(($,U)=>{U.isValidDocument()||(A=A.add($))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,I)).next(S=>{f=S;const $=[];for(const U of a){const M=JC(U,f.get(U.key).overlayedDocument);M!=null&&$.push(new Ys(U.key,M,Ow(M.value.mapValue),Jt.exists(!0)))}return l.mutationQueue.addMutationBatch(y,c,$,a)}).next(S=>{g=S;const $=S.applyToLocalDocumentSet(f,A);return l.documentOverlayCache.saveOverlays(y,S.batchId,$)})}).then(()=>({batchId:g.batchId,changes:Jw(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Ba[o.currentUser.toKey()];c||(c=new Ut(Je)),c=c.insert(a,l),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await Xs(r,s.changes),await El(r.remoteStore)}catch(s){const i=Al(s,"Failed to persist write");t.reject(i)}}async function rI(n,e){const t=Re(n);try{const r=await qk(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(Le(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Le(o.va):s.removedDocuments.size>0&&(Le(o.va),o.va=!1))}),await Xs(t,r,e)}catch(r){await Yi(r)}}function O0(n,e,t){const r=Re(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=Re(o);l.onlineState=a;let c=!1;l.queries.forEach((h,f)=>{for(const g of f.j_)g.Z_(a)&&(c=!0)}),c&&sg(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function T2(n,e,t){const r=Re(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Ut(De.comparator);o=o.insert(i,Bt.newNoDocument(i,qe.min()));const a=nt().add(i),l=new vc(qe.min(),new Map,new Ut(Je),o,a);await rI(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),ug(r)}else await al(r.localStore,e,!1).then(()=>cl(r,e,t)).catch(Yi)}async function A2(n,e){const t=Re(n),r=e.batch.batchId;try{const s=await jk(t.localStore,e);lg(t,r,null),ag(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Xs(t,s)}catch(s){await Yi(s)}}async function S2(n,e,t){const r=Re(n);try{const s=await function(o,a){const l=Re(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let h;return l.mutationQueue.lookupMutationBatch(c,a).next(f=>(Le(f!==null),h=f.keys(),l.mutationQueue.removeMutationBatch(c,f))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,h,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,h)).next(()=>l.localDocuments.getDocuments(c,h))})}(r.localStore,e);lg(r,e,t),ag(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Xs(r,s)}catch(s){await Yi(s)}}async function P2(n,e){const t=Re(n);eo(t.remoteStore)||pe("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=Re(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=Al(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function ag(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function lg(n,e,t){const r=Re(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function cl(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||sI(n,r)})}function sI(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(ll(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),ug(n))}function Bp(n,e,t){for(const r of t)r instanceof Zx?(n.La.addReference(r.key,e),R2(n,r)):r instanceof eI?(pe("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||sI(n,r.key)):Oe()}function R2(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(pe("SyncEngine","New document in limbo: "+t),n.xa.add(r),ug(n))}function ug(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new De(ht.fromString(e)),r=n.qa.next();n.Na.set(r,new y2(t)),n.Oa=n.Oa.insert(t,r),Lh(n.remoteStore,new Cs(Qn(bl(t.path)),r,"TargetPurposeLimboResolution",ur.oe))}}async function Xs(n,e,t){const r=Re(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(c=>{var h;if((c||t)&&r.isPrimaryClient){const f=c?!c.fromCache:(h=t==null?void 0:t.targetChanges.get(l.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(c){s.push(c);const f=Qm.Wi(l.targetId,c);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,c){const h=Re(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>z.forEach(c,g=>z.forEach(g.$i,y=>h.persistence.referenceDelegate.addReference(f,g.targetId,y)).next(()=>z.forEach(g.Ui,y=>h.persistence.referenceDelegate.removeReference(f,g.targetId,y)))))}catch(f){if(!Xi(f))throw f;pe("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const g=f.targetId;if(!f.fromCache){const y=h.os.get(g),I=y.snapshotVersion,A=y.withLastLimboFreeSnapshotVersion(I);h.os=h.os.insert(g,A)}}}(r.localStore,i))}async function C2(n,e){const t=Re(n);if(!t.currentUser.isEqual(e)){pe("SyncEngine","User change. New user:",e.toKey());const r=await $x(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new me(J.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Xs(t,r.hs)}}function k2(n,e){const t=Re(n),r=t.Na.get(e);if(r&&r.va)return nt().add(r.key);{let s=nt();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function D2(n,e){const t=Re(n),r=await Yd(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&Bp(t,e.targetId,s.wa),s}async function N2(n,e){const t=Re(n);return qx(t.localStore,e).then(r=>Xs(t,r))}async function V2(n,e,t,r){const s=Re(n),i=await function(a,l){const c=Re(a),h=Re(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.Mn(f,l).next(g=>g?c.localDocuments.getDocuments(f,g):z.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await El(s.remoteStore):t==="acknowledged"||t==="rejected"?(lg(s,e,r||null),ag(s,e),function(a,l){Re(Re(a).mutationQueue).On(l)}(s.localStore,e)):Oe(),await Xs(s,i)):pe("SyncEngine","Cannot apply mutation batch with id: "+e)}async function O2(n,e){const t=Re(n);if($h(t),cg(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await M0(t,r.toArray());t.Qa=!0,await jp(t.remoteStore,!0);for(const i of s)Lh(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(cl(t,o),al(t.localStore,o,!0))),ll(t.remoteStore,o)}),await s,await M0(t,r),function(o){const a=Re(o);a.Na.forEach((l,c)=>{ll(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new Ut(De.comparator)}(t),t.Qa=!1,await jp(t.remoteStore,!1)}}async function M0(n,e,t){const r=Re(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await ol(r.localStore,Qn(l[0]));for(const c of l){const h=r.Fa.get(c),f=await D2(r,h);f.snapshot&&i.push(f.snapshot)}}else{const c=await jx(r.localStore,o);a=await ol(r.localStore,c),await og(r,iI(c),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function iI(n){return Bw(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function M2(n){return function(t){return Re(Re(t).persistence).Qi()}(Re(n).localStore)}async function L2(n,e,t,r){const s=Re(n);if(s.Qa)return void pe("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await qx(s.localStore,Hw(i[0])),a=vc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",on.EMPTY_BYTE_STRING);await Xs(s,o,a);break}case"rejected":await al(s.localStore,e,!0),cl(s,e,r);break;default:Oe()}}async function $2(n,e,t){const r=$h(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){pe("SyncEngine","Adding an already active target "+s);continue}const i=await jx(r.localStore,s),o=await ol(r.localStore,i);await og(r,iI(i),o.targetId,!1,o.resumeToken),Lh(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await al(r.localStore,s,!1).then(()=>{ll(r.remoteStore,s),cl(r,s)}).catch(Yi)}}function $h(n){const e=Re(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=rI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=k2.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=T2.bind(null,e),e.Ca.d_=f2.bind(null,e.eventManager),e.Ca.$a=p2.bind(null,e.eventManager),e}function cg(n){const e=Re(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=A2.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=S2.bind(null,e),e}function F2(n,e,t){const r=Re(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(y,I){const A=Re(y),S=fn(I.createTime);return A.persistence.runTransaction("hasNewerBundle","readonly",$=>A.Gr.getBundleMetadata($,I.id)).then($=>!!$&&$.createTime.compareTo(S)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(Xx(l));const c=new g2(l,i.localStore,o.serializer);let h=await o.Ua();for(;h;){const g=await c.la(h);g&&a._updateProgress(g),h=await o.Ua()}const f=await c.complete();return await Xs(i,f.Ia,void 0),await function(y,I){const A=Re(y);return A.persistence.runTransaction("Save bundle","readwrite",S=>A.Gr.saveBundleMetadata(S,I))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(l){return kr("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class Gi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=_c(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return Lx(this.persistence,new Mx,e.initialUser,this.serializer)}Ga(e){return new Gm(Mh.Zr,this.serializer)}Wa(e){return new zx}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Gi.provider={build:()=>new Gi};class U2 extends Gi{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){Le(this.persistence.referenceDelegate instanceof Jd);const r=this.persistence.referenceDelegate.garbageCollector;return new kx(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?zn.withCacheSize(this.cacheSizeBytes):zn.DEFAULT;return new Gm(r=>Jd.Zr(r,t),this.serializer)}}class dg extends Gi{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await cg(this.Ja.syncEngine),await El(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return Lx(this.persistence,new Mx,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new kx(r,e.asyncQueue,t)}Ha(e,t){const r=new lC(t,this.persistence);return new aC(e.asyncQueue,r)}Ga(e){const t=Wm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?zn.withCacheSize(this.cacheSizeBytes):zn.DEFAULT;return new Hm(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Kx(),Td(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new zx}}class oI extends dg{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof Gf&&(this.sharedClientState.syncEngine={no:V2.bind(null,t),ro:L2.bind(null,t),io:$2.bind(null,t),Qi:M2.bind(null,t),eo:N2.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await O2(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=Kx();if(!Gf.D(t))throw new me(J.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Wm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Gf(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Hi{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>O0(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=C2.bind(null,this.syncEngine),await jp(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new h2}()}createDatastore(e){const t=_c(e.databaseInfo.databaseId),r=function(i){return new Qk(i)}(e.databaseInfo);return function(i,o,a,l){return new Xk(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new e2(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>O0(this.syncEngine,t,0),function(){return R0.D()?new R0:new Gk}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,h){const f=new _2(s,i,o,a,l,c);return h&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=Re(s);pe("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await Il(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Hi.provider={build:()=>new Hi};function L0(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):dn("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j2{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new Rn,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new m2(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q2{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new me(J.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=Re(s),a={documents:i.map(f=>Wu(o.serializer,f))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,ht.emptyPath(),a,i.length),c=new Map;l.forEach(f=>{const g=ik(o.serializer,f);c.set(g.key.toString(),g)});const h=[];return i.forEach(f=>{const g=c.get(f.toString());Le(!!g),h.push(g)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new xl(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=De.fromPath(r);this.mutations.push(new Mm(s,this.precondition(s)))}),await async function(r,s){const i=Re(r),o={writes:s.map(a=>Qu(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,ht.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Oe();t=qe.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new me(J.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(qe.min())?Jt.exists(!1):Jt.updateTime(t):Jt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(qe.min()))throw new me(J.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Jt.updateTime(t)}return Jt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B2{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new Ym(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new q2(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!hc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!ax(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z2{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Sn.UNAUTHENTICATED,this.clientId=yw.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{pe("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(pe("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Rn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Al(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Wf(n,e){n.asyncQueue.verifyOperationInProgress(),pe("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await $x(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function $0(n,e){n.asyncQueue.verifyOperationInProgress();const t=await hg(n);pe("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>C0(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>C0(e.remoteStore,s)),n._onlineComponents=e}async function hg(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){pe("FirestoreClient","Using user provided OfflineComponentProvider");try{await Wf(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===J.FAILED_PRECONDITION||s.code===J.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;kr("Error using user provided cache. Falling back to memory cache: "+t),await Wf(n,new Gi)}}else pe("FirestoreClient","Using default OfflineComponentProvider"),await Wf(n,new Gi);return n._offlineComponents}async function Uh(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(pe("FirestoreClient","Using user provided OnlineComponentProvider"),await $0(n,n._uninitializedComponentsProvider._online)):(pe("FirestoreClient","Using default OnlineComponentProvider"),await $0(n,new Hi))),n._onlineComponents}function aI(n){return hg(n).then(e=>e.persistence)}function Sl(n){return hg(n).then(e=>e.localStore)}function lI(n){return Uh(n).then(e=>e.remoteStore)}function fg(n){return Uh(n).then(e=>e.syncEngine)}function uI(n){return Uh(n).then(e=>e.datastore)}async function dl(n){const e=await Uh(n),t=e.eventManager;return t.onListen=b2.bind(null,e.syncEngine),t.onUnlisten=x2.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=w2.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=I2.bind(null,e.syncEngine),t}function K2(n){return n.asyncQueue.enqueue(async()=>{const e=await aI(n),t=await lI(n);return e.setNetworkEnabled(!0),function(s){const i=Re(s);return i.L_.delete(0),bc(i)}(t)})}function G2(n){return n.asyncQueue.enqueue(async()=>{const e=await aI(n),t=await lI(n);return e.setNetworkEnabled(!1),async function(s){const i=Re(s);i.L_.add(0),await Il(i),i.q_.set("Offline")}(t)})}function H2(n,e){const t=new Rn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(c,h){const f=Re(c);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new me(J.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=Al(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await Sl(n),e,t)),t.promise}function cI(n,e,t={}){const r=new Rn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const h=new Fh({next:g=>{h.Za(),o.enqueueAndForget(()=>rg(i,f));const y=g.docs.has(a);!y&&g.fromCache?c.reject(new me(J.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&g.fromCache&&l&&l.source==="server"?c.reject(new me(J.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new ig(bl(a.path),h,{includeMetadataChanges:!0,_a:!0});return ng(i,f)}(await dl(n),n.asyncQueue,e,t,r)),r.promise}function W2(n,e){const t=new Rn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await Yd(s,i,!0),l=new tI(i,a.Ts),c=l.ma(a.documents),h=l.applyChanges(c,!1);o.resolve(h.snapshot)}catch(a){const l=Al(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await Sl(n),e,t)),t.promise}function dI(n,e,t={}){const r=new Rn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const h=new Fh({next:g=>{h.Za(),o.enqueueAndForget(()=>rg(i,f)),g.fromCache&&l.source==="server"?c.reject(new me(J.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new ig(a,h,{includeMetadataChanges:!0,_a:!0});return ng(i,f)}(await dl(n),n.asyncQueue,e,t,r)),r.promise}function Q2(n,e,t){const r=new Rn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await uI(n);r.resolve(async function(o,a,l){var c;const h=Re(o),{request:f,ut:g,parent:y}=_x(h.serializer,zw(a),l);h.connection.Fo||delete f.parent;const I=(await h.Lo("RunAggregationQuery",h.serializer.databaseId,y,f,1)).filter(S=>!!S.result);Le(I.length===1);const A=(c=I[0].result)===null||c===void 0?void 0:c.aggregateFields;return Object.keys(A).reduce((S,$)=>(S[g[$]]=A[$],S),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function J2(n,e){const t=new Fh(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){Re(s).Y_.add(i),i.next()}(await dl(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){Re(s).Y_.delete(i)}(await dl(n),t))}}function Y2(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?ux().encode(o):o,function(h,f){return new j2(h,f)}(function(h,f){if(h instanceof Uint8Array)return L0(h,f);if(h instanceof ArrayBuffer)return L0(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,_c(e));n.asyncQueue.enqueueAndForget(async()=>{F2(await fg(n),s,r)})}function X2(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=Re(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await Sl(n),e))}function Z2(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=Re(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(c=>function(f,g,y,I,A){f=[...f],g=[...g],f.sort(y),g.sort(y);const S=f.length,$=g.length;let U=0,M=0;for(;U<$&&M<S;){const L=y(f[M],g[U]);L<0?A(f[M++]):L>0?I(g[U++]):(U++,M++)}for(;U<$;)I(g[U++]);for(;M<S;)A(f[M++])}(c,s,rC,h=>{a.push(o.addFieldIndex(l,h))},h=>{a.push(o.deleteFieldIndex(l,h))})).next(()=>z.waitFor(a)))}(await Sl(n),e))}function eD(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){Re(r).ss.zi=s}(await Sl(n),e))}function tD(n){return n.asyncQueue.enqueue(async()=>function(t){const r=Re(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Sl(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hI(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F0=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pg(n,e,t){if(!t)throw new me(J.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function nD(n,e,t,r){if(e===!0&&r===!0)throw new me(J.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function U0(n){if(!De.isDocumentKey(n))throw new me(J.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function j0(n){if(De.isDocumentKey(n))throw new me(J.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function jh(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Oe()}function ut(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new me(J.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=jh(n);throw new me(J.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function fI(n,e){if(e<=0)throw new me(J.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q0{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new me(J.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new me(J.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}nD("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=hI((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new me(J.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new me(J.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new me(J.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class wc{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new q0({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new me(J.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new me(J.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new q0(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new QR;switch(r.type){case"firstParty":return new ZR(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new me(J.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=F0.get(t);r&&(pe("ComponentProvider","Removing Datastore"),F0.delete(t),r.terminate())}(this),Promise.resolve()}}function rD(n,e,t,r={}){var s;const i=(n=ut(n,wc))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&kr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=Sn.MOCK_USER;else{a=TP(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new me(J.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Sn(c)}n._authCredentials=new JR(new gw(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Fn(this.firestore,e,this._query)}}class pn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new as(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new pn(this.firestore,e,this._key)}}class as extends Fn{constructor(e,t,r){super(e,t,bl(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new pn(this.firestore,null,new De(e))}withConverter(e){return new as(this.firestore,e,this._path)}}function et(n,e,...t){if(n=je(n),pg("collection","path",e),n instanceof wc){const r=ht.fromString(e,...t);return j0(r),new as(n,null,r)}{if(!(n instanceof pn||n instanceof as))throw new me(J.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ht.fromString(e,...t));return j0(r),new as(n.firestore,null,r)}}function $B(n,e){if(n=ut(n,wc),pg("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new me(J.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Fn(n,null,function(r){return new Qs(ht.emptyPath(),r)}(e))}function Pe(n,e,...t){if(n=je(n),arguments.length===1&&(e=yw.newId()),pg("doc","path",e),n instanceof wc){const r=ht.fromString(e,...t);return U0(r),new pn(n,null,new De(r))}{if(!(n instanceof pn||n instanceof as))throw new me(J.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ht.fromString(e,...t));return U0(r),new pn(n.firestore,n instanceof as?n.converter:null,new De(r))}}function FB(n,e){return n=je(n),e=je(e),(n instanceof pn||n instanceof as)&&(e instanceof pn||e instanceof as)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function pI(n,e){return n=je(n),e=je(e),n instanceof Fn&&e instanceof Fn&&n.firestore===e.firestore&&pc(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B0{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Ym(this,"async_queue_retry"),this.Vu=()=>{const r=Td();r&&pe("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=Td();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Td();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new Rn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Xi(e))throw e;pe("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw dn("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=tg.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&Oe()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function zp(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class sD{constructor(){this._progressObserver={},this._taskCompletionResolver=new Rn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UB=-1;class Nt extends wc{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new B0,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new B0(e),this._firestoreClient=void 0,await e}}}function jB(n,e,t){t||(t="(default)");const r=Ji(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(Ui(i,e))return s;throw new me(J.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new me(J.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new me(J.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function iD(n,e){const t=typeof n=="object"?n:Sm(),r=typeof n=="string"?n:e||"(default)",s=Ji(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=IP("firestore");i&&rD(s,...i)}return s}function nn(n){if(n._terminated)throw new me(J.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||mI(n),n._firestoreClient}function mI(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,c,h){return new RC(a,l,c,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,hI(h.experimentalLongPollingOptions),h.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new z2(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function oD(n,e){kr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return gI(n,Hi.provider,{build:r=>new dg(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function qB(n){kr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();gI(n,Hi.provider,{build:t=>new oI(t,e.cacheSizeBytes)})}function gI(n,e,t){if((n=ut(n,Nt))._firestoreClient||n._terminated)throw new me(J.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new me(J.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},mI(n)}function BB(n){if(n._initialized&&!n._terminated)throw new me(J.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Rn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!is.D())return Promise.resolve();const s=r+"main";await is.delete(s)}(Wm(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function zB(n){return function(t){const r=new Rn;return t.asyncQueue.enqueueAndForget(async()=>P2(await fg(t),r)),r.promise}(nn(n=ut(n,Nt)))}function KB(n){return K2(nn(n=ut(n,Nt)))}function GB(n){return G2(nn(n=ut(n,Nt)))}function HB(n){return OR(n.app,"firestore",n._databaseId.database),n._delete()}function WB(n,e){const t=nn(n=ut(n,Nt)),r=new sD;return Y2(t,n._databaseId,e,r),r}function QB(n,e){return X2(nn(n=ut(n,Nt)),e).then(t=>t?new Fn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ju{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class aD{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wo{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Wo(on.fromBase64String(e))}catch(t){throw new me(J.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Wo(on.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ea{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new me(J.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Qt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function JB(){return new ea("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ta{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mg{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new me(J.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new me(J.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Je(this._lat,e._lat)||Je(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qh{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lD=/^__.*__$/;class uD{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Ys(e,this.data,this.fieldMask,t,this.fieldTransforms):new wl(e,this.data,t,this.fieldTransforms)}}class vI{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Ys(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function yI(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Oe()}}class Bh{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Bh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return th(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(yI(this.Cu)&&lD.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class cD{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||_c(e)}Qu(e,t,r,s=!1){return new Bh({Cu:e,methodName:t,qu:r,path:Qt.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function na(n){const e=n._freezeSettings(),t=_c(n._databaseId);return new cD(n._databaseId,!!e.ignoreUndefinedProperties,t)}function zh(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);xg("Data must be an object, but it was:",o,r);const a=wI(r,o);let l,c;if(i.merge)l=new cr(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const g=Yu(e,f,t);if(!o.contains(g))throw new me(J.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);II(h,g)||h.push(g)}l=new cr(h),c=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,c=o.fieldTransforms;return new uD(new Ln(a),l,c)}class xc extends ta{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof xc}}function _I(n,e,t){return new Bh({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class gg extends ta{_toFieldTransform(e){return new gc(e.path,new rl)}isEqual(e){return e instanceof gg}}class vg extends ta{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=_I(this,e,!0),r=this.Ku.map(i=>ra(i,t)),s=new Bo(r);return new gc(e.path,s)}isEqual(e){return e instanceof vg&&Ui(this.Ku,e.Ku)}}class yg extends ta{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=_I(this,e,!0),r=this.Ku.map(i=>ra(i,t)),s=new zo(r);return new gc(e.path,s)}isEqual(e){return e instanceof yg&&Ui(this.Ku,e.Ku)}}class _g extends ta{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new sl(e.serializer,Zw(e.serializer,this.$u));return new gc(e.path,t)}isEqual(e){return e instanceof _g&&this.$u===e.$u}}function bg(n,e,t,r){const s=n.Qu(1,e,t);xg("Data must be an object, but it was:",s,r);const i=[],o=Ln.empty();Zi(r,(l,c)=>{const h=Kh(e,l,t);c=je(c);const f=s.Nu(h);if(c instanceof xc)i.push(h);else{const g=ra(c,f);g!=null&&(i.push(h),o.set(h,g))}});const a=new cr(i);return new vI(o,a,s.fieldTransforms)}function wg(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[Yu(e,r,t)],l=[s];if(i.length%2!=0)throw new me(J.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)a.push(Yu(e,i[g])),l.push(i[g+1]);const c=[],h=Ln.empty();for(let g=a.length-1;g>=0;--g)if(!II(c,a[g])){const y=a[g];let I=l[g];I=je(I);const A=o.Nu(y);if(I instanceof xc)c.push(y);else{const S=ra(I,A);S!=null&&(c.push(y),h.set(y,S))}}const f=new cr(c);return new vI(h,f,o.fieldTransforms)}function bI(n,e,t,r=!1){return ra(t,n.Qu(r?4:3,e))}function ra(n,e){if(xI(n=je(n)))return xg("Unsupported field value:",e,n),wI(n,e);if(n instanceof ta)return function(r,s){if(!yI(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=ra(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=je(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Zw(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=tn.fromDate(r);return{timestampValue:il(s.serializer,i)}}if(r instanceof tn){const i=new tn(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:il(s.serializer,i)}}if(r instanceof mg)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Wo)return{bytesValue:hx(s.serializer,r._byteString)};if(r instanceof pn){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:jm(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof qh)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return Om(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${jh(r)}`)}(n,e)}function wI(n,e){const t={};return kw(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Zi(n,(r,s)=>{const i=ra(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function xI(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof tn||n instanceof mg||n instanceof Wo||n instanceof pn||n instanceof ta||n instanceof qh)}function xg(n,e,t){if(!xI(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=jh(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function Yu(n,e,t){if((e=je(e))instanceof ea)return e._internalPath;if(typeof e=="string")return Kh(n,e);throw th("Field path arguments must be of type string or ",n,!1,void 0,t)}const dD=new RegExp("[~\\*/\\[\\]]");function Kh(n,e,t){if(e.search(dD)>=0)throw th(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ea(...e.split("."))._internalPath}catch{throw th(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function th(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new me(J.INVALID_ARGUMENT,a+n+l)}function II(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xu{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new pn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new hD(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Gh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class hD extends Xu{data(){return super.data()}}function Gh(n,e){return typeof e=="string"?Kh(n,e):e instanceof ea?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new me(J.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Ig{}class Ic extends Ig{}function Zu(n,e,...t){let r=[];e instanceof Ig&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof Pl).length,a=i.filter(l=>l instanceof Ec).length;if(o>1||o>0&&a>0)throw new me(J.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Ec extends Ic{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Ec(e,t,r)}_apply(e){const t=this._parse(e);return AI(e._query,t),new Fn(e.firestore,e.converter,Dp(e._query,t))}_parse(e){const t=na(e.firestore);return function(i,o,a,l,c,h,f){let g;if(c.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new me(J.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){K0(f,h);const y=[];for(const I of f)y.push(z0(l,i,I));g={arrayValue:{values:y}}}else g=z0(l,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||K0(f,h),g=bI(a,o,f,h==="in"||h==="not-in");return ft.create(c,h,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function nh(n,e,t){const r=e,s=Gh("where",n);return Ec._create(s,r,t)}class Pl extends Ig{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Pl(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Rt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)AI(o,l),o=Dp(o,l)}(e._query,t),new Fn(e.firestore,e.converter,Dp(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function YB(...n){return n.forEach(e=>SI("or",e)),Pl._create("or",n)}function XB(...n){return n.forEach(e=>SI("and",e)),Pl._create("and",n)}class Eg extends Ic{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Eg(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new me(J.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new me(J.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Hu(i,o)}(e._query,this._field,this._direction);return new Fn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Qs(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function fD(n,e="asc"){const t=e,r=Gh("orderBy",n);return Eg._create(r,t)}class Hh extends Ic{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Hh(e,t,r)}_apply(e){return new Fn(e.firestore,e.converter,Kd(e._query,this._limit,this._limitType))}}function ZB(n){return fI("limit",n),Hh._create("limit",n,"F")}function e9(n){return fI("limitToLast",n),Hh._create("limitToLast",n,"L")}class Wh extends Ic{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Wh(e,t,r)}_apply(e){const t=TI(e,this.type,this._docOrFields,this._inclusive);return new Fn(e.firestore,e.converter,function(s,i){return new Qs(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function t9(...n){return Wh._create("startAt",n,!0)}function n9(...n){return Wh._create("startAfter",n,!1)}class Qh extends Ic{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Qh(e,t,r)}_apply(e){const t=TI(e,this.type,this._docOrFields,this._inclusive);return new Fn(e.firestore,e.converter,function(s,i){return new Qs(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function r9(...n){return Qh._create("endBefore",n,!1)}function s9(...n){return Qh._create("endAt",n,!0)}function TI(n,e,t,r){if(t[0]=je(t[0]),t[0]instanceof Xu)return function(i,o,a,l,c){if(!l)throw new me(J.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of ja(i))if(f.field.isKeyField())h.push(jo(o,l.key));else{const g=l.data.field(f.field);if(Ph(g))throw new me(J.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){const y=f.field.canonicalString();throw new me(J.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}h.push(g)}return new zi(h,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=na(n.firestore);return function(o,a,l,c,h,f){const g=o.explicitOrderBy;if(h.length>g.length)throw new me(J.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let I=0;I<h.length;I++){const A=h[I];if(g[I].field.isKeyField()){if(typeof A!="string")throw new me(J.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof A}`);if(!Nm(o)&&A.indexOf("/")!==-1)throw new me(J.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${A}' contains a slash.`);const S=o.path.child(ht.fromString(A));if(!De.isDocumentKey(S))throw new me(J.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${S}' is not because it contains an odd number of segments.`);const $=new De(S);y.push(jo(a,$))}else{const S=bI(l,c,A);y.push(S)}}return new zi(y,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function z0(n,e,t){if(typeof(t=je(t))=="string"){if(t==="")throw new me(J.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Nm(e)&&t.indexOf("/")!==-1)throw new me(J.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(ht.fromString(t));if(!De.isDocumentKey(r))throw new me(J.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return jo(n,new De(r))}if(t instanceof pn)return jo(n,t._key);throw new me(J.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${jh(t)}.`)}function K0(n,e){if(!Array.isArray(n)||n.length===0)throw new me(J.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function AI(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new me(J.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new me(J.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function SI(n,e){if(!(e instanceof Ec||e instanceof Pl))throw new me(J.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class PI{convertValue(e,t="none"){switch(qi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Wt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(zs(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Oe()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Zi(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>Wt(o.doubleValue));return new qh(i)}convertGeoPoint(e){return new mg(Wt(e.latitude),Wt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Rh(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(zu(e));default:return null}}convertTimestamp(e){const t=Bs(e);return new tn(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ht.fromString(e);Le(Ix(r));const s=new Uo(r.get(1),r.get(3)),i=new De(r.popFirst(5));return s.isEqual(t)||dn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jh(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class pD extends PI{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wo(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new pn(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i9(n){return new Ju("sum",Yu("sum",n))}function o9(n){return new Ju("avg",Yu("average",n))}function mD(){return new Ju("count")}function a9(n,e){var t,r;return n instanceof Ju&&e instanceof Ju&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function l9(n,e){return pI(n.query,e.query)&&Ui(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Do{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class hl extends Xu{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ad(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Gh("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Ad extends hl{data(e={}){return super.data(e)}}class fl{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Do(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Ad(this._firestore,this._userDataWriter,r.key,r,new Do(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new me(J.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new Ad(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Do(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Ad(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Do(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,h=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:gD(a.type),doc:l,oldIndex:c,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function gD(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Oe()}}function u9(n,e){return n instanceof hl&&e instanceof hl?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof fl&&e instanceof fl&&n._firestore===e._firestore&&pI(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jt(n){n=ut(n,pn);const e=ut(n.firestore,Nt);return cI(nn(e),n._key).then(t=>Tg(e,n,t))}class to extends PI{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wo(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new pn(this.firestore,null,t)}}function c9(n){n=ut(n,pn);const e=ut(n.firestore,Nt),t=nn(e),r=new to(e);return H2(t,n._key).then(s=>new hl(e,r,n._key,s,new Do(s!==null&&s.hasLocalMutations,!0),n.converter))}function d9(n){n=ut(n,pn);const e=ut(n.firestore,Nt);return cI(nn(e),n._key,{source:"server"}).then(t=>Tg(e,n,t))}function Pt(n){n=ut(n,Fn);const e=ut(n.firestore,Nt),t=nn(e),r=new to(e);return EI(n._query),dI(t,n._query).then(s=>new fl(e,r,n,s))}function h9(n){n=ut(n,Fn);const e=ut(n.firestore,Nt),t=nn(e),r=new to(e);return W2(t,n._query).then(s=>new fl(e,r,n,s))}function f9(n){n=ut(n,Fn);const e=ut(n.firestore,Nt),t=nn(e),r=new to(e);return dI(t,n._query,{source:"server"}).then(s=>new fl(e,r,n,s))}function sn(n,e,t){n=ut(n,pn);const r=ut(n.firestore,Nt),s=Jh(n.converter,e,t);return Tc(r,[zh(na(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Jt.none())])}function Rl(n,e,t,...r){n=ut(n,pn);const s=ut(n.firestore,Nt),i=na(s);let o;return o=typeof(e=je(e))=="string"||e instanceof ea?wg(i,"updateDoc",n._key,e,t,r):bg(i,"updateDoc",n._key,e),Tc(s,[o.toMutation(n._key,Jt.exists(!0))])}function pl(n){return Tc(ut(n.firestore,Nt),[new xl(n._key,Jt.none())])}function Cl(n,e){const t=ut(n.firestore,Nt),r=Pe(n),s=Jh(n.converter,e);return Tc(t,[zh(na(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Jt.exists(!1))]).then(()=>r)}function p9(n,...e){var t,r,s;n=je(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||zp(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(zp(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,c,h;if(n instanceof pn)c=ut(n.firestore,Nt),h=bl(n._key.path),l={next:f=>{e[o]&&e[o](Tg(c,n,f))},error:e[o+1],complete:e[o+2]};else{const f=ut(n,Fn);c=ut(f.firestore,Nt),h=f._query;const g=new to(c);l={next:y=>{e[o]&&e[o](new fl(c,g,f,y))},error:e[o+1],complete:e[o+2]},EI(n._query)}return function(g,y,I,A){const S=new Fh(A),$=new ig(y,S,I);return g.asyncQueue.enqueueAndForget(async()=>ng(await dl(g),$)),()=>{S.Za(),g.asyncQueue.enqueueAndForget(async()=>rg(await dl(g),$))}}(nn(c),h,a,l)}function m9(n,e){return J2(nn(n=ut(n,Nt)),zp(e)?e:{next:e})}function Tc(n,e){return function(r,s){const i=new Rn;return r.asyncQueue.enqueueAndForget(async()=>E2(await fg(r),s,i)),i.promise}(nn(n),e)}function Tg(n,e,t){const r=t.docs.get(e._key),s=new to(n);return new hl(n,s,e._key,r,new Do(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g9(n){return vD(n,{count:mD()})}function vD(n,e){const t=ut(n.firestore,Nt),r=nn(t),s=Cw(e,(i,o)=>new ox(o,i.aggregateType,i._internalFieldPath));return Q2(r,n._query,s).then(i=>function(a,l,c){const h=new to(a);return new aD(l,h,c)}(t,n,i))}class yD{constructor(e){this.kind="memory",this._onlineComponentProvider=Hi.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=Gi.provider}toJSON(){return{kind:this.kind}}}class _D{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=ED(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class bD{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Gi.provider}toJSON(){return{kind:this.kind}}}class wD{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new U2(e)}}toJSON(){return{kind:this.kind}}}function v9(){return new bD}function y9(n){return new wD(n==null?void 0:n.cacheSizeBytes)}function _9(n){return new yD(n)}function b9(n){return new _D(n)}class xD{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Hi.provider,this._offlineComponentProvider={build:t=>new dg(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class ID{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Hi.provider,this._offlineComponentProvider={build:t=>new oI(t,e==null?void 0:e.cacheSizeBytes)}}}function ED(n){return new xD(n==null?void 0:n.forceOwnership)}function w9(){return new ID}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TD={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AD{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=na(e)}set(e,t,r){this._verifyNotCommitted();const s=Ti(e,this._firestore),i=Jh(s.converter,t,r),o=zh(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,Jt.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=Ti(e,this._firestore);let o;return o=typeof(t=je(t))=="string"||t instanceof ea?wg(this._dataReader,"WriteBatch.update",i._key,t,r,s):bg(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Jt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Ti(e,this._firestore);return this._mutations=this._mutations.concat(new xl(t._key,Jt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new me(J.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Ti(n,e){if((n=je(n)).firestore!==e)throw new me(J.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SD extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=na(t)}get(t){const r=Ti(t,this._firestore),s=new pD(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return Oe();const o=i[0];if(o.isFoundDocument())return new Xu(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new Xu(this._firestore,s,r._key,null,r.converter);throw Oe()})}set(t,r,s){const i=Ti(t,this._firestore),o=Jh(i.converter,r,s),a=zh(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=Ti(t,this._firestore);let a;return a=typeof(r=je(r))=="string"||r instanceof ea?wg(this._dataReader,"Transaction.update",o._key,r,s,i):bg(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=Ti(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Ti(e,this._firestore),r=new to(this._firestore);return super.get(e).then(s=>new hl(this._firestore,r,t._key,s._document,new Do(!1,!1),t.converter))}}function I9(n,e,t){n=ut(n,Nt);const r=Object.assign(Object.assign({},TD),t);return function(i){if(i.maxAttempts<1)throw new me(J.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new Rn;return i.asyncQueue.enqueueAndForget(async()=>{const c=await uI(i);new B2(i.asyncQueue,c,a,o,l).au()}),l.promise}(nn(n),s=>e(new SD(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E9(){return new xc("deleteField")}function no(){return new gg("serverTimestamp")}function PD(...n){return new vg("arrayUnion",n)}function T9(...n){return new yg("arrayRemove",n)}function A9(n){return new _g("increment",n)}function S9(n){return new qh(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ag(n){return nn(n=ut(n,Nt)),new AD(n,e=>Tc(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P9(n,e){const t=nn(n=ut(n,Nt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return kr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(c){try{return JSON.parse(c)}catch(h){throw new me(J.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const c=G0(l,"collectionGroup"),h=[];if(Array.isArray(l.fields))for(const f of l.fields){const g=Kh("setIndexConfiguration",G0(f,"fieldPath"));f.arrayConfig==="CONTAINS"?h.push(new Lo(g,2)):f.order==="ASCENDING"?h.push(new Lo(g,0)):f.order==="DESCENDING"&&h.push(new Lo(g,1))}a.push(new Za(Za.UNKNOWN_ID,c,h,el.empty()))}return a}(e);return Z2(t,r)}function G0(n,e){if(typeof n[e]!="string")throw new me(J.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RD{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function R9(n){var e;n=ut(n,Nt);const t=H0.get(n);if(t)return t;if(((e=nn(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new RD(n);return H0.set(n,r),r}function C9(n){RI(n,!0)}function k9(n){RI(n,!1)}function D9(n){tD(nn(n._firestore)).then(e=>pe("deleting all persistent cache indexes succeeded")).catch(e=>kr("deleting all persistent cache indexes failed",e))}function RI(n,e){eD(nn(n._firestore),e).then(t=>pe(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>kr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const H0=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N9(n){var e;const t=(e=nn(ut(n.firestore,Nt))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:Nh(t,Qn(n._query))._t}function V9(n,e){var t;const r=Cw(e,(i,o)=>new ox(o,i.aggregateType,i._internalFieldPath)),s=(t=nn(ut(n.firestore,Nt))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:_x(s,zw(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O9{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return Sg.instance.onExistenceFilterMismatch(e)}}class Sg{constructor(){this.Uu=new Map}static get instance(){return ld||(ld=new Sg,function(t){if(Gd)throw new Error("a TestingHooksSpi instance is already set");Gd=t}(ld)),ld}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let ld=null;(function(e,t=!0){(function(s){_l=s})(yl),us(new zr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Nt(new YR(r.getProvider("auth-internal")),new eC(r.getProvider("app-check-internal")),function(c,h){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new me(J.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Uo(c.options.projectId,h)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Rr(My,"4.7.3",e),Rr(My,"4.7.3","esm2017")})();function Pg(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M9={PHONE:"phone",TOTP:"totp"},L9={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},$9={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},F9={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},U9={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CD(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function CI(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const j9=CD,kD=CI,kI=new Zo("auth","Firebase",CI()),q9={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rh=new Tm("@firebase/auth");function DD(n,...e){rh.logLevel<=dt.WARN&&rh.warn(`Auth (${yl}): ${n}`,...e)}function Sd(n,...e){rh.logLevel<=dt.ERROR&&rh.error(`Auth (${yl}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hr(n,...e){throw Cg(n,...e)}function er(n,...e){return Cg(n,...e)}function Rg(n,e,t){const r=Object.assign(Object.assign({},kD()),{[e]:t});return new Zo("auth","Firebase",r).create(e,{appName:n.name})}function Cn(n){return Rg(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function kl(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&hr(n,"argument-error"),Rg(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Cg(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return kI.create(n,...e)}function Ee(n,e,...t){if(!n)throw Cg(e,...t)}function ss(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Sd(e),new Error(e)}function Ks(n,e){n||ss(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ec(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function kg(){return W0()==="http:"||W0()==="https:"}function W0(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ND(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(kg()||RP()||"connection"in navigator)?navigator.onLine:!0}function VD(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ac{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ks(t>e,"Short delay should be less than long delay!"),this.isMobile=AP()||CP()}get(){return ND()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dg(n,e){Ks(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DI{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ss("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ss("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ss("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OD={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MD=new Ac(3e4,6e4);function zt(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Kt(n,e,t,r,s={}){return NI(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=vl(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},i);return PP()||(c.referrerPolicy="no-referrer"),DI.fetch()(VI(n,n.config.apiHost,t,a),c)})}async function NI(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},OD),e);try{const s=new $D(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw pu(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw pu(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw pu(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw pu(n,"user-disabled",o);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw Rg(n,h,c);hr(n,h)}}catch(s){if(s instanceof ds)throw s;hr(n,"network-request-failed",{message:String(s)})}}async function Zs(n,e,t,r,s={}){const i=await Kt(n,e,t,r,s);return"mfaPendingCredential"in i&&hr(n,"multi-factor-auth-required",{_serverResponse:i}),i}function VI(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?Dg(n.config,s):`${n.config.apiScheme}://${s}`}function LD(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class $D{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(er(this.auth,"network-request-failed")),MD.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function pu(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=er(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q0(n){return n!==void 0&&n.getResponse!==void 0}function J0(n){return n!==void 0&&n.enterprise!==void 0}class OI{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return LD(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FD(n){return(await Kt(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function MI(n,e){return Kt(n,"GET","/v2/recaptchaConfig",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UD(n,e){return Kt(n,"POST","/v1/accounts:delete",e)}async function jD(n,e){return Kt(n,"POST","/v1/accounts:update",e)}async function LI(n,e){return Kt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ru(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B9(n,e=!1){return je(n).getIdToken(e)}async function qD(n,e=!1){const t=je(n),r=await t.getIdToken(e),s=Yh(r);Ee(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Ru(Qf(s.auth_time)),issuedAtTime:Ru(Qf(s.iat)),expirationTime:Ru(Qf(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Qf(n){return Number(n)*1e3}function Yh(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Sd("JWT malformed, contained fewer than 3 sections"),null;try{const s=Zb(t);return s?JSON.parse(s):(Sd("Failed to decode base64 JWT payload"),null)}catch(s){return Sd("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Y0(n){const e=Yh(n);return Ee(e,"internal-error"),Ee(typeof e.exp<"u","internal-error"),Ee(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gs(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof ds&&BD(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function BD({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zD{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kp{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ru(this.lastLoginAt),this.creationTime=Ru(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tc(n){var e;const t=n.auth,r=await n.getIdToken(),s=await Gs(n,LI(t,{idToken:r}));Ee(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?$I(i.providerUserInfo):[],a=GD(n.providerData,o),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),h=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Kp(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,f)}async function KD(n){const e=je(n);await tc(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function GD(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function $I(n){return n.map(e=>{var{providerId:t}=e,r=Pg(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HD(n,e){const t=await NI(n,{},async()=>{const r=vl({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=VI(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",DI.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function WD(n,e){return Kt(n,"POST","/v2/accounts:revokeToken",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ba{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ee(e.idToken,"internal-error"),Ee(typeof e.idToken<"u","internal-error"),Ee(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Y0(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ee(e.length!==0,"internal-error");const t=Y0(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Ee(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await HD(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new Ba;return r&&(Ee(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(Ee(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(Ee(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ba,this.toJSON())}_performRefresh(){return ss("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yi(n,e){Ee(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class ks{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=Pg(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new zD(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Kp(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Gs(this,this.stsTokenManager.getToken(this.auth,e));return Ee(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return qD(this,e)}reload(){return KD(this)}_assign(e){this!==e&&(Ee(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ks(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Ee(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await tc(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(hn(this.auth.app))return Promise.reject(Cn(this.auth));const e=await this.getIdToken();return await Gs(this,UD(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,c,h;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,g=(s=t.email)!==null&&s!==void 0?s:void 0,y=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,I=(o=t.photoURL)!==null&&o!==void 0?o:void 0,A=(a=t.tenantId)!==null&&a!==void 0?a:void 0,S=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,$=(c=t.createdAt)!==null&&c!==void 0?c:void 0,U=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:M,emailVerified:L,isAnonymous:se,providerData:Q,stsTokenManager:x}=t;Ee(M&&x,e,"internal-error");const b=Ba.fromJSON(this.name,x);Ee(typeof M=="string",e,"internal-error"),yi(f,e.name),yi(g,e.name),Ee(typeof L=="boolean",e,"internal-error"),Ee(typeof se=="boolean",e,"internal-error"),yi(y,e.name),yi(I,e.name),yi(A,e.name),yi(S,e.name),yi($,e.name),yi(U,e.name);const E=new ks({uid:M,auth:e,email:g,emailVerified:L,displayName:f,isAnonymous:se,photoURL:I,phoneNumber:y,tenantId:A,stsTokenManager:b,createdAt:$,lastLoginAt:U});return Q&&Array.isArray(Q)&&(E.providerData=Q.map(C=>Object.assign({},C))),S&&(E._redirectEventId=S),E}static async _fromIdTokenResponse(e,t,r=!1){const s=new Ba;s.updateFromServerResponse(t);const i=new ks({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await tc(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];Ee(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?$I(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new Ba;a.updateFromIdToken(r);const l=new ks({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Kp(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X0=new Map;function Ds(n){Ks(n instanceof Function,"Expected a class definition");let e=X0.get(n);return e?(Ks(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,X0.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FI{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}FI.type="NONE";const Z0=FI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pd(n,e,t){return`firebase:${n}:${e}:${t}`}class za{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Pd(this.userKey,s.apiKey,i),this.fullPersistenceKey=Pd("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ks._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new za(Ds(Z0),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||Ds(Z0);const o=Pd(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const h=await c._get(o);if(h){const f=ks._fromJSON(e,h);c!==i&&(a=f),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new za(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new za(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e_(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(BI(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(UI(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(KI(e))return"Blackberry";if(GI(e))return"Webos";if(jI(e))return"Safari";if((e.includes("chrome/")||qI(e))&&!e.includes("edge/"))return"Chrome";if(zI(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function UI(n=wn()){return/firefox\//i.test(n)}function jI(n=wn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function qI(n=wn()){return/crios\//i.test(n)}function BI(n=wn()){return/iemobile/i.test(n)}function zI(n=wn()){return/android/i.test(n)}function KI(n=wn()){return/blackberry/i.test(n)}function GI(n=wn()){return/webos/i.test(n)}function Ng(n=wn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function QD(n=wn()){var e;return Ng(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function JD(){return kP()&&document.documentMode===10}function HI(n=wn()){return Ng(n)||zI(n)||GI(n)||KI(n)||/windows phone/i.test(n)||BI(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WI(n,e=[]){let t;switch(n){case"Browser":t=e_(wn());break;case"Worker":t=`${e_(wn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${yl}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YD{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XD(n,e={}){return Kt(n,"GET","/v2/passwordPolicy",zt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZD=6;class eN{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:ZD,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tN{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new t_(this),this.idTokenSubscription=new t_(this),this.beforeStateQueue=new YD(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=kI,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ds(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await za.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await LI(this,{idToken:e}),r=await ks._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(hn(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return Ee(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await tc(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=VD()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(hn(this.app))return Promise.reject(Cn(this));const t=e?je(e):null;return t&&Ee(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ee(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return hn(this.app)?Promise.reject(Cn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return hn(this.app)?Promise.reject(Cn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ds(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await XD(this),t=new eN(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Zo("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await WD(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ds(e)||this._popupRedirectResolver;Ee(t,this,"argument-error"),this.redirectPersistenceManager=await za.create(this,[Ds(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ee(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ee(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=WI(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&DD(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function an(n){return je(n)}class t_{constructor(e){this.auth=e,this.observer=null,this.addObserver=LP(t=>this.observer=t)}get next(){return Ee(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function nN(n){Sc=n}function Vg(n){return Sc.loadJS(n)}function rN(){return Sc.recaptchaV2Script}function sN(){return Sc.recaptchaEnterpriseScript}function iN(){return Sc.gapiScript}function QI(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const oN="recaptcha-enterprise",aN="NO_RECAPTCHA";class JI{constructor(e){this.type=oN,this.auth=an(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{MI(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new OI(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;J0(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(aN)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&J0(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=sN();l.length!==0&&(l+=a),Vg(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function n_(n,e,t,r=!1){const s=new JI(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function nc(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await n_(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await n_(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function lN(n){const e=an(n),t=await MI(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new OI(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new JI(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uN(n,e){const t=Ji(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Ui(i,e??{}))return s;hr(s,"already-initialized")}return t.initialize({options:e})}function cN(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Ds);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function dN(n,e,t){const r=an(n);Ee(r._canInitEmulator,r,"emulator-config-failed"),Ee(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=YI(e),{host:o,port:a}=hN(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||fN()}function YI(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function hN(n){const e=YI(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:r_(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:r_(o)}}}function r_(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function fN(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pc{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ss("not implemented")}_getIdTokenResponse(e){return ss("not implemented")}_linkToIdToken(e,t){return ss("not implemented")}_getReauthenticationResolver(e){return ss("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XI(n,e){return Kt(n,"POST","/v1/accounts:resetPassword",zt(n,e))}async function pN(n,e){return Kt(n,"POST","/v1/accounts:update",e)}async function mN(n,e){return Kt(n,"POST","/v1/accounts:signUp",e)}async function gN(n,e){return Kt(n,"POST","/v1/accounts:update",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vN(n,e){return Zs(n,"POST","/v1/accounts:signInWithPassword",zt(n,e))}async function Xh(n,e){return Kt(n,"POST","/v1/accounts:sendOobCode",zt(n,e))}async function yN(n,e){return Xh(n,e)}async function _N(n,e){return Xh(n,e)}async function bN(n,e){return Xh(n,e)}async function wN(n,e){return Xh(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xN(n,e){return Zs(n,"POST","/v1/accounts:signInWithEmailLink",zt(n,e))}async function IN(n,e){return Zs(n,"POST","/v1/accounts:signInWithEmailLink",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rc extends Pc{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new rc(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new rc(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return nc(e,t,"signInWithPassword",vN);case"emailLink":return xN(e,{email:this._email,oobCode:this._password});default:hr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return nc(e,r,"signUpPassword",mN);case"emailLink":return IN(e,{idToken:t,email:this._email,oobCode:this._password});default:hr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ls(n,e){return Zs(n,"POST","/v1/accounts:signInWithIdp",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EN="http://localhost";class Hs extends Pc{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Hs(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):hr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=Pg(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new Hs(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Ls(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Ls(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ls(e,t)}buildRequest(){const e={requestUri:EN,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=vl(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TN(n,e){return Kt(n,"POST","/v1/accounts:sendVerificationCode",zt(n,e))}async function AN(n,e){return Zs(n,"POST","/v1/accounts:signInWithPhoneNumber",zt(n,e))}async function SN(n,e){const t=await Zs(n,"POST","/v1/accounts:signInWithPhoneNumber",zt(n,e));if(t.temporaryProof)throw pu(n,"account-exists-with-different-credential",t);return t}const PN={USER_NOT_FOUND:"user-not-found"};async function RN(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return Zs(n,"POST","/v1/accounts:signInWithPhoneNumber",zt(n,t),PN)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o extends Pc{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new $o({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new $o({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return AN(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return SN(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return RN(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new $o({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CN(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function kN(n){const e=lu(uu(n)).link,t=e?lu(uu(e)).deep_link_id:null,r=lu(uu(n)).deep_link_id;return(r?lu(uu(r)).link:null)||r||t||e||n}class Rc{constructor(e){var t,r,s,i,o,a;const l=lu(uu(e)),c=(t=l.apiKey)!==null&&t!==void 0?t:null,h=(r=l.oobCode)!==null&&r!==void 0?r:null,f=CN((s=l.mode)!==null&&s!==void 0?s:null);Ee(c&&h&&f,"argument-error"),this.apiKey=c,this.operation=f,this.code=h,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=kN(e);try{return new Rc(t)}catch{return null}}}function z9(n){return Rc.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sa{constructor(){this.providerId=sa.PROVIDER_ID}static credential(e,t){return rc._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Rc.parseLink(t);return Ee(r,"argument-error"),rc._fromEmailAndCode(e,r.code,r.tenantId)}}sa.PROVIDER_ID="password";sa.EMAIL_PASSWORD_SIGN_IN_METHOD="password";sa.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ei{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dl extends ei{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Rd extends Dl{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return Ee("providerId"in t&&"signInMethod"in t,"argument-error"),Hs._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return Ee(e.idToken||e.accessToken,"argument-error"),Hs._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Rd.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Rd.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new Rd(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ai extends Dl{constructor(){super("facebook.com")}static credential(e){return Hs._fromParams({providerId:Ai.PROVIDER_ID,signInMethod:Ai.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ai.credentialFromTaggedObject(e)}static credentialFromError(e){return Ai.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ai.credential(e.oauthAccessToken)}catch{return null}}}Ai.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ai.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Si extends Dl{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Hs._fromParams({providerId:Si.PROVIDER_ID,signInMethod:Si.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Si.credentialFromTaggedObject(e)}static credentialFromError(e){return Si.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Si.credential(t,r)}catch{return null}}}Si.GOOGLE_SIGN_IN_METHOD="google.com";Si.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pi extends Dl{constructor(){super("github.com")}static credential(e){return Hs._fromParams({providerId:Pi.PROVIDER_ID,signInMethod:Pi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Pi.credentialFromTaggedObject(e)}static credentialFromError(e){return Pi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Pi.credential(e.oauthAccessToken)}catch{return null}}}Pi.GITHUB_SIGN_IN_METHOD="github.com";Pi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DN="http://localhost";class sc extends Pc{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Ls(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Ls(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ls(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new sc(r,i)}static _create(e,t){return new sc(e,t)}buildRequest(){return{requestUri:DN,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NN="saml.";class Gp extends ei{constructor(e){Ee(e.startsWith(NN),"argument-error"),super(e)}static credentialFromResult(e){return Gp.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Gp.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=sc.fromJSON(e);return Ee(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return sc._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri extends Dl{constructor(){super("twitter.com")}static credential(e,t){return Hs._fromParams({providerId:Ri.PROVIDER_ID,signInMethod:Ri.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ri.credentialFromTaggedObject(e)}static credentialFromError(e){return Ri.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Ri.credential(t,r)}catch{return null}}}Ri.TWITTER_SIGN_IN_METHOD="twitter.com";Ri.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZI(n,e){return Zs(n,"POST","/v1/accounts:signUp",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await ks._fromIdTokenResponse(e,r,s),o=s_(r);return new Dr({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=s_(r);return new Dr({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function s_(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VN(n){var e;if(hn(n.app))return Promise.reject(Cn(n));const t=an(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new Dr({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await ZI(t,{returnSecureToken:!0}),s=await Dr._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sh extends ds{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,sh.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new sh(e,t,r,s)}}function eE(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?sh._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tE(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function K9(n,e){const t=je(n);await Zh(!0,t,e);const{providerUserInfo:r}=await jD(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=tE(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Og(n,e,t=!1){const r=await Gs(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Dr._forOperation(n,"link",r)}async function Zh(n,e,t){await tc(e);const r=tE(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";Ee(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nE(n,e,t=!1){const{auth:r}=n;if(hn(r.app))return Promise.reject(Cn(r));const s="reauthenticate";try{const i=await Gs(n,eE(r,s,e,n),t);Ee(i.idToken,r,"internal-error");const o=Yh(i.idToken);Ee(o,r,"internal-error");const{sub:a}=o;return Ee(n.uid===a,r,"user-mismatch"),Dr._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&hr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rE(n,e,t=!1){if(hn(n.app))return Promise.reject(Cn(n));const r="signIn",s=await eE(n,r,e),i=await Dr._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function Mg(n,e){return rE(an(n),e)}async function ON(n,e){const t=je(n);return await Zh(!1,t,e.providerId),Og(t,e)}async function MN(n,e){return nE(je(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LN(n,e){return Zs(n,"POST","/v1/accounts:signInWithCustomToken",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function G9(n,e){if(hn(n.app))return Promise.reject(Cn(n));const t=an(n),r=await LN(t,{token:e,returnSecureToken:!0}),s=await Dr._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cc{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Lg._fromServerResponse(e,t):"totpInfo"in t?$g._fromServerResponse(e,t):hr(e,"internal-error")}}class Lg extends Cc{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Lg(t)}}class $g extends Cc{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new $g(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ef(n,e,t){var r;Ee(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),Ee(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(Ee(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(Ee(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fg(n){const e=an(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function $N(n,e,t){const r=an(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&ef(r,s,t),await nc(r,s,"getOobCode",_N)}async function FN(n,e,t){await XI(je(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Fg(n),r})}async function H9(n,e){await gN(je(n),{oobCode:e})}async function UN(n,e){const t=je(n),r=await XI(t,{oobCode:e}),s=r.requestType;switch(Ee(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":Ee(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":Ee(r.mfaInfo,t,"internal-error");default:Ee(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Cc._fromServerResponse(an(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function W9(n,e){const{data:t}=await UN(je(n),e);return t.email}async function jN(n,e,t){if(hn(n.app))return Promise.reject(Cn(n));const r=an(n),o=await nc(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ZI).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Fg(n),l}),a=await Dr._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function qN(n,e,t){return hn(n.app)?Promise.reject(Cn(n)):Mg(je(n),sa.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Fg(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q9(n,e,t){const r=an(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){Ee(a.handleCodeInApp,r,"argument-error"),a&&ef(r,o,a)}i(s,t),await nc(r,s,"getOobCode",bN)}function J9(n,e){const t=Rc.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function Y9(n,e,t){if(hn(n.app))return Promise.reject(Cn(n));const r=je(n),s=sa.credentialWithLink(e,t||ec());return Ee(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Mg(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BN(n,e){return Kt(n,"POST","/v1/accounts:createAuthUri",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function X9(n,e){const t=kg()?ec():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await BN(je(n),r);return s||[]}async function Z9(n,e){const t=je(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&ef(t.auth,s,e);const{email:i}=await yN(t.auth,s);i!==n.email&&await n.reload()}async function ez(n,e,t){const r=je(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&ef(r.auth,i,t);const{email:o}=await wN(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zN(n,e){return Kt(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tz(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=je(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Gs(r,zN(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function KN(n,e){const t=je(n);return hn(t.auth.app)?Promise.reject(Cn(t.auth)):sE(t,e,null)}function GN(n,e){return sE(je(n),null,e)}async function sE(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Gs(n,pN(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HN(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=Yh(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new Ka(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new WN(i,s);case"github.com":return new QN(i,s);case"google.com":return new JN(i,s);case"twitter.com":return new YN(i,s,n.screenName||null);case"custom":case"anonymous":return new Ka(i,null);default:return new Ka(i,r,s)}}class Ka{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class iE extends Ka{constructor(e,t,r,s){super(e,t,r),this.username=s}}class WN extends Ka{constructor(e,t){super(e,"facebook.com",t)}}class QN extends iE{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class JN extends Ka{constructor(e,t){super(e,"google.com",t)}}class YN extends iE{constructor(e,t,r){super(e,"twitter.com",t,r)}}function nz(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:HN(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XN(n,e){return je(n).setPersistence(e)}function rz(n){return lN(n)}async function sz(n,e){return an(n).validatePassword(e)}function ZN(n,e,t,r){return je(n).onIdTokenChanged(e,t,r)}function eV(n,e,t){return je(n).beforeAuthStateChanged(e,t)}function tV(n,e,t,r){return je(n).onAuthStateChanged(e,t,r)}function iz(n){je(n).useDeviceLanguage()}function oz(n,e){return je(n).updateCurrentUser(e)}function nV(n){return je(n).signOut()}function az(n,e){return an(n).revokeAccessToken(e)}async function lz(n){return je(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class No{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new No("enroll",e,t)}static _fromMfaPendingCredential(e){return new No("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return No._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return No._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ug{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=an(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Cc._fromServerResponse(r,a));Ee(s.mfaPendingCredential,r,"internal-error");const o=No._fromMfaPendingCredential(s.mfaPendingCredential);return new Ug(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const c=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const h=await Dr._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return Ee(t.user,r,"internal-error"),Dr._forOperation(t.user,t.operationType,c);default:hr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function uz(n,e){var t;const r=je(n),s=e;return Ee(e.customData.operationType,r,"argument-error"),Ee((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),Ug._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rV(n,e){return Kt(n,"POST","/v2/accounts/mfaEnrollment:start",zt(n,e))}function sV(n,e){return Kt(n,"POST","/v2/accounts/mfaEnrollment:finalize",zt(n,e))}function iV(n,e){return Kt(n,"POST","/v2/accounts/mfaEnrollment:start",zt(n,e))}function oV(n,e){return Kt(n,"POST","/v2/accounts/mfaEnrollment:finalize",zt(n,e))}function aV(n,e){return Kt(n,"POST","/v2/accounts/mfaEnrollment:withdraw",zt(n,e))}class jg{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Cc._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new jg(e)}async getSession(){return No._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await Gs(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Gs(this.user,aV(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const Jf=new WeakMap;function cz(n){const e=je(n);return Jf.has(e)||Jf.set(e,jg._fromUser(e)),Jf.get(e)}const ih="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oE{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ih,"1"),this.storage.removeItem(ih),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lV=1e3,uV=10;class aE extends oE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=HI(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);JD()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,uV):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},lV)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}aE.type="LOCAL";const lE=aE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uE extends oE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}uE.type="SESSION";const cE=uE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cV(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new tf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await cV(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}tf.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nf(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dV{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=nf("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const g=f;if(g.data.eventId===c)switch(g.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(g.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vn(){return window}function hV(n){vn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qg(){return typeof vn().WorkerGlobalScope<"u"&&typeof vn().importScripts=="function"}async function fV(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function pV(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function mV(){return qg()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dE="firebaseLocalStorageDb",gV=1,oh="firebaseLocalStorage",hE="fbase_key";class kc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function rf(n,e){return n.transaction([oh],e?"readwrite":"readonly").objectStore(oh)}function vV(){const n=indexedDB.deleteDatabase(dE);return new kc(n).toPromise()}function Hp(){const n=indexedDB.open(dE,gV);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(oh,{keyPath:hE})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(oh)?e(r):(r.close(),await vV(),e(await Hp()))})})}async function i_(n,e,t){const r=rf(n,!0).put({[hE]:e,value:t});return new kc(r).toPromise()}async function yV(n,e){const t=rf(n,!1).get(e),r=await new kc(t).toPromise();return r===void 0?null:r.value}function o_(n,e){const t=rf(n,!0).delete(e);return new kc(t).toPromise()}const _V=800,bV=3;class fE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Hp(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>bV)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return qg()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=tf._getInstance(mV()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await fV(),!this.activeServiceWorker)return;this.sender=new dV(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||pV()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Hp();return await i_(e,ih,"1"),await o_(e,ih),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>i_(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>yV(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>o_(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=rf(s,!1).getAll();return new kc(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),_V)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}fE.type="LOCAL";const wV=fE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xV(n,e){return Kt(n,"POST","/v2/accounts/mfaSignIn:start",zt(n,e))}function IV(n,e){return Kt(n,"POST","/v2/accounts/mfaSignIn:finalize",zt(n,e))}function EV(n,e){return Kt(n,"POST","/v2/accounts/mfaSignIn:finalize",zt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TV=500,AV=6e4,ud=1e12;class SV{constructor(e){this.auth=e,this.counter=ud,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new PV(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||ud;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||ud;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||ud;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class PV{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;Ee(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=RV(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},AV)},TV))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function RV(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yf=QI("rcb"),CV=new Ac(3e4,6e4);class kV{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=vn().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return Ee(DV(t),e,"argument-error"),this.shouldResolveImmediately(t)&&Q0(vn().grecaptcha)?Promise.resolve(vn().grecaptcha):new Promise((r,s)=>{const i=vn().setTimeout(()=>{s(er(e,"network-request-failed"))},CV.get());vn()[Yf]=()=>{vn().clearTimeout(i),delete vn()[Yf];const a=vn().grecaptcha;if(!a||!Q0(a)){s(er(e,"internal-error"));return}const l=a.render;a.render=(c,h)=>{const f=l(c,h);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${rN()}?${vl({onload:Yf,render:"explicit",hl:t})}`;Vg(o).catch(()=>{clearTimeout(i),s(er(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=vn().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function DV(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class NV{async load(e){return new SV(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pE="recaptcha",VV={theme:"light",type:"image"};class dz{constructor(e,t,r=Object.assign({},VV)){this.parameters=r,this.type=pE,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=an(e),this.isInvisible=this.parameters.size==="invisible",Ee(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;Ee(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new NV:new kV,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){Ee(!this.parameters.sitekey,this.auth,"argument-error"),Ee(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Ee(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=vn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){Ee(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Ee(kg()&&!qg(),this.auth,"internal-error"),await OV(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await FD(this.auth);Ee(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Ee(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function OV(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bg{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=$o._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function hz(n,e,t){if(hn(n.app))return Promise.reject(Cn(n));const r=an(n),s=await sf(r,e,je(t));return new Bg(s,i=>Mg(r,i))}async function fz(n,e,t){const r=je(n);await Zh(!1,r,"phone");const s=await sf(r.auth,e,je(t));return new Bg(s,i=>ON(r,i))}async function pz(n,e,t){const r=je(n);if(hn(r.auth.app))return Promise.reject(Cn(r.auth));const s=await sf(r.auth,e,je(t));return new Bg(s,i=>MN(r,i))}async function sf(n,e,t){var r;const s=await t.verify();try{Ee(typeof s=="string",n,"argument-error"),Ee(t.type===pE,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return Ee(o.type==="enroll",n,"internal-error"),(await rV(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{Ee(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return Ee(a,n,"missing-multi-factor-info"),(await xV(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await TN(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function mz(n,e){const t=je(n);if(hn(t.auth.app))return Promise.reject(Cn(t.auth));await Og(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ga{constructor(e){this.providerId=Ga.PROVIDER_ID,this.auth=an(e)}verifyPhoneNumber(e,t){return sf(this.auth,e,je(t))}static credential(e,t){return $o._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Ga.credentialFromTaggedObject(t)}static credentialFromError(e){return Ga.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?$o._fromTokenResponse(t,r):null}}Ga.PROVIDER_ID="phone";Ga.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ia(n,e){return e?Ds(e):(Ee(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zg extends Pc{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ls(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ls(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ls(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function MV(n){return rE(n.auth,new zg(n),n.bypassAuthState)}function LV(n){const{auth:e,user:t}=n;return Ee(t,e,"internal-error"),nE(t,new zg(n),n.bypassAuthState)}async function $V(n){const{auth:e,user:t}=n;return Ee(t,e,"internal-error"),Og(t,new zg(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mE{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return MV;case"linkViaPopup":case"linkViaRedirect":return $V;case"reauthViaPopup":case"reauthViaRedirect":return LV;default:hr(this.auth,"internal-error")}}resolve(e){Ks(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ks(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FV=new Ac(2e3,1e4);async function gz(n,e,t){if(hn(n.app))return Promise.reject(er(n,"operation-not-supported-in-this-environment"));const r=an(n);kl(n,e,ei);const s=ia(r,t);return new Ns(r,"signInViaPopup",e,s).executeNotNull()}async function vz(n,e,t){const r=je(n);if(hn(r.auth.app))return Promise.reject(er(r.auth,"operation-not-supported-in-this-environment"));kl(r.auth,e,ei);const s=ia(r.auth,t);return new Ns(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function yz(n,e,t){const r=je(n);kl(r.auth,e,ei);const s=ia(r.auth,t);return new Ns(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class Ns extends mE{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Ns.currentPopupAction&&Ns.currentPopupAction.cancel(),Ns.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ee(e,this.auth,"internal-error"),e}async onExecution(){Ks(this.filter.length===1,"Popup operations only handle one event");const e=nf();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(er(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(er(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ns.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(er(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,FV.get())};e()}}Ns.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UV="pendingRedirect",Cd=new Map;class jV extends mE{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Cd.get(this.auth._key());if(!e){try{const r=await qV(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Cd.set(this.auth._key(),e)}return this.bypassAuthState||Cd.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function qV(n,e){const t=vE(e),r=gE(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function Kg(n,e){return gE(n)._set(vE(e),"true")}function BV(n,e){Cd.set(n._key(),e)}function gE(n){return Ds(n._redirectPersistence)}function vE(n){return Pd(UV,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _z(n,e,t){return zV(n,e,t)}async function zV(n,e,t){if(hn(n.app))return Promise.reject(Cn(n));const r=an(n);kl(n,e,ei),await r._initializationPromise;const s=ia(r,t);return await Kg(s,r),s._openRedirect(r,e,"signInViaRedirect")}function bz(n,e,t){return KV(n,e,t)}async function KV(n,e,t){const r=je(n);if(kl(r.auth,e,ei),hn(r.auth.app))return Promise.reject(Cn(r.auth));await r.auth._initializationPromise;const s=ia(r.auth,t);await Kg(s,r.auth);const i=await _E(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function wz(n,e,t){return GV(n,e,t)}async function GV(n,e,t){const r=je(n);kl(r.auth,e,ei),await r.auth._initializationPromise;const s=ia(r.auth,t);await Zh(!1,r,e.providerId),await Kg(s,r.auth);const i=await _E(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function xz(n,e){return await an(n)._initializationPromise,yE(n,e,!1)}async function yE(n,e,t=!1){if(hn(n.app))return Promise.reject(Cn(n));const r=an(n),s=ia(r,e),o=await new jV(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function _E(n){const e=nf(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HV=10*60*1e3;class WV{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!QV(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!bE(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(er(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=HV&&this.cachedEventUids.clear(),this.cachedEventUids.has(a_(e))}saveEventToCache(e){this.cachedEventUids.add(a_(e)),this.lastProcessedEventTime=Date.now()}}function a_(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function bE({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function QV(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return bE(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JV(n,e={}){return Kt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YV=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,XV=/^https?/;async function ZV(n){if(n.config.emulator)return;const{authorizedDomains:e}=await JV(n);for(const t of e)try{if(eO(t))return}catch{}hr(n,"unauthorized-domain")}function eO(n){const e=ec(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!XV.test(t))return!1;if(YV.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tO=new Ac(3e4,6e4);function l_(){const n=vn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function nO(n){return new Promise((e,t)=>{var r,s,i;function o(){l_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{l_(),t(er(n,"network-request-failed"))},timeout:tO.get()})}if(!((s=(r=vn().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=vn().gapi)===null||i===void 0)&&i.load)o();else{const a=QI("iframefcb");return vn()[a]=()=>{gapi.load?o():t(er(n,"network-request-failed"))},Vg(`${iN()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw kd=null,e})}let kd=null;function rO(n){return kd=kd||nO(n),kd}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sO=new Ac(5e3,15e3),iO="__/auth/iframe",oO="emulator/auth/iframe",aO={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},lO=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function uO(n){const e=n.config;Ee(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Dg(e,oO):`https://${n.config.authDomain}/${iO}`,r={apiKey:e.apiKey,appName:n.name,v:yl},s=lO.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${vl(r).slice(1)}`}async function cO(n){const e=await rO(n),t=vn().gapi;return Ee(t,n,"internal-error"),e.open({where:document.body,url:uO(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:aO,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=er(n,"network-request-failed"),a=vn().setTimeout(()=>{i(o)},sO.get());function l(){vn().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dO={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},hO=500,fO=600,pO="_blank",mO="http://localhost";class u_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function gO(n,e,t,r=hO,s=fO){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},dO),{width:r.toString(),height:s.toString(),top:i,left:o}),c=wn().toLowerCase();t&&(a=qI(c)?pO:t),UI(c)&&(e=e||mO,l.scrollbars="yes");const h=Object.entries(l).reduce((g,[y,I])=>`${g}${y}=${I},`,"");if(QD(c)&&a!=="_self")return vO(e||"",a),new u_(null);const f=window.open(e||"",a,h);Ee(f,n,"popup-blocked");try{f.focus()}catch{}return new u_(f)}function vO(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yO="__/auth/handler",_O="emulator/auth/handler",bO=encodeURIComponent("fac");async function c_(n,e,t,r,s,i){Ee(n.config.authDomain,n,"auth-domain-config-required"),Ee(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:yl,eventId:s};if(e instanceof ei){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",MP(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))o[h]=f}if(e instanceof Dl){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),c=l?`#${bO}=${encodeURIComponent(l)}`:"";return`${wO(n)}?${vl(a).slice(1)}${c}`}function wO({config:n}){return n.emulator?Dg(n,_O):`https://${n.authDomain}/${yO}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xf="webStorageSupport";class xO{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=cE,this._completeRedirectFn=yE,this._overrideRedirectResult=BV}async _openPopup(e,t,r,s){var i;Ks((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await c_(e,t,r,ec(),s);return gO(e,o,nf())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await c_(e,t,r,ec(),s);return hV(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Ks(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await cO(e),r=new WV(e);return t.register("authEvent",s=>(Ee(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Xf,{type:Xf},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[Xf];o!==void 0&&t(!!o),hr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=ZV(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return HI()||jI()||Ng()}}const IO=xO;class wE{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return ss("unexpected MultiFactorSessionType")}}}class Gg extends wE{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Gg(e)}_finalizeEnroll(e,t,r){return sV(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return IV(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class EO{constructor(){}static assertion(e){return Gg._fromCredential(e)}}EO.FACTOR_ID="phone";class TO{static assertionForEnrollment(e,t){return ic._fromSecret(e,t)}static assertionForSignIn(e,t){return ic._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;Ee(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await iV(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return Hg._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}TO.FACTOR_ID="totp";class ic extends wE{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new ic(t,void 0,e)}static _fromEnrollmentId(e,t){return new ic(t,e)}async _finalizeEnroll(e,t,r){return Ee(typeof this.secret<"u",e,"argument-error"),oV(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){Ee(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return EV(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class Hg{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new Hg(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(cd(e)||cd(t))&&(s=!0),s&&(cd(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),cd(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function cd(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var d_="@firebase/auth",h_="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AO{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ee(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SO(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function PO(n){us(new zr("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;Ee(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:WI(n)},c=new tN(r,s,i,l);return cN(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),us(new zr("auth-internal",e=>{const t=an(e.getProvider("auth").getImmediate());return(r=>new AO(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Rr(d_,h_,SO(n)),Rr(d_,h_,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RO=5*60,CO=nw("authIdTokenMaxAge")||RO;let f_=null;const kO=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>CO)return;const s=t==null?void 0:t.token;f_!==s&&(f_=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function DO(n=Sm()){const e=Ji(n,"auth");if(e.isInitialized())return e.getImmediate();const t=uN(n,{popupRedirectResolver:IO,persistence:[wV,lE,cE]}),r=nw("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=kO(i.toString());eV(t,o,()=>o(t.currentUser)),ZN(t,a=>o(a))}}const s=ew("auth");return s&&dN(t,`http://${s}`),t}function NO(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}nN({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=er("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",NO().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});PO("Browser");const VO={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},of=aw(VO),le=iD(of),Ge=DO(of);try{oD(le)}catch{}try{XN(Ge,lE)}catch{}tV(Ge,n=>{n||VN(Ge)});async function OO(n,e){try{return(await jN(Ge,n,e)).user}catch(t){throw t}}async function xE(n,e){try{return(await qN(Ge,n,e)).user}catch(t){throw t}}async function Wg(n){try{await $N(Ge,n)}catch(e){throw e}}async function MO(n){try{const e=Ge.currentUser;if(e)await GN(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const Mi=Object.freeze(Object.defineProperty({__proto__:null,app:of,auth:Ge,createPlayerAccount:OO,db:le,resetPlayerPassword:Wg,signInPlayer:xE,updatePlayerPassword:MO},Symbol.toStringTag,{value:"Module"})),Nl="seasons";async function LO(n,e,t){return await Cl(et(le,Nl),{name:n,slug:e,pinCode:t,createdAt:no()})}async function $O(n){return await pl(Pe(le,Nl,n))}async function Va(){const n=Zu(et(le,Nl),fD("createdAt","desc"));return(await Pt(n)).docs.map(t=>({id:t.id,...t.data()}))}async function ah(n,e){const t=await jt(Pe(le,Nl,n));return t.exists()?t.data().pinCode===e:!1}async function Wp(n){const e=await jt(Pe(le,Nl,n));return e.exists()?e.data().pinCode:null}async function iu(n,e){const t=Pe(le,Nl,n);await Rl(t,{sortOrder:e})}const FO=["pin","pinCode","password","motdepasse","mdp","token","oobCode","apiKey","apikey","key","secret","authorization","auth","bearer"];function UO(){var t,r,s,i;const n=((r=(t=import.meta)==null?void 0:t.env)==null?void 0:r.MODE)==="development"?"debug":"warn";return((i=(s=import.meta)==null?void 0:s.env)==null?void 0:i.VITE_LOG_LEVEL)||n}function IE(n){switch(n){case"debug":return 10;case"info":return 20;case"warn":return 30;case"error":return 40;case"silent":return 100;default:return 30}}function jO(n){return typeof n!="string"?n:n.length<=2?"••":n.length>=8?`${n.slice(0,2)}••••${n.slice(-2)}`:"••••"}function EE(n){if(!n)return!1;const e=String(n).toLowerCase();return FO.some(t=>e.includes(t.toLowerCase()))}function Qp(n){if(n==null)return n;if(typeof n=="string"){if(n.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){const[r,s]=n.split("@"),i=r.length<=2?"••":`${r.slice(0,2)}••`,o=s.split("."),a=o[0].length<=2?"••":`${o[0].slice(0,2)}••`;return`${i}@${a}.${o.slice(1).join(".")}`}return n.length>=12&&!/\s/.test(n)?jO(n):n}if(typeof n=="number"){const e=String(n);return/^\d{4,6}$/.test(e)?"••••":n}if(Array.isArray(n))return n.map(e=>Qp(e));if(typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=EE(t)?"••••":Qp(r);return e}return n}function qO(n){const e=[];for(let t=0;t<n.length;t+=1){const r=n[t],s=t>0?n[t-1]:null;if(typeof s=="string"&&EE(s)&&(typeof r=="string"||typeof r=="number")){e.push("••••");continue}e.push(Qp(r))}return e}const BO=IE(UO());function dd(n,e){const t=IE(n);return(...r)=>{if(t<BO)return;const s=qO(r);console[e](...s)}}const K={debug:dd("debug","log"),info:dd("info","info"),warn:dd("warn","warn"),error:dd("error","error")},Qg="lastVisitedSeason",TE="lastVisitedSeasonTimestamp";async function zO(n){if(n)try{const e=Ge.currentUser,t=e==null?void 0:e.email;try{localStorage.setItem(Qg,n),localStorage.setItem(TE,Date.now().toString())}catch(r){K.warn("Erreur lors de la sauvegarde localStorage",r)}if(t)try{const r=Pe(le,"userPreferences",t);await sn(r,{lastVisitedSeason:n,lastVisitedSeasonTimestamp:Date.now()},{merge:!0}),K.debug("Préférence de saison sauvegardée dans Firebase",{seasonSlug:n,userEmail:t})}catch(r){K.warn("Erreur lors de la sauvegarde Firebase",r)}}catch(e){K.error("Erreur lors de la mémorisation de la saison",e)}}async function AE(){try{const n=Ge.currentUser,e=n==null?void 0:n.email;if(e)try{const t=Pe(le,"userPreferences",e),r=await jt(t);if(r.exists()){const s=r.data();if(s.lastVisitedSeason)return K.debug("Préférence de saison récupérée depuis Firebase",{seasonSlug:s.lastVisitedSeason}),s.lastVisitedSeason}}catch(t){K.warn("Erreur lors de la récupération Firebase",t)}try{const t=localStorage.getItem(Qg);if(t)return K.debug("Préférence de saison récupérée depuis localStorage",{seasonSlug:t}),t}catch(t){K.warn("Erreur lors de la lecture localStorage",t)}return null}catch(n){return K.error("Erreur lors de la récupération de la dernière saison",n),null}}async function KO(n=null){var e;try{const t=n||((e=Ge.currentUser)==null?void 0:e.email);try{localStorage.removeItem(Qg),localStorage.removeItem(TE)}catch(r){K.warn("Erreur lors du nettoyage localStorage",r)}if(t)try{const r=Pe(le,"userPreferences",t);await sn(r,{lastVisitedSeason:null,lastVisitedSeasonTimestamp:null},{merge:!0}),K.debug("Préférence de saison nettoyée dans Firebase",{userEmail:t})}catch(r){K.warn("Erreur lors du nettoyage Firebase",r)}}catch(t){K.error("Erreur lors du nettoyage des préférences",t)}}function GO(n,e){return!n||!e||!Array.isArray(e)?!1:e.some(t=>t.slug===n)}const $s=P(null),Di=P(!1),Rs=P(!1),HO=Fe(()=>{var n;return!!$s.value&&!((n=$s.value)!=null&&n.isAnonymous)});Fe(()=>!!$s.value);function Ha(){var n;try{const e=Ge.currentUser;e!==$s.value&&($s.value=e,K.debug("Synchronisation forcée de l'état d'authentification",{user:((n=$s.value)==null?void 0:n.email)||"non connecté"}))}catch(e){K.error("Erreur lors de la synchronisation forcée",e)}}function WO(){var n;if(K.debug("Tentative d'initialisation du service d'authentification",{isInitialized:Di.value,isInitializing:Rs.value}),Di.value||Rs.value){K.debug("Service déjà initialisé ou en cours d'initialisation, sortie");return}Rs.value=!0,K.debug("Marquage du service comme en cours d'initialisation");try{$s.value=Ge.currentUser,K.debug("État initial de l'utilisateur:",((n=$s.value)==null?void 0:n.email)||"non connecté");const e=Ge.onAuthStateChanged(t=>{$s.value=t,Di.value=!0,Rs.value=!1,K.debug("État d'authentification changé",{isLoggedIn:!!t,email:(t==null?void 0:t.email)||"non connecté"})});window._authStateUnsubscribe=e,K.info("Service d'état d'authentification initialisé avec succès")}catch(e){K.error("Erreur lors de l'initialisation du service d'authentification:",e),Rs.value=!1}}function SE(){return new Promise((n,e)=>{if(K.debug("waitForInitialization appelé",{isInitialized:Di.value,isInitializing:Rs.value}),Di.value){K.debug("Service déjà initialisé, résolution immédiate"),n();return}if(!Rs.value){K.warn("Service d'authentification non initialisé et non en cours d'initialisation"),e(new Error("Service d'authentification non initialisé"));return}const t=setInterval(()=>{K.debug("Vérification de l'initialisation...",{isInitialized:Di.value,isInitializing:Rs.value}),Di.value&&(clearInterval(t),K.debug("Service initialisé, résolution"),n())},100);setTimeout(()=>{clearInterval(t),K.warn("Timeout de waitForInitialization, rejet de la promesse"),e(new Error("Timeout d'initialisation du service d'authentification"))},5e3)})}function QO(){K.debug("Initialisation forcée demandée"),!Di.value&&!Rs.value&&lh()}function lh(){if(K.debug("Tentative d'auto-initialisation du service d'authentification"),typeof Ge>"u"||!Ge){K.warn("Firebase auth non disponible, nouvelle tentative dans 500ms"),setTimeout(lh,500);return}try{WO()}catch(n){K.error("Erreur lors de l'auto-initialisation:",n),setTimeout(lh,1e3)}}setTimeout(lh,100);const JO={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center"},YO={class:"text-center"},XO={class:"text-white text-lg"},ZO={__name:"SeasonResolver",setup(n){const e=gl(),t=P("Chargement...");return yn(async()=>{try{t.value="Vérification de votre session...",Ha(),await SE();const r=await new Promise((o,a)=>{const l=setTimeout(()=>{a(new Error("Timeout Firebase Auth"))},3e3),c=Ge.onAuthStateChanged(h=>{clearTimeout(l),c(),o(h)});Ge.currentUser&&(clearTimeout(l),c(),o(Ge.currentUser))}),s=r==null?void 0:r.email;if(!s){K.info("Utilisateur non connecté, redirection vers /seasons"),e.replace("/seasons");return}t.value="Récupération de vos préférences...";const i=await AE();if(!i){K.info("Aucune saison mémorisée, redirection vers /seasons"),e.replace("/seasons");return}t.value="Vérification de la saison...";try{const o=await Va();if(!GO(i,o)){K.info("Saison mémorisée n'existe plus, redirection vers /seasons"),await KO(s),e.replace("/seasons");return}}catch(o){K.error("Erreur lors de la vérification des saisons",o),e.replace("/seasons");return}K.info("Redirection vers la saison mémorisée",{seasonSlug:i}),e.replace(`/season/${i}`)}catch(r){K.error("Erreur lors de la résolution de la saison",r),e.replace("/seasons")}}),(r,s)=>(D(),V("div",JO,[d("div",YO,[s[0]||(s[0]=d("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"},null,-1)),d("p",XO,ie(t.value),1)])]))}},eM="/logos/hatcast-mask.png",PE="/logos/hatcast-logo-mobile.png",Zf=7*24*60*60*1e3,ou="impro_selector_pin_session";class tM{constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(ou);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<Zf){try{t.timestamp=Date.now(),localStorage.setItem(ou,JSON.stringify(t))}catch{}return t}else this.clearSession()}}catch{console.error("Erreur lors du chargement de la session PIN")}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(ou,JSON.stringify(r)),this.sessionData=r}catch{console.error("Erreur lors de la sauvegarde de la session PIN")}}isPinCached(e){if(!this.sessionData)return!1;const t=this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<Zf;if(t)try{this.sessionData.timestamp=Date.now(),localStorage.setItem(ou,JSON.stringify(this.sessionData))}catch{}return t}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(ou),this.sessionData=null}catch{console.error("Erreur lors de la suppression de la session PIN")}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=Zf-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const Vn=new tM,nM={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},rM={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},sM={class:"text-center mb-6"},iM={class:"text-gray-300"},oM={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},aM={class:"text-sm text-green-400"},lM={class:"mb-6"},uM={class:"mb-4"},cM={key:0,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},dM={class:"flex justify-end space-x-3"},hM=["disabled"],RE={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=P(""),i=P(""),o=P(null);bt(()=>t.show,h=>{h&&(s.value="",i.value="",Ht(()=>{var f;(f=o.value)==null||f.focus()}))});function a(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function l(){s.value.length===4&&r("submit",s.value)}function c(){r("cancel")}return(h,f)=>n.show?(D(),V("div",nM,[d("div",rM,[d("div",sM,[f[1]||(f[1]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔒")],-1)),f[2]||(f[2]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),d("p",iM,ie(n.message),1),n.sessionInfo?(D(),V("div",oM,[d("p",aM," Session active : "+ie(n.sessionInfo.timeRemaining)+" min restantes ",1)])):ce("",!0)]),d("div",lM,[d("div",uM,[f[3]||(f[3]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),ot(d("input",{"onUpdate:modelValue":f[0]||(f[0]=g=>s.value=g),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:a,onKeydown:[Bn(l,["enter"]),Bn(c,["escape"])],ref_key:"pinInput",ref:o},null,544),[[$t,s.value]])]),f[4]||(f[4]=d("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))]),i.value||t.error?(D(),V("div",cM,ie(i.value||t.error),1)):ce("",!0),d("div",dM,[d("button",{onClick:c,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:l,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,hM)])])])):ce("",!0)}},p_="impro_selector_trusted_players",m_=180*24*60*60*1e3;class fM{constructor(){this.trustedMap=this.load()}load(){try{const e=localStorage.getItem(p_);if(!e)return{};const t=JSON.parse(e);return typeof t=="object"&&t!==null?t:{}}catch{return{}}}persist(){try{localStorage.setItem(p_,JSON.stringify(this.trustedMap))}catch{}}isPasswordCached(e){if(!e)return!1;const t=this.trustedMap[e];if(!t)return!1;const r=Date.now(),s=r-t<m_;return s?(this.trustedMap[e]=r,this.persist()):(delete this.trustedMap[e],this.persist()),s}getCachedPassword(e){return null}saveSession(e,t){e&&(this.trustedMap[e]=Date.now(),this.persist())}clearSession(e){e&&(delete this.trustedMap[e],this.persist())}clearExpiredSessions(){const e=Date.now();let t=!1;for(const[r,s]of Object.entries(this.trustedMap))e-s>m_&&(delete this.trustedMap[r],t=!0);t&&this.persist()}clearAllSessions(){this.trustedMap={},this.persist()}}const Wi=new fM,pM={class:"mt-4"},mM={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-2"},CE={__name:"AccountBenefitsHint",setup(n){const e=P(!1);return(t,r)=>(D(),V("div",pM,[d("button",{onClick:r[0]||(r[0]=s=>e.value=!e.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[r[1]||(r[1]=d("h3",{class:"text-sm font-semibold text-blue-300"},"💡 A quoi sert un compte ?",-1)),d("span",{class:Zt(["text-blue-300 transition-transform duration-200",{"rotate-180":e.value}])},"▼",2)]),e.value?(D(),V("div",mM,r[2]||(r[2]=[d("div",{class:"text-gray-300"},"Ça fonctionne très bien sans compte. Mais si vous en créez un, vous aurez quelques trucs sympas en plus :",-1),d("div",null,[St("• "),d("span",{class:"text-blue-300"},"Protégez vos saisies :"),St(" vous êtes sûr que personne n'a changé vos dispos car vous êtes le seul à pouvoir les modifier")],-1),d("div",null,[St("• "),d("span",{class:"text-blue-300"},"Notifications :"),St(" nouveaux spectacles, disponibilités et sélections dans votre boite mail")],-1),d("div",null,[St("• "),d("span",{class:"text-blue-300"},"Saisie simplifiée :"),St(" votre joueur reste toujours en haut de la liste")],-1)]))):ce("",!0)]))}},gM={class:"space-y-4"},vM={class:"flex items-center justify-between"},yM={class:"flex items-center gap-2 text-gray-300 text-sm"},_M={key:0,class:"p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},bM={key:1,class:"p-3 bg-green-500/20 border border-green-500/30 rounded-lg text-green-300 text-sm"},wM={class:"flex justify-center gap-3 mt-2"},xM=["disabled"],IM={key:0,class:"animate-spin"},EM={key:1},kE={__name:"AccountLoginModal",props:{show:{type:Boolean,default:!1}},emits:["close","success"],setup(n,{emit:e}){const t=e,r=P(""),s=P(""),i=P(!1),o=P(""),a=P(""),l=P(!0),c=Fe(()=>!!r.value&&r.value.includes("@")&&!!s.value);async function h(){if(c.value){i.value=!0,o.value="",a.value="";try{if(await xE(r.value.trim(),s.value),l.value)try{Wi.saveSession(r.value.trim())}catch{}t("success")}catch{o.value="Email ou mot de passe incorrect"}finally{i.value=!1}}}async function f(){if(!r.value||!r.value.includes("@")){o.value="Saisissez votre email pour recevoir un lien de réinitialisation",setTimeout(()=>{o.value=""},2500);return}i.value=!0,o.value="",a.value="";try{await Wg(r.value.trim()),a.value="Email de réinitialisation envoyé"}catch{o.value="Impossible d'envoyer l'email de réinitialisation"}finally{i.value=!1}}return(g,y)=>n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[170] p-4",onClick:y[6]||(y[6]=I=>g.$emit("close"))},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:y[5]||(y[5]=ct(()=>{},["stop"]))},[d("button",{onClick:y[0]||(y[0]=I=>g.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),y[10]||(y[10]=Pn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Se connecter</h2><p class="text-sm text-gray-300">Connectez-vous pour gérer votre compte et vos préférences</p></div>',1)),d("div",gM,[Qe(CE),d("div",null,[y[7]||(y[7]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Email",-1)),ot(d("input",{"onUpdate:modelValue":y[1]||(y[1]=I=>r.value=I),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[$t,r.value]])]),d("div",null,[y[8]||(y[8]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),ot(d("input",{"onUpdate:modelValue":y[2]||(y[2]=I=>s.value=I),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe"},null,512),[[$t,s.value]])]),d("div",vM,[d("label",yM,[ot(d("input",{type:"checkbox","onUpdate:modelValue":y[3]||(y[3]=I=>l.value=I),class:"w-4 h-4"},null,512),[[Ci,l.value]]),y[9]||(y[9]=d("span",null,"Rester connecté sur cet appareil",-1))]),d("button",{onClick:f,class:"text-sm text-blue-400 hover:text-blue-300 underline"},"Mot de passe oublié ?")]),o.value?(D(),V("div",_M,ie(o.value),1)):ce("",!0),a.value?(D(),V("div",bM,ie(a.value),1)):ce("",!0),d("div",wM,[d("button",{onClick:h,disabled:!c.value||i.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(D(),V("span",IM,"⏳")):(D(),V("span",EM,"Se connecter"))],8,xM),d("button",{onClick:y[4]||(y[4]=I=>g.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])])):ce("",!0)}},af="magicLinks";function lf({seasonId:n,playerId:e,eventId:t,action:r}){return`${n}__${e}__${t}__${r}`}function Jg(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function Jp({seasonId:n,playerId:e,eventId:t,action:r}){const s=lf({seasonId:n,playerId:e,eventId:t,action:r}),i=Jg(40),o=Pe(le,af,s),a=Date.now()+1e3*60*60*24*7;await sn(o,{seasonId:n,playerId:e,eventId:t,token:i,action:r,expiresAt:a});const c=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(i)}&a=${encodeURIComponent(r)}`;return{id:s,token:i,url:c}}async function DE({seasonId:n,playerId:e,email:t}){const r="protection",s="verify_email",i=lf({seasonId:n,playerId:e,eventId:r,action:s}),o=Jg(40),a=Pe(le,af,i),l=Date.now()+1e3*60*60*24*7;await sn(a,{seasonId:n,playerId:e,eventId:r,token:o,action:s,email:t,expiresAt:l});const h=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(s)}`;return{id:i,token:o,url:h}}async function NE({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=lf({seasonId:n,playerId:e,eventId:t,action:s}),o=Pe(le,af,i),a=await jt(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function Yp({seasonId:n,playerId:e,eventId:t,action:r}){const s=lf({seasonId:n,playerId:e,eventId:t,action:r}),i=Pe(le,af,s);await pl(i)}const Yg="accountMagicLinks";function uf(n){return`account__${n}`}async function VE({currentEmail:n,newEmail:e}){const t=Jg(40),r=uf(t),s=Pe(le,Yg,r),i=Date.now()+1e3*60*60*24*7;await sn(s,{token:t,currentEmail:n,newEmail:e,action:"account_email_update",expiresAt:i});const a=`${window.location.origin+"/"}magic?a=account_email_update&t=${encodeURIComponent(t)}`;return{id:r,token:t,url:a}}async function OE({token:n}){const e=uf(n),t=Pe(le,Yg,e),r=await jt(t);if(!r.exists())return{valid:!1,reason:"not_found"};const s=r.data();return s.token!==n?{valid:!1,reason:"token_mismatch"}:typeof s.expiresAt=="number"&&Date.now()>s.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:s}}async function ME({token:n}){const e=uf(n),t=Pe(le,Yg,e);await pl(t)}const TM=Object.freeze(Object.defineProperty({__proto__:null,buildAccountId:uf,consumeAccountEmailUpdateLink:ME,consumeMagicLink:Yp,createAccountEmailUpdateLink:VE,createEmailVerificationLink:DE,createMagicLink:Jp,verifyAccountEmailUpdateLink:OE,verifyMagicLink:NE},Symbol.toStringTag,{value:"Module"}));async function Dc({toEmail:n,title:e,body:t,data:r={},reason:s="generic"}){if(!n)return{success:!1,error:"missing_toEmail"};const i={to:n,title:e,body:t,data:r,reason:s,createdAt:no()};return await Cl(et(le,"pushQueue"),i),{success:!0}}async function AM({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,eventUrl:o=void 0,reason:a="new_event",fromEmail:l=void 0}){try{const g=Pe(le,"userPreferences",n),y=await jt(g);if(y.exists()){const I=y.data();if((I==null?void 0:I.notifyAvailability)===!1)return{success:!0,skipped:!0}}}catch{}const c=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p><strong>Nouvel événement programmé!</strong></p>
      <p style="margin: 12px 0 2px 0; font-weight: 600;">${t}</p>
      <p style="margin: 0 0 16px 0; color:#374151;">${r}</p>
      <p>Nous avons besoin de savoir si tu es disponible.</p>
      <p style="margin-top: 12px;">
        <a href="${s}" style="display:inline-block;padding:10px 12px;margin-right:8px;border:2px solid #16a34a;color:#16a34a;border-radius:8px;text-decoration:none;">✅ Dispo</a>
        <a href="${i}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Pas dispo</a>
      </p>
      <p style="margin-top: 16px;">Merci!!</p>
    </div>
  `,h=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,f={to:n,message:{subject:h,html:c},createdAt:no(),meta:{reason:a,eventTitle:t,eventDate:r,playerName:e}};l&&(f.from=l,f.replyTo=l),await Cl(et(le,"mail"),f);try{const g=Pe(le,"userPreferences",n),y=await jt(g),I=y.exists()?y.data():{};if((I==null?void 0:I.notifyAvailabilityPush)!==!1){const A=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,S=`${e}, t'es dispo ?`;await Dc({toEmail:n,title:A,body:S,data:{url:o||window.location.origin,yesUrl:s,noUrl:i,reason:a},reason:a==="reminder"?"availability_reminder":"availability_request"})}}catch{}return{success:!0}}async function LE({toEmail:n,verifyUrl:e,purpose:t="player_protection",displayName:r="utilisateur",fromEmail:s=void 0}){const i=t==="account_email_update",o=i?"Vérification de votre nouvelle adresse email":"Vérification de votre email",a=`Bonjour ${r},`,l=i?"Pour sécuriser votre compte, merci de confirmer que vous avez accès à cette nouvelle adresse email.":"Pour sécuriser votre joueur, merci de confirmer que vous avez accès à cette adresse email.",c=i?"Confirmer mon adresse email":"Vérifier mon email",h=i?"Confirmez votre nouvelle adresse email":"Confirmez votre email pour activer la protection",f=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>${o}</h2>
      <p>${a}</p>
      <p>${l}</p>
      <p>
        <a href="${e}" style="display:inline-block;padding:10px 16px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;">${c}</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Ce lien expirera dans 7 jours.</p>
    </div>
  `,g={to:n,message:{subject:h,html:f},createdAt:no(),meta:{reason:t,displayName:r}};s&&(g.from=s,g.replyTo=s),await Cl(et(le,"mail"),g)}async function SM({toEmail:n,playerName:e,verifyUrl:t,fromEmail:r=void 0}){return LE({toEmail:n,verifyUrl:t,purpose:"player_protection",displayName:e,fromEmail:r})}async function PM({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,html:i=void 0,subject:o=void 0,fromEmail:a=void 0}){try{const f=Pe(le,"userPreferences",n),g=await jt(f);if(g.exists()){const y=g.data();if((y==null?void 0:y.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}K.debug("queueSelectionEmail",{forPlayer:e,hasCustomHtml:!!i,hasCustomSubject:!!o});const l=i||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>Bonjour ${e},</p>
      <p>Félicitations ! Tu as été sélectionné(e) pour <strong>${t}</strong> (${r}).</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Tu recevras bientôt plus d'informations sur l'organisation.</p>
    </div>
  `,c=o||`🎭 Sélection confirmée · ${t}`;K.debug("queueSelectionEmail html/subject ready");const h={to:n,message:{subject:c,html:l},createdAt:no(),meta:{reason:"selection",eventTitle:t,eventDate:r,playerName:e}};a&&(h.from=a,h.replyTo=a),K.debug("queueSelectionEmail firestore payload ready");try{await Cl(et(le,"mail"),h);try{const f=Pe(le,"userPreferences",n),g=await jt(f),y=g.exists()?g.data():{};(y==null?void 0:y.notifySelectionPush)!==!1&&await Dc({toEmail:n,title:"🎭 Sélection confirmée",body:`${e}, tu as été sélectionné(e) pour ${t} (${r}) 🎉`,data:{url:s||window.location.origin},reason:"selection"})}catch{}return K.info("Email ajouté à la queue Firestore",{playerName:e}),{success:!0}}catch(f){throw K.error("Erreur lors de l'ajout à Firestore",{playerName:e,error:f}),f}}async function RM({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,newSelectedPlayers:i=[],html:o=void 0,subject:a=void 0,fromEmail:l=void 0}){try{const y=Pe(le,"userPreferences",n),I=await jt(y);if(I.exists()){const A=I.data();if((A==null?void 0:A.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}const c=Array.isArray(i)?i.join(", "):"",h=o||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>🎭 Sélection mise à jour</h2>
      <p>Bonjour ${e},</p>
      <p>La sélection pour <strong>${t}</strong> (${r}) a été mise à jour et tu n'en fais plus partie 😔.</p>
      ${c?`<p>Nouvelle sélection: <strong>${c}</strong>.</p>`:""}
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#6b7280;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: mise à jour de sélection (relance auto ou ajustement manuel).</p>
    </div>
  `,f=a||`🎭 Tu n'es plus dans la sélection · ${t}`,g={to:n,message:{subject:f,html:h},createdAt:no(),meta:{reason:"deselection",eventTitle:t,eventDate:r,playerName:e,newSelectedPlayers:i}};l&&(g.from=l,g.replyTo=l),await Cl(et(le,"mail"),g);try{const y=Pe(le,"userPreferences",n),I=await jt(y),A=I.exists()?I.data():{};(A==null?void 0:A.notifySelectionPush)!==!1&&await Dc({toEmail:n,title:"🎭 Sélection mise à jour",body:`${e}, tu n'es plus sélectionné(e) pour ${t} (${r}) 😔`,data:{url:s||window.location.origin,noUrl:s&&s.includes("/event/")?s.replace("/event/","/magic?auto=no&event="):void 0},reason:"deselection"})}catch{}return{success:!0}}async function CM({eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,players:i}){if(K.info("sendSelectionEmailsForEvent",{eventId:n,seasonId:r,seasonSlug:s,playersCount:i==null?void 0:i.length,selectedCount:t==null?void 0:t.length}),!e||!t||t.length===0)throw new Error("Données manquantes pour l'envoi des emails de sélection");const{getPlayerEmail:o}=await en(()=>Promise.resolve().then(()=>Nc),void 0),{createMagicLink:a}=await en(()=>Promise.resolve().then(()=>TM),void 0),l=`${window.location.origin}/season/${s}/event/${n}`;t.join(", ");const c=`🎭 Sélection confirmée · ${e.title}`,h=[];for(const f of t){K.debug("Traitement du joueur",{playerName:f});try{const g=i==null?void 0:i.find(U=>U.name===f);if(!g){K.warn("Joueur non trouvé",{playerName:f});continue}K.debug("Joueur trouvé");const y=await o(g.id,r);if(!y){K.warn("Pas d'email pour le joueur",{playerName:f});continue}K.debug("Email trouvé pour joueur");const A=`${(await a({seasonId:r,playerId:g.id,eventId:n,action:"no"})).url}&slug=${encodeURIComponent(s)}`,S=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu as été sélectionné(e) pour <strong>${e.title}</strong> (${uh(e.date)}).</p>
          <p>Un imprévu ?</p>
          <p>
            <a href="${A}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;margin-right:8px;">❌ Plus dispo</a>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
          </p>
        </div>
      `;K.debug("HTML généré pour joueur");const $=PM({toEmail:y,playerName:f,eventTitle:e.title,eventDate:uh(e.date),eventUrl:l,html:S,subject:c});h.push($),K.info("Email ajouté à la queue",{playerName:f})}catch(g){K.error("Erreur lors de l'envoi de l'email de sélection",{playerName:f,error:g})}}return K.info("Nombre total d'emails à envoyer",{count:h.length}),await Promise.all(h),K.info("Tous les emails ont été envoyés avec succès"),{success:!0,count:h.length}}async function kM({eventId:n,eventData:e,removedPlayers:t,newSelectedPlayers:r,seasonId:s,seasonSlug:i,players:o}){if(K.info("sendDeselectionEmailsForEvent",{eventId:n,seasonId:s,removedCount:t==null?void 0:t.length}),!e||!t||t.length===0)return{success:!0,count:0};const{getPlayerEmail:a}=await en(()=>Promise.resolve().then(()=>Nc),void 0),l=`${window.location.origin}/season/${i}/event/${n}`,c=[],h=Array.isArray(r)?r.join(", "):"";for(const f of t)try{const g=o==null?void 0:o.find(A=>A.name===f);if(!g){K.warn("Joueur retiré non trouvé",{playerName:f});continue}const y=await a(g.id,s);if(!y){K.warn("Pas d'email pour le joueur retiré",{playerName:f});continue}const I=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2>🎭 Sélection mise à jour</h2>
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu n'es plus sélectionné(e) pour <strong>${e.title}</strong> (${uh(e.date)}) 😔.</p>
          ${h?`<p>Nouvelle sélection: <strong>${h}</strong>.</p>`:""}
          <p>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #6b7280;color:#6b7280;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
          </p>
        </div>
      `;c.push(RM({toEmail:y,playerName:f,eventTitle:e.title,eventDate:uh(e.date),eventUrl:l,newSelectedPlayers:r,html:I}))}catch(g){K.error("Erreur lors de l'envoi de l'email de désélection",{playerName:f,error:g})}return await Promise.all(c),K.info("Emails de désélection envoyés",{count:c.length}),{success:!0,count:c.length}}function uh(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function Xg(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}function $E(n){return`seasonPreferredPlayer:${n||"global"}`}function Xp(n,e){try{const t=$E(n),r=localStorage.getItem(t);if(!r){localStorage.setItem(t,JSON.stringify([e]));return}if(r.startsWith("[")){const s=JSON.parse(r);s.includes(e)||(s.push(e),localStorage.setItem(t,JSON.stringify(s)))}else r!==e&&localStorage.setItem(t,JSON.stringify([r,e]))}catch{}}function DM(n,e){try{const t=$E(n),r=localStorage.getItem(t);if(!r)return;if(r.startsWith("[")){const s=JSON.parse(r).filter(i=>i!==e);s.length===0?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(s))}else r===e&&localStorage.removeItem(t)}catch{}}async function FE(n,e,t,r=null){try{K.info("Début protectPlayer",{playerId:n,seasonId:r});const s=await Vl(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:l}=await en(()=>import("./index.esm-4a81f50f.js"),[]),{db:c}=await en(()=>Promise.resolve().then(()=>Mi),void 0),h=r?i(c,"seasons",r,"playerProtection"):i(c,"playerProtection"),f=o(h,a("email","==",e)),g=await l(f);if(!g.empty&&g.docs.find(M=>M.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");K.debug("Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:y}=await en(()=>import("./index.esm-3197b5c0.js"),[]),{auth:I}=await en(()=>Promise.resolve().then(()=>Mi),void 0),A=await y(I,e,t);K.info("Compte Firebase Auth créé",{uid:A.user.uid});const S=Xg(t),$=r?Pe(c,"seasons",r,"playerProtection",n):Pe(c,"playerProtection",n);return await sn($,{playerId:n,email:e,passwordHash:S,firebaseUid:A.user.uid,isProtected:!0,createdAt:new Date}),K.info("Protection sauvegardée dans Firestore"),r&&Xp(r,n),{success:!0}}catch(s){throw K.error("Erreur lors de la protection du joueur",s),s}}async function UE({playerId:n,email:e,seasonId:t=null}){const r=t?Pe(le,"seasons",t,"playerProtection",n):Pe(le,"playerProtection",n);(await jt(r)).exists()?await Rl(r,{email:e,updatedAt:new Date}):await sn(r,{playerId:n,email:e,isProtected:!1,createdAt:new Date});const{url:i}=await DE({seasonId:t,playerId:n,email:e});return{success:!0,url:i}}async function jE({playerId:n,seasonId:e=null}){const t=e?Pe(le,"seasons",e,"playerProtection",n):Pe(le,"playerProtection",n);if(!(await jt(t)).exists())throw new Error("Protection introuvable");return await Rl(t,{emailVerifiedAt:new Date}),{success:!0}}async function qE({playerId:n,seasonId:e=null}){const t=e?Pe(le,"seasons",e,"playerProtection",n):Pe(le,"playerProtection",n);return await Rl(t,{emailVerifiedAt:null}),{success:!0}}async function BE(n,e=null){try{const t=e?Pe(le,"seasons",e,"playerProtection",n):Pe(le,"playerProtection",n);return await sn(t,{playerId:n,email:"",isProtected:!1,emailVerifiedAt:null,updatedAt:new Date}),e&&DM(e,n),{success:!0,email:""}}catch(t){throw K.error("Erreur lors de la suppression de la protection",t),t}}async function Li(n,e=null){try{const t=e?Pe(le,"seasons",e,"playerProtection",n):Pe(le,"playerProtection",n),r=await jt(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return K.error("Erreur lors de la vérification de protection",t),!1}}async function Vl(n,e=null){try{const t=e?Pe(le,"seasons",e,"playerProtection",n):Pe(le,"playerProtection",n),r=await jt(t);return r.exists()?r.data():null}catch(t){return K.error("Erreur lors de la récupération des données de protection",t),null}}async function zE(n,e=null){try{const t=await Vl(n,e);return(t==null?void 0:t.email)||""}catch(t){return K.error("Erreur lors de la récupération de l'email",t),""}}async function Zp(n=null){try{const e=n?et(le,"seasons",n,"playerProtection"):et(le,"playerProtection");return(await Pt(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return K.error("Erreur lors du chargement des protections",e),[]}}async function cf(n){try{const e=[],t=Zu(et(le,"playerProtection"),nh("email","==",n));(await Pt(t)).forEach(i=>{const o=i.data();o!=null&&o.isProtected&&e.push({seasonId:null,playerId:i.id,...o})});const s=await Pt(et(le,"seasons"));for(const i of s.docs){const o=i.id,a=Zu(et(le,"seasons",o,"playerProtection"),nh("email","==",n));(await Pt(a)).forEach(c=>{var f;const h=c.data();h!=null&&h.isProtected&&e.push({seasonId:o,seasonName:(f=i.data())==null?void 0:f.name,playerId:c.id,...h})})}return e}catch(e){return K.error("Erreur listAssociationsForEmail",e),[]}}async function KE(n,e,t=null){try{const r=await Vl(n,t);if(!r||!r.isProtected)return!1;if(r.email){K.debug("Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await en(()=>import("./index.esm-3197b5c0.js"),[]),{auth:i}=await en(()=>Promise.resolve().then(()=>Mi),void 0);return await s(i,r.email,e),K.debug("Mot de passe Firebase Auth valide"),Wi.saveSession(n),t&&Xp(t,n),!0}catch(s){return K.debug("Mot de passe Firebase Auth invalide",{code:s.code}),!1}}else{K.debug("Vérification avec hash local");const s=Xg(e),i=r.passwordHash===s;return i&&(Wi.saveSession(n),t&&Xp(t,n)),i}}catch(r){return K.error("Erreur lors de la vérification du mot de passe",r),!1}}async function GE({playerId:n,seasonId:e=null}){const t=e?Pe(le,"seasons",e,"playerProtection",n):Pe(le,"playerProtection",n),r=await jt(t);if(!r.exists())throw new Error("Protection introuvable");const s=r.data();if(s!=null&&s.email)return await Rl(t,{isProtected:!0,updatedAt:new Date}),{success:!0};throw new Error("Email non défini pour cette protection")}function Fo(n){return Wi.isPasswordCached(n)}function NM(n){return null}async function HE(n,e=null){try{K.info("Début sendPasswordResetEmail",{playerId:n,seasonId:e});const t=await Vl(n,e);if(K.debug("Protection data disponible"),!t||!t.isProtected)throw new Error("Joueur non protégé");if(K.debug("Email à utiliser (masqué)"),t.firebaseUid){K.debug("Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await en(()=>import("./index.esm-3197b5c0.js"),[]),{auth:s}=await en(()=>Promise.resolve().then(()=>Mi),void 0);K.debug("Tentative d'envoi d'email"),await r(s,t.email),K.info("Email envoyé avec succès via Firebase Auth")}else{K.debug("Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await en(()=>import("./index.esm-3197b5c0.js"),[]),{auth:i}=await en(()=>Promise.resolve().then(()=>Mi),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);K.info("Compte temporaire créé",{uid:a.user.uid}),await s(i,t.email),K.info("Email envoyé avec succès");const{updateDoc:l}=await en(()=>import("./index.esm-4a81f50f.js"),[]),{db:c}=await en(()=>Promise.resolve().then(()=>Mi),void 0),h=e?Pe(c,"seasons",e,"playerProtection",n):Pe(c,"playerProtection",n);await l(h,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")K.debug("Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),K.info("Email envoyé avec succès");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw K.error("Erreur lors de l'envoi de l'email de réinitialisation",{error:t}),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}async function VM(n,e,t=null){try{const r=Xg(e),s=t?Pe(le,"seasons",t,"playerProtection",n):Pe(le,"playerProtection",n);return await Rl(s,{passwordHash:r,updatedAt:new Date}),{success:!0}}catch(r){throw K.error("Erreur lors de la mise à jour du mot de passe",r),r}}async function OM(n){return new Promise((e,t)=>{K.debug("Demande de mot de passe pour disponibilité"),t(new Error("Gestion de mot de passe à implémenter côté composant"))})}const Nc=Object.freeze(Object.defineProperty({__proto__:null,clearEmailVerificationForProtection:qE,finalizeProtectionAfterVerification:GE,getCachedPlayerPassword:NM,getPlayerEmail:zE,getPlayerProtectionData:Vl,isPlayerPasswordCached:Fo,isPlayerProtected:Li,listAssociationsForEmail:cf,listProtectedPlayers:Zp,markEmailVerifiedForProtection:jE,protectPlayer:FE,requirePlayerPasswordForAvailability:OM,sendPasswordResetEmail:HE,startEmailVerificationForProtection:UE,unprotectPlayer:BE,updatePlayerPasswordInFirestore:VM,verifyPlayerPassword:KE},Symbol.toStringTag,{value:"Module"})),MM={class:"mb-4 md:mb-6"},LM={class:"flex items-start gap-4"},$M={class:"flex items-center gap-3"},FM={class:"space-y-2"},UM={class:"flex items-center gap-2"},jM={class:"text-gray-400 text-xs md:text-sm"},qM={key:0,class:"flex items-center gap-2"},BM=["title"],zM={class:"text-blue-200"},KM={class:"space-y-4 md:space-y-6"},GM={class:"space-y-2 md:space-y-3"},HM={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5"},WM=["disabled"],QM={key:0,class:"mt-2 text-xs text-red-300"},JM={key:1,class:"mt-2 text-xs text-green-300"},YM={class:"space-y-2 md:space-y-3"},XM={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5"},ZM={class:"flex items-center justify-between mb-4"},eL={class:"space-y-4"},tL=["disabled"],nL={key:0,class:"text-xs text-red-300 text-center"},rL={key:1,class:"text-xs text-green-300 text-center"},sL={class:"flex items-center justify-between mb-4"},iL={class:"text-lg md:text-xl font-semibold text-white flex items-center gap-2"},oL={class:"space-y-3"},aL={key:0,class:"text-sm text-gray-400 text-center py-4"},lL={key:1,class:"space-y-2"},uL={class:"flex items-center gap-2 min-w-0 flex-1"},cL={class:"truncate"},dL={class:"text-white font-medium text-sm"},hL={class:"text-gray-400 text-xs"},fL=["onClick"],WE={__name:"AccountMenu",props:{show:{type:Boolean,default:!1},seasonId:{type:String,default:null}},emits:["close","delete-account","open-player"],setup(n,{emit:e}){const t=n,r=e,s=P(""),i=P(""),o=P(!1),a=P(""),l=P(""),c=P(!1),h=P(!1),f=P(""),g=P(""),y=P([]),I=P(!1),A=P(!1);bt(s,x=>{i.value=x||""}),bt(i,x=>{c.value=!!x&&x.includes("@")&&x!==s.value});async function S(){if(c.value){o.value=!0,a.value="",l.value="";try{const x=await VE({currentEmail:s.value,newEmail:i.value.trim()});await LE({toEmail:i.value.trim(),verifyUrl:x.url,purpose:"account_email_update",displayName:"utilisateur"}),l.value=`Un email de vérification a été envoyé à ${i.value.trim()}. Cliquez sur le lien pour confirmer le changement.`}catch(x){a.value=(x==null?void 0:x.code)==="auth/requires-recent-login"?"Veuillez vous reconnecter pour modifier votre email":"Impossible de mettre à jour l'email"}finally{o.value=!1}}}async function $(){if(s.value){h.value=!0,f.value="",g.value="";try{await Wg(s.value),g.value="Email de réinitialisation envoyé. Vérifiez votre boîte de réception."}catch{f.value="Impossible d'envoyer l'email de réinitialisation. Veuillez réessayer."}finally{h.value=!1}}}function U(x){return`${x.seasonId||"global"}__${x.playerId}`}async function M(){try{const x=s.value?await cf(s.value):[],b=[];for(const E of x){let C=E.playerId,O=E.seasonId||"—";try{if(E.seasonId){const F=Pe(le,"seasons",E.seasonId,"players",E.playerId),R=await jt(F);R.exists()&&(C=R.data().name||C);const pt=Pe(le,"seasons",E.seasonId),mt=await jt(pt);mt.exists()&&(O=mt.data().name||O)}}catch{}b.push({...E,playerName:C,seasonName:O})}y.value=b}catch{y.value=[]}}async function L(x){if(confirm(`Êtes-vous sûr de vouloir dissocier le joueur "${x.playerName}" de votre compte ?`))try{const{deleteDoc:b}=await en(()=>import("./index.esm-4a81f50f.js"),[]);if(x.seasonId){const C=Pe(le,"seasons",x.seasonId,"playerProtection",x.playerId);await b(C)}else{const C=Pe(le,"playerProtection",x.playerId);await b(C)}try{if(x.seasonId){const C=`seasonPreferredPlayer:${x.seasonId}`,O=localStorage.getItem(C);if(O)if(O.startsWith("[")){const R=(JSON.parse(O)||[]).filter(pt=>pt!==x.playerId);localStorage.setItem(C,JSON.stringify(R))}else O===x.playerId&&localStorage.removeItem(C)}}catch{}await M();const E=`Joueur "${x.playerName}" dissocié avec succès`}catch(b){console.error("Erreur lors de la dissociation:",b),alert(`Erreur lors de la dissociation: ${b.message||"Veuillez réessayer"}`)}}function se(x){r("open-player",x),Q()}function Q(){r("close")}return bt(()=>t.show,x=>{var b;if(x)try{s.value=((b=Ge==null?void 0:Ge.currentUser)==null?void 0:b.email)||"",M()}catch{}}),yn(()=>{var x;if(t.show)try{s.value=((x=Ge==null?void 0:Ge.currentUser)==null?void 0:x.email)||"",M()}catch{}}),(x,b)=>n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-2 md:p-4",onClick:Q},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-lg md:max-w-xl max-h-[90vh] overflow-y-auto",onClick:b[3]||(b[3]=ct(()=>{},["stop"]))},[d("button",{onClick:Q,class:"absolute right-2 md:right-3 top-2 md:top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),d("div",MM,[d("div",LM,[d("div",$M,[b[13]||(b[13]=d("div",{class:"w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full flex items-center justify-center flex-shrink-0"},[d("span",{class:"text-lg md:text-xl"},"👤")],-1)),d("div",FM,[b[12]||(b[12]=d("h3",{class:"text-white font-semibold text-base md:text-lg"},"Mon compte",-1)),d("div",UM,[d("span",jM,ie(s.value||"Non défini"),1),d("button",{onClick:b[0]||(b[0]=E=>I.value=!0),class:"text-indigo-400 hover:text-indigo-300 transition-colors p-1 hover:bg-indigo-400/10 rounded flex-shrink-0",title:"Modifier l'email","aria-label":"Modifier l'email"}," ✏️ ")]),y.value.length>0?(D(),V("div",qM,[d("button",{onClick:b[1]||(b[1]=E=>y.value.length===1?se(y.value[0]):A.value=!0),class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-xs md:text-sm hover:bg-blue-500/30 transition-colors cursor-pointer",title:y.value.length===1?`Voir ${y.value[0].playerName}`:"Gérer mes joueurs"},[b[11]||(b[11]=d("span",{class:"text-blue-300"},"⭐",-1)),d("span",zM,ie(y.value.length===1?y.value[0].playerName:`${y.value.length} joueurs`),1)],8,BM)])):ce("",!0)])])])]),b[18]||(b[18]=d("div",{class:"border-t border-white/10 mb-4 md:mb-6"},null,-1)),d("div",KM,[d("div",GM,[b[15]||(b[15]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-green-400"},"🔑"),St(" Mot de passe ")],-1)),d("div",HM,[b[14]||(b[14]=d("p",{class:"text-xs md:text-sm text-gray-400 mb-3"},"Vous pouvez changer votre mot de passe pour sécuriser vos opérations sensibles.",-1)),d("button",{onClick:$,disabled:h.value,class:"w-full px-3 md:px-4 py-2 md:py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm"},ie(h.value?"⏳":"Changer de mot de passe"),9,WM),f.value?(D(),V("div",QM,ie(f.value),1)):ce("",!0),g.value?(D(),V("div",JM,ie(g.value),1)):ce("",!0)])]),d("div",YM,[b[17]||(b[17]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-red-400"},"⚠️"),St(" Suppression de compte ")],-1)),d("div",XM,[b[16]||(b[16]=d("p",{class:"text-xs md:text-sm text-gray-400 mb-3"},"Cette action est irréversible et supprimera définitivement votre compte.",-1)),d("button",{onClick:b[2]||(b[2]=E=>x.$emit("delete-account")),class:"w-full px-3 md:px-4 py-2 md:py-3 rounded-lg bg-red-600 text-white hover:bg-red-500 text-sm"},"Supprimer mon compte")])])]),d("div",{class:"mt-4 md:mt-6 text-center"},[d("button",{onClick:Q,class:"px-4 md:px-6 py-2 md:py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 text-sm"},"Fermer")])]),I.value?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:b[7]||(b[7]=E=>I.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-md",onClick:b[6]||(b[6]=ct(()=>{},["stop"]))},[d("div",ZM,[b[19]||(b[19]=d("h3",{class:"text-lg md:text-xl font-semibold text-white flex items-center gap-2"},[d("span",{class:"text-blue-400"},"📧"),St(" Modifier l'email ")],-1)),d("button",{onClick:b[4]||(b[4]=E=>I.value=!1),class:"text-white/80 hover:text-white"},"✖️")]),d("div",eL,[d("div",null,[b[20]||(b[20]=d("label",{class:"block text-xs text-gray-400 mb-2"},"Nouvelle adresse email",-1)),ot(d("input",{"onUpdate:modelValue":b[5]||(b[5]=E=>i.value=E),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white placeholder-gray-400 text-sm",placeholder:"nouvel@email.com"},null,512),[[$t,i.value]])]),d("button",{onClick:S,disabled:!c.value||o.value,class:"w-full px-4 py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm"},ie(o.value?"⏳":"Mettre à jour"),9,tL),a.value?(D(),V("div",nL,ie(a.value),1)):ce("",!0),l.value?(D(),V("div",rL,ie(l.value),1)):ce("",!0)])])])):ce("",!0),A.value?(D(),V("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:b[10]||(b[10]=E=>A.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-lg",onClick:b[9]||(b[9]=ct(()=>{},["stop"]))},[d("div",sL,[d("h3",iL,[b[21]||(b[21]=d("span",{class:"text-yellow-400"},"⭐",-1)),St(" "+ie(y.value.length<=1?"Mon joueur":"Mes joueurs"),1)]),d("button",{onClick:b[8]||(b[8]=E=>A.value=!1),class:"text-white/80 hover:text-white"},"✖️")]),d("div",oL,[y.value.length===0?(D(),V("div",aL," Aucun joueur associé pour le moment. ")):(D(),V("div",lL,[(D(!0),V(it,null,br(y.value,E=>(D(),V("div",{key:U(E),class:"flex items-center justify-between p-3 bg-gray-800/30 rounded-lg"},[d("div",uL,[b[22]||(b[22]=d("span",{class:"text-yellow-400 text-sm"},"⭐",-1)),d("div",cL,[d("div",dL,ie(E.playerName||"—"),1),d("div",hL,ie(E.seasonName||E.seasonId||"—"),1)])]),d("button",{onClick:C=>L(E),class:"p-1.5 rounded bg-red-600/20 text-red-400 hover:bg-red-600/30 hover:text-red-300 transition-colors duration-200 flex-shrink-0",title:"Dissocier ce joueur","aria-label":"Dissocier ce joueur"}," 🗑️ ",8,fL)]))),128))]))])])])):ce("",!0)])):ce("",!0)}},pL="/logos/hatcast-logo-desktop.png",mL={key:0,class:"w-10 h-10 bg-gray-600 animate-pulse rounded-full"},gL=["aria-expanded"],em={__name:"AccountDropdown",props:{isConnected:{type:Boolean,default:!1},buttonClass:{type:String,default:"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700"}},emits:["open-account-menu","open-help","open-notifications","logout","open-login"],setup(n,{emit:e}){const t=n,r=e,s=P(!1),i=P(!0),o=P(null),a=P({});bt(()=>t.isConnected,S=>{i.value=!1},{immediate:!0}),yn(()=>{i.value=!1});function l(){r("open-login")}function c(){s.value=!s.value,s.value&&Ht(()=>h())}function h(){if(o.value){const S=o.value.getBoundingClientRect();a.value={top:`${S.bottom+8}px`,right:`${window.innerWidth-S.right}px`}}}function f(){s.value=!1,r("open-account-menu")}function g(){s.value=!1,r("open-help")}function y(){s.value=!1,r("open-notifications")}async function I(){s.value=!1;try{await Ge.signOut(),r("logout")}catch(S){console.error("Erreur lors de la déconnexion:",S)}}function A(){s.value=!1}return yn(()=>{document.addEventListener("click",A),window.addEventListener("resize",h),window.addEventListener("scroll",h,{passive:!0})}),Vi(()=>{document.removeEventListener("click",A),window.removeEventListener("resize",h),window.removeEventListener("scroll",h)}),(S,$)=>(D(),V("div",{class:"relative",onClick:$[0]||($[0]=ct(()=>{},["stop"]))},[i.value?(D(),V("div",mL)):n.isConnected?(D(),V("button",{key:2,onClick:c,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Mon compte","aria-label":"Mon compte","aria-expanded":s.value,"aria-haspopup":"true",ref_key:"dropdownButton",ref:o},$[1]||($[1]=[d("span",{class:"text-2xl"},"👤",-1)]),8,gL)):(D(),V("button",{key:1,onClick:l,class:Zt(["px-4 py-2 rounded-lg transition-all duration-300 border transition-colors",n.buttonClass])}," Connexion ",2)),(D(),Vs(Vu,{to:"body"},[s.value&&n.isConnected?(D(),V("div",{key:0,class:"fixed w-auto min-w-[180px] max-w-[200px] md:min-w-[200px] md:max-w-[240px] bg-gray-900 border border-white/20 rounded-lg shadow-xl py-1 z-[9999]",style:_r(a.value),role:"menu"},[d("button",{onClick:f,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},$[2]||($[2]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"👤",-1),d("span",{class:"truncate"},"Mon compte",-1)])),d("button",{onClick:y,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},$[3]||($[3]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"🔔",-1),d("span",{class:"truncate"},"Notifications",-1)])),d("button",{onClick:g,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},$[4]||($[4]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"❓",-1),d("span",{class:"truncate"},"Aide",-1)])),$[6]||($[6]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:I,class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},$[5]||($[5]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"🚪",-1),d("span",{class:"truncate"},"Se déconnecter",-1)]))],4)):ce("",!0)]))]))}},vL={class:"container mx-auto px-4 py-4"},yL={class:"flex items-center justify-between"},_L={class:"flex items-center gap-2"},bL={__name:"AppHeader",props:{isScrolled:{type:Boolean,default:!1}},emits:["open-account-menu","open-help","open-notifications","open-players","logout","open-login"],setup(n,{emit:e}){const t=n,r=e,s=Xo(),i=Fe(()=>t.isScrolled?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700":"bg-white/10 hover:bg-white/20 text-white border-white/20 hover:border-white/40");bt(()=>s.path,()=>{Ha(),setTimeout(()=>{Ha()},100)},{immediate:!0}),Vi(()=>{window._appHeaderUnsubscribe&&(window._appHeaderUnsubscribe(),delete window._appHeaderUnsubscribe)});function o(){r("open-account-menu")}function a(){r("open-help")}function l(){r("open-notifications")}function c(){r("open-players")}function h(){r("logout")}function f(){r("open-login")}return(g,y)=>(D(),V("header",{class:Zt(["fixed top-0 left-0 right-0 z-50 transition-all duration-300",n.isScrolled?"bg-white/95 backdrop-blur-md border-b border-gray-200/50 shadow-lg":"bg-gray-900/20 backdrop-blur-sm"])},[d("nav",vL,[d("div",yL,[y[0]||(y[0]=Pn('<div class="flex items-center"><a href="/" class="flex items-center"><div class="relative w-48 h-12 md:w-56 md:h-14"><img src="'+PE+'" alt="Logo HatCast - Retour à l&#39;accueil" class="w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 md:hidden"><img src="'+pL+'" alt="Logo HatCast - Retour à l&#39;accueil" class="w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 hidden md:block"></div></a></div>',1)),d("div",_L,[Qe(em,{"is-connected":Ur(HO),"button-class":i.value,onOpenAccountMenu:o,onOpenHelp:a,onOpenNotifications:l,onOpenPlayers:c,onLogout:h,onOpenLogin:f},null,8,["is-connected","button-class"]),KA(g.$slots,"actions")])])])],2))}},QE="@firebase/installations",Zg="0.6.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JE=1e4,YE=`w:${Zg}`,XE="FIS_v2",wL="https://firebaseinstallations.googleapis.com/v1",xL=60*60*1e3,IL="installations",EL="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TL={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Qo=new Zo(IL,EL,TL);function ZE(n){return n instanceof ds&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eT({projectId:n}){return`${wL}/projects/${n}/installations`}function tT(n){return{token:n.token,requestStatus:2,expiresIn:SL(n.expiresIn),creationTime:Date.now()}}async function nT(n,e){const r=(await e.json()).error;return Qo.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function rT({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function AL(n,{refreshToken:e}){const t=rT(n);return t.append("Authorization",PL(e)),t}async function sT(n){const e=await n();return e.status>=500&&e.status<600?n():e}function SL(n){return Number(n.replace("s","000"))}function PL(n){return`${XE} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RL({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=eT(n),s=rT(n),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={fid:t,authVersion:XE,appId:n.appId,sdkVersion:YE},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await sT(()=>fetch(r,a));if(l.ok){const c=await l.json();return{fid:c.fid||t,registrationStatus:2,refreshToken:c.refreshToken,authToken:tT(c.authToken)}}else throw await nT("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iT(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CL(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kL=/^[cdef][\w-]{21}$/,tm="";function DL(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=NL(n);return kL.test(t)?t:tm}catch{return tm}}function NL(n){return CL(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function df(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oT=new Map;function aT(n,e){const t=df(n);lT(t,e),VL(t,e)}function lT(n,e){const t=oT.get(n);if(t)for(const r of t)r(e)}function VL(n,e){const t=OL();t&&t.postMessage({key:n,fid:e}),ML()}let Vo=null;function OL(){return!Vo&&"BroadcastChannel"in self&&(Vo=new BroadcastChannel("[Firebase] FID Change"),Vo.onmessage=n=>{lT(n.data.key,n.data.fid)}),Vo}function ML(){oT.size===0&&Vo&&(Vo.close(),Vo=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LL="firebase-installations-database",$L=1,Jo="firebase-installations-store";let ep=null;function ev(){return ep||(ep=Ah(LL,$L,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Jo)}}})),ep}async function ch(n,e){const t=df(n),s=(await ev()).transaction(Jo,"readwrite"),i=s.objectStore(Jo),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&aT(n,e.fid),e}async function uT(n){const e=df(n),r=(await ev()).transaction(Jo,"readwrite");await r.objectStore(Jo).delete(e),await r.done}async function hf(n,e){const t=df(n),s=(await ev()).transaction(Jo,"readwrite"),i=s.objectStore(Jo),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&aT(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tv(n){let e;const t=await hf(n.appConfig,r=>{const s=FL(r),i=UL(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===tm?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function FL(n){const e=n||{fid:DL(),registrationStatus:0};return cT(e)}function UL(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Qo.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=jL(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:qL(n)}:{installationEntry:e}}async function jL(n,e){try{const t=await RL(n,e);return ch(n.appConfig,t)}catch(t){throw ZE(t)&&t.customData.serverCode===409?await uT(n.appConfig):await ch(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function qL(n){let e=await g_(n.appConfig);for(;e.registrationStatus===1;)await iT(100),e=await g_(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await tv(n);return r||t}return e}function g_(n){return hf(n,e=>{if(!e)throw Qo.create("installation-not-found");return cT(e)})}function cT(n){return BL(n)?{fid:n.fid,registrationStatus:0}:n}function BL(n){return n.registrationStatus===1&&n.registrationTime+JE<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zL({appConfig:n,heartbeatServiceProvider:e},t){const r=KL(n,t),s=AL(n,t),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={installation:{sdkVersion:YE,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await sT(()=>fetch(r,a));if(l.ok){const c=await l.json();return tT(c)}else throw await nT("Generate Auth Token",l)}function KL(n,{fid:e}){return`${eT(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nv(n,e=!1){let t;const r=await hf(n.appConfig,i=>{if(!dT(i))throw Qo.create("not-registered");const o=i.authToken;if(!e&&WL(o))return i;if(o.requestStatus===1)return t=GL(n,e),i;{if(!navigator.onLine)throw Qo.create("app-offline");const a=JL(i);return t=HL(n,a),a}});return t?await t:r.authToken}async function GL(n,e){let t=await v_(n.appConfig);for(;t.authToken.requestStatus===1;)await iT(100),t=await v_(n.appConfig);const r=t.authToken;return r.requestStatus===0?nv(n,e):r}function v_(n){return hf(n,e=>{if(!dT(e))throw Qo.create("not-registered");const t=e.authToken;return YL(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function HL(n,e){try{const t=await zL(n,e),r=Object.assign(Object.assign({},e),{authToken:t});return await ch(n.appConfig,r),t}catch(t){if(ZE(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await uT(n.appConfig);else{const r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await ch(n.appConfig,r)}throw t}}function dT(n){return n!==void 0&&n.registrationStatus===2}function WL(n){return n.requestStatus===2&&!QL(n)}function QL(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+xL}function JL(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function YL(n){return n.requestStatus===1&&n.requestTime+JE<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XL(n){const e=n,{installationEntry:t,registrationPromise:r}=await tv(e);return r?r.catch(console.error):nv(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZL(n,e=!1){const t=n;return await e4(t),(await nv(t,e)).token}async function e4(n){const{registrationPromise:e}=await tv(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t4(n){if(!n||!n.options)throw tp("App Configuration");if(!n.name)throw tp("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw tp(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function tp(n){return Qo.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hT="installations",n4="installations-internal",r4=n=>{const e=n.getProvider("app").getImmediate(),t=t4(e),r=Ji(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},s4=n=>{const e=n.getProvider("app").getImmediate(),t=Ji(e,hT).getImmediate();return{getId:()=>XL(t),getToken:s=>ZL(t,s)}};function i4(){us(new zr(hT,r4,"PUBLIC")),us(new zr(n4,s4,"PRIVATE"))}i4();Rr(QE,Zg);Rr(QE,Zg,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o4="/firebase-messaging-sw.js",a4="/firebase-cloud-messaging-push-scope",fT="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",l4="https://fcmregistrations.googleapis.com/v1",pT="google.c.a.c_id",u4="google.c.a.c_l",c4="google.c.a.ts",d4="google.c.a.e";var y_;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(y_||(y_={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var oc;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(oc||(oc={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function As(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function h4(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),s=new Uint8Array(r.length);for(let i=0;i<r.length;++i)s[i]=r.charCodeAt(i);return s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const np="fcm_token_details_db",f4=5,__="fcm_token_object_Store";async function p4(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(i=>i.name).includes(np))return null;let e=null;return(await Ah(np,f4,{upgrade:async(r,s,i,o)=>{var a;if(s<2||!r.objectStoreNames.contains(__))return;const l=o.objectStore(__),c=await l.index("fcmSenderId").get(n);if(await l.clear(),!!c){if(s===2){const h=c;if(!h.auth||!h.p256dh||!h.endpoint)return;e={token:h.fcmToken,createTime:(a=h.createTime)!==null&&a!==void 0?a:Date.now(),subscriptionOptions:{auth:h.auth,p256dh:h.p256dh,endpoint:h.endpoint,swScope:h.swScope,vapidKey:typeof h.vapidKey=="string"?h.vapidKey:As(h.vapidKey)}}}else if(s===3){const h=c;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:As(h.auth),p256dh:As(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:As(h.vapidKey)}}}else if(s===4){const h=c;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:As(h.auth),p256dh:As(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:As(h.vapidKey)}}}}}})).close(),await Uf(np),await Uf("fcm_vapid_details_db"),await Uf("undefined"),m4(e)?e:null}function m4(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g4="firebase-messaging-database",v4=1,ac="firebase-messaging-store";let rp=null;function mT(){return rp||(rp=Ah(g4,v4,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(ac)}}})),rp}async function y4(n){const e=gT(n),r=await(await mT()).transaction(ac).objectStore(ac).get(e);if(r)return r;{const s=await p4(n.appConfig.senderId);if(s)return await rv(n,s),s}}async function rv(n,e){const t=gT(n),s=(await mT()).transaction(ac,"readwrite");return await s.objectStore(ac).put(e,t),await s.done,e}function gT({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _4={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},tr=new Zo("messaging","Messaging",_4);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function b4(n,e){const t=await iv(n),r=vT(e),s={method:"POST",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(sv(n.appConfig),s)).json()}catch(o){throw tr.create("token-subscribe-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw tr.create("token-subscribe-failed",{errorInfo:o})}if(!i.token)throw tr.create("token-subscribe-no-token");return i.token}async function w4(n,e){const t=await iv(n),r=vT(e.subscriptionOptions),s={method:"PATCH",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(`${sv(n.appConfig)}/${e.token}`,s)).json()}catch(o){throw tr.create("token-update-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw tr.create("token-update-failed",{errorInfo:o})}if(!i.token)throw tr.create("token-update-no-token");return i.token}async function x4(n,e){const r={method:"DELETE",headers:await iv(n)};try{const i=await(await fetch(`${sv(n.appConfig)}/${e}`,r)).json();if(i.error){const o=i.error.message;throw tr.create("token-unsubscribe-failed",{errorInfo:o})}}catch(s){throw tr.create("token-unsubscribe-failed",{errorInfo:s==null?void 0:s.toString()})}}function sv({projectId:n}){return`${l4}/projects/${n}/registrations`}async function iv({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function vT({p256dh:n,auth:e,endpoint:t,vapidKey:r}){const s={web:{endpoint:t,auth:e,p256dh:n}};return r!==fT&&(s.web.applicationPubKey=r),s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I4=7*24*60*60*1e3;async function E4(n){const e=await A4(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:As(e.getKey("auth")),p256dh:As(e.getKey("p256dh"))},r=await y4(n.firebaseDependencies);if(r){if(S4(r.subscriptionOptions,t))return Date.now()>=r.createTime+I4?T4(n,{token:r.token,createTime:Date.now(),subscriptionOptions:t}):r.token;try{await x4(n.firebaseDependencies,r.token)}catch(s){console.warn(s)}return b_(n.firebaseDependencies,t)}else return b_(n.firebaseDependencies,t)}async function T4(n,e){try{const t=await w4(n.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:t,createTime:Date.now()});return await rv(n.firebaseDependencies,r),t}catch(t){throw t}}async function b_(n,e){const r={token:await b4(n,e),createTime:Date.now(),subscriptionOptions:e};return await rv(n,r),r.token}async function A4(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:h4(e)})}function S4(n,e){const t=e.vapidKey===n.vapidKey,r=e.endpoint===n.endpoint,s=e.auth===n.auth,i=e.p256dh===n.p256dh;return t&&r&&s&&i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w_(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return P4(e,n),R4(e,n),C4(e,n),e}function P4(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const r=e.notification.body;r&&(n.notification.body=r);const s=e.notification.image;s&&(n.notification.image=s);const i=e.notification.icon;i&&(n.notification.icon=i)}function R4(n,e){e.data&&(n.data=e.data)}function C4(n,e){var t,r,s,i,o;if(!e.fcmOptions&&!(!((t=e.notification)===null||t===void 0)&&t.click_action))return;n.fcmOptions={};const a=(s=(r=e.fcmOptions)===null||r===void 0?void 0:r.link)!==null&&s!==void 0?s:(i=e.notification)===null||i===void 0?void 0:i.click_action;a&&(n.fcmOptions.link=a);const l=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;l&&(n.fcmOptions.analyticsLabel=l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k4(n){return typeof n=="object"&&!!n&&pT in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */D4("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function D4(n,e){const t=[];for(let r=0;r<n.length;r++)t.push(n.charAt(r)),r<e.length&&t.push(e.charAt(r));return t.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N4(n){if(!n||!n.options)throw sp("App Configuration Object");if(!n.name)throw sp("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const r of e)if(!t[r])throw sp(r);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function sp(n){return tr.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V4{constructor(e,t,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const s=N4(e);this.firebaseDependencies={app:e,appConfig:s,installations:t,analyticsProvider:r}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function O4(n){try{n.swRegistration=await navigator.serviceWorker.register(o4,{scope:a4}),n.swRegistration.update().catch(()=>{})}catch(e){throw tr.create("failed-service-worker-registration",{browserErrorMessage:e==null?void 0:e.message})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function M4(n,e){if(!e&&!n.swRegistration&&await O4(n),!(!e&&n.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw tr.create("invalid-sw-registration");n.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function L4(n,e){e?n.vapidKey=e:n.vapidKey||(n.vapidKey=fT)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yT(n,e){if(!navigator)throw tr.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw tr.create("permission-blocked");return await L4(n,e==null?void 0:e.vapidKey),await M4(n,e==null?void 0:e.serviceWorkerRegistration),E4(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $4(n,e,t){const r=F4(e);(await n.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:t[pT],message_name:t[u4],message_time:t[c4],message_device_time:Math.floor(Date.now()/1e3)})}function F4(n){switch(n){case oc.NOTIFICATION_CLICKED:return"notification_open";case oc.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function U4(n,e){const t=e.data;if(!t.isFirebaseMessaging)return;n.onMessageHandler&&t.messageType===oc.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(w_(t)):n.onMessageHandler.next(w_(t)));const r=t.data;k4(r)&&r[d4]==="1"&&await $4(n,t.messageType,r)}const x_="@firebase/messaging",I_="0.12.12";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j4=n=>{const e=new V4(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>U4(e,t)),e},q4=n=>{const e=n.getProvider("messaging").getImmediate();return{getToken:r=>yT(e,r)}};function B4(){us(new zr("messaging",j4,"PUBLIC")),us(new zr("messaging-internal",q4,"PRIVATE")),Rr(x_,I_),Rr(x_,I_,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _T(){try{await sw()}catch{return!1}return typeof window<"u"&&Em()&&DP()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z4(n=Sm()){return _T().then(e=>{if(!e)throw tr.create("unsupported-browser")},e=>{throw tr.create("indexed-db-unsupported")}),Ji(je(n),"messaging").getImmediate()}async function K4(n,e){return n=je(n),yT(n,e)}B4();const E_="BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8";async function bT(){try{return await _T()}catch{return!1}}async function G4(){if(typeof navigator>"u"||!navigator.serviceWorker)return null;const n=await navigator.serviceWorker.ready;if(n!=null&&n.active&&n.active.state==="activated")return n;const e=(n==null?void 0:n.installing)||(n==null?void 0:n.waiting);return!e||e.state==="activated"||await new Promise(t=>{const r=()=>{e.state==="activated"&&(e.removeEventListener("statechange",r),t())};e.addEventListener("statechange",r)}),n}async function H4(n){var i;if(!await bT()||await Notification.requestPermission()!=="granted")return null;const t=z4(of);let r=n||await G4();const s=await K4(t,r?{vapidKey:E_,serviceWorkerRegistration:r}:{vapidKey:E_});try{const o=((i=Ge==null?void 0:Ge.currentUser)==null?void 0:i.email)||"anonymous";o&&s&&await sn(Pe(le,"userPushTokens",o),{tokens:PD(s),lastToken:s,email:o,updatedAt:no(),userAgent:navigator.userAgent},{merge:!0})}catch{}return s}const W4={class:"space-y-4 md:space-y-6"},Q4={class:"space-y-2 md:space-y-3"},J4={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},Y4={class:"flex items-center justify-between"},X4={class:"flex items-center gap-2"},Z4={class:"flex items-center justify-between"},e3={class:"flex items-center gap-2"},t3={class:"space-y-2 md:space-y-3"},n3={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},r3={class:"flex items-center justify-between"},s3={class:"flex items-center gap-2"},i3={class:"flex items-center justify-between"},o3={class:"flex items-center gap-2"},a3={class:"flex items-center justify-between pt-2 border-t border-white/10"},l3=["disabled"],u3={key:1,class:"inline-flex items-center text-xs text-gray-300"},c3={class:"flex items-center justify-between pt-2"},d3=["disabled"],h3={key:0,class:"text-xs text-green-300"},f3={key:1,class:"text-xs text-red-300"},p3={key:2,class:"text-[10px] text-gray-400 break-all"},m3={class:"text-[10px] text-gray-500"},g3={key:0,class:"text-xs text-red-300"},v3={key:1,class:"text-xs text-green-300"},y3={class:"mt-6 flex justify-between items-center"},_3=["disabled"],wT={__name:"NotificationsModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=n,r=e,s=P(""),i=P({notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}),o=P(!1),a=P(""),l=P(""),c=P(!1),h=P(""),f=P(""),g=P(!1),y=P(localStorage.getItem("fcmToken")||""),I=P(!1),A=function(Q){try{return Q?Q.length>20?Q.slice(0,8)+"…"+Q.slice(-6):Q:""}catch{return""}}("BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8");async function S(){try{if(!s.value)return;const se=Pe(le,"userPreferences",s.value),Q=await jt(se);if(Q.exists()){const x=Q.data()||{};i.value.notifyAvailability=x.notifyAvailability!==!1,i.value.notifySelection=x.notifySelection!==!1,i.value.notifySelectionPush=x.notifySelectionPush!==!1,i.value.notifyAvailabilityPush=x.notifyAvailabilityPush!==!1}else i.value={notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}}catch{}}async function $(){if(s.value){c.value=!0,f.value="",h.value="";try{await Dc({toEmail:s.value,title:"Test Impro Selector",body:"Ceci est un test de notification",data:{url:"/"},reason:"manual_test"}),h.value="OK"}catch{f.value="Échec de l'envoi du test"}finally{c.value=!1}}}async function U(){try{if(g.value=!0,!await bT()){f.value="Push non supporté sur cet appareil";return}const Q=window.__swReg,x=await H4(Q);if(x){y.value=x;try{localStorage.setItem("fcmToken",x)}catch{}I.value=!0}}catch(se){const Q=typeof Notification<"u"?Notification.permission:"unknown",x=se&&(se.message||se.code)?` (${se.message||se.code})`:"";f.value=`Activation impossible – permission: ${Q}${x}`}finally{g.value=!1}}async function M(){if(s.value){o.value=!0,a.value="",l.value="";try{const se=Pe(le,"userPreferences",s.value);await sn(se,{...i.value},{merge:!0}),l.value="Préférences sauvegardées"}catch{a.value="Impossible de sauvegarder vos préférences"}finally{o.value=!1}}}function L(){r("close")}return bt(()=>t.show,se=>{se&&S()}),yn(()=>{var se;try{s.value=((se=Ge==null?void 0:Ge.currentUser)==null?void 0:se.email)||"",I.value=typeof Notification<"u"&&Notification.permission==="granted"&&!!localStorage.getItem("fcmToken")}catch{}t.show&&S()}),(se,Q)=>n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:L},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:Q[4]||(Q[4]=ct(()=>{},["stop"]))},[d("button",{onClick:L,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),Q[15]||(Q[15]=Pn('<div class="mb-4 md:mb-6"><div class="flex items-start gap-4"><div class="flex items-center gap-3"><div class="w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full flex items-center justify-center flex-shrink-0"><span class="text-lg md:text-xl">🔔</span></div><div class="space-y-2"><h3 class="text-white font-semibold text-base md:text-lg">Notifications</h3><p class="text-gray-400 text-xs md:text-sm">Ne ratez rien, soyez le premier prévenu !</p></div></div></div></div><div class="border-t border-white/10 mb-4 md:mb-6"></div>',2)),d("div",W4,[d("div",Q4,[Q[7]||(Q[7]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-blue-400"},"📧"),St(" Emails ")],-1)),d("div",J4,[d("div",Y4,[d("label",X4,[ot(d("input",{type:"checkbox","onUpdate:modelValue":Q[0]||(Q[0]=x=>i.value.notifyAvailability=x),class:"w-4 h-4"},null,512),[[Ci,i.value.notifyAvailability]]),Q[5]||(Q[5]=d("span",{class:"text-sm text-white"},"M'envoyer un email lorsqu'un événement a besoin de joueurs",-1))])]),d("div",Z4,[d("label",e3,[ot(d("input",{type:"checkbox","onUpdate:modelValue":Q[1]||(Q[1]=x=>i.value.notifySelection=x),class:"w-4 h-4"},null,512),[[Ci,i.value.notifySelection]]),Q[6]||(Q[6]=d("span",{class:"text-sm text-white"},"M'envoyer un email lorsque je suis concerné par une sélection",-1))])])])]),d("div",t3,[Q[14]||(Q[14]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-emerald-400"},"📱"),St(" Mobile (expérimental) ")],-1)),d("div",n3,[Q[13]||(Q[13]=d("div",{class:"text-xs text-emerald-200 mb-1"},"Fonctionnalité en test: activable uniquement ici.",-1)),d("div",r3,[d("label",s3,[ot(d("input",{type:"checkbox","onUpdate:modelValue":Q[2]||(Q[2]=x=>i.value.notifySelectionPush=x),class:"w-4 h-4"},null,512),[[Ci,i.value.notifySelectionPush]]),Q[8]||(Q[8]=d("span",{class:"text-sm text-white"},"Me notifier lorsque je suis concerné par une sélection",-1))])]),d("div",i3,[d("label",o3,[ot(d("input",{type:"checkbox","onUpdate:modelValue":Q[3]||(Q[3]=x=>i.value.notifyAvailabilityPush=x),class:"w-4 h-4"},null,512),[[Ci,i.value.notifyAvailabilityPush]]),Q[9]||(Q[9]=d("span",{class:"text-sm text-white"},"Me notifier lorsqu'un événement a besoin de joueurs",-1))])]),d("div",a3,[Q[11]||(Q[11]=d("div",{class:"text-xs text-gray-400"},"Notifications sur cet appareil",-1)),I.value?(D(),V("span",u3,Q[10]||(Q[10]=[d("span",{class:"mr-1 text-emerald-400"},"✓",-1),St(" Actif ")]))):(D(),V("button",{key:0,onClick:U,disabled:g.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},ie(g.value?"...":"Activer"),9,l3))]),d("div",c3,[Q[12]||(Q[12]=d("div",{class:"text-xs text-gray-400"},"Test de notification push",-1)),d("button",{onClick:$,disabled:c.value||!s.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},ie(c.value?"Envoi…":"Envoyer un test"),9,d3)]),h.value?(D(),V("div",h3,"Notification test envoyée (vérifiez votre appareil)")):ce("",!0),f.value?(D(),V("div",f3,ie(f.value),1)):ce("",!0),y.value?(D(),V("div",p3,"FCM token: "+ie(y.value),1)):ce("",!0),d("div",m3,"VAPID: "+ie(Ur(A)||"indisponible"),1)])]),a.value?(D(),V("div",g3,ie(a.value),1)):ce("",!0),l.value?(D(),V("div",v3,ie(l.value),1)):ce("",!0)]),d("div",y3,[d("button",{onClick:M,disabled:o.value,class:"px-4 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-500 disabled:opacity-50"},ie(o.value?"⏳":"Sauvegarder"),9,_3),d("button",{onClick:L,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):ce("",!0)}},b3={class:"space-y-3"},w3={key:0,class:"text-sm text-gray-400"},x3={key:1,class:"space-y-2"},I3={class:"flex items-center justify-between gap-3"},E3={class:"truncate"},T3={class:"text-white font-semibold"},A3={class:"text-gray-400 text-xs"},S3=["onClick"],xT={__name:"PlayersModal",props:{show:{type:Boolean,default:!1}},emits:["close","manage-player"],setup(n,{emit:e}){const t=n,r=e,s=P(""),i=P([]);function o(h){return`${h.seasonId||"global"}__${h.playerId}`}async function a(){var h;try{s.value=((h=Ge==null?void 0:Ge.currentUser)==null?void 0:h.email)||""}catch{}try{const f=s.value?await cf(s.value):[],g=[];for(const y of f){let I=y.playerId;try{if(y.seasonId){const A=Pe(le,"seasons",y.seasonId,"players",y.playerId),S=await jt(A);S.exists()&&(I=S.data().name||I)}}catch{}g.push({...y,playerName:I})}i.value=g}catch{i.value=[]}}function l(h){r("manage-player",h),c()}function c(){r("close")}return bt(()=>t.show,h=>{h&&a()}),yn(()=>{t.show&&a()}),(h,f)=>n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:c},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:f[0]||(f[0]=ct(()=>{},["stop"]))},[d("button",{onClick:c,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),f[2]||(f[2]=Pn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👥</span></div><h2 class="text-2xl font-bold text-white mb-1">Mes joueurs</h2><p class="text-sm text-gray-300">Gérez vos associations de joueurs</p></div>',1)),d("div",b3,[f[1]||(f[1]=d("h3",{class:"text-white font-semibold mb-2"},"Mes joueurs associés",-1)),i.value.length===0?(D(),V("div",w3,"Aucun joueur associé pour le moment.")):(D(),V("ul",x3,[(D(!0),V(it,null,br(i.value,g=>(D(),V("li",{key:o(g),class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},[d("div",I3,[d("div",E3,[d("div",T3,ie(g.seasonName||g.seasonId||"—"),1),d("div",A3,"Joueur : "+ie(g.playerName||"—"),1)]),d("button",{onClick:y=>l(g),class:"px-3 py-2 rounded-lg bg-gray-700 text-white hover:bg-gray-600 text-xs"},"Gérer",8,S3)])]))),128))]))]),d("div",{class:"mt-6 text-center"},[d("button",{onClick:c,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):ce("",!0)}};let Jn="mock",$i=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],Yo=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function ov(n){Jn=n}async function P3(){if(Jn!=="firebase"||!(await Pt(et(le,"seasons"))).empty)return;const e=Pe(et(le,"seasons"));await sn(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:no()});const t=await Pt(et(le,"players"));for(const o of t.docs)await sn(Pe(e,"players",o.id),o.data());const r=await Pt(et(le,"events"));for(const o of r.docs)await sn(Pe(e,"events",o.id),o.data());const s=await Pt(et(le,"availability"));for(const o of s.docs)await sn(Pe(e,"availability",o.id),o.data());const i=await Pt(et(le,"selections"));for(const o of i.docs)await sn(Pe(e,"selections",o.id),o.data())}async function IT(){Jn==="firebase"&&await P3()}async function dh(n=null){let e;return Jn==="firebase"?n?e=(await Pt(et(le,"seasons",n,"events"))).docs.map(r=>({id:r.id,...r.data()})):e=(await Pt(et(le,"events"))).docs.map(r=>({id:r.id,...r.data()})):e=Yo,e.sort((t,r)=>{const s=c=>{if(!c)return null;if(c instanceof Date)return c;if(typeof(c==null?void 0:c.toDate)=="function")return c.toDate();const h=new Date(c);return isNaN(h.getTime())?null:h},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,l=o?o.getTime():Number.POSITIVE_INFINITY;return a!==l?a-l:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function Cu(n=null){let e;return Jn==="firebase"?n?e=(await Pt(et(le,"seasons",n,"players"))).docs.map(r=>({id:r.id,...r.data()})):e=(await Pt(et(le,"players"))).docs.map(r=>({id:r.id,...r.data()})):e=$i,e.sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function ET(n,e=null){if(Jn==="firebase"){const t=Pe(e?et(le,"seasons",e,"players"):et(le,"players"));return await sn(t,{name:n}),t.id}else{const t=`p${$i.length+1}`;return $i.push({id:t,name:n}),t}}async function R3(n,e=null){if(Jn==="firebase"){const t=e?Pe(le,"seasons",e,"players",n):Pe(le,"players",n);await pl(t);const r=e?await Pt(et(le,"seasons",e,"availability")):await Pt(et(le,"availability")),s=Ag(le);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else $i=$i.filter(t=>t.id!==n)}async function C3(n,e,t=null){if(Jn==="firebase"){const r=t?Pe(le,"seasons",t,"players",n):Pe(le,"players",n),s=await jt(r),i=s.exists()&&s.data().name||null;if(await sn(r,{name:e},{merge:!0}),i&&i!==e){const o=Ag(le);try{const a=t?Pe(le,"seasons",t,"availability",i):Pe(le,"availability",i),l=await jt(a);if(l.exists()){const c=l.data()||{},h=t?Pe(le,"seasons",t,"availability",e):Pe(le,"availability",e);o.set(h,c,{merge:!0}),o.delete(a)}}catch{}try{const a=t?et(le,"seasons",t,"selections"):et(le,"selections");(await Pt(a)).forEach(c=>{var f;const h=Array.isArray((f=c.data())==null?void 0:f.players)?c.data().players:[];if(h.includes(i)){const g=h.map(y=>y===i?e:y);o.update(c.ref,{players:g})}})}catch{}await o.commit()}}else{const r=$i.findIndex(s=>s.id===n);r!==-1&&($i[r]={...$i[r],name:e})}}async function Ao(n,e,t=null){if(Jn==="firebase"){const r=t?await Pt(et(le,"seasons",t,"availability")):await Pt(et(le,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function So(n=null){if(Jn==="firebase"){const e=n?await Pt(et(le,"seasons",n,"selections")):await Pt(et(le,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function T_(n,e,t=null){if(Jn==="firebase"){const r=t?Pe(le,"seasons",t,"availability",n):Pe(le,"availability",n);await sn(r,e)}}async function k3({seasonId:n,playerName:e,eventId:t,value:r}){if(Jn!=="firebase")return;const s=n?Pe(le,"seasons",n,"availability",e):Pe(le,"availability",e),i=await jt(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await sn(s,a)}async function nm(n,e,t=null){if(Jn==="firebase"){const r=t?Pe(le,"seasons",t,"selections",n):Pe(le,"selections",n);await sn(r,{players:e})}}async function D3(n,e=null){if(K.info("Suppression de l'événement",{eventId:n}),Jn==="firebase")try{K.debug("Suppression de l'événement dans Firestore");const t=e?Pe(le,"seasons",e,"events",n):Pe(le,"events",n);await pl(t),K.debug("Suppression de la sélection associée");const r=e?Pe(le,"seasons",e,"selections",n):Pe(le,"selections",n);await pl(r),K.debug("Suppression des disponibilités");const s=e?await Pt(et(le,"seasons",e,"availability")):await Pt(et(le,"availability")),i=Ag(le);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){K.debug("Mise à jour de la disponibilité pour un joueur");const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),K.info("Opérations de suppression terminées avec succès")}catch(t){throw K.error("Erreur lors de la suppression",t),t}else Yo=Yo.filter(t=>t.id!==n)}async function N3(n,e=null){if(Jn==="firebase"){const t=Pe(e?et(le,"seasons",e,"events"):et(le,"events"));return await sn(t,n),t.id}else{const t=`event${Yo.length+1}`;return Yo.push({id:t,...n}),t}}async function A_(n,e,t=null){if(Jn==="firebase"){const r=t?Pe(le,"seasons",t,"events",n):Pe(le,"events",n);await sn(r,e,{merge:!0})}else{const r=Yo.findIndex(s=>s.id===n);r!==-1&&(Yo[r]={id:n,...e})}}const V3={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},O3={class:"hero-section relative overflow-hidden pt-24"},M3={class:"hero-content py-16 md:py-24 px-4 relative z-10"},L3={class:"container mx-auto"},$3={class:"grid grid-cols-1 lg:grid-cols-2 gap-16 lg:gap-24 items-center"},F3={class:"text-center lg:text-left order-1 lg:order-2"},U3={class:"hero-cta mb-10"},j3={class:"flex flex-col sm:flex-row gap-4 items-center justify-center"},q3={class:"seasons-section py-16"},B3={class:"container mx-auto px-4"},z3=["aria-busy"],K3={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center animate-pulse"},G3={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center"},H3=["onClick"],W3={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},Q3={class:"flex justify-center gap-6 text-sm"},J3={class:"text-center"},Y3={class:"text-white font-semibold"},X3={class:"text-center"},Z3={class:"text-white font-semibold"},e$={class:"absolute top-4 right-4"},t$=["onClick","aria-expanded"],n$={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},r$=["onClick"],s$=["onClick"],i$=["onClick"],o$=["onClick"],a$={class:"text-center mt-12"},l$={key:2,class:"text-center py-16"},u$={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},c$={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},d$={class:"mb-6"},h$={class:"mb-6"},f$={class:"mb-6"},p$={class:"flex justify-end space-x-3"},m$=["disabled"],g$={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},v$={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},y$={class:"text-center mb-6"},_$={class:"text-gray-300"},b$={__name:"Seasons",setup(n){const e=P([]),t=P(!0),r=gl(),s=P(null),i=P(!1),o=P(!1),a=P(""),l=P(""),c=P(""),h=P(null),f=P(!1),g=P(null),y=P(""),I=P(!1),A=P(!1),S=P(!1),$=P(!1),U=P(!1);yn(async()=>{var j,ge;try{K.info("Début du chargement des saisons"),ov("firebase"),K.info("Mode de stockage défini sur Firebase"),await IT(),K.info("Stockage initialisé"),K.info("Attente de l'initialisation du service d'authentification...");try{QO(),await SE(),K.info("Service d'authentification initialisé")}catch(he){K.warn("Service d'authentification non initialisé, continuation sans authentification:",he.message||"Erreur inconnue")}try{Ha(),K.info("Synchronisation forcée effectuée")}catch(he){K.warn("Erreur lors de la synchronisation forcée:",he)}K.info("Chargement des saisons...");try{e.value=await Va(),K.info("Saisons chargées",{count:((j=e.value)==null?void 0:j.length)||0})}catch(he){throw K.error("Erreur lors du chargement des saisons:",he),he}if(e.value.length>0){K.info("Chargement des données des saisons...");const he=await Promise.all(e.value.map(async ke=>{try{K.debug(`Chargement des données pour la saison: ${ke.name} (ID: ${ke.id})`);let He,Xe;try{He=await dh(ke.id),K.debug(`Événements chargés pour ${ke.name}:`,He)}catch(gt){K.warn(`Erreur lors du chargement des événements pour ${ke.name}:`,gt),He=[]}try{Xe=await Cu(ke.id),K.debug(`Joueurs chargés pour ${ke.name}:`,Xe)}catch(gt){K.warn(`Erreur lors du chargement des joueurs pour ${ke.name}:`,gt),Xe=[]}return K.debug(`Saison ${ke.name}: ${(He==null?void 0:He.length)||0} événements, ${(Xe==null?void 0:Xe.length)||0} joueurs`),{...ke,events:He||[],players:Xe||[]}}catch(He){return K.warn(`Erreur lors du chargement des données pour la saison ${ke.id}:`,He),{...ke,events:[],players:[]}}}));e.value=he,K.info("Données des saisons chargées",{count:e.value.length}),e.value.forEach(ke=>{var He,Xe;K.info(`Saison finale ${ke.name}: ${((He=ke.events)==null?void 0:He.length)||0} événements, ${((Xe=ke.players)==null?void 0:Xe.length)||0} joueurs`)})}E().catch(he=>K.error("Migration sortOrder échouée",he))}catch(he){K.error("Erreur lors du chargement initial des saisons:",he),K.error("Stack trace:",he.stack);try{K.info("Tentative de fallback pour charger les saisons..."),e.value=await Va(),K.info("Saisons chargées en fallback",{count:((ge=e.value)==null?void 0:ge.length)||0})}catch(ke){K.error("Échec du fallback pour charger les saisons:",ke)}}finally{t.value=!1,K.info("Chargement terminé, isLoading = false")}const B=()=>{U.value=window.scrollY>10};return window.addEventListener("scroll",B,{passive:!0}),()=>{window.removeEventListener("scroll",B)}});const M=Fe(()=>[...e.value].sort((B,j)=>{var Xe,gt;const ge=typeof B.sortOrder=="number"?B.sortOrder:Number.MAX_SAFE_INTEGER,he=typeof j.sortOrder=="number"?j.sortOrder:Number.MAX_SAFE_INTEGER;if(ge!==he)return ge-he;const ke=(Xe=B.createdAt)!=null&&Xe.toMillis?B.createdAt.toMillis():0,He=(gt=j.createdAt)!=null&&gt.toMillis?j.createdAt.toMillis():0;return ke!==He?He-ke:(B.name||"").localeCompare(j.name||"")}));function L(B){r.push(`/season/${B}`)}function se(B){s.value=s.value===B?null:B}function Q(){s.value=null}function x(){const B=document.querySelector(".help-section");B&&B.scrollIntoView({behavior:"smooth"})}function b(){const B=document.querySelector(".seasons-section");B&&B.scrollIntoView({behavior:"smooth"})}async function E(){if(!e.value.length)return;const B=e.value.map(ge=>typeof ge.sortOrder=="number"?ge.sortOrder:null).filter(ge=>ge!==null);let j=B.length?Math.max(...B):0;for(const ge of e.value)if(typeof ge.sortOrder!="number"){j+=1;try{await iu(ge.id,j),ge.sortOrder=j}catch(he){K.error("Erreur migration sortOrder",{seasonName:ge==null?void 0:ge.name,error:he})}}}async function C(B){try{if(!(B!=null&&B.id)){alert("Saison introuvable");return}const[j,ge]=await Promise.all([dh(B.id),Cu(B.id)]),[he,ke]=await Promise.all([Ao(ge,j,B.id),So(B.id)]),He=["Joueur",...j.map(Un=>F(Un))],Xe=[];for(const Un of ge){const Tr=(Un==null?void 0:Un.name)||"",Yt=(he==null?void 0:he[Tr])||{},oa=[Tr,...j.map(jn=>re(Yt[jn.id],ke==null?void 0:ke[jn.id],Tr))];Xe.push(oa)}const gt=pt([He,...Xe]),Ot=new Blob(["\uFEFF"+gt],{type:"text/csv;charset=utf-8;"}),Ir=(B==null?void 0:B.name)||(B==null?void 0:B.slug)||"saison",Er=`${we(Ir)}-disponibilites.csv`,Mt=URL.createObjectURL(Ot),qt=document.createElement("a");qt.href=Mt,qt.download=Er,document.body.appendChild(qt),qt.click(),document.body.removeChild(qt),URL.revokeObjectURL(Mt),K.info("Export CSV saison",{seasonId:B.id,events:j.length,players:ge.length})}catch(j){K.error("Erreur export CSV",j),alert("Erreur lors de l'export CSV. Veuillez réessayer.")}}function O(B){if(!B)return null;if(B instanceof Date)return B;if(typeof(B==null?void 0:B.toDate)=="function")return B.toDate();if(typeof B=="string"||typeof B=="number"){const j=new Date(B);return isNaN(j.getTime())?null:j}return null}function F(B){const j=O(B==null?void 0:B.date),ge=j?`${j.getFullYear()}-${String(j.getMonth()+1).padStart(2,"0")}-${String(j.getDate()).padStart(2,"0")}`:"",he=(B==null?void 0:B.title)||"Sans titre";return`${ge} · ${he}`.trim()}function R(B){return B===!0||B==="oui"?"disponible":B===!1||B==="non"?"non disponible":""}function pt(B){return B.map(j=>j.map(mt).join(",")).join(`
`)}function mt(B){const j=String(B??"");return/[",\n\r]/.test(j)?'"'+j.replace(/"/g,'""')+'"':j}function we(B){return String(B||"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9\-_. ]+/g,"-").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$|^\.+|\.+$/g,"")||"fichier"}function re(B,j,ge){return Array.isArray(j)&&j.includes(ge)?B===!1||B==="non"?"non disponible":"sélectionné":R(B)}async function ue(B){if(Q(),B<=0)return;const j=[...M.value],ge=j[B],he=j[B-1],ke=ge.sortOrder;ge.sortOrder=he.sortOrder,he.sortOrder=ke;try{await Promise.all([iu(ge.id,ge.sortOrder),iu(he.id,he.sortOrder)])}catch(He){K.error("Erreur lors du déplacement vers le haut",He)}}async function oe(B){Q();const j=[...M.value];if(B>=j.length-1)return;const ge=j[B],he=j[B+1],ke=ge.sortOrder;ge.sortOrder=he.sortOrder,he.sortOrder=ke;try{await Promise.all([iu(ge.id,ge.sortOrder),iu(he.id,he.sortOrder)])}catch(He){K.error("Erreur lors du déplacement vers le bas",He)}}function Ne(){a.value&&(l.value=a.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function te(){c.value=c.value.replace(/[^0-9]/g,""),c.value.length>4&&(c.value=c.value.slice(0,4))}async function Y(){if(!a.value.trim()||!l.value.trim()||!c.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(c.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await LO(a.value.trim(),l.value.trim(),c.value.trim()),e.value=await Va(),await E(),Te()}catch(B){K.error("Erreur lors de la création de la saison",B),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function Te(){i.value=!1,a.value="",l.value="",c.value=""}function We(B){h.value=B,o.value=!0}async function at(){o.value=!1,await Ae({type:"deleteSeason",data:{seasonId:h.value.id,seasonName:h.value.name}})}function Vt(){o.value=!1,h.value=null}function Z(){return g.value?{deleteSeason:"Suppression de saison - Code PIN requis"}[g.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function Ae(B){if(Vn.isPinCached(h.value.id)){const j=Vn.getCachedPin(h.value.id);if(K.debug("PIN en cache trouvé, utilisation automatique"),await ah(h.value.id,j)){await lt(B);return}else Vn.clearSession()}g.value=B,f.value=!0}async function xe(B){var j,ge,he,ke;K.debug("PIN soumis pour l'opération",{operationType:(j=g.value)==null?void 0:j.type});try{const He=((he=(ge=g.value)==null?void 0:ge.data)==null?void 0:he.seasonId)||((ke=h.value)==null?void 0:ke.id),Xe=await ah(He,B);if(K.debug("PIN validé",{valid:Xe}),Xe){Vn.saveSession(He,B),K.debug("PIN correct, fermeture de la modal et exécution de l'opération"),f.value=!1;const gt=g.value;g.value=null,K.debug("Appel de executePendingOperation",{operationType:gt==null?void 0:gt.type}),await lt(gt)}else y.value="Code PIN incorrect",setTimeout(()=>{y.value=""},3e3)}catch(He){K.error("Erreur lors de la vérification du PIN",He),y.value="Erreur lors de la vérification du code PIN"}}function Ve(){f.value=!1,g.value=null,y.value=""}function tt(){return h.value&&Vn.isPinCached(h.value.id)?{timeRemaining:Vn.getTimeRemaining(),isExpiringSoon:Vn.isExpiringSoon()}:null}async function lt(B){var he;if(K.debug("executePendingOperation appelé",{hasOperation:!!B}),!B){K.warn("Aucune opération à exécuter");return}const{type:j,data:ge}=B;K.info("Exécution de l'opération",{type:j});try{switch(j){case"deleteSeason":K.info("Suppression de la saison",{seasonId:ge.seasonId}),await $O(ge.seasonId),K.info("Saison supprimée, rechargement de la liste"),e.value=await Va(),K.info("Liste des saisons rechargée",{count:((he=e.value)==null?void 0:he.length)||0});break;default:K.warn("Type d'opération non reconnu",{type:j})}}catch(ke){K.error("Erreur lors de l'exécution de l'opération",ke),alert("Erreur lors de l'opération. Veuillez réessayer.")}}function T(){I.value=!0}function k(){I.value=!1}function G(){I.value=!1,Ce()}function H(){A.value=!0}function ne(){A.value=!1}function de(){S.value=!0}function be(){S.value=!1}function _e(){$.value=!0}function Ie(){$.value=!1}function ye(){K.debug("Gestion de joueur demandée")}async function $e(){try{await Ge.signOut(),A.value=!1,K.info("Utilisateur déconnecté avec succès")}catch(B){K.error("Erreur lors de la déconnexion",B),alert("Erreur lors de la déconnexion. Veuillez réessayer.")}}async function Ce(){try{const B=await AE();if(B){r.push(`/season/${B}`);return}}catch(B){K.warn("Impossible de récupérer la saison préférée",B)}b()}return yn(()=>(Ha(),()=>{})),bt(()=>r.currentRoute.value.path,async B=>{var j;if(B==="/"&&(Ha(),e.value.length===0&&!t.value)){t.value=!0;try{e.value=await Va(),K.info("Saisons rechargées lors du changement de route",{count:((j=e.value)==null?void 0:j.length)||0})}catch(ge){K.error("Erreur lors du rechargement des saisons",ge)}finally{t.value=!1}}},{immediate:!0}),(B,j)=>{var ge;return D(),V("div",V3,[Qe(bL,{"is-scrolled":U.value,onOpenAccountMenu:H,onOpenHelp:x,onOpenNotifications:de,onOpenPlayers:_e,onLogout:$e,onOpenLogin:T},null,8,["is-scrolled"]),d("section",O3,[d("div",M3,[d("div",L3,[d("div",$3,[j[10]||(j[10]=Pn('<div class="text-center order-2 lg:order-1"><div class="hero-content-wrapper"><div class="hero-illustration relative hidden lg:block"><div class="relative mx-auto lg:mx-0 w-full max-w-lg"><div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-4 shadow-2xl border border-white/10 relative overflow-hidden"><div class="absolute inset-0 bg-gradient-to-br from-pink-500/10 via-purple-500/10 to-cyan-500/10 rounded-3xl blur-xl"></div><div class="relative z-10"><div class="flex items-center gap-3 mb-4"><div class="flex gap-2"><div class="w-3 h-3 bg-red-500 rounded-full"></div><div class="w-3 h-3 bg-yellow-500 rounded-full"></div><div class="w-3 h-3 bg-green-500 rounded-full"></div></div><div class="text-gray-400 text-sm">HatCast - Grille des disponibilités</div></div></div><div class="bg-gray-700 rounded-2xl p-4 min-h-[300px]"><div class="grid grid-cols-4 gap-2 mb-4"><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">15 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">22 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">29 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">5 Fév</div></div><div class="space-y-2"><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Marie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-gray-500/20 border border-gray-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Pierre</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Sophie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div></div></div></div></div><div class="absolute -top-4 -right-4 w-20 h-20 bg-gradient-to-r from-pink-400 to-purple-500 rounded-2xl shadow-xl transform rotate-12 z-30"></div><div class="absolute -bottom-4 -left-4 w-16 h-16 bg-gradient-to-r from-cyan-400 to-blue-500 rounded-2xl shadow-xl transform -rotate-12 z-30 flex items-center justify-center"><img src="'+eM+'" alt="Masque HatCast" class="w-10 h-10 object-contain transform rotate-12"></div></div></div></div>',1)),d("div",F3,[j[9]||(j[9]=Pn('<div class="hero-title mb-8"><h1 class="text-4xl md:text-6xl font-bold text-white mb-6 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent leading-tight"> Faites vos équipes d&#39;impro…<br>en un clin d&#39;œil </h1></div><div class="hero-subtitle mb-10"><p class="text-xl md:text-2xl text-gray-300 leading-relaxed max-w-2xl"> Plus de casse-tête pour savoir qui joue quand. Chacun indique ses dispos, <strong class="text-white">HatCast compose l&#39;équipe pour vous</strong>, équitablement et sans tension. </p></div>',2)),d("div",U3,[d("div",j3,[d("button",{onClick:j[0]||(j[0]=he=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-5 px-10 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105 text-lg md:text-xl"}," 🚀 Démarrez "),d("button",{onClick:x,class:"inline-flex items-center gap-2 text-cyan-300 hover:text-cyan-200 font-medium py-3 px-6 rounded-lg hover:bg-cyan-500/10 transition-all duration-300 border border-cyan-500/30 hover:border-cyan-400/50"},j[7]||(j[7]=[d("span",null,"ℹ️",-1),St(" En savoir plus ")]))])]),d("div",{class:"hero-hint text-center"},[d("button",{onClick:b,class:"inline-flex items-center gap-2 text-gray-400 hover:text-cyan-300 transition-all duration-300 text-sm cursor-pointer group"},j[8]||(j[8]=[d("span",{class:"group-hover:animate-bounce"},"↓",-1),d("span",null,"Vos saisons ci-dessous",-1),d("span",{class:"group-hover:animate-bounce"},"↓",-1)]))])])])])]),j[11]||(j[11]=d("div",{class:"hero-background absolute inset-0 z-0"},[d("div",{class:"absolute top-20 left-10 w-32 h-32 bg-pink-500/10 rounded-full blur-3xl"}),d("div",{class:"absolute bottom-20 right-10 w-40 h-40 bg-purple-500/10 rounded-full blur-3xl"}),d("div",{class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-cyan-500/5 rounded-full blur-3xl"})],-1))]),d("section",q3,[d("div",B3,[j[24]||(j[24]=d("div",{class:"text-center mb-12"},[d("h2",{class:"text-3xl md:text-4xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"}," Saisons en cours "),d("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto"}," Sélectionnez une saison pour gérer les disponibilités et équipes. ")],-1)),d("div",{class:"pb-16","aria-busy":t.value},[t.value?(D(),V("div",K3,[(D(),V(it,null,br(8,he=>d("div",{key:"skeleton-"+he,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8 w-full max-w-sm"},j[12]||(j[12]=[d("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),d("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),d("div",{class:"h-px bg-white/10 mb-4"},null,-1),d("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(D(),V("div",G3,[(D(!0),V(it,null,br(M.value,(he,ke)=>{var He,Xe;return D(),V("div",{key:he.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20 w-full max-w-sm"},[d("div",{onClick:gt=>L(he.slug),class:"text-center cursor-pointer"},[j[15]||(j[15]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg"},[d("span",{class:"text-2xl"},"🎭")],-1)),d("h2",W3,ie(he.name),1),j[16]||(j[16]=d("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),d("div",Q3,[d("div",J3,[d("div",Y3,ie(((He=he.events)==null?void 0:He.length)||0),1),j[13]||(j[13]=d("div",{class:"text-gray-400 text-xs"},"Événements",-1))]),d("div",X3,[d("div",Z3,ie(((Xe=he.players)==null?void 0:Xe.length)||0),1),j[14]||(j[14]=d("div",{class:"text-gray-400 text-xs"},"Joueurs",-1))])])],8,H3),d("div",e$,[d("div",{class:"relative",onClick:j[1]||(j[1]=ct(()=>{},["stop"]))},[d("button",{onClick:gt=>se(ke),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===ke,"aria-haspopup":"true",title:"Options"},j[17]||(j[17]=[d("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,t$),s.value===ke?(D(),V("div",n$,[d("button",{onClick:gt=>{C(he),Q()},class:"w-full text-left px-4 py-2 text-sm text-emerald-300 hover:bg-white/10",role:"menuitem"}," Exporter CSV ",8,r$),j[18]||(j[18]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:gt=>ue(ke),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Monter ",8,s$),d("button",{onClick:gt=>oe(ke),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Descendre ",8,i$),j[19]||(j[19]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:gt=>We(he),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10",role:"menuitem"}," Supprimer ",8,o$)])):ce("",!0)])])])}),128))])):ce("",!0),d("div",a$,[d("button",{onClick:j[2]||(j[2]=he=>i.value=!0),class:"inline-flex items-center gap-3 bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-semibold py-4 px-8 rounded-xl text-lg hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-pink-500/25"},j[20]||(j[20]=[d("span",null,"➕",-1),St(" Nouvelle saison ")]))]),!t.value&&e.value.length===0?(D(),V("div",l$,[j[21]||(j[21]=d("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[d("span",{class:"text-4xl"},"🎪")],-1)),j[22]||(j[22]=d("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),j[23]||(j[23]=d("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),d("button",{onClick:j[3]||(j[3]=he=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):ce("",!0)],8,z3)])]),i.value?(D(),V("div",u$,[d("div",c$,[j[29]||(j[29]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),d("div",d$,[j[25]||(j[25]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),ot(d("input",{"onUpdate:modelValue":j[4]||(j[4]=he=>a.value=he),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:Ne},null,544),[[$t,a.value]])]),d("div",h$,[j[26]||(j[26]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),ot(d("input",{"onUpdate:modelValue":j[5]||(j[5]=he=>l.value=he),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[$t,l.value]])]),d("div",f$,[j[27]||(j[27]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),ot(d("input",{"onUpdate:modelValue":j[6]||(j[6]=he=>c.value=he),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:te},null,544),[[$t,c.value]]),j[28]||(j[28]=d("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),d("div",p$,[d("button",{onClick:Te,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:Y,disabled:!a.value.trim()||!l.value.trim()||!c.value.trim()||c.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,m$)])])])):ce("",!0),o.value?(D(),V("div",g$,[d("div",v$,[d("div",y$,[j[30]||(j[30]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"⚠️")],-1)),j[31]||(j[31]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),d("p",_$,'Êtes-vous sûr de vouloir supprimer la saison "'+ie((ge=h.value)==null?void 0:ge.name)+'" ?',1)]),j[32]||(j[32]=d("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:Vt,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:at,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ce("",!0),Qe(RE,{show:f.value,message:Z(),error:y.value,"session-info":tt(),onSubmit:xe,onCancel:Ve},null,8,["show","message","error","session-info"]),j[33]||(j[33]=Pn('<section class="help-section py-20 bg-gradient-to-br from-gray-900/50 to-gray-800/50 border-t border-white/10"><div class="container mx-auto px-4"><div class="max-w-6xl mx-auto"><div class="text-center mb-16"><h2 class="text-4xl md:text-5xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"> Qu&#39;est-ce que HatCast ? </h2><p class="text-xl text-purple-300 max-w-3xl mx-auto"> L&#39;appli pour sélectionner vos joueurs d&#39;impro simplement, équitablement et sans prise de tête </p></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16"><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-pink-500/20 to-purple-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-pink-500/30"><span class="text-4xl">🎭</span></div><h3 class="text-xl font-bold text-white mb-3">Gestion des saisons</h3><p class="text-gray-300 text-sm leading-relaxed"> Déclarez tous vos spectacles et indiquez combien de joueurs vous aurez besoin. Organisez votre saison d&#39;impro de A à Z. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-purple-500/20 to-cyan-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-purple-500/30"><span class="text-4xl">📅</span></div><h3 class="text-xl font-bold text-white mb-3">Sondage de disponibilités</h3><p class="text-gray-300 text-sm leading-relaxed"> Créez des sondages pour vos événements. Chaque joueur indique ses disponibilités et HatCast optimise la composition des équipes. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-cyan-500/20 to-pink-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-cyan-500/30"><span class="text-4xl">🎲</span></div><h3 class="text-xl font-bold text-white mb-3">Sélection auto ou manuelle</h3><p class="text-gray-300 text-sm leading-relaxed"> Laissez le hasard pondéré décider ou reprenez la main à tout moment. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-green-500/20 to-blue-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-green-500/30"><span class="text-4xl">📱</span></div><h3 class="text-xl font-bold text-white mb-3">Pensé pour le mobile</h3><p class="text-gray-300 text-sm leading-relaxed"> Utilisez HatCast facilement sur smartphone ou tablette, où que vous soyez. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-blue-500/20 to-indigo-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-blue-500/30"><span class="text-4xl">🔐</span></div><h3 class="text-xl font-bold text-white mb-3">Comptes facultatifs</h3><p class="text-gray-300 text-sm leading-relaxed"> Créez un compte pour recevoir des rappels et sécuriser vos infos. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-emerald-500/20 to-teal-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-emerald-500/30"><span class="text-4xl">🔔</span></div><h3 class="text-xl font-bold text-white mb-3">Notifications intelligentes</h3><p class="text-gray-300 text-sm leading-relaxed"> Recevez des alertes par email et push pour les événements et sélections. Restez informé sans être submergé. </p></div></div></div></div></section><footer class="border-t border-white/10 bg-gradient-to-br from-gray-900/50 to-gray-800/50"><div class="container mx-auto px-4 py-12"><div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8"><div class="col-span-1 md:col-span-2"><div class="flex items-center gap-3 mb-4"><div class="relative w-32 h-8"><img src="'+PE+'" alt="Logo HatCast" class="w-full h-full opacity-80"></div></div><p class="text-gray-400 text-sm leading-relaxed max-w-md"> L&#39;appli pour sélectionner vos joueurs d&#39;impro simplement, équitablement et sans prise de tête. </p></div><div><h4 class="text-white font-semibold mb-4 text-sm uppercase tracking-wider">Contact</h4><div class="space-y-2"><a href="mailto:contact@hatcast.app" class="block text-gray-400 hover:text-blue-300 transition-colors text-sm"> 📧 contact@hatcast.app </a><p class="text-gray-500 text-xs">Retours et suggestions bienvenus</p></div></div><div><h4 class="text-white font-semibold mb-4 text-sm uppercase tracking-wider">Ressources</h4><div class="space-y-2"><a href="#" class="block text-gray-400 hover:text-blue-300 transition-colors text-sm"> 📚 Guide utilisateur </a><a href="https://github.com/plamarque/hatcast" target="_blank" rel="noopener noreferrer" class="block text-gray-400 hover:text-blue-300 transition-colors text-sm"> 🔗 Code source </a><p class="text-gray-500 text-xs">Documentation en cours</p></div></div></div><div class="border-t border-white/10 mb-6"></div><div class="flex flex-col sm:flex-row items-center justify-between text-xs text-gray-500"><div class="flex items-center gap-4 mb-4 sm:mb-0"><span>© Patrice Lamarque 2025</span><span class="hidden sm:inline">•</span><span>Licence MIT</span></div><div class="flex items-center gap-4"><span class="text-gray-600">En cours de développement</span><a href="https://github.com/plamarque/hatcast" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-blue-300 transition-colors underline decoration-gray-600 hover:decoration-blue-300"> GitHub </a></div></div></div></footer>',2)),Qe(kE,{show:I.value,onClose:k,onSuccess:G},null,8,["show"]),Qe(WE,{show:A.value,onClose:ne,onLogoutDevice:$e},null,8,["show"]),Qe(wT,{show:S.value,onClose:be},null,8,["show"]),Qe(xT,{show:$.value,onClose:Ie,onManagePlayer:ye},null,8,["show"])])}}};function w$({reason:n,recipientName:e,eventTitle:t,eventDate:r,urls:s={},prefs:i={},extra:o={}}){const a={email:null,push:null};if(n==="availability_request"||n==="availability_reminder"){const l=(i==null?void 0:i.notifyAvailability)!==!1,c=(i==null?void 0:i.notifyAvailabilityPush)!==!1;a.email={enabled:l,subject:n==="availability_reminder"?`Rappel disponibilité · ${t} (${r})`:`Disponibilité demandée · ${t} (${r})`},a.push={enabled:c,title:n==="availability_reminder"?"⏰ Rappel disponibilité":"🗓️ Disponibilité demandée",body:`${e}, ${t} (${r})`,data:{url:s.eventUrl,yesUrl:s.yesUrl,noUrl:s.noUrl,reason:n}}}if(n==="selection"){const l=(i==null?void 0:i.notifySelection)!==!1,c=(i==null?void 0:i.notifySelectionPush)!==!1;a.email={enabled:l,subject:`🎭 Sélection confirmée · ${t}`},a.push={enabled:c,title:"🎭 Sélection confirmée",body:`${e}, tu as été sélectionné(e) pour ${t} (${r}) 🎉`,data:{url:s.eventUrl}}}return a}async function x$({reason:n,recipientEmail:e,recipientName:t,eventTitle:r,eventDate:s,urls:i={},extra:o={}}){if(!e)return{success:!1,skipped:!0,reason:"missing_email"};const a=await jt(Pe(le,"userPreferences",e)).catch(()=>null),l=a!=null&&a.exists()?a.data():{},c=w$({reason:n,recipientName:t,eventTitle:r,eventDate:s,urls:i,prefs:l,extra:o}),h=[];return c.email&&c.email.enabled&&(n==="availability_request"||n==="availability_reminder"?await AM({toEmail:e,playerName:t,eventTitle:r,eventDate:s,yesUrl:i.yesUrl,noUrl:i.noUrl,eventUrl:i.eventUrl,reason:n==="availability_reminder"?"reminder":"new_event"}).then(()=>h.push({channel:"email",success:!0})).catch(g=>{K.error("notifyRecipientAcrossChannels email error",g),h.push({channel:"email",success:!1})}):n==="selection"&&h.push({channel:"email",success:!0,skipped:!0,note:"batch_handled_elsewhere"})),c.push&&c.push.enabled&&await Dc({toEmail:e,title:c.push.title,body:c.push.body,data:c.push.data||{},reason:n}).then(()=>h.push({channel:"push",success:!0})).catch(g=>{K.error("notifyRecipientAcrossChannels push error",g),h.push({channel:"push",success:!1})}),{success:h.some(g=>g.success),results:h}}async function S_({eventId:n,eventData:e,players:t,seasonId:r,seasonSlug:s,createMagicLink:i,reminder:o=!1,getAvailabilityForEvent:a=null}){const l=[],c=`${window.location.origin}/season/${s}/event/${n}`;for(const h of t)try{if(o&&typeof a=="function"){const y=await Promise.resolve(a(h.name,n));if(y===!0||y===!1)continue}const f={};if(typeof i=="function"){const y=await i({seasonId:r,playerId:h.id,eventId:n,action:"yes"}),I=await i({seasonId:r,playerId:h.id,eventId:n,action:"no"});f.yesUrl=`${y.url}&slug=${encodeURIComponent(s)}`,f.noUrl=`${I.url}&slug=${encodeURIComponent(s)}`}f.eventUrl=c,(await x$({reason:o?"availability_reminder":"availability_request",recipientEmail:h.email,recipientName:h.name,eventTitle:e.title,eventDate:I$(e.date),urls:f})).success||l.push(h.id)}catch{l.push(h.id)}return{success:!0,failures:l}}async function P_(n){return CM(n)}function I$(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function E$(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Impro Selector//Calendar Event//FR","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${n.id}@hatcast.app`,`DTSTAMP:${new Date().toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTSTART:${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTEND:${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`SUMMARY:${n.title}`,`DESCRIPTION:${n.description||""}${e?`\\n\\nSaison : ${e}`:""}`,"STATUS:CONFIRMED","SEQUENCE:0","BEGIN:VALARM","TRIGGER:-PT1H","ACTION:DISPLAY",`DESCRIPTION:Rappel : ${n.title}`,"END:VALARM","END:VEVENT","END:VCALENDAR"].join(`\r
`)}function T$(n,e=""){const t=E$(n,e),r=new Blob([t],{type:"text/calendar;charset=utf-8"}),s=URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=`${n.title.replace(/[^a-z0-9]/gi,"_")}_${n.date}.ics`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)}function A$(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://calendar.google.com/calendar/render?${new URLSearchParams({action:"TEMPLATE",text:n.title,dates:`${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z/${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,details:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"Impro Selector",sf:"true",output:"xml"}).toString()}`}function S$(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://outlook.live.com/calendar/0/deeplink/compose?${new URLSearchParams({subject:n.title,startdt:r.toISOString(),enddt:s.toISOString(),body:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"Impro Selector",allday:"false"}).toString()}`}function P$(n,e=""){const t=A$(n,e);window.open(t,"_blank")}function R$(n,e=""){const t=S$(n,e);window.open(t,"_blank")}function C$(n,e,t=""){switch(n){case"ics":T$(e,t);break;case"google":P$(e,t);break;case"outlook":R$(e,t);break;default:console.warn("Type de calendrier non supporté:",n)}}const k$="/icons/manifest-icon-192.maskable.png",D$={class:"relative p-5 pb-4 border-b border-white/10"},N$={class:"text-xl md:text-2xl font-bold text-white pr-10 flex items-center gap-2"},V$={key:0,class:"text-sm text-purple-300 mt-1"},O$={class:"px-4 md:px-6 py-4 md:py-6 space-y-6 overflow-y-auto"},M$={class:"space-y-4"},L$={class:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2"},$$={key:0,class:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-3"},F$={class:"bg-gray-800 border border-gray-600 rounded-lg p-3"},U$={key:0,class:"space-y-2"},j$={class:"flex flex-wrap gap-2"},q$=["onClick","title"],B$={key:1,class:"text-amber-400 text-sm"},z$={class:"inline-flex bg-gray-800 rounded-lg overflow-hidden border border-gray-700 mb-3"},K$={class:"text-sm text-gray-300"},G$={class:"text-sm text-gray-300"},H$={class:"text-sm text-gray-300"},W$=["innerHTML"],Q$=["value"],J$={class:"mt-3"},Y$={class:"text-lg font-semibold leading-snug"},X$={class:"mt-2 text-base whitespace-pre-line text-white/90"},Z$={class:"mt-4 flex items-center gap-4 text-base"},eF={key:1,class:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-gray-100 text-gray-900 border border-white/20"},tF={class:"bg-yellow-500/10 border border-yellow-500/30 text-yellow-200 rounded-md p-3 text-sm mb-2"},nF=["value"],rF={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},sF={class:"flex items-center gap-2 w-full"},iF=["disabled"],oF={key:0},aF={class:"hidden sm:inline"},lF={key:1,class:"inline-flex items-center gap-2"},uF=["title"],cF={key:0},dF={key:1},TT={__name:"EventAnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},mode:{type:String,default:"event",validator:n=>["event","selection"].includes(n)},selectedPlayers:{type:Array,default:()=>[]},sending:{type:Boolean,default:!1},availabilityByPlayer:{type:Object,default:()=>({})}},emits:["close","notifications-sent","send-notifications"],setup(n,{emit:e}){const t=n,r=e;P("notify");const s=P(!1),i=P("Copier le message"),o=P(!1),a=Fe(()=>t.sending||o.value),l=P(!1),c=P("email"),h=Fe(()=>!t.event||!t.seasonSlug?"":`${window.location.origin}/season/${t.seasonSlug}/event/${t.event.id}`),f=Fe(()=>{if(!t.event)return"";if(c.value==="push"){const re=S.value,ue=$.value;if(t.mode==="event"){const oe=`

Lien direct: ${h.value}`;return`${re}
${ue}
✅ Dispo
❌ Pas dispo${oe}`}return`${re}
${ue}
Ouvrir`}const we=`

Lien direct: ${h.value}`;return`Objet: ${g.value}

${A.value}${we}`}),g=Fe(()=>{var re,ue,oe;const we=F((re=t.event)==null?void 0:re.date);return t.mode==="event"?`${(ue=t.event)==null?void 0:ue.title} (${we})`:`🎭 Sélectionné pour ${(oe=t.event)==null?void 0:oe.title}`}),y=Fe(()=>"contact@hatcast.app"),I=Fe(()=>{var ue,oe,Ne,te,Y,Te,We;const we=((ue=L.value)==null?void 0:ue.id)==="ALL"?"<joueur>":((oe=L.value)==null?void 0:oe.name)||"[Nom du joueur]",re=F((Ne=t.event)==null?void 0:Ne.date);return L.value&&L.value.id&&L.value.id!=="ALL"&&!((te=Q.value.find(at=>at.id===L.value.id))!=null&&te.hasContact)?`
      <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
        <p><strong>${we}</strong> n'a pas configuré d'email. Utilise la fonction « Copier le message » et envoie-lui ces informations par un autre canal.</p>
        <p style="margin-top: 8px; font-weight: 600;">${(Y=t.event)==null?void 0:Y.title}</p>
        <p style="color:#374151;">${re}</p>
        <p style="margin-top: 8px;">Lien direct : ${h.value}</p>
      </div>
    `:t.mode==="event"?`
      <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
        <p><strong>${we}</strong>, un nouvel événement est prévu.</p>
        <p style="margin: 12px 0 2px 0; font-weight: 600;">${(Te=t.event)==null?void 0:Te.title}</p>
        <p style="margin: 0 0 16px 0; color:#374151;">${re}</p>
        <p>Nous avons besoin de savoir si tu es disponible.</p>
        <p style="margin-top: 12px;">
          <a href="#yes" style="display:inline-block;padding:10px 12px;margin-right:8px;border:2px solid #16a34a;color:#16a34a;border-radius:8px;text-decoration:none;">✅ Dispo</a>
          <a href="#no" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Pas dispo</a>
        </p>
        <p style="margin-top: 16px;">Merci!!</p>
      </div>
    `:`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p><strong>${we}</strong>, tu as été sélectionné pour <strong>${(We=t.event)==null?void 0:We.title}</strong> le <strong>${re}</strong>!</p>
      <p style="margin-top: 16px; font-weight: 600;">Actions rapides :</p>
      <p style="margin-top: 8px;">
        <a href="#no" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Pas dispo</a>
      </p>
    </div>
  `}),A=Fe(()=>I.value.replace(/<\/?div[^>]*>/g,`
`).replace(/<\/?p[^>]*>/g,`
`).replace(/<br\s*\/?>(\n)?/g,`
`).replace(/<[^>]+>/g,"").replace(/\n{3,}/g,`

`).trim()),S=Fe(()=>{var we,re;return t.mode==="event"?`${(we=t.event)==null?void 0:we.title} (${F((re=t.event)==null?void 0:re.date)})`:"🎭 Sélectionné pour"}),$=Fe(()=>{var Ne,te,Y,Te,We,at;const we=F((Ne=t.event)==null?void 0:Ne.date),re=((te=L.value)==null?void 0:te.id)==="ALL"?"<joueur>":((Y=L.value)==null?void 0:Y.name)||"[Nom du joueur]",ue=L.value&&L.value.id&&L.value.id!=="ALL",oe=ue?!!((Te=Q.value.find(Vt=>Vt.id===L.value.id))!=null&&Te.hasContact):!0;return ue&&!oe?`${re} n'a pas installé l'appli. Envoie-lui ce message manuellement.
${(We=t.event)==null?void 0:We.title} (${we})
Lien: ${h.value}`:t.mode==="event"?`${re}, t'es dispo ?`:`${re}, tu as été sélectionné pour ${(at=t.event)==null?void 0:at.title} le ${we}!

[ Afficher les Détails]

Un imprévu ?
❌ Pas dispo`}),U=P([]),M=P([]),L=P(null),se=P([]),Q=Fe(()=>{const we=M.value.map(ue=>({...ue,hasContact:ue.id!=="ALL",missingReason:""})),re=se.value.map(ue=>({...ue,hasContact:!1,missingReason:"Aucun canal actif"}));return[{id:"ALL",name:"Tous",hasContact:!0},...we.filter(ue=>ue.id!=="ALL"),...re]}),x=Fe(()=>{if(!L.value||L.value.id==="ALL")return!0;const we=Q.value.find(re=>(re.id||re.name)===(L.value.id||L.value.name));return!!(we!=null&&we.hasContact)}),b=Fe(()=>{var ue,oe,Ne,te,Y;const we=((ue=L.value)==null?void 0:ue.id)==="ALL"?"<joueur>":((oe=L.value)==null?void 0:oe.name)||"[Nom du joueur]",re=F((Ne=t.event)==null?void 0:Ne.date);return t.mode==="selection"?`Bonjour ${we},
Tu as été sélectionné(e) pour ${(te=t.event)==null?void 0:te.title} (${re})
Un imprévu ? ${E.value}
Détails : ${h.value}`:`Bonjour ${we},
${(Y=t.event)==null?void 0:Y.title} (${re})
Peux-tu indiquer ta disponibilité ?
Lien : ${h.value}`}),E=Fe(()=>{var we,re;try{const ue=(we=L.value)!=null&&we.id&&L.value.id!=="ALL"?t.players.find(oe=>oe.id===L.value.id):null;return!ue||!((re=t.event)!=null&&re.id)||!t.seasonId?"[lien désistement]":`${window.location.origin}/magic?auto=no&season=${encodeURIComponent(t.seasonId)}&player=${encodeURIComponent(ue.id)}&event=${encodeURIComponent(t.event.id)}&slug=${encodeURIComponent(t.seasonSlug||"")}`}catch{return"[lien désistement]"}});async function C(){if(!t.seasonId)return;let we=[];t.mode==="selection"?we=t.players.filter(Ne=>t.selectedPlayers.includes(Ne.name)):we=t.players.filter(Ne=>{var Y;return typeof((Y=t.availabilityByPlayer)==null?void 0:Y[Ne.name])>"u"});const re=[];for(const Ne of we)try{const{getPlayerEmail:te}=await en(()=>Promise.resolve().then(()=>Nc),void 0),Y=await te(Ne.id,t.seasonId);Y&&re.push({...Ne,email:Y})}catch(te){console.warn(`Impossible de charger l'email pour ${Ne.name}:`,te)}U.value=re;const ue={id:"ALL",name:"Tous"};M.value=[ue,...re];const oe=we.filter(Ne=>!re.find(te=>te.id===Ne.id)).map(Ne=>({id:Ne.id,name:Ne.name}));se.value=oe,L.value||(L.value=ue)}function O(){r("close")}function F(we){var ue;return we?(typeof we=="string"?new Date(we):((ue=we.toDate)==null?void 0:ue.call(we))||we).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function R(){const we=f.value;navigator.clipboard.writeText(we).then(()=>{s.value=!0,i.value="Copié !",setTimeout(()=>{s.value=!1,i.value="Copier le message"},2e3)}).catch(re=>{console.warn("Erreur lors de la copie du texte"),alert("Impossible de copier le message.")})}function pt(we){L.value=we}async function mt(){if(!(!t.event||M.value.length===0)){o.value=!0;try{const we=L.value&&L.value.id!=="ALL"?"single":"all",re=we==="single"?{id:L.value.id,name:L.value.name,email:L.value.email}:null;t.mode==="selection"?r("send-notifications",{eventId:t.event.id,eventData:t.event,reason:"selection",selectedPlayers:t.selectedPlayers,scope:we,recipient:re}):r("send-notifications",{eventId:t.event.id,eventData:t.event,reason:"manual",scope:we,recipient:re})}catch{console.error("Erreur lors de l'envoi des notifications"),alert("Erreur lors de l'envoi des notifications. Veuillez réessayer.")}}}return yn(()=>{t.show&&C()}),bt(()=>t.show,we=>{we&&C()}),bt(()=>t.selectedPlayers,()=>{t.show&&t.mode==="selection"&&C()}),bt(()=>t.availabilityByPlayer,()=>{t.show&&t.mode==="event"&&C()},{deep:!0}),bt(()=>t.sending,we=>{we||(o.value=!1)}),(we,re)=>{var ue,oe,Ne,te,Y;return n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:O},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] flex flex-col",onClick:re[3]||(re[3]=ct(()=>{},["stop"]))},[d("div",D$,[d("button",{onClick:O,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("h2",N$,[d("span",null,ie(n.mode==="selection"?"📣":"📢"),1),d("span",null,ie(n.mode==="selection"?"Annoncer la sélection":"Annoncer l'événement"),1)]),n.event?(D(),V("p",V$,ie(n.event.title)+" — "+ie(F(n.event.date)),1)):ce("",!0)]),d("div",O$,[d("div",M$,[d("div",null,[d("label",L$,[re[4]||(re[4]=St(" Personnes à Prévenir ")),d("button",{onClick:re[0]||(re[0]=Te=>l.value=!l.value),class:"text-blue-400 hover:text-blue-300 text-lg cursor-help",title:"Cliquer pour plus d'information"}," ? ")]),l.value?(D(),V("div",$$,re[5]||(re[5]=[d("p",{class:"text-blue-200 text-sm"},[St(" Cette liste montre tous les joueurs ciblés: "),d("span",{class:"text-purple-300"},"« Tous »"),St(", "),d("span",{class:"text-gray-200"},"ceux notifiables (email/push actifs)"),St(" et "),d("span",{class:"text-yellow-300"},"ceux en jaune sans canal actif"),St(". Les joueurs en jaune ne peuvent pas être notifiés automatiquement. Utilise « Copier le message » pour leur écrire via un autre moyen (l'URL de l'événement est incluse). ")],-1)]))):ce("",!0),d("div",F$,[Q.value.length>0?(D(),V("div",U$,[d("div",j$,[(D(!0),V(it,null,br(Q.value,Te=>(D(),V("button",{key:Te.id||Te.name,type:"button",onClick:We=>pt(Te),class:Zt(["px-3 py-1 rounded text-sm border transition-colors",L.value&&L.value.id===Te.id?"bg-purple-600 border-purple-500 text-white":Te.hasContact?"bg-gray-700 border-gray-600 text-white hover:bg-gray-600":"bg-yellow-900/20 border-yellow-600/40 text-yellow-200 hover:bg-yellow-900/30 opacity-75 cursor-not-allowed"]),title:Te.hasContact?"Prévisualiser pour "+Te.name:Te.missingReason||"Aucun canal actif"},ie(Te.name),11,q$))),128))])])):(D(),V("div",B$," ⚠️ Aucun destinataire disponible. "))])]),d("div",null,[re[13]||(re[13]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Aperçu du message :",-1)),d("div",z$,[d("button",{class:Zt(["px-3 py-1.5 text-sm transition-colors",c.value==="email"?"bg-purple-600 text-white":"text-gray-300 hover:bg-gray-700"]),onClick:re[1]||(re[1]=Te=>c.value="email"),title:"Prévisualiser l'email"},"📧",2),d("button",{class:Zt(["px-3 py-1.5 text-sm transition-colors",c.value==="push"?"bg-purple-600 text-white":"text-gray-300 hover:bg-gray-700"]),onClick:re[2]||(re[2]=Te=>c.value="push"),title:"Prévisualiser la notification push"},"🔔",2)]),c.value==="email"?(D(),V("div",{key:0,class:Zt(x.value||((ue=L.value)==null?void 0:ue.id)==="ALL"?"bg-gray-800 border border-gray-600 rounded-lg p-4 text-white space-y-3":"space-y-3")},[x.value||((oe=L.value)==null?void 0:oe.id)==="ALL"?(D(),V(it,{key:0},[d("div",K$,[re[6]||(re[6]=d("span",{class:"font-semibold"},"De:",-1)),St(" "+ie(y.value),1)]),d("div",G$,[re[7]||(re[7]=d("span",{class:"font-semibold"},"À:",-1)),St(" "+ie(((Ne=L.value)==null?void 0:Ne.id)==="ALL"?"<joueur>":((te=L.value)==null?void 0:te.name)||"[Nom du joueur]"),1)]),d("div",H$,[re[8]||(re[8]=d("span",{class:"font-semibold"},"Objet:",-1)),St(" "+ie(g.value),1)]),d("div",{class:"bg-white text-black rounded-md p-4",innerHTML:I.value},null,8,W$)],64)):(D(),V(it,{key:1},[re[9]||(re[9]=d("div",{class:"bg-yellow-500/10 border border-yellow-500/30 text-yellow-200 rounded-md p-3 text-sm"}," Ce joueur n'a pas configuré d'email. Utilise la fonction « Copier le message » et envoie-lui ces informations par un autre canal. ",-1)),d("textarea",{class:"w-full mt-2 p-3 bg-gray-900 border border-gray-700 rounded-md text-white text-sm",value:b.value,rows:"5",readonly:""},null,8,Q$)],64))],2)):(D(),V("div",{key:1,class:Zt(L.value&&L.value.id!=="ALL"&&!x.value?"text-white":"bg-gray-900 border border-gray-700 rounded-xl p-4 text-white")},[L.value&&L.value.id!=="ALL"&&!x.value?(D(),V(it,{key:1},[d("div",tF,ie((Y=L.value)==null?void 0:Y.name)+" n'a pas installé l'appli. Envoie-lui ce message manuellement. ",1),d("textarea",{class:"w-full p-3 bg-gray-800 border border-gray-700 rounded-md text-white text-sm",value:b.value,rows:"5",readonly:""},null,8,nF)],64)):(D(),V(it,{key:0},[re[12]||(re[12]=Pn('<div class="flex items-center justify-between text-xs text-white/70"><div class="flex items-center gap-2 min-w-0"><div class="w-6 h-6 rounded-full bg-white/10 flex items-center justify-center">🔔</div><div class="truncate">Impropick</div><span class="opacity-60">•</span><span>il y a 1 min</span></div><img src="'+k$+'" alt="App icon" class="w-10 h-10 rounded-full shadow"></div>',1)),d("div",J$,[d("div",Y$,ie(S.value),1),d("div",X$,ie($.value),1)]),d("div",Z$,[t.mode==="event"?(D(),V(it,{key:0},[re[10]||(re[10]=d("span",{class:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-green-600/20 text-green-300 border border-green-600/40"},"✅ Dispo",-1)),re[11]||(re[11]=d("span",{class:"text-red-600/20 text-red-300 border border-red-600/40"},"❌ Pas dispo",-1))],64)):(D(),V("span",eF,"Ouvrir"))])],64))],2))])])]),d("div",rF,[d("div",sF,[d("button",{onClick:mt,disabled:M.value.length===0||a.value||L.value&&L.value.id!=="ALL"&&!x.value,class:"h-12 px-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600 flex-1"},[a.value?(D(),V("span",lF,re[17]||(re[17]=[d("svg",{class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[d("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),d("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),St(" Envoi en cours... ")]))):(D(),V("span",oF,[L.value&&L.value.id!=="ALL"?(D(),V("span",{key:0,class:Zt(x.value?"":"opacity-60")},[d("span",aF,"🔔 Notifier "+ie(L.value.name),1),re[14]||(re[14]=d("span",{class:"sm:hidden"},"🔔 Notifier",-1))],2)):(D(),V(it,{key:1},[re[15]||(re[15]=d("span",{class:"hidden sm:inline"},"🔔 Envoyer les notifications",-1)),re[16]||(re[16]=d("span",{class:"sm:hidden"},"🔔 Envoyer",-1))],64))]))],8,iF),d("button",{onClick:R,class:"h-12 px-6 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300",title:i.value},[s.value?(D(),V("span",dF,"✅ Copié")):(D(),V("span",cF,re[18]||(re[18]=[d("span",{class:"hidden sm:inline"},"📋 Copier le message",-1),d("span",{class:"sm:hidden"},"📋 Copier",-1)])))],8,uF)]),d("button",{onClick:O,class:"h-12 px-4 bg-gray-700 text-white rounded-lg"}," Fermer ")])])])):ce("",!0)}}},hF={class:"relative p-6 pb-4 border-b border-white/10"},fF={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},pF={__name:"AppHelpModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[95] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=ct(()=>{},["stop"]))},[d("div",hF,[d("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=d("div",{class:"flex items-center gap-3"},[d("div",{class:"w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-2xl"},"❓"),d("div",null,[d("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Kezako ?"),d("p",{class:"text-sm text-purple-300"},"L'appli pour sélectionner les joueurs d'impro de manière simple et apaisée")])],-1))]),s[5]||(s[5]=Pn('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">C&#39;est quoi ?</h3><p> Tu joues quand ? est une appli conçue pour faciliter <span class="text-white">la sélection des joueurs d&#39;impro</span> pour les spectacles. L&#39;idée est née au sein de <span class="text-purple-300">La Malice</span> pour <span class="text-white">dépersonnaliser une tâche délicate</span> qui créait des tensions depuis des années. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">Comment ça marche</h3><p> L&#39;asso déclare ses dates et le nombre de personnes nécessaires. Les joueurs indiquent leurs disponibilités. L&#39;appli propose des sélections. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Sélection auto ou manuelle</h3><p> Le <span class="text-white">mode sélection auto</span> s&#39;appuie sur le hasard (pondéré) pour simplifier la vie. Vous pouvez aussi repasser en mode <span class="text-white">manuel</span> si besoin. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Pensée mobile • Libre d&#39;utilisation</h3><p> L&#39;appli est <span class="text-white">pensée pour le mobile</span> et peut être utilisée librement par La Malice ou <span class="text-white">toute autre troupe</span>. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Comptes (facultatif)</h3><p> Les joueurs qui le souhaitent peuvent créer un compte via leur email pour <span class="text-white">recevoir des notifications</span>, <span class="text-white">protéger leurs saisies</span> et bénéficier d&#39;un meilleur confort d&#39;utilisation. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2 text-sm"><h3 class="text-white font-semibold">Statut &amp; licence</h3><p> Application <span class="text-white">en cours de développement</span>, <span class="text-white">sans garanties</span> à ce stade. Licence libre <span class="text-white">MIT</span>. </p><p>Contact &amp; retours : <a href="mailto:contact@hatcast.app" class="text-blue-300 underline">contact@hatcast.app</a></p></div></div>',1)),d("div",fF,[d("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ce("",!0)}},mF={class:"text-center mb-6"},gF={class:"text-lg text-gray-300"},vF={class:"mb-6"},yF={class:"space-y-4"},_F={class:"flex items-center gap-2 text-gray-300 text-sm"},bF=["disabled"],wF={key:0,class:"animate-spin"},xF={key:1},IF={class:"mb-6 text-center"},EF={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},TF={class:"text-red-300 text-sm"},AF={class:"text-center mb-6"},SF={class:"text-lg text-gray-300"},PF={class:"mb-6"},RF=["disabled"],CF={key:0,class:"animate-spin"},kF={key:1},DF={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},NF={class:"text-red-300 text-sm"},VF={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},OF={class:"text-green-300 text-sm"},MF={class:"flex justify-center"},av={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=P(""),i=P(!1),o=P(""),a=P(!1),l=P(""),c=P(""),h=P(null),f=P(!0);async function g(){if(s.value){i.value=!0,o.value="";try{const A=await Wp(t.seasonId);if(s.value===A){if(f.value)try{Wi.saveSession(t.player.id)}catch{}r("verified",{type:"season_pin"}),I();return}if(await KE(t.player.id,s.value,t.seasonId)){if(f.value)try{Wi.saveSession(t.player.id)}catch{}r("verified",{type:"player_password"}),I()}else o.value="Mot de passe incorrect. Veuillez réessayer."}catch(A){K.error("Erreur lors de la vérification",A),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function y(){i.value=!0,l.value="",c.value="";try{const A=await HE(t.player.id,t.seasonId);c.value=A.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(A){K.error("Erreur lors de l'envoi de l'email",A),l.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function I(){r("close"),s.value="",o.value="",a.value=!1,l.value="",c.value=""}return bt(()=>t.show,A=>{A&&Ht(()=>{h.value&&h.value.focus()})}),(A,S)=>{var $,U;return D(),V(it,null,[n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:I},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:S[3]||(S[3]=ct(()=>{},["stop"]))},[d("div",mF,[S[7]||(S[7]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔐")],-1)),S[8]||(S[8]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Vérification requise",-1)),d("p",gF,ie(($=n.player)==null?void 0:$.name),1),S[9]||(S[9]=d("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protégé par mot de passe",-1))]),d("div",vF,[d("div",yF,[d("div",null,[S[10]||(S[10]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),ot(d("input",{"onUpdate:modelValue":S[0]||(S[0]=M=>s.value=M),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:Bn(g,["enter"]),ref_key:"passwordInput",ref:h},null,544),[[$t,s.value]])]),d("div",_F,[ot(d("input",{id:"staySignedIn",type:"checkbox","onUpdate:modelValue":S[1]||(S[1]=M=>f.value=M),class:"w-4 h-4"},null,512),[[Ci,f.value]]),S[11]||(S[11]=d("label",{for:"staySignedIn"},"Rester connecté sur cet appareil",-1))])]),d("button",{onClick:g,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(D(),V("span",wF,"⏳")):(D(),V("span",xF,"🔓")),d("span",null,ie(i.value?"Vérification...":"Vérifier"),1)],8,bF)]),d("div",IF,[d("button",{onClick:S[2]||(S[2]=M=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(D(),V("div",EF,[d("div",TF,ie(o.value),1)])):ce("",!0),d("div",{class:"flex justify-center"},[d("button",{onClick:I,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ce("",!0),a.value?(D(),V("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:S[6]||(S[6]=M=>a.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:S[5]||(S[5]=ct(()=>{},["stop"]))},[d("div",AF,[S[12]||(S[12]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"📧")],-1)),S[13]||(S[13]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oublié",-1)),d("p",SF,ie((U=n.player)==null?void 0:U.name),1)]),d("div",PF,[S[14]||(S[14]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),d("button",{onClick:y,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(D(),V("span",CF,"⏳")):(D(),V("span",kF,"📧")),d("span",null,ie(i.value?"Envoi...":"Envoyer l'email"),1)],8,RF)]),l.value?(D(),V("div",DF,[d("div",NF,ie(l.value),1)])):ce("",!0),c.value?(D(),V("div",VF,[d("div",OF,ie(c.value),1)])):ce("",!0),d("div",MF,[d("button",{onClick:S[4]||(S[4]=M=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0)],64)}}},LF={class:"text-center mb-6"},$F={class:"text-sm text-gray-300"},FF={key:0,class:"space-y-4"},UF={key:0,class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},jF={key:1,class:"space-y-4"},qF=["disabled"],BF={key:0,class:"animate-spin"},zF={key:1},KF={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},GF={class:"mt-6 flex justify-center gap-3"},HF=["disabled"],WF={key:0,class:"animate-spin"},QF={key:1},AT={__name:"AccountClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=e,s=P(1),i=P(""),o=P(""),a=P(""),l=P(!1),c=P(""),h=P(!1),f=Xo(),g=Fe(()=>i.value&&i.value.includes("@")),y=Fe(()=>o.value&&a.value&&o.value===a.value&&o.value.length>=6);async function I(){var U,M,L;if(!(!g.value||!((U=t.player)!=null&&U.id))){l.value=!0,c.value="";try{const se=await UE({playerId:t.player.id,email:i.value.trim(),seasonId:t.seasonId}),Q=(M=f.params)==null?void 0:M.slug,x=`${se.url}${Q?`&slug=${encodeURIComponent(Q)}`:""}&player=${encodeURIComponent(t.player.id)}&open=protection`;await SM({toEmail:i.value,playerName:((L=t.player)==null?void 0:L.name)||"joueur",verifyUrl:x}),h.value=!0}catch{c.value="Impossible d'envoyer l'email de vérification"}finally{l.value=!1}}}async function A(){try{await qE({playerId:t.player.id,seasonId:t.seasonId})}catch{}s.value=1,h.value=!1,i.value="",o.value="",a.value=""}async function S(){var U;try{const M=await Vl((U=t.player)==null?void 0:U.id,t.seasonId);M!=null&&M.email&&(M!=null&&M.emailVerifiedAt)?s.value=2:s.value=1}catch{s.value=1}}yn(()=>{S()}),bt(()=>t.show,U=>{U&&S()});async function $(){if(y.value){l.value=!0,c.value="";try{await FE(t.player.id,i.value.trim(),o.value,t.seasonId),r("success")}catch(U){c.value=(U==null?void 0:U.message)||"Erreur lors de l'association"}finally{l.value=!1}}}return(U,M)=>{var L;return n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:M[6]||(M[6]=se=>U.$emit("close"))},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:M[5]||(M[5]=ct(()=>{},["stop"]))},[d("button",{onClick:M[0]||(M[0]=se=>U.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),d("div",LF,[M[7]||(M[7]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"👤")],-1)),M[8]||(M[8]=d("h2",{class:"text-2xl font-bold text-white mb-1"},"Associer un compte",-1)),d("p",$F,"Pour sécuriser les saisies de "+ie((L=n.player)==null?void 0:L.name),1),Qe(CE)]),s.value===1?(D(),V("div",FF,[d("div",null,[M[9]||(M[9]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),ot(d("input",{"onUpdate:modelValue":M[1]||(M[1]=se=>i.value=se),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[$t,i.value]])]),h.value?(D(),V("div",UF,[M[10]||(M[10]=d("span",null,"✅",-1)),d("span",null,"Un email a été envoyé à "+ie(i.value)+". Cliquez sur le lien contenu dans l'email pour continuer.",1)])):ce("",!0)])):s.value===2?(D(),V("div",jF,[d("div",{class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},[M[11]||(M[11]=d("span",null,"✅",-1)),M[12]||(M[12]=d("span",null,"Adresse email vérifiée",-1)),d("button",{type:"button",onClick:A,title:"Changer d'adresse email",class:"ml-auto px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-colors"},"✏️")]),d("div",null,[M[13]||(M[13]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),ot(d("input",{"onUpdate:modelValue":M[2]||(M[2]=se=>o.value=se),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé (min. 6 caractères)"},null,512),[[$t,o.value]])]),d("div",null,[M[14]||(M[14]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),ot(d("input",{"onUpdate:modelValue":M[3]||(M[3]=se=>a.value=se),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[$t,a.value]])]),d("button",{onClick:$,disabled:!y.value||l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(D(),V("span",BF,"⏳")):(D(),V("span",zF,"🔒")),d("span",null,ie(l.value?"Association...":"Associer ce joueur"),1)],8,qF)])):ce("",!0),c.value?(D(),V("div",KF,ie(c.value),1)):ce("",!0),d("div",GF,[s.value===1?(D(),V("button",{key:0,onClick:I,disabled:!g.value||l.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(D(),V("span",WF,"⏳")):(D(),V("span",QF,"✉️")),d("span",null,ie(l.value?"Envoi...":"Envoyer le lien de vérification"),1)],8,HF)):ce("",!0),d("button",{onClick:M[4]||(M[4]=se=>U.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])):ce("",!0)}}},JF={class:"text-center mb-6"},YF={class:"text-2xl font-bold text-white mb-2"},XF={class:"text-lg text-gray-300"},ZF={class:"mb-6"},e6={class:"flex items-center space-x-3"},t6={class:"text-2xl"},n6={class:"font-semibold text-white"},r6={class:"text-sm text-gray-300"},s6={key:0,class:"mb-6"},i6={key:1,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},o6={class:"text-red-300 text-sm"},a6={key:2,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},l6={class:"text-green-300 text-sm"},u6={class:"flex justify-center gap-3"},c6=["disabled"],d6={__name:"PlayerClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null},onboarding:{type:Boolean,default:!1}},emits:["close","update","onboarding-finished"],setup(n,{emit:e}){const t=n,r=e,s=P(!1),i=P(!1),o=P(!1),a=P(""),l=P(""),c=P(!1);Xo();const h=P(!1);Fe(()=>!1),Fe(()=>!1);function f(){l.value="Compte créé et joueur associé !",s.value=!0,c.value=!1,r("update")}async function g(){var $;if(($=t.player)!=null&&$.id){s.value=await Li(t.player.id,t.seasonId);try{const{isPlayerPasswordCached:U}=await en(()=>Promise.resolve().then(()=>Nc),void 0);i.value=U(t.player.id)}catch{i.value=!1}}}function y(){var $;a.value="";try{if(($=t.player)!=null&&$.id&&Fo(t.player.id)){I();return}}catch{}h.value=!0}async function I(){o.value=!0,a.value="",l.value="";try{const $=await BE(t.player.id,t.seasonId);l.value="Joueur déverrouillé!",s.value=!1,$.email&&(email.value=$.email),r("update")}catch($){logger.error("Erreur lors de la désactivation de la protection",$),a.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{o.value=!1}}function A(){h.value=!1,I()}function S(){r("close")}return bt(()=>t.player,()=>{t.show&&t.player&&g()},{immediate:!0}),bt(()=>t.show,$=>{$&&t.player&&(a.value="",l.value="",h.value=!1,g(),t.onboarding&&Ht(()=>{}))}),($,U)=>{var M;return D(),V(it,null,[n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:S},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:U[1]||(U[1]=ct(()=>{},["stop"]))},[d("button",{onClick:S,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),d("div",JF,[U[4]||(U[4]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔒")],-1)),d("h2",YF,ie(s.value?"Déverrouiller ce joueur":"Verrouiller ce joueur"),1),d("p",XF,ie((M=n.player)==null?void 0:M.name),1)]),d("div",ZF,[d("div",{class:Zt(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[d("div",e6,[d("span",t6,ie(s.value?"🔒":"🔓"),1),d("div",null,[d("div",n6,ie(s.value?i.value?"Joueur associé à votre compte":"Ce joueur est associé à un compte utilisateur":"Joueur sans compte"),1),d("div",r6,ie(s.value?i.value?"Seul vous pouvez modifier":"Seul le titulaire peut modifier les disponibilités":"Tout le monde peut modifier les disponibilités"),1)])])],2)]),s.value?ce("",!0):(D(),V("div",s6,U[5]||(U[5]=[d("div",{class:"text-sm text-gray-300"},"Vous pouvez protéger vos saisies de disponibilités avec un compte utilisateur.",-1)]))),a.value?(D(),V("div",i6,[d("div",o6,ie(a.value),1)])):ce("",!0),l.value?(D(),V("div",a6,[d("div",l6,ie(l.value),1)])):ce("",!0),d("div",u6,[s.value?(D(),V("button",{key:1,onClick:y,disabled:o.value,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," 🔓 Dissocier ",8,c6)):(D(),V("button",{key:0,onClick:U[0]||(U[0]=L=>c.value=!0),class:"px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300"}," Associer un compte ")),d("button",{onClick:S,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0),Qe(AT,{show:c.value,player:n.player,"season-id":n.seasonId,onClose:U[2]||(U[2]=L=>c.value=!1),onSuccess:f},null,8,["show","player","season-id"]),Qe(av,{show:h.value,player:n.player,seasonId:n.seasonId,onClose:U[3]||(U[3]=L=>h.value=!1),onVerified:A},null,8,["show","player","seasonId"])],64)}}};const h6=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},f6={class:"relative p-4 md:p-6 border-b border-white/10"},p6={class:"flex items-start gap-4 md:gap-6"},m6={class:"flex-1 min-w-0"},g6={class:"flex items-center gap-3 mb-2"},v6={class:"text-xl md:text-2xl font-bold text-white leading-tight"},y6={class:"flex items-center gap-2"},_6={key:0,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border border-yellow-500/30 rounded-full"},b6={key:1,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30 rounded-full"},w6={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},x6={class:"grid grid-cols-3 gap-3 md:gap-4"},I6={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},E6={class:"text-xl md:text-2xl font-bold text-white"},T6={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},A6={class:"text-xl md:text-2xl font-bold text-white"},S6={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30 text-center"},P6={class:"text-xl md:text-2xl font-bold text-white"},R6={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},C6={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},k6={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},D6={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},N6={class:"mb-6"},V6={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null},onboardingStep:{type:Number,default:0},onboardingPlayerId:{type:[String,null],default:null},isProtected:{type:Boolean,default:!1},isPreferred:{type:Boolean,default:!1}},emits:["close","update","delete","refresh","advance-onboarding"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=P(!1),o=P(""),a=P(null),l=P(!1),c=P(!1),h=P(null);P(!1);const f=P(!1),g=P(!1),y=P(null),I=P(null),A=P({position:"fixed",top:"0px",left:"0px"}),S=P(null),$=P({position:"fixed",top:"0px",left:"0px"}),U=P(!1),M=P(!1);function L(){s("close"),f.value=!1,g.value=!1,A.value={position:"fixed",top:"0px",left:"0px"},$.value={position:"fixed",top:"0px",left:"0px"}}function se(){var ue;o.value=((ue=r.player)==null?void 0:ue.name)||"",i.value=!0,Ht(()=>{a.value&&a.value.focus()})}function Q(){i.value=!1,o.value=""}async function x(){var oe,Ne;if(!o.value.trim())return;if(await Li((oe=r.player)==null?void 0:oe.id,r.seasonId)){Fo((Ne=r.player)==null?void 0:Ne.id)?b():(h.value="update",c.value=!0);return}b()}function b(){var ue;s("update",{playerId:(ue=r.player)==null?void 0:ue.id,newName:o.value.trim()}),i.value=!1,o.value=""}async function E(){var oe,Ne;if(await Li((oe=r.player)==null?void 0:oe.id,r.seasonId)){Fo((Ne=r.player)==null?void 0:Ne.id)?C():(h.value="delete",c.value=!0);return}C()}function C(){var ue;s("delete",(ue=r.player)==null?void 0:ue.id)}function O(){s("refresh")}function F(ue){h.value==="update"?b():h.value==="delete"&&C(),h.value=null}function R(){try{const ue=y.value;if(!ue)return;const oe=ue.getBoundingClientRect(),Ne=8;if(window.innerWidth>768){const te=Math.max(Ne,Math.round(oe.top-Ne)),Y=Math.max(Ne,Math.round(oe.left));A.value={position:"fixed",top:`${te}px`,left:`${Y}px`,zIndex:400}}else{const te=Math.min(window.innerHeight-Ne,Math.round(oe.bottom+Ne)),Y=Math.max(Ne,Math.round(oe.left));A.value={position:"fixed",top:`${te}px`,left:`${Y}px`,zIndex:400}}}catch{}}function pt(){try{const te=Math.max(8,window.innerHeight-8-48-120),Y=Math.max(8,Math.round(window.innerWidth-200-8));$.value={position:"fixed",top:`${te}px`,left:`${Y}px`,zIndex:400}}catch{}}function mt(){f.value=!f.value,f.value&&Ht(()=>R())}function we(){g.value=!g.value,g.value&&Ht(()=>pt())}bt(()=>r.show,ue=>{var oe;ue||(i.value=!1,o.value="",h.value=null,l.value=!1,f.value=!1,g.value=!1),ue&&((oe=r.player)!=null&&oe.id)&&(Li(r.player.id,r.seasonId).then(Ne=>{U.value=!!Ne}),en(()=>Promise.resolve().then(()=>Nc),void 0).then(Ne=>{try{M.value=!!Ne.isPlayerPasswordCached(r.player.id)}catch{M.value=!1}}))}),yn(()=>{document.addEventListener("click",ue=>{if(f.value){const oe=y.value,Ne=I.value,te=oe&&oe.contains(ue.target),Y=Ne&&Ne.contains(ue.target);!te&&!Y&&(f.value=!1)}if(g.value){const oe=S.value;oe&&oe.contains(ue.target)||(g.value=!1)}}),document.addEventListener("keydown",ue=>{ue.key==="Escape"&&(f.value&&(f.value=!1),g.value&&(g.value=!1))}),window.addEventListener("resize",()=>{f.value&&R(),g.value&&pt()}),window.addEventListener("scroll",()=>{f.value&&R(),g.value&&pt()},{passive:!0})}),e({openProtection(){l.value=!0}});const re=P({position:null});return bt(()=>r.show,ue=>{ue&&r.onboardingStep===4?Ht(()=>{const oe=document.querySelectorAll("button");let Ne=null;if(oe.forEach(te=>{!Ne&&te.textContent&&te.textContent.includes("Protection")&&(Ne=te)}),Ne){const te=Ne.getBoundingClientRect();re.value.position={x:Math.round(te.right+8),y:Math.round(te.top+window.scrollY-4)}}}):ue||(re.value.position=null)}),(ue,oe)=>{var Ne;return D(),V(it,null,[n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:L},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-xl max-h-[92vh] flex flex-col",onClick:oe[6]||(oe[6]=ct(()=>{},["stop"]))},[d("div",f6,[d("button",{onClick:L,class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",p6,[oe[15]||(oe[15]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"👤")],-1)),d("div",m6,[d("div",g6,[d("h2",v6,ie((Ne=n.player)==null?void 0:Ne.name),1),d("div",y6,[n.isProtected?(D(),V("div",_6,oe[13]||(oe[13]=[d("span",{class:"text-yellow-400 text-sm"},"🔒",-1),d("span",{class:"text-yellow-300 text-xs font-medium"},"Protégé",-1)]))):ce("",!0),n.isPreferred?(D(),V("div",b6,oe[14]||(oe[14]=[d("span",{class:"text-purple-400 text-sm"},"⭐",-1),d("span",{class:"text-purple-300 text-xs font-medium"},"Favori",-1)]))):ce("",!0)])])])])]),d("div",w6,[d("div",null,[d("div",x6,[d("div",I6,[d("div",E6,ie(r.stats.availability),1),oe[16]||(oe[16]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibilités",-1))]),d("div",T6,[d("div",A6,ie(r.stats.selection),1),oe[17]||(oe[17]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélections",-1))]),d("div",S6,[d("div",P6,ie(r.stats.ratio),1),oe[18]||(oe[18]=d("div",{class:"text-xs md:text-sm text-gray-300"},"% de sélection",-1))])])]),d("div",R6,[d("button",{onClick:oe[0]||(oe[0]=te=>l.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},[d("span",null,ie(U.value?"🔓":"🔒"),1),d("span",null,ie(U.value?"Déverrouiller":"Verrouiller"),1)]),d("div",{class:"relative",ref_key:"playerMoreActionsRef",ref:y},[d("button",{onClick:oe[1]||(oe[1]=te=>mt()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},oe[19]||(oe[19]=[d("span",null,"⋯",-1),d("span",null,"Plus",-1)]))],512),d("button",{onClick:L,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer "),(D(),Vs(Vu,{to:"body"},[f.value?(D(),V("div",{key:0,ref_key:"playerMoreActionsDropdownRef",ref:I,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:_r(A.value)},[d("button",{onClick:oe[2]||(oe[2]=te=>{se(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},oe[20]||(oe[20]=[d("span",null,"✏️",-1),d("span",null,"Renommer",-1)])),d("button",{onClick:oe[3]||(oe[3]=te=>{E(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},oe[21]||(oe[21]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ce("",!0)]))])]),d("div",C6,[d("button",{onClick:oe[4]||(oe[4]=te=>l.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"},ie(U.value?"🔓 Déverrouiller":"🔒 Verrouiller"),1),d("button",{onClick:oe[5]||(oe[5]=te=>we()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ "),d("button",{onClick:L,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer ")])])])):ce("",!0),(D(),Vs(Vu,{to:"body"},[g.value?(D(),V("div",{key:0,ref_key:"playerMoreActionsMobileDropdownRef",ref:S,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:_r($.value)},[d("button",{onClick:oe[7]||(oe[7]=te=>{se(),g.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},oe[22]||(oe[22]=[d("span",null,"✏️",-1),d("span",null,"Renommer",-1)])),d("button",{onClick:oe[8]||(oe[8]=te=>{E(),g.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},oe[23]||(oe[23]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ce("",!0)])),i.value?(D(),V("div",k6,[d("div",D6,[oe[25]||(oe[25]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Renommer le joueur",-1)),d("div",N6,[oe[24]||(oe[24]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),ot(d("input",{"onUpdate:modelValue":oe[9]||(oe[9]=te=>o.value=te),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Bn(Q,["esc"]),Bn(x,["enter"])],ref_key:"editNameInput",ref:a},null,544),[[$t,o.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:Q,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:x,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ce("",!0),Qe(d6,{show:l.value,player:n.player,seasonId:n.seasonId,onboarding:n.onboardingStep===4,onClose:oe[10]||(oe[10]=te=>l.value=!1),onUpdate:O,onOnboardingFinished:oe[11]||(oe[11]=te=>ue.$emit("advance-onboarding",5))},null,8,["show","player","seasonId","onboarding"]),Qe(av,{show:c.value,player:n.player,seasonId:n.seasonId,onClose:oe[12]||(oe[12]=te=>c.value=!1),onVerified:F},null,8,["show","player","seasonId"])],64)}}},O6=h6(V6,[["__scopeId","data-v-8237d7ee"]]),M6={class:"relative p-6 pb-4 border-b border-white/10"},L6={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},$6={__name:"HowItWorksModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=ct(()=>{},["stop"]))},[d("div",M6,[d("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=d("div",{class:"flex items-center gap-3"},[d("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-2xl"},"❓"),d("div",null,[d("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Comment fonctionne la sélection automatique ?"),d("p",{class:"text-sm text-blue-300"},"Tirage au sort pondéré pour favoriser l'équité")])],-1))]),s[5]||(s[5]=Pn('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">En bref</h3><p>On tire au sort uniquement parmi les joueurs <span class="text-green-300">disponibles</span>. Ceux qui ont <span class="text-purple-300">moins joué</span> ont plus de chances d&#39;être tirés. À long terme, tout le monde joue à peu près autant.</p></div><div class="space-y-3"><h3 class="text-white font-semibold">Détails du tirage</h3><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><span class="text-white">Qui participe ?</span> Tous les joueurs marqués « ✅ Disponible » pour l’événement.</li><li><span class="text-white">Un coup de pouce aux moins joués</span> : si vous avez moins joué récemment, le tirage vous favorise un peu plus.</li><li><span class="text-white">Comment se fait le tirage ?</span> On tire un nom au hasard en tenant compte de cet avantage, on le met de côté, puis on recommence jusqu’à avoir assez de joueurs.</li><li><span class="text-white">Si on relance</span> : on garde les joueurs encore disponibles et on complète seulement les places manquantes.</li><li><span class="text-white">Indisponibles</span> : ils ne sont jamais tirés au sort.</li></ol></div><div class="space-y-2"><h3 class="text-white font-semibold">Estimation des chances</h3><p>L’application peut afficher un pourcentage indicatif pour aider à comprendre : si Alice a moins joué que Bob, elle aura un pourcentage plus élevé. C’est une indication, pas une promesse : deux tirages peuvent donner des résultats différents.</p></div><div class="space-y-2"><h3 class="text-white font-semibold">Pourquoi c’est juste</h3><ul class="list-disc list-inside space-y-1 text-gray-300"><li>Ceux qui ont moins joué ont automatiquement plus de chances.</li><li>Après une sélection, vos chances diminuent un peu pour laisser la place aux autres.</li><li>Sur la durée, les sélections s’<span class="text-green-300">équilibrent naturellement</span>.</li></ul></div><div class="space-y-2"><h3 class="text-white font-semibold">Exemples rapides</h3><p> • Alice n’a encore jamais été sélectionnée, Bob a été sélectionné une fois, Charlie plusieurs fois. Pour 1 place, on aura environ : Alice 57 %, Bob 29 %, Charlie 14 %.<br> • S’il y a 2 places, les chances de chacun augmentent, mais l’ordre reste aléatoire : un tirage peut donner Alice + Bob, un autre Alice + Charlie. </p></div><div class="text-xs text-gray-400"> Remarque : l’algorithme favorise l’équité à long terme, mais <span class="text-gray-300">n’assure pas</span> une rotation parfaite à chaque événement. </div></div>',1)),d("div",L6,[d("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ce("",!0)}},F6={class:"relative p-4 md:p-6 border-b border-white/10"},U6={class:"flex items-start gap-4 md:gap-6"},j6={class:"flex-1 min-w-0"},q6={class:"text-xl md:text-2xl font-bold text-white leading-tight mb-2"},B6={class:"flex items-center gap-3"},z6={class:"text-base md:text-lg text-purple-300"},K6={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},G6={class:"text-blue-200"},H6={key:0,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm flex items-center gap-1",title:"Prêt pour la sélection"},W6={key:1,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded text-sm flex items-center gap-1",title:"Sélection complète"},Q6={key:2,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded text-sm flex items-center gap-1",title:"Sélection incomplète"},J6={key:3,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded text-sm flex items-center gap-1",title:"Pas assez de joueurs disponibles"},Y6={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},X6={class:"grid grid-cols-3 gap-3 md:gap-4 mb-4"},Z6={class:"bg-gradient-to-r from-yellow-500/20 to-orange-500/20 p-3 md:p-4 rounded-lg border border-yellow-500/30 text-center"},e5={class:"text-xl md:text-2xl font-bold text-yellow-300"},t5={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},n5={class:"text-xl md:text-2xl font-bold text-white"},r5={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},s5={class:"text-xl md:text-2xl font-bold text-white"},i5={class:"mb-3"},o5={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},a5={key:0,class:"flex items-center justify-between gap-2"},l5=["title"],u5={key:0,class:"text-purple-400 mr-2"},c5={key:1,class:"text-green-400 mr-2"},d5={key:2,class:"text-red-400 mr-2"},h5={key:3,class:"text-gray-400 mr-2"},f5=["onClick"],p5={key:1,class:"flex items-center justify-center"},m5=["onChange"],g5=["value"],v5=["onClick"],y5={key:0,class:"mb-3"},_5={key:1,class:"mb-3"},b5={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},w5={class:"flex-1"},x5={class:"text-blue-300 text-sm font-medium"},I5={class:"sticky bottom-0 w-full p-3 bg-gray-900/80 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},E5=["disabled","title"],T5=["disabled"],A5={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]}},emits:["close","selection","perfect","send-notifications","updateSelection"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=P(!1),o=P("Copier le message"),a=P(!1),l=P(!1),c=P(""),h=P(!1),f=P(!1),g=Fe(()=>{var te;return((te=r.event)==null?void 0:te.playerCount)||6}),y=P([]),I=P(null),A=Fe(()=>(r.players||[]).map(te=>te.name).filter(te=>{var Y;return((Y=r.playerAvailability)==null?void 0:Y[te])===!0}).sort((te,Y)=>te.localeCompare(Y,"fr",{sensitivity:"base"})));function S(te){const Y=new Set(y.value.filter(Boolean)),Te=y.value[te];return Te&&Y.delete(Te),A.value.filter(We=>!Y.has(We))}function $(te){I.value=te}function U(){I.value=null}async function M(te,Y){var We;const Te=((We=te==null?void 0:te.target)==null?void 0:We.value)||"";Te&&(y.value[Y]=Te,await O()),I.value=null}async function L(te){y.value[te]=null,await O()}Fe(()=>(S(-1).length<g.value,""));const se=Fe(()=>r.currentSelection&&r.currentSelection.length>0);function Q(){var We;const te=r.currentSelection||[],Y=((We=r.event)==null?void 0:We.playerCount)||6,Te=r.availableCount||0;if(te.length>0){const at=te.some(Z=>!mt(Z)),Vt=Te<Y;if(at||Vt)return{type:"incomplete",hasUnavailablePlayers:at,hasInsufficientPlayers:Vt,unavailablePlayers:te.filter(Z=>!mt(Z)),availableCount:Te,requiredCount:Y}}return Te<Y?{type:"insufficient",availableCount:Te,requiredCount:Y}:te.length===0?{type:"ready",availableCount:Te,requiredCount:Y}:{type:"complete",availableCount:Te,requiredCount:Y}}const x=Fe(()=>{var We;if(!se.value)return!1;const te=r.currentSelection.some(at=>!mt(at)),Y=((We=r.event)==null?void 0:We.playerCount)||6,Te=r.availableCount<Y;return te||Te});Fe(()=>{var Te;if(!x.value)return"";const te=r.currentSelection.filter(We=>!mt(We)),Y=((Te=r.event)==null?void 0:Te.playerCount)||6;return te.length>0?te.length===1?`${te[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${te.length} joueurs ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<Y?`Seulement ${r.availableCount} joueurs disponibles pour ${Y} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de joueurs à sélectionner.`:"Sélection incomplète"}),Fe(()=>{if(!r.event||!se.value)return"";const te=b(r.event.date),Y=r.currentSelection.join(", ");return`Sélection pour ${r.event.title} du ${te} : ${Y}`}),bt(()=>r.show,te=>{if(te){i.value=!1,o.value="Copier le message",l.value=!1,c.value="",h.value=!1,a.value=!1;const Y=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],Te=g.value;y.value=Array.from({length:Te},(We,at)=>Y[at]||null),I.value=null}}),bt([g,()=>r.currentSelection,()=>{var te;return(te=r.event)==null?void 0:te.id}],()=>{if(!r.show)return;const te=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],Y=g.value,Te=Array.from({length:Y},(We,at)=>te[at]||y.value[at]||null);y.value=Te.slice(0,Y)});function b(te){var Te;return te?(typeof te=="string"?new Date(te):((Te=te.toDate)==null?void 0:Te.call(te))||te).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function E(){s("selection")}function C(){s("perfect")}async function O(){var te;if(!(!((te=r.event)!=null&&te.id)||!r.seasonId))try{const Y=y.value.filter(Boolean);await nm(r.event.id,Y,r.seasonId),console.debug("Sélection sauvegardée automatiquement")}catch(Y){console.error("Erreur lors de la sauvegarde automatique:",Y)}}function F(){s("close")}function R(){a.value=!0}function pt(){f.value=!0}function mt(te){return r.playerAvailability[te]===!0}function we(te){return r.playerAvailability[te]===!1}function re(te){return r.currentSelection.includes(te)&&mt(te)}function ue(te=!1,Y=!1){if(h.value=te,te){const Te=b(r.event.date),We=r.currentSelection.join(", ");Y?c.value=`Sélection mise à jour pour ${r.event.title} du ${Te} : ${We}. Pensez à prévenir les joueurs via le bouton "Annoncer" !`:c.value=`Nouvelle sélection pour ${r.event.title} du ${Te} : ${We}. Pensez à prévenir les joueurs via le bouton "Annoncer" !`}else c.value="Sélection effectuée avec succès !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function oe(){l.value=!1}e({showSuccess:ue});function Ne(te){s("send-notifications",te)}return(te,Y)=>{var Te,We,at,Vt;return D(),V(it,null,[n.show?(D(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:F},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:Y[1]||(Y[1]=ct(()=>{},["stop"]))},[d("div",F6,[d("button",{onClick:F,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",U6,[Y[9]||(Y[9]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),d("div",j6,[d("h2",q6,"Sélection pour "+ie((Te=n.event)==null?void 0:Te.title),1),d("div",B6,[d("p",z6,ie(b((We=n.event)==null?void 0:We.date)),1),d("div",K6,[Y[4]||(Y[4]=d("span",{class:"text-blue-300"},"👥",-1)),d("span",G6,ie(((at=n.event)==null?void 0:at.playerCount)||6)+" joueurs",1)]),Q().type==="ready"?(D(),V("div",H6,Y[5]||(Y[5]=[d("span",{class:"text-blue-300 text-xs"},"🆕",-1),d("span",{class:"text-blue-200 text-xs"},"Nouveau",-1)]))):Q().type==="complete"?(D(),V("div",W6,Y[6]||(Y[6]=[d("span",{class:"text-green-300 text-xs"},"✅",-1),d("span",{class:"text-green-200 text-xs"},"Complet",-1)]))):Q().type==="incomplete"?(D(),V("div",Q6,Y[7]||(Y[7]=[d("span",{class:"text-orange-300 text-xs"},"⚠️",-1),d("span",{class:"text-orange-200 text-xs"},"À finaliser",-1)]))):Q().type==="insufficient"?(D(),V("div",J6,Y[8]||(Y[8]=[d("span",{class:"text-red-300 text-xs"},"❌",-1),d("span",{class:"text-red-200 text-xs"},"Manque",-1)]))):ce("",!0)])])])]),d("div",Y6,[d("div",X6,[d("div",Z6,[d("div",e5,ie(Math.max((((Vt=n.event)==null?void 0:Vt.playerCount)||6)-n.selectedCount,0)),1),Y[10]||(Y[10]=d("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))]),d("div",t5,[d("div",n5,ie(n.availableCount),1),Y[11]||(Y[11]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),d("div",r5,[d("div",s5,ie(n.selectedCount),1),Y[12]||(Y[12]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))])]),d("div",i5,[d("div",{class:"flex items-center gap-2 mb-2"},[Y[14]||(Y[14]=d("h3",{class:"text-base md:text-lg font-semibold text-white"},"Joueurs sélectionnés",-1)),d("button",{onClick:pt,class:"text-blue-300 hover:text-blue-200 p-1 rounded-full hover:bg-blue-500/10 transition-colors",title:"Comment fonctionne la sélection automatique ?"},Y[13]||(Y[13]=[d("span",{class:"text-sm"},"❓",-1)]))]),d("div",o5,[(D(!0),V(it,null,br(y.value,(Z,Ae)=>(D(),V("div",{key:"sel-slot-"+Ae,class:Zt(["relative p-3 rounded-lg border text-center transition-colors",Z?["bg-gradient-to-r",we(Z)?"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":mt(Z)?"from-green-500/20 to-emerald-500/20 border-green-500/30":"from-red-500/20 to-red-600/20 border-red-500/30"]:"border-dashed border-white/20 hover:border-white/40 bg-white/5"])},[Z?(D(),V("div",a5,[d("div",{class:"flex-1 text-white font-medium truncate",title:Z},[re(Z)?(D(),V("span",u5,"🎭")):mt(Z)?(D(),V("span",c5,"✅")):we(Z)?(D(),V("span",d5,"❌")):(D(),V("span",h5,"–")),St(" "+ie(Z),1)],8,l5),d("button",{onClick:xe=>L(Ae),class:"text-white/80 hover:text-white rounded-full hover:bg-white/10 px-2 py-1",title:"Retirer ce joueur"}," × ",8,f5)])):(D(),V("div",p5,[I.value===Ae?(D(),V("select",{key:0,class:"w-full bg-gray-800 text-white rounded-md p-2 border border-white/20 focus:outline-none",onChange:xe=>M(xe,Ae),onBlur:Y[0]||(Y[0]=xe=>U())},[Y[15]||(Y[15]=d("option",{value:""},"— Choisir —",-1)),(D(!0),V(it,null,br(S(Ae),xe=>(D(),V("option",{key:xe,value:xe},ie(xe),9,g5))),128))],40,m5)):(D(),V("button",{key:1,onClick:xe=>$(Ae),class:"flex items-center gap-2 text-white/80 hover:text-white px-2 py-1 rounded-md hover:bg-white/10",title:"Ajouter un joueur"},Y[16]||(Y[16]=[d("span",{class:"text-lg"},"＋",-1),d("span",{class:"text-sm"},"Ajouter",-1)]),8,v5))]))],2))),128))])]),se.value?(D(),V("div",y5,Y[17]||(Y[17]=[d("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[d("div",{class:"text-yellow-400"},"⚠️"),d("div",{class:"text-yellow-200 text-sm"},"Pensez à prévenir les gens de vos changements !")],-1)]))):ce("",!0),l.value?(D(),V("div",_5,[d("div",b5,[Y[19]||(Y[19]=d("div",{class:"text-blue-400 text-xl"},"✨",-1)),d("div",w5,[d("p",x5,ie(c.value),1)]),d("button",{onClick:oe,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},Y[18]||(Y[18]=[d("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):ce("",!0)]),d("div",I5,[d("button",{onClick:E,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":se.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},Y[20]||(Y[20]=[St(" ✨ "),d("span",{class:"hidden sm:inline"},"Sélection Auto",-1),d("span",{class:"sm:hidden"},"Auto",-1)]),8,E5),d("button",{onClick:R,disabled:!se.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},Y[21]||(Y[21]=[St(" 📣 "),d("span",{class:"hidden sm:inline"},"Annoncer",-1),d("span",{class:"sm:hidden"},"Annoncer",-1)]),8,T5),d("button",{onClick:C,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 whitespace-nowrap"},Y[22]||(Y[22]=[d("span",{class:"hidden sm:inline"},"Fermer",-1),d("span",{class:"sm:hidden"},"Fermer",-1)]))])])])):ce("",!0),Qe(TT,{show:a.value,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,mode:"selection","selected-players":n.currentSelection,onClose:Y[2]||(Y[2]=Z=>a.value=!1),onSendNotifications:Ne},null,8,["show","event","season-id","season-slug","players","selected-players"]),Qe($6,{show:f.value,onClose:Y[3]||(Y[3]=Z=>f.value=!1)},null,8,["show"])],64)}}},S5={class:"flex items-center justify-center"},P5=["title"],R5={key:0,class:"text-center"},C5={key:1,class:"text-center"},k5={key:2,class:"text-center"},D5={key:3,class:"text-center text-gray-400"},R_={__name:"AvailabilityCell",props:{playerName:{type:String,required:!0},compact:{type:Boolean,default:!1},eventId:{type:String,required:!0},isAvailable:{type:Boolean,default:null},isSelected:{type:Boolean,default:!1},chancePercent:{type:Number,default:null},showSelectedChance:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["toggle"],setup(n,{emit:e}){const t=n,r=e,s=P(!1),i=Fe(()=>!(t.chancePercent==null||t.isAvailable!==!0||t.isSelected&&!t.showSelectedChance)),o=Fe(()=>t.disabled?"Événement archivé — désarchivez pour modifier":t.isSelected&&t.isAvailable===!0?i.value?`${t.playerName} est sélectionné pour cet événement • avait ~${t.chancePercent}% de chances`:`${t.playerName} est sélectionné pour cet événement`:t.isAvailable===!0?t.chancePercent!=null?`${t.playerName} est disponible • ~${t.chancePercent}% de chances d'être sélectionné`:`${t.playerName} est disponible`:t.isAvailable===!1?`${t.playerName} n'est pas disponible`:`Cliquer pour indiquer la disponibilité de ${t.playerName}`);function a(){t.disabled||r("toggle",t.playerName,t.eventId)}return(l,c)=>(D(),V("div",{class:Zt(["flex items-center justify-center transition-all duration-200 rounded font-medium text-white mx-0.5 my-0.25",[n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer hover:scale-105",n.compact?"min-h-0 p-1 md:p-2 text-xs":"min-h-20 p-2 md:p-3 text-sm",n.isSelected&&n.isAvailable===!0?"bg-gradient-to-br from-purple-500/60 to-pink-500/60":"",!n.isSelected&&n.isAvailable===!0?"bg-green-500/60":"",n.isAvailable===!1?"bg-red-500/60":"",n.isAvailable===null||n.isAvailable===void 0?"bg-gray-500/40":""]]),onClick:a,onMouseenter:c[0]||(c[0]=h=>s.value=!0),onMouseleave:c[1]||(c[1]=h=>s.value=!1)},[d("div",S5,[i.value&&s.value?(D(),V("span",{key:0,class:"text-[11px] md:text-xs px-2 py-0.5 rounded-full bg-emerald-500/15 border border-emerald-400/40 text-emerald-200",title:o.value},ie(n.chancePercent)+"% ",9,P5)):(D(),V(it,{key:1},[n.isSelected&&n.isAvailable===!0?(D(),V("span",R5," Joue ")):n.isAvailable===!0?(D(),V("span",C5," Disponible ")):n.isAvailable===!1?(D(),V("span",k5," Pas disponible ")):(D(),V("span",D5," – "))],64))])],34))}},N5={key:0,class:"fixed inset-0 z-[130] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},V5={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},O5={class:"text-2xl md:text-3xl font-bold text-white mb-3"},M5={class:"text-gray-300 mb-6"},L5={class:"flex flex-col items-stretch justify-center gap-3"},$5=["value"],F5={__name:"CreatorOnboardingModal",props:{seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},onboardingDone:{type:Boolean,default:!1}},emits:["create-event","add-player","copy-link","dismissed"],setup(n,{emit:e}){const t=n,r=e,s=window.location.origin,i=Fe(()=>`${s}/season/${t.seasonSlug}`),o=P(!1);try{t.seasonId&&(o.value=!!localStorage.getItem(`dismissCreatorOnboarding:${t.seasonId}`))}catch{}const a=Fe(()=>t.onboardingDone?0:t.eventsCount===0&&t.playersCount===0?1:t.eventsCount>0&&t.playersCount===0?2:t.eventsCount>0&&t.playersCount>0&&!o.value?3:0),l=Fe(()=>a.value>0),c=P(l.value);bt(a,S=>{c.value=S>0});const h=Fe(()=>{switch(a.value){case 1:return"Commençons par créer votre premier événement";case 2:return"Super ! Ajoutez votre premier joueur";case 3:return"Vous y êtes presque! Maintenant, invitez vos joueurs.";default:return""}}),f=Fe(()=>{switch(a.value){case 1:return"Un titre, une date... et c’est parti.";case 2:return"Ajoutez au moins un joueur pour commencer à saisir des disponibilités.";case 3:return"Laissez vos membres s’inscrire eux-même et indiquer leurs disponibilités en leur envoyant le lien direct.";default:return""}});function g(){c.value=!1,r("create-event")}function y(){c.value=!1,r("add-player")}function I(){var S;try{(S=navigator.clipboard)==null||S.writeText(i.value)}catch{}r("copy-link")}async function A(){try{if(t.seasonId){const{db:S}=await en(()=>Promise.resolve().then(()=>Mi),void 0),{doc:$,updateDoc:U}=await en(()=>import("./index.esm-4a81f50f.js"),[]);await U($(S,"seasons",t.seasonId),{onboardingCreatorDone:!0})}else localStorage.setItem("dismissCreatorOnboarding","1")}catch{}o.value=!0,c.value=!1,r("dismissed")}return(S,$)=>l.value&&c.value?(D(),V("div",N5,[d("div",V5,[$[1]||($[1]=d("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[d("span",{class:"text-3xl"},"🎬")],-1)),d("h2",O5,ie(h.value),1),d("p",M5,ie(f.value),1),d("div",L5,[a.value===1?(D(),V("button",{key:0,onClick:g,class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all"}," ✨ Créer un événement ")):a.value===2?(D(),V("button",{key:1,onClick:y,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"}," 👤 Ajouter un joueur ")):a.value===3?(D(),V(it,{key:2},[d("input",{value:i.value,type:"text",readonly:"",class:"w-full px-3 py-2 bg-gray-800 border border-white/20 rounded-lg text-white text-sm select-all",onFocus:$[0]||($[0]=U=>U.target.select())},null,40,$5),d("div",{class:"flex gap-3 justify-center"},[d("button",{onClick:I,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"}," 🔗 Copier le lien "),d("button",{onClick:A,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"}," J’ai compris ")])],64)):ce("",!0)])])])):ce("",!0)}},U5={class:"sticky top-0 z-[60] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},j5={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},q5={class:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2"},B5={class:"hidden md:flex items-center gap-2"},z5={class:"md:hidden"},K5={__name:"SeasonHeader",props:{seasonName:{type:String,default:""},isScrolled:{type:Boolean,default:!1}},emits:["go-back","open-account-menu","open-help","open-notifications","open-players","logout","open-login","open-account"],setup(n,{emit:e}){const t=n,r=e,s=P(null),i=Fe(()=>{var A;return!!s.value&&!((A=s.value)!=null&&A.isAnonymous)}),o=Fe(()=>t.isScrolled?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700":"bg-white/10 hover:bg-white/20 text-white border-white/20 hover:border-white/40");function a(A){s.value=A}yn(()=>{s.value=Ge.currentUser;const A=Ge.onAuthStateChanged(a);window._seasonHeaderUnsubscribe=A}),Vi(()=>{window._seasonHeaderUnsubscribe&&(window._seasonHeaderUnsubscribe(),delete window._seasonHeaderUnsubscribe)});function l(){r("go-back")}function c(){r("open-account-menu")}function h(){r("open-login")}function f(){r("open-help")}function g(){r("open-notifications")}function y(){r("open-players")}function I(){r("logout")}return(A,S)=>(D(),V("div",U5,[d("button",{onClick:l,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour aux saisons"},S[0]||(S[0]=[d("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),d("h1",j5,ie(n.seasonName?n.seasonName:"Chargement..."),1),d("div",q5,[d("div",B5,[Qe(em,{"is-connected":i.value,"button-class":o.value,onOpenAccountMenu:c,onOpenHelp:f,onOpenNotifications:g,onOpenPlayers:y,onLogout:I,onOpenLogin:h},null,8,["is-connected","button-class"]),i.value?ce("",!0):(D(),V("button",{key:0,onClick:f,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Kezako ?","aria-label":"Kezako ?"},S[1]||(S[1]=[d("span",{class:"text-2xl"},"❓",-1)])))]),d("div",z5,[Qe(em,{"is-connected":i.value,"button-class":o.value,onOpenAccountMenu:c,onOpenHelp:f,onOpenNotifications:g,onOpenPlayers:y,onLogout:I,onOpenLogin:h},null,8,["is-connected","button-class"])])])]))}};const G5={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},H5={class:"w-full px-0 md:px-0 pb-0 pt-[72px] md:pt-[80px] -mt-[72px] md:-mt-[80px] bg-gray-900"},W5={class:"flex items-stretch relative"},Q5={key:0,class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},J5={class:"flex-1 overflow-hidden"},Y5=["data-event-id"],X5=["title","onClick"],Z5={class:"flex flex-col items-center flex-1 justify-center"},eU={class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2 group-hover:text-purple-300 transition-colors duration-200"},tU={key:0,class:"mt-1 text-xs text-gray-400"},nU={class:"relative"},rU=["onClick","title"],sU={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},iU={class:"p-2"},oU=["onClick"],aU=["onClick"],lU=["onClick"],uU={class:"flex flex-col items-center mt-2"},cU={key:0,class:"px-2 py-1 bg-gray-500/20 border border-gray-400/30 rounded-md mx-auto flex items-center justify-center",title:"Événement archivé"},dU=["title","onClick"],hU=["title","onClick"],fU=["title","onClick"],pU=["title","onClick"],mU=["title","aria-label"],gU={class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},vU={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3l18 18"},yU={key:0,class:"pointer-events-none"},_U={class:"flex items-center justify-between"},bU={key:1,class:"pointer-events-none"},wU={id:"coachmark-avail",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-pink-500/40 rounded-xl shadow-2xl p-3 text-white relative"},xU={class:"flex items-center justify-between"},IU={key:2,class:"pointer-events-none"},EU={id:"coachmark-name",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-yellow-500/40 rounded-xl shadow-2xl p-3 text-white relative"},TU={class:"flex items-center justify-between"},AU={class:"table-auto border-separate border-spacing-0 table-fixed w-auto min-w-max"},SU=["data-player-id"],PU={class:"px-0 py-4 md:py-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900 left-col-td"},RU={class:"px-4 md:px-5 font-bold text-xl md:text-2xl flex items-center w-full min-w-0"},CU={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Mon joueur"},kU={key:1,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protégé par mot de passe"},DU=["onClick","title"],NU={class:"group-hover:text-purple-300 transition-colors duration-200"},VU=["data-event-id"],OU={class:"border-t border-white/10"},MU={class:"px-0 py-4 md:py-5 sticky left-0 z-40 bg-gray-900 left-col-td"},LU={class:"px-4 md:px-5 flex items-center"},$U=["data-event-id"],FU={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},UU={class:"text-center"},jU={class:"text-white text-lg"},qU={class:"mt-3 w-64 h-2 bg-white/10 rounded-full overflow-hidden"},BU={class:"text-white/60 text-xs mt-2"},zU={key:3,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-[200]"},KU={class:"flex items-center space-x-2"},GU={key:4,class:"fixed bottom-4 left-4 bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl shadow-2xl border border-red-400/30 backdrop-blur-sm z-[200]"},HU={class:"flex items-center space-x-2"},WU={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},QU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},JU={class:"mb-6"},YU={class:"mb-6"},XU={class:"mb-6"},ZU={class:"mb-6 flex items-center gap-3"},ej={class:"mb-6"},tj={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},nj={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},rj={class:"mb-6"},sj={class:"flex justify-end space-x-3"},ij={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},oj={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},aj={class:"flex justify-end space-x-3"},lj={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},uj={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},cj={class:"flex justify-end space-x-3"},dj={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},hj={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},fj={class:"text-center mb-6"},pj={class:"text-gray-300"},mj={key:0},gj={key:1},vj={class:"relative p-4 md:p-6 border-b border-white/10"},yj={class:"flex items-start gap-4 md:gap-6"},_j={class:"flex-1 min-w-0"},bj={class:"flex items-center gap-3 mb-2"},wj={class:"text-xl md:text-2xl font-bold text-white leading-tight"},xj={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},Ij={class:"text-blue-200"},Ej={class:"flex items-center gap-3 mb-3"},Tj={class:"text-base md:text-lg text-purple-300"},Aj={class:"relative"},Sj={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},Pj={class:"p-2"},Rj={key:0,class:"text-sm text-gray-300 bg-gray-800/30 p-3 rounded-lg border border-gray-600/30"},Cj={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},kj={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},Dj={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},Nj={class:"text-xl md:text-2xl font-bold text-white"},Vj={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},Oj={class:"text-xl md:text-2xl font-bold text-white"},Mj={class:"p-3 md:p-4 rounded-lg border border-yellow-500/30 bg-yellow-500/10 text-center"},Lj={class:"text-xl md:text-2xl font-bold text-yellow-300"},$j={key:0,class:"mb-4 md:mb-6"},Fj={class:"mb-3 flex items-center"},Uj=["title"],jj={class:"truncate"},qj={class:"space-y-0.5"},Bj={class:"flex items-center min-w-0 gap-1.5"},zj={key:0,class:"text-yellow-400 mr-1 text-xs",title:"Mon joueur"},Kj={key:1,class:"text-yellow-400 mr-1 text-xs",title:"Joueur protégé par mot de passe"},Gj=["title"],Hj={class:"flex-0 p-0"},Wj={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},Qj=["disabled","title"],Jj=["title"],Yj={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},Xj=["disabled","title"],Zj={key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},eq={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},tq={class:"mb-6"},nq={class:"mb-6"},rq={class:"mb-6"},sq={class:"mb-6 flex items-center gap-3"},iq={class:"mb-6"},oq={key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},aq={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},lq={class:"mb-6"},uq={class:"space-y-4"},cq=["disabled"],dq={key:0,class:"animate-spin"},hq={key:1},fq={class:"mb-6 text-center"},pq={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},mq={class:"text-red-300 text-sm"},gq={key:13,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},vq={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},yq={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},_q={class:"space-y-4"},bq={class:"mt-2 text-center"},wq={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},xq={class:"text-red-300 text-sm"},Iq={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},Eq=["disabled"],Tq={key:0,class:"animate-spin"},Aq={key:1},Sq={class:"mb-6"},Pq=["disabled"],Rq={key:0,class:"animate-spin"},Cq={key:1},kq={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Dq={class:"text-red-300 text-sm"},Nq={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},Vq={class:"text-green-300 text-sm"},Oq={class:"flex justify-center"},Mq={class:"mb-6"},Lq=["disabled"],$q={key:0,class:"animate-spin"},Fq={key:1},Uq={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},jq={class:"text-red-300 text-sm"},qq={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},Bq={class:"text-green-300 text-sm"},zq={class:"flex justify-center"},Kq={key:16,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},Gq={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl max-w-md"},Hq={class:"flex gap-3"},C_={__name:"GridBoard",props:{slug:{type:String,required:!0},eventId:{type:String,required:!1}},setup(n){const e=n,t=gl(),r=Xo(),s=e.slug,i=P(""),o=P(""),a=P({}),l=P(!1),c=P(!1),h=P(null),f=P(null),g=P(""),y=P(""),I=P(6),A=P(!1),S=P(""),$=P(null),U=P(null),M=P(null),L=P({position:null,side:null}),se=P({position:null}),Q=P({position:null}),x=P(!1),b=P(null),E=P(!1),C=P(null),O=P(null),F=P(!1),R=P(null),pt=P(""),mt=P(!1),we=P(null),re=P(""),ue=P(""),oe=P(!1),Ne=P(null),te=P(!1),Y=P(null),Te=P(""),We=P(""),at=P(!1),Vt=P(null),Z=P(!1),Ae=P(!1),xe=P(""),Ve=P(""),tt=P(!1),lt=P(!1),T=P(""),k=P(""),G=P(!1),H=P(null),ne=P(""),de=P(!1),be=P(!1),_e=P(!1),Ie=P(null),ye=P(null),$e=P({position:"fixed",top:"0px",left:"0px"}),Ce=P(null),B=P({position:"fixed",top:"0px",left:"0px"}),j=P(null),ge=P(!1);function he(){try{const _=Ie.value;if(!_)return;const m=_.getBoundingClientRect(),N=8;if(window.innerWidth>768){const ee=Math.max(N,Math.round(m.top-N)),ae=Math.max(N,Math.round(m.left));$e.value={position:"fixed",top:`${ee}px`,left:`${ae}px`,zIndex:400}}else{const ee=Math.min(window.innerHeight-N,Math.round(m.bottom+N)),ae=Math.max(N,Math.round(m.left));$e.value={position:"fixed",top:`${ee}px`,left:`${ae}px`,zIndex:400}}}catch{}}function ke(){try{const ee=Math.max(8,window.innerHeight-8-48-200),ae=Math.max(8,Math.round(window.innerWidth-200-8));B.value={position:"fixed",top:`${ee}px`,left:`${ae}px`,zIndex:400}}catch{}}function He(){_e.value=!_e.value,_e.value&&Ht(()=>he())}function Xe(){be.value=!be.value,be.value&&Ht(()=>ke())}function gt(_){j.value===_?j.value=null:j.value=_}function Ot(){j.value=null}function Ir(){ge.value=!ge.value}function Er(){ge.value=!1}const Mt=P(!1),qt=P(null),Un=P(null),Tr=P(null),Yt=P(0);function oa(){var _;try{if(!o.value||!a.value||a.value.onboardingCreatorDone!==!0||Ke.value.length===0)return;const m=localStorage.getItem(`playerTourCompleted:${o.value}`);try{const ee=((_=Ge==null?void 0:Ge.currentUser)==null?void 0:_.email)||"";ee&&cf(ee).then(async ae=>{const ve=ae.filter(fe=>fe.seasonId===o.value);if(ve.length>0){const fe=`seasonPreferredPlayer:${o.value}`,Me=localStorage.getItem(fe);let Ye=[];if(Me)if(Me.startsWith("["))try{Ye=JSON.parse(Me)||[]}catch{}else Ye=[Me];const st=new Set(Ye);ve.forEach(Xt=>st.add(Xt.playerId));const xt=Array.from(st);localStorage.setItem(fe,JSON.stringify(xt))}}).catch(()=>{})}catch{}const N=localStorage.getItem(`startPlayerTour:${o.value}`);!m&&N&&(Yt.value=1,localStorage.removeItem(`startPlayerTour:${o.value}`),Ht(()=>{const ee=document.querySelector('button[data-onboarding="add-player"]');if(ee){ee.scrollIntoView({behavior:"smooth",block:"end"});const ae=ee.getBoundingClientRect(),ve=document.getElementById("coachmark-add"),fe=280,Me=100,Ye=(ve==null?void 0:ve.offsetWidth)||fe,st=(ve==null?void 0:ve.offsetHeight)||Me,xt=Math.round(ae.right+12);if(xt+Ye<=window.innerWidth-12){const un=ae.top+ae.height/2-st/2,cn=-14,It=12,yr=window.innerHeight-st-12,Lr=Math.max(It,Math.min(Math.round(un+cn),yr));L.value={position:{x:xt,y:Lr},side:"right"}}else{const un=Math.round(ae.left+ae.width/2-Ye/2),cn=Math.round(ae.top-st-8),It=8,yr=window.innerWidth-Ye-8;L.value={position:{x:Math.max(It,Math.min(un,yr)),y:cn},side:null}}}}))}catch{}}const jn=P(!1),Dn=P(null),hs=P(null),Nr=P(!1),ro=P(null),fs=P(!1),so=P(null),ps=P(!1),ms=P(!1),_n=P(!1),io=P(!1),gs=P(!1),vs=P(!1),Vc=P(null);function ff(){ms.value=!0}function Kr(){ms.value=!1}function pf(){gs.value=!0}function mf(){gs.value=!1}function aa(){vs.value=!0}function Oc(){vs.value=!1}function la(){try{const _=Ge==null?void 0:Ge.currentUser;if(!_||_.isAnonymous){let m=null;if(Yr.value&&Yr.value.size>0){const N=Yr.value.values().next().value;m=rt.value.find(ee=>ee.id===N)||null}m||(m=rt.value[0]||null),io.value=!0,m&&(Vc.value=m);return}}catch{}ms.value=!0}async function ua(){var _;try{const m=(_=Ge==null?void 0:Ge.currentUser)==null?void 0:_.email;if(!m)return;const{resetPlayerPassword:N}=await en(()=>Promise.resolve().then(()=>Mi),void 0);await N(m),Ue.value=!0,vt.value="Email de réinitialisation envoyé.",setTimeout(()=>{Ue.value=!1},3e3)}catch{mr.value=!0,oi.value="Impossible d'envoyer l'email de réinitialisation.",setTimeout(()=>{mr.value=!1},3e3)}}async function Vr(){try{await nV(Ge),Kr(),Ue.value=!0,vt.value="Déconnecté de cet appareil.",setTimeout(()=>{Ue.value=!1},2500)}catch{mr.value=!0,oi.value="Déconnexion impossible.",setTimeout(()=>{mr.value=!1},3e3)}}async function Mc(){alert("Suppression de compte: contactez l'organisateur pour dissocier vos joueurs. Fonction complète à venir.")}async function Ol(_){var m;Kr();try{if(_.seasonId&&_.seasonId!==o.value){const N=Pe(le,"seasons",_.seasonId),ae=(await Pt(et(le,"seasons"))).docs.find(fe=>fe.id===_.seasonId),ve=(m=ae==null?void 0:ae.data())==null?void 0:m.slug;if(ve){t.push(`/season/${ve}?player=${encodeURIComponent(_.playerId)}&open=protection`);return}}else{const N=rt.value.find(ee=>ee.id===_.playerId);if(N){_f(N);return}t.push(`?player=${encodeURIComponent(_.playerId)}&open=protection`)}}catch{}}yn(()=>{try{o.value&&localStorage.getItem(`dismissCreatorOnboarding:${o.value}`)&&(onboardingDismissedShare.value=!0)}catch{}const _=()=>{l.value=window.scrollY>10};return window.addEventListener("scroll",_,{passive:!0}),document.addEventListener("click",m=>{if(_e.value){const N=Ie.value,ee=ye.value,ae=N&&N.contains(m.target),ve=ee&&ee.contains(m.target);!ae&&!ve&&(_e.value=!1)}if(be.value){const N=Ce.value;N&&N.contains(m.target)||(be.value=!1)}}),document.addEventListener("keydown",m=>{m.key==="Escape"&&(_e.value&&(_e.value=!1),be.value&&(be.value=!1))}),window.addEventListener("resize",()=>{_e.value&&he(),be.value&&ke()}),window.addEventListener("scroll",()=>{_e.value&&he(),be.value&&ke()},{passive:!0}),()=>{window.removeEventListener("scroll",_)}});function Ml(){Ht(()=>{Fl()})}const Ar=P(new Set),Gr=P(!0),Or=P(0),ti=P("Préparation de la grille"),fr=P(e.eventId||null),Ll=P(!1),ni=P(null);bt(()=>e.eventId,_=>{if(_)if(fr.value=_,Ke.value.length>0)gv(_);else{const m=bt(Ke,N=>{N.length>0&&(gv(_),m())},{immediate:!0})}});const Mr=Fe(()=>rt.value.map(_=>({..._,isProtected:Ar.value.has(_.id),email:null}))),ys=Fe(()=>fr.value?ln.value.findIndex(_=>_.id===fr.value):-1);Fe(()=>{if(!fr.value||ys.value===-1)return!1;if(window.innerWidth<=768){const _=document.querySelector(`[data-event-id="${fr.value}"]`);if(_){const m=_.getBoundingClientRect();return m.left>=0&&m.right<=window.innerWidth}}return!0});const nr=P(null),Lc=P(!1),$l=P(!1),ca=P(0),$c=P(null),Nn=P(null),ri=P(null);function pr(){const _=nr.value;if(!_)return;const{scrollLeft:m,scrollWidth:N,clientWidth:ee}=_;Lc.value=m>2,$l.value=m<N-ee-2}function Fl(){var _;try{pr(),ca.value=((_=nr.value)==null?void 0:_.scrollLeft)||0}catch{}}function Fc(_){const m=nr.value;if(!m)return;let N=0;const ee=m.querySelector("tbody tr td[data-event-id]");if(ee)N=ee.getBoundingClientRect().width;else if(Nn!=null&&Nn.value){const ve=Nn.value.querySelector(".col-event");ve&&(N=ve.getBoundingClientRect().width)}(!N||!isFinite(N))&&(N=m.clientWidth*.6);const ae=m.scrollLeft+_*N;m.scrollTo({left:ae,behavior:"smooth"})}const oo=P(null);P(0);const si=P(!1),ao=P(!1),ii=P(0);function Hr(_,m){m&&typeof m.preventDefault=="function"&&m.preventDefault(),sr(),Fc(_)}function rr(_,m){if(m&&typeof m.preventDefault=="function"&&m.preventDefault(),si.value)return;si.value=!0,ii.value=_,ao.value=!1;const N=nr.value;if(!N)return;let ee=0;const ae=N.querySelector("tbody tr td[data-event-id]");if(ae)ee=ae.getBoundingClientRect().width;else if(Nn!=null&&Nn.value){const Ye=Nn.value.querySelector(".col-event");Ye&&(ee=Ye.getBoundingClientRect().width)}(!ee||!isFinite(ee))&&(ee=N.clientWidth*.6);const ve=ee/6,fe=120,Me=()=>{if(!si.value||ii.value===0)return;ao.value||(ao.value=!0);const Ye=N.scrollLeft+ii.value*ve;N.scrollTo({left:Ye,behavior:"auto"}),oo.value=window.setTimeout(Me,fe)};oo.value=window.setTimeout(Me,250)}function sr(_){_&&typeof _.preventDefault=="function"&&_.preventDefault();const m=si.value,N=ao.value;if(si.value=!1,oo.value&&(clearTimeout(oo.value),oo.value=null),_&&typeof _.type=="string"&&_.type.startsWith("touch")&&!N){const ee=ii.value||0;ee!==0&&Fc(ee),ii.value=0;return}ii.value=0,m&&N&&da()}function da(){const _=nr.value;if(!_)return;let m=0;const N=_.querySelector("tbody tr td[data-event-id]");if(N)m=N.getBoundingClientRect().width;else if(Nn!=null&&Nn.value){const fe=Nn.value.querySelector(".col-event");fe&&(m=fe.getBoundingClientRect().width)}if(!m||!isFinite(m)||m<=0)return;const ee=_.scrollLeft,ve=Math.round(ee/m)*m;_.scrollTo({left:ve,behavior:"smooth"})}function Uc(_){$.value=_;const m=document.querySelector(`[data-player-id="${_}"]`);m&&m.scrollIntoView({behavior:"smooth",block:"center"}),Ue.value=!0,vt.value="Nouveau joueur ajouté !",setTimeout(()=>{Ue.value=!1},3e3)}function kt(){if(Yt.value!==1)return;const _=document.querySelector('button[data-onboarding="add-player"]');if(!_)return;const m=_.getBoundingClientRect(),N=document.getElementById("coachmark-add"),ee=280,ae=100,ve=N!=null&&N.offsetWidth&&N.offsetWidth>0?N.offsetWidth:ee,fe=N!=null&&N.offsetHeight&&N.offsetHeight>0?N.offsetHeight:ae,Me=Math.round(m.right+12);if(Me+ve<=window.innerWidth-12){const st=m.top+m.height/2-fe/2,Xt=lo(st+-14,fe);L.value={position:{x:Me,y:Xt},side:"right"}}else{const st=Math.round(m.left+m.width/2-ve/2),xt=lo(m.top-fe-8,fe),Xt=8,un=window.innerWidth-ve-8;L.value={position:{x:Math.max(Xt,Math.min(st,un)),y:xt},side:null}}}function lo(_,m){const N=pageHeaderRef==null?void 0:pageHeaderRef.value,ee=N?Math.max(0,Math.round(N.getBoundingClientRect().height||0)):0,ae=Math.max(12,ee+8),ve=window.innerHeight-m-12;return Math.max(ae,Math.min(Math.round(_),ve))}function Wr(){var _;Yt.value===1&&((_=L.value)!=null&&_.position)&&kt()}yn(()=>{window.addEventListener("scroll",Wr,{passive:!0}),window.addEventListener("resize",Wr)}),Vi(()=>{window.removeEventListener("scroll",Wr),window.removeEventListener("resize",Wr)});function Qr(_){return Ar.value.has(_)}async function Ul(){if(o.value)try{const _=await Zp(o.value),m=new Set;_.forEach(N=>{N.isProtected&&m.add(N.playerId||N.id)}),Ar.value=m}catch{const m=new Set;for(const N of rt.value)await Li(N.id,o.value)&&m.add(N.id);Ar.value=m}}const Ue=P(!1),vt=P(""),mr=P(!1),oi=P("");function gf(){try{const _=`${window.location.origin}/season/${s}`;navigator.clipboard.writeText(_),Ue.value=!0,vt.value="Lien copié dans le presse-papiers",setTimeout(()=>{Ue.value=!1},2500)}catch{mr.value=!0,oi.value="Impossible de copier le lien",setTimeout(()=>{mr.value=!1},2500)}}async function ai(_){await w({type:"deleteEvent",data:{eventId:_}})}async function Jr(_=null){const m=_||h.value;if(console.debug("deleteEventConfirmed"),!m){console.error("Aucun événement à supprimer");return}try{await D3(m,o.value),Ke.value=Ke.value.filter(N=>N.id!==m),await Promise.all([dh(o.value),Ao(rt.value,Ke.value,o.value),So(o.value)]).then(([N,ee,ae])=>{Ke.value=N,Gt.value=ee,Be.value=ae}),c.value=!1,h.value=null,Ue.value=!0,vt.value="Événement supprimé avec succès !",setTimeout(()=>{Ue.value=!1},3e3)}catch{console.error("Erreur lors de la suppression de l'événement"),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function jc(){c.value=!1,h.value=null}async function ha(){if(!f.value||!g.value.trim()||!y.value)return;const _=parseInt(I.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}try{const m={title:g.value.trim(),date:y.value,description:ne.value.trim()||"",playerCount:_,archived:!!de.value};await A_(f.value,m,o.value),!m.archived&&rt.value.length>0&&Ar.value.size>0&&(so.value={id:f.value,...m},fs.value=!0),await Promise.all([dh(o.value),Ao(rt.value,Ke.value,o.value),So(o.value)]).then(([N,ee,ae])=>{Ke.value=N,Gt.value=ee,Be.value=ae}),f.value=null,g.value="",y.value="",ne.value="",I.value=6,de.value=!1,Ue.value=!0,vt.value="Événement mis à jour avec succès !",setTimeout(()=>{Ue.value=!1},3e3)}catch{console.error("Erreur lors de l'édition de l'événement"),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function qc(){if(S.value.trim())try{const _=S.value.trim(),m=await ET(_,o.value);await Promise.all([Cu(o.value),Ao(rt.value,Ke.value,o.value),So(o.value)]).then(([N,ee,ae])=>{rt.value=N,Gt.value=ee,Be.value=ae,Ul();const ve=rt.value.find(Me=>Me.id===m);Uc(m),U.value=m,M.value=ln.value&&ln.value[0]&&ln.value[0].id?ln.value[0].id:null;try{o.value&&localStorage.setItem(`lastAddedPlayerId:${o.value}`,m)}catch{}try{typeof Yt<"u"&&(Yt.value=2)}catch{}const fe=document.querySelector(`[data-player-id="${m}"]`);fe&&fe.scrollIntoView({behavior:"smooth",block:"center"}),Ht(()=>{const Me=`[data-player-id="${U.value}"] td[data-event-id="${M.value}"]`,Ye=document.querySelector(Me);if(Ye){const st=Ye.getBoundingClientRect();se.value.position={x:Math.round(st.left),y:Math.round(st.top+window.scrollY-48)}}}),Ue.value=!0,vt.value="Joueur ajouté avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{Ue.value=!1},3e3),setTimeout(()=>{Ue.value=!1,vt.value=""},5e3)}),A.value=!1,S.value=""}catch{console.error("Erreur lors de l'ajout du joueur"),alert("Erreur lors de l'ajout du joueur. Veuillez réessayer.")}}function Sr(){f.value=null,g.value="",y.value="",ne.value="",I.value=6}P(null);const fa=P(!1),li=P(""),ui=P(""),ir=P(""),uo=P(6),pa=P(!1);async function ma(){if(!li.value.trim()||!ui.value){alert("Veuillez remplir le titre et la date de l'événement");return}const _=parseInt(uo.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}const m={title:li.value.trim(),date:ui.value,description:ir.value.trim()||"",playerCount:_,archived:!!pa.value};await ga(m)}async function ga(_){try{const m=await N3(_,o.value);Ke.value=[...Ke.value,{id:m,..._}];const N={};for(const ee of rt.value)N[ee.name]=Gt.value[ee.name]||{},N[ee.name][m]=null,await T_(ee.name,N[ee.name],o.value);li.value="",ui.value="",ir.value="",uo.value=6,pa.value=!1,fa.value=!1,await Promise.resolve(),Ue.value=!0,vt.value="Événement créé avec succès !",!_.archived&&rt.value.length>0&&Ar.value.size>0&&(so.value={id:m,..._},fs.value=!0),setTimeout(()=>{Ue.value=!1},3e3)}catch{console.error("Erreur lors de la création de l'événement"),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function Bc(){li.value="",ui.value="",ir.value="",uo.value=6,fa.value=!1}async function ci(){await w({type:"addEvent",data:{}})}const Ke=P([]),rt=P([]),Gt=P({}),Be=P({}),vf=P({}),jl=P({});bt([()=>Ke.value.length,()=>rt.value.length,Gr],()=>{Gr.value||Ht(()=>{Fl()})}),bt([()=>rt.value.length,()=>Ke.value.length,o],()=>{oa()}),yn(async()=>{try{ov("firebase"),await IT();const m=Zu(et(le,"seasons"),nh("slug","==",e.slug)),N=await Pt(m);if(N.empty){t.push("/seasons");return}else{const fe=N.docs[0];o.value=fe.id;const Me=fe.data();i.value=Me.name,a.value=Me,document.title=`Saison : ${i.value}`,zO(e.slug)}if(o.value){ti.value="Chargement des événements de la saison",Or.value=20;const fe=await Pt(et(le,"seasons",o.value,"events"));Ke.value=fe.docs.map(It=>({id:It.id,...It.data(),playerCount:It.data().playerCount||6})),ti.value="Chargement des joueurs",Or.value=45;const Me=await Pt(et(le,"seasons",o.value,"players"));rt.value=Me.docs.map(It=>({id:It.id,...It.data()})),ti.value="Chargement des disponibilités",Or.value=70;const Ye=await Pt(et(le,"seasons",o.value,"availability")),st={};Ye.docs.forEach(It=>{const yr=It.data(),Lr={};Object.keys(yr).forEach(_o=>{const xa=yr[_o];Lr[_o]=xa==="oui"?!0:xa==="non"?!1:xa}),st[It.id]=Lr}),Gt.value=st,ti.value="Chargement des sélections",Or.value=85;const xt=await Pt(et(le,"seasons",o.value,"selections")),Xt={};xt.docs.forEach(It=>{Xt[It.id]=It.data().players||[]}),Be.value=Xt;const un=await Zp(o.value),cn=new Set;Array.isArray(un)&&un.forEach(It=>{It.isProtected&&cn.add(It.playerId||It.id)}),Ar.value=cn}const ee=fe=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>fe()):setTimeout(fe,0)};ti.value="Préparation de l'interface",Or.value=95,ee(()=>{Hl(),ba()}),console.debug("players (deduplicated)"),console.debug("availability loaded"),await Ht(),Or.value=100,Gr.value=!1,Ht(()=>{pr(),requestAnimationFrame(()=>pr()),setTimeout(()=>pr(),250);const fe=nr.value;fe&&(fe.addEventListener("scroll",Me=>{pr(),ca.value=fe.scrollLeft||0},{passive:!0}),window.addEventListener("resize",pr),typeof ResizeObserver<"u"&&(ri.value=new ResizeObserver(()=>{pr()}),ri.value.observe(fe)))});const ae=r.query.event;if(ae&&Ke.value.length>0){const fe=Ke.value.find(Me=>Me.id===ae);fe?(console.debug("Événement trouvé depuis l'URL"),await xf(ae,fe)):(console.warn("Événement non trouvé avec l'ID"),mr.value=!0,oi.value="Événement non trouvé",setTimeout(()=>{mr.value=!1},3e3))}const ve=r.query.player;if(ve&&rt.value.length>0){const fe=rt.value.find(Me=>Me.id===ve);fe&&(_f(fe),await Ht(),r.query.verified==="1"&&(Ue.value=!0,vt.value="Joueur associé à votre compte.",setTimeout(()=>{Ue.value=!1},2500)))}}catch(_){console.error("Erreur lors du chargement de la grille:",_),mr.value=!0,oi.value="Erreur lors du chargement des données",setTimeout(()=>{mr.value=!1},5e3),Gr.value=!1}}),bt(()=>r.params.eventId,_=>{if(_){const m=()=>{const N=Ke.value.find(ee=>ee.id===_);return N?(lv(N),!0):!1};if(Ke.value.length>0)m();else{const N=bt(Ke,ee=>{ee.length>0&&m()&&N()},{immediate:!0})}}},{immediate:!0});function ql(_){if(!_)return null;if(_ instanceof Date)return _;if(typeof(_==null?void 0:_.toDate)=="function")return _.toDate();if(typeof _=="string"||typeof _=="number"){const m=new Date(_);return isNaN(m.getTime())?null:m}return null}const _s=Fe(()=>{let _=null;try{o.value&&(_=localStorage.getItem(`seasonPreferredPlayer:${o.value}`))}catch{}const m=[...rt.value].sort((fe,Me)=>(fe.name||"").localeCompare(Me.name||"","fr",{sensitivity:"base"}));if(!_)return m;let N=[];try{_.startsWith("[")?N=JSON.parse(_):_&&(N=[_])}catch{N=[]}const ee=new Set(N);if(ee.size===0)return m;const ae=m.filter(fe=>ee.has(fe.id)),ve=m.filter(fe=>!ee.has(fe.id));return[...ae,...ve]}),Yr=Fe(()=>{try{if(o.value){const _=localStorage.getItem(`seasonPreferredPlayer:${o.value}`);if(!_)return new Set;if(_.startsWith("[")){const m=JSON.parse(_);return new Set(Array.isArray(m)?m:[])}return new Set([_])}}catch{}return new Set}),va=Fe(()=>[...Ke.value].sort((_,m)=>{const N=ql(_.date),ee=ql(m.date),ae=N?N.getTime():Number.POSITIVE_INFINITY,ve=ee?ee.getTime():Number.POSITIVE_INFINITY;return ae!==ve?ae-ve:(_.title||"").localeCompare(m.title||"","fr",{sensitivity:"base"})})),bs=P(!1),ln=Fe(()=>{const _=va.value;return bs.value?_:_.filter(m=>!m.archived)});function zc(){bs.value=!bs.value}const Bl=P("selected"),co=Fe(()=>{var N;if(!H.value)return _s.value;const _=H.value.id,m=new Set(((N=Be.value)==null?void 0:N[_])||[]);return _s.value.filter(ee=>{var Me;const ae=ee.name,ve=(Me=Gt.value[ae])==null?void 0:Me[_],fe=m.has(ae);switch(Bl.value){case"selected":return fe;case"available":return ve===!0&&!fe;case"unavailable":return ve===!1;case"unknown":return ve!==!0&&ve!==!1;case"all":default:return!0}})}),Kc=Fe(()=>H.value?vo(H.value.id):null),zl=Fe(()=>{if(!H.value)return!1;const _=vo(H.value.id);return _.type==="incomplete"||_.type==="insufficient"}),ho=Fe(()=>H.value?Ql(H.value.id):"");async function fo(_,m){const N=rt.value.find(ve=>ve.name===_);if(!N){console.error("Joueur non trouvé");return}const ee=Ke.value.find(ve=>ve.id===m);if(!ee){console.error("Événement non trouvé");return}if(ee.archived){Ue.value=!0,vt.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Ue.value=!1},3e3);return}if(Qr(N.id)){const ve=Fo(N.id),fe=Tr.value===N.id;console.debug("Joueur protégé:",{playerId:N.id,hasCachedPassword:ve,wasRecentlyVerified:fe,recentlyVerifiedPlayer:Tr.value}),ve||fe?(console.debug("Session active ou joueur récemment vérifié, procéder au toggle"),fe&&(console.debug("Nettoyage du flag recentlyVerifiedPlayer"),Tr.value=null),di(N,m)):(console.debug("Pas de session, affichage de la modal de vérification"),Un.value={playerName:_,eventId:m},qt.value=N,Mt.value=!0);return}di(N,m)}function di(_,m){var ae,ve,fe;const N=(ae=Gt.value[_.name])==null?void 0:ae[m];console.debug("toggleAvailability");let ee;N===!0?ee=!1:N===!1?ee=void 0:ee=!0,ee===void 0?Gt.value[_.name]&&delete Gt.value[_.name][m]:(Gt.value[_.name]||(Gt.value[_.name]={}),Gt.value[_.name][m]=ee);try{typeof Yt<"u"&&Yt.value===1&&_.id===(U.value||((ve=_s.value[0])==null?void 0:ve.id))&&m===(M.value||((fe=ln.value[0])==null?void 0:fe.id))&&(Yt.value=3,Ht(()=>{const Ye=document.querySelector(`[data-player-id="${_.id}"]`);if(Ye){const st=Ye.querySelector(".player-name");if(st){const xt=st.getBoundingClientRect();Q.value.position={x:Math.round(xt.right+8),y:Math.round(xt.top+window.scrollY-4)}}}}),Vi(()=>{try{window.removeEventListener("resize",pr)}catch{}try{ri.value&&ri.value.disconnect()}catch{}}))}catch{}T_(_.name,Gt.value[_.name],o.value).then(async()=>{await Ht(),ba(),Ue.value=!0,vt.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{Ue.value=!1},3e3)}).catch(Me=>{console.error("Erreur lors de la mise à jour de la disponibilité"),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}function or(_,m){var N;return(N=Gt.value[_])==null?void 0:N[m]}function Gc(_,m){var ae;const N=Be.value[m]||[],ee=(ae=Gt.value[_])==null?void 0:ae[m];return N.includes(_)&&ee===!0}async function po(_,m=6){const N=Ke.value.find(fe=>fe.id===_),ee=(N==null?void 0:N.playerCount)||6,ae=Be.value[_]||[];if(ae.length>0&&ae.every(fe=>or(fe,_))){console.debug("Tous les joueurs sélectionnés sont disponibles, nouveau tirage complet");const Me=rt.value.filter(xt=>or(xt.name,_)).map(xt=>{const Xt=ws(xt.name);return{name:xt.name,weight:1/(1+Xt)}}),Ye=[],st=[...Me];for(;Ye.length<ee&&st.length>0;){const xt=st.reduce((cn,It)=>cn+It.weight,0);let Xt=Math.random()*xt;const un=st.findIndex(cn=>(Xt-=cn.weight,Xt<=0));un>=0&&(Ye.push(st[un].name),st.splice(un,1))}Be.value[_]=Ye}else{const fe=ae.filter(Ye=>or(Ye,_)),Me=ee-fe.length;if(Me<=0)Be.value[_]=fe;else{const Ye=new Set(fe),xt=rt.value.filter(cn=>or(cn.name,_)&&!Ye.has(cn.name)).map(cn=>{const It=ws(cn.name);return{name:cn.name,weight:1/(1+It)}}),Xt=[],un=[...xt];for(;Xt.length<Me&&un.length>0;){const cn=un.reduce((Lr,_o)=>Lr+_o.weight,0);let It=Math.random()*cn;const yr=un.findIndex(Lr=>(It-=Lr.weight,It<=0));yr>=0&&(Xt.push(un[yr].name),un.splice(yr,1))}Be.value[_]=[...fe,...Xt]}}await nm(_,Be.value[_],o.value),Hl(),ba()}async function Kl(_,m=6){var fe,Me;console.debug("tirerProtected appelé"),console.debug("etat modal selection avant");const N=jn.value,ee=(fe=Dn.value)==null?void 0:fe.id,ae=Be.value[_]&&Be.value[_].length>0,ve=ae?[...Be.value[_]]:[];if(await po(_,m),console.debug("etat modal selection apres"),N&&!jn.value&&(console.debug("Restauration de la popin de sélection..."),jn.value=!0,Dn.value=Ke.value.find(Ye=>Ye.id===ee)),jn.value&&((Me=Dn.value)==null?void 0:Me.id)===_)if(console.debug("Popin de sélection ouverte, mise à jour..."),await Ht(),hs.value&&hs.value.showSuccess){console.debug("Appel de showSuccess sur la popin de sélection");const Ye=Be.value[_]||[],st=ve.filter(Xt=>Ye.includes(Xt)),xt=st.length>0&&st.length<ve.length;hs.value.showSuccess(ae,xt)}else console.debug("showSuccess indisponible");else console.debug("Popin de sélection fermée, affichage message global"),Ue.value=!0,Ke.value.find(Ye=>Ye.id===_),Be.value[_],ae?vt.value="Sélection mise à jour avec succès !":vt.value="Sélection effectuée avec succès !",setTimeout(()=>{Ue.value=!1},3e3)}function ya(_){_===0?L.value.position=null:_===1?se.value.position=null:_===2&&(Q.value.position=null)}function Gl(_){var N;return _?(typeof _=="string"?new Date(_):((N=_.toDate)==null?void 0:N.call(_))||_).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function _a(_){var N;return _?(typeof _=="string"?new Date(_):((N=_.toDate)==null?void 0:N.call(_))||_).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function ws(_){return Object.values(Be.value).filter(m=>m.includes(_)).length}function hi(_){const m=Gt.value[_]||{};return Object.values(m).filter(N=>N===!0).length}function mo(_){return _?Object.values(Gt.value).filter(m=>m[_]===!0).length:0}function go(_){return _?(Be.value[_]||[]).length:0}function Xr(_){const m=Ke.value.find(ee=>ee.id===_),N=(m==null?void 0:m.playerCount)||6;return go(_)>=N}function Hc(_){const m=hi(_),N=ws(_);return m===0?0:N/m}function Wc(_){vf.value[_]={availability:hi(_),selection:ws(_),ratio:Hc(_)}}function Hl(){rt.value.forEach(_=>Wc(_.name))}function ba(){const _={};Ke.value.forEach(m=>{const N=m.playerCount||6,ae=rt.value.filter(fe=>or(fe.name,m.id)===!0).map(fe=>{const Me=ws(fe.name);return{name:fe.name,weight:1/(1+Me)}}),ve=ae.reduce((fe,Me)=>fe+Me.weight,0);ae.forEach(fe=>{const Me=Math.min(1,fe.weight/ve*N);_[fe.name]||(_[fe.name]={}),_[fe.name][m.id]=Math.round(Me*100)})}),jl.value=_}const xs=P(null),In=P(!1);async function Qc(_=null){const m=_||xs.value;if(!m){console.error("Aucun joueur à supprimer");return}try{await R3(m,o.value),rt.value=rt.value.filter(N=>N.id!==m),In.value=!1,xs.value=null,Ue.value=!0,vt.value="Joueur supprimé avec succès !",setTimeout(()=>{Ue.value=!1},3e3)}catch{console.error("Erreur lors de la suppression du joueur"),alert("Erreur lors de la suppression du joueur. Veuillez réessayer.")}}function Jc(){In.value=!1,xs.value=null}async function fi(_){hv(),await Li(_,o.value)?await q({type:"deletePlayer",data:{playerId:_}}):await w({type:"deletePlayer",data:{playerId:_}})}async function u(){if(b.value){const _=Ke.value.find(N=>N.id===b.value),m=(_==null?void 0:_.playerCount)||6;await Kl(b.value,m),x.value=!1,b.value=null}}function p(){x.value=!1,b.value=null}function v(){return R.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis",toggleArchive:"Archivage d'événement - Code PIN requis",updateSelection:"Mise à jour de sélection - Code PIN requis"}[R.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function w(_){if(Vn.isPinCached(o.value)){const m=Vn.getCachedPin(o.value);if(console.debug("PIN en cache trouvé, utilisation automatique"),await ah(o.value,m)){await vr(_);return}else Vn.clearSession()}R.value=_,F.value=!0}async function q(_){const m=_.data.playerId;try{if(Vn.isPinCached(o.value)){console.debug("PIN de saison en cache — saut de la demande de mot de passe joueur"),await vr(_);return}}catch{}if(Fo(m)){console.debug("Mot de passe du joueur en cache trouvé, utilisation automatique"),await vr(_);return}we.value=_,mt.value=!0}async function X(_){try{if(await ah(o.value,_)){Vn.saveSession(o.value,_),F.value=!1;const N=R.value;R.value=null,await vr(N)}else pt.value="Code PIN incorrect",setTimeout(()=>{pt.value=""},3e3)}catch{console.error("Erreur lors de la vérification du PIN"),pt.value="Erreur lors de la vérification du code PIN"}}function Se(){F.value=!1,R.value=null,pt.value=""}async function wt(_){if(_){oe.value=!0,re.value="";try{const m=we.value.data.playerId,N=await Wp(o.value);if(_===N){try{Vn.saveSession(o.value,_)}catch{}try{Wi.saveSession(we.value.data.playerId)}catch{}mt.value=!1;const ae=we.value;we.value=null,ue.value="",await vr(ae);return}if(await verifyPlayerPassword(m,_,o.value)){mt.value=!1;const ae=we.value;we.value=null,ue.value="",await vr(ae)}else re.value="Mot de passe incorrect",setTimeout(()=>{re.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),re.value="Erreur lors de la vérification du mot de passe"}finally{oe.value=!1}}}function bn(){mt.value=!1,we.value=null,re.value="",ue.value="",oe.value=!1}async function yt(_){if(_){at.value=!0,Te.value="";try{const m=Y.value.data.player,N=await Wp(o.value);if(_===N){try{Vn.saveSession(o.value,_)}catch{}try{Wi.saveSession(Y.value.data.player.id)}catch{}te.value=!1;const ae=Y.value;Y.value=null,We.value="",await vr(ae);return}if(await verifyPlayerPassword(m.id,_,o.value)){te.value=!1;const ae=Y.value;Y.value=null,We.value="",await vr(ae)}else Te.value="Mot de passe incorrect",setTimeout(()=>{Te.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),Te.value="Erreur lors de la vérification du mot de passe"}finally{at.value=!1}}}function En(){te.value=!1,Y.value=null,Te.value="",We.value="",at.value=!1}async function Tn(){Ae.value=!0,xe.value="",Ve.value="";try{const _=Y.value.data.player,m=await sendPasswordResetEmail(_.id,o.value);Ve.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),xe.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{Ae.value=!1}}async function pi(){lt.value=!0,T.value="",k.value="";try{const _=we.value.data.playerId,m=await sendPasswordResetEmail(_,o.value);k.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),T.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{lt.value=!1}}function gr(){return Vn.isPinCached(o.value)?{timeRemaining:Vn.getTimeRemaining(),isExpiringSoon:Vn.isExpiringSoon()}:null}async function vr(_){var ee;if(!_)return;const{type:m,data:N}=_;try{switch(m){case"deleteEvent":console.debug("executePendingOperation - data.eventId reçu"),h.value=N.eventId,c.value=!0;break;case"addEvent":fa.value=!0;break;case"deletePlayer":xs.value=N.playerId,In.value=!0;break;case"launchSelection":Be.value[N.eventId]&&Be.value[N.eventId].length>0?(b.value=N.eventId,x.value=!0,G.value=!1):(await Kl(N.eventId,N.count),G.value=!1);break;case"toggleAvailability":di(N.player,N.eventId);break;case"toggleArchive":await setEventArchived(N.eventId,N.archived,o.value);{const ae=Ke.value.findIndex(ve=>ve.id===N.eventId);ae!==-1&&(Ke.value[ae]={...Ke.value[ae],archived:!!N.archived}),de.value=!!N.archived}break;case"updateSelection":{const{eventId:ae,players:ve}=N,fe=[...Be.value[ae]||[]],Me=Array.isArray(ve)?ve:[];await nm(ae,Me,o.value),Be.value[ae]=Me;try{const Ye=fe.filter(st=>!Me.includes(st));if(Ye.length>0){const st=Ke.value.find(xt=>xt.id===ae);await kM({eventId:ae,eventData:st,removedPlayers:Ye,newSelectedPlayers:Me,seasonId:o.value,seasonSlug:s,players:Mr.value})}}catch{}try{(ee=hs.value)==null||ee.showSuccess(!0,!0)}catch{}}break}}catch{console.error("Erreur lors de l'exécution de l'opération"),Ue.value=!0,vt.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{Ue.value=!1},3e3)}}function Wl(){t.push("/seasons")}Vi(()=>{const _=nr.value;_&&_.removeEventListener("scroll",pr),window.removeEventListener("resize",pr)});async function lv(_){H.value=_,ne.value=_.description||"",de.value=!!_.archived;try{const[m,N]=await Promise.all([Ao(rt.value,Ke.value,o.value),So(o.value)]);Gt.value=m,Be.value=N}catch(m){console.warn("Impossible de rafraîchir les données avant ouverture des détails:",m)}G.value=!0}function yf(){G.value=!1,H.value=null,ne.value="",be.value=!1,_e.value=!1,Ot(),Er(),$e.value={position:"fixed",top:"0px",left:"0px"},B.value={position:"fixed",top:"0px",left:"0px"}}function wa(_,m=null){const N=m||H.value;if(N)try{C$(_,N,i.value),Ue.value=!0,_==="ics"?vt.value="Fichier .ics téléchargé ! Importez-le dans votre agenda":_==="google"?vt.value="Google Calendar ouvert dans un nouvel onglet":_==="outlook"&&(vt.value="Outlook ouvert dans un nouvel onglet"),setTimeout(()=>{Ue.value=!1},3e3)}catch(ee){console.error("Erreur lors de l'ajout au calendrier:",ee),Ue.value=!0,vt.value="Erreur lors de l'ajout au calendrier",setTimeout(()=>{Ue.value=!1},3e3)}}function uv(){yf(),r.params.eventId&&t.push(`/season/${e.slug}`)}async function PT(_,m){console.debug("handleAvailabilityToggle appelé");const N=rt.value.find(ve=>ve.name===_);if(!N){console.error("Joueur non trouvé");return}const ee=Ke.value.find(ve=>ve.id===m);if(ee!=null&&ee.archived){Ue.value=!0,vt.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Ue.value=!1},3e3);return}console.debug("Joueur trouvé");const ae=Qr(N.id);if(console.debug("Joueur protégé"),ae){Fo(N.id)?(console.debug("Session active, procéder au toggle"),await fo(_,m)):(console.debug("Demande du mot de passe pour joueur protégé"),Un.value={playerName:_,eventId:m},qt.value=N,Mt.value=!0);return}console.debug("Joueur non protégé, procéder au toggle"),await fo(_,m)}function RT(_,m){return(Be.value[m]||[]).includes(_)}async function CT(_){if(console.debug("Mot de passe vérifié"),qt.value&&(Tr.value=qt.value.id,console.debug("Joueur marqué comme récemment vérifié")),Un.value){const{playerName:m,eventId:N}=Un.value;console.debug("Exécution de l'action en attente"),await fo(m,N),Un.value=null}else console.debug("Aucune action en attente trouvée");Mt.value=!1,qt.value=null}function cv(){f.value=H.value.id,g.value=H.value.title,y.value=H.value.date,ne.value=H.value.description||"",I.value=H.value.playerCount||6,G.value=!1}async function dv(){if(H.value)try{const _=!H.value.archived,m={...H.value,archived:_};await A_(H.value.id,m,o.value),H.value.archived=_;const N=Ke.value.findIndex(ee=>ee.id===H.value.id);N!==-1&&(Ke.value[N].archived=_),Ue.value=!0,vt.value=_?"Événement archivé avec succès !":"Événement désarchivé avec succès !",setTimeout(()=>{Ue.value=!1},3e3)}catch{console.error("Erreur lors de la modification de l'archivage"),alert("Erreur lors de la modification de l'archivage. Veuillez réessayer.")}}function _f(_){C.value=_,E.value=!0;try{typeof Yt<"u"&&Yt.value}catch{}}function hv(){E.value=!1,C.value=null}async function kT({playerId:_,newName:m}){try{await C3(_,m,o.value),await Promise.all([Cu(o.value),Ao(rt.value,Ke.value,o.value),So(o.value)]).then(([N,ee,ae])=>{if(rt.value=N,Gt.value=ee,Be.value=ae,Ul(),C.value&&C.value.id===_){const ve=N.find(fe=>fe.id===_);ve&&(C.value=ve)}}),Ue.value=!0,vt.value="Joueur mis à jour avec succès !",setTimeout(()=>{Ue.value=!1},3e3)}catch{console.error("Erreur lors de l'édition du joueur"),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function DT(){try{await Promise.all([Cu(o.value),Ao(rt.value,Ke.value,o.value),So(o.value)]).then(([_,m,N])=>{if(rt.value=_,Gt.value=m,Be.value=N,Ul(),C.value){const ee=_.find(ae=>ae.id===C.value.id);ee&&(C.value=ee)}}),Ue.value=!0,vt.value="Données mises à jour !",setTimeout(()=>{Ue.value=!1},3e3)}catch{console.error("Erreur lors du rafraîchissement")}}function NT(_){if(!_)return{availability:0,selection:0,ratio:0};const m=hi(_.name),N=ws(_.name),ee=m===0?0:Math.round(N/m*100);return{availability:m,selection:N,ratio:ee}}function vo(_){const m=Be.value[_]||[],N=Ke.value.find(ve=>ve.id===_),ee=(N==null?void 0:N.playerCount)||6,ae=mo(_);if(m.length>0){const ve=m.some(Me=>!or(Me,_)),fe=ae<ee;if(ve||fe)return{type:"incomplete",hasUnavailablePlayers:ve,hasInsufficientPlayers:fe,unavailablePlayers:m.filter(Me=>!or(Me,_)),availableCount:ae,requiredCount:ee}}return ae<ee?{type:"insufficient",availableCount:ae,requiredCount:ee}:m.length===0?{type:"ready",availableCount:ae,requiredCount:ee}:{type:"complete",availableCount:ae,requiredCount:ee}}function Ql(_){const m=vo(_);switch(m.type){case"incomplete":return m.hasUnavailablePlayers?m.unavailablePlayers.length===1?`Sélection incomplète : ${m.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${m.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${m.availableCount} joueurs disponibles pour ${m.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${m.availableCount} disponibles pour ${m.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${m.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${m.availableCount} joueurs disponibles`;default:return""}}async function VT(){const _=[];for(const m of rt.value){if(!await Li(m.id,o.value))continue;const ee=await zE(m.id,o.value);ee&&_.push({...m,email:ee})}return _}function Yc(_){if(_!=null&&_.archived){Ue.value=!0,vt.value="Impossible d'annoncer un événement archivé",setTimeout(()=>{Ue.value=!1},3e3);return}fv(),ro.value=_,Nr.value=!0;try{const m=new URLSearchParams(window.location.search);m.set("modal","announce"),m.set("event",(_==null?void 0:_.id)||""),history.replaceState(null,"",`${window.location.pathname}?${m.toString()}`)}catch{}}function OT(){Nr.value=!1,ro.value=null;try{const _=new URLSearchParams(window.location.search);_.get("modal")==="announce"&&(_.delete("modal"),_.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${_.toString()}`))}catch{}}function fv(){fs.value=!1,so.value=null}const bf=P(!1);async function pv({eventId:_,eventData:m,reason:N,selectedPlayers:ee,scope:ae="all",recipient:ve=null}){bf.value=!0;try{N==="selection"?(ae==="single"&&(ve!=null&&ve.email)?await P_({eventId:_,eventData:m,selectedPlayers:[ve.name],seasonId:o.value,seasonSlug:s,players:Mr.value}):await P_({eventId:_,eventData:m,selectedPlayers:ee,seasonId:o.value,seasonSlug:s,players:Mr.value}),Ue.value=!0,vt.value=ae==="single"?`Notification envoyée à ${(ve==null?void 0:ve.name)||"1 joueur"}`:"Notifications de sélection envoyées à tous les joueurs sélectionnés !",setTimeout(()=>{Ue.value=!1},3e3)):(ae==="single"&&(ve!=null&&ve.email)?await S_({eventId:_,eventData:m,players:[ve],seasonId:o.value,seasonSlug:s,createMagicLink:Jp,reminder:!1,getAvailabilityForEvent:(fe,Me)=>or(fe,Me)}):await S_({eventId:_,eventData:m,players:await VT(),seasonId:o.value,seasonSlug:s,createMagicLink:Jp,reminder:!1,getAvailabilityForEvent:(fe,Me)=>or(fe,Me)}),Ue.value=!0,vt.value=ae==="single"?`Notification envoyée à ${(ve==null?void 0:ve.name)||"1 joueur"}`:"Notifications envoyées à tous les joueurs protégés !",setTimeout(()=>{Ue.value=!1},3e3))}catch{console.error("Erreur lors de l'envoi des notifications"),Ue.value=!0,vt.value="Erreur lors de l'envoi des notifications",setTimeout(()=>{Ue.value=!1},3e3)}bf.value=!1}function wf(_){if(!_)return{};const m={};return rt.value.forEach(N=>{m[N.name]=or(N.name,_)}),m}function yo(_){if(_!=null&&_.archived){Ue.value=!0,vt.value="Impossible d'ouvrir la sélection sur un événement archivé",setTimeout(()=>{Ue.value=!1},3e3);return}Dn.value=_,jn.value=!0;try{const m=new URLSearchParams(window.location.search);m.set("modal","selection"),m.set("event",(_==null?void 0:_.id)||""),history.replaceState(null,"",`${window.location.pathname}?${m.toString()}`)}catch{}}function mv(){jn.value=!1,Dn.value=null;try{const _=new URLSearchParams(window.location.search);_.get("modal")==="selection"&&(_.delete("modal"),_.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${_.toString()}`))}catch{}}async function MT(){if(!Dn.value)return;const _=Dn.value.id,m=Dn.value.playerCount||6;if(mo(_)===0){Ue.value=!0,vt.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{Ue.value=!1},3e3);return}await w({type:"launchSelection",data:{eventId:_,count:m}})}function LT(){mv(),Ue.value=!0,vt.value="Sélection validée !",setTimeout(()=>{Ue.value=!1},3e3)}async function $T(_){if(!_||!_.eventId)return;const{eventId:m,players:N}=_;await w({type:"updateSelection",data:{eventId:m,players:N}})}async function xf(_,m){if(!_||!m)return;vv(),fr.value=_,Ll.value=!0,await Ht();const N=document.querySelector(`[data-event-id="${_}"]`);if(!N){console.warn("Élément événement non trouvé dans le DOM");return}document.querySelectorAll(".focused-event-highlight").forEach(fe=>{fe.classList.remove("focused-event-highlight")});const ee=document.querySelectorAll(`[data-event-id="${_}"]`);ee.forEach(fe=>{fe.classList.add("focused-event-highlight")});const ae=ee[0],ve=ee[ee.length-1];ae&&ae.classList.add("focused-event-column-start"),ve&&ve.classList.add("focused-event-column-end"),await FT(N),Ue.value=!0,vt.value=`Événement ciblé : ${m.title}`,setTimeout(()=>{Ue.value=!1},4e3),ni.value=setTimeout(()=>{vv()},8e3)}function gv(_){if(!_)return;const m=Ke.value.find(N=>N.id===_);if(!m){console.warn("Événement non trouvé dans la liste des événements"),setTimeout(()=>{const N=Ke.value.find(ee=>ee.id===_);N?xf(_,N):console.error("Événement toujours introuvable après retry")},500);return}xf(_,m)}bt(Ke,_=>{try{const m=new URLSearchParams(window.location.search),N=m.get("modal"),ee=m.get("event");if(!N||!ee)return;const ae=_.find(ve=>ve.id===ee);if(!ae)return;N==="announce"&&Yc(ae),N==="selection"&&yo(ae)}catch{}},{immediate:!0});async function FT(_){if(!_)return;if(await new Promise(N=>setTimeout(N,100)),window.innerWidth<=768){const N=nr.value;if(N){const ee=_.offsetLeft,ae=_.offsetWidth,ve=N.clientWidth,fe=ee-ve/2+ae/2,Me=N.scrollWidth-ve,Ye=Math.max(0,Math.min(fe,Me));N.scrollTo({left:Ye,behavior:"smooth"}),setTimeout(()=>{const st=_.getBoundingClientRect();if(st.left<0||st.right>window.innerWidth){const xt=ee-20;N.scrollTo({left:Math.max(0,xt),behavior:"smooth"})}},500)}}else _.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const m=nr.value;m&&setTimeout(()=>{const N=document.querySelector(`[data-event-id="${fr.value}"]`);if(N&&N.closest("tbody")){const ee=N.offsetLeft,ae=N.offsetWidth,ve=m.clientWidth,fe=ee-ve/2+ae/2,Me=m.scrollWidth-ve,Ye=Math.max(0,Math.min(fe,Me));m.scrollTo({left:Ye,behavior:"smooth"})}},300)}function vv(){ni.value&&(clearTimeout(ni.value),ni.value=null),fr.value=null,Ll.value=!1,document.querySelectorAll(".focused-event-highlight").forEach(_=>{_.classList.remove("focused-event-highlight")}),document.querySelectorAll(".focused-event-column-start, .focused-event-column-end").forEach(_=>{_.classList.remove("focused-event-column-start","focused-event-column-end")})}return(_,m)=>{var N,ee,ae,ve,fe,Me,Ye,st,xt,Xt,un,cn,It,yr,Lr,_o,xa,yv,_v,bv,wv,xv,Iv,Ev;return D(),V(it,null,[d("div",G5,[Qe(K5,{"season-name":i.value,"is-scrolled":l.value,onGoBack:Wl,onOpenAccountMenu:ff,onOpenHelp:m[0]||(m[0]=W=>ps.value=!0),onOpenNotifications:pf,onOpenPlayers:aa,onLogout:Vr,onOpenLogin:la,onOpenAccount:la},null,8,["season-name","is-scrolled"]),d("div",H5,[d("div",{ref_key:"headerBarRef",ref:$c,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[d("div",W5,[Ke.value.length===0&&rt.value.length===0?ce("",!0):(D(),V("div",Q5,[d("div",{class:"flex items-center justify-center h-full gap-2"},[d("button",{onClick:ci,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel événement"},m[74]||(m[74]=[d("span",{class:"text-lg"},"➕",-1),d("span",{class:"hidden sm:inline"},"Ajouter un événement",-1),d("span",{class:"sm:hidden"},"Événement",-1)]))])])),d("div",J5,[d("div",{ref_key:"headerEventsRef",ref:Nn,class:"flex relative z-[60]",style:_r({transform:`translateX(-${ca.value}px)`})},[(D(!0),V(it,null,br(ln.value,W=>(D(),V("div",{key:"h-"+W.id,"data-event-id":W.id,class:Zt(["col-event flex-shrink-0 p-3 text-center flex flex-col justify-between",{"archived-header":W.archived}])},[d("div",{class:"flex flex-col items-center justify-between p-2 rounded-lg hover:bg-white/10 transition-colors duration-200 cursor-pointer group h-24",title:W.title+" - Cliquez pour voir les détails",onClick:ct(rn=>lv(W),["stop"])},[d("div",Z5,[d("div",eU,ie(W.title||"Sans titre"),1),W.archived?(D(),V("div",tU,"(Archivé)")):ce("",!0)]),d("div",nU,[d("div",{onClick:ct(rn=>gt(W.id),["stop"]),class:"header-date text-[16px] md:text-base text-gray-300 group-hover:text-purple-200 transition-colors duration-200 cursor-pointer hover:bg-white/10 px-2 py-1 rounded",title:_a(W.date)+" - Cliquez pour ajouter à votre agenda"},ie(Gl(W.date)),9,rU),j.value===W.id?(D(),V("div",sU,[d("div",iU,[d("button",{onClick:ct(rn=>{wa("google",W),Ot()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},m[75]||(m[75]=[d("span",null,"🌐",-1),d("span",null,"Google Calendar",-1)]),8,oU),d("button",{onClick:ct(rn=>{wa("outlook",W),Ot()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},m[76]||(m[76]=[d("span",null,"📧",-1),d("span",null,"Outlook",-1)]),8,aU),d("button",{onClick:ct(rn=>{wa("ics",W),Ot()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Télécharger un fichier .ics compatible avec tous les agendas"},m[77]||(m[77]=[d("span",null,"📥",-1),d("span",null,"Télécharger (.ics)",-1)]),8,lU)])])):ce("",!0)])],8,X5),d("div",uU,[W.archived?(D(),V("div",cU,m[78]||(m[78]=[d("span",{class:"text-xs text-gray-300 font-medium"},"📁",-1),d("span",{class:"text-xs text-gray-200 font-medium ml-1"},"Archivé",-1)]))):vo(W.id).type==="ready"?(D(),V("div",{key:1,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-blue-500/30 transition-colors duration-200 cursor-pointer group",title:Ql(W.id)+" - Cliquez pour ouvrir la sélection",onClick:ct(rn=>yo(W),["stop"])},m[79]||(m[79]=[d("span",{class:"text-xs text-blue-300 font-medium group-hover:text-blue-200"},"🆕",-1),d("span",{class:"text-xs text-blue-200 font-medium ml-1 group-hover:text-blue-100"},"Nouveau",-1)]),8,dU)):vo(W.id).type==="complete"?(D(),V("div",{key:2,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-green-500/30 transition-colors duration-200 cursor-pointer group",title:Ql(W.id)+" - Cliquez pour ouvrir la sélection",onClick:ct(rn=>yo(W),["stop"])},m[80]||(m[80]=[d("span",{class:"text-xs text-green-300 font-medium group-hover:text-green-200"},"✅",-1),d("span",{class:"text-xs text-green-200 font-medium ml-1 group-hover:text-green-100"},"Complet",-1)]),8,hU)):vo(W.id).type==="incomplete"?(D(),V("div",{key:3,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-orange-500/30 transition-colors duration-200 cursor-pointer group",title:Ql(W.id)+" - Cliquez pour ouvrir la sélection",onClick:ct(rn=>yo(W),["stop"])},m[81]||(m[81]=[d("span",{class:"text-xs text-orange-300 font-medium group-hover:text-orange-200"},"⚠️",-1),d("span",{class:"text-xs text-orange-200 font-medium ml-1 group-hover:text-orange-100"},"À finaliser",-1)]),8,fU)):vo(W.id).type==="insufficient"?(D(),V("div",{key:4,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-red-500/30 transition-colors duration-200 cursor-pointer group",title:Ql(W.id)+" - Cliquez pour ouvrir la sélection",onClick:ct(rn=>yo(W),["stop"])},m[82]||(m[82]=[d("span",{class:"text-xs text-red-300 font-medium group-hover:text-red-200"},"❌",-1),d("span",{class:"text-xs text-red-200 font-medium ml-1 group-hover:text-red-100"},"Manque",-1)]),8,pU)):ce("",!0)])],10,Y5))),128))],4)]),m[85]||(m[85]=d("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),d("button",{onClick:zc,class:"absolute right-2 top-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[86] backdrop-blur-sm",title:bs.value?"Masquer les événements archivés":"Afficher les événements archivés","aria-label":bs.value?"Masquer les événements archivés":"Afficher les événements archivés"},[(D(),V("svg",gU,[m[83]||(m[83]=d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.25 12c1.5-4 5.25-7.5 9.75-7.5S20.25 8 21.75 12c-1.5 4-5.25 7.5-9.75 7.5S3.75 16 2.25 12z"},null,-1)),m[84]||(m[84]=d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)),bs.value?ce("",!0):(D(),V("path",vU))]))],8,mU),ot(d("button",{onClick:m[1]||(m[1]=ct(W=>Hr(-1,W),["prevent"])),onMousedown:m[2]||(m[2]=ct(W=>rr(-1,W),["prevent"])),onMouseup:m[3]||(m[3]=W=>sr(W)),onMouseleave:m[4]||(m[4]=W=>sr(W)),onTouchstart:m[5]||(m[5]=ct(W=>rr(-1,W),["prevent"])),onTouchend:m[6]||(m[6]=W=>sr(W)),onTouchcancel:m[7]||(m[7]=W=>sr(W)),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements précédents — cliquez pour défiler"}," ‹ ",544),[[kf,Lc.value]]),ot(d("button",{onClick:m[8]||(m[8]=ct(W=>Hr(1,W),["prevent"])),onMousedown:m[9]||(m[9]=ct(W=>rr(1,W),["prevent"])),onMouseup:m[10]||(m[10]=W=>sr(W)),onMouseleave:m[11]||(m[11]=W=>sr(W)),onTouchstart:m[12]||(m[12]=ct(W=>rr(1,W),["prevent"])),onTouchend:m[13]||(m[13]=W=>sr(W)),onTouchcancel:m[14]||(m[14]=W=>sr(W)),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements suivants — cliquez pour défiler"}," › ",544),[[kf,$l.value]])])],512),ot(d("div",{ref_key:"gridboardRef",ref:nr,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[Yt.value===1?(D(),V("div",yU,[L.value.position?(D(),V("div",{key:0,class:"fixed z-[400]",style:_r({left:L.value.position.x+"px",top:L.value.position.y+"px"})},[d("div",{id:"coachmark-add",class:Zt(["coachmark pointer-events-auto max-w-sm bg-gray-900 border border-purple-500/40 rounded-xl shadow-2xl p-3 text-white relative",{"coachmark-right":L.value.side==="right","coachmark-left":L.value.side==="left"}])},[m[87]||(m[87]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ajoutez votre nom",-1)),m[88]||(m[88]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},'Cliquez sur "Ajouter un joueur" pour vous inscrire',-1)),d("div",_U,[m[86]||(m[86]=d("span",{class:"text-purple-300 text-base md:text-sm"},"Étape 1/4",-1)),d("button",{onClick:m[15]||(m[15]=W=>ya(0)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant >")])],2)],4)):ce("",!0)])):ce("",!0),Yt.value===2&&U.value&&M.value?(D(),V("div",bU,[se.value.position?(D(),V("div",{key:0,class:"fixed z-[400]",style:_r({position:"absolute",left:se.value.position.x+"px",top:se.value.position.y+"px"})},[d("div",wU,[m[90]||(m[90]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Indiquez vos disponibilités",-1)),m[91]||(m[91]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez cette case pour alterner Oui / Non / Vide",-1)),d("div",xU,[m[89]||(m[89]=d("span",{class:"text-pink-300 text-base md:text-sm"},"Étape 2/4",-1)),d("button",{onClick:m[16]||(m[16]=W=>ya(1)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ce("",!0)])):ce("",!0),Yt.value===3&&U.value?(D(),V("div",IU,[Q.value.position?(D(),V("div",{key:0,class:"fixed z-[400]",style:_r({position:"absolute",left:Q.value.position.x+"px",top:Q.value.position.y+"px"})},[d("div",EU,[m[93]||(m[93]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ouvrez votre fiche",-1)),m[94]||(m[94]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez sur votre nom pour voir les détails et la protection",-1)),d("div",TU,[m[92]||(m[92]=d("span",{class:"text-yellow-300 text-base md:text-sm"},"Étape 3/4",-1)),d("button",{onClick:m[17]||(m[17]=W=>ya(2)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ce("",!0)])):ce("",!0),d("table",AU,[d("colgroup",null,[m[95]||(m[95]=d("col",{class:"col-left"},null,-1)),(D(!0),V(it,null,br(ln.value,(W,rn)=>(D(),V("col",{key:"c"+rn,class:"col-event"}))),128)),m[96]||(m[96]=d("col",{class:"col-right"},null,-1))]),m[100]||(m[100]=d("thead",{class:"hidden"},null,-1)),d("tbody",null,[(D(!0),V(it,null,br(_s.value,W=>{var rn;return D(),V("tr",{key:W.id,class:Zt(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":W.id===$.value,"preferred-player":Yr.value.has(W.id)}]),"data-player-id":W.id},[d("td",PU,[d("div",RU,[Yr.value.has(W.id)?(D(),V("span",CU," ⭐ ")):Qr(W.id)?(D(),V("span",kU," 🔒 ")):ce("",!0),d("div",{onClick:ar=>_f(W),class:Zt(["player-name hover:bg-white/10 rounded-lg p-2 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight block truncate max-w-full flex-1 min-w-0 group",{"inline-block rounded px-1 ring-2 ring-yellow-400 animate-pulse":Yt.value===3&&W.id===(U.value||((rn=_s.value[0])==null?void 0:rn.id))}]),title:"Cliquez pour voir les détails : "+W.name},[d("span",NU,ie(W.name),1)],10,DU)])]),(D(!0),V(it,null,br(ln.value,ar=>{var Tv,Av,Sv;return D(),V("td",{key:ar.id,"data-event-id":ar.id,class:Zt(["p-0",ar.archived?"archived-col":"",{"relative ring-2 ring-pink-400 rounded-md animate-pulse":Yt.value===2&&W.id===(U.value||((Tv=_s.value[0])==null?void 0:Tv.id))&&ar.id===(M.value||((Av=ln.value[0])==null?void 0:Av.id))}])},[Qe(R_,{"player-name":W.name,"event-id":ar.id,"is-available":or(W.name,ar.id),"is-selected":Gc(W.name,ar.id),"chance-percent":((Sv=jl.value[W.name])==null?void 0:Sv[ar.id])??null,"show-selected-chance":Xr(ar.id),disabled:ar.archived===!0,onToggle:fo},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])],10,VU)}),128)),m[97]||(m[97]=d("td",{class:"p-3 md:p-4"},null,-1))],10,SU)}),128)),d("tr",OU,[d("td",MU,[d("div",LU,[d("button",{onClick:m[18]||(m[18]=W=>A.value=!0),class:"w-full md:w-auto flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur","data-onboarding":"add-player"},m[98]||(m[98]=[d("span",{class:"text-lg"},"➕",-1),d("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),d("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(D(!0),V(it,null,br(ln.value,W=>(D(),V("td",{key:"add-row-"+W.id,"data-event-id":W.id,class:Zt(["p-3 md:p-5",W.archived?"archived-col":""])},null,10,$U))),128)),m[99]||(m[99]=d("td",{class:"p-3 md:p-4"},null,-1))])])])],512),[[kf,!Gr.value]])])]),Gr.value?(D(),V("div",FU,[d("div",UU,[m[101]||(m[101]=d("div",{class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"},[d("span",{class:"text-3xl"},"🎭")],-1)),d("p",jU,ie(ti.value)+"…",1),d("div",qU,[d("div",{class:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-300",style:_r({width:Or.value+"%"})},null,4)]),d("p",BU,ie(Or.value)+"%",1)])])):ce("",!0),Gr.value?ce("",!0):(D(),Vs(F5,{key:1,"season-id":o.value,"season-slug":Ur(s),"players-count":rt.value.length,"events-count":Ke.value.length,"onboarding-done":((N=a.value)==null?void 0:N.onboardingCreatorDone)===!0,onCreateEvent:ci,onAddPlayer:m[19]||(m[19]=()=>{A.value=!0}),onCopyLink:gf,onDismissed:Ml},null,8,["season-id","season-slug","players-count","events-count","onboarding-done"])),ce("",!0),Ue.value?(D(),V("div",zU,[d("div",KU,[m[102]||(m[102]=d("span",{class:"text-xl"},"✨",-1)),d("span",null,ie(vt.value),1)])])):ce("",!0),mr.value?(D(),V("div",GU,[d("div",HU,[m[103]||(m[103]=d("span",{class:"text-xl"},"⚠️",-1)),d("span",null,ie(oi.value),1)])])):ce("",!0),fa.value?(D(),V("div",WU,[d("div",QU,[m[109]||(m[109]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvel événement",-1)),d("div",JU,[m[104]||(m[104]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),ot(d("input",{"onUpdate:modelValue":m[20]||(m[20]=W=>li.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'événement"},null,512),[[$t,li.value]])]),d("div",YU,[m[105]||(m[105]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),ot(d("input",{"onUpdate:modelValue":m[21]||(m[21]=W=>ui.value=W),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[$t,ui.value]])]),d("div",XU,[m[106]||(m[106]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),ot(d("textarea",{"onUpdate:modelValue":m[22]||(m[22]=W=>ir.value=W),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)"},null,512),[[$t,ir.value]])]),d("div",ZU,[ot(d("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":m[23]||(m[23]=W=>pa.value=W),class:"w-4 h-4"},null,512),[[Ci,pa.value]]),m[107]||(m[107]=d("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Créer comme archivé",-1))]),d("div",ej,[m[108]||(m[108]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),ot(d("input",{"onUpdate:modelValue":m[24]||(m[24]=W=>uo.value=W),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[$t,uo.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:Bc,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:ma,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):ce("",!0),A.value?(D(),V("div",tj,[d("div",nj,[m[111]||(m[111]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau joueur",-1)),d("div",rj,[m[110]||(m[110]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),ot(d("input",{"onUpdate:modelValue":m[25]||(m[25]=W=>S.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[$t,S.value]])]),d("div",sj,[d("button",{onClick:m[26]||(m[26]=W=>A.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:qc,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):ce("",!0),c.value?(D(),V("div",ij,[d("div",oj,[m[112]||(m[112]=Pn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cet événement ?</p></div>',1)),d("div",aj,[d("button",{onClick:jc,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:m[27]||(m[27]=()=>Jr()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ce("",!0),In.value?(D(),V("div",lj,[d("div",uj,[m[113]||(m[113]=Pn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce joueur ?</p></div>',1)),d("div",cj,[d("button",{onClick:Jc,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{onClick:m[28]||(m[28]=()=>Qc()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):ce("",!0),x.value?(D(),V("div",dj,[d("div",hj,[d("div",fj,[m[114]||(m[114]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🎭")],-1)),m[115]||(m[115]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),d("p",pj,[b.value&&Be.value[b.value]&&Be.value[b.value].every(W=>or(W,b.value))?(D(),V("span",mj,"Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.")):(D(),V("span",gj,"La sélection sera mise à jour : les joueurs disponibles seront conservés, les slots vides seront complétés."))])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:p,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{onClick:u,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):ce("",!0),G.value?(D(),V("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:yf},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:m[42]||(m[42]=ct(()=>{},["stop"]))},[d("div",vj,[d("button",{onClick:yf,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",yj,[m[121]||(m[121]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),d("div",_j,[d("div",bj,[d("h2",wj,ie((ee=H.value)==null?void 0:ee.title),1),d("div",xj,[m[116]||(m[116]=d("span",{class:"text-blue-300"},"👥",-1)),d("span",Ij,ie(((ae=H.value)==null?void 0:ae.playerCount)||6)+" joueurs",1)])]),d("div",Ej,[d("p",Tj,ie(_a((ve=H.value)==null?void 0:ve.date)),1),d("div",Aj,[d("button",{onClick:m[29]||(m[29]=W=>Ir()),class:"px-3 py-1.5 hover:bg-white/20 rounded text-purple-300 hover:text-green-400 transition-colors duration-200 text-sm flex items-center gap-2 border border-purple-500/30",title:"Ajouter à votre agenda"},m[117]||(m[117]=[d("span",null,"📅",-1),d("span",null,"Agenda",-1)])),ge.value?(D(),V("div",Sj,[d("div",Pj,[d("button",{onClick:m[30]||(m[30]=W=>{wa("google"),Er()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},m[118]||(m[118]=[d("span",null,"🌐",-1),d("span",null,"Google Calendar",-1)])),d("button",{onClick:m[31]||(m[31]=W=>{wa("outlook"),Er()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},m[119]||(m[119]=[d("span",null,"📧",-1),d("span",null,"Outlook",-1)])),d("button",{onClick:m[32]||(m[32]=W=>{wa("ics"),Er()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Télécharger un fichier .ics compatible avec tous les agendas"},m[120]||(m[120]=[d("span",null,"📥",-1),d("span",null,"Télécharger (.ics)",-1)]))])])):ce("",!0)])]),(fe=H.value)!=null&&fe.description?(D(),V("div",Rj,ie(H.value.description),1)):ce("",!0)])])]),d("div",Cj,[d("div",kj,[d("div",Dj,[d("div",Nj,ie(mo((Me=H.value)==null?void 0:Me.id)),1),m[122]||(m[122]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),d("div",Vj,[d("div",Oj,ie(go((Ye=H.value)==null?void 0:Ye.id)),1),m[123]||(m[123]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),d("div",Mj,[d("div",Lj,ie(Math.max((((st=H.value)==null?void 0:st.playerCount)||6)-go((xt=H.value)==null?void 0:xt.id),0)),1),m[124]||(m[124]=d("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))])]),H.value?(D(),V("div",$j,[d("div",Fj,[zl.value?(D(),V("div",{key:0,class:Zt(["flex items-center gap-2 px-2 py-1 rounded-md border text-[11px] md:text-xs max-w-[70%] truncate",((Xt=Kc.value)==null?void 0:Xt.type)==="incomplete"?"bg-yellow-500/10 border-yellow-500/30 text-yellow-200":"bg-orange-500/10 border-orange-500/30 text-orange-200"]),title:ho.value},[m[125]||(m[125]=d("span",null,"⚠️",-1)),d("span",jj,ie(ho.value),1)],10,Uj)):ce("",!0),ot(d("select",{"onUpdate:modelValue":m[33]||(m[33]=W=>Bl.value=W),class:"ml-auto bg-gray-800 text-white rounded-md px-3 py-2 border border-white/10 focus:outline-none text-sm",title:"Filtrer les joueurs par statut"},m[126]||(m[126]=[Pn('<option value="selected">Sélectionnés</option><option value="available">Disponibles</option><option value="unavailable">Non Disponibles</option><option value="unknown">Pas de réponse</option><option value="all">Tous</option>',5)]),512),[[Z1,Bl.value]])]),d("div",qj,[(D(!0),V(it,null,br(co.value,W=>{var rn,ar;return D(),V("div",{key:W.id,class:"flex items-center justify-between px-2 py-1.5 rounded-md hover:bg-gray-800/40 transition-colors"},[d("div",Bj,[Yr.value.has(W.id)?(D(),V("span",zj," ⭐ ")):Qr(W.id)?(D(),V("span",Kj," 🔒 ")):ce("",!0),d("span",{class:"text-white text-sm md:text-base block truncate max-w-full flex-1 min-w-0",title:W.name},ie(W.name),9,Gj)]),d("div",Hj,[Qe(R_,{"player-name":W.name,"event-id":H.value.id,"is-available":wf(H.value.id)[W.name],"is-selected":RT(W.name,H.value.id),"chance-percent":((rn=jl.value[W.name])==null?void 0:rn[H.value.id])??null,"show-selected-chance":Xr(H.value.id),disabled:((ar=H.value)==null?void 0:ar.archived)===!0,compact:!0,onToggle:PT},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])])])}),128))])])):ce("",!0),d("div",Wj,[d("button",{onClick:m[34]||(m[34]=W=>yo(H.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},m[127]||(m[127]=[d("span",null,"🎭",-1),d("span",null,"Sélectionner",-1)])),d("button",{onClick:m[35]||(m[35]=W=>Yc(H.value)),disabled:(un=H.value)==null?void 0:un.archived,class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(cn=H.value)!=null&&cn.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[128]||(m[128]=[d("span",null,"📢",-1),d("span",null,"Annoncer",-1)]),8,Qj),d("div",{class:"relative",ref_key:"eventMoreActionsRef",ref:Ie},[d("button",{onClick:m[36]||(m[36]=W=>He()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},m[129]||(m[129]=[d("span",null,"⋯",-1),d("span",null,"Plus",-1)]))],512),d("button",{onClick:uv,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),(D(),Vs(Vu,{to:"body"},[_e.value?(D(),V("div",{key:0,ref_key:"eventMoreActionsDropdownRef",ref:ye,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:_r($e.value)},[d("button",{onClick:m[37]||(m[37]=W=>{cv(),_e.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},m[130]||(m[130]=[d("span",null,"✏️",-1),d("span",null,"Modifier",-1)])),d("button",{onClick:m[38]||(m[38]=W=>{dv(),_e.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10",title:(It=H.value)!=null&&It.archived?"Désarchiver cet événement":"Archiver cet événement"},[d("span",null,ie((yr=H.value)!=null&&yr.archived?"📂":"📁"),1),d("span",null,ie((Lr=H.value)!=null&&Lr.archived?"Désarchiver":"Archiver"),1)],8,Jj),d("button",{onClick:m[39]||(m[39]=W=>{var rn;ai((rn=H.value)==null?void 0:rn.id),_e.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[131]||(m[131]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ce("",!0)]))])]),d("div",Yj,[d("button",{onClick:m[40]||(m[40]=W=>yo(H.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélectionner"),d("button",{onClick:uv,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),d("button",{onClick:m[41]||(m[41]=W=>Xe()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):ce("",!0),(D(),Vs(Vu,{to:"body"},[be.value?(D(),V("div",{key:0,ref_key:"eventMoreActionsMobileDropdownRef",ref:Ce,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:_r(B.value)},[d("button",{onClick:m[43]||(m[43]=W=>{Yc(H.value),be.value=!1}),disabled:(_o=H.value)==null?void 0:_o.archived,class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10 disabled:opacity-50 disabled:cursor-not-allowed",title:(xa=H.value)!=null&&xa.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[132]||(m[132]=[d("span",null,"📢",-1),d("span",null,"Annoncer",-1)]),8,Xj),d("button",{onClick:m[44]||(m[44]=W=>{cv(),be.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},m[133]||(m[133]=[d("span",null,"✏️",-1),d("span",null,"Modifier",-1)])),d("button",{onClick:m[45]||(m[45]=W=>{dv(),be.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},[d("span",null,ie((yv=H.value)!=null&&yv.archived?"📂":"📁"),1),d("span",null,ie((_v=H.value)!=null&&_v.archived?"Désarchiver":"Archiver"),1)]),d("button",{onClick:m[46]||(m[46]=W=>{var rn;ai((rn=H.value)==null?void 0:rn.id),be.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[134]||(m[134]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ce("",!0)])),Qe(av,{show:Mt.value,player:qt.value,seasonId:o.value,onClose:m[47]||(m[47]=W=>Mt.value=!1),onVerified:CT},null,8,["show","player","seasonId"]),f.value?(D(),V("div",Zj,[d("div",eq,[m[140]||(m[140]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier l'événement",-1)),d("div",tq,[m[135]||(m[135]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),ot(d("input",{"onUpdate:modelValue":m[48]||(m[48]=W=>g.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Bn(Sr,["esc"]),Bn(ha,["enter"])],ref:"editTitleInput"},null,544),[[$t,g.value]])]),d("div",nq,[m[136]||(m[136]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),ot(d("input",{"onUpdate:modelValue":m[49]||(m[49]=W=>y.value=W),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[Bn(Sr,["esc"]),Bn(ha,["enter"])]},null,544),[[$t,y.value]])]),d("div",rq,[m[137]||(m[137]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),ot(d("textarea",{"onUpdate:modelValue":m[50]||(m[50]=W=>ne.value=W),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)",onKeydown:Bn(Sr,["esc"])},null,544),[[$t,ne.value]])]),d("div",sq,[ot(d("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":m[51]||(m[51]=W=>de.value=W),class:"w-4 h-4"},null,512),[[Ci,de.value]]),m[138]||(m[138]=d("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver cet événement",-1))]),d("div",iq,[m[139]||(m[139]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),ot(d("input",{"onUpdate:modelValue":m[52]||(m[52]=W=>I.value=W),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:Bn(Sr,["esc"])},null,544),[[$t,I.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:Sr,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:ha,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ce("",!0),Qe(RE,{show:F.value,message:v(),error:pt.value,"session-info":gr(),onSubmit:X,onCancel:Se},null,8,["show","message","error","session-info"]),mt.value?(D(),V("div",oq,[d("div",aq,[m[142]||(m[142]=Pn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protégé par mot de passe</p></div>',1)),d("div",lq,[d("div",uq,[d("div",null,[m[141]||(m[141]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),ot(d("input",{"onUpdate:modelValue":m[53]||(m[53]=W=>ue.value=W),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[54]||(m[54]=Bn(W=>wt(ue.value),["enter"])),ref_key:"playerPasswordInputRef",ref:Ne},null,544),[[$t,ue.value]])])]),d("button",{onClick:m[55]||(m[55]=W=>wt(ue.value)),disabled:!ue.value||oe.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[oe.value?(D(),V("span",dq,"⏳")):(D(),V("span",hq,"🔓")),d("span",null,ie(oe.value?"Vérification...":"Vérifier et supprimer"),1)],8,cq)]),d("div",fq,[d("button",{onClick:m[56]||(m[56]=W=>tt.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),re.value?(D(),V("div",pq,[d("div",mq,ie(re.value),1)])):ce("",!0),d("div",{class:"flex justify-center"},[d("button",{onClick:bn,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ce("",!0),te.value?(D(),V("div",gq,[d("div",vq,[m[145]||(m[145]=Pn('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protégé par mot de passe</p></div>',1)),d("div",yq,[d("div",_q,[d("div",null,[m[143]||(m[143]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),ot(d("input",{"onUpdate:modelValue":m[57]||(m[57]=W=>We.value=W),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[58]||(m[58]=Bn(W=>yt(We.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:Vt},null,544),[[$t,We.value]])])]),d("div",bq,[d("button",{onClick:m[59]||(m[59]=W=>Z.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),Te.value?(D(),V("div",wq,[d("div",xq,ie(Te.value),1)])):ce("",!0)]),d("div",Iq,[d("button",{onClick:En,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),d("button",{onClick:m[60]||(m[60]=W=>yt(We.value)),disabled:!We.value||at.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[at.value?(D(),V("span",Tq,"⏳")):(D(),V("span",Aq,"🔓")),d("span",null,[St(ie(at.value?"Vérification...":"Vérifier"),1),m[144]||(m[144]=d("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,Eq)])])])):ce("",!0),Z.value?(D(),V("div",{key:14,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[63]||(m[63]=W=>Z.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[62]||(m[62]=ct(()=>{},["stop"]))},[m[147]||(m[147]=Pn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),d("div",Sq,[m[146]||(m[146]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),d("button",{onClick:Tn,disabled:Ae.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[Ae.value?(D(),V("span",Rq,"⏳")):(D(),V("span",Cq,"📧")),d("span",null,ie(Ae.value?"Envoi...":"Envoyer l'email"),1)],8,Pq)]),xe.value?(D(),V("div",kq,[d("div",Dq,ie(xe.value),1)])):ce("",!0),Ve.value?(D(),V("div",Nq,[d("div",Vq,ie(Ve.value),1)])):ce("",!0),d("div",Oq,[d("button",{onClick:m[61]||(m[61]=W=>Z.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0),tt.value?(D(),V("div",{key:15,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[66]||(m[66]=W=>tt.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[65]||(m[65]=ct(()=>{},["stop"]))},[m[149]||(m[149]=Pn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p></div>',1)),d("div",Mq,[m[148]||(m[148]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),d("button",{onClick:pi,disabled:lt.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[lt.value?(D(),V("span",$q,"⏳")):(D(),V("span",Fq,"📧")),d("span",null,ie(lt.value?"Envoi...":"Envoyer l'email"),1)],8,Lq)]),T.value?(D(),V("div",Uq,[d("div",jq,ie(T.value),1)])):ce("",!0),k.value?(D(),V("div",qq,[d("div",Bq,ie(k.value),1)])):ce("",!0),d("div",zq,[d("button",{onClick:m[64]||(m[64]=W=>tt.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0),Qe(O6,{ref_key:"playerModalRef",ref:O,show:E.value,player:C.value,stats:NT(C.value),seasonId:o.value,"onboarding-step":Yt.value,"onboarding-player-id":U.value,"is-protected":C.value?Ar.value.has(C.value.id):!1,"is-preferred":C.value?Yr.value.has(C.value.id):!1,onClose:hv,onUpdate:kT,onDelete:fi,onRefresh:DT,onAdvanceOnboarding:m[67]||(m[67]=W=>{try{typeof Yt.value<"u"&&(Yt.value.value=W)}catch{}})},null,8,["show","player","stats","seasonId","onboarding-step","onboarding-player-id","is-protected","is-preferred"]),Qe(A5,{ref_key:"selectionModalRef",ref:hs,show:jn.value,event:Dn.value,"current-selection":Be.value[(bv=Dn.value)==null?void 0:bv.id]||[],"available-count":mo((wv=Dn.value)==null?void 0:wv.id),"selected-count":go((xv=Dn.value)==null?void 0:xv.id),"player-availability":wf((Iv=Dn.value)==null?void 0:Iv.id),"season-id":o.value,"season-slug":Ur(s),players:Mr.value,onClose:mv,onSelection:MT,onPerfect:LT,onSendNotifications:pv,onUpdateSelection:$T},null,8,["show","event","current-selection","available-count","selected-count","player-availability","season-id","season-slug","players"]),Qe(TT,{show:Nr.value,event:ro.value,"season-id":o.value,"season-slug":Ur(s),players:Mr.value,sending:bf.value,"availability-by-player":wf((Ev=ro.value)==null?void 0:Ev.id),onClose:OT,onSendNotifications:pv},null,8,["show","event","season-id","season-slug","players","sending","availability-by-player"]),Qe(pF,{show:ps.value,onClose:m[68]||(m[68]=W=>ps.value=!1)},null,8,["show"]),Qe(WE,{show:ms.value,"season-id":o.value,onClose:Kr,onManagePlayer:Ol,onChangePassword:ua,onLogoutDevice:Vr,onDeleteAccount:Mc},null,8,["show","season-id"]),Qe(wT,{show:gs.value,onClose:mf},null,8,["show"]),Qe(xT,{show:vs.value,onClose:Oc,onManagePlayer:Ol},null,8,["show"]),Qe(AT,{show:_n.value,player:Vc.value,"season-id":o.value,onClose:m[69]||(m[69]=W=>_n.value=!1),onSuccess:m[70]||(m[70]=()=>{_n.value=!1,ms.value=!0})},null,8,["show","player","season-id"]),Qe(kE,{show:io.value,onClose:m[71]||(m[71]=W=>io.value=!1),onSuccess:m[72]||(m[72]=()=>{io.value=!1,ms.value=!0})},null,8,["show"]),fs.value?(D(),V("div",Kq,[d("div",Gq,[m[150]||(m[150]=d("h3",{class:"text-xl font-bold text-white mb-4 text-center"},"Voulez-vous annoncer cet événement ?",-1)),m[151]||(m[151]=d("p",{class:"text-gray-300 text-center mb-6"},"Envoyer des notifications aux joueurs pour qu'ils indiquent leur disponibilité",-1)),d("div",Hq,[d("button",{onClick:m[73]||(m[73]=W=>Yc(so.value)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300"}," 📢 Oui "),d("button",{onClick:fv,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300"}," Plus tard ")])])])):ce("",!0)],64)}}},Wq={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},Qq={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},Jq={key:0,class:"text-center py-8"},Yq={key:1,class:"text-center py-8"},Xq={class:"text-gray-300 mb-6"},Zq={key:2,class:"space-y-6"},eB={class:"text-center"},tB={class:"text-gray-300"},nB={class:"font-semibold text-white"},rB={class:"space-y-4"},sB=["disabled"],iB={key:0,class:"animate-spin"},oB={key:1},aB={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},lB={class:"text-red-300 text-sm"},uB={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},cB={class:"text-green-300 text-sm"},dB={__name:"PasswordReset",setup(n){const e=Xo(),t=gl(),r=P(!0),s=P(""),i=P(""),o=P(""),a=P(""),l=P(""),c=P(!1),h=P(""),f=P(""),g=Fe(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);yn(async()=>{try{const{oobCode:A}=e.query;if(K.debug("Token reçu (masqué)"),!A){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=A,i.value="patrice.lamarque+ron@gmail.com",r.value=!1}catch(A){K.error("Erreur lors de la vérification du lien",A),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function y(){if(g.value){c.value=!0,h.value="",f.value="";try{K.debug("Début réinitialisation avec token (masqué)"),await FN(Ge,o.value,a.value),K.info("Mot de passe Firebase Auth mis à jour"),K.info("Réinitialisation terminée avec Firebase Auth"),f.value="Mot de passe réinitialisé avec succès ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{I()},3e3)}catch(A){K.error("Erreur lors de la réinitialisation",A),A.code==="auth/weak-password"?h.value="Le mot de passe doit contenir au moins 6 caractères":A.code==="auth/invalid-action-code"?h.value="Lien de réinitialisation invalide ou expiré":h.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{c.value=!1}}}function I(){t.push("/seasons")}return(A,S)=>(D(),V("div",Wq,[d("div",Qq,[S[8]||(S[8]=Pn('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(D(),V("div",Jq,S[2]||(S[2]=[d("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),d("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(D(),V("div",Yq,[S[3]||(S[3]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"❌")],-1)),S[4]||(S[4]=d("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),d("p",Xq,ie(s.value),1),d("button",{onClick:I,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):i.value?(D(),V("div",Zq,[d("div",eB,[d("p",tB,[S[5]||(S[5]=St("Email : ")),d("span",nB,ie(i.value),1)])]),d("div",rB,[d("div",null,[S[6]||(S[6]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),ot(d("input",{"onUpdate:modelValue":S[0]||(S[0]=$=>a.value=$),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:Bn(y,["enter"])},null,544),[[$t,a.value]])]),d("div",null,[S[7]||(S[7]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),ot(d("input",{"onUpdate:modelValue":S[1]||(S[1]=$=>l.value=$),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:Bn(y,["enter"])},null,544),[[$t,l.value]])])]),d("button",{onClick:y,disabled:!g.value||c.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[c.value?(D(),V("span",iB,"⏳")):(D(),V("span",oB,"🔑")),d("span",null,ie(c.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,sB),h.value?(D(),V("div",aB,[d("div",lB,ie(h.value),1)])):ce("",!0),f.value?(D(),V("div",uB,[d("div",cB,ie(f.value),1)])):ce("",!0)])):ce("",!0)])]))}},hB={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},fB={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},pB={class:"text-3xl"},mB={class:"text-2xl font-bold text-white mb-2"},gB={class:"text-gray-300 mb-6"},vB={__name:"MagicLink",setup(n){const e=Xo(),t=gl(),r=P("loading"),s=P("Traitement en cours..."),i=P("Merci de patienter pendant la validation du lien."),o=Fe(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/seasons")}return yn(async()=>{var l;try{ov("firebase");const c=String(e.query.sid||""),h=String(e.query.pid||"");let f=String(e.query.eid||"");const g=String(e.query.t||""),y=String(e.query.a||""),I=String(e.query.slug||"");if(!g||!y){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants.";return}if(y==="account_email_update"){const L=await OE({token:g});if(!L.valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}try{await KN(Ge.currentUser,L.data.newEmail),await ME({token:g}),r.value="ok",s.value="Email mis à jour",i.value="Votre adresse email a été mise à jour avec succès."}catch{r.value="error",s.value="Action impossible",i.value="Veuillez vous reconnecter puis réessayer."}return}if(y==="verify_email"&&(f="protection"),!(await NE({seasonId:c,playerId:h,eventId:f,token:g,action:y})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}if(y==="verify_email"){await jE({playerId:h,seasonId:c});try{await GE({playerId:h,seasonId:c})}catch{}await Yp({seasonId:c,playerId:h,eventId:"protection",action:y}),r.value="ok",s.value="Email vérifié",i.value="Merci ! Vous pouvez maintenant définir votre mot de passe.",setTimeout(I?()=>t.push(`/season/${I}?player=${encodeURIComponent(h)}&verified=1`):()=>t.push("/seasons"),800);return}const S=Pe(le,"seasons",c,"players",h),$=await jt(S),U=$.exists()&&$.data().name||"";if(!U){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}if(await k3({seasonId:c,playerName:U,eventId:f,value:y==="yes"}),y==="no")try{const L=Pe(le,"seasons",c,"selections",f),se=await jt(L);if(se.exists()){const Q=Array.isArray((l=se.data())==null?void 0:l.players)?se.data().players:[],x=Q.filter(b=>b!==U);x.length!==Q.length&&await setDoc(L,{players:x},{merge:!0})}}catch{}await Yp({seasonId:c,playerId:h,eventId:f,action:y}),r.value="ok",s.value="Merci !",i.value=y==="yes"?"Votre disponibilité a été enregistrée: Disponible.":"Votre disponibilité a été enregistrée: Non disponible. (Si vous étiez sélectionné(e), vous avez été retiré(e) de la sélection.)",setTimeout(I?()=>t.push(`/season/${I}/event/${f}`):()=>t.push("/seasons"),1200)}catch(c){K.error("Magic link error",c),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,c)=>(D(),V("div",hB,[d("div",fB,[d("div",{class:Zt(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[d("span",pB,ie(o.value),1)],2),d("h1",mB,ie(s.value),1),d("p",gB,ie(i.value),1),d("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},yB={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},_B={class:"text-center py-12 px-4"},bB={class:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},wB={class:"container mx-auto px-4 pb-16"},xB={class:"max-w-xl mx-auto bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl"},IB={class:"space-y-5"},EB=["onKeydown"],TB={class:"flex items-center justify-end gap-3 pt-2"},AB=["disabled"],SB={key:0,class:"mt-6 text-sm text-gray-200"},PB={__name:"JoinSeason",setup(n){const e=Xo(),t=gl(),r=e.params.slug,s=P(""),i=P(""),o=P(""),a=P(!1),l=P("");yn(async()=>{const f=Zu(et(le,"seasons"),nh("slug","==",r)),g=await Pt(f);if(g.empty)l.value="Saison introuvable";else{const y=g.docs[0];s.value=y.id,i.value=y.data().name,document.title=`Rejoindre : ${i.value}`}});function c(){t.push(`/season/${r}`)}async function h(){if(!(!o.value.trim()||!s.value)){a.value=!0,l.value="";try{await ET(o.value.trim(),s.value),l.value="Inscription réussie. Vous pouvez maintenant indiquer vos disponibilités.";try{localStorage.setItem(`startPlayerTour:${s.value}`,"1"),localStorage.setItem(`dismissCreatorOnboarding:${s.value}`,"1")}catch{}setTimeout(()=>{c()},600)}catch(f){K.error("Erreur inscription",f),l.value=`Erreur lors de l'inscription: ${(f==null?void 0:f.message)||"Veuillez réessayer"}`}finally{a.value=!1}}}return(f,g)=>(D(),V("div",yB,[d("div",_B,[d("h1",bB,ie(i.value||"Rejoindre la saison"),1),g[1]||(g[1]=d("p",{class:"text-gray-300"},"Inscrivez-vous pour indiquer vos disponibilités aux événements",-1))]),d("div",wB,[d("div",xB,[g[3]||(g[3]=d("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Je rejoins la saison",-1)),d("div",IB,[d("div",null,[g[2]||(g[2]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Votre nom",-1)),ot(d("input",{"onUpdate:modelValue":g[0]||(g[0]=y=>o.value=y),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: Marie Dupont",onKeydown:Bn(ct(h,["prevent"]),["enter"])},null,40,EB),[[$t,o.value]])]),d("div",TB,[d("button",{onClick:c,class:"px-5 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{disabled:!o.value.trim()||a.value,onClick:h,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Rejoindre ",8,AB)])]),l.value?(D(),V("div",SB,ie(l.value),1)):ce("",!0)])])]))}};{const n=()=>{};console.debug=n,console.log=n,console.info=n}const RB=[{path:"/",component:ZO},{path:"/seasons",component:b$},{path:"/season/:slug",component:C_,props:!0},{path:"/season/:slug/event/:eventId",component:C_,props:!0},{path:"/season/:slug/join",component:PB,props:!0},{path:"/reset-password",component:dB},{path:"/magic",component:vB}],CB=dP({history:US("/"),routes:RB}),ST=iS(uS);ST.use(CB);ST.mount("#app");mP({immediate:!0,onRegistered(n){window.__swReg=n}});export{et as $,PI as A,Wo as B,as as C,pn as D,V9 as E,ea as F,mg as G,N9 as H,OB as I,kr as J,nD as K,sD as L,Cl as M,a9 as N,l9 as O,RD as P,Fn as Q,XB as R,UB as S,tn as T,T9 as U,qh as V,AD as W,PD as X,o9 as Y,BB as Z,yw as _,Ju as a,Rc as a$,$B as a0,rD as a1,mD as a2,D9 as a3,pl as a4,E9 as a5,GB as a6,k9 as a7,Pe as a8,JB as a9,QB as aA,p9 as aB,m9 as aC,YB as aD,fD as aE,b9 as aF,w9 as aG,ED as aH,Zu as aI,pI as aJ,FB as aK,I9 as aL,no as aM,sn as aN,P9 as aO,kB as aP,u9 as aQ,n9 as aR,t9 as aS,i9 as aT,HB as aU,Rl as aV,S9 as aW,zB as aX,nh as aY,Ag as aZ,U9 as a_,oD as aa,qB as ab,KB as ac,C9 as ad,s9 as ae,r9 as af,nn as ag,Tc as ah,vD as ai,g9 as aj,jt as ak,c9 as al,d9 as am,Pt as an,h9 as ao,f9 as ap,iD as aq,R9 as ar,A9 as as,jB as at,ZB as au,e9 as av,WB as aw,v9 as ax,_9 as ay,y9 as az,aD as b,VN as b$,Pc as b0,q9 as b1,rc as b2,sa as b3,Ai as b4,M9 as b5,Pi as b6,Si as b7,Hs as b8,Rd as b9,qD as bA,uz as bB,xz as bC,Z0 as bD,wV as bE,uN as bF,rz as bG,J9 as bH,ON as bI,fz as bJ,yz as bK,wz as bL,cz as bM,tV as bN,ZN as bO,z9 as bP,kD as bQ,MN as bR,pz as bS,vz as bT,bz as bU,KD as bV,az as bW,Z9 as bX,$N as bY,Q9 as bZ,XN as b_,F9 as ba,$o as bb,Ga as bc,EO as bd,L9 as be,dz as bf,Gp as bg,$9 as bh,TO as bi,Hg as bj,Ri as bk,H9 as bl,eV as bm,lE as bn,IO as bo,cE as bp,UN as bq,FN as br,dN as bs,jN as bt,j9 as bu,lz as bv,X9 as bw,nz as bx,DO as by,B9 as bz,hl as c,Mg as c0,G9 as c1,qN as c2,Y9 as c3,hz as c4,gz as c5,_z as c6,nV as c7,K9 as c8,oz as c9,KN as ca,GN as cb,mz as cc,tz as cd,iz as ce,sz as cf,ez as cg,W9 as ch,ta as d,Nt as e,me as f,Pl as g,Ic as h,Ad as i,Qh as j,Ec as k,Hh as l,Eg as m,fl as n,Wh as o,Do as p,SD as q,on as r,Uo as s,De as t,NB as u,QR as v,Qt as w,O9 as x,ut as y,DB as z};
