(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Hm(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const Wt={},ul=[],os=()=>{},Y1=()=>!1,jh=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),Km=n=>n.startsWith("onUpdate:"),Nn=Object.assign,Gm=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},X1=Object.prototype.hasOwnProperty,Ft=(n,e)=>X1.call(n,e),Ge=Array.isArray,cl=n=>Cc(n)==="[object Map]",jl=n=>Cc(n)==="[object Set]",Oy=n=>Cc(n)==="[object Date]",st=n=>typeof n=="function",gn=n=>typeof n=="string",us=n=>typeof n=="symbol",Jt=n=>n!==null&&typeof n=="object",Yb=n=>(Jt(n)||st(n))&&st(n.then)&&st(n.catch),Xb=Object.prototype.toString,Cc=n=>Xb.call(n),Z1=n=>Cc(n).slice(8,-1),Zb=n=>Cc(n)==="[object Object]",Wm=n=>gn(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Ou=Hm(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Bh=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},eS=/-(\w)/g,Xr=Bh(n=>n.replace(eS,(e,t)=>t?t.toUpperCase():"")),tS=/\B([A-Z])/g,yo=Bh(n=>n.replace(tS,"-$1").toLowerCase()),qh=Bh(n=>n.charAt(0).toUpperCase()+n.slice(1)),np=Bh(n=>n?`on${qh(n)}`:""),eo=(n,e)=>!Object.is(n,e),Fd=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},zp=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},oh=n=>{const e=parseFloat(n);return isNaN(e)?n:e},nS=n=>{const e=gn(n)?Number(n):NaN;return isNaN(e)?n:e};let Vy;const zh=()=>Vy||(Vy=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Mr(n){if(Ge(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=gn(r)?oS(r):Mr(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(gn(n)||Jt(n))return n}const rS=/;(?![^(]*\))/g,sS=/:([^]+)/,iS=/\/\*[^]*?\*\//g;function oS(n){const e={};return n.replace(iS,"").split(rS).forEach(t=>{if(t){const r=t.split(sS);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function Qt(n){let e="";if(gn(n))e=n;else if(Ge(n))for(let t=0;t<n.length;t++){const r=Qt(n[t]);r&&(e+=r+" ")}else if(Jt(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const aS="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",lS=Hm(aS);function ew(n){return!!n||n===""}function uS(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=kc(n[r],e[r]);return t}function kc(n,e){if(n===e)return!0;let t=Oy(n),r=Oy(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=us(n),r=us(e),t||r)return n===e;if(t=Ge(n),r=Ge(e),t||r)return t&&r?uS(n,e):!1;if(t=Jt(n),r=Jt(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!kc(n[o],e[o]))return!1}}return String(n)===String(e)}function Qm(n,e){return n.findIndex(t=>kc(t,e))}const tw=n=>!!(n&&n.__v_isRef===!0),oe=n=>gn(n)?n:n==null?"":Ge(n)||Jt(n)&&(n.toString===Xb||!st(n.toString))?tw(n)?oe(n.value):JSON.stringify(n,nw,2):String(n),nw=(n,e)=>tw(e)?nw(n,e.value):cl(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[rp(r,i)+" =>"]=s,t),{})}:jl(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>rp(t))}:us(e)?rp(e):Jt(e)&&!Ge(e)&&!Zb(e)?String(e):e,rp=(n,e="")=>{var t;return us(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Tr;class cS{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Tr,!e&&Tr&&(this.index=(Tr.scopes||(Tr.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=Tr;try{return Tr=this,e()}finally{Tr=t}}}on(){++this._on===1&&(this.prevScope=Tr,Tr=this)}off(){this._on>0&&--this._on===0&&(Tr=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function dS(){return Tr}let Zt;const sp=new WeakSet;class rw{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Tr&&Tr.active&&Tr.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,sp.has(this)&&(sp.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||iw(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,My(this),ow(this);const e=Zt,t=as;Zt=this,as=!0;try{return this.fn()}finally{aw(this),Zt=e,as=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Xm(e);this.deps=this.depsTail=void 0,My(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?sp.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Hp(this)&&this.run()}get dirty(){return Hp(this)}}let sw=0,Vu,Mu;function iw(n,e=!1){if(n.flags|=8,e){n.next=Mu,Mu=n;return}n.next=Vu,Vu=n}function Jm(){sw++}function Ym(){if(--sw>0)return;if(Mu){let e=Mu;for(Mu=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;Vu;){let e=Vu;for(Vu=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function ow(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function aw(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),Xm(r),hS(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function Hp(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(lw(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function lw(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===Yu)||(n.globalVersion=Yu,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!Hp(n))))return;n.flags|=2;const e=n.dep,t=Zt,r=as;Zt=n,as=!0;try{ow(n);const s=n.fn(n._value);(e.version===0||eo(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{Zt=t,as=r,aw(n),n.flags&=-3}}function Xm(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)Xm(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function hS(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let as=!0;const uw=[];function ii(){uw.push(as),as=!1}function oi(){const n=uw.pop();as=n===void 0?!0:n}function My(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=Zt;Zt=void 0;try{e()}finally{Zt=t}}}let Yu=0;class fS{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Zm{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Zt||!as||Zt===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Zt)t=this.activeLink=new fS(Zt,this),Zt.deps?(t.prevDep=Zt.depsTail,Zt.depsTail.nextDep=t,Zt.depsTail=t):Zt.deps=Zt.depsTail=t,cw(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=Zt.depsTail,t.nextDep=void 0,Zt.depsTail.nextDep=t,Zt.depsTail=t,Zt.deps===t&&(Zt.deps=r)}return t}trigger(e){this.version++,Yu++,this.notify(e)}notify(e){Jm();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{Ym()}}}function cw(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)cw(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const Kp=new WeakMap,ra=Symbol(""),Gp=Symbol(""),Xu=Symbol("");function lr(n,e,t){if(as&&Zt){let r=Kp.get(n);r||Kp.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new Zm),s.map=r,s.key=t),s.track()}}function Ws(n,e,t,r,s,i){const o=Kp.get(n);if(!o){Yu++;return}const a=l=>{l&&l.trigger()};if(Jm(),e==="clear")o.forEach(a);else{const l=Ge(n),d=l&&Wm(t);if(l&&t==="length"){const h=Number(r);o.forEach((f,g)=>{(g==="length"||g===Xu||!us(g)&&g>=h)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),d&&a(o.get(Xu)),e){case"add":l?d&&a(o.get("length")):(a(o.get(ra)),cl(n)&&a(o.get(Gp)));break;case"delete":l||(a(o.get(ra)),cl(n)&&a(o.get(Gp)));break;case"set":cl(n)&&a(o.get(ra));break}}Ym()}function Qa(n){const e=Vt(n);return e===n?e:(lr(e,"iterate",Xu),Qr(n)?e:e.map(Xn))}function Hh(n){return lr(n=Vt(n),"iterate",Xu),n}const pS={__proto__:null,[Symbol.iterator](){return ip(this,Symbol.iterator,Xn)},concat(...n){return Qa(this).concat(...n.map(e=>Ge(e)?Qa(e):e))},entries(){return ip(this,"entries",n=>(n[1]=Xn(n[1]),n))},every(n,e){return qs(this,"every",n,e,void 0,arguments)},filter(n,e){return qs(this,"filter",n,e,t=>t.map(Xn),arguments)},find(n,e){return qs(this,"find",n,e,Xn,arguments)},findIndex(n,e){return qs(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return qs(this,"findLast",n,e,Xn,arguments)},findLastIndex(n,e){return qs(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return qs(this,"forEach",n,e,void 0,arguments)},includes(...n){return op(this,"includes",n)},indexOf(...n){return op(this,"indexOf",n)},join(n){return Qa(this).join(n)},lastIndexOf(...n){return op(this,"lastIndexOf",n)},map(n,e){return qs(this,"map",n,e,void 0,arguments)},pop(){return pu(this,"pop")},push(...n){return pu(this,"push",n)},reduce(n,...e){return Ly(this,"reduce",n,e)},reduceRight(n,...e){return Ly(this,"reduceRight",n,e)},shift(){return pu(this,"shift")},some(n,e){return qs(this,"some",n,e,void 0,arguments)},splice(...n){return pu(this,"splice",n)},toReversed(){return Qa(this).toReversed()},toSorted(n){return Qa(this).toSorted(n)},toSpliced(...n){return Qa(this).toSpliced(...n)},unshift(...n){return pu(this,"unshift",n)},values(){return ip(this,"values",Xn)}};function ip(n,e,t){const r=Hh(n),s=r[e]();return r!==n&&!Qr(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const mS=Array.prototype;function qs(n,e,t,r,s,i){const o=Hh(n),a=o!==n&&!Qr(n),l=o[e];if(l!==mS[e]){const f=l.apply(n,i);return a?Xn(f):f}let d=t;o!==n&&(a?d=function(f,g){return t.call(this,Xn(f),g,n)}:t.length>2&&(d=function(f,g){return t.call(this,f,g,n)}));const h=l.call(o,d,r);return a&&s?s(h):h}function Ly(n,e,t,r){const s=Hh(n);let i=t;return s!==n&&(Qr(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,Xn(a),l,n)}),s[e](i,...r)}function op(n,e,t){const r=Vt(n);lr(r,"iterate",Xu);const s=r[e](...t);return(s===-1||s===!1)&&ng(t[0])?(t[0]=Vt(t[0]),r[e](...t)):s}function pu(n,e,t=[]){ii(),Jm();const r=Vt(n)[e].apply(n,t);return Ym(),oi(),r}const gS=Hm("__proto__,__v_isRef,__isVue"),dw=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(us));function vS(n){us(n)||(n=String(n));const e=Vt(this);return lr(e,"has",n),e.hasOwnProperty(n)}class hw{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?SS:gw:i?mw:pw).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=Ge(e);if(!s){let l;if(o&&(l=pS[t]))return l;if(t==="hasOwnProperty")return vS}const a=Reflect.get(e,t,cr(e)?e:r);return(us(t)?dw.has(t):gS(t))||(s||lr(e,"get",t),i)?a:cr(a)?o&&Wm(t)?a:a.value:Jt(a)?s?yw(a):Kh(a):a}}class fw extends hw{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=so(i);if(!Qr(r)&&!so(r)&&(i=Vt(i),r=Vt(r)),!Ge(e)&&cr(i)&&!cr(r))return l?!1:(i.value=r,!0)}const o=Ge(e)&&Wm(t)?Number(t)<e.length:Ft(e,t),a=Reflect.set(e,t,r,cr(e)?e:s);return e===Vt(s)&&(o?eo(r,i)&&Ws(e,"set",t,r):Ws(e,"add",t,r)),a}deleteProperty(e,t){const r=Ft(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&Ws(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!us(t)||!dw.has(t))&&lr(e,"has",t),r}ownKeys(e){return lr(e,"iterate",Ge(e)?"length":ra),Reflect.ownKeys(e)}}class yS extends hw{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const _S=new fw,bS=new yS,wS=new fw(!0);const Wp=n=>n,xd=n=>Reflect.getPrototypeOf(n);function xS(n,e,t){return function(...r){const s=this.__v_raw,i=Vt(s),o=cl(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,d=s[n](...r),h=t?Wp:e?ah:Xn;return!e&&lr(i,"iterate",l?Gp:ra),{next(){const{value:f,done:g}=d.next();return g?{value:f,done:g}:{value:a?[h(f[0]),h(f[1])]:h(f),done:g}},[Symbol.iterator](){return this}}}}function Ed(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function ES(n,e){const t={get(s){const i=this.__v_raw,o=Vt(i),a=Vt(s);n||(eo(s,a)&&lr(o,"get",s),lr(o,"get",a));const{has:l}=xd(o),d=e?Wp:n?ah:Xn;if(l.call(o,s))return d(i.get(s));if(l.call(o,a))return d(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&lr(Vt(s),"iterate",ra),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=Vt(i),a=Vt(s);return n||(eo(s,a)&&lr(o,"has",s),lr(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=Vt(a),d=e?Wp:n?ah:Xn;return!n&&lr(l,"iterate",ra),a.forEach((h,f)=>s.call(i,d(h),d(f),o))}};return Nn(t,n?{add:Ed("add"),set:Ed("set"),delete:Ed("delete"),clear:Ed("clear")}:{add(s){!e&&!Qr(s)&&!so(s)&&(s=Vt(s));const i=Vt(this);return xd(i).has.call(i,s)||(i.add(s),Ws(i,"add",s,s)),this},set(s,i){!e&&!Qr(i)&&!so(i)&&(i=Vt(i));const o=Vt(this),{has:a,get:l}=xd(o);let d=a.call(o,s);d||(s=Vt(s),d=a.call(o,s));const h=l.call(o,s);return o.set(s,i),d?eo(i,h)&&Ws(o,"set",s,i):Ws(o,"add",s,i),this},delete(s){const i=Vt(this),{has:o,get:a}=xd(i);let l=o.call(i,s);l||(s=Vt(s),l=o.call(i,s)),a&&a.call(i,s);const d=i.delete(s);return l&&Ws(i,"delete",s,void 0),d},clear(){const s=Vt(this),i=s.size!==0,o=s.clear();return i&&Ws(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=xS(s,n,e)}),t}function eg(n,e){const t=ES(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(Ft(t,s)&&s in r?t:r,s,i)}const IS={get:eg(!1,!1)},TS={get:eg(!1,!0)},AS={get:eg(!0,!1)};const pw=new WeakMap,mw=new WeakMap,gw=new WeakMap,SS=new WeakMap;function PS(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function RS(n){return n.__v_skip||!Object.isExtensible(n)?0:PS(Z1(n))}function Kh(n){return so(n)?n:tg(n,!1,_S,IS,pw)}function vw(n){return tg(n,!1,wS,TS,mw)}function yw(n){return tg(n,!0,bS,AS,gw)}function tg(n,e,t,r,s){if(!Jt(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=RS(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function dl(n){return so(n)?dl(n.__v_raw):!!(n&&n.__v_isReactive)}function so(n){return!!(n&&n.__v_isReadonly)}function Qr(n){return!!(n&&n.__v_isShallow)}function ng(n){return n?!!n.__v_raw:!1}function Vt(n){const e=n&&n.__v_raw;return e?Vt(e):n}function CS(n){return!Ft(n,"__v_skip")&&Object.isExtensible(n)&&zp(n,"__v_skip",!0),n}const Xn=n=>Jt(n)?Kh(n):n,ah=n=>Jt(n)?yw(n):n;function cr(n){return n?n.__v_isRef===!0:!1}function S(n){return _w(n,!1)}function kS(n){return _w(n,!0)}function _w(n,e){return cr(n)?n:new DS(n,e)}class DS{constructor(e,t){this.dep=new Zm,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Vt(e),this._value=t?e:Xn(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||Qr(e)||so(e);e=r?e:Vt(e),eo(e,t)&&(this._rawValue=e,this._value=r?e:Xn(e),this.dep.trigger())}}function $r(n){return cr(n)?n.value:n}const NS={get:(n,e,t)=>e==="__v_raw"?n:$r(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return cr(s)&&!cr(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function bw(n){return dl(n)?n:new Proxy(n,NS)}class OS{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Zm(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Yu-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&Zt!==this)return iw(this,!0),!0}get value(){const e=this.dep.track();return lw(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function VS(n,e,t=!1){let r,s;return st(n)?r=n:(r=n.get,s=n.set),new OS(r,s,t)}const Id={},lh=new WeakMap;let qo;function MS(n,e=!1,t=qo){if(t){let r=lh.get(t);r||lh.set(t,r=[]),r.push(n)}}function LS(n,e,t=Wt){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,d=j=>s?j:Qr(j)||s===!1||s===0?Qs(j,1):Qs(j);let h,f,g,v,w=!1,b=!1;if(cr(n)?(f=()=>n.value,w=Qr(n)):dl(n)?(f=()=>d(n),w=!0):Ge(n)?(b=!0,w=n.some(j=>dl(j)||Qr(j)),f=()=>n.map(j=>{if(cr(j))return j.value;if(dl(j))return d(j);if(st(j))return l?l(j,2):j()})):st(n)?e?f=l?()=>l(n,2):n:f=()=>{if(g){ii();try{g()}finally{oi()}}const j=qo;qo=h;try{return l?l(n,3,[v]):n(v)}finally{qo=j}}:f=os,e&&s){const j=f,de=s===!0?1/0:s;f=()=>Qs(j(),de)}const x=dS(),M=()=>{h.stop(),x&&x.active&&Gm(x.effects,h)};if(i&&e){const j=e;e=(...de)=>{j(...de),M()}}let O=b?new Array(n.length).fill(Id):Id;const A=j=>{if(!(!(h.flags&1)||!h.dirty&&!j))if(e){const de=h.run();if(s||w||(b?de.some((re,k)=>eo(re,O[k])):eo(de,O))){g&&g();const re=qo;qo=h;try{const k=[de,O===Id?void 0:b&&O[0]===Id?[]:O,v];O=de,l?l(e,3,k):e(...k)}finally{qo=re}}}else h.run()};return a&&a(A),h=new rw(f),h.scheduler=o?()=>o(A,!1):A,v=j=>MS(j,!1,h),g=h.onStop=()=>{const j=lh.get(h);if(j){if(l)l(j,4);else for(const de of j)de();lh.delete(h)}},e?r?A(!0):O=h.run():o?o(A.bind(null,!0),!0):h.run(),M.pause=h.pause.bind(h),M.resume=h.resume.bind(h),M.stop=M,M}function Qs(n,e=1/0,t){if(e<=0||!Jt(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,cr(n))Qs(n.value,e,t);else if(Ge(n))for(let r=0;r<n.length;r++)Qs(n[r],e,t);else if(jl(n)||cl(n))n.forEach(r=>{Qs(r,e,t)});else if(Zb(n)){for(const r in n)Qs(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&Qs(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Dc(n,e,t,r){try{return r?n(...r):n()}catch(s){Gh(s,e,t)}}function cs(n,e,t,r){if(st(n)){const s=Dc(n,e,t,r);return s&&Yb(s)&&s.catch(i=>{Gh(i,e,t)}),s}if(Ge(n)){const s=[];for(let i=0;i<n.length;i++)s.push(cs(n[i],e,t,r));return s}}function Gh(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||Wt;if(e){let a=e.parent;const l=e.proxy,d=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const h=a.ec;if(h){for(let f=0;f<h.length;f++)if(h[f](n,l,d)===!1)return}a=a.parent}if(i){ii(),Dc(i,null,10,[n,l,d]),oi();return}}$S(n,t,s,r,o)}function $S(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const br=[];let Es=-1;const hl=[];let Ui=null,el=0;const ww=Promise.resolve();let uh=null;function Bt(n){const e=uh||ww;return n?e.then(this?n.bind(this):n):e}function FS(n){let e=Es+1,t=br.length;for(;e<t;){const r=e+t>>>1,s=br[r],i=Zu(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function rg(n){if(!(n.flags&1)){const e=Zu(n),t=br[br.length-1];!t||!(n.flags&2)&&e>=Zu(t)?br.push(n):br.splice(FS(e),0,n),n.flags|=1,xw()}}function xw(){uh||(uh=ww.then(Iw))}function US(n){Ge(n)?hl.push(...n):Ui&&n.id===-1?Ui.splice(el+1,0,n):n.flags&1||(hl.push(n),n.flags|=1),xw()}function $y(n,e,t=Es+1){for(;t<br.length;t++){const r=br[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;br.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function Ew(n){if(hl.length){const e=[...new Set(hl)].sort((t,r)=>Zu(t)-Zu(r));if(hl.length=0,Ui){Ui.push(...e);return}for(Ui=e,el=0;el<Ui.length;el++){const t=Ui[el];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Ui=null,el=0}}const Zu=n=>n.id==null?n.flags&2?-1:1/0:n.id;function Iw(n){const e=os;try{for(Es=0;Es<br.length;Es++){const t=br[Es];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),Dc(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;Es<br.length;Es++){const t=br[Es];t&&(t.flags&=-2)}Es=-1,br.length=0,Ew(),uh=null,(br.length||hl.length)&&Iw()}}let Hn=null,Tw=null;function ch(n){const e=Hn;return Hn=n,Tw=n&&n.type.__scopeId||null,e}function Ud(n,e=Hn,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&Yy(-1);const i=ch(e);let o;try{o=n(...s)}finally{ch(i),r._d&&Yy(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function tt(n,e){if(Hn===null)return n;const t=Xh(Hn),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=Wt]=e[s];i&&(st(i)&&(i={mounted:i,updated:i}),i.deep&&Qs(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function $o(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(ii(),cs(l,t,8,[n.el,a,n,e]),oi())}}const Aw=Symbol("_vte"),Sw=n=>n.__isTeleport,Lu=n=>n&&(n.disabled||n.disabled===""),Fy=n=>n&&(n.defer||n.defer===""),Uy=n=>typeof SVGElement<"u"&&n instanceof SVGElement,jy=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,Qp=(n,e)=>{const t=n&&n.to;return gn(t)?e?e(t):null:t},Pw={name:"Teleport",__isTeleport:!0,process(n,e,t,r,s,i,o,a,l,d){const{mc:h,pc:f,pbc:g,o:{insert:v,querySelector:w,createText:b,createComment:x}}=d,M=Lu(e.props);let{shapeFlag:O,children:A,dynamicChildren:j}=e;if(n==null){const de=e.el=b(""),re=e.anchor=b("");v(de,t,r),v(re,t,r);const k=(T,V)=>{O&16&&(s&&s.isCE&&(s.ce._teleportTarget=T),h(A,T,V,s,i,o,a,l))},I=()=>{const T=e.target=Qp(e.props,w),V=Rw(T,e,b,v);T&&(o!=="svg"&&Uy(T)?o="svg":o!=="mathml"&&jy(T)&&(o="mathml"),M||(k(T,V),jd(e,!1)))};M&&(k(t,re),jd(e,!0)),Fy(e.props)?(e.el.__isMounted=!1,yr(()=>{I(),delete e.el.__isMounted},i)):I()}else{if(Fy(e.props)&&n.el.__isMounted===!1){yr(()=>{Pw.process(n,e,t,r,s,i,o,a,l,d)},i);return}e.el=n.el,e.targetStart=n.targetStart;const de=e.anchor=n.anchor,re=e.target=n.target,k=e.targetAnchor=n.targetAnchor,I=Lu(n.props),T=I?t:re,V=I?de:k;if(o==="svg"||Uy(re)?o="svg":(o==="mathml"||jy(re))&&(o="mathml"),j?(g(n.dynamicChildren,j,T,s,i,o,a),lg(n,e,!0)):l||f(n,e,T,V,s,i,o,a,!1),M)I?e.props&&n.props&&e.props.to!==n.props.to&&(e.props.to=n.props.to):Td(e,t,de,d,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const U=e.target=Qp(e.props,w);U&&Td(e,U,null,d,0)}else I&&Td(e,re,k,d,1);jd(e,M)}},remove(n,e,t,{um:r,o:{remove:s}},i){const{shapeFlag:o,children:a,anchor:l,targetStart:d,targetAnchor:h,target:f,props:g}=n;if(f&&(s(d),s(h)),i&&s(l),o&16){const v=i||!Lu(g);for(let w=0;w<a.length;w++){const b=a[w];r(b,e,t,v,!!b.dynamicChildren)}}},move:Td,hydrate:jS};function Td(n,e,t,{o:{insert:r},m:s},i=2){i===0&&r(n.targetAnchor,e,t);const{el:o,anchor:a,shapeFlag:l,children:d,props:h}=n,f=i===2;if(f&&r(o,e,t),(!f||Lu(h))&&l&16)for(let g=0;g<d.length;g++)s(d[g],e,t,2);f&&r(a,e,t)}function jS(n,e,t,r,s,i,{o:{nextSibling:o,parentNode:a,querySelector:l,insert:d,createText:h}},f){const g=e.target=Qp(e.props,l);if(g){const v=Lu(e.props),w=g._lpa||g.firstChild;if(e.shapeFlag&16)if(v)e.anchor=f(o(n),e,a(n),t,r,s,i),e.targetStart=w,e.targetAnchor=w&&o(w);else{e.anchor=o(n);let b=w;for(;b;){if(b&&b.nodeType===8){if(b.data==="teleport start anchor")e.targetStart=b;else if(b.data==="teleport anchor"){e.targetAnchor=b,g._lpa=e.targetAnchor&&o(e.targetAnchor);break}}b=o(b)}e.targetAnchor||Rw(g,e,h,d),f(w&&o(w),e,g,t,r,s,i)}jd(e,v)}return e.anchor&&o(e.anchor)}const ec=Pw;function jd(n,e){const t=n.ctx;if(t&&t.ut){let r,s;for(e?(r=n.el,s=n.anchor):(r=n.targetStart,s=n.targetAnchor);r&&r!==s;)r.nodeType===1&&r.setAttribute("data-v-owner",t.uid),r=r.nextSibling;t.ut()}}function Rw(n,e,t,r){const s=e.targetStart=t(""),i=e.targetAnchor=t("");return s[Aw]=i,n&&(r(s,n),r(i,n)),i}const ji=Symbol("_leaveCb"),Ad=Symbol("_enterCb");function BS(){const n={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Sn(()=>{n.isMounted=!0}),sg(()=>{n.isUnmounting=!0}),n}const Gr=[Function,Array],Cw={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Gr,onEnter:Gr,onAfterEnter:Gr,onEnterCancelled:Gr,onBeforeLeave:Gr,onLeave:Gr,onAfterLeave:Gr,onLeaveCancelled:Gr,onBeforeAppear:Gr,onAppear:Gr,onAfterAppear:Gr,onAppearCancelled:Gr},kw=n=>{const e=n.subTree;return e.component?kw(e.component):e},qS={name:"BaseTransition",props:Cw,setup(n,{slots:e}){const t=UP(),r=BS();return()=>{const s=e.default&&Ow(e.default(),!0);if(!s||!s.length)return;const i=Dw(s),o=Vt(n),{mode:a}=o;if(r.isLeaving)return ap(i);const l=By(i);if(!l)return ap(i);let d=Jp(l,o,r,t,f=>d=f);l.type!==ur&&tc(l,d);let h=t.subTree&&By(t.subTree);if(h&&h.type!==ur&&!Wo(l,h)&&kw(t).type!==ur){let f=Jp(h,o,r,t);if(tc(h,f),a==="out-in"&&l.type!==ur)return r.isLeaving=!0,f.afterLeave=()=>{r.isLeaving=!1,t.job.flags&8||t.update(),delete f.afterLeave,h=void 0},ap(i);a==="in-out"&&l.type!==ur?f.delayLeave=(g,v,w)=>{const b=Nw(r,h);b[String(h.key)]=h,g[ji]=()=>{v(),g[ji]=void 0,delete d.delayedLeave,h=void 0},d.delayedLeave=()=>{w(),delete d.delayedLeave,h=void 0}}:h=void 0}else h&&(h=void 0);return i}}};function Dw(n){let e=n[0];if(n.length>1){for(const t of n)if(t.type!==ur){e=t;break}}return e}const zS=qS;function Nw(n,e){const{leavingVNodes:t}=n;let r=t.get(e.type);return r||(r=Object.create(null),t.set(e.type,r)),r}function Jp(n,e,t,r,s){const{appear:i,mode:o,persisted:a=!1,onBeforeEnter:l,onEnter:d,onAfterEnter:h,onEnterCancelled:f,onBeforeLeave:g,onLeave:v,onAfterLeave:w,onLeaveCancelled:b,onBeforeAppear:x,onAppear:M,onAfterAppear:O,onAppearCancelled:A}=e,j=String(n.key),de=Nw(t,n),re=(T,V)=>{T&&cs(T,r,9,V)},k=(T,V)=>{const U=V[1];re(T,V),Ge(T)?T.every($=>$.length<=1)&&U():T.length<=1&&U()},I={mode:o,persisted:a,beforeEnter(T){let V=l;if(!t.isMounted)if(i)V=x||l;else return;T[ji]&&T[ji](!0);const U=de[j];U&&Wo(n,U)&&U.el[ji]&&U.el[ji](),re(V,[T])},enter(T){let V=d,U=h,$=f;if(!t.isMounted)if(i)V=M||d,U=O||h,$=A||f;else return;let D=!1;const je=T[Ad]=Tt=>{D||(D=!0,Tt?re($,[T]):re(U,[T]),I.delayedLeave&&I.delayedLeave(),T[Ad]=void 0)};V?k(V,[T,je]):je()},leave(T,V){const U=String(n.key);if(T[Ad]&&T[Ad](!0),t.isUnmounting)return V();re(g,[T]);let $=!1;const D=T[ji]=je=>{$||($=!0,V(),je?re(b,[T]):re(w,[T]),T[ji]=void 0,de[U]===n&&delete de[U])};de[U]=n,v?k(v,[T,D]):D()},clone(T){const V=Jp(T,e,t,r,s);return s&&s(V),V}};return I}function ap(n){if(Wh(n))return n=io(n),n.children=null,n}function By(n){if(!Wh(n))return Sw(n.type)&&n.children?Dw(n.children):n;if(n.component)return n.component.subTree;const{shapeFlag:e,children:t}=n;if(t){if(e&16)return t[0];if(e&32&&st(t.default))return t.default()}}function tc(n,e){n.shapeFlag&6&&n.component?(n.transition=e,tc(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}function Ow(n,e=!1,t){let r=[],s=0;for(let i=0;i<n.length;i++){let o=n[i];const a=t==null?o.key:String(t)+String(o.key!=null?o.key:i);o.type===xt?(o.patchFlag&128&&s++,r=r.concat(Ow(o.children,e,a))):(e||o.type!==ur)&&r.push(a!=null?io(o,{key:a}):o)}if(s>1)for(let i=0;i<r.length;i++)r[i].patchFlag=-2;return r}/*! #__NO_SIDE_EFFECTS__ */function Vw(n,e){return st(n)?(()=>Nn({name:n.name},e,{setup:n}))():n}function Mw(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function $u(n,e,t,r,s=!1){if(Ge(n)){n.forEach((w,b)=>$u(w,e&&(Ge(e)?e[b]:e),t,r,s));return}if(fl(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&$u(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?Xh(r.component):r.el,o=s?null:i,{i:a,r:l}=n,d=e&&e.r,h=a.refs===Wt?a.refs={}:a.refs,f=a.setupState,g=Vt(f),v=f===Wt?()=>!1:w=>Ft(g,w);if(d!=null&&d!==l&&(gn(d)?(h[d]=null,v(d)&&(f[d]=null)):cr(d)&&(d.value=null)),st(l))Dc(l,a,12,[o,h]);else{const w=gn(l),b=cr(l);if(w||b){const x=()=>{if(n.f){const M=w?v(l)?f[l]:h[l]:l.value;s?Ge(M)&&Gm(M,i):Ge(M)?M.includes(i)||M.push(i):w?(h[l]=[i],v(l)&&(f[l]=h[l])):(l.value=[i],n.k&&(h[n.k]=l.value))}else w?(h[l]=o,v(l)&&(f[l]=o)):b&&(l.value=o,n.k&&(h[n.k]=o))};o?(x.id=-1,yr(x,t)):x()}}}zh().requestIdleCallback;zh().cancelIdleCallback;const fl=n=>!!n.type.__asyncLoader,Wh=n=>n.type.__isKeepAlive;function HS(n,e){Lw(n,"a",e)}function KS(n,e){Lw(n,"da",e)}function Lw(n,e,t=Zn){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(Qh(e,r,t),t){let s=t.parent;for(;s&&s.parent;)Wh(s.parent.vnode)&&GS(r,e,t,s),s=s.parent}}function GS(n,e,t,r){const s=Qh(e,n,r,!0);ei(()=>{Gm(r[e],s)},t)}function Qh(n,e,t=Zn,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{ii();const a=Nc(t),l=cs(e,t,n,o);return a(),oi(),l});return r?s.unshift(i):s.push(i),i}}const fi=n=>(e,t=Zn)=>{(!sc||n==="sp")&&Qh(n,(...r)=>e(...r),t)},WS=fi("bm"),Sn=fi("m"),QS=fi("bu"),JS=fi("u"),sg=fi("bum"),ei=fi("um"),YS=fi("sp"),XS=fi("rtg"),ZS=fi("rtc");function eP(n,e=Zn){Qh("ec",n,e)}const $w="components";function tP(n,e){return rP($w,n,!0,e)||n}const nP=Symbol.for("v-ndc");function rP(n,e,t=!0,r=!1){const s=Hn||Zn;if(s){const i=s.type;if(n===$w){const a=HP(i,!1);if(a&&(a===e||a===Xr(e)||a===qh(Xr(e))))return i}const o=qy(s[n]||i[n],e)||qy(s.appContext[n],e);return!o&&r?i:o}}function qy(n,e){return n&&(n[e]||n[Xr(e)]||n[qh(Xr(e))])}function Lr(n,e,t,r){let s;const i=t&&t[r],o=Ge(n);if(o||gn(n)){const a=o&&dl(n);let l=!1,d=!1;a&&(l=!Qr(n),d=so(n),n=Hh(n)),s=new Array(n.length);for(let h=0,f=n.length;h<f;h++)s[h]=e(l?d?ah(Xn(n[h])):Xn(n[h]):n[h],h,void 0,i&&i[h])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(Jt(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,d=a.length;l<d;l++){const h=a[l];s[l]=e(n[h],h,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}function sP(n,e,t={},r,s){if(Hn.ce||Hn.parent&&fl(Hn.parent)&&Hn.parent.ce)return e!=="default"&&(t.name=e),C(),ti(xt,null,[Be("slot",t,r&&r())],64);let i=n[e];i&&i._c&&(i._d=!1),C();const o=i&&Fw(i(t)),a=t.key||o&&o.key,l=ti(xt,{key:(a&&!us(a)?a:`_${e}`)+(!o&&r?"_fb":"")},o||(r?r():[]),o&&n._===1?64:-2);return!s&&l.scopeId&&(l.slotScopeIds=[l.scopeId+"-s"]),i&&i._c&&(i._d=!0),l}function Fw(n){return n.some(e=>rc(e)?!(e.type===ur||e.type===xt&&!Fw(e.children)):!0)?n:null}const Yp=n=>n?rx(n)?Xh(n):Yp(n.parent):null,Fu=Nn(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>Yp(n.parent),$root:n=>Yp(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>ig(n),$forceUpdate:n=>n.f||(n.f=()=>{rg(n.update)}),$nextTick:n=>n.n||(n.n=Bt.bind(n.proxy)),$watch:n=>TP.bind(n)}),lp=(n,e)=>n!==Wt&&!n.__isScriptSetup&&Ft(n,e),iP={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let d;if(e[0]!=="$"){const v=o[e];if(v!==void 0)switch(v){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(lp(r,e))return o[e]=1,r[e];if(s!==Wt&&Ft(s,e))return o[e]=2,s[e];if((d=n.propsOptions[0])&&Ft(d,e))return o[e]=3,i[e];if(t!==Wt&&Ft(t,e))return o[e]=4,t[e];Xp&&(o[e]=0)}}const h=Fu[e];let f,g;if(h)return e==="$attrs"&&lr(n.attrs,"get",""),h(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==Wt&&Ft(t,e))return o[e]=4,t[e];if(g=l.config.globalProperties,Ft(g,e))return g[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return lp(s,e)?(s[e]=t,!0):r!==Wt&&Ft(r,e)?(r[e]=t,!0):Ft(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==Wt&&Ft(n,o)||lp(e,o)||(a=i[0])&&Ft(a,o)||Ft(r,o)||Ft(Fu,o)||Ft(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:Ft(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function zy(n){return Ge(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let Xp=!0;function oP(n){const e=ig(n),t=n.proxy,r=n.ctx;Xp=!1,e.beforeCreate&&Hy(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:d,created:h,beforeMount:f,mounted:g,beforeUpdate:v,updated:w,activated:b,deactivated:x,beforeDestroy:M,beforeUnmount:O,destroyed:A,unmounted:j,render:de,renderTracked:re,renderTriggered:k,errorCaptured:I,serverPrefetch:T,expose:V,inheritAttrs:U,components:$,directives:D,filters:je}=e;if(d&&aP(d,r,null),o)for(const We in o){const se=o[We];st(se)&&(r[We]=se.bind(t))}if(s){const We=s.call(t,t);Jt(We)&&(n.data=Kh(We))}if(Xp=!0,i)for(const We in i){const se=i[We],B=st(se)?se.bind(t,t):st(se.get)?se.get.bind(t,t):os,Se=!st(se)&&st(se.set)?se.set.bind(t):os,ne=He({get:B,set:Se});Object.defineProperty(r,We,{enumerable:!0,configurable:!0,get:()=>ne.value,set:te=>ne.value=te})}if(a)for(const We in a)Uw(a[We],r,t,We);if(l){const We=st(l)?l.call(t):l;Reflect.ownKeys(We).forEach(se=>{Bd(se,We[se])})}h&&Hy(h,n,"c");function yt(We,se){Ge(se)?se.forEach(B=>We(B.bind(t))):se&&We(se.bind(t))}if(yt(WS,f),yt(Sn,g),yt(QS,v),yt(JS,w),yt(HS,b),yt(KS,x),yt(eP,I),yt(ZS,re),yt(XS,k),yt(sg,O),yt(ei,j),yt(YS,T),Ge(V))if(V.length){const We=n.exposed||(n.exposed={});V.forEach(se=>{Object.defineProperty(We,se,{get:()=>t[se],set:B=>t[se]=B})})}else n.exposed||(n.exposed={});de&&n.render===os&&(n.render=de),U!=null&&(n.inheritAttrs=U),$&&(n.components=$),D&&(n.directives=D),T&&Mw(n)}function aP(n,e,t=os){Ge(n)&&(n=Zp(n));for(const r in n){const s=n[r];let i;Jt(s)?"default"in s?i=ls(s.from||r,s.default,!0):i=ls(s.from||r):i=ls(s),cr(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function Hy(n,e,t){cs(Ge(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function Uw(n,e,t,r){let s=r.includes(".")?Xw(t,r):()=>t[r];if(gn(n)){const i=e[n];st(i)&&Nt(s,i)}else if(st(n))Nt(s,n.bind(t));else if(Jt(n))if(Ge(n))n.forEach(i=>Uw(i,e,t,r));else{const i=st(n.handler)?n.handler.bind(t):e[n.handler];st(i)&&Nt(s,i,n)}}function ig(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(d=>dh(l,d,o,!0)),dh(l,e,o)),Jt(e)&&i.set(e,l),l}function dh(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&dh(n,i,t,!0),s&&s.forEach(o=>dh(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=lP[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const lP={data:Ky,props:Gy,emits:Gy,methods:Au,computed:Au,beforeCreate:vr,created:vr,beforeMount:vr,mounted:vr,beforeUpdate:vr,updated:vr,beforeDestroy:vr,beforeUnmount:vr,destroyed:vr,unmounted:vr,activated:vr,deactivated:vr,errorCaptured:vr,serverPrefetch:vr,components:Au,directives:Au,watch:cP,provide:Ky,inject:uP};function Ky(n,e){return e?n?function(){return Nn(st(n)?n.call(this,this):n,st(e)?e.call(this,this):e)}:e:n}function uP(n,e){return Au(Zp(n),Zp(e))}function Zp(n){if(Ge(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function vr(n,e){return n?[...new Set([].concat(n,e))]:e}function Au(n,e){return n?Nn(Object.create(null),n,e):e}function Gy(n,e){return n?Ge(n)&&Ge(e)?[...new Set([...n,...e])]:Nn(Object.create(null),zy(n),zy(e??{})):e}function cP(n,e){if(!n)return e;if(!e)return n;const t=Nn(Object.create(null),n);for(const r in e)t[r]=vr(n[r],e[r]);return t}function jw(){return{app:null,config:{isNativeTag:Y1,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let dP=0;function hP(n,e){return function(r,s=null){st(r)||(r=Nn({},r)),s!=null&&!Jt(s)&&(s=null);const i=jw(),o=new WeakSet,a=[];let l=!1;const d=i.app={_uid:dP++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:GP,get config(){return i.config},set config(h){},use(h,...f){return o.has(h)||(h&&st(h.install)?(o.add(h),h.install(d,...f)):st(h)&&(o.add(h),h(d,...f))),d},mixin(h){return i.mixins.includes(h)||i.mixins.push(h),d},component(h,f){return f?(i.components[h]=f,d):i.components[h]},directive(h,f){return f?(i.directives[h]=f,d):i.directives[h]},mount(h,f,g){if(!l){const v=d._ceVNode||Be(r,s);return v.appContext=i,g===!0?g="svg":g===!1&&(g=void 0),f&&e?e(v,h):n(v,h,g),l=!0,d._container=h,h.__vue_app__=d,Xh(v.component)}},onUnmount(h){a.push(h)},unmount(){l&&(cs(a,d._instance,16),n(null,d._container),delete d._container.__vue_app__)},provide(h,f){return i.provides[h]=f,d},runWithContext(h){const f=pl;pl=d;try{return h()}finally{pl=f}}};return d}}let pl=null;function Bd(n,e){if(Zn){let t=Zn.provides;const r=Zn.parent&&Zn.parent.provides;r===t&&(t=Zn.provides=Object.create(r)),t[n]=e}}function ls(n,e,t=!1){const r=Zn||Hn;if(r||pl){let s=pl?pl._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&st(e)?e.call(r&&r.proxy):e}}const Bw={},qw=()=>Object.create(Bw),zw=n=>Object.getPrototypeOf(n)===Bw;function fP(n,e,t,r=!1){const s={},i=qw();n.propsDefaults=Object.create(null),Hw(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:vw(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function pP(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=Vt(s),[l]=n.propsOptions;let d=!1;if((r||o>0)&&!(o&16)){if(o&8){const h=n.vnode.dynamicProps;for(let f=0;f<h.length;f++){let g=h[f];if(Jh(n.emitsOptions,g))continue;const v=e[g];if(l)if(Ft(i,g))v!==i[g]&&(i[g]=v,d=!0);else{const w=Xr(g);s[w]=em(l,a,w,v,n,!1)}else v!==i[g]&&(i[g]=v,d=!0)}}}else{Hw(n,e,s,i)&&(d=!0);let h;for(const f in a)(!e||!Ft(e,f)&&((h=yo(f))===f||!Ft(e,h)))&&(l?t&&(t[f]!==void 0||t[h]!==void 0)&&(s[f]=em(l,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!Ft(e,f))&&(delete i[f],d=!0)}d&&Ws(n.attrs,"set","")}function Hw(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(Ou(l))continue;const d=e[l];let h;s&&Ft(s,h=Xr(l))?!i||!i.includes(h)?t[h]=d:(a||(a={}))[h]=d:Jh(n.emitsOptions,l)||(!(l in r)||d!==r[l])&&(r[l]=d,o=!0)}if(i){const l=Vt(t),d=a||Wt;for(let h=0;h<i.length;h++){const f=i[h];t[f]=em(s,l,f,d[f],n,!Ft(d,f))}}return o}function em(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=Ft(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&st(l)){const{propsDefaults:d}=s;if(t in d)r=d[t];else{const h=Nc(s);r=d[t]=l.call(null,e),h()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===yo(t))&&(r=!0))}return r}const mP=new WeakMap;function Kw(n,e,t=!1){const r=t?mP:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!st(n)){const h=f=>{l=!0;const[g,v]=Kw(f,e,!0);Nn(o,g),v&&a.push(...v)};!t&&e.mixins.length&&e.mixins.forEach(h),n.extends&&h(n.extends),n.mixins&&n.mixins.forEach(h)}if(!i&&!l)return Jt(n)&&r.set(n,ul),ul;if(Ge(i))for(let h=0;h<i.length;h++){const f=Xr(i[h]);Wy(f)&&(o[f]=Wt)}else if(i)for(const h in i){const f=Xr(h);if(Wy(f)){const g=i[h],v=o[f]=Ge(g)||st(g)?{type:g}:Nn({},g),w=v.type;let b=!1,x=!0;if(Ge(w))for(let M=0;M<w.length;++M){const O=w[M],A=st(O)&&O.name;if(A==="Boolean"){b=!0;break}else A==="String"&&(x=!1)}else b=st(w)&&w.name==="Boolean";v[0]=b,v[1]=x,(b||Ft(v,"default"))&&a.push(f)}}const d=[o,a];return Jt(n)&&r.set(n,d),d}function Wy(n){return n[0]!=="$"&&!Ou(n)}const og=n=>n[0]==="_"||n==="$stable",ag=n=>Ge(n)?n.map(Is):[Is(n)],gP=(n,e,t)=>{if(e._n)return e;const r=Ud((...s)=>ag(e(...s)),t);return r._c=!1,r},Gw=(n,e,t)=>{const r=n._ctx;for(const s in n){if(og(s))continue;const i=n[s];if(st(i))e[s]=gP(s,i,r);else if(i!=null){const o=ag(i);e[s]=()=>o}}},Ww=(n,e)=>{const t=ag(e);n.slots.default=()=>t},Qw=(n,e,t)=>{for(const r in e)(t||!og(r))&&(n[r]=e[r])},vP=(n,e,t)=>{const r=n.slots=qw();if(n.vnode.shapeFlag&32){const s=e.__;s&&zp(r,"__",s,!0);const i=e._;i?(Qw(r,e,t),t&&zp(r,"_",i,!0)):Gw(e,r)}else e&&Ww(n,e)},yP=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=Wt;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:Qw(s,e,t):(i=!e.$stable,Gw(e,s)),o=e}else e&&(Ww(n,e),o={default:1});if(i)for(const a in s)!og(a)&&o[a]==null&&delete s[a]},yr=DP;function _P(n){return bP(n)}function bP(n,e){const t=zh();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:d,setElementText:h,parentNode:f,nextSibling:g,setScopeId:v=os,insertStaticContent:w}=n,b=(R,F,G,he=null,le=null,fe=null,Ie=void 0,X=null,ve=!!F.dynamicChildren)=>{if(R===F)return;R&&!Wo(R,F)&&(he=J(R),te(R,le,fe,!0),R=null),F.patchFlag===-2&&(ve=!1,F.dynamicChildren=null);const{type:pe,ref:Ce,shapeFlag:_e}=F;switch(pe){case Yh:x(R,F,G,he);break;case ur:M(R,F,G,he);break;case qd:R==null&&O(F,G,he,Ie);break;case xt:$(R,F,G,he,le,fe,Ie,X,ve);break;default:_e&1?de(R,F,G,he,le,fe,Ie,X,ve):_e&6?D(R,F,G,he,le,fe,Ie,X,ve):(_e&64||_e&128)&&pe.process(R,F,G,he,le,fe,Ie,X,ve,Ne)}Ce!=null&&le?$u(Ce,R&&R.ref,fe,F||R,!F):Ce==null&&R&&R.ref!=null&&$u(R.ref,null,fe,R,!0)},x=(R,F,G,he)=>{if(R==null)r(F.el=a(F.children),G,he);else{const le=F.el=R.el;F.children!==R.children&&d(le,F.children)}},M=(R,F,G,he)=>{R==null?r(F.el=l(F.children||""),G,he):F.el=R.el},O=(R,F,G,he)=>{[R.el,R.anchor]=w(R.children,F,G,he,R.el,R.anchor)},A=({el:R,anchor:F},G,he)=>{let le;for(;R&&R!==F;)le=g(R),r(R,G,he),R=le;r(F,G,he)},j=({el:R,anchor:F})=>{let G;for(;R&&R!==F;)G=g(R),s(R),R=G;s(F)},de=(R,F,G,he,le,fe,Ie,X,ve)=>{F.type==="svg"?Ie="svg":F.type==="math"&&(Ie="mathml"),R==null?re(F,G,he,le,fe,Ie,X,ve):T(R,F,le,fe,Ie,X,ve)},re=(R,F,G,he,le,fe,Ie,X)=>{let ve,pe;const{props:Ce,shapeFlag:_e,transition:Oe,dirs:qe}=R;if(ve=R.el=o(R.type,fe,Ce&&Ce.is,Ce),_e&8?h(ve,R.children):_e&16&&I(R.children,ve,null,he,le,up(R,fe),Ie,X),qe&&$o(R,null,he,"created"),k(ve,R,R.scopeId,Ie,he),Ce){for(const Ze in Ce)Ze!=="value"&&!Ou(Ze)&&i(ve,Ze,null,Ce[Ze],fe,he);"value"in Ce&&i(ve,"value",null,Ce.value,fe),(pe=Ce.onVnodeBeforeMount)&&xs(pe,he,R)}qe&&$o(R,null,he,"beforeMount");const Ue=wP(le,Oe);Ue&&Oe.beforeEnter(ve),r(ve,F,G),((pe=Ce&&Ce.onVnodeMounted)||Ue||qe)&&yr(()=>{pe&&xs(pe,he,R),Ue&&Oe.enter(ve),qe&&$o(R,null,he,"mounted")},le)},k=(R,F,G,he,le)=>{if(G&&v(R,G),he)for(let fe=0;fe<he.length;fe++)v(R,he[fe]);if(le){let fe=le.subTree;if(F===fe||ex(fe.type)&&(fe.ssContent===F||fe.ssFallback===F)){const Ie=le.vnode;k(R,Ie,Ie.scopeId,Ie.slotScopeIds,le.parent)}}},I=(R,F,G,he,le,fe,Ie,X,ve=0)=>{for(let pe=ve;pe<R.length;pe++){const Ce=R[pe]=X?Bi(R[pe]):Is(R[pe]);b(null,Ce,F,G,he,le,fe,Ie,X)}},T=(R,F,G,he,le,fe,Ie)=>{const X=F.el=R.el;let{patchFlag:ve,dynamicChildren:pe,dirs:Ce}=F;ve|=R.patchFlag&16;const _e=R.props||Wt,Oe=F.props||Wt;let qe;if(G&&Fo(G,!1),(qe=Oe.onVnodeBeforeUpdate)&&xs(qe,G,F,R),Ce&&$o(F,R,G,"beforeUpdate"),G&&Fo(G,!0),(_e.innerHTML&&Oe.innerHTML==null||_e.textContent&&Oe.textContent==null)&&h(X,""),pe?V(R.dynamicChildren,pe,X,G,he,up(F,le),fe):Ie||se(R,F,X,null,G,he,up(F,le),fe,!1),ve>0){if(ve&16)U(X,_e,Oe,G,le);else if(ve&2&&_e.class!==Oe.class&&i(X,"class",null,Oe.class,le),ve&4&&i(X,"style",_e.style,Oe.style,le),ve&8){const Ue=F.dynamicProps;for(let Ze=0;Ze<Ue.length;Ze++){const ht=Ue[Ze],nn=_e[ht],Xt=Oe[ht];(Xt!==nn||ht==="value")&&i(X,ht,nn,Xt,le,G)}}ve&1&&R.children!==F.children&&h(X,F.children)}else!Ie&&pe==null&&U(X,_e,Oe,G,le);((qe=Oe.onVnodeUpdated)||Ce)&&yr(()=>{qe&&xs(qe,G,F,R),Ce&&$o(F,R,G,"updated")},he)},V=(R,F,G,he,le,fe,Ie)=>{for(let X=0;X<F.length;X++){const ve=R[X],pe=F[X],Ce=ve.el&&(ve.type===xt||!Wo(ve,pe)||ve.shapeFlag&198)?f(ve.el):G;b(ve,pe,Ce,null,he,le,fe,Ie,!0)}},U=(R,F,G,he,le)=>{if(F!==G){if(F!==Wt)for(const fe in F)!Ou(fe)&&!(fe in G)&&i(R,fe,F[fe],null,le,he);for(const fe in G){if(Ou(fe))continue;const Ie=G[fe],X=F[fe];Ie!==X&&fe!=="value"&&i(R,fe,X,Ie,le,he)}"value"in G&&i(R,"value",F.value,G.value,le)}},$=(R,F,G,he,le,fe,Ie,X,ve)=>{const pe=F.el=R?R.el:a(""),Ce=F.anchor=R?R.anchor:a("");let{patchFlag:_e,dynamicChildren:Oe,slotScopeIds:qe}=F;qe&&(X=X?X.concat(qe):qe),R==null?(r(pe,G,he),r(Ce,G,he),I(F.children||[],G,Ce,le,fe,Ie,X,ve)):_e>0&&_e&64&&Oe&&R.dynamicChildren?(V(R.dynamicChildren,Oe,G,le,fe,Ie,X),(F.key!=null||le&&F===le.subTree)&&lg(R,F,!0)):se(R,F,G,Ce,le,fe,Ie,X,ve)},D=(R,F,G,he,le,fe,Ie,X,ve)=>{F.slotScopeIds=X,R==null?F.shapeFlag&512?le.ctx.activate(F,G,he,Ie,ve):je(F,G,he,le,fe,Ie,ve):Tt(R,F,ve)},je=(R,F,G,he,le,fe,Ie)=>{const X=R.component=FP(R,he,le);if(Wh(R)&&(X.ctx.renderer=Ne),jP(X,!1,Ie),X.asyncDep){if(le&&le.registerDep(X,yt,Ie),!R.el){const ve=X.subTree=Be(ur);M(null,ve,F,G)}}else yt(X,R,F,G,le,fe,Ie)},Tt=(R,F,G)=>{const he=F.component=R.component;if(CP(R,F,G))if(he.asyncDep&&!he.asyncResolved){We(he,F,G);return}else he.next=F,he.update();else F.el=R.el,he.vnode=F},yt=(R,F,G,he,le,fe,Ie)=>{const X=()=>{if(R.isMounted){let{next:_e,bu:Oe,u:qe,parent:Ue,vnode:Ze}=R;{const zt=Jw(R);if(zt){_e&&(_e.el=Ze.el,We(R,_e,Ie)),zt.asyncDep.then(()=>{R.isUnmounted||X()});return}}let ht=_e,nn;Fo(R,!1),_e?(_e.el=Ze.el,We(R,_e,Ie)):_e=Ze,Oe&&Fd(Oe),(nn=_e.props&&_e.props.onVnodeBeforeUpdate)&&xs(nn,Ue,_e,Ze),Fo(R,!0);const Xt=cp(R),xn=R.subTree;R.subTree=Xt,b(xn,Xt,f(xn.el),J(xn),R,le,fe),_e.el=Xt.el,ht===null&&kP(R,Xt.el),qe&&yr(qe,le),(nn=_e.props&&_e.props.onVnodeUpdated)&&yr(()=>xs(nn,Ue,_e,Ze),le)}else{let _e;const{el:Oe,props:qe}=F,{bm:Ue,m:Ze,parent:ht,root:nn,type:Xt}=R,xn=fl(F);if(Fo(R,!1),Ue&&Fd(Ue),!xn&&(_e=qe&&qe.onVnodeBeforeMount)&&xs(_e,ht,F),Fo(R,!0),Oe&&bt){const zt=()=>{R.subTree=cp(R),bt(Oe,R.subTree,R,le,null)};xn&&Xt.__asyncHydrate?Xt.__asyncHydrate(Oe,R,zt):zt()}else{nn.ce&&nn.ce._def.shadowRoot!==!1&&nn.ce._injectChildStyle(Xt);const zt=R.subTree=cp(R);b(null,zt,G,he,R,le,fe),F.el=zt.el}if(Ze&&yr(Ze,le),!xn&&(_e=qe&&qe.onVnodeMounted)){const zt=F;yr(()=>xs(_e,ht,zt),le)}(F.shapeFlag&256||ht&&fl(ht.vnode)&&ht.vnode.shapeFlag&256)&&R.a&&yr(R.a,le),R.isMounted=!0,F=G=he=null}};R.scope.on();const ve=R.effect=new rw(X);R.scope.off();const pe=R.update=ve.run.bind(ve),Ce=R.job=ve.runIfDirty.bind(ve);Ce.i=R,Ce.id=R.uid,ve.scheduler=()=>rg(Ce),Fo(R,!0),pe()},We=(R,F,G)=>{F.component=R;const he=R.vnode.props;R.vnode=F,R.next=null,pP(R,F.props,he,G),yP(R,F.children,G),ii(),$y(R),oi()},se=(R,F,G,he,le,fe,Ie,X,ve=!1)=>{const pe=R&&R.children,Ce=R?R.shapeFlag:0,_e=F.children,{patchFlag:Oe,shapeFlag:qe}=F;if(Oe>0){if(Oe&128){Se(pe,_e,G,he,le,fe,Ie,X,ve);return}else if(Oe&256){B(pe,_e,G,he,le,fe,Ie,X,ve);return}}qe&8?(Ce&16&&St(pe,le,fe),_e!==pe&&h(G,_e)):Ce&16?qe&16?Se(pe,_e,G,he,le,fe,Ie,X,ve):St(pe,le,fe,!0):(Ce&8&&h(G,""),qe&16&&I(_e,G,he,le,fe,Ie,X,ve))},B=(R,F,G,he,le,fe,Ie,X,ve)=>{R=R||ul,F=F||ul;const pe=R.length,Ce=F.length,_e=Math.min(pe,Ce);let Oe;for(Oe=0;Oe<_e;Oe++){const qe=F[Oe]=ve?Bi(F[Oe]):Is(F[Oe]);b(R[Oe],qe,G,null,le,fe,Ie,X,ve)}pe>Ce?St(R,le,fe,!0,!1,_e):I(F,G,he,le,fe,Ie,X,ve,_e)},Se=(R,F,G,he,le,fe,Ie,X,ve)=>{let pe=0;const Ce=F.length;let _e=R.length-1,Oe=Ce-1;for(;pe<=_e&&pe<=Oe;){const qe=R[pe],Ue=F[pe]=ve?Bi(F[pe]):Is(F[pe]);if(Wo(qe,Ue))b(qe,Ue,G,null,le,fe,Ie,X,ve);else break;pe++}for(;pe<=_e&&pe<=Oe;){const qe=R[_e],Ue=F[Oe]=ve?Bi(F[Oe]):Is(F[Oe]);if(Wo(qe,Ue))b(qe,Ue,G,null,le,fe,Ie,X,ve);else break;_e--,Oe--}if(pe>_e){if(pe<=Oe){const qe=Oe+1,Ue=qe<Ce?F[qe].el:he;for(;pe<=Oe;)b(null,F[pe]=ve?Bi(F[pe]):Is(F[pe]),G,Ue,le,fe,Ie,X,ve),pe++}}else if(pe>Oe)for(;pe<=_e;)te(R[pe],le,fe,!0),pe++;else{const qe=pe,Ue=pe,Ze=new Map;for(pe=Ue;pe<=Oe;pe++){const cn=F[pe]=ve?Bi(F[pe]):Is(F[pe]);cn.key!=null&&Ze.set(cn.key,pe)}let ht,nn=0;const Xt=Oe-Ue+1;let xn=!1,zt=0;const pr=new Array(Xt);for(pe=0;pe<Xt;pe++)pr[pe]=0;for(pe=qe;pe<=_e;pe++){const cn=R[pe];if(nn>=Xt){te(cn,le,fe,!0);continue}let On;if(cn.key!=null)On=Ze.get(cn.key);else for(ht=Ue;ht<=Oe;ht++)if(pr[ht-Ue]===0&&Wo(cn,F[ht])){On=ht;break}On===void 0?te(cn,le,fe,!0):(pr[On-Ue]=pe+1,On>=zt?zt=On:xn=!0,b(cn,F[On],G,null,le,fe,Ie,X,ve),nn++)}const kr=xn?xP(pr):ul;for(ht=kr.length-1,pe=Xt-1;pe>=0;pe--){const cn=Ue+pe,On=F[cn],xi=cn+1<Ce?F[cn+1].el:he;pr[pe]===0?b(null,On,G,xi,le,fe,Ie,X,ve):xn&&(ht<0||pe!==kr[ht]?ne(On,G,xi,2):ht--)}}},ne=(R,F,G,he,le=null)=>{const{el:fe,type:Ie,transition:X,children:ve,shapeFlag:pe}=R;if(pe&6){ne(R.component.subTree,F,G,he);return}if(pe&128){R.suspense.move(F,G,he);return}if(pe&64){Ie.move(R,F,G,Ne);return}if(Ie===xt){r(fe,F,G);for(let _e=0;_e<ve.length;_e++)ne(ve[_e],F,G,he);r(R.anchor,F,G);return}if(Ie===qd){A(R,F,G);return}if(he!==2&&pe&1&&X)if(he===0)X.beforeEnter(fe),r(fe,F,G),yr(()=>X.enter(fe),le);else{const{leave:_e,delayLeave:Oe,afterLeave:qe}=X,Ue=()=>{R.ctx.isUnmounted?s(fe):r(fe,F,G)},Ze=()=>{_e(fe,()=>{Ue(),qe&&qe()})};Oe?Oe(fe,Ue,Ze):Ze()}else r(fe,F,G)},te=(R,F,G,he=!1,le=!1)=>{const{type:fe,props:Ie,ref:X,children:ve,dynamicChildren:pe,shapeFlag:Ce,patchFlag:_e,dirs:Oe,cacheIndex:qe}=R;if(_e===-2&&(le=!1),X!=null&&(ii(),$u(X,null,G,R,!0),oi()),qe!=null&&(F.renderCache[qe]=void 0),Ce&256){F.ctx.deactivate(R);return}const Ue=Ce&1&&Oe,Ze=!fl(R);let ht;if(Ze&&(ht=Ie&&Ie.onVnodeBeforeUnmount)&&xs(ht,F,R),Ce&6)At(R.component,G,he);else{if(Ce&128){R.suspense.unmount(G,he);return}Ue&&$o(R,null,F,"beforeUnmount"),Ce&64?R.type.remove(R,F,G,Ne,he):pe&&!pe.hasOnce&&(fe!==xt||_e>0&&_e&64)?St(pe,F,G,!1,!0):(fe===xt&&_e&384||!le&&Ce&16)&&St(ve,F,G),he&&De(R)}(Ze&&(ht=Ie&&Ie.onVnodeUnmounted)||Ue)&&yr(()=>{ht&&xs(ht,F,R),Ue&&$o(R,null,F,"unmounted")},G)},De=R=>{const{type:F,el:G,anchor:he,transition:le}=R;if(F===xt){gt(G,he);return}if(F===qd){j(R);return}const fe=()=>{s(G),le&&!le.persisted&&le.afterLeave&&le.afterLeave()};if(R.shapeFlag&1&&le&&!le.persisted){const{leave:Ie,delayLeave:X}=le,ve=()=>Ie(G,fe);X?X(R.el,fe,ve):ve()}else fe()},gt=(R,F)=>{let G;for(;R!==F;)G=g(R),s(R),R=G;s(F)},At=(R,F,G)=>{const{bum:he,scope:le,job:fe,subTree:Ie,um:X,m:ve,a:pe,parent:Ce,slots:{__:_e}}=R;Qy(ve),Qy(pe),he&&Fd(he),Ce&&Ge(_e)&&_e.forEach(Oe=>{Ce.renderCache[Oe]=void 0}),le.stop(),fe&&(fe.flags|=8,te(Ie,R,F,G)),X&&yr(X,F),yr(()=>{R.isUnmounted=!0},F),F&&F.pendingBranch&&!F.isUnmounted&&R.asyncDep&&!R.asyncResolved&&R.suspenseId===F.pendingId&&(F.deps--,F.deps===0&&F.resolve())},St=(R,F,G,he=!1,le=!1,fe=0)=>{for(let Ie=fe;Ie<R.length;Ie++)te(R[Ie],F,G,he,le)},J=R=>{if(R.shapeFlag&6)return J(R.component.subTree);if(R.shapeFlag&128)return R.suspense.next();const F=g(R.anchor||R.el),G=F&&F[Aw];return G?g(G):F};let xe=!1;const be=(R,F,G)=>{R==null?F._vnode&&te(F._vnode,null,null,!0):b(F._vnode||null,R,F,null,null,null,G),F._vnode=R,xe||(xe=!0,$y(),Ew(),xe=!1)},Ne={p:b,um:te,m:ne,r:De,mt:je,mc:I,pc:se,pbc:V,n:J,o:n};let ot,bt;return e&&([ot,bt]=e(Ne)),{render:be,hydrate:ot,createApp:hP(be,ot)}}function up({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function Fo({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function wP(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function lg(n,e,t=!1){const r=n.children,s=e.children;if(Ge(r)&&Ge(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=Bi(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&lg(o,a)),a.type===Yh&&(a.el=o.el),a.type===ur&&!a.el&&(a.el=o.el)}}function xP(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const d=n[r];if(d!==0){if(s=t[t.length-1],n[s]<d){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<d?i=a+1:o=a;d<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function Jw(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Jw(e)}function Qy(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const EP=Symbol.for("v-scx"),IP=()=>ls(EP);function Nt(n,e,t){return Yw(n,e,t)}function Yw(n,e,t=Wt){const{immediate:r,deep:s,flush:i,once:o}=t,a=Nn({},t),l=e&&r||!e&&i!=="post";let d;if(sc){if(i==="sync"){const v=IP();d=v.__watcherHandles||(v.__watcherHandles=[])}else if(!l){const v=()=>{};return v.stop=os,v.resume=os,v.pause=os,v}}const h=Zn;a.call=(v,w,b)=>cs(v,h,w,b);let f=!1;i==="post"?a.scheduler=v=>{yr(v,h&&h.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(v,w)=>{w?v():rg(v)}),a.augmentJob=v=>{e&&(v.flags|=4),f&&(v.flags|=2,h&&(v.id=h.uid,v.i=h))};const g=LS(n,e,a);return sc&&(d?d.push(g):l&&g()),g}function TP(n,e,t){const r=this.proxy,s=gn(n)?n.includes(".")?Xw(r,n):()=>r[n]:n.bind(r,r);let i;st(e)?i=e:(i=e.handler,t=e);const o=Nc(this),a=Yw(s,i.bind(r),t);return o(),a}function Xw(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const AP=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Xr(e)}Modifiers`]||n[`${yo(e)}Modifiers`];function SP(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||Wt;let s=t;const i=e.startsWith("update:"),o=i&&AP(r,e.slice(7));o&&(o.trim&&(s=t.map(h=>gn(h)?h.trim():h)),o.number&&(s=t.map(oh)));let a,l=r[a=np(e)]||r[a=np(Xr(e))];!l&&i&&(l=r[a=np(yo(e))]),l&&cs(l,n,6,s);const d=r[a+"Once"];if(d){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,cs(d,n,6,s)}}function Zw(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!st(n)){const l=d=>{const h=Zw(d,e,!0);h&&(a=!0,Nn(o,h))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(Jt(n)&&r.set(n,null),null):(Ge(i)?i.forEach(l=>o[l]=null):Nn(o,i),Jt(n)&&r.set(n,o),o)}function Jh(n,e){return!n||!jh(e)?!1:(e=e.slice(2).replace(/Once$/,""),Ft(n,e[0].toLowerCase()+e.slice(1))||Ft(n,yo(e))||Ft(n,e))}function cp(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:d,renderCache:h,props:f,data:g,setupState:v,ctx:w,inheritAttrs:b}=n,x=ch(n);let M,O;try{if(t.shapeFlag&4){const j=s||r,de=j;M=Is(d.call(de,j,h,f,v,g,w)),O=a}else{const j=e;M=Is(j.length>1?j(f,{attrs:a,slots:o,emit:l}):j(f,null)),O=e.props?a:PP(a)}}catch(j){Uu.length=0,Gh(j,n,1),M=Be(ur)}let A=M;if(O&&b!==!1){const j=Object.keys(O),{shapeFlag:de}=A;j.length&&de&7&&(i&&j.some(Km)&&(O=RP(O,i)),A=io(A,O,!1,!0))}return t.dirs&&(A=io(A,null,!1,!0),A.dirs=A.dirs?A.dirs.concat(t.dirs):t.dirs),t.transition&&tc(A,t.transition),M=A,ch(x),M}const PP=n=>{let e;for(const t in n)(t==="class"||t==="style"||jh(t))&&((e||(e={}))[t]=n[t]);return e},RP=(n,e)=>{const t={};for(const r in n)(!Km(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function CP(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,d=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?Jy(r,o,d):!!o;if(l&8){const h=e.dynamicProps;for(let f=0;f<h.length;f++){const g=h[f];if(o[g]!==r[g]&&!Jh(d,g))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?Jy(r,o,d):!0:!!o;return!1}function Jy(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!Jh(t,i))return!0}return!1}function kP({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const ex=n=>n.__isSuspense;function DP(n,e){e&&e.pendingBranch?Ge(n)?e.effects.push(...n):e.effects.push(n):US(n)}const xt=Symbol.for("v-fgt"),Yh=Symbol.for("v-txt"),ur=Symbol.for("v-cmt"),qd=Symbol.for("v-stc"),Uu=[];let Fr=null;function C(n=!1){Uu.push(Fr=n?null:[])}function NP(){Uu.pop(),Fr=Uu[Uu.length-1]||null}let nc=1;function Yy(n,e=!1){nc+=n,n<0&&Fr&&e&&(Fr.hasOnce=!0)}function tx(n){return n.dynamicChildren=nc>0?Fr||ul:null,NP(),nc>0&&Fr&&Fr.push(n),n}function N(n,e,t,r,s,i){return tx(c(n,e,t,r,s,i,!0))}function ti(n,e,t,r,s){return tx(Be(n,e,t,r,s,!0))}function rc(n){return n?n.__v_isVNode===!0:!1}function Wo(n,e){return n.type===e.type&&n.key===e.key}const nx=({key:n})=>n??null,zd=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?gn(n)||cr(n)||st(n)?{i:Hn,r:n,k:e,f:!!t}:n:null);function c(n,e=null,t=null,r=0,s=null,i=n===xt?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&nx(e),ref:e&&zd(e),scopeId:Tw,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Hn};return a?(ug(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=gn(t)?8:16),nc>0&&!o&&Fr&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&Fr.push(l),l}const Be=OP;function OP(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===nP)&&(n=ur),rc(n)){const a=io(n,e,!0);return t&&ug(a,t),nc>0&&!i&&Fr&&(a.shapeFlag&6?Fr[Fr.indexOf(n)]=a:Fr.push(a)),a.patchFlag=-2,a}if(KP(n)&&(n=n.__vccOpts),e){e=VP(e);let{class:a,style:l}=e;a&&!gn(a)&&(e.class=Qt(a)),Jt(l)&&(ng(l)&&!Ge(l)&&(l=Nn({},l)),e.style=Mr(l))}const o=gn(n)?1:ex(n)?128:Sw(n)?64:Jt(n)?4:st(n)?2:0;return c(n,e,t,r,s,o,i,!0)}function VP(n){return n?ng(n)||zw(n)?Nn({},n):n:null}function io(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,d=e?MP(s||{},e):s,h={__v_isVNode:!0,__v_skip:!0,type:n.type,props:d,key:d&&nx(d),ref:e&&e.ref?t&&i?Ge(i)?i.concat(zd(e)):[i,zd(e)]:zd(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==xt?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&io(n.ssContent),ssFallback:n.ssFallback&&io(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&tc(h,l.clone(h)),h}function ft(n=" ",e=0){return Be(Yh,null,n,e)}function _r(n,e){const t=Be(qd,null,n);return t.staticCount=e,t}function ae(n="",e=!1){return e?(C(),ti(ur,null,n)):Be(ur,null,n)}function Is(n){return n==null||typeof n=="boolean"?Be(ur):Ge(n)?Be(xt,null,n.slice()):rc(n)?Bi(n):Be(Yh,null,String(n))}function Bi(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:io(n)}function ug(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(Ge(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),ug(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!zw(e)?e._ctx=Hn:s===3&&Hn&&(Hn.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else st(e)?(e={default:e,_ctx:Hn},t=32):(e=String(e),r&64?(t=16,e=[ft(e)]):t=8);n.children=e,n.shapeFlag|=t}function MP(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=Qt([e.class,r.class]));else if(s==="style")e.style=Mr([e.style,r.style]);else if(jh(s)){const i=e[s],o=r[s];o&&i!==o&&!(Ge(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function xs(n,e,t,r=null){cs(n,e,7,[t,r])}const LP=jw();let $P=0;function FP(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||LP,i={uid:$P++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new cS(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Kw(r,s),emitsOptions:Zw(r,s),emit:null,emitted:null,propsDefaults:Wt,inheritAttrs:r.inheritAttrs,ctx:Wt,data:Wt,props:Wt,attrs:Wt,slots:Wt,refs:Wt,setupState:Wt,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=SP.bind(null,i),n.ce&&n.ce(i),i}let Zn=null;const UP=()=>Zn||Hn;let hh,tm;{const n=zh(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};hh=e("__VUE_INSTANCE_SETTERS__",t=>Zn=t),tm=e("__VUE_SSR_SETTERS__",t=>sc=t)}const Nc=n=>{const e=Zn;return hh(n),n.scope.on(),()=>{n.scope.off(),hh(e)}},Xy=()=>{Zn&&Zn.scope.off(),hh(null)};function rx(n){return n.vnode.shapeFlag&4}let sc=!1;function jP(n,e=!1,t=!1){e&&tm(e);const{props:r,children:s}=n.vnode,i=rx(n);fP(n,r,i,e),vP(n,s,t||e);const o=i?BP(n,e):void 0;return e&&tm(!1),o}function BP(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,iP);const{setup:r}=t;if(r){ii();const s=n.setupContext=r.length>1?zP(n):null,i=Nc(n),o=Dc(r,n,0,[n.props,s]),a=Yb(o);if(oi(),i(),(a||n.sp)&&!fl(n)&&Mw(n),a){if(o.then(Xy,Xy),e)return o.then(l=>{Zy(n,l,e)}).catch(l=>{Gh(l,n,0)});n.asyncDep=o}else Zy(n,o,e)}else sx(n,e)}function Zy(n,e,t){st(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:Jt(e)&&(n.setupState=bw(e)),sx(n,t)}let e0;function sx(n,e,t){const r=n.type;if(!n.render){if(!e&&e0&&!r.render){const s=r.template||ig(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,d=Nn(Nn({isCustomElement:i,delimiters:a},o),l);r.render=e0(s,d)}}n.render=r.render||os}{const s=Nc(n);ii();try{oP(n)}finally{oi(),s()}}}const qP={get(n,e){return lr(n,"get",""),n[e]}};function zP(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,qP),slots:n.slots,emit:n.emit,expose:e}}function Xh(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(bw(CS(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in Fu)return Fu[t](n)},has(e,t){return t in e||t in Fu}})):n.proxy}function HP(n,e=!0){return st(n)?n.displayName||n.name:n.name||e&&n.__name}function KP(n){return st(n)&&"__vccOpts"in n}const He=(n,e)=>VS(n,e,sc);function cg(n,e,t){const r=arguments.length;return r===2?Jt(e)&&!Ge(e)?rc(e)?Be(n,null,[e]):Be(n,e):Be(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&rc(t)&&(t=[t]),Be(n,e,t))}const GP="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let nm;const t0=typeof window<"u"&&window.trustedTypes;if(t0)try{nm=t0.createPolicy("vue",{createHTML:n=>n})}catch{}const ix=nm?n=>nm.createHTML(n):n=>n,WP="http://www.w3.org/2000/svg",QP="http://www.w3.org/1998/Math/MathML",Ks=typeof document<"u"?document:null,n0=Ks&&Ks.createElement("template"),JP={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?Ks.createElementNS(WP,n):e==="mathml"?Ks.createElementNS(QP,n):t?Ks.createElement(n,{is:t}):Ks.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>Ks.createTextNode(n),createComment:n=>Ks.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Ks.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{n0.innerHTML=ix(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=n0.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},Vi="transition",mu="animation",ic=Symbol("_vtc"),ox={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},YP=Nn({},Cw,ox),XP=n=>(n.displayName="Transition",n.props=YP,n),dp=XP((n,{slots:e})=>cg(zS,ZP(n),e)),Uo=(n,e=[])=>{Ge(n)?n.forEach(t=>t(...e)):n&&n(...e)},r0=n=>n?Ge(n)?n.some(e=>e.length>1):n.length>1:!1;function ZP(n){const e={};for(const $ in n)$ in ox||(e[$]=n[$]);if(n.css===!1)return e;const{name:t="v",type:r,duration:s,enterFromClass:i=`${t}-enter-from`,enterActiveClass:o=`${t}-enter-active`,enterToClass:a=`${t}-enter-to`,appearFromClass:l=i,appearActiveClass:d=o,appearToClass:h=a,leaveFromClass:f=`${t}-leave-from`,leaveActiveClass:g=`${t}-leave-active`,leaveToClass:v=`${t}-leave-to`}=n,w=eR(s),b=w&&w[0],x=w&&w[1],{onBeforeEnter:M,onEnter:O,onEnterCancelled:A,onLeave:j,onLeaveCancelled:de,onBeforeAppear:re=M,onAppear:k=O,onAppearCancelled:I=A}=e,T=($,D,je,Tt)=>{$._enterCancelled=Tt,jo($,D?h:a),jo($,D?d:o),je&&je()},V=($,D)=>{$._isLeaving=!1,jo($,f),jo($,v),jo($,g),D&&D()},U=$=>(D,je)=>{const Tt=$?k:O,yt=()=>T(D,$,je);Uo(Tt,[D,yt]),s0(()=>{jo(D,$?l:i),zs(D,$?h:a),r0(Tt)||i0(D,r,b,yt)})};return Nn(e,{onBeforeEnter($){Uo(M,[$]),zs($,i),zs($,o)},onBeforeAppear($){Uo(re,[$]),zs($,l),zs($,d)},onEnter:U(!1),onAppear:U(!0),onLeave($,D){$._isLeaving=!0;const je=()=>V($,D);zs($,f),$._enterCancelled?(zs($,g),l0()):(l0(),zs($,g)),s0(()=>{$._isLeaving&&(jo($,f),zs($,v),r0(j)||i0($,r,x,je))}),Uo(j,[$,je])},onEnterCancelled($){T($,!1,void 0,!0),Uo(A,[$])},onAppearCancelled($){T($,!0,void 0,!0),Uo(I,[$])},onLeaveCancelled($){V($),Uo(de,[$])}})}function eR(n){if(n==null)return null;if(Jt(n))return[hp(n.enter),hp(n.leave)];{const e=hp(n);return[e,e]}}function hp(n){return nS(n)}function zs(n,e){e.split(/\s+/).forEach(t=>t&&n.classList.add(t)),(n[ic]||(n[ic]=new Set)).add(e)}function jo(n,e){e.split(/\s+/).forEach(r=>r&&n.classList.remove(r));const t=n[ic];t&&(t.delete(e),t.size||(n[ic]=void 0))}function s0(n){requestAnimationFrame(()=>{requestAnimationFrame(n)})}let tR=0;function i0(n,e,t,r){const s=n._endId=++tR,i=()=>{s===n._endId&&r()};if(t!=null)return setTimeout(i,t);const{type:o,timeout:a,propCount:l}=nR(n,e);if(!o)return r();const d=o+"end";let h=0;const f=()=>{n.removeEventListener(d,g),i()},g=v=>{v.target===n&&++h>=l&&f()};setTimeout(()=>{h<l&&f()},a+1),n.addEventListener(d,g)}function nR(n,e){const t=window.getComputedStyle(n),r=w=>(t[w]||"").split(", "),s=r(`${Vi}Delay`),i=r(`${Vi}Duration`),o=o0(s,i),a=r(`${mu}Delay`),l=r(`${mu}Duration`),d=o0(a,l);let h=null,f=0,g=0;e===Vi?o>0&&(h=Vi,f=o,g=i.length):e===mu?d>0&&(h=mu,f=d,g=l.length):(f=Math.max(o,d),h=f>0?o>d?Vi:mu:null,g=h?h===Vi?i.length:l.length:0);const v=h===Vi&&/\b(transform|all)(,|$)/.test(r(`${Vi}Property`).toString());return{type:h,timeout:f,propCount:g,hasTransform:v}}function o0(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max(...e.map((t,r)=>a0(t)+a0(n[r])))}function a0(n){return n==="auto"?0:Number(n.slice(0,-1).replace(",","."))*1e3}function l0(){return document.body.offsetHeight}function rR(n,e,t){const r=n[ic];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const fh=Symbol("_vod"),ax=Symbol("_vsh"),fp={beforeMount(n,{value:e},{transition:t}){n[fh]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):gu(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),gu(n,!0),r.enter(n)):r.leave(n,()=>{gu(n,!1)}):gu(n,e))},beforeUnmount(n,{value:e}){gu(n,e)}};function gu(n,e){n.style.display=e?n[fh]:"none",n[ax]=!e}const sR=Symbol(""),iR=/(^|;)\s*display\s*:/;function oR(n,e,t){const r=n.style,s=gn(t);let i=!1;if(t&&!s){if(e)if(gn(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&Hd(r,a,"")}else for(const o in e)t[o]==null&&Hd(r,o,"");for(const o in t)o==="display"&&(i=!0),Hd(r,o,t[o])}else if(s){if(e!==t){const o=r[sR];o&&(t+=";"+o),r.cssText=t,i=iR.test(t)}}else e&&n.removeAttribute("style");fh in n&&(n[fh]=i?r.display:"",n[ax]&&(r.display="none"))}const u0=/\s*!important$/;function Hd(n,e,t){if(Ge(t))t.forEach(r=>Hd(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=aR(n,e);u0.test(t)?n.setProperty(yo(r),t.replace(u0,""),"important"):n[r]=t}}const c0=["Webkit","Moz","ms"],pp={};function aR(n,e){const t=pp[e];if(t)return t;let r=Xr(e);if(r!=="filter"&&r in n)return pp[e]=r;r=qh(r);for(let s=0;s<c0.length;s++){const i=c0[s]+r;if(i in n)return pp[e]=i}return e}const d0="http://www.w3.org/1999/xlink";function h0(n,e,t,r,s,i=lS(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(d0,e.slice(6,e.length)):n.setAttributeNS(d0,e,t):t==null||i&&!ew(t)?n.removeAttribute(e):n.setAttribute(e,i?"":us(t)?String(t):t)}function f0(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?ix(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=ew(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function zi(n,e,t,r){n.addEventListener(e,t,r)}function lR(n,e,t,r){n.removeEventListener(e,t,r)}const p0=Symbol("_vei");function uR(n,e,t,r,s=null){const i=n[p0]||(n[p0]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=cR(e);if(r){const d=i[e]=fR(r,s);zi(n,a,d,l)}else o&&(lR(n,a,o,l),i[e]=void 0)}}const m0=/(?:Once|Passive|Capture)$/;function cR(n){let e;if(m0.test(n)){e={};let r;for(;r=n.match(m0);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):yo(n.slice(2)),e]}let mp=0;const dR=Promise.resolve(),hR=()=>mp||(dR.then(()=>mp=0),mp=Date.now());function fR(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;cs(pR(r,t.value),e,5,[r])};return t.value=n,t.attached=hR(),t}function pR(n,e){if(Ge(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const g0=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,mR=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?rR(n,r,o):e==="style"?oR(n,t,r):jh(e)?Km(e)||uR(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):gR(n,e,r,o))?(f0(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&h0(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!gn(r))?f0(n,Xr(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),h0(n,e,r,o))};function gR(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&g0(e)&&st(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return g0(e)&&gn(t)?!1:e in n}const xl=n=>{const e=n.props["onUpdate:modelValue"]||!1;return Ge(e)?t=>Fd(e,t):e};function vR(n){n.target.composing=!0}function v0(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const ni=Symbol("_assign"),Ut={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[ni]=xl(s);const i=r||s.props&&s.props.type==="number";zi(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=oh(a)),n[ni](a)}),t&&zi(n,"change",()=>{n.value=n.value.trim()}),e||(zi(n,"compositionstart",vR),zi(n,"compositionend",v0),zi(n,"change",v0))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[ni]=xl(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?oh(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},Wr={deep:!0,created(n,e,t){n[ni]=xl(t),zi(n,"change",()=>{const r=n._modelValue,s=oc(n),i=n.checked,o=n[ni];if(Ge(r)){const a=Qm(r,s),l=a!==-1;if(i&&!l)o(r.concat(s));else if(!i&&l){const d=[...r];d.splice(a,1),o(d)}}else if(jl(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o(lx(n,i))})},mounted:y0,beforeUpdate(n,e,t){n[ni]=xl(t),y0(n,e,t)}};function y0(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(Ge(e))s=Qm(e,r.props.value)>-1;else if(jl(e))s=e.has(r.props.value);else{if(e===t)return;s=kc(e,lx(n,!0))}n.checked!==s&&(n.checked=s)}const yR={deep:!0,created(n,{value:e,modifiers:{number:t}},r){const s=jl(e);zi(n,"change",()=>{const i=Array.prototype.filter.call(n.options,o=>o.selected).map(o=>t?oh(oc(o)):oc(o));n[ni](n.multiple?s?new Set(i):i:i[0]),n._assigning=!0,Bt(()=>{n._assigning=!1})}),n[ni]=xl(r)},mounted(n,{value:e}){_0(n,e)},beforeUpdate(n,e,t){n[ni]=xl(t)},updated(n,{value:e}){n._assigning||_0(n,e)}};function _0(n,e){const t=n.multiple,r=Ge(e);if(!(t&&!r&&!jl(e))){for(let s=0,i=n.options.length;s<i;s++){const o=n.options[s],a=oc(o);if(t)if(r){const l=typeof a;l==="string"||l==="number"?o.selected=e.some(d=>String(d)===String(a)):o.selected=Qm(e,a)>-1}else o.selected=e.has(a);else if(kc(oc(o),e)){n.selectedIndex!==s&&(n.selectedIndex=s);return}}!t&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function oc(n){return"_value"in n?n._value:n.value}function lx(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const _R=["ctrl","shift","alt","meta"],bR={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>_R.some(t=>n[`${t}Key`]&&!e.includes(t))},mt=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=bR[e[o]];if(a&&a(s,e))return}return n(s,...i)})},wR={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},or=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=yo(s.key);if(e.some(o=>o===i||wR[o]===i))return n(s)})},xR=Nn({patchProp:mR},JP);let b0;function ER(){return b0||(b0=_P(xR))}const IR=(...n)=>{const e=ER().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=AR(r);if(!s)return;const i=e._component;!st(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,TR(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function TR(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function AR(n){return gn(n)?document.querySelector(n):n}const gp="/icons/icon-48x48.png";/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const tl=typeof document<"u";function ux(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function SR(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&ux(n.default)}const $t=Object.assign;function vp(n,e){const t={};for(const r in e){const s=e[r];t[r]=ds(s)?s.map(n):n(s)}return t}const ju=()=>{},ds=Array.isArray,cx=/#/g,PR=/&/g,RR=/\//g,CR=/=/g,kR=/\?/g,dx=/\+/g,DR=/%5B/g,NR=/%5D/g,hx=/%5E/g,OR=/%60/g,fx=/%7B/g,VR=/%7C/g,px=/%7D/g,MR=/%20/g;function dg(n){return encodeURI(""+n).replace(VR,"|").replace(DR,"[").replace(NR,"]")}function LR(n){return dg(n).replace(fx,"{").replace(px,"}").replace(hx,"^")}function rm(n){return dg(n).replace(dx,"%2B").replace(MR,"+").replace(cx,"%23").replace(PR,"%26").replace(OR,"`").replace(fx,"{").replace(px,"}").replace(hx,"^")}function $R(n){return rm(n).replace(CR,"%3D")}function FR(n){return dg(n).replace(cx,"%23").replace(kR,"%3F")}function UR(n){return n==null?"":FR(n).replace(RR,"%2F")}function ac(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const jR=/\/$/,BR=n=>n.replace(jR,"");function yp(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=KR(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:ac(o)}}function qR(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function w0(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function zR(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&El(e.matched[r],t.matched[s])&&mx(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function El(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function mx(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!HR(n[t],e[t]))return!1;return!0}function HR(n,e){return ds(n)?x0(n,e):ds(e)?x0(e,n):n===e}function x0(n,e){return ds(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function KR(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const Mi={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var lc;(function(n){n.pop="pop",n.push="push"})(lc||(lc={}));var Bu;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Bu||(Bu={}));function GR(n){if(!n)if(tl){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),BR(n)}const WR=/^[^#]+#/;function QR(n,e){return n.replace(WR,"#")+e}function JR(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const Zh=()=>({left:window.scrollX,top:window.scrollY});function YR(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=JR(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function E0(n,e){return(history.state?history.state.position-e:-1)+n}const sm=new Map;function XR(n,e){sm.set(n,e)}function ZR(n){const e=sm.get(n);return sm.delete(n),e}let eC=()=>location.protocol+"//"+location.host;function gx(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),w0(l,"")}return w0(t,n)+r+s}function tC(n,e,t,r){let s=[],i=[],o=null;const a=({state:g})=>{const v=gx(n,location),w=t.value,b=e.value;let x=0;if(g){if(t.value=v,e.value=g,o&&o===w){o=null;return}x=b?g.position-b.position:0}else r(v);s.forEach(M=>{M(t.value,w,{delta:x,type:lc.pop,direction:x?x>0?Bu.forward:Bu.back:Bu.unknown})})};function l(){o=t.value}function d(g){s.push(g);const v=()=>{const w=s.indexOf(g);w>-1&&s.splice(w,1)};return i.push(v),v}function h(){const{history:g}=window;g.state&&g.replaceState($t({},g.state,{scroll:Zh()}),"")}function f(){for(const g of i)g();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",h)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",h,{passive:!0}),{pauseListeners:l,listen:d,destroy:f}}function I0(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?Zh():null}}function nC(n){const{history:e,location:t}=window,r={value:gx(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,d,h){const f=n.indexOf("#"),g=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:eC()+n+l;try{e[h?"replaceState":"pushState"](d,"",g),s.value=d}catch(v){console.error(v),t[h?"replace":"assign"](g)}}function o(l,d){const h=$t({},e.state,I0(s.value.back,l,s.value.forward,!0),d,{position:s.value.position});i(l,h,!0),r.value=l}function a(l,d){const h=$t({},s.value,e.state,{forward:l,scroll:Zh()});i(h.current,h,!0);const f=$t({},I0(r.value,l,null),{position:h.position+1},d);i(l,f,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function rC(n){n=GR(n);const e=nC(n),t=tC(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=$t({location:"",base:n,go:r,createHref:QR.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function sC(n){return typeof n=="string"||n&&typeof n=="object"}function vx(n){return typeof n=="string"||typeof n=="symbol"}const yx=Symbol("");var T0;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(T0||(T0={}));function Il(n,e){return $t(new Error,{type:n,[yx]:!0},e)}function Hs(n,e){return n instanceof Error&&yx in n&&(e==null||!!(n.type&e))}const A0="[^/]+?",iC={sensitive:!1,strict:!1,start:!0,end:!0},oC=/[.+*?^${}()[\]/\\]/g;function aC(n,e){const t=$t({},iC,e),r=[];let s=t.start?"^":"";const i=[];for(const d of n){const h=d.length?[]:[90];t.strict&&!d.length&&(s+="/");for(let f=0;f<d.length;f++){const g=d[f];let v=40+(t.sensitive?.25:0);if(g.type===0)f||(s+="/"),s+=g.value.replace(oC,"\\$&"),v+=40;else if(g.type===1){const{value:w,repeatable:b,optional:x,regexp:M}=g;i.push({name:w,repeatable:b,optional:x});const O=M||A0;if(O!==A0){v+=10;try{new RegExp(`(${O})`)}catch(j){throw new Error(`Invalid custom RegExp for param "${w}" (${O}): `+j.message)}}let A=b?`((?:${O})(?:/(?:${O}))*)`:`(${O})`;f||(A=x&&d.length<2?`(?:/${A})`:"/"+A),x&&(A+="?"),s+=A,v+=20,x&&(v+=-8),b&&(v+=-20),O===".*"&&(v+=-50)}h.push(v)}r.push(h)}if(t.strict&&t.end){const d=r.length-1;r[d][r[d].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(d){const h=d.match(o),f={};if(!h)return null;for(let g=1;g<h.length;g++){const v=h[g]||"",w=i[g-1];f[w.name]=v&&w.repeatable?v.split("/"):v}return f}function l(d){let h="",f=!1;for(const g of n){(!f||!h.endsWith("/"))&&(h+="/"),f=!1;for(const v of g)if(v.type===0)h+=v.value;else if(v.type===1){const{value:w,repeatable:b,optional:x}=v,M=w in d?d[w]:"";if(ds(M)&&!b)throw new Error(`Provided param "${w}" is an array but it is not repeatable (* or + modifiers)`);const O=ds(M)?M.join("/"):M;if(!O)if(x)g.length<2&&(h.endsWith("/")?h=h.slice(0,-1):f=!0);else throw new Error(`Missing required param "${w}"`);h+=O}}return h||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function lC(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function _x(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=lC(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(S0(r))return 1;if(S0(s))return-1}return s.length-r.length}function S0(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const uC={type:0,value:""},cC=/[a-zA-Z0-9_]/;function dC(n){if(!n)return[[]];if(n==="/")return[[uC]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(v){throw new Error(`ERR (${t})/"${d}": ${v}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,d="",h="";function f(){d&&(t===0?i.push({type:0,value:d}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${d}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:d,regexp:h,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),d="")}function g(){d+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(d&&f(),o()):l===":"?(f(),t=1):g();break;case 4:g(),t=r;break;case 1:l==="("?t=2:cC.test(l)?g():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?h[h.length-1]=="\\"?h=h.slice(0,-1)+l:t=3:h+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,h="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${d}"`),f(),o(),s}function hC(n,e,t){const r=aC(dC(n.path),t),s=$t(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function fC(n,e){const t=[],r=new Map;e=k0({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,g,v){const w=!v,b=R0(f);b.aliasOf=v&&v.record;const x=k0(e,f),M=[b];if("alias"in f){const j=typeof f.alias=="string"?[f.alias]:f.alias;for(const de of j)M.push(R0($t({},b,{components:v?v.record.components:b.components,path:de,aliasOf:v?v.record:b})))}let O,A;for(const j of M){const{path:de}=j;if(g&&de[0]!=="/"){const re=g.record.path,k=re[re.length-1]==="/"?"":"/";j.path=g.record.path+(de&&k+de)}if(O=hC(j,g,x),v?v.alias.push(O):(A=A||O,A!==O&&A.alias.push(O),w&&f.name&&!C0(O)&&o(f.name)),bx(O)&&l(O),b.children){const re=b.children;for(let k=0;k<re.length;k++)i(re[k],O,v&&v.children[k])}v=v||O}return A?()=>{o(A)}:ju}function o(f){if(vx(f)){const g=r.get(f);g&&(r.delete(f),t.splice(t.indexOf(g),1),g.children.forEach(o),g.alias.forEach(o))}else{const g=t.indexOf(f);g>-1&&(t.splice(g,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function l(f){const g=gC(f,t);t.splice(g,0,f),f.record.name&&!C0(f)&&r.set(f.record.name,f)}function d(f,g){let v,w={},b,x;if("name"in f&&f.name){if(v=r.get(f.name),!v)throw Il(1,{location:f});x=v.record.name,w=$t(P0(g.params,v.keys.filter(A=>!A.optional).concat(v.parent?v.parent.keys.filter(A=>A.optional):[]).map(A=>A.name)),f.params&&P0(f.params,v.keys.map(A=>A.name))),b=v.stringify(w)}else if(f.path!=null)b=f.path,v=t.find(A=>A.re.test(b)),v&&(w=v.parse(b),x=v.record.name);else{if(v=g.name?r.get(g.name):t.find(A=>A.re.test(g.path)),!v)throw Il(1,{location:f,currentLocation:g});x=v.record.name,w=$t({},g.params,f.params),b=v.stringify(w)}const M=[];let O=v;for(;O;)M.unshift(O.record),O=O.parent;return{name:x,path:b,params:w,matched:M,meta:mC(M)}}n.forEach(f=>i(f));function h(){t.length=0,r.clear()}return{addRoute:i,resolve:d,removeRoute:o,clearRoutes:h,getRoutes:a,getRecordMatcher:s}}function P0(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function R0(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:pC(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function pC(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function C0(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function mC(n){return n.reduce((e,t)=>$t(e,t.meta),{})}function k0(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function gC(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;_x(n,e[i])<0?r=i:t=i+1}const s=vC(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function vC(n){let e=n;for(;e=e.parent;)if(bx(e)&&_x(n,e)===0)return e}function bx({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function yC(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(dx," "),o=i.indexOf("="),a=ac(o<0?i:i.slice(0,o)),l=o<0?null:ac(i.slice(o+1));if(a in e){let d=e[a];ds(d)||(d=e[a]=[d]),d.push(l)}else e[a]=l}return e}function D0(n){let e="";for(let t in n){const r=n[t];if(t=$R(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(ds(r)?r.map(i=>i&&rm(i)):[r&&rm(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function _C(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=ds(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const bC=Symbol(""),N0=Symbol(""),ef=Symbol(""),hg=Symbol(""),im=Symbol("");function vu(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function qi(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const d=g=>{g===!1?l(Il(4,{from:t,to:e})):g instanceof Error?l(g):sC(g)?l(Il(2,{from:e,to:g})):(o&&r.enterCallbacks[s]===o&&typeof g=="function"&&o.push(g),a())},h=i(()=>n.call(r&&r.instances[s],e,t,d));let f=Promise.resolve(h);n.length<3&&(f=f.then(d)),f.catch(g=>l(g))})}function _p(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(ux(l)){const h=(l.__vccOpts||l)[e];h&&i.push(qi(h,t,r,o,a,s))}else{let d=l();i.push(()=>d.then(h=>{if(!h)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=SR(h)?h.default:h;o.mods[a]=h,o.components[a]=f;const v=(f.__vccOpts||f)[e];return v&&qi(v,t,r,o,a,s)()}))}}return i}function O0(n){const e=ls(ef),t=ls(hg),r=He(()=>{const l=$r(n.to);return e.resolve(l)}),s=He(()=>{const{matched:l}=r.value,{length:d}=l,h=l[d-1],f=t.matched;if(!h||!f.length)return-1;const g=f.findIndex(El.bind(null,h));if(g>-1)return g;const v=V0(l[d-2]);return d>1&&V0(h)===v&&f[f.length-1].path!==v?f.findIndex(El.bind(null,l[d-2])):g}),i=He(()=>s.value>-1&&TC(t.params,r.value.params)),o=He(()=>s.value>-1&&s.value===t.matched.length-1&&mx(t.params,r.value.params));function a(l={}){if(IC(l)){const d=e[$r(n.replace)?"replace":"push"]($r(n.to)).catch(ju);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>d),d}return Promise.resolve()}return{route:r,href:He(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function wC(n){return n.length===1?n[0]:n}const xC=Vw({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:O0,setup(n,{slots:e}){const t=Kh(O0(n)),{options:r}=ls(ef),s=He(()=>({[M0(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[M0(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&wC(e.default(t));return n.custom?i:cg("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),EC=xC;function IC(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function TC(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!ds(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function V0(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const M0=(n,e,t)=>n??e??t,AC=Vw({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=ls(im),s=He(()=>n.route||r.value),i=ls(N0,0),o=He(()=>{let d=$r(i);const{matched:h}=s.value;let f;for(;(f=h[d])&&!f.components;)d++;return d}),a=He(()=>s.value.matched[o.value]);Bd(N0,He(()=>o.value+1)),Bd(bC,a),Bd(im,s);const l=S();return Nt(()=>[l.value,a.value,n.name],([d,h,f],[g,v,w])=>{h&&(h.instances[f]=d,v&&v!==h&&d&&d===g&&(h.leaveGuards.size||(h.leaveGuards=v.leaveGuards),h.updateGuards.size||(h.updateGuards=v.updateGuards))),d&&h&&(!v||!El(h,v)||!g)&&(h.enterCallbacks[f]||[]).forEach(b=>b(d))},{flush:"post"}),()=>{const d=s.value,h=n.name,f=a.value,g=f&&f.components[h];if(!g)return L0(t.default,{Component:g,route:d});const v=f.props[h],w=v?v===!0?d.params:typeof v=="function"?v(d):v:null,x=cg(g,$t({},w,e,{onVnodeUnmounted:M=>{M.component.isUnmounted&&(f.instances[h]=null)},ref:l}));return L0(t.default,{Component:x,route:d})||x}}});function L0(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const SC=AC;function PC(n){const e=fC(n.routes,n),t=n.parseQuery||yC,r=n.stringifyQuery||D0,s=n.history,i=vu(),o=vu(),a=vu(),l=kS(Mi);let d=Mi;tl&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const h=vp.bind(null,J=>""+J),f=vp.bind(null,UR),g=vp.bind(null,ac);function v(J,xe){let be,Ne;return vx(J)?(be=e.getRecordMatcher(J),Ne=xe):Ne=J,e.addRoute(Ne,be)}function w(J){const xe=e.getRecordMatcher(J);xe&&e.removeRoute(xe)}function b(){return e.getRoutes().map(J=>J.record)}function x(J){return!!e.getRecordMatcher(J)}function M(J,xe){if(xe=$t({},xe||l.value),typeof J=="string"){const F=yp(t,J,xe.path),G=e.resolve({path:F.path},xe),he=s.createHref(F.fullPath);return $t(F,G,{params:g(G.params),hash:ac(F.hash),redirectedFrom:void 0,href:he})}let be;if(J.path!=null)be=$t({},J,{path:yp(t,J.path,xe.path).path});else{const F=$t({},J.params);for(const G in F)F[G]==null&&delete F[G];be=$t({},J,{params:f(F)}),xe.params=f(xe.params)}const Ne=e.resolve(be,xe),ot=J.hash||"";Ne.params=h(g(Ne.params));const bt=qR(r,$t({},J,{hash:LR(ot),path:Ne.path})),R=s.createHref(bt);return $t({fullPath:bt,hash:ot,query:r===D0?_C(J.query):J.query||{}},Ne,{redirectedFrom:void 0,href:R})}function O(J){return typeof J=="string"?yp(t,J,l.value.path):$t({},J)}function A(J,xe){if(d!==J)return Il(8,{from:xe,to:J})}function j(J){return k(J)}function de(J){return j($t(O(J),{replace:!0}))}function re(J){const xe=J.matched[J.matched.length-1];if(xe&&xe.redirect){const{redirect:be}=xe;let Ne=typeof be=="function"?be(J):be;return typeof Ne=="string"&&(Ne=Ne.includes("?")||Ne.includes("#")?Ne=O(Ne):{path:Ne},Ne.params={}),$t({query:J.query,hash:J.hash,params:Ne.path!=null?{}:J.params},Ne)}}function k(J,xe){const be=d=M(J),Ne=l.value,ot=J.state,bt=J.force,R=J.replace===!0,F=re(be);if(F)return k($t(O(F),{state:typeof F=="object"?$t({},ot,F.state):ot,force:bt,replace:R}),xe||be);const G=be;G.redirectedFrom=xe;let he;return!bt&&zR(r,Ne,be)&&(he=Il(16,{to:G,from:Ne}),ne(Ne,Ne,!0,!1)),(he?Promise.resolve(he):V(G,Ne)).catch(le=>Hs(le)?Hs(le,2)?le:Se(le):se(le,G,Ne)).then(le=>{if(le){if(Hs(le,2))return k($t({replace:R},O(le.to),{state:typeof le.to=="object"?$t({},ot,le.to.state):ot,force:bt}),xe||G)}else le=$(G,Ne,!0,R,ot);return U(G,Ne,le),le})}function I(J,xe){const be=A(J,xe);return be?Promise.reject(be):Promise.resolve()}function T(J){const xe=gt.values().next().value;return xe&&typeof xe.runWithContext=="function"?xe.runWithContext(J):J()}function V(J,xe){let be;const[Ne,ot,bt]=RC(J,xe);be=_p(Ne.reverse(),"beforeRouteLeave",J,xe);for(const F of Ne)F.leaveGuards.forEach(G=>{be.push(qi(G,J,xe))});const R=I.bind(null,J,xe);return be.push(R),St(be).then(()=>{be=[];for(const F of i.list())be.push(qi(F,J,xe));return be.push(R),St(be)}).then(()=>{be=_p(ot,"beforeRouteUpdate",J,xe);for(const F of ot)F.updateGuards.forEach(G=>{be.push(qi(G,J,xe))});return be.push(R),St(be)}).then(()=>{be=[];for(const F of bt)if(F.beforeEnter)if(ds(F.beforeEnter))for(const G of F.beforeEnter)be.push(qi(G,J,xe));else be.push(qi(F.beforeEnter,J,xe));return be.push(R),St(be)}).then(()=>(J.matched.forEach(F=>F.enterCallbacks={}),be=_p(bt,"beforeRouteEnter",J,xe,T),be.push(R),St(be))).then(()=>{be=[];for(const F of o.list())be.push(qi(F,J,xe));return be.push(R),St(be)}).catch(F=>Hs(F,8)?F:Promise.reject(F))}function U(J,xe,be){a.list().forEach(Ne=>T(()=>Ne(J,xe,be)))}function $(J,xe,be,Ne,ot){const bt=A(J,xe);if(bt)return bt;const R=xe===Mi,F=tl?history.state:{};be&&(Ne||R?s.replace(J.fullPath,$t({scroll:R&&F&&F.scroll},ot)):s.push(J.fullPath,ot)),l.value=J,ne(J,xe,be,R),Se()}let D;function je(){D||(D=s.listen((J,xe,be)=>{if(!At.listening)return;const Ne=M(J),ot=re(Ne);if(ot){k($t(ot,{replace:!0,force:!0}),Ne).catch(ju);return}d=Ne;const bt=l.value;tl&&XR(E0(bt.fullPath,be.delta),Zh()),V(Ne,bt).catch(R=>Hs(R,12)?R:Hs(R,2)?(k($t(O(R.to),{force:!0}),Ne).then(F=>{Hs(F,20)&&!be.delta&&be.type===lc.pop&&s.go(-1,!1)}).catch(ju),Promise.reject()):(be.delta&&s.go(-be.delta,!1),se(R,Ne,bt))).then(R=>{R=R||$(Ne,bt,!1),R&&(be.delta&&!Hs(R,8)?s.go(-be.delta,!1):be.type===lc.pop&&Hs(R,20)&&s.go(-1,!1)),U(Ne,bt,R)}).catch(ju)}))}let Tt=vu(),yt=vu(),We;function se(J,xe,be){Se(J);const Ne=yt.list();return Ne.length?Ne.forEach(ot=>ot(J,xe,be)):console.error(J),Promise.reject(J)}function B(){return We&&l.value!==Mi?Promise.resolve():new Promise((J,xe)=>{Tt.add([J,xe])})}function Se(J){return We||(We=!J,je(),Tt.list().forEach(([xe,be])=>J?be(J):xe()),Tt.reset()),J}function ne(J,xe,be,Ne){const{scrollBehavior:ot}=n;if(!tl||!ot)return Promise.resolve();const bt=!be&&ZR(E0(J.fullPath,0))||(Ne||!be)&&history.state&&history.state.scroll||null;return Bt().then(()=>ot(J,xe,bt)).then(R=>R&&YR(R)).catch(R=>se(R,J,xe))}const te=J=>s.go(J);let De;const gt=new Set,At={currentRoute:l,listening:!0,addRoute:v,removeRoute:w,clearRoutes:e.clearRoutes,hasRoute:x,getRoutes:b,resolve:M,options:n,push:j,replace:de,go:te,back:()=>te(-1),forward:()=>te(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:yt.add,isReady:B,install(J){const xe=this;J.component("RouterLink",EC),J.component("RouterView",SC),J.config.globalProperties.$router=xe,Object.defineProperty(J.config.globalProperties,"$route",{enumerable:!0,get:()=>$r(l)}),tl&&!De&&l.value===Mi&&(De=!0,j(s.location).catch(ot=>{}));const be={};for(const ot in Mi)Object.defineProperty(be,ot,{get:()=>l.value[ot],enumerable:!0});J.provide(ef,xe),J.provide(hg,vw(be)),J.provide(im,l);const Ne=J.unmount;gt.add(J),J.unmount=function(){gt.delete(J),gt.size<1&&(d=Mi,D&&D(),D=null,l.value=Mi,De=!1,We=!1),Ne()}}};function St(J){return J.reduce((xe,be)=>xe.then(()=>T(be)),Promise.resolve())}return At}function RC(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(d=>El(d,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(d=>El(d,l))||s.push(l))}return[t,r,s]}function Ea(){return ls(ef)}function _o(n){return ls(hg)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wx=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},CC=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},xx={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,d=l?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let g=(a&15)<<2|d>>6,v=d&63;l||(v=64,o||(g=64)),r.push(t[h],t[f],t[g],t[v])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(wx(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):CC(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const d=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||d==null||f==null)throw new kC;const g=i<<2|a>>4;if(r.push(g),d!==64){const v=a<<4&240|d>>2;if(r.push(v),f!==64){const w=d<<6&192|f;r.push(w)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class kC extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const DC=function(n){const e=wx(n);return xx.encodeByteArray(e,!0)},ph=function(n){return DC(n).replace(/\./g,"")},Ex=function(n){try{return xx.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NC(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OC=()=>NC().__FIREBASE_DEFAULTS__,VC=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},MC=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Ex(n[1]);return e&&JSON.parse(e)},tf=()=>{try{return OC()||VC()||MC()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Ix=n=>{var e,t;return(t=(e=tf())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Tx=n=>{const e=Ix(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Ax=()=>{var n;return(n=tf())===null||n===void 0?void 0:n.config},Sx=n=>{var e;return(e=tf())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LC{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Px(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[ph(JSON.stringify(t)),ph(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ln(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function $C(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ln())}function FC(){var n;const e=(n=tf())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function UC(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function jC(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function BC(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function qC(){const n=Ln();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Rx(){return!FC()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function fg(){try{return typeof indexedDB=="object"}catch{return!1}}function Cx(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}function zC(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HC="FirebaseError";class fs extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=HC,Object.setPrototypeOf(this,fs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ia.prototype.create)}}class Ia{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?KC(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new fs(s,a,r)}}function KC(n,e){return n.replace(GC,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const GC=/\{\$([^}]+)}/g;function WC(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function oo(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if($0(i)&&$0(o)){if(!oo(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function $0(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bl(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Su(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Pu(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function QC(n,e){const t=new JC(n,e);return t.subscribe.bind(t)}class JC{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");YC(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=bp),s.error===void 0&&(s.error=bp),s.complete===void 0&&(s.complete=bp);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function YC(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function bp(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ve(n){return n&&n._delegate?n._delegate:n}class Zr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zo="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XC{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new LC;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(ek(e))try{this.getOrInitializeService({instanceIdentifier:zo})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=zo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=zo){return this.instances.has(e)}getOptions(e=zo){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:ZC(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=zo){return this.component?this.component.multipleInstances?e:zo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function ZC(n){return n===zo?void 0:n}function ek(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tk{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new XC(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var wt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(wt||(wt={}));const nk={debug:wt.DEBUG,verbose:wt.VERBOSE,info:wt.INFO,warn:wt.WARN,error:wt.ERROR,silent:wt.SILENT},rk=wt.INFO,sk={[wt.DEBUG]:"log",[wt.VERBOSE]:"log",[wt.INFO]:"info",[wt.WARN]:"warn",[wt.ERROR]:"error"},ik=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=sk[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class pg{constructor(e){this.name=e,this._logLevel=rk,this._logHandler=ik,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in wt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?nk[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,wt.DEBUG,...e),this._logHandler(this,wt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,wt.VERBOSE,...e),this._logHandler(this,wt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,wt.INFO,...e),this._logHandler(this,wt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,wt.WARN,...e),this._logHandler(this,wt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,wt.ERROR,...e),this._logHandler(this,wt.ERROR,...e)}}const ok=(n,e)=>e.some(t=>n instanceof t);let F0,U0;function ak(){return F0||(F0=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function lk(){return U0||(U0=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const kx=new WeakMap,om=new WeakMap,Dx=new WeakMap,wp=new WeakMap,mg=new WeakMap;function uk(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(ri(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&kx.set(t,n)}).catch(()=>{}),mg.set(e,n),e}function ck(n){if(om.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});om.set(n,e)}let am={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return om.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Dx.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ri(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function dk(n){am=n(am)}function hk(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(xp(this),e,...t);return Dx.set(r,e.sort?e.sort():[e]),ri(r)}:lk().includes(n)?function(...e){return n.apply(xp(this),e),ri(kx.get(this))}:function(...e){return ri(n.apply(xp(this),e))}}function fk(n){return typeof n=="function"?hk(n):(n instanceof IDBTransaction&&ck(n),ok(n,ak())?new Proxy(n,am):n)}function ri(n){if(n instanceof IDBRequest)return uk(n);if(wp.has(n))return wp.get(n);const e=fk(n);return e!==n&&(wp.set(n,e),mg.set(e,n)),e}const xp=n=>mg.get(n);function nf(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=ri(o);return r&&o.addEventListener("upgradeneeded",l=>{r(ri(o.result),l.oldVersion,l.newVersion,ri(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),a}function Ep(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),ri(t).then(()=>{})}const pk=["get","getKey","getAll","getAllKeys","count"],mk=["put","add","delete","clear"],Ip=new Map;function j0(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Ip.get(e))return Ip.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=mk.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||pk.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let d=l.store;return r&&(d=d.index(a.shift())),(await Promise.all([d[t](...a),s&&l.done]))[0]};return Ip.set(e,i),i}dk(n=>({...n,get:(e,t,r)=>j0(e,t)||n.get(e,t,r),has:(e,t)=>!!j0(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gk{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(vk(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function vk(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const lm="@firebase/app",B0="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ai=new pg("@firebase/app"),yk="@firebase/app-compat",_k="@firebase/analytics-compat",bk="@firebase/analytics",wk="@firebase/app-check-compat",xk="@firebase/app-check",Ek="@firebase/auth",Ik="@firebase/auth-compat",Tk="@firebase/database",Ak="@firebase/data-connect",Sk="@firebase/database-compat",Pk="@firebase/functions",Rk="@firebase/functions-compat",Ck="@firebase/installations",kk="@firebase/installations-compat",Dk="@firebase/messaging",Nk="@firebase/messaging-compat",Ok="@firebase/performance",Vk="@firebase/performance-compat",Mk="@firebase/remote-config",Lk="@firebase/remote-config-compat",$k="@firebase/storage",Fk="@firebase/storage-compat",Uk="@firebase/firestore",jk="@firebase/vertexai-preview",Bk="@firebase/firestore-compat",qk="firebase",zk="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mh="[DEFAULT]",Hk={[lm]:"fire-core",[yk]:"fire-core-compat",[bk]:"fire-analytics",[_k]:"fire-analytics-compat",[xk]:"fire-app-check",[wk]:"fire-app-check-compat",[Ek]:"fire-auth",[Ik]:"fire-auth-compat",[Tk]:"fire-rtdb",[Ak]:"fire-data-connect",[Sk]:"fire-rtdb-compat",[Pk]:"fire-fn",[Rk]:"fire-fn-compat",[Ck]:"fire-iid",[kk]:"fire-iid-compat",[Dk]:"fire-fcm",[Nk]:"fire-fcm-compat",[Ok]:"fire-perf",[Vk]:"fire-perf-compat",[Mk]:"fire-rc",[Lk]:"fire-rc-compat",[$k]:"fire-gcs",[Fk]:"fire-gcs-compat",[Uk]:"fire-fst",[Bk]:"fire-fst-compat",[jk]:"fire-vertex","fire-js":"fire-js",[qk]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gh=new Map,Kk=new Map,um=new Map;function q0(n,e){try{n.container.addComponent(e)}catch(t){ai.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function hs(n){const e=n.name;if(um.has(e))return ai.debug(`There were multiple attempts to register component ${e}.`),!1;um.set(e,n);for(const t of gh.values())q0(t,n);for(const t of Kk.values())q0(t,n);return!0}function pi(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Gk(n,e,t=mh){pi(n,e).clearInstance(t)}function An(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wk={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},to=new Ia("app","Firebase",Wk);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qk{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Zr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw to.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ta=zk;function Nx(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:mh,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw to.create("bad-app-name",{appName:String(s)});if(t||(t=Ax()),!t)throw to.create("no-options");const i=gh.get(s);if(i){if(oo(t,i.options)&&oo(r,i.config))return i;throw to.create("duplicate-app",{appName:s})}const o=new tk(s);for(const l of um.values())o.addComponent(l);const a=new Qk(t,r,o);return gh.set(s,a),a}function ql(n=mh){const e=gh.get(n);if(!e&&n===mh&&Ax())return Nx();if(!e)throw to.create("no-app",{appName:n});return e}function Rr(n,e,t){var r;let s=(r=Hk[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ai.warn(a.join(" "));return}hs(new Zr(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jk="firebase-heartbeat-database",Yk=1,uc="firebase-heartbeat-store";let Tp=null;function Ox(){return Tp||(Tp=nf(Jk,Yk,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(uc)}catch(t){console.warn(t)}}}}).catch(n=>{throw to.create("idb-open",{originalErrorMessage:n.message})})),Tp}async function Xk(n){try{const t=(await Ox()).transaction(uc),r=await t.objectStore(uc).get(Vx(n));return await t.done,r}catch(e){if(e instanceof fs)ai.warn(e.message);else{const t=to.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ai.warn(t.message)}}}async function z0(n,e){try{const r=(await Ox()).transaction(uc,"readwrite");await r.objectStore(uc).put(e,Vx(n)),await r.done}catch(t){if(t instanceof fs)ai.warn(t.message);else{const r=to.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});ai.warn(r.message)}}}function Vx(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zk=1024,e2=30*24*60*60*1e3;class t2{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new r2(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=H0();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=e2}),this._storage.overwrite(this._heartbeatsCache))}catch(r){ai.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=H0(),{heartbeatsToSend:r,unsentEntries:s}=n2(this._heartbeatsCache.heartbeats),i=ph(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return ai.warn(t),""}}}function H0(){return new Date().toISOString().substring(0,10)}function n2(n,e=Zk){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),K0(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),K0(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class r2{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return fg()?Cx().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Xk(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return z0(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return z0(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function K0(n){return ph(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s2(n){hs(new Zr("platform-logger",e=>new gk(e),"PRIVATE")),hs(new Zr("heartbeat",e=>new t2(e),"PRIVATE")),Rr(lm,B0,n),Rr(lm,B0,"esm2017"),Rr("fire-js","")}s2("");const Mx="@firebase/installations",gg="0.6.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lx=1e4,$x=`w:${gg}`,Fx="FIS_v2",i2="https://firebaseinstallations.googleapis.com/v1",o2=60*60*1e3,a2="installations",l2="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u2={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},ua=new Ia(a2,l2,u2);function Ux(n){return n instanceof fs&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jx({projectId:n}){return`${i2}/projects/${n}/installations`}function Bx(n){return{token:n.token,requestStatus:2,expiresIn:d2(n.expiresIn),creationTime:Date.now()}}async function qx(n,e){const r=(await e.json()).error;return ua.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function zx({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function c2(n,{refreshToken:e}){const t=zx(n);return t.append("Authorization",h2(e)),t}async function Hx(n){const e=await n();return e.status>=500&&e.status<600?n():e}function d2(n){return Number(n.replace("s","000"))}function h2(n){return`${Fx} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f2({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=jx(n),s=zx(n),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&s.append("x-firebase-client",d)}const o={fid:t,authVersion:Fx,appId:n.appId,sdkVersion:$x},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await Hx(()=>fetch(r,a));if(l.ok){const d=await l.json();return{fid:d.fid||t,registrationStatus:2,refreshToken:d.refreshToken,authToken:Bx(d.authToken)}}else throw await qx("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kx(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p2(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m2=/^[cdef][\w-]{21}$/,cm="";function g2(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=v2(n);return m2.test(t)?t:cm}catch{return cm}}function v2(n){return p2(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rf(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gx=new Map;function Wx(n,e){const t=rf(n);Qx(t,e),y2(t,e)}function Qx(n,e){const t=Gx.get(n);if(t)for(const r of t)r(e)}function y2(n,e){const t=_2();t&&t.postMessage({key:n,fid:e}),b2()}let ea=null;function _2(){return!ea&&"BroadcastChannel"in self&&(ea=new BroadcastChannel("[Firebase] FID Change"),ea.onmessage=n=>{Qx(n.data.key,n.data.fid)}),ea}function b2(){Gx.size===0&&ea&&(ea.close(),ea=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w2="firebase-installations-database",x2=1,ca="firebase-installations-store";let Ap=null;function vg(){return Ap||(Ap=nf(w2,x2,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(ca)}}})),Ap}async function vh(n,e){const t=rf(n),s=(await vg()).transaction(ca,"readwrite"),i=s.objectStore(ca),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&Wx(n,e.fid),e}async function Jx(n){const e=rf(n),r=(await vg()).transaction(ca,"readwrite");await r.objectStore(ca).delete(e),await r.done}async function sf(n,e){const t=rf(n),s=(await vg()).transaction(ca,"readwrite"),i=s.objectStore(ca),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&Wx(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yg(n){let e;const t=await sf(n.appConfig,r=>{const s=E2(r),i=I2(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===cm?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function E2(n){const e=n||{fid:g2(),registrationStatus:0};return Yx(e)}function I2(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(ua.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=T2(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:A2(n)}:{installationEntry:e}}async function T2(n,e){try{const t=await f2(n,e);return vh(n.appConfig,t)}catch(t){throw Ux(t)&&t.customData.serverCode===409?await Jx(n.appConfig):await vh(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function A2(n){let e=await G0(n.appConfig);for(;e.registrationStatus===1;)await Kx(100),e=await G0(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await yg(n);return r||t}return e}function G0(n){return sf(n,e=>{if(!e)throw ua.create("installation-not-found");return Yx(e)})}function Yx(n){return S2(n)?{fid:n.fid,registrationStatus:0}:n}function S2(n){return n.registrationStatus===1&&n.registrationTime+Lx<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function P2({appConfig:n,heartbeatServiceProvider:e},t){const r=R2(n,t),s=c2(n,t),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&s.append("x-firebase-client",d)}const o={installation:{sdkVersion:$x,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await Hx(()=>fetch(r,a));if(l.ok){const d=await l.json();return Bx(d)}else throw await qx("Generate Auth Token",l)}function R2(n,{fid:e}){return`${jx(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _g(n,e=!1){let t;const r=await sf(n.appConfig,i=>{if(!Xx(i))throw ua.create("not-registered");const o=i.authToken;if(!e&&D2(o))return i;if(o.requestStatus===1)return t=C2(n,e),i;{if(!navigator.onLine)throw ua.create("app-offline");const a=O2(i);return t=k2(n,a),a}});return t?await t:r.authToken}async function C2(n,e){let t=await W0(n.appConfig);for(;t.authToken.requestStatus===1;)await Kx(100),t=await W0(n.appConfig);const r=t.authToken;return r.requestStatus===0?_g(n,e):r}function W0(n){return sf(n,e=>{if(!Xx(e))throw ua.create("not-registered");const t=e.authToken;return V2(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function k2(n,e){try{const t=await P2(n,e),r=Object.assign(Object.assign({},e),{authToken:t});return await vh(n.appConfig,r),t}catch(t){if(Ux(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await Jx(n.appConfig);else{const r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await vh(n.appConfig,r)}throw t}}function Xx(n){return n!==void 0&&n.registrationStatus===2}function D2(n){return n.requestStatus===2&&!N2(n)}function N2(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+o2}function O2(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function V2(n){return n.requestStatus===1&&n.requestTime+Lx<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function M2(n){const e=n,{installationEntry:t,registrationPromise:r}=await yg(e);return r?r.catch(console.error):_g(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function L2(n,e=!1){const t=n;return await $2(t),(await _g(t,e)).token}async function $2(n){const{registrationPromise:e}=await yg(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F2(n){if(!n||!n.options)throw Sp("App Configuration");if(!n.name)throw Sp("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Sp(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Sp(n){return ua.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zx="installations",U2="installations-internal",j2=n=>{const e=n.getProvider("app").getImmediate(),t=F2(e),r=pi(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},B2=n=>{const e=n.getProvider("app").getImmediate(),t=pi(e,Zx).getImmediate();return{getId:()=>M2(t),getToken:s=>L2(t,s)}};function q2(){hs(new Zr(Zx,j2,"PUBLIC")),hs(new Zr(U2,B2,"PRIVATE"))}q2();Rr(Mx,gg);Rr(Mx,gg,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z2="/firebase-messaging-sw.js",H2="/firebase-cloud-messaging-push-scope",eE="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",K2="https://fcmregistrations.googleapis.com/v1",tE="google.c.a.c_id",G2="google.c.a.c_l",W2="google.c.a.ts",Q2="google.c.a.e";var Q0;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(Q0||(Q0={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var cc;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(cc||(cc={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gs(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function J2(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),s=new Uint8Array(r.length);for(let i=0;i<r.length;++i)s[i]=r.charCodeAt(i);return s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pp="fcm_token_details_db",Y2=5,J0="fcm_token_object_Store";async function X2(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(i=>i.name).includes(Pp))return null;let e=null;return(await nf(Pp,Y2,{upgrade:async(r,s,i,o)=>{var a;if(s<2||!r.objectStoreNames.contains(J0))return;const l=o.objectStore(J0),d=await l.index("fcmSenderId").get(n);if(await l.clear(),!!d){if(s===2){const h=d;if(!h.auth||!h.p256dh||!h.endpoint)return;e={token:h.fcmToken,createTime:(a=h.createTime)!==null&&a!==void 0?a:Date.now(),subscriptionOptions:{auth:h.auth,p256dh:h.p256dh,endpoint:h.endpoint,swScope:h.swScope,vapidKey:typeof h.vapidKey=="string"?h.vapidKey:Gs(h.vapidKey)}}}else if(s===3){const h=d;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:Gs(h.auth),p256dh:Gs(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:Gs(h.vapidKey)}}}else if(s===4){const h=d;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:Gs(h.auth),p256dh:Gs(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:Gs(h.vapidKey)}}}}}})).close(),await Ep(Pp),await Ep("fcm_vapid_details_db"),await Ep("undefined"),Z2(e)?e:null}function Z2(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eD="firebase-messaging-database",tD=1,dc="firebase-messaging-store";let Rp=null;function nE(){return Rp||(Rp=nf(eD,tD,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(dc)}}})),Rp}async function nD(n){const e=rE(n),r=await(await nE()).transaction(dc).objectStore(dc).get(e);if(r)return r;{const s=await X2(n.appConfig.senderId);if(s)return await bg(n,s),s}}async function bg(n,e){const t=rE(n),s=(await nE()).transaction(dc,"readwrite");return await s.objectStore(dc).put(e,t),await s.done,e}function rE({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rD={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},wr=new Ia("messaging","Messaging",rD);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sD(n,e){const t=await xg(n),r=sE(e),s={method:"POST",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(wg(n.appConfig),s)).json()}catch(o){throw wr.create("token-subscribe-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw wr.create("token-subscribe-failed",{errorInfo:o})}if(!i.token)throw wr.create("token-subscribe-no-token");return i.token}async function iD(n,e){const t=await xg(n),r=sE(e.subscriptionOptions),s={method:"PATCH",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(`${wg(n.appConfig)}/${e.token}`,s)).json()}catch(o){throw wr.create("token-update-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw wr.create("token-update-failed",{errorInfo:o})}if(!i.token)throw wr.create("token-update-no-token");return i.token}async function oD(n,e){const r={method:"DELETE",headers:await xg(n)};try{const i=await(await fetch(`${wg(n.appConfig)}/${e}`,r)).json();if(i.error){const o=i.error.message;throw wr.create("token-unsubscribe-failed",{errorInfo:o})}}catch(s){throw wr.create("token-unsubscribe-failed",{errorInfo:s==null?void 0:s.toString()})}}function wg({projectId:n}){return`${K2}/projects/${n}/registrations`}async function xg({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function sE({p256dh:n,auth:e,endpoint:t,vapidKey:r}){const s={web:{endpoint:t,auth:e,p256dh:n}};return r!==eE&&(s.web.applicationPubKey=r),s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aD=7*24*60*60*1e3;async function lD(n){const e=await cD(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:Gs(e.getKey("auth")),p256dh:Gs(e.getKey("p256dh"))},r=await nD(n.firebaseDependencies);if(r){if(dD(r.subscriptionOptions,t))return Date.now()>=r.createTime+aD?uD(n,{token:r.token,createTime:Date.now(),subscriptionOptions:t}):r.token;try{await oD(n.firebaseDependencies,r.token)}catch(s){console.warn(s)}return Y0(n.firebaseDependencies,t)}else return Y0(n.firebaseDependencies,t)}async function uD(n,e){try{const t=await iD(n.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:t,createTime:Date.now()});return await bg(n.firebaseDependencies,r),t}catch(t){throw t}}async function Y0(n,e){const r={token:await sD(n,e),createTime:Date.now(),subscriptionOptions:e};return await bg(n,r),r.token}async function cD(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:J2(e)})}function dD(n,e){const t=e.vapidKey===n.vapidKey,r=e.endpoint===n.endpoint,s=e.auth===n.auth,i=e.p256dh===n.p256dh;return t&&r&&s&&i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X0(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return hD(e,n),fD(e,n),pD(e,n),e}function hD(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const r=e.notification.body;r&&(n.notification.body=r);const s=e.notification.image;s&&(n.notification.image=s);const i=e.notification.icon;i&&(n.notification.icon=i)}function fD(n,e){e.data&&(n.data=e.data)}function pD(n,e){var t,r,s,i,o;if(!e.fcmOptions&&!(!((t=e.notification)===null||t===void 0)&&t.click_action))return;n.fcmOptions={};const a=(s=(r=e.fcmOptions)===null||r===void 0?void 0:r.link)!==null&&s!==void 0?s:(i=e.notification)===null||i===void 0?void 0:i.click_action;a&&(n.fcmOptions.link=a);const l=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;l&&(n.fcmOptions.analyticsLabel=l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mD(n){return typeof n=="object"&&!!n&&tE in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */gD("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function gD(n,e){const t=[];for(let r=0;r<n.length;r++)t.push(n.charAt(r)),r<e.length&&t.push(e.charAt(r));return t.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vD(n){if(!n||!n.options)throw Cp("App Configuration Object");if(!n.name)throw Cp("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const r of e)if(!t[r])throw Cp(r);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function Cp(n){return wr.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yD{constructor(e,t,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const s=vD(e);this.firebaseDependencies={app:e,appConfig:s,installations:t,analyticsProvider:r}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _D(n){try{n.swRegistration=await navigator.serviceWorker.register(z2,{scope:H2}),n.swRegistration.update().catch(()=>{})}catch(e){throw wr.create("failed-service-worker-registration",{browserErrorMessage:e==null?void 0:e.message})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bD(n,e){if(!e&&!n.swRegistration&&await _D(n),!(!e&&n.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw wr.create("invalid-sw-registration");n.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wD(n,e){e?n.vapidKey=e:n.vapidKey||(n.vapidKey=eE)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iE(n,e){if(!navigator)throw wr.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw wr.create("permission-blocked");return await wD(n,e==null?void 0:e.vapidKey),await bD(n,e==null?void 0:e.serviceWorkerRegistration),lD(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xD(n,e,t){const r=ED(e);(await n.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:t[tE],message_name:t[G2],message_time:t[W2],message_device_time:Math.floor(Date.now()/1e3)})}function ED(n){switch(n){case cc.NOTIFICATION_CLICKED:return"notification_open";case cc.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ID(n,e){const t=e.data;if(!t.isFirebaseMessaging)return;n.onMessageHandler&&t.messageType===cc.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(X0(t)):n.onMessageHandler.next(X0(t)));const r=t.data;mD(r)&&r[Q2]==="1"&&await xD(n,t.messageType,r)}const Z0="@firebase/messaging",e_="0.12.12";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TD=n=>{const e=new yD(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>ID(e,t)),e},AD=n=>{const e=n.getProvider("messaging").getImmediate();return{getToken:r=>iE(e,r)}};function SD(){hs(new Zr("messaging",TD,"PUBLIC")),hs(new Zr("messaging-internal",AD,"PRIVATE")),Rr(Z0,e_),Rr(Z0,e_,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oE(){try{await Cx()}catch{return!1}return typeof window<"u"&&fg()&&zC()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eg(n=ql()){return oE().then(e=>{if(!e)throw wr.create("unsupported-browser")},e=>{throw wr.create("indexed-db-unsupported")}),pi(Ve(n),"messaging").getImmediate()}async function aE(n,e){return n=Ve(n),iE(n,e)}SD();var PD="firebase",RD="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Rr(PD,RD,"app");var t_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var sa,lE;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(k,I){function T(){}T.prototype=I.prototype,k.D=I.prototype,k.prototype=new T,k.prototype.constructor=k,k.C=function(V,U,$){for(var D=Array(arguments.length-2),je=2;je<arguments.length;je++)D[je-2]=arguments[je];return I.prototype[U].apply(V,D)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(k,I,T){T||(T=0);var V=Array(16);if(typeof I=="string")for(var U=0;16>U;++U)V[U]=I.charCodeAt(T++)|I.charCodeAt(T++)<<8|I.charCodeAt(T++)<<16|I.charCodeAt(T++)<<24;else for(U=0;16>U;++U)V[U]=I[T++]|I[T++]<<8|I[T++]<<16|I[T++]<<24;I=k.g[0],T=k.g[1],U=k.g[2];var $=k.g[3],D=I+($^T&(U^$))+V[0]+3614090360&4294967295;I=T+(D<<7&4294967295|D>>>25),D=$+(U^I&(T^U))+V[1]+3905402710&4294967295,$=I+(D<<12&4294967295|D>>>20),D=U+(T^$&(I^T))+V[2]+606105819&4294967295,U=$+(D<<17&4294967295|D>>>15),D=T+(I^U&($^I))+V[3]+3250441966&4294967295,T=U+(D<<22&4294967295|D>>>10),D=I+($^T&(U^$))+V[4]+4118548399&4294967295,I=T+(D<<7&4294967295|D>>>25),D=$+(U^I&(T^U))+V[5]+1200080426&4294967295,$=I+(D<<12&4294967295|D>>>20),D=U+(T^$&(I^T))+V[6]+2821735955&4294967295,U=$+(D<<17&4294967295|D>>>15),D=T+(I^U&($^I))+V[7]+4249261313&4294967295,T=U+(D<<22&4294967295|D>>>10),D=I+($^T&(U^$))+V[8]+1770035416&4294967295,I=T+(D<<7&4294967295|D>>>25),D=$+(U^I&(T^U))+V[9]+2336552879&4294967295,$=I+(D<<12&4294967295|D>>>20),D=U+(T^$&(I^T))+V[10]+4294925233&4294967295,U=$+(D<<17&4294967295|D>>>15),D=T+(I^U&($^I))+V[11]+2304563134&4294967295,T=U+(D<<22&4294967295|D>>>10),D=I+($^T&(U^$))+V[12]+1804603682&4294967295,I=T+(D<<7&4294967295|D>>>25),D=$+(U^I&(T^U))+V[13]+4254626195&4294967295,$=I+(D<<12&4294967295|D>>>20),D=U+(T^$&(I^T))+V[14]+2792965006&4294967295,U=$+(D<<17&4294967295|D>>>15),D=T+(I^U&($^I))+V[15]+1236535329&4294967295,T=U+(D<<22&4294967295|D>>>10),D=I+(U^$&(T^U))+V[1]+4129170786&4294967295,I=T+(D<<5&4294967295|D>>>27),D=$+(T^U&(I^T))+V[6]+3225465664&4294967295,$=I+(D<<9&4294967295|D>>>23),D=U+(I^T&($^I))+V[11]+643717713&4294967295,U=$+(D<<14&4294967295|D>>>18),D=T+($^I&(U^$))+V[0]+3921069994&4294967295,T=U+(D<<20&4294967295|D>>>12),D=I+(U^$&(T^U))+V[5]+3593408605&4294967295,I=T+(D<<5&4294967295|D>>>27),D=$+(T^U&(I^T))+V[10]+38016083&4294967295,$=I+(D<<9&4294967295|D>>>23),D=U+(I^T&($^I))+V[15]+3634488961&4294967295,U=$+(D<<14&4294967295|D>>>18),D=T+($^I&(U^$))+V[4]+3889429448&4294967295,T=U+(D<<20&4294967295|D>>>12),D=I+(U^$&(T^U))+V[9]+568446438&4294967295,I=T+(D<<5&4294967295|D>>>27),D=$+(T^U&(I^T))+V[14]+3275163606&4294967295,$=I+(D<<9&4294967295|D>>>23),D=U+(I^T&($^I))+V[3]+4107603335&4294967295,U=$+(D<<14&4294967295|D>>>18),D=T+($^I&(U^$))+V[8]+1163531501&4294967295,T=U+(D<<20&4294967295|D>>>12),D=I+(U^$&(T^U))+V[13]+2850285829&4294967295,I=T+(D<<5&4294967295|D>>>27),D=$+(T^U&(I^T))+V[2]+4243563512&4294967295,$=I+(D<<9&4294967295|D>>>23),D=U+(I^T&($^I))+V[7]+1735328473&4294967295,U=$+(D<<14&4294967295|D>>>18),D=T+($^I&(U^$))+V[12]+2368359562&4294967295,T=U+(D<<20&4294967295|D>>>12),D=I+(T^U^$)+V[5]+4294588738&4294967295,I=T+(D<<4&4294967295|D>>>28),D=$+(I^T^U)+V[8]+2272392833&4294967295,$=I+(D<<11&4294967295|D>>>21),D=U+($^I^T)+V[11]+1839030562&4294967295,U=$+(D<<16&4294967295|D>>>16),D=T+(U^$^I)+V[14]+4259657740&4294967295,T=U+(D<<23&4294967295|D>>>9),D=I+(T^U^$)+V[1]+2763975236&4294967295,I=T+(D<<4&4294967295|D>>>28),D=$+(I^T^U)+V[4]+1272893353&4294967295,$=I+(D<<11&4294967295|D>>>21),D=U+($^I^T)+V[7]+4139469664&4294967295,U=$+(D<<16&4294967295|D>>>16),D=T+(U^$^I)+V[10]+3200236656&4294967295,T=U+(D<<23&4294967295|D>>>9),D=I+(T^U^$)+V[13]+681279174&4294967295,I=T+(D<<4&4294967295|D>>>28),D=$+(I^T^U)+V[0]+3936430074&4294967295,$=I+(D<<11&4294967295|D>>>21),D=U+($^I^T)+V[3]+3572445317&4294967295,U=$+(D<<16&4294967295|D>>>16),D=T+(U^$^I)+V[6]+76029189&4294967295,T=U+(D<<23&4294967295|D>>>9),D=I+(T^U^$)+V[9]+3654602809&4294967295,I=T+(D<<4&4294967295|D>>>28),D=$+(I^T^U)+V[12]+3873151461&4294967295,$=I+(D<<11&4294967295|D>>>21),D=U+($^I^T)+V[15]+530742520&4294967295,U=$+(D<<16&4294967295|D>>>16),D=T+(U^$^I)+V[2]+3299628645&4294967295,T=U+(D<<23&4294967295|D>>>9),D=I+(U^(T|~$))+V[0]+4096336452&4294967295,I=T+(D<<6&4294967295|D>>>26),D=$+(T^(I|~U))+V[7]+1126891415&4294967295,$=I+(D<<10&4294967295|D>>>22),D=U+(I^($|~T))+V[14]+2878612391&4294967295,U=$+(D<<15&4294967295|D>>>17),D=T+($^(U|~I))+V[5]+4237533241&4294967295,T=U+(D<<21&4294967295|D>>>11),D=I+(U^(T|~$))+V[12]+1700485571&4294967295,I=T+(D<<6&4294967295|D>>>26),D=$+(T^(I|~U))+V[3]+2399980690&4294967295,$=I+(D<<10&4294967295|D>>>22),D=U+(I^($|~T))+V[10]+4293915773&4294967295,U=$+(D<<15&4294967295|D>>>17),D=T+($^(U|~I))+V[1]+2240044497&4294967295,T=U+(D<<21&4294967295|D>>>11),D=I+(U^(T|~$))+V[8]+1873313359&4294967295,I=T+(D<<6&4294967295|D>>>26),D=$+(T^(I|~U))+V[15]+4264355552&4294967295,$=I+(D<<10&4294967295|D>>>22),D=U+(I^($|~T))+V[6]+2734768916&4294967295,U=$+(D<<15&4294967295|D>>>17),D=T+($^(U|~I))+V[13]+1309151649&4294967295,T=U+(D<<21&4294967295|D>>>11),D=I+(U^(T|~$))+V[4]+4149444226&4294967295,I=T+(D<<6&4294967295|D>>>26),D=$+(T^(I|~U))+V[11]+3174756917&4294967295,$=I+(D<<10&4294967295|D>>>22),D=U+(I^($|~T))+V[2]+718787259&4294967295,U=$+(D<<15&4294967295|D>>>17),D=T+($^(U|~I))+V[9]+3951481745&4294967295,k.g[0]=k.g[0]+I&4294967295,k.g[1]=k.g[1]+(U+(D<<21&4294967295|D>>>11))&4294967295,k.g[2]=k.g[2]+U&4294967295,k.g[3]=k.g[3]+$&4294967295}r.prototype.u=function(k,I){I===void 0&&(I=k.length);for(var T=I-this.blockSize,V=this.B,U=this.h,$=0;$<I;){if(U==0)for(;$<=T;)s(this,k,$),$+=this.blockSize;if(typeof k=="string"){for(;$<I;)if(V[U++]=k.charCodeAt($++),U==this.blockSize){s(this,V),U=0;break}}else for(;$<I;)if(V[U++]=k[$++],U==this.blockSize){s(this,V),U=0;break}}this.h=U,this.o+=I},r.prototype.v=function(){var k=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);k[0]=128;for(var I=1;I<k.length-8;++I)k[I]=0;var T=8*this.o;for(I=k.length-8;I<k.length;++I)k[I]=T&255,T/=256;for(this.u(k),k=Array(16),I=T=0;4>I;++I)for(var V=0;32>V;V+=8)k[T++]=this.g[I]>>>V&255;return k};function i(k,I){var T=a;return Object.prototype.hasOwnProperty.call(T,k)?T[k]:T[k]=I(k)}function o(k,I){this.h=I;for(var T=[],V=!0,U=k.length-1;0<=U;U--){var $=k[U]|0;V&&$==I||(T[U]=$,V=!1)}this.g=T}var a={};function l(k){return-128<=k&&128>k?i(k,function(I){return new o([I|0],0>I?-1:0)}):new o([k|0],0>k?-1:0)}function d(k){if(isNaN(k)||!isFinite(k))return f;if(0>k)return x(d(-k));for(var I=[],T=1,V=0;k>=T;V++)I[V]=k/T|0,T*=4294967296;return new o(I,0)}function h(k,I){if(k.length==0)throw Error("number format error: empty string");if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(k.charAt(0)=="-")return x(h(k.substring(1),I));if(0<=k.indexOf("-"))throw Error('number format error: interior "-" character');for(var T=d(Math.pow(I,8)),V=f,U=0;U<k.length;U+=8){var $=Math.min(8,k.length-U),D=parseInt(k.substring(U,U+$),I);8>$?($=d(Math.pow(I,$)),V=V.j($).add(d(D))):(V=V.j(T),V=V.add(d(D)))}return V}var f=l(0),g=l(1),v=l(16777216);n=o.prototype,n.m=function(){if(b(this))return-x(this).m();for(var k=0,I=1,T=0;T<this.g.length;T++){var V=this.i(T);k+=(0<=V?V:4294967296+V)*I,I*=4294967296}return k},n.toString=function(k){if(k=k||10,2>k||36<k)throw Error("radix out of range: "+k);if(w(this))return"0";if(b(this))return"-"+x(this).toString(k);for(var I=d(Math.pow(k,6)),T=this,V="";;){var U=j(T,I).g;T=M(T,U.j(I));var $=((0<T.g.length?T.g[0]:T.h)>>>0).toString(k);if(T=U,w(T))return $+V;for(;6>$.length;)$="0"+$;V=$+V}},n.i=function(k){return 0>k?0:k<this.g.length?this.g[k]:this.h};function w(k){if(k.h!=0)return!1;for(var I=0;I<k.g.length;I++)if(k.g[I]!=0)return!1;return!0}function b(k){return k.h==-1}n.l=function(k){return k=M(this,k),b(k)?-1:w(k)?0:1};function x(k){for(var I=k.g.length,T=[],V=0;V<I;V++)T[V]=~k.g[V];return new o(T,~k.h).add(g)}n.abs=function(){return b(this)?x(this):this},n.add=function(k){for(var I=Math.max(this.g.length,k.g.length),T=[],V=0,U=0;U<=I;U++){var $=V+(this.i(U)&65535)+(k.i(U)&65535),D=($>>>16)+(this.i(U)>>>16)+(k.i(U)>>>16);V=D>>>16,$&=65535,D&=65535,T[U]=D<<16|$}return new o(T,T[T.length-1]&-2147483648?-1:0)};function M(k,I){return k.add(x(I))}n.j=function(k){if(w(this)||w(k))return f;if(b(this))return b(k)?x(this).j(x(k)):x(x(this).j(k));if(b(k))return x(this.j(x(k)));if(0>this.l(v)&&0>k.l(v))return d(this.m()*k.m());for(var I=this.g.length+k.g.length,T=[],V=0;V<2*I;V++)T[V]=0;for(V=0;V<this.g.length;V++)for(var U=0;U<k.g.length;U++){var $=this.i(V)>>>16,D=this.i(V)&65535,je=k.i(U)>>>16,Tt=k.i(U)&65535;T[2*V+2*U]+=D*Tt,O(T,2*V+2*U),T[2*V+2*U+1]+=$*Tt,O(T,2*V+2*U+1),T[2*V+2*U+1]+=D*je,O(T,2*V+2*U+1),T[2*V+2*U+2]+=$*je,O(T,2*V+2*U+2)}for(V=0;V<I;V++)T[V]=T[2*V+1]<<16|T[2*V];for(V=I;V<2*I;V++)T[V]=0;return new o(T,0)};function O(k,I){for(;(k[I]&65535)!=k[I];)k[I+1]+=k[I]>>>16,k[I]&=65535,I++}function A(k,I){this.g=k,this.h=I}function j(k,I){if(w(I))throw Error("division by zero");if(w(k))return new A(f,f);if(b(k))return I=j(x(k),I),new A(x(I.g),x(I.h));if(b(I))return I=j(k,x(I)),new A(x(I.g),I.h);if(30<k.g.length){if(b(k)||b(I))throw Error("slowDivide_ only works with positive integers.");for(var T=g,V=I;0>=V.l(k);)T=de(T),V=de(V);var U=re(T,1),$=re(V,1);for(V=re(V,2),T=re(T,2);!w(V);){var D=$.add(V);0>=D.l(k)&&(U=U.add(T),$=D),V=re(V,1),T=re(T,1)}return I=M(k,U.j(I)),new A(U,I)}for(U=f;0<=k.l(I);){for(T=Math.max(1,Math.floor(k.m()/I.m())),V=Math.ceil(Math.log(T)/Math.LN2),V=48>=V?1:Math.pow(2,V-48),$=d(T),D=$.j(I);b(D)||0<D.l(k);)T-=V,$=d(T),D=$.j(I);w($)&&($=g),U=U.add($),k=M(k,D)}return new A(U,k)}n.A=function(k){return j(this,k).h},n.and=function(k){for(var I=Math.max(this.g.length,k.g.length),T=[],V=0;V<I;V++)T[V]=this.i(V)&k.i(V);return new o(T,this.h&k.h)},n.or=function(k){for(var I=Math.max(this.g.length,k.g.length),T=[],V=0;V<I;V++)T[V]=this.i(V)|k.i(V);return new o(T,this.h|k.h)},n.xor=function(k){for(var I=Math.max(this.g.length,k.g.length),T=[],V=0;V<I;V++)T[V]=this.i(V)^k.i(V);return new o(T,this.h^k.h)};function de(k){for(var I=k.g.length+1,T=[],V=0;V<I;V++)T[V]=k.i(V)<<1|k.i(V-1)>>>31;return new o(T,k.h)}function re(k,I){var T=I>>5;I%=32;for(var V=k.g.length-T,U=[],$=0;$<V;$++)U[$]=0<I?k.i($+T)>>>I|k.i($+T+1)<<32-I:k.i($+T);return new o(U,k.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,lE=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=d,o.fromString=h,sa=o}).apply(typeof t_<"u"?t_:typeof self<"u"?self:typeof window<"u"?window:{});var Sd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var uE,Ru,cE,Kd,dm,dE,hE,fE;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,p,y){return u==Array.prototype||u==Object.prototype||(u[p]=y.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof Sd=="object"&&Sd];for(var p=0;p<u.length;++p){var y=u[p];if(y&&y.Math==Math)return y}throw Error("Cannot find global object")}var r=t(this);function s(u,p){if(p)e:{var y=r;u=u.split(".");for(var E=0;E<u.length-1;E++){var q=u[E];if(!(q in y))break e;y=y[q]}u=u[u.length-1],E=y[u],p=p(E),p!=E&&p!=null&&e(y,u,{configurable:!0,writable:!0,value:p})}}function i(u,p){u instanceof String&&(u+="");var y=0,E=!1,q={next:function(){if(!E&&y<u.length){var Y=y++;return{value:p(Y,u[Y]),done:!1}}return E=!0,{done:!0,value:void 0}}};return q[Symbol.iterator]=function(){return q},q}s("Array.prototype.values",function(u){return u||function(){return i(this,function(p,y){return y})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var p=typeof u;return p=p!="object"?p:u?Array.isArray(u)?"array":p:"null",p=="array"||p=="object"&&typeof u.length=="number"}function d(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function h(u,p,y){return u.call.apply(u.bind,arguments)}function f(u,p,y){if(!u)throw Error();if(2<arguments.length){var E=Array.prototype.slice.call(arguments,2);return function(){var q=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(q,E),u.apply(p,q)}}return function(){return u.apply(p,arguments)}}function g(u,p,y){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,g.apply(null,arguments)}function v(u,p){var y=Array.prototype.slice.call(arguments,1);return function(){var E=y.slice();return E.push.apply(E,arguments),u.apply(this,E)}}function w(u,p){function y(){}y.prototype=p.prototype,u.aa=p.prototype,u.prototype=new y,u.prototype.constructor=u,u.Qb=function(E,q,Y){for(var Te=Array(arguments.length-2),jt=2;jt<arguments.length;jt++)Te[jt-2]=arguments[jt];return p.prototype[q].apply(E,Te)}}function b(u){const p=u.length;if(0<p){const y=Array(p);for(let E=0;E<p;E++)y[E]=u[E];return y}return[]}function x(u,p){for(let y=1;y<arguments.length;y++){const E=arguments[y];if(l(E)){const q=u.length||0,Y=E.length||0;u.length=q+Y;for(let Te=0;Te<Y;Te++)u[q+Te]=E[Te]}else u.push(E)}}class M{constructor(p,y){this.i=p,this.j=y,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function O(u){return/^[\s\xa0]*$/.test(u)}function A(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function j(u){return j[" "](u),u}j[" "]=function(){};var de=A().indexOf("Gecko")!=-1&&!(A().toLowerCase().indexOf("webkit")!=-1&&A().indexOf("Edge")==-1)&&!(A().indexOf("Trident")!=-1||A().indexOf("MSIE")!=-1)&&A().indexOf("Edge")==-1;function re(u,p,y){for(const E in u)p.call(y,u[E],E,u)}function k(u,p){for(const y in u)p.call(void 0,u[y],y,u)}function I(u){const p={};for(const y in u)p[y]=u[y];return p}const T="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function V(u,p){let y,E;for(let q=1;q<arguments.length;q++){E=arguments[q];for(y in E)u[y]=E[y];for(let Y=0;Y<T.length;Y++)y=T[Y],Object.prototype.hasOwnProperty.call(E,y)&&(u[y]=E[y])}}function U(u){var p=1;u=u.split(":");const y=[];for(;0<p&&u.length;)y.push(u.shift()),p--;return u.length&&y.push(u.join(":")),y}function $(u){a.setTimeout(()=>{throw u},0)}function D(){var u=B;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class je{constructor(){this.h=this.g=null}add(p,y){const E=Tt.get();E.set(p,y),this.h?this.h.next=E:this.g=E,this.h=E}}var Tt=new M(()=>new yt,u=>u.reset());class yt{constructor(){this.next=this.g=this.h=null}set(p,y){this.h=p,this.g=y,this.next=null}reset(){this.next=this.g=this.h=null}}let We,se=!1,B=new je,Se=()=>{const u=a.Promise.resolve(void 0);We=()=>{u.then(ne)}};var ne=()=>{for(var u;u=D();){try{u.h.call(u.g)}catch(y){$(y)}var p=Tt;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}se=!1};function te(){this.s=this.s,this.C=this.C}te.prototype.s=!1,te.prototype.ma=function(){this.s||(this.s=!0,this.N())},te.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function De(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}De.prototype.h=function(){this.defaultPrevented=!0};var gt=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const y=()=>{};a.addEventListener("test",y,p),a.removeEventListener("test",y,p)}catch{}return u}();function At(u,p){if(De.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var y=this.type=u.type,E=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(de){e:{try{j(p.nodeName);var q=!0;break e}catch{}q=!1}q||(p=null)}}else y=="mouseover"?p=u.fromElement:y=="mouseout"&&(p=u.toElement);this.relatedTarget=p,E?(this.clientX=E.clientX!==void 0?E.clientX:E.pageX,this.clientY=E.clientY!==void 0?E.clientY:E.pageY,this.screenX=E.screenX||0,this.screenY=E.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:St[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&At.aa.h.call(this)}}w(At,De);var St={2:"touch",3:"pen",4:"mouse"};At.prototype.h=function(){At.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var J="closure_listenable_"+(1e6*Math.random()|0),xe=0;function be(u,p,y,E,q){this.listener=u,this.proxy=null,this.src=p,this.type=y,this.capture=!!E,this.ha=q,this.key=++xe,this.da=this.fa=!1}function Ne(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function ot(u){this.src=u,this.g={},this.h=0}ot.prototype.add=function(u,p,y,E,q){var Y=u.toString();u=this.g[Y],u||(u=this.g[Y]=[],this.h++);var Te=R(u,p,E,q);return-1<Te?(p=u[Te],y||(p.fa=!1)):(p=new be(p,this.src,Y,!!E,q),p.fa=y,u.push(p)),p};function bt(u,p){var y=p.type;if(y in u.g){var E=u.g[y],q=Array.prototype.indexOf.call(E,p,void 0),Y;(Y=0<=q)&&Array.prototype.splice.call(E,q,1),Y&&(Ne(p),u.g[y].length==0&&(delete u.g[y],u.h--))}}function R(u,p,y,E){for(var q=0;q<u.length;++q){var Y=u[q];if(!Y.da&&Y.listener==p&&Y.capture==!!y&&Y.ha==E)return q}return-1}var F="closure_lm_"+(1e6*Math.random()|0),G={};function he(u,p,y,E,q){if(E&&E.once)return Ie(u,p,y,E,q);if(Array.isArray(p)){for(var Y=0;Y<p.length;Y++)he(u,p[Y],y,E,q);return null}return y=qe(y),u&&u[J]?u.K(p,y,d(E)?!!E.capture:!!E,q):le(u,p,y,!1,E,q)}function le(u,p,y,E,q,Y){if(!p)throw Error("Invalid event type");var Te=d(q)?!!q.capture:!!q,jt=_e(u);if(jt||(u[F]=jt=new ot(u)),y=jt.add(p,y,E,Te,Y),y.proxy)return y;if(E=fe(),y.proxy=E,E.src=u,E.listener=y,u.addEventListener)gt||(q=Te),q===void 0&&(q=!1),u.addEventListener(p.toString(),E,q);else if(u.attachEvent)u.attachEvent(pe(p.toString()),E);else if(u.addListener&&u.removeListener)u.addListener(E);else throw Error("addEventListener and attachEvent are unavailable.");return y}function fe(){function u(y){return p.call(u.src,u.listener,y)}const p=Ce;return u}function Ie(u,p,y,E,q){if(Array.isArray(p)){for(var Y=0;Y<p.length;Y++)Ie(u,p[Y],y,E,q);return null}return y=qe(y),u&&u[J]?u.L(p,y,d(E)?!!E.capture:!!E,q):le(u,p,y,!0,E,q)}function X(u,p,y,E,q){if(Array.isArray(p))for(var Y=0;Y<p.length;Y++)X(u,p[Y],y,E,q);else E=d(E)?!!E.capture:!!E,y=qe(y),u&&u[J]?(u=u.i,p=String(p).toString(),p in u.g&&(Y=u.g[p],y=R(Y,y,E,q),-1<y&&(Ne(Y[y]),Array.prototype.splice.call(Y,y,1),Y.length==0&&(delete u.g[p],u.h--)))):u&&(u=_e(u))&&(p=u.g[p.toString()],u=-1,p&&(u=R(p,y,E,q)),(y=-1<u?p[u]:null)&&ve(y))}function ve(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[J])bt(p.i,u);else{var y=u.type,E=u.proxy;p.removeEventListener?p.removeEventListener(y,E,u.capture):p.detachEvent?p.detachEvent(pe(y),E):p.addListener&&p.removeListener&&p.removeListener(E),(y=_e(p))?(bt(y,u),y.h==0&&(y.src=null,p[F]=null)):Ne(u)}}}function pe(u){return u in G?G[u]:G[u]="on"+u}function Ce(u,p){if(u.da)u=!0;else{p=new At(p,this);var y=u.listener,E=u.ha||u.src;u.fa&&ve(u),u=y.call(E,p)}return u}function _e(u){return u=u[F],u instanceof ot?u:null}var Oe="__closure_events_fn_"+(1e9*Math.random()>>>0);function qe(u){return typeof u=="function"?u:(u[Oe]||(u[Oe]=function(p){return u.handleEvent(p)}),u[Oe])}function Ue(){te.call(this),this.i=new ot(this),this.M=this,this.F=null}w(Ue,te),Ue.prototype[J]=!0,Ue.prototype.removeEventListener=function(u,p,y,E){X(this,u,p,y,E)};function Ze(u,p){var y,E=u.F;if(E)for(y=[];E;E=E.F)y.push(E);if(u=u.M,E=p.type||p,typeof p=="string")p=new De(p,u);else if(p instanceof De)p.target=p.target||u;else{var q=p;p=new De(E,u),V(p,q)}if(q=!0,y)for(var Y=y.length-1;0<=Y;Y--){var Te=p.g=y[Y];q=ht(Te,E,!0,p)&&q}if(Te=p.g=u,q=ht(Te,E,!0,p)&&q,q=ht(Te,E,!1,p)&&q,y)for(Y=0;Y<y.length;Y++)Te=p.g=y[Y],q=ht(Te,E,!1,p)&&q}Ue.prototype.N=function(){if(Ue.aa.N.call(this),this.i){var u=this.i,p;for(p in u.g){for(var y=u.g[p],E=0;E<y.length;E++)Ne(y[E]);delete u.g[p],u.h--}}this.F=null},Ue.prototype.K=function(u,p,y,E){return this.i.add(String(u),p,!1,y,E)},Ue.prototype.L=function(u,p,y,E){return this.i.add(String(u),p,!0,y,E)};function ht(u,p,y,E){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();for(var q=!0,Y=0;Y<p.length;++Y){var Te=p[Y];if(Te&&!Te.da&&Te.capture==y){var jt=Te.listener,Mn=Te.ha||Te.src;Te.fa&&bt(u.i,Te),q=jt.call(Mn,E)!==!1&&q}}return q&&!E.defaultPrevented}function nn(u,p,y){if(typeof u=="function")y&&(u=g(u,y));else if(u&&typeof u.handleEvent=="function")u=g(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(u,p||0)}function Xt(u){u.g=nn(()=>{u.g=null,u.i&&(u.i=!1,Xt(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class xn extends te{constructor(p,y){super(),this.m=p,this.l=y,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:Xt(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function zt(u){te.call(this),this.h=u,this.g={}}w(zt,te);var pr=[];function kr(u){re(u.g,function(p,y){this.g.hasOwnProperty(y)&&ve(p)},u),u.g={}}zt.prototype.N=function(){zt.aa.N.call(this),kr(this)},zt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var cn=a.JSON.stringify,On=a.JSON.parse,xi=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function ue(){}ue.prototype.h=null;function z(u){return u.h||(u.h=u.i())}function we(){}var ze={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ye(){De.call(this,"d")}w(Ye,De);function ut(){De.call(this,"c")}w(ut,De);var pt={},Pt=null;function Fn(){return Pt=Pt||new Ue}pt.La="serverreachability";function kt(u){De.call(this,pt.La,u)}w(kt,De);function Er(u){const p=Fn();Ze(p,new kt(p))}pt.STAT_EVENT="statevent";function nt(u,p){De.call(this,pt.STAT_EVENT,u),this.stat=p}w(nt,De);function ct(u){const p=Fn();Ze(p,new nt(p,u))}pt.Ma="timingevent";function Wn(u,p){De.call(this,pt.Ma,u),this.size=p}w(Wn,De);function nr(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},p)}function Vn(){this.g=!0}Vn.prototype.xa=function(){this.g=!1};function Ei(u,p,y,E,q,Y){u.info(function(){if(u.g)if(Y)for(var Te="",jt=Y.split("&"),Mn=0;Mn<jt.length;Mn++){var Rt=jt[Mn].split("=");if(1<Rt.length){var Bn=Rt[0];Rt=Rt[1];var pn=Bn.split("_");Te=2<=pn.length&&pn[1]=="type"?Te+(Bn+"="+Rt+"&"):Te+(Bn+"=redacted&")}}else Te=null;else Te=Y;return"XMLHTTP REQ ("+E+") [attempt "+q+"]: "+p+`
`+y+`
`+Te})}function Os(u,p,y,E,q,Y,Te){u.info(function(){return"XMLHTTP RESP ("+E+") [ attempt "+q+"]: "+p+`
`+y+`
`+Y+" "+Te})}function ps(u,p,y,E){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+ru(u,y)+(E?" "+E:"")})}function Vs(u,p){u.info(function(){return"TIMEOUT: "+p})}Vn.prototype.info=function(){};function ru(u,p){if(!u.g)return p;if(!p)return null;try{var y=JSON.parse(p);if(y){for(u=0;u<y.length;u++)if(Array.isArray(y[u])){var E=y[u];if(!(2>E.length)){var q=E[1];if(Array.isArray(q)&&!(1>q.length)){var Y=q[0];if(Y!="noop"&&Y!="stop"&&Y!="close")for(var Te=1;Te<q.length;Te++)q[Te]=""}}}}return cn(y)}catch{return p}}var ms={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Na={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ao;function So(){}w(So,ue),So.prototype.g=function(){return new XMLHttpRequest},So.prototype.i=function(){return{}},Ao=new So;function gs(u,p,y,E){this.j=u,this.i=p,this.l=y,this.R=E||1,this.U=new zt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Oa}function Oa(){this.i=null,this.g="",this.h=!1}var nd={},su={};function iu(u,p,y){u.L=1,u.v=$s(Cn(p)),u.m=y,u.P=!0,rd(u,null)}function rd(u,p){u.F=Date.now(),Po(u),u.A=Cn(u.v);var y=u.A,E=u.R;Array.isArray(E)||(E=[String(E)]),vt(y.i,"t",E),u.C=0,y=u.j.J,u.h=new Oa,u.g=du(u.j,y?p:null,!u.m),0<u.O&&(u.M=new xn(g(u.Y,u,u.g),u.O)),p=u.U,y=u.g,E=u.ca;var q="readystatechange";Array.isArray(q)||(q&&(pr[0]=q.toString()),q=pr);for(var Y=0;Y<q.length;Y++){var Te=he(y,q[Y],E||p.handleEvent,!1,p.h||p);if(!Te)break;p.g[Te.key]=Te}p=u.H?I(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),Er(),Ei(u.i,u.u,u.A,u.l,u.R,u.m)}gs.prototype.ca=function(u){u=u.target;const p=this.M;p&&rt(u)==3?p.j():this.Y(u)},gs.prototype.Y=function(u){try{if(u==this.g)e:{const pn=rt(this.g);var p=this.g.Ba();const Ni=this.g.Z();if(!(3>pn)&&(pn!=3||this.g&&(this.h.h||this.g.oa()||hd(this.g)))){this.J||pn!=4||p==7||(p==8||0>=Ni?Er(3):Er(2)),Va(this);var y=this.g.Z();this.X=y;t:if(ou(this)){var E=hd(this.g);u="";var q=E.length,Y=rt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){rr(this),Ro(this);var Te="";break t}this.h.i=new a.TextDecoder}for(p=0;p<q;p++)this.h.h=!0,u+=this.h.i.decode(E[p],{stream:!(Y&&p==q-1)});E.length=0,this.h.g+=u,this.C=0,Te=this.h.g}else Te=this.g.oa();if(this.o=y==200,Os(this.i,this.u,this.A,this.l,this.R,pn,y),this.o){if(this.T&&!this.K){t:{if(this.g){var jt,Mn=this.g;if((jt=Mn.g?Mn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!O(jt)){var Rt=jt;break t}}Rt=null}if(y=Rt)ps(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ns(this,y);else{this.o=!1,this.s=3,ct(12),rr(this),Ro(this);break e}}if(this.P){y=!0;let Or;for(;!this.J&&this.C<Te.length;)if(Or=zf(this,Te),Or==su){pn==4&&(this.s=4,ct(14),y=!1),ps(this.i,this.l,null,"[Incomplete Response]");break}else if(Or==nd){this.s=4,ct(15),ps(this.i,this.l,Te,"[Invalid Chunk]"),y=!1;break}else ps(this.i,this.l,Or,null),ns(this,Or);if(ou(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),pn!=4||Te.length!=0||this.h.h||(this.s=1,ct(16),y=!1),this.o=this.o&&y,!y)ps(this.i,this.l,Te,"[Invalid Chunked Response]"),rr(this),Ro(this);else if(0<Te.length&&!this.W){this.W=!0;var Bn=this.j;Bn.g==this&&Bn.ba&&!Bn.M&&(Bn.j.info("Great, no buffering proxy detected. Bytes received: "+Te.length),Ci(Bn),Bn.M=!0,ct(11))}}else ps(this.i,this.l,Te,null),ns(this,Te);pn==4&&rr(this),this.o&&!this.J&&(pn==4?md(this.j,this):(this.o=!1,Po(this)))}else cu(this.g),y==400&&0<Te.indexOf("Unknown SID")?(this.s=3,ct(12)):(this.s=0,ct(13)),rr(this),Ro(this)}}}catch{}finally{}};function ou(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function zf(u,p){var y=u.C,E=p.indexOf(`
`,y);return E==-1?su:(y=Number(p.substring(y,E)),isNaN(y)?nd:(E+=1,E+y>p.length?su:(p=p.slice(E,E+y),u.C=E+y,p)))}gs.prototype.cancel=function(){this.J=!0,rr(this)};function Po(u){u.S=Date.now()+u.I,sd(u,u.I)}function sd(u,p){if(u.B!=null)throw Error("WatchDog timer not null");u.B=nr(g(u.ba,u),p)}function Va(u){u.B&&(a.clearTimeout(u.B),u.B=null)}gs.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(Vs(this.i,this.A),this.L!=2&&(Er(),ct(17)),rr(this),this.s=2,Ro(this)):sd(this,this.S-u)};function Ro(u){u.j.G==0||u.J||md(u.j,u)}function rr(u){Va(u);var p=u.M;p&&typeof p.ma=="function"&&p.ma(),u.M=null,kr(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function ns(u,p){try{var y=u.j;if(y.G!=0&&(y.g==u||Ii(y.h,u))){if(!u.K&&Ii(y.h,u)&&y.G==3){try{var E=y.Da.g.parse(p)}catch{E=null}if(Array.isArray(E)&&E.length==3){var q=E;if(q[0]==0){e:if(!y.u){if(y.g)if(y.g.F+3e3<u.F)Qn(y),Ua(y);else break e;Ba(y),ct(18)}}else y.za=q[1],0<y.za-y.T&&37500>q[2]&&y.F&&y.v==0&&!y.C&&(y.C=nr(g(y.Za,y),6e3));if(1>=au(y.h)&&y.ca){try{y.ca()}catch{}y.ca=void 0}}else ws(y,11)}else if((u.K||y.g==u)&&Qn(y),!O(p))for(q=y.Da.g.parse(p),p=0;p<q.length;p++){let Rt=q[p];if(y.T=Rt[0],Rt=Rt[1],y.G==2)if(Rt[0]=="c"){y.K=Rt[1],y.ia=Rt[2];const Bn=Rt[3];Bn!=null&&(y.la=Bn,y.j.info("VER="+y.la));const pn=Rt[4];pn!=null&&(y.Aa=pn,y.j.info("SVER="+y.Aa));const Ni=Rt[5];Ni!=null&&typeof Ni=="number"&&0<Ni&&(E=1.5*Ni,y.L=E,y.j.info("backChannelRequestTimeoutMs_="+E)),E=y;const Or=u.g;if(Or){const Ha=Or.g?Or.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ha){var Y=E.h;Y.g||Ha.indexOf("spdy")==-1&&Ha.indexOf("quic")==-1&&Ha.indexOf("h2")==-1||(Y.j=Y.l,Y.g=new Set,Y.h&&(Ls(Y,Y.h),Y.h=null))}if(E.D){const Ka=Or.g?Or.g.getResponseHeader("X-HTTP-Session-Id"):null;Ka&&(E.ya=Ka,Ot(E.I,E.D,Ka))}}y.G=3,y.l&&y.l.ua(),y.ba&&(y.R=Date.now()-u.F,y.j.info("Handshake RTT: "+y.R+"ms")),E=y;var Te=u;if(E.qa=vd(E,E.J?E.ia:null,E.W),Te.K){id(E.h,Te);var jt=Te,Mn=E.L;Mn&&(jt.I=Mn),jt.B&&(Va(jt),Po(jt)),E.g=Te}else pd(E);0<y.i.length&&sr(y)}else Rt[0]!="stop"&&Rt[0]!="close"||ws(y,7);else y.G==3&&(Rt[0]=="stop"||Rt[0]=="close"?Rt[0]=="stop"?ws(y,7):ss(y):Rt[0]!="noop"&&y.l&&y.l.ta(Rt),y.v=0)}}Er(4)}catch{}}var vs=class{constructor(u,p){this.g=u,this.map=p}};function Ms(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function rs(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function au(u){return u.h?1:u.g?u.g.size:0}function Ii(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function Ls(u,p){u.g?u.g.add(p):u.h=p}function id(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}Ms.prototype.cancel=function(){if(this.i=Dr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function Dr(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const y of u.g.values())p=p.concat(y.D);return p}return b(u.i)}function od(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var p=[],y=u.length,E=0;E<y;E++)p.push(u[E]);return p}p=[],y=0;for(E in u)p[y++]=u[E];return p}function ad(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var p=[];u=u.length;for(var y=0;y<u;y++)p.push(y);return p}p=[],y=0;for(const E in u)p[y++]=E;return p}}}function Ma(u,p){if(u.forEach&&typeof u.forEach=="function")u.forEach(p,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,p,void 0);else for(var y=ad(u),E=od(u),q=E.length,Y=0;Y<q;Y++)p.call(void 0,E[Y],y&&y[Y],u)}var ld=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function mr(u,p){if(u){u=u.split("&");for(var y=0;y<u.length;y++){var E=u[y].indexOf("="),q=null;if(0<=E){var Y=u[y].substring(0,E);q=u[y].substring(E+1)}else Y=u[y];p(Y,q?decodeURIComponent(q.replace(/\+/g," ")):"")}}}function Br(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof Br){this.h=u.h,Co(this,u.j),this.o=u.o,this.g=u.g,ko(this,u.s),this.l=u.l;var p=u.i,y=new ys;y.i=p.i,p.g&&(y.g=new Map(p.g),y.h=p.h),Ti(this,y),this.m=u.m}else u&&(p=String(u).match(ld))?(this.h=!1,Co(this,p[1]||"",!0),this.o=qr(p[2]||""),this.g=qr(p[3]||"",!0),ko(this,p[4]),this.l=qr(p[5]||"",!0),Ti(this,p[6]||"",!0),this.m=qr(p[7]||"")):(this.h=!1,this.i=new ys(null,this.h))}Br.prototype.toString=function(){var u=[],p=this.j;p&&u.push(Ai(p,zr,!0),":");var y=this.g;return(y||p=="file")&&(u.push("//"),(p=this.o)&&u.push(Ai(p,zr,!0),"@"),u.push(encodeURIComponent(String(y)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y=this.s,y!=null&&u.push(":",String(y))),(y=this.l)&&(this.g&&y.charAt(0)!="/"&&u.push("/"),u.push(Ai(y,y.charAt(0)=="/"?Kf:Hf,!0))),(y=this.i.toString())&&u.push("?",y),(y=this.m)&&u.push("#",Ai(y,ud)),u.join("")};function Cn(u){return new Br(u)}function Co(u,p,y){u.j=y?qr(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function ko(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function Ti(u,p,y){p instanceof ys?(u.i=p,Si(u.i,u.h)):(y||(p=Ai(p,Gf)),u.i=new ys(p,u.h))}function Ot(u,p,y){u.i.set(p,y)}function $s(u){return Ot(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function qr(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function Ai(u,p,y){return typeof u=="string"?(u=encodeURI(u).replace(p,La),y&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function La(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var zr=/[#\/\?@]/g,Hf=/[#\?:]/g,Kf=/[#\?]/g,Gf=/[#\?@]/g,ud=/#/g;function ys(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function Nr(u){u.g||(u.g=new Map,u.h=0,u.i&&mr(u.i,function(p,y){u.add(decodeURIComponent(p.replace(/\+/g," ")),y)}))}n=ys.prototype,n.add=function(u,p){Nr(this),this.i=null,u=Un(this,u);var y=this.g.get(u);return y||this.g.set(u,y=[]),y.push(p),this.h+=1,this};function $a(u,p){Nr(u),p=Un(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function Le(u,p){return Nr(u),p=Un(u,p),u.g.has(p)}n.forEach=function(u,p){Nr(this),this.g.forEach(function(y,E){y.forEach(function(q){u.call(p,q,E,this)},this)},this)},n.na=function(){Nr(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),y=[];for(let E=0;E<p.length;E++){const q=u[E];for(let Y=0;Y<q.length;Y++)y.push(p[E])}return y},n.V=function(u){Nr(this);let p=[];if(typeof u=="string")Le(this,u)&&(p=p.concat(this.g.get(Un(this,u))));else{u=Array.from(this.g.values());for(let y=0;y<u.length;y++)p=p.concat(u[y])}return p},n.set=function(u,p){return Nr(this),this.i=null,u=Un(this,u),Le(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},n.get=function(u,p){return u?(u=this.V(u),0<u.length?String(u[0]):p):p};function vt(u,p,y){$a(u,p),0<y.length&&(u.i=null,u.g.set(Un(u,p),b(y)),u.h+=y.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var y=0;y<p.length;y++){var E=p[y];const Y=encodeURIComponent(String(E)),Te=this.V(E);for(E=0;E<Te.length;E++){var q=Y;Te[E]!==""&&(q+="="+encodeURIComponent(String(Te[E]))),u.push(q)}}return this.i=u.join("&")};function Un(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function Si(u,p){p&&!u.j&&(Nr(u),u.i=null,u.g.forEach(function(y,E){var q=E.toLowerCase();E!=q&&($a(this,E),vt(this,q,y))},u)),u.j=p}function Wf(u,p){const y=new Vn;if(a.Image){const E=new Image;E.onload=v(_s,y,"TestLoadImage: loaded",!0,p,E),E.onerror=v(_s,y,"TestLoadImage: error",!1,p,E),E.onabort=v(_s,y,"TestLoadImage: abort",!1,p,E),E.ontimeout=v(_s,y,"TestLoadImage: timeout",!1,p,E),a.setTimeout(function(){E.ontimeout&&E.ontimeout()},1e4),E.src=u}else p(!1)}function cd(u,p){const y=new Vn,E=new AbortController,q=setTimeout(()=>{E.abort(),_s(y,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:E.signal}).then(Y=>{clearTimeout(q),Y.ok?_s(y,"TestPingServer: ok",!0,p):_s(y,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(q),_s(y,"TestPingServer: error",!1,p)})}function _s(u,p,y,E,q){try{q&&(q.onload=null,q.onerror=null,q.onabort=null,q.ontimeout=null),E(y)}catch{}}function Qf(){this.g=new xi}function lu(u,p,y){const E=y||"";try{Ma(u,function(q,Y){let Te=q;d(q)&&(Te=cn(q)),p.push(E+Y+"="+encodeURIComponent(Te))})}catch(q){throw p.push(E+"type="+encodeURIComponent("_badmap")),q}}function Fa(u){this.l=u.Ub||null,this.j=u.eb||!1}w(Fa,ue),Fa.prototype.g=function(){return new bs(this.l,this.j)},Fa.prototype.i=function(u){return function(){return u}}({});function bs(u,p){Ue.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}w(bs,Ue),n=bs.prototype,n.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,Kr(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Hr(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,Kr(this)),this.g&&(this.readyState=3,Kr(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Do(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function Do(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?Hr(this):Kr(this),this.readyState==3&&Do(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,Hr(this))},n.Qa=function(u){this.g&&(this.response=u,Hr(this))},n.ga=function(){this.g&&Hr(this)};function Hr(u){u.readyState=4,u.l=null,u.j=null,u.v=null,Kr(u)}n.setRequestHeader=function(u,p){this.u.append(u,p)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var y=p.next();!y.done;)y=y.value,u.push(y[0]+": "+y[1]),y=p.next();return u.join(`\r
`)};function Kr(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(bs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function Pi(u){let p="";return re(u,function(y,E){p+=E,p+=":",p+=y,p+=`\r
`}),p}function Fs(u,p,y){e:{for(E in y){var E=!1;break e}E=!0}E||(y=Pi(y),typeof u=="string"?y!=null&&encodeURIComponent(String(y)):Ot(u,p,y))}function Gt(u){Ue.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}w(Gt,Ue);var Jf=/^https?$/i,Yf=["POST","PUT"];n=Gt.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,p,y,E){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ao.g(),this.v=this.o?z(this.o):z(Ao),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(Y){dd(this,Y);return}if(u=y||"",y=new Map(this.headers),E)if(Object.getPrototypeOf(E)===Object.prototype)for(var q in E)y.set(q,E[q]);else if(typeof E.keys=="function"&&typeof E.get=="function")for(const Y of E.keys())y.set(Y,E.get(Y));else throw Error("Unknown input type for opt_headers: "+String(E));E=Array.from(y.keys()).find(Y=>Y.toLowerCase()=="content-type"),q=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(Yf,p,void 0))||E||q||y.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Y,Te]of y)this.g.setRequestHeader(Y,Te);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{dn(this),this.u=!0,this.g.send(u),this.u=!1}catch(Y){dd(this,Y)}};function dd(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,uu(u),it(u)}function uu(u){u.A||(u.A=!0,Ze(u,"complete"),Ze(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,Ze(this,"complete"),Ze(this,"abort"),it(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),it(this,!0)),Gt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Qe(this):this.bb())},n.bb=function(){Qe(this)};function Qe(u){if(u.h&&typeof o<"u"&&(!u.v[1]||rt(u)!=4||u.Z()!=2)){if(u.u&&rt(u)==4)nn(u.Ea,0,u);else if(Ze(u,"readystatechange"),rt(u)==4){u.h=!1;try{const Te=u.Z();e:switch(Te){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var y;if(!(y=p)){var E;if(E=Te===0){var q=String(u.D).match(ld)[1]||null;!q&&a.self&&a.self.location&&(q=a.self.location.protocol.slice(0,-1)),E=!Jf.test(q?q.toLowerCase():"")}y=E}if(y)Ze(u,"complete"),Ze(u,"success");else{u.m=6;try{var Y=2<rt(u)?u.g.statusText:""}catch{Y=""}u.l=Y+" ["+u.Z()+"]",uu(u)}}finally{it(u)}}}}function it(u,p){if(u.g){dn(u);const y=u.g,E=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||Ze(u,"ready");try{y.onreadystatechange=E}catch{}}}function dn(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function rt(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<rt(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),On(p)}};function hd(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function cu(u){const p={};u=(u.g&&2<=rt(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let E=0;E<u.length;E++){if(O(u[E]))continue;var y=U(u[E]);const q=y[0];if(y=y[1],typeof y!="string")continue;y=y.trim();const Y=p[q]||[];p[q]=Y,Y.push(y)}k(p,function(E){return E.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ri(u,p,y){return y&&y.internalChannelParams&&y.internalChannelParams[u]||p}function Us(u){this.Aa=0,this.i=[],this.j=new Vn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ri("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ri("baseRetryDelayMs",5e3,u),this.cb=Ri("retryDelaySeedMs",1e4,u),this.Wa=Ri("forwardChannelMaxRetries",2,u),this.wa=Ri("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new Ms(u&&u.concurrentRequestLimit),this.Da=new Qf,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Us.prototype,n.la=8,n.G=1,n.connect=function(u,p,y,E){ct(0),this.W=u,this.H=p||{},y&&E!==void 0&&(this.H.OSID=y,this.H.OAID=E),this.F=this.X,this.I=vd(this,null,this.W),sr(this)};function ss(u){if(js(u),u.G==3){var p=u.U++,y=Cn(u.I);if(Ot(y,"SID",u.K),Ot(y,"RID",p),Ot(y,"TYPE","terminate"),No(u,y),p=new gs(u,u.j,p),p.L=2,p.v=$s(Cn(y)),y=!1,a.navigator&&a.navigator.sendBeacon)try{y=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!y&&a.Image&&(new Image().src=p.v,y=!0),y||(p.g=du(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Po(p)}za(u)}function Ua(u){u.g&&(Ci(u),u.g.cancel(),u.g=null)}function js(u){Ua(u),u.u&&(a.clearTimeout(u.u),u.u=null),Qn(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function sr(u){if(!rs(u.h)&&!u.s){u.s=!0;var p=u.Ga;We||Se(),se||(We(),se=!0),B.add(p,u),u.B=0}}function Xf(u,p){return au(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=p.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=nr(g(u.Ga,u,p),gd(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const q=new gs(this,this.j,u);let Y=this.o;if(this.S&&(Y?(Y=I(Y),V(Y,this.S)):Y=this.S),this.m!==null||this.O||(q.H=Y,Y=null),this.P)e:{for(var p=0,y=0;y<this.i.length;y++){t:{var E=this.i[y];if("__data__"in E.map&&(E=E.map.__data__,typeof E=="string")){E=E.length;break t}E=void 0}if(E===void 0)break;if(p+=E,4096<p){p=y;break e}if(p===4096||y===this.i.length-1){p=y+1;break e}}p=1e3}else p=1e3;p=fd(this,q,p),y=Cn(this.I),Ot(y,"RID",u),Ot(y,"CVER",22),this.D&&Ot(y,"X-HTTP-Session-Id",this.D),No(this,y),Y&&(this.O?p="headers="+encodeURIComponent(String(Pi(Y)))+"&"+p:this.m&&Fs(y,this.m,Y)),Ls(this.h,q),this.Ua&&Ot(y,"TYPE","init"),this.P?(Ot(y,"$req",p),Ot(y,"SID","null"),q.T=!0,iu(q,y,null)):iu(q,y,p),this.G=2}}else this.G==3&&(u?ja(this,u):this.i.length==0||rs(this.h)||ja(this))};function ja(u,p){var y;p?y=p.l:y=u.U++;const E=Cn(u.I);Ot(E,"SID",u.K),Ot(E,"RID",y),Ot(E,"AID",u.T),No(u,E),u.m&&u.o&&Fs(E,u.m,u.o),y=new gs(u,u.j,y,u.B+1),u.m===null&&(y.H=u.o),p&&(u.i=p.D.concat(u.i)),p=fd(u,y,1e3),y.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),Ls(u.h,y),iu(y,E,p)}function No(u,p){u.H&&re(u.H,function(y,E){Ot(p,E,y)}),u.l&&Ma({},function(y,E){Ot(p,E,y)})}function fd(u,p,y){y=Math.min(u.i.length,y);var E=u.l?g(u.l.Na,u.l,u):null;e:{var q=u.i;let Y=-1;for(;;){const Te=["count="+y];Y==-1?0<y?(Y=q[0].g,Te.push("ofs="+Y)):Y=0:Te.push("ofs="+Y);let jt=!0;for(let Mn=0;Mn<y;Mn++){let Rt=q[Mn].g;const Bn=q[Mn].map;if(Rt-=Y,0>Rt)Y=Math.max(0,q[Mn].g-100),jt=!1;else try{lu(Bn,Te,"req"+Rt+"_")}catch{E&&E(Bn)}}if(jt){E=Te.join("&");break e}}}return u=u.i.splice(0,y),p.D=u,E}function pd(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;We||Se(),se||(We(),se=!0),B.add(p,u),u.v=0}}function Ba(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=nr(g(u.Fa,u),gd(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,qa(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=nr(g(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ct(10),Ua(this),qa(this))};function Ci(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function qa(u){u.g=new gs(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var p=Cn(u.qa);Ot(p,"RID","rpc"),Ot(p,"SID",u.K),Ot(p,"AID",u.T),Ot(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&Ot(p,"TO",u.ja),Ot(p,"TYPE","xmlhttp"),No(u,p),u.m&&u.o&&Fs(p,u.m,u.o),u.L&&(u.g.I=u.L);var y=u.g;u=u.ia,y.L=1,y.v=$s(Cn(p)),y.m=null,y.P=!0,rd(y,u)}n.Za=function(){this.C!=null&&(this.C=null,Ua(this),Ba(this),ct(19))};function Qn(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function md(u,p){var y=null;if(u.g==p){Qn(u),Ci(u),u.g=null;var E=2}else if(Ii(u.h,p))y=p.D,id(u.h,p),E=1;else return;if(u.G!=0){if(p.o)if(E==1){y=p.m?p.m.length:0,p=Date.now()-p.F;var q=u.B;E=Fn(),Ze(E,new Wn(E,y)),sr(u)}else pd(u);else if(q=p.s,q==3||q==0&&0<p.X||!(E==1&&Xf(u,p)||E==2&&Ba(u)))switch(y&&0<y.length&&(p=u.h,p.i=p.i.concat(y)),q){case 1:ws(u,5);break;case 4:ws(u,10);break;case 3:ws(u,6);break;default:ws(u,2)}}}function gd(u,p){let y=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(y*=2),y*p}function ws(u,p){if(u.j.info("Error code "+p),p==2){var y=g(u.fb,u),E=u.Xa;const q=!E;E=new Br(E||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Co(E,"https"),$s(E),q?Wf(E.toString(),y):cd(E.toString(),y)}else ct(2);u.G=0,u.l&&u.l.sa(p),za(u),js(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),ct(2)):(this.j.info("Failed to ping google.com"),ct(1))};function za(u){if(u.G=0,u.ka=[],u.l){const p=Dr(u.h);(p.length!=0||u.i.length!=0)&&(x(u.ka,p),x(u.ka,u.i),u.h.i.length=0,b(u.i),u.i.length=0),u.l.ra()}}function vd(u,p,y){var E=y instanceof Br?Cn(y):new Br(y);if(E.g!="")p&&(E.g=p+"."+E.g),ko(E,E.s);else{var q=a.location;E=q.protocol,p=p?p+"."+q.hostname:q.hostname,q=+q.port;var Y=new Br(null);E&&Co(Y,E),p&&(Y.g=p),q&&ko(Y,q),y&&(Y.l=y),E=Y}return y=u.D,p=u.ya,y&&p&&Ot(E,y,p),Ot(E,"VER",u.la),No(u,E),E}function du(u,p,y){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Ca&&!u.pa?new Gt(new Fa({eb:y})):new Gt(u.pa),p.Ha(u.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Bs(){}n=Bs.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function ki(){}ki.prototype.g=function(u,p){return new jn(u,p)};function jn(u,p){Ue.call(this),this.g=new Us(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!O(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!O(p)&&(this.g.D=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new Di(this)}w(jn,Ue),jn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},jn.prototype.close=function(){ss(this.g)},jn.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var y={};y.__data__=u,u=y}else this.u&&(y={},y.__data__=cn(u),u=y);p.i.push(new vs(p.Ya++,u)),p.G==3&&sr(p)},jn.prototype.N=function(){this.g.l=null,delete this.j,ss(this.g),delete this.g,jn.aa.N.call(this)};function Oo(u){Ye.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const y in p){u=y;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}w(Oo,Ye);function hu(){ut.call(this),this.status=1}w(hu,ut);function Di(u){this.g=u}w(Di,Bs),Di.prototype.ua=function(){Ze(this.g,"a")},Di.prototype.ta=function(u){Ze(this.g,new Oo(u))},Di.prototype.sa=function(u){Ze(this.g,new hu)},Di.prototype.ra=function(){Ze(this.g,"b")},ki.prototype.createWebChannel=ki.prototype.g,jn.prototype.send=jn.prototype.o,jn.prototype.open=jn.prototype.m,jn.prototype.close=jn.prototype.close,fE=function(){return new ki},hE=function(){return Fn()},dE=pt,dm={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ms.NO_ERROR=0,ms.TIMEOUT=8,ms.HTTP_ERROR=6,Kd=ms,Na.COMPLETE="complete",cE=Na,we.EventType=ze,ze.OPEN="a",ze.CLOSE="b",ze.ERROR="c",ze.MESSAGE="d",Ue.prototype.listen=Ue.prototype.K,Ru=we,Gt.prototype.listenOnce=Gt.prototype.L,Gt.prototype.getLastError=Gt.prototype.Ka,Gt.prototype.getLastErrorCode=Gt.prototype.Ba,Gt.prototype.getStatus=Gt.prototype.Z,Gt.prototype.getResponseJson=Gt.prototype.Oa,Gt.prototype.getResponseText=Gt.prototype.oa,Gt.prototype.send=Gt.prototype.ea,Gt.prototype.setWithCredentials=Gt.prototype.Ha,uE=Gt}).apply(typeof Sd<"u"?Sd:typeof self<"u"?self:typeof window<"u"?window:{});const n_="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}zn.UNAUTHENTICATED=new zn(null),zn.GOOGLE_CREDENTIALS=new zn("google-credentials-uid"),zn.FIRST_PARTY=new zn("first-party-uid"),zn.MOCK_USER=new zn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zl="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ao=new pg("@firebase/firestore");function nl(){return ao.logLevel}function IK(n){ao.setLogLevel(n)}function me(n,...e){if(ao.logLevel<=wt.DEBUG){const t=e.map(Ig);ao.debug(`Firestore (${zl}): ${n}`,...t)}}function Tn(n,...e){if(ao.logLevel<=wt.ERROR){const t=e.map(Ig);ao.error(`Firestore (${zl}): ${n}`,...t)}}function es(n,...e){if(ao.logLevel<=wt.WARN){const t=e.map(Ig);ao.warn(`Firestore (${zl}): ${n}`,...t)}}function Ig(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ke(n="Unexpected state"){const e=`FIRESTORE (${zl}) INTERNAL ASSERTION FAILED: `+n;throw Tn(e),new Error(e)}function Me(n,e){n||ke()}function TK(n,e){n||ke()}function Ae(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ge extends fs{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pE{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class CD{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(zn.UNAUTHENTICATED))}shutdown(){}}class kD{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class DD{constructor(e){this.t=e,this.currentUser=zn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Me(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new Kn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Kn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{me("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(me("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Kn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(me("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Me(typeof r.accessToken=="string"),new pE(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Me(e===null||typeof e=="string"),new zn(e)}}class ND{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=zn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class OD{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new ND(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(zn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class mE{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class VD{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Me(this.o===void 0);const r=i=>{i.error!=null&&me("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,me("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{me("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):me("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Me(typeof t.token=="string"),this.R=t.token,new mE(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class AK{getToken(){return Promise.resolve(new mE(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MD(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gE{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=MD(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function et(n,e){return n<e?-1:n>e?1:0}function Tl(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function vE(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hn{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new ge(Q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new ge(Q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new ge(Q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ge(Q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return hn.fromMillis(Date.now())}static fromDate(e){return hn.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new hn(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?et(this.nanoseconds,e.nanoseconds):et(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fe{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Fe(e)}static min(){return new Fe(new hn(0,0))}static max(){return new Fe(new hn(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hc{constructor(e,t,r){t===void 0?t=0:t>e.length&&ke(),r===void 0?r=e.length-t:r>e.length-t&&ke(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return hc.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof hc?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Et extends hc{construct(e,t,r){return new Et(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new ge(Q.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new Et(t)}static emptyPath(){return new Et([])}}const LD=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ln extends hc{construct(e,t,r){return new ln(e,t,r)}static isValidIdentifier(e){return LD.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ln.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new ln(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new ge(Q.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new ge(Q.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new ge(Q.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new ge(Q.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ln(t)}static emptyPath(){return new ln([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pe{constructor(e){this.path=e}static fromPath(e){return new Pe(Et.fromString(e))}static fromName(e){return new Pe(Et.fromString(e).popFirst(5))}static empty(){return new Pe(Et.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Et.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Et.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Pe(new Et(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Al{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function hm(n){return n.fields.find(e=>e.kind===2)}function Ho(n){return n.fields.filter(e=>e.kind!==2)}function $D(n,e){let t=et(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=FD(n.fields[r],e.fields[r]),t!==0)return t;return et(n.fields.length,e.fields.length)}Al.UNKNOWN_ID=-1;class ia{constructor(e,t){this.fieldPath=e,this.kind=t}}function FD(n,e){const t=ln.comparator(n.fieldPath,e.fieldPath);return t!==0?t:et(n.kind,e.kind)}class Sl{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Sl(0,jr.min())}}function yE(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Fe.fromTimestamp(r===1e9?new hn(t+1,0):new hn(t,r));return new jr(s,Pe.empty(),e)}function _E(n){return new jr(n.readTime,n.key,-1)}class jr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new jr(Fe.min(),Pe.empty(),-1)}static max(){return new jr(Fe.max(),Pe.empty(),-1)}}function Tg(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Pe.comparator(n.documentKey,e.documentKey),t!==0?t:et(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bE="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class wE{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bo(n){if(n.code!==Q.FAILED_PRECONDITION||n.message!==bE)throw n;me("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ke(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new H((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof H?t:H.resolve(t)}catch(t){return H.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):H.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):H.reject(t)}static resolve(e){return new H((t,r)=>{t(e)})}static reject(e){return new H((t,r)=>{r(e)})}static waitFor(e){return new H((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=H.resolve(!1);for(const r of e)t=t.next(s=>s?H.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new H((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const d=l;t(e[d]).next(h=>{o[d]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new H((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class of{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Kn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new qu(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=Ag(r.target.error);this.V.reject(new qu(e,s))}}static open(e,t,r,s){try{return new of(t,e.transaction(s,r))}catch(i){throw new qu(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(me("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new jD(t)}}class Cs{constructor(e,t,r){this.name=e,this.version=t,this.p=r,Cs.S(Ln())===12.2&&Tn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return me("SimpleDb","Removing database:",e),Qo(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!fg())return!1;if(Cs.v())return!0;const e=Ln(),t=Cs.S(e),r=0<t&&t<10,s=xE(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(me("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new qu(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new ge(Q.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new ge(Q.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new qu(e,o))},s.onupgradeneeded=i=>{me("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{me("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=of.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(d=>(a.g(),d)).catch(d=>(a.abort(d),H.reject(d))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,d=l.name!=="FirebaseError"&&o<3;if(me("SimpleDb","Transaction failed with error:",l.message,"Retrying:",d),this.close(),!d)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function xE(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class UD{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Qo(this.B.delete())}}class qu extends ge{constructor(e,t){super(Q.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function wo(n){return n.name==="IndexedDbTransactionError"}class jD{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(me("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(me("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Qo(r)}add(e){return me("SimpleDb","ADD",this.store.name,e,e),Qo(this.store.add(e))}get(e){return Qo(this.store.get(e)).next(t=>(t===void 0&&(t=null),me("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return me("SimpleDb","DELETE",this.store.name,e),Qo(this.store.delete(e))}count(){return me("SimpleDb","COUNT",this.store.name),Qo(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new H((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new H((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){me("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new H((r,s)=>{t.onerror=i=>{const o=Ag(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new H((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new UD(a),d=t(a.primaryKey,a.value,l);if(d instanceof H){const h=d.catch(f=>(l.done(),H.reject(f)));r.push(h)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>H.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Qo(n){return new H((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=Ag(r.target.error);t(s)}})}let r_=!1;function Ag(n){const e=Cs.S(Ln());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new ge("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return r_||(r_=!0,setTimeout(()=>{throw r},0)),r}}return n}class BD{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){me("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{me("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){wo(t)?me("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await bo(t)}await this.X(6e4)})}}class qD{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return H.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return me("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(me("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=_E(i);Tg(o,r)>0&&(r=o)}),new jr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Ar.oe=-1;function Oc(n){return n==null}function fc(n){return n===0&&1/n==-1/0}function EE(n){return typeof n=="number"&&Number.isInteger(n)&&!fc(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dr(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=s_(e)),e=zD(n.get(t),e);return s_(e)}function zD(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function s_(n){return n+""}function Ts(n){const e=n.length;if(Me(e>=2),e===2)return Me(n.charAt(0)===""&&n.charAt(1)===""),Et.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&ke(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:ke()}i=o+2}return new Et(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i_=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gd(n,e){return[n,dr(e)]}function IE(n,e,t){return[n,dr(e),t]}const HD={},KD=["prefixPath","collectionGroup","readTime","documentId"],GD=["prefixPath","collectionGroup","documentId"],WD=["collectionGroup","readTime","prefixPath","documentId"],QD=["canonicalId","targetId"],JD=["targetId","path"],YD=["path","targetId"],XD=["collectionId","parent"],ZD=["indexId","uid"],eN=["uid","sequenceNumber"],tN=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],nN=["indexId","uid","orderedDocumentKey"],rN=["userId","collectionPath","documentId"],sN=["userId","collectionPath","largestBatchId"],iN=["userId","collectionGroup","largestBatchId"],TE=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],oN=[...TE,"documentOverlays"],AE=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],SE=AE,Sg=[...SE,"indexConfiguration","indexState","indexEntries"],aN=Sg,lN=[...Sg,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fm extends wE{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function $n(n,e){const t=Ae(n);return Cs.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o_(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function xo(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function PE(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function RE(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tn{constructor(e,t){this.comparator=e,this.root=t||Yn.EMPTY}insert(e,t){return new tn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Yn.BLACK,null,null))}remove(e){return new tn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Yn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Pd(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Pd(this.root,e,this.comparator,!1)}getReverseIterator(){return new Pd(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Pd(this.root,e,this.comparator,!0)}}class Pd{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Yn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Yn.RED,this.left=s??Yn.EMPTY,this.right=i??Yn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Yn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Yn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Yn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Yn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Yn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ke();const e=this.left.check();if(e!==this.right.check())throw ke();return e+(this.isRed()?0:1)}}Yn.EMPTY=null,Yn.RED=!0,Yn.BLACK=!1;Yn.EMPTY=new class{constructor(){this.size=0}get key(){throw ke()}get value(){throw ke()}get color(){throw ke()}get left(){throw ke()}get right(){throw ke()}copy(e,t,r,s,i){return this}insert(e,t,r){return new Yn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kt{constructor(e){this.comparator=e,this.data=new tn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new a_(this.data.getIterator())}getIteratorFrom(e){return new a_(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Kt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Kt(this.comparator);return t.data=e,t}}class a_{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ja(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sr{constructor(e){this.fields=e,e.sort(ln.comparator)}static empty(){return new Sr([])}unionWith(e){let t=new Kt(ln.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Sr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Tl(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CE extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PK(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new CE("Invalid base64 string: "+i):i}}(e);return new vn(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new vn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return et(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}vn.EMPTY_BYTE_STRING=new vn("");const uN=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function li(n){if(Me(!!n),typeof n=="string"){let e=0;const t=uN.exec(n);if(Me(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:an(n.seconds),nanos:an(n.nanos)}}function an(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ui(n){return typeof n=="string"?vn.fromBase64String(n):vn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function af(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function lf(n){const e=n.mapValue.fields.__previous_value__;return af(e)?lf(e):e}function pc(n){const e=li(n.mapValue.fields.__local_write_time__.timestampValue);return new hn(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cN{constructor(e,t,r,s,i,o,a,l,d){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=d}}class da{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new da("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof da&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zi={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Wd={nullValue:"NULL_VALUE"};function lo(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?af(n)?4:kE(n)?9007199254740991:uf(n)?10:11:ke()}function Ns(n,e){if(n===e)return!0;const t=lo(n);if(t!==lo(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return pc(n).isEqual(pc(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=li(s.timestampValue),a=li(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return ui(s.bytesValue).isEqual(ui(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return an(s.geoPointValue.latitude)===an(i.geoPointValue.latitude)&&an(s.geoPointValue.longitude)===an(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return an(s.integerValue)===an(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=an(s.doubleValue),a=an(i.doubleValue);return o===a?fc(o)===fc(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Tl(n.arrayValue.values||[],e.arrayValue.values||[],Ns);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(o_(o)!==o_(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Ns(o[l],a[l])))return!1;return!0}(n,e);default:return ke()}}function mc(n,e){return(n.values||[]).find(t=>Ns(t,e))!==void 0}function uo(n,e){if(n===e)return 0;const t=lo(n),r=lo(e);if(t!==r)return et(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return et(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=an(i.integerValue||i.doubleValue),l=an(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return l_(n.timestampValue,e.timestampValue);case 4:return l_(pc(n),pc(e));case 5:return et(n.stringValue,e.stringValue);case 6:return function(i,o){const a=ui(i),l=ui(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let d=0;d<a.length&&d<l.length;d++){const h=et(a[d],l[d]);if(h!==0)return h}return et(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=et(an(i.latitude),an(o.latitude));return a!==0?a:et(an(i.longitude),an(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return u_(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,d,h;const f=i.fields||{},g=o.fields||{},v=(a=f.value)===null||a===void 0?void 0:a.arrayValue,w=(l=g.value)===null||l===void 0?void 0:l.arrayValue,b=et(((d=v==null?void 0:v.values)===null||d===void 0?void 0:d.length)||0,((h=w==null?void 0:w.values)===null||h===void 0?void 0:h.length)||0);return b!==0?b:u_(v,w)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Zi.mapValue&&o===Zi.mapValue)return 0;if(i===Zi.mapValue)return 1;if(o===Zi.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),d=o.fields||{},h=Object.keys(d);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const g=et(l[f],h[f]);if(g!==0)return g;const v=uo(a[l[f]],d[h[f]]);if(v!==0)return v}return et(l.length,h.length)}(n.mapValue,e.mapValue);default:throw ke()}}function l_(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return et(n,e);const t=li(n),r=li(e),s=et(t.seconds,r.seconds);return s!==0?s:et(t.nanos,r.nanos)}function u_(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=uo(t[s],r[s]);if(i)return i}return et(t.length,r.length)}function Pl(n){return pm(n)}function pm(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=li(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return ui(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Pe.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=pm(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${pm(t.fields[o])}`;return s+"}"}(n.mapValue):ke()}function Qd(n){switch(lo(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=lf(n);return e?16+Qd(e):16;case 5:return 2*n.stringValue.length;case 6:return ui(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Qd(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return xo(r.fields,(i,o)=>{s+=i.length+Qd(o)}),s}(n.mapValue);default:throw ke()}}function ha(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function mm(n){return!!n&&"integerValue"in n}function gc(n){return!!n&&"arrayValue"in n}function c_(n){return!!n&&"nullValue"in n}function d_(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Jd(n){return!!n&&"mapValue"in n}function uf(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function zu(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return xo(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=zu(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=zu(n.arrayValue.values[t]);return e}return Object.assign({},n)}function kE(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const DE={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function dN(n){return"nullValue"in n?Wd:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?ha(da.empty(),Pe.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?uf(n)?DE:{mapValue:{}}:ke()}function hN(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?ha(da.empty(),Pe.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?DE:"mapValue"in n?uf(n)?{mapValue:{}}:Zi:ke()}function h_(n,e){const t=uo(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function f_(n,e){const t=uo(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class er{constructor(e){this.value=e}static empty(){return new er({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Jd(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=zu(t)}setAll(e){let t=ln.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=zu(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Jd(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ns(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Jd(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){xo(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new er(zu(this.value))}}function NE(n){const e=[];return xo(n.fields,(t,r)=>{const s=new ln([t]);if(Jd(r)){const i=NE(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Sr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rn{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new rn(e,0,Fe.min(),Fe.min(),Fe.min(),er.empty(),0)}static newFoundDocument(e,t,r,s){return new rn(e,1,t,Fe.min(),r,s,0)}static newNoDocument(e,t){return new rn(e,2,t,Fe.min(),Fe.min(),er.empty(),0)}static newUnknownDocument(e,t){return new rn(e,3,t,Fe.min(),Fe.min(),er.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Fe.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=er.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=er.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Fe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof rn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new rn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co{constructor(e,t){this.position=e,this.inclusive=t}}function p_(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=Pe.comparator(Pe.fromName(o.referenceValue),t.key):r=uo(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function m_(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ns(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vc{constructor(e,t="asc"){this.field=e,this.dir=t}}function fN(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OE{}class It extends OE{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new pN(e,t,r):t==="array-contains"?new vN(e,r):t==="in"?new UE(e,r):t==="not-in"?new yN(e,r):t==="array-contains-any"?new _N(e,r):new It(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new mN(e,r):new gN(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(uo(t,this.value)):t!==null&&lo(this.value)===lo(t)&&this.matchesComparison(uo(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ke()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class qt extends OE{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new qt(e,t)}matches(e){return Rl(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Rl(n){return n.op==="and"}function gm(n){return n.op==="or"}function Pg(n){return VE(n)&&Rl(n)}function VE(n){for(const e of n.filters)if(e instanceof qt)return!1;return!0}function vm(n){if(n instanceof It)return n.field.canonicalString()+n.op.toString()+Pl(n.value);if(Pg(n))return n.filters.map(e=>vm(e)).join(",");{const e=n.filters.map(t=>vm(t)).join(",");return`${n.op}(${e})`}}function ME(n,e){return n instanceof It?function(r,s){return s instanceof It&&r.op===s.op&&r.field.isEqual(s.field)&&Ns(r.value,s.value)}(n,e):n instanceof qt?function(r,s){return s instanceof qt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&ME(o,s.filters[a]),!0):!1}(n,e):void ke()}function LE(n,e){const t=n.filters.concat(e);return qt.create(t,n.op)}function $E(n){return n instanceof It?function(t){return`${t.field.canonicalString()} ${t.op} ${Pl(t.value)}`}(n):n instanceof qt?function(t){return t.op.toString()+" {"+t.getFilters().map($E).join(" ,")+"}"}(n):"Filter"}class pN extends It{constructor(e,t,r){super(e,t,r),this.key=Pe.fromName(r.referenceValue)}matches(e){const t=Pe.comparator(e.key,this.key);return this.matchesComparison(t)}}class mN extends It{constructor(e,t){super(e,"in",t),this.keys=FE("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class gN extends It{constructor(e,t){super(e,"not-in",t),this.keys=FE("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function FE(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Pe.fromName(r.referenceValue))}class vN extends It{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return gc(t)&&mc(t.arrayValue,this.value)}}class UE extends It{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&mc(this.value.arrayValue,t)}}class yN extends It{constructor(e,t){super(e,"not-in",t)}matches(e){if(mc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!mc(this.value.arrayValue,t)}}class _N extends It{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!gc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>mc(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bN{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function ym(n,e=null,t=[],r=[],s=null,i=null,o=null){return new bN(n,e,t,r,s,i,o)}function fa(n){const e=Ae(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>vm(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Oc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Pl(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Pl(r)).join(",")),e.ue=t}return e.ue}function Vc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!fN(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!ME(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!m_(n.startAt,e.startAt)&&m_(n.endAt,e.endAt)}function yh(n){return Pe.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function _h(n,e){return n.filters.filter(t=>t instanceof It&&t.field.isEqual(e))}function g_(n,e,t){let r=Wd,s=!0;for(const i of _h(n,e)){let o=Wd,a=!0;switch(i.op){case"<":case"<=":o=dN(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Wd}h_({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];h_({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function v_(n,e,t){let r=Zi,s=!0;for(const i of _h(n,e)){let o=Zi,a=!0;switch(i.op){case">=":case">":o=hN(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Zi}f_({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];f_({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function jE(n,e,t,r,s,i,o,a){return new mi(n,e,t,r,s,i,o,a)}function Hl(n){return new mi(n)}function y_(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Rg(n){return n.collectionGroup!==null}function ml(n){const e=Ae(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Kt(ln.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(d=>{d.isInequality()&&(a=a.add(d.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new vc(i,r))}),t.has(ln.keyField().canonicalString())||e.ce.push(new vc(ln.keyField(),r))}return e.ce}function hr(n){const e=Ae(n);return e.le||(e.le=qE(e,ml(n))),e.le}function BE(n){const e=Ae(n);return e.he||(e.he=qE(e,n.explicitOrderBy)),e.he}function qE(n,e){if(n.limitType==="F")return ym(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new vc(s.field,i)});const t=n.endAt?new co(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new co(n.startAt.position,n.startAt.inclusive):null;return ym(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function _m(n,e){const t=n.filters.concat([e]);return new mi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function bh(n,e,t){return new mi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Mc(n,e){return Vc(hr(n),hr(e))&&n.limitType===e.limitType}function zE(n){return`${fa(hr(n))}|lt:${n.limitType}`}function rl(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>$E(s)).join(", ")}]`),Oc(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Pl(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Pl(s)).join(",")),`Target(${r})`}(hr(n))}; limitType=${n.limitType})`}function Lc(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Pe.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of ml(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const d=p_(o,a,l);return o.inclusive?d<=0:d<0}(r.startAt,ml(r),s)||r.endAt&&!function(o,a,l){const d=p_(o,a,l);return o.inclusive?d>=0:d>0}(r.endAt,ml(r),s))}(n,e)}function HE(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function KE(n){return(e,t)=>{let r=!1;for(const s of ml(n)){const i=wN(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function wN(n,e,t){const r=n.field.isKeyField()?Pe.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),d=a.data.field(i);return l!==null&&d!==null?uo(l,d):ke()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return ke()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){xo(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return RE(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xN=new tn(Pe.comparator);function Pr(){return xN}const GE=new tn(Pe.comparator);function Cu(...n){let e=GE;for(const t of n)e=e.insert(t.key,t);return e}function WE(n){let e=GE;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function As(){return Hu()}function QE(){return Hu()}function Hu(){return new gi(n=>n.toString(),(n,e)=>n.isEqual(e))}const EN=new tn(Pe.comparator),IN=new Kt(Pe.comparator);function lt(...n){let e=IN;for(const t of n)e=e.add(t);return e}const TN=new Kt(et);function Cg(){return TN}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kg(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:fc(e)?"-0":e}}function JE(n){return{integerValue:""+n}}function YE(n,e){return EE(e)?JE(e):kg(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cf{constructor(){this._=void 0}}function AN(n,e,t){return n instanceof Cl?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&af(i)&&(i=lf(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof pa?ZE(n,e):n instanceof ma?eI(n,e):function(s,i){const o=XE(s,i),a=__(o)+__(s.Pe);return mm(o)&&mm(s.Pe)?JE(a):kg(s.serializer,a)}(n,e)}function SN(n,e,t){return n instanceof pa?ZE(n,e):n instanceof ma?eI(n,e):t}function XE(n,e){return n instanceof kl?function(r){return mm(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Cl extends cf{}class pa extends cf{constructor(e){super(),this.elements=e}}function ZE(n,e){const t=tI(e);for(const r of n.elements)t.some(s=>Ns(s,r))||t.push(r);return{arrayValue:{values:t}}}class ma extends cf{constructor(e){super(),this.elements=e}}function eI(n,e){let t=tI(e);for(const r of n.elements)t=t.filter(s=>!Ns(s,r));return{arrayValue:{values:t}}}class kl extends cf{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function __(n){return an(n.integerValue||n.doubleValue)}function tI(n){return gc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $c{constructor(e,t){this.field=e,this.transform=t}}function PN(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof pa&&s instanceof pa||r instanceof ma&&s instanceof ma?Tl(r.elements,s.elements,Ns):r instanceof kl&&s instanceof kl?Ns(r.Pe,s.Pe):r instanceof Cl&&s instanceof Cl}(n.transform,e.transform)}class RN{constructor(e,t){this.version=e,this.transformResults=t}}class un{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new un}static exists(e){return new un(void 0,e)}static updateTime(e){return new un(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Yd(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class df{}function nI(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Gl(n.key,un.none()):new Kl(n.key,n.data,un.none());{const t=n.data,r=er.empty();let s=new Kt(ln.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new vi(n.key,r,new Sr(s.toArray()),un.none())}}function CN(n,e,t){n instanceof Kl?function(s,i,o){const a=s.value.clone(),l=w_(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof vi?function(s,i,o){if(!Yd(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=w_(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(rI(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Ku(n,e,t,r){return n instanceof Kl?function(i,o,a,l){if(!Yd(i.precondition,o))return a;const d=i.value.clone(),h=x_(i.fieldTransforms,l,o);return d.setAll(h),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),null}(n,e,t,r):n instanceof vi?function(i,o,a,l){if(!Yd(i.precondition,o))return a;const d=x_(i.fieldTransforms,l,o),h=o.data;return h.setAll(rI(i)),h.setAll(d),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Yd(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function kN(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=XE(r.transform,s||null);i!=null&&(t===null&&(t=er.empty()),t.set(r.field,i))}return t||null}function b_(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Tl(r,s,(i,o)=>PN(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Kl extends df{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class vi extends df{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function rI(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function w_(n,e,t){const r=new Map;Me(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,SN(o,a,t[s]))}return r}function x_(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,AN(i,o,e))}return r}class Gl extends df{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Dg extends df{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ng{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&CN(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Ku(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Ku(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=QE();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=nI(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(Fe.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),lt())}isEqual(e){return this.batchId===e.batchId&&Tl(this.mutations,e.mutations,(t,r)=>b_(t,r))&&Tl(this.baseMutations,e.baseMutations,(t,r)=>b_(t,r))}}class Og{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Me(e.mutations.length===r.length);let s=function(){return EN}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Og(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vg{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sI{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DN{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var kn,Ct;function iI(n){switch(n){default:return ke();case Q.CANCELLED:case Q.UNKNOWN:case Q.DEADLINE_EXCEEDED:case Q.RESOURCE_EXHAUSTED:case Q.INTERNAL:case Q.UNAVAILABLE:case Q.UNAUTHENTICATED:return!1;case Q.INVALID_ARGUMENT:case Q.NOT_FOUND:case Q.ALREADY_EXISTS:case Q.PERMISSION_DENIED:case Q.FAILED_PRECONDITION:case Q.ABORTED:case Q.OUT_OF_RANGE:case Q.UNIMPLEMENTED:case Q.DATA_LOSS:return!0}}function oI(n){if(n===void 0)return Tn("GRPC error has no .code"),Q.UNKNOWN;switch(n){case kn.OK:return Q.OK;case kn.CANCELLED:return Q.CANCELLED;case kn.UNKNOWN:return Q.UNKNOWN;case kn.DEADLINE_EXCEEDED:return Q.DEADLINE_EXCEEDED;case kn.RESOURCE_EXHAUSTED:return Q.RESOURCE_EXHAUSTED;case kn.INTERNAL:return Q.INTERNAL;case kn.UNAVAILABLE:return Q.UNAVAILABLE;case kn.UNAUTHENTICATED:return Q.UNAUTHENTICATED;case kn.INVALID_ARGUMENT:return Q.INVALID_ARGUMENT;case kn.NOT_FOUND:return Q.NOT_FOUND;case kn.ALREADY_EXISTS:return Q.ALREADY_EXISTS;case kn.PERMISSION_DENIED:return Q.PERMISSION_DENIED;case kn.FAILED_PRECONDITION:return Q.FAILED_PRECONDITION;case kn.ABORTED:return Q.ABORTED;case kn.OUT_OF_RANGE:return Q.OUT_OF_RANGE;case kn.UNIMPLEMENTED:return Q.UNIMPLEMENTED;case kn.DATA_LOSS:return Q.DATA_LOSS;default:return ke()}}(Ct=kn||(kn={}))[Ct.OK=0]="OK",Ct[Ct.CANCELLED=1]="CANCELLED",Ct[Ct.UNKNOWN=2]="UNKNOWN",Ct[Ct.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ct[Ct.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ct[Ct.NOT_FOUND=5]="NOT_FOUND",Ct[Ct.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ct[Ct.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ct[Ct.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ct[Ct.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ct[Ct.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ct[Ct.ABORTED=10]="ABORTED",Ct[Ct.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ct[Ct.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ct[Ct.INTERNAL=13]="INTERNAL",Ct[Ct.UNAVAILABLE=14]="UNAVAILABLE",Ct[Ct.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wh=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aI(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NN=new sa([4294967295,4294967295],0);function E_(n){const e=aI().encode(n),t=new lE;return t.update(e),new Uint8Array(t.digest())}function I_(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new sa([t,r],0),new sa([s,i],0)]}class Mg{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ku(`Invalid padding: ${t}`);if(r<0)throw new ku(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ku(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new ku(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=sa.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(sa.fromNumber(r)));return s.compare(NN)===1&&(s=new sa([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=E_(e),[r,s]=I_(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Mg(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=E_(e),[r,s]=I_(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class ku extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fc{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Uc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Fc(Fe.min(),s,new tn(et),Pr(),lt())}}class Uc{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Uc(r,t,lt(),lt(),lt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xd{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class lI{constructor(e,t){this.targetId=e,this.me=t}}class uI{constructor(e,t,r=vn.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class T_{constructor(){this.fe=0,this.ge=S_(),this.pe=vn.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=lt(),t=lt(),r=lt();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:ke()}}),new Uc(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=S_()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Me(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class ON{constructor(e){this.Le=e,this.Be=new Map,this.ke=Pr(),this.qe=A_(),this.Qe=new tn(et)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:ke()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(yh(i))if(r===0){const o=new Pe(i.path);this.Ue(t,o,rn.newNoDocument(o,Fe.min()))}else Me(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,d)}wh==null||wh.et(function(h,f,g,v,w){var b,x,M,O,A,j;const de={localCacheCount:h,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},re=f.unchangedNames;return re&&(de.bloomFilter={applied:w===0,hashCount:(b=re==null?void 0:re.hashCount)!==null&&b!==void 0?b:0,bitmapLength:(O=(M=(x=re==null?void 0:re.bits)===null||x===void 0?void 0:x.bitmap)===null||M===void 0?void 0:M.length)!==null&&O!==void 0?O:0,padding:(j=(A=re==null?void 0:re.bits)===null||A===void 0?void 0:A.padding)!==null&&j!==void 0?j:0,mightContain:k=>{var I;return(I=v==null?void 0:v.mightContain(k))!==null&&I!==void 0&&I}}),de}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=ui(r).toUint8Array()}catch(l){if(l instanceof CE)return es("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Mg(o,s,i)}catch(l){return es(l instanceof ku?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&yh(a.target)){const l=new Pe(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,rn.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=lt();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const d=this.Je(l);return!d||d.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new Fc(e,t,this.Qe,this.ke,r);return this.ke=Pr(),this.qe=A_(),this.Qe=new tn(et),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new T_,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Kt(et),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||me("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new T_),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function A_(){return new tn(Pe.comparator)}function S_(){return new tn(Pe.comparator)}const VN=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),MN=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),LN=(()=>({and:"AND",or:"OR"}))();class $N{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function bm(n,e){return n.useProto3Json||Oc(e)?e:{value:e}}function Dl(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function cI(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function FN(n,e){return Dl(n,e.toTimestamp())}function Pn(n){return Me(!!n),Fe.fromTimestamp(function(t){const r=li(t);return new hn(r.seconds,r.nanos)}(n))}function Lg(n,e){return wm(n,e).canonicalString()}function wm(n,e){const t=function(s){return new Et(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function dI(n){const e=Et.fromString(n);return Me(wI(e)),e}function yc(n,e){return Lg(n.databaseId,e.path)}function ks(n,e){const t=dI(e);if(t.get(1)!==n.databaseId.projectId)throw new ge(Q.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new ge(Q.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Pe(pI(t))}function hI(n,e){return Lg(n.databaseId,e)}function fI(n){const e=dI(n);return e.length===4?Et.emptyPath():pI(e)}function xm(n){return new Et(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function pI(n){return Me(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function P_(n,e,t){return{name:yc(n,e),fields:t.value.mapValue.fields}}function mI(n,e,t){const r=ks(n,e.name),s=Pn(e.updateTime),i=e.createTime?Pn(e.createTime):Fe.min(),o=new er({mapValue:{fields:e.fields}}),a=rn.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function UN(n,e){return"found"in e?function(r,s){Me(!!s.found),s.found.name,s.found.updateTime;const i=ks(r,s.found.name),o=Pn(s.found.updateTime),a=s.found.createTime?Pn(s.found.createTime):Fe.min(),l=new er({mapValue:{fields:s.found.fields}});return rn.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){Me(!!s.missing),Me(!!s.readTime);const i=ks(r,s.missing),o=Pn(s.readTime);return rn.newNoDocument(i,o)}(n,e):ke()}function jN(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:ke()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(d,h){return d.useProto3Json?(Me(h===void 0||typeof h=="string"),vn.fromBase64String(h||"")):(Me(h===void 0||h instanceof Buffer||h instanceof Uint8Array),vn.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(d){const h=d.code===void 0?Q.UNKNOWN:oI(d.code);return new ge(h,d.message||"")}(o);t=new uI(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=ks(n,r.document.name),i=Pn(r.document.updateTime),o=r.document.createTime?Pn(r.document.createTime):Fe.min(),a=new er({mapValue:{fields:r.document.fields}}),l=rn.newFoundDocument(s,i,o,a),d=r.targetIds||[],h=r.removedTargetIds||[];t=new Xd(d,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=ks(n,r.document),i=r.readTime?Pn(r.readTime):Fe.min(),o=rn.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Xd([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=ks(n,r.document),i=r.removedTargetIds||[];t=new Xd([],i,s,null)}else{if(!("filter"in e))return ke();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new DN(s,i),a=r.targetId;t=new lI(a,o)}}return t}function _c(n,e){let t;if(e instanceof Kl)t={update:P_(n,e.key,e.value)};else if(e instanceof Gl)t={delete:yc(n,e.key)};else if(e instanceof vi)t={update:P_(n,e.key,e.data),updateMask:GN(e.fieldMask)};else{if(!(e instanceof Dg))return ke();t={verify:yc(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof Cl)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof pa)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof ma)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof kl)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw ke()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:FN(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ke()}(n,e.precondition)),t}function Em(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?un.updateTime(Pn(i.updateTime)):i.exists!==void 0?un.exists(i.exists):un.none()}(e.currentDocument):un.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Me(a.setToServerValue==="REQUEST_TIME"),l=new Cl;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new pa(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new ma(h)}else"increment"in a?l=new kl(o,a.increment):ke();const d=ln.fromServerFormat(a.fieldPath);return new $c(d,l)}(n,s)):[];if(e.update){e.update.name;const s=ks(n,e.update.name),i=new er({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const d=l.fieldPaths||[];return new Sr(d.map(h=>ln.fromServerFormat(h)))}(e.updateMask);return new vi(s,i,o,t,r)}return new Kl(s,i,t,r)}if(e.delete){const s=ks(n,e.delete);return new Gl(s,t)}if(e.verify){const s=ks(n,e.verify);return new Dg(s,t)}return ke()}function BN(n,e){return n&&n.length>0?(Me(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?Pn(s.updateTime):Pn(i);return o.isEqual(Fe.min())&&(o=Pn(i)),new RN(o,s.transformResults||[])}(t,e))):[]}function gI(n,e){return{documents:[hI(n,e.path)]}}function hf(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=hI(n,s);const i=function(d){if(d.length!==0)return bI(qt.create(d,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(d){if(d.length!==0)return d.map(h=>function(g){return{field:Hi(g.field),direction:zN(g.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=bm(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{_t:t,parent:s}}function vI(n,e,t,r){const{_t:s,parent:i}=hf(n,e),o={},a=[];let l=0;return t.forEach(d=>{const h=r?d.alias:"aggregate_"+l++;o[h]=d.alias,d.aggregateType==="count"?a.push({alias:h,count:{}}):d.aggregateType==="avg"?a.push({alias:h,avg:{field:Hi(d.fieldPath)}}):d.aggregateType==="sum"&&a.push({alias:h,sum:{field:Hi(d.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function yI(n){let e=fI(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Me(r===1);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const g=_I(f);return g instanceof qt&&Pg(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(w){return new vc(sl(w.field),function(x){switch(x){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(w.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,Oc(g)?null:g}(t.limit));let l=null;t.startAt&&(l=function(f){const g=!!f.before,v=f.values||[];return new co(v,g)}(t.startAt));let d=null;return t.endAt&&(d=function(f){const g=!f.before,v=f.values||[];return new co(v,g)}(t.endAt)),jE(e,s,o,i,a,"F",l,d)}function qN(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ke()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function _I(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=sl(t.unaryFilter.field);return It.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=sl(t.unaryFilter.field);return It.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=sl(t.unaryFilter.field);return It.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=sl(t.unaryFilter.field);return It.create(o,"!=",{nullValue:"NULL_VALUE"});default:return ke()}}(n):n.fieldFilter!==void 0?function(t){return It.create(sl(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ke()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return qt.create(t.compositeFilter.filters.map(r=>_I(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ke()}}(t.compositeFilter.op))}(n):ke()}function zN(n){return VN[n]}function HN(n){return MN[n]}function KN(n){return LN[n]}function Hi(n){return{fieldPath:n.canonicalString()}}function sl(n){return ln.fromServerFormat(n.fieldPath)}function bI(n){return n instanceof It?function(t){if(t.op==="=="){if(d_(t.value))return{unaryFilter:{field:Hi(t.field),op:"IS_NAN"}};if(c_(t.value))return{unaryFilter:{field:Hi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(d_(t.value))return{unaryFilter:{field:Hi(t.field),op:"IS_NOT_NAN"}};if(c_(t.value))return{unaryFilter:{field:Hi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Hi(t.field),op:HN(t.op),value:t.value}}}(n):n instanceof qt?function(t){const r=t.getFilters().map(s=>bI(s));return r.length===1?r[0]:{compositeFilter:{op:KN(t.op),filters:r}}}(n):ke()}function GN(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function wI(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Js{constructor(e,t,r,s,i=Fe.min(),o=Fe.min(),a=vn.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Js(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Js(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Js(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Js(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xI{constructor(e){this.ct=e}}function WN(n,e){let t;if(e.document)t=mI(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Pe.fromSegments(e.noDocument.path),s=va(e.noDocument.readTime);t=rn.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return ke();{const r=Pe.fromSegments(e.unknownDocument.path),s=va(e.unknownDocument.version);t=rn.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new hn(s[0],s[1]);return Fe.fromTimestamp(i)}(e.readTime)),t}function R_(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:xh(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:yc(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Dl(i,o.version.toTimestamp()),createTime:Dl(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:ga(e.version)};else{if(!e.isUnknownDocument())return ke();r.unknownDocument={path:t.path.toArray(),version:ga(e.version)}}return r}function xh(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function ga(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function va(n){const e=new hn(n.seconds,n.nanoseconds);return Fe.fromTimestamp(e)}function Jo(n,e){const t=(e.baseMutations||[]).map(i=>Em(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>Em(n.ct,i)),s=hn.fromMillis(e.localWriteTimeMs);return new Ng(e.batchId,s,t,r)}function Du(n){const e=va(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?va(n.lastLimboFreeSnapshotVersion):Fe.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return Me(i.documents.length===1),hr(Hl(fI(i.documents[0])))}(n.query):function(i){return hr(yI(i))}(n.query),new Js(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,vn.fromBase64String(n.resumeToken))}function EI(n,e){const t=ga(e.snapshotVersion),r=ga(e.lastLimboFreeSnapshotVersion);let s;s=yh(e.target)?gI(n.ct,e.target):hf(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:fa(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function $g(n){const e=yI({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?bh(e,e.limit,"L"):e}function kp(n,e){return new Vg(e.largestBatchId,Em(n.ct,e.overlayMutation))}function C_(n,e){const t=e.path.lastSegment();return[n,dr(e.path.popLast()),t]}function k_(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:ga(r.readTime),documentKey:dr(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QN{getBundleMetadata(e,t){return D_(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:va(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return D_(e).put(function(s){return{bundleId:s.id,createTime:ga(Pn(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return N_(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:$g(i.bundledQuery),readTime:va(i.readTime)}}(r)})}saveNamedQuery(e,t){return N_(e).put(function(s){return{name:s.name,readTime:ga(Pn(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function D_(n){return $n(n,"bundles")}function N_(n){return $n(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ff{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new ff(e,r)}getOverlay(e,t){return yu(e).get(C_(this.userId,t)).next(r=>r?kp(this.serializer,r):null)}getOverlays(e,t){const r=As();return H.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Vg(t,o);s.push(this.ht(e,a))}),H.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(dr(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(yu(e).j("collectionPathOverlayIndex",a))}),H.waitFor(i)}getOverlaysForCollection(e,t,r){const s=As(),i=dr(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return yu(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const d=kp(this.serializer,l);s.set(d.getKey(),d)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=As();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return yu(e).J({index:"collectionGroupOverlayIndex",range:a},(l,d,h)=>{const f=kp(this.serializer,d);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}ht(e,t){return yu(e).put(function(s,i,o){const[a,l,d]=C_(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:d,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:_c(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function yu(n){return $n(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JN{Pt(e){return $n(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?vn.fromUint8Array(r):vn.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yo{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(an(e.integerValue));else if("doubleValue"in e){const r=an(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),fc(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=li(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(ui(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?kE(e)?this.dt(t,Number.MAX_SAFE_INTEGER):uf(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):ke()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(an(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),Pe.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}Yo.vt=new Yo;function YN(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function O_(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=YN(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class XN{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=O_(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=O_(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class ZN{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class eO{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class _u{constructor(){this.jt=new XN,this.Ht=new ZN(this.jt),this.Jt=new eO(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xo{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Xo(this.indexId,this.documentKey,this.arrayValue,r)}}function Li(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=V_(n.arrayValue,e.arrayValue),t!==0?t:(t=V_(n.directionalValue,e.directionalValue),t!==0?t:Pe.comparator(n.documentKey,e.documentKey)))}function V_(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M_{constructor(e){this.Xt=new Kt((t,r)=>ln.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Me(e.collectionGroup===this.collectionId),this.nn)return!1;const t=hm(e);if(t!==void 0&&!this.sn(t))return!1;const r=Ho(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new Kt(ln.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new ia(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new ia(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new ia(r.field,r.dir==="asc"?0:1)));return new Al(Al.UNKNOWN_ID,this.collectionId,t,Sl.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function II(n){var e,t;if(Me(n instanceof It||n instanceof qt),n instanceof It){if(n instanceof UE){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>It.create(n.field,"==",i)))||[];return qt.create(s,"or")}return n}const r=n.filters.map(s=>II(s));return qt.create(r,n.op)}function tO(n){if(n.getFilters().length===0)return[];const e=Am(II(n));return Me(TI(e)),Im(e)||Tm(e)?[e]:e.getFilters()}function Im(n){return n instanceof It}function Tm(n){return n instanceof qt&&Pg(n)}function TI(n){return Im(n)||Tm(n)||function(t){if(t instanceof qt&&gm(t)){for(const r of t.getFilters())if(!Im(r)&&!Tm(r))return!1;return!0}return!1}(n)}function Am(n){if(Me(n instanceof It||n instanceof qt),n instanceof It)return n;if(n.filters.length===1)return Am(n.filters[0]);const e=n.filters.map(r=>Am(r));let t=qt.create(e,n.op);return t=Eh(t),TI(t)?t:(Me(t instanceof qt),Me(Rl(t)),Me(t.filters.length>1),t.filters.reduce((r,s)=>Fg(r,s)))}function Fg(n,e){let t;return Me(n instanceof It||n instanceof qt),Me(e instanceof It||e instanceof qt),t=n instanceof It?e instanceof It?function(s,i){return qt.create([s,i],"and")}(n,e):L_(n,e):e instanceof It?L_(e,n):function(s,i){if(Me(s.filters.length>0&&i.filters.length>0),Rl(s)&&Rl(i))return LE(s,i.getFilters());const o=gm(s)?s:i,a=gm(s)?i:s,l=o.filters.map(d=>Fg(d,a));return qt.create(l,"or")}(n,e),Eh(t)}function L_(n,e){if(Rl(e))return LE(e,n.getFilters());{const t=e.filters.map(r=>Fg(n,r));return qt.create(t,"or")}}function Eh(n){if(Me(n instanceof It||n instanceof qt),n instanceof It)return n;const e=n.getFilters();if(e.length===1)return Eh(e[0]);if(VE(n))return n;const t=e.map(s=>Eh(s)),r=[];return t.forEach(s=>{s instanceof It?r.push(s):s instanceof qt&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:qt.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nO{constructor(){this.un=new Ug}addToCollectionParentIndex(e,t){return this.un.add(t),H.resolve()}getCollectionParents(e,t){return H.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return H.resolve()}deleteFieldIndex(e,t){return H.resolve()}deleteAllFieldIndexes(e){return H.resolve()}createTargetIndexes(e,t){return H.resolve()}getDocumentsMatchingTarget(e,t){return H.resolve(null)}getIndexType(e,t){return H.resolve(0)}getFieldIndexes(e,t){return H.resolve([])}getNextCollectionGroupToUpdate(e){return H.resolve(null)}getMinOffset(e,t){return H.resolve(jr.min())}getMinOffsetFromCollectionGroup(e,t){return H.resolve(jr.min())}updateCollectionGroup(e,t,r){return H.resolve()}updateIndexEntries(e,t){return H.resolve()}}class Ug{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Kt(Et.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Kt(Et.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rd=new Uint8Array(0);class rO{constructor(e,t){this.databaseId=t,this.cn=new Ug,this.ln=new gi(r=>fa(r),(r,s)=>Vc(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:dr(s)};return $_(e).put(i)}return H.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[vE(t),""],!1,!0);return $_(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Ts(o.parent))}return r})}addFieldIndex(e,t){const r=bu(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Xa(e);return i.next(a=>{o.put(k_(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=bu(e),s=Xa(e),i=Ya(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=bu(e),r=Ya(e),s=Xa(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return H.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new M_(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=Ya(e);let s=!0;const i=new Map;return H.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=lt();const a=[];return H.forEach(i,(l,d)=>{me("IndexedDbIndexManager",`Using index ${function(A){return`id=${A.indexId}|cg=${A.collectionGroup}|f=${A.fields.map(j=>`${j.fieldPath}:${j.kind}`).join(",")}`}(l)} to execute ${fa(t)}`);const h=function(A,j){const de=hm(j);if(de===void 0)return null;for(const re of _h(A,de.fieldPath))switch(re.op){case"array-contains-any":return re.value.arrayValue.values||[];case"array-contains":return[re.value]}return null}(d,l),f=function(A,j){const de=new Map;for(const re of Ho(j))for(const k of _h(A,re.fieldPath))switch(k.op){case"==":case"in":de.set(re.fieldPath.canonicalString(),k.value);break;case"not-in":case"!=":return de.set(re.fieldPath.canonicalString(),k.value),Array.from(de.values())}return null}(d,l),g=function(A,j){const de=[];let re=!0;for(const k of Ho(j)){const I=k.kind===0?g_(A,k.fieldPath,A.startAt):v_(A,k.fieldPath,A.startAt);de.push(I.value),re&&(re=I.inclusive)}return new co(de,re)}(d,l),v=function(A,j){const de=[];let re=!0;for(const k of Ho(j)){const I=k.kind===0?v_(A,k.fieldPath,A.endAt):g_(A,k.fieldPath,A.endAt);de.push(I.value),re&&(re=I.inclusive)}return new co(de,re)}(d,l),w=this.In(l,d,g),b=this.In(l,d,v),x=this.Tn(l,d,f),M=this.En(l.indexId,h,w,g.inclusive,b,v.inclusive,x);return H.forEach(M,O=>r.G(O,t.limit).next(A=>{A.forEach(j=>{const de=Pe.fromSegments(j.documentKey);o.has(de)||(o=o.add(de),a.push(de))})}))}).next(()=>a)}return H.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=tO(qt.create(e.filters,"and")).map(r=>ym(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),d=l/(t!=null?t.length:1),h=[];for(let f=0;f<l;++f){const g=t?this.dn(t[f/d]):Rd,v=this.An(e,g,r[f%d],s),w=this.Rn(e,g,i[f%d],o),b=a.map(x=>this.An(e,g,x,!0));h.push(...this.createRange(v,w,b))}return h}An(e,t,r,s){const i=new Xo(e,Pe.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new Xo(e,Pe.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new M_(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return H.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let d=new Kt(ln.comparator),h=!1;for(const f of l.filters)for(const g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?h=!0:d=d.add(g.field));for(const f of l.orderBy)f.field.isKeyField()||(d=d.add(f.field));return d.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new _u;for(const s of Ho(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);Yo.vt.It(i,o)}return r.zt()}dn(e){const t=new _u;return Yo.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new _u;return Yo.vt.It(ha(this.databaseId,t),r.Yt(function(i){const o=Ho(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new _u);let i=0;for(const o of Ho(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&gc(a))s=this.gn(s,o,a);else{const d=l.Yt(o.kind);Yo.vt.It(a,d)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new _u;l.seed(a.zt()),Yo.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof It&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=bu(e),s=Xa(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return H.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(h,f){const g=f?new Sl(f.sequenceNumber,new jr(va(f.readTime),new Pe(Ts(f.documentKey)),f.largestBatchId)):Sl.empty(),v=h.fields.map(([w,b])=>new ia(ln.fromServerFormat(w),b));return new Al(h.indexId,h.collectionGroup,v,g)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:et(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=bu(e),i=Xa(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>H.forEach(a,l=>i.put(k_(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return H.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?H.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),H.forEach(a,l=>this.wn(e,s,l).next(d=>{const h=this.Sn(i,l);return d.isEqual(h)?H.resolve():this.bn(e,i,l,d,h)}))))})}Dn(e,t,r,s){return Ya(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return Ya(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=Ya(e);let i=new Kt(Li);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new Xo(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new Kt(Li);const s=this.Vn(t,e);if(s==null)return r;const i=hm(t);if(i!=null){const o=e.data.field(i.fieldPath);if(gc(o))for(const a of o.arrayValue.values||[])r=r.add(new Xo(t.indexId,e.key,this.dn(a),s))}else r=r.add(new Xo(t.indexId,e.key,Rd,s));return r}bn(e,t,r,s,i){me("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,d,h,f,g){const v=l.getIterator(),w=d.getIterator();let b=Ja(v),x=Ja(w);for(;b||x;){let M=!1,O=!1;if(b&&x){const A=h(b,x);A<0?O=!0:A>0&&(M=!0)}else b!=null?O=!0:M=!0;M?(f(x),x=Ja(w)):O?(g(b),b=Ja(v)):(b=Ja(v),x=Ja(w))}}(s,i,Li,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),H.waitFor(o)}yn(e){let t=1;return Xa(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Li(o,a)).filter((o,a,l)=>!a||Li(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=Li(o,e),l=Li(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Rd,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Rd,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return Li(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(F_)}getMinOffset(e,t){return H.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||ke())).next(F_)}}function $_(n){return $n(n,"collectionParents")}function Ya(n){return $n(n,"indexEntries")}function bu(n){return $n(n,"indexConfiguration")}function Xa(n){return $n(n,"indexState")}function F_(n){Me(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Tg(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new jr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class ar{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new ar(e,ar.DEFAULT_COLLECTION_PERCENTILE,ar.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AI(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(h,f,g)=>(a++,g.delete()));i.push(l.next(()=>{Me(a===1)}));const d=[];for(const h of t.mutations){const f=IE(e,h.key.path,t.batchId);i.push(s.delete(f)),d.push(h.key)}return H.waitFor(i).next(()=>d)}function Ih(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw ke();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ar.DEFAULT_COLLECTION_PERCENTILE=10,ar.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ar.DEFAULT=new ar(41943040,ar.DEFAULT_COLLECTION_PERCENTILE,ar.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ar.DISABLED=new ar(-1,0,0);class pf{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){Me(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new pf(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return $i(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=il(e),o=$i(e);return o.add({}).next(a=>{Me(typeof a=="number");const l=new Ng(a,t,r,s),d=function(v,w,b){const x=b.baseMutations.map(O=>_c(v.ct,O)),M=b.mutations.map(O=>_c(v.ct,O));return{userId:w,batchId:b.batchId,localWriteTimeMs:b.localWriteTime.toMillis(),baseMutations:x,mutations:M}}(this.serializer,this.userId,l),h=[];let f=new Kt((g,v)=>et(g.canonicalString(),v.canonicalString()));for(const g of s){const v=IE(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),h.push(o.put(d)),h.push(i.put(v,HD))}return f.forEach(g=>{h.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),H.waitFor(h).next(()=>l)})}lookupMutationBatch(e,t){return $i(e).get(t).next(r=>r?(Me(r.userId===this.userId),Jo(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?H.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return $i(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(Me(a.batchId>=r),i=Jo(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return $i(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return $i(e).U("userMutationsIndex",t).next(r=>r.map(s=>Jo(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Gd(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return il(e).J({range:s},(o,a,l)=>{const[d,h,f]=o,g=Ts(h);if(d===this.userId&&t.path.isEqual(g))return $i(e).get(f).next(v=>{if(!v)throw ke();Me(v.userId===this.userId),i.push(Jo(this.serializer,v))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Kt(et);const s=[];return t.forEach(i=>{const o=Gd(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=il(e).J({range:a},(d,h,f)=>{const[g,v,w]=d,b=Ts(v);g===this.userId&&i.path.isEqual(b)?r=r.add(w):f.done()});s.push(l)}),H.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Gd(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new Kt(et);return il(e).J({range:o},(l,d,h)=>{const[f,g,v]=l,w=Ts(g);f===this.userId&&r.isPrefixOf(w)?w.length===s&&(a=a.add(v)):h.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push($i(e).get(i).next(o=>{if(o===null)throw ke();Me(o.userId===this.userId),r.push(Jo(this.serializer,o))}))}),H.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return AI(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),H.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return H.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return il(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=Ts(i[1]);s.push(l)}else a.done()}).next(()=>{Me(s.length===0)})})}containsKey(e,t){return SI(e,this.userId,t)}Nn(e){return PI(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function SI(n,e,t){const r=Gd(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return il(n).J({range:i,H:!0},(a,l,d)=>{const[h,f,g]=a;h===e&&f===s&&(o=!0),d.done()}).next(()=>o)}function $i(n){return $n(n,"mutations")}function il(n){return $n(n,"documentMutations")}function PI(n){return $n(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ya{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new ya(0)}static kn(){return new ya(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sO{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new ya(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>Fe.fromTimestamp(new hn(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Za(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Me(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Za(e).J((o,a)=>{const l=Du(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>H.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Za(e).J((r,s)=>{const i=Du(s);t(i)})}qn(e){return j_(e).get("targetGlobalKey").next(t=>(Me(t!==null),t))}Qn(e,t){return j_(e).put("targetGlobalKey",t)}Kn(e,t){return Za(e).put(EI(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=fa(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Za(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const d=Du(a);Vc(t,d.target)&&(i=d,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=Ki(e);return t.forEach(o=>{const a=dr(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),H.waitFor(s)}removeMatchingKeys(e,t,r){const s=Ki(e);return H.forEach(t,i=>{const o=dr(i.path);return H.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=Ki(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=Ki(e);let i=lt();return s.J({range:r,H:!0},(o,a,l)=>{const d=Ts(o[1]),h=new Pe(d);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=dr(t.path),s=IDBKeyRange.bound([r],[vE(r)],!1,!0);let i=0;return Ki(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,d)=>{o!==0&&(i++,d.done())}).next(()=>i>0)}ot(e,t){return Za(e).get(t).next(r=>r?Du(r):null)}}function Za(n){return $n(n,"targets")}function j_(n){return $n(n,"targetGlobal")}function Ki(n){return $n(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B_([n,e],[t,r]){const s=et(n,t);return s===0?et(e,r):s}class iO{constructor(e){this.Un=e,this.buffer=new Kt(B_),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();B_(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class RI{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){me("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){wo(t)?me("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await bo(t)}await this.Hn(3e5)})}}class oO{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return H.resolve(Ar.oe);const r=new iO(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(me("LruGarbageCollector","Garbage collection skipped; disabled"),H.resolve(U_)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(me("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),U_):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,d;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(me("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(d=Date.now(),nl()<=wt.DEBUG&&me("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(d-l)+`ms
Total Duration: ${d-h}ms`),H.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function CI(n,e){return new oO(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aO{constructor(e,t){this.db=e,this.garbageCollector=CI(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return Cd(e,r)}removeReference(e,t,r){return Cd(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Cd(e,t)}nr(e,t){return function(s,i){let o=!1;return PI(s).Y(a=>SI(s,a,i).next(l=>(l&&(o=!0),H.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(d=>{if(!d)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,Fe.min()),Ki(e).delete(function(f){return[0,dr(f.path)]}(o))))});s.push(l)}}).next(()=>H.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Cd(e,t)}tr(e,t){const r=Ki(e);let s,i=Ar.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:d})=>{o===0?(i!==Ar.oe&&t(new Pe(Ts(s)),i),i=d,s=l):i=Ar.oe}).next(()=>{i!==Ar.oe&&t(new Pe(Ts(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Cd(n,e){return Ki(n).put(function(r,s){return{targetId:0,path:dr(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kI{constructor(){this.changes=new gi(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,rn.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?H.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lO{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Bo(e).put(r)}removeEntry(e,t,r){return Bo(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],xh(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=rn.newInvalidDocument(t);return Bo(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(wu(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:rn.newInvalidDocument(t)};return Bo(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(wu(t))},(s,i)=>{r={document:this.ir(t,i),size:Ih(i)}}).next(()=>r)}getEntries(e,t){let r=Pr();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=Pr(),s=new tn(Pe.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,Ih(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return H.resolve();let s=new Kt(H_);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(wu(s.first()),wu(s.last())),o=s.getIterator();let a=o.getNext();return Bo(e).J({index:"documentKeyIndex",range:i},(l,d,h)=>{const f=Pe.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;a&&H_(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,d),a=o.hasNext()?o.getNext():null),a?h.$(wu(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),xh(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Bo(e).U(IDBKeyRange.bound(a,l,!0)).next(d=>{i==null||i.incrementDocumentReadCount(d.length);let h=Pr();for(const f of d){const g=this.ir(Pe.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&(Lc(t,g)||s.has(g.key))&&(h=h.insert(g.key,g))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=Pr();const o=z_(t,r),a=z_(t,jr.max());return Bo(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,d,h)=>{const f=this.ir(Pe.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new uO(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return q_(e).get("remoteDocumentGlobalKey").next(t=>(Me(!!t),t))}rr(e,t){return q_(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=WN(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Fe.min())))return r}return rn.newInvalidDocument(e)}}function DI(n){return new lO(n)}class uO extends kI{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new gi(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new Kt((i,o)=>et(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=R_(this.cr.serializer,o);s=s.add(i.path.popLast());const d=Ih(l);r+=d-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=R_(this.cr.serializer,o.convertToNoDocument(Fe.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),H.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function q_(n){return $n(n,"remoteDocumentGlobal")}function Bo(n){return $n(n,"remoteDocumentsV14")}function wu(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function z_(n,e){const t=e.documentKey.path.toArray();return[n,xh(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function H_(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=et(t[i],r[i]),s)return s;return s=et(t.length,r.length),s||(s=et(t[t.length-2],r[r.length-2]),s||et(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cO{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NI{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Ku(r.mutation,s,Sr.empty(),hn.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,lt()).next(()=>r))}getLocalViewOfDocuments(e,t,r=lt()){const s=As();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Cu();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=As();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,lt()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=Pr();const o=Hu(),a=function(){return Hu()}();return t.forEach((l,d)=>{const h=r.get(d.key);s.has(d.key)&&(h===void 0||h.mutation instanceof vi)?i=i.insert(d.key,d):h!==void 0?(o.set(d.key,h.mutation.getFieldMask()),Ku(h.mutation,d,h.mutation.getFieldMask(),hn.now())):o.set(d.key,Sr.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((d,h)=>o.set(d,h)),t.forEach((d,h)=>{var f;return a.set(d,new cO(h,(f=o.get(d))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Hu();let s=new tn((o,a)=>o-a),i=lt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const d=t.get(l);if(d===null)return;let h=r.get(l)||Sr.empty();h=a.applyToLocalView(d,h),r.set(l,h);const f=(s.get(a.batchId)||lt()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),d=l.key,h=l.value,f=QE();h.forEach(g=>{if(!i.has(g)){const v=nI(t.get(g),r.get(g));v!==null&&f.set(g,v),i=i.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,d,f))}return H.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return Pe.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Rg(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):H.resolve(As());let a=-1,l=i;return o.next(d=>H.forEach(d,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?H.resolve():this.remoteDocumentCache.getEntry(e,h).next(g=>{l=l.insert(h,g)}))).next(()=>this.populateOverlays(e,d,i)).next(()=>this.computeViews(e,l,d,lt())).next(h=>({batchId:a,changes:WE(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Pe(t)).next(r=>{let s=Cu();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Cu();return this.indexManager.getCollectionParents(e,i).next(a=>H.forEach(a,l=>{const d=function(f,g){return new mi(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next(h=>{h.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,d)=>{const h=d.getKey();o.get(h)===null&&(o=o.insert(h,rn.newInvalidDocument(h)))});let a=Cu();return o.forEach((l,d)=>{const h=i.get(l);h!==void 0&&Ku(h.mutation,d,Sr.empty(),hn.now()),Lc(t,d)&&(a=a.insert(l,d))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dO{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return H.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Pn(s.createTime)}}(t)),H.resolve()}getNamedQuery(e,t){return H.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:$g(s.bundledQuery),readTime:Pn(s.readTime)}}(t)),H.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hO{constructor(){this.overlays=new tn(Pe.comparator),this.Ir=new Map}getOverlay(e,t){return H.resolve(this.overlays.get(t))}getOverlays(e,t){const r=As();return H.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),H.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),H.resolve()}getOverlaysForCollection(e,t,r){const s=As(),i=t.length+1,o=new Pe(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,d=l.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return H.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new tn((d,h)=>d-h);const o=this.overlays.getIterator();for(;o.hasNext();){const d=o.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let h=i.get(d.largestBatchId);h===null&&(h=As(),i=i.insert(d.largestBatchId,h)),h.set(d.getKey(),d)}}const a=As(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,h)=>a.set(d,h)),!(a.size()>=s)););return H.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Vg(t,r));let i=this.Ir.get(t);i===void 0&&(i=lt(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fO{constructor(){this.sessionToken=vn.EMPTY_BYTE_STRING}getSessionToken(e){return H.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,H.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jg{constructor(){this.Tr=new Kt(qn.Er),this.dr=new Kt(qn.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new qn(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new qn(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new Pe(new Et([])),r=new qn(t,e),s=new qn(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Pe(new Et([])),r=new qn(t,e),s=new qn(t,e+1);let i=lt();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new qn(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class qn{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Pe.comparator(e.key,t.key)||et(e.wr,t.wr)}static Ar(e,t){return et(e.wr,t.wr)||Pe.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pO{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Kt(qn.Er)}checkEmpty(e){return H.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Ng(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new qn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return H.resolve(o)}lookupMutationBatch(e,t){return H.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return H.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return H.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return H.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new qn(t,0),s=new qn(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),H.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Kt(et);return t.forEach(s=>{const i=new qn(s,0),o=new qn(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),H.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;Pe.isDocumentKey(i)||(i=i.child(""));const o=new qn(new Pe(i),0);let a=new Kt(et);return this.br.forEachWhile(l=>{const d=l.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(a=a.add(l.wr)),!0)},o),H.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Me(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return H.forEach(t.mutations,s=>{const i=new qn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new qn(t,0),s=this.br.firstAfterOrEqual(r);return H.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,H.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mO{constructor(e){this.Mr=e,this.docs=function(){return new tn(Pe.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return H.resolve(r?r.document.mutableCopy():rn.newInvalidDocument(t))}getEntries(e,t){let r=Pr();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():rn.newInvalidDocument(s))}),H.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Pr();const o=t.path,a=new Pe(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:d,value:{document:h}}=l.getNext();if(!o.isPrefixOf(d.path))break;d.path.length>o.length+1||Tg(_E(h),r)<=0||(s.has(h.key)||Lc(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return H.resolve(i)}getAllFromCollectionGroup(e,t,r,s){ke()}Or(e,t){return H.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new gO(this)}getSize(e){return H.resolve(this.size)}}class gO extends kI{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),H.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vO{constructor(e){this.persistence=e,this.Nr=new gi(t=>fa(t),Vc),this.lastRemoteSnapshotVersion=Fe.min(),this.highestTargetId=0,this.Lr=0,this.Br=new jg,this.targetCount=0,this.kr=ya.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),H.resolve()}getLastRemoteSnapshotVersion(e){return H.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return H.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),H.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),H.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new ya(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,H.resolve()}updateTargetData(e,t){return this.Kn(t),H.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,H.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),H.waitFor(i).next(()=>s)}getTargetCount(e){return H.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return H.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),H.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),H.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),H.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return H.resolve(r)}containsKey(e,t){return H.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bg{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Ar(0),this.Kr=!1,this.Kr=!0,this.$r=new fO,this.referenceDelegate=e(this),this.Ur=new vO(this),this.indexManager=new nO,this.remoteDocumentCache=function(s){return new mO(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new xI(t),this.Gr=new dO(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new hO,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new pO(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){me("MemoryPersistence","Starting transaction:",e);const s=new yO(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return H.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class yO extends wE{constructor(e){super(),this.currentSequenceNumber=e}}class mf{constructor(e){this.persistence=e,this.Jr=new jg,this.Yr=null}static Zr(e){return new mf(e)}get Xr(){if(this.Yr)return this.Yr;throw ke()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),H.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),H.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),H.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return H.forEach(this.Xr,r=>{const s=Pe.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,Fe.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return H.or([()=>H.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class Th{constructor(e,t){this.persistence=e,this.ti=new gi(r=>dr(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=CI(this,t)}static Zr(e,t){return new Th(e,t)}zr(){}jr(e){return H.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return H.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?H.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,Fe.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),H.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),H.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),H.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),H.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Qd(e.data.value)),t}nr(e,t,r){return H.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return H.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _O{constructor(e){this.serializer=e}O(e,t,r,s){const i=new of("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",i_,{unique:!0}),l.createObjectStore("documentMutations")}(e),K_(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=H.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),K_(e)),o=o.next(()=>function(l){const d=l.store("targetGlobal"),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Fe.min().toTimestamp(),targetCount:0};return d.put("targetGlobalKey",h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,d){return d.store("mutations").U().next(h=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",i_,{unique:!0});const f=d.store("mutations"),g=h.map(v=>f.put(v));return H.waitFor(g)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const d=l.createObjectStore("documentOverlays",{keyPath:rN});d.createIndex("collectionPathOverlayIndex",sN,{unique:!1}),d.createIndex("collectionGroupOverlayIndex",iN,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const d=l.createObjectStore("remoteDocumentsV14",{keyPath:KD});d.createIndex("documentKeyIndex",GD),d.createIndex("collectionGroupIndex",WD)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:ZD}).createIndex("sequenceNumberIndex",eN,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:tN}).createIndex("documentKeyIndex",nN,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=Ih(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>H.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>H.forEach(a,l=>{Me(l.userId===i.userId);const d=Jo(this.serializer,l);return AI(e,i.userId,d).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new Et(o),d=function(f){return[0,dr(f)]}(l);i.push(t.get(d).next(h=>h?H.resolve():(f=>t.put({targetId:0,path:dr(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>H.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:XD});const r=t.store("collectionParents"),s=new Ug,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:dr(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new Et(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],d)=>{const h=Ts(a);return i(h.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=Du(s),o=EI(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new Pe(Et.fromString(f.document.name).popFirst(5)):f.noDocument?Pe.fromSegments(f.noDocument.path):f.unknownDocument?Pe.fromSegments(f.unknownDocument.path):ke()}(o).path.toArray(),d={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(d))}).next(()=>H.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=DI(this.serializer),i=new Bg(mf.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var d;let h=(d=a.get(l.userId))!==null&&d!==void 0?d:lt();Jo(this.serializer,l).keys().forEach(f=>h=h.add(f)),a.set(l.userId,h)}),H.forEach(a,(l,d)=>{const h=new zn(d),f=ff.lt(this.serializer,h),g=i.getIndexManager(h),v=pf.lt(h,this.serializer,g,i.referenceDelegate);return new NI(s,v,f,g).recalculateAndSaveOverlaysForDocumentKeys(new fm(t,Ar.oe),l).next()})})}}function K_(n){n.createObjectStore("targetDocuments",{keyPath:JD}).createIndex("documentTargetsIndex",YD,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",QD,{unique:!0}),n.createObjectStore("targetGlobal")}const Dp="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class qg{constructor(e,t,r,s,i,o,a,l,d,h,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=d,this.li=h,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=g=>Promise.resolve(),!qg.D())throw new ge(Q.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new aO(this,s),this.Ai=t+"main",this.serializer=new xI(l),this.Ri=new Cs(this.Ai,this.hi,new _O(this.serializer)),this.$r=new JN,this.Ur=new sO(this.referenceDelegate,this.serializer),this.remoteDocumentCache=DI(this.serializer),this.Gr=new QN,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,h===!1&&Tn("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new ge(Q.FAILED_PRECONDITION,Dp);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Ar(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>kd(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(wo(e))return me("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return me("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return xu(e).get("owner").next(t=>H.resolve(this.vi(t)))}Ci(e){return kd(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=$n(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return H.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?H.resolve(!0):xu(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new ge(Q.FAILED_PRECONDITION,Dp);return!1}}return!(!this.networkEnabled||!this.inForeground)||kd(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&me("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new fm(e,Ar.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>kd(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return pf.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new rO(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return ff.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){me("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?lN:l===16?aN:l===15?Sg:l===14?SE:l===13?AE:l===12?oN:l===11?TE:void ke()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new fm(a,this.Qr?this.Qr.next():Ar.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw Tn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new ge(Q.FAILED_PRECONDITION,bE);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return xu(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new ge(Q.FAILED_PRECONDITION,Dp)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return xu(e).put("owner",t)}static D(){return Cs.D()}bi(e){const t=xu(e);return t.get("owner").next(r=>this.vi(r)?(me("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):H.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Tn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;Rx()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return me("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Tn("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Tn("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function xu(n){return $n(n,"owner")}function kd(n){return $n(n,"clientMetadata")}function zg(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hg{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=lt(),s=lt();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Hg(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bO{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OI{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Rx()?8:xE(Ln())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new bO;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(nl()<=wt.DEBUG&&me("QueryEngine","SDK will not create cache indexes for query:",rl(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),H.resolve()):(nl()<=wt.DEBUG&&me("QueryEngine","Query:",rl(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(nl()<=wt.DEBUG&&me("QueryEngine","The SDK decides to create cache indexes for query:",rl(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,hr(t))):H.resolve())}Yi(e,t){if(y_(t))return H.resolve(null);let r=hr(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=bh(t,null,"F"),r=hr(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=lt(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const d=this.ts(t,a);return this.ns(t,d,o,l.readTime)?this.Yi(e,bh(t,null,"F")):this.rs(e,d,t,l)}))})))}Zi(e,t,r,s){return y_(t)||s.isEqual(Fe.min())?H.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?H.resolve(null):(nl()<=wt.DEBUG&&me("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),rl(t)),this.rs(e,o,t,yE(s,-1)).next(a=>a))})}ts(e,t){let r=new Kt(KE(e));return t.forEach((s,i)=>{Lc(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return nl()<=wt.DEBUG&&me("QueryEngine","Using full collection scan to execute query:",rl(t)),this.Ji.getDocumentsMatchingQuery(e,t,jr.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wO{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new tn(et),this._s=new gi(i=>fa(i),Vc),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new NI(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function VI(n,e,t,r){return new wO(n,e,t,r)}async function MI(n,e){const t=Ae(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=lt();for(const d of s){o.push(d.batchId);for(const h of d.mutations)l=l.add(h.key)}for(const d of i){a.push(d.batchId);for(const h of d.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next(d=>({hs:d,removedBatchIds:o,addedBatchIds:a}))})})}function xO(n,e){const t=Ae(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,d,h){const f=d.batch,g=f.keys();let v=H.resolve();return g.forEach(w=>{v=v.next(()=>h.getEntry(l,w)).next(b=>{const x=d.docVersions.get(w);Me(x!==null),b.version.compareTo(x)<0&&(f.applyToRemoteDocument(b,d),b.isValidDocument()&&(b.setReadTime(d.commitVersion),h.addEntry(b)))})}),v.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=lt();for(let d=0;d<a.mutationResults.length;++d)a.mutationResults[d].transformResults.length>0&&(l=l.add(a.batch.mutations[d].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function LI(n){const e=Ae(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function EO(n,e){const t=Ae(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((h,f)=>{const g=s.get(f);if(!g)return;a.push(t.Ur.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,h.addedDocuments,f)));let v=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?v=v.withResumeToken(vn.EMPTY_BYTE_STRING,Fe.min()).withLastLimboFreeSnapshotVersion(Fe.min()):h.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(h.resumeToken,r)),s=s.insert(f,v),function(b,x,M){return b.resumeToken.approximateByteSize()===0||x.snapshotVersion.toMicroseconds()-b.snapshotVersion.toMicroseconds()>=3e8?!0:M.addedDocuments.size+M.modifiedDocuments.size+M.removedDocuments.size>0}(g,v,h)&&a.push(t.Ur.updateTargetData(i,v))});let l=Pr(),d=lt();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push($I(i,o,e.documentUpdates).next(h=>{l=h.Ps,d=h.Is})),!r.isEqual(Fe.min())){const h=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return H.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,d)).next(()=>l)}).then(i=>(t.os=s,i))}function $I(n,e,t){let r=lt(),s=lt();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=Pr();return t.forEach((a,l)=>{const d=i.get(a);l.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(Fe.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):me("LocalStore","Ignoring outdated watch update for ",a,". Current version:",d.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function IO(n,e){const t=Ae(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Nl(n,e){const t=Ae(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,H.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new Js(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function Ol(n,e,t){const r=Ae(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!wo(o))throw o;me("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Ah(n,e,t){const r=Ae(n);let s=Fe.min(),i=lt();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,d,h){const f=Ae(l),g=f._s.get(h);return g!==void 0?H.resolve(f.os.get(g)):f.Ur.getTargetData(d,h)}(r,o,hr(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:Fe.min(),t?i:lt())).next(a=>(jI(r,HE(e),a),{documents:a,Ts:i})))}function FI(n,e){const t=Ae(n),r=Ae(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function UI(n,e){const t=Ae(n),r=t.us.get(e)||Fe.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,yE(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(jI(t,e,s),s))}function jI(n,e,t){let r=n.us.get(e)||Fe.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function TO(n,e,t,r){const s=Ae(n);let i=lt(),o=Pr();for(const d of t){const h=e.Es(d.metadata.name);d.document&&(i=i.add(h));const f=e.ds(d);f.setReadTime(e.As(d.metadata.readTime)),o=o.insert(h,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await Nl(s,function(h){return hr(Hl(Et.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",d=>$I(d,a,o).next(h=>(a.apply(d),h)).next(h=>s.Ur.removeMatchingKeysForTargetId(d,l.targetId).next(()=>s.Ur.addMatchingKeys(d,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(d,h.Ps,h.Is)).next(()=>h.Ps)))}async function AO(n,e,t=lt()){const r=await Nl(n,hr($g(e.bundledQuery))),s=Ae(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=Pn(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(vn.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function G_(n,e){return`firestore_clients_${n}_${e}`}function W_(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Np(n,e){return`firestore_targets_${n}_${e}`}class Sh{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new ge(s.error.code,s.error.message))),o?new Sh(e,t,s.state,i):(Tn("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Gu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new ge(r.error.code,r.error.message))),i?new Gu(e,r.state,s):(Tn("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ph{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Cg();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=EE(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Ph(e,i):(Tn("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Kg{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Kg(t.clientId,t.onlineState):(Tn("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Sm{constructor(){this.activeTargetIds=Cg()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Op{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new tn(et),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=G_(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Sm),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(G_(this.persistenceKey,r));if(s){const i=Ph.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Np(this.persistenceKey,e));if(s){const i=Gu.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Np(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return me("SharedClientState","READ",e,t),t}setItem(e,t){me("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){me("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(me("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void Tn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=Ar.oe;if(i!=null)try{const a=JSON.parse(i);Me(typeof a=="number"),o=a}catch(a){Tn("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Ar.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new Sh(this.currentUser,e,t,r),i=W_(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=W_(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=Np(this.persistenceKey,e),i=new Gu(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return Ph.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return Sh.Rs(new zn(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return Gu.Rs(s,t)}Ls(e){return Kg.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);me("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Cg();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class BI{constructor(){this.so=new Sm,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Sm,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SO{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q_{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){me("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){me("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Dd=null;function Vp(){return Dd===null?Dd=function(){return 268435456+Math.round(2147483648*Math.random())}():Dd++,"0x"+Dd.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PO={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RO{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ir="WebChannelConnection";class CO extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=Vp(),l=this.xo(t,r.toUriEncodedString());me("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,i,o),this.No(t,l,d,s).then(h=>(me("RestConnection",`Received RPC '${t}' ${a}: `,h),h),h=>{throw es("RestConnection",`RPC '${t}' ${a} failed with error: `,h,"url: ",l,"request:",s),h})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+zl}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=PO[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=Vp();return new Promise((o,a)=>{const l=new uE;l.setWithCredentials(!0),l.listenOnce(cE.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case Kd.NO_ERROR:const h=l.getResponseJson();me(ir,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(h)),o(h);break;case Kd.TIMEOUT:me(ir,`RPC '${e}' ${i} timed out`),a(new ge(Q.DEADLINE_EXCEEDED,"Request time out"));break;case Kd.HTTP_ERROR:const f=l.getStatus();if(me(ir,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let g=l.getResponseJson();Array.isArray(g)&&(g=g[0]);const v=g==null?void 0:g.error;if(v&&v.status&&v.message){const w=function(x){const M=x.toLowerCase().replace(/_/g,"-");return Object.values(Q).indexOf(M)>=0?M:Q.UNKNOWN}(v.status);a(new ge(w,v.message))}else a(new ge(Q.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new ge(Q.UNAVAILABLE,"Connection failed."));break;default:ke()}}finally{me(ir,`RPC '${e}' ${i} completed.`)}});const d=JSON.stringify(s);me(ir,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",d,r,15)})}Bo(e,t,r){const s=Vp(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=fE(),a=hE(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(l.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const h=i.join("");me(ir,`Creating RPC '${e}' stream ${s}: ${h}`,l);const f=o.createWebChannel(h,l);let g=!1,v=!1;const w=new RO({Io:x=>{v?me(ir,`Not sending because RPC '${e}' stream ${s} is closed:`,x):(g||(me(ir,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),me(ir,`RPC '${e}' stream ${s} sending:`,x),f.send(x))},To:()=>f.close()}),b=(x,M,O)=>{x.listen(M,A=>{try{O(A)}catch(j){setTimeout(()=>{throw j},0)}})};return b(f,Ru.EventType.OPEN,()=>{v||(me(ir,`RPC '${e}' stream ${s} transport opened.`),w.yo())}),b(f,Ru.EventType.CLOSE,()=>{v||(v=!0,me(ir,`RPC '${e}' stream ${s} transport closed`),w.So())}),b(f,Ru.EventType.ERROR,x=>{v||(v=!0,es(ir,`RPC '${e}' stream ${s} transport errored:`,x),w.So(new ge(Q.UNAVAILABLE,"The operation could not be completed")))}),b(f,Ru.EventType.MESSAGE,x=>{var M;if(!v){const O=x.data[0];Me(!!O);const A=O,j=A.error||((M=A[0])===null||M===void 0?void 0:M.error);if(j){me(ir,`RPC '${e}' stream ${s} received error:`,j);const de=j.status;let re=function(T){const V=kn[T];if(V!==void 0)return oI(V)}(de),k=j.message;re===void 0&&(re=Q.INTERNAL,k="Unknown error status: "+de+" with message "+j.message),v=!0,w.So(new ge(re,k)),f.close()}else me(ir,`RPC '${e}' stream ${s} received:`,O),w.bo(O)}}),b(a,dE.STAT_EVENT,x=>{x.stat===dm.PROXY?me(ir,`RPC '${e}' stream ${s} detected buffering proxy`):x.stat===dm.NOPROXY&&me(ir,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{w.wo()},0),w}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qI(){return typeof window<"u"?window:null}function Zd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jc(n){return new $N(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gg{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&me("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zI{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Gg(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===Q.RESOURCE_EXHAUSTED?(Tn(t.toString()),Tn("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===Q.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new ge(Q.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return me("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(me("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class kO extends zI{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=jN(this.serializer,e),r=function(i){if(!("targetChange"in i))return Fe.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Fe.min():o.readTime?Pn(o.readTime):Fe.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=xm(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=yh(l)?{documents:gI(i,l)}:{query:hf(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=cI(i,o.resumeToken);const d=bm(i,o.expectedCount);d!==null&&(a.expectedCount=d)}else if(o.snapshotVersion.compareTo(Fe.min())>0){a.readTime=Dl(i,o.snapshotVersion.toTimestamp());const d=bm(i,o.expectedCount);d!==null&&(a.expectedCount=d)}return a}(this.serializer,e);const r=qN(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=xm(this.serializer),t.removeTarget=e,this.a_(t)}}class DO extends zI{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Me(!!e.streamToken),this.lastStreamToken=e.streamToken,Me(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Me(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=BN(e.writeResults,e.commitTime),r=Pn(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=xm(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>_c(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NO extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new ge(Q.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,wm(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===Q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new ge(Q.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,wm(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===Q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new ge(Q.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class OO{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Tn(t),this.D_=!1):me("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VO{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{Eo(this)&&(me("RemoteStore","Restarting streams for network reachability change."),await async function(l){const d=Ae(l);d.L_.add(4),await Wl(d),d.q_.set("Unknown"),d.L_.delete(4),await Bc(d)}(this))})}),this.q_=new OO(r,s)}}async function Bc(n){if(Eo(n))for(const e of n.B_)await e(!0)}async function Wl(n){for(const e of n.B_)await e(!1)}function gf(n,e){const t=Ae(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Jg(t)?Qg(t):Jl(t).r_()&&Wg(t,e))}function Vl(n,e){const t=Ae(n),r=Jl(t);t.N_.delete(e),r.r_()&&HI(t,e),t.N_.size===0&&(r.r_()?r.o_():Eo(t)&&t.q_.set("Unknown"))}function Wg(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Fe.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Jl(n).A_(e)}function HI(n,e){n.Q_.xe(e),Jl(n).R_(e)}function Qg(n){n.Q_=new ON({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Jl(n).start(),n.q_.v_()}function Jg(n){return Eo(n)&&!Jl(n).n_()&&n.N_.size>0}function Eo(n){return Ae(n).L_.size===0}function KI(n){n.Q_=void 0}async function MO(n){n.q_.set("Online")}async function LO(n){n.N_.forEach((e,t)=>{Wg(n,e)})}async function $O(n,e){KI(n),Jg(n)?(n.q_.M_(e),Qg(n)):n.q_.set("Unknown")}async function FO(n,e,t){if(n.q_.set("Online"),e instanceof uI&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){me("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Rh(n,r)}else if(e instanceof Xd?n.Q_.Ke(e):e instanceof lI?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Fe.min()))try{const r=await LI(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,d)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.N_.get(d);h&&i.N_.set(d,h.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,d)=>{const h=i.N_.get(l);if(!h)return;i.N_.set(l,h.withResumeToken(vn.EMPTY_BYTE_STRING,h.snapshotVersion)),HI(i,l);const f=new Js(h.target,l,d,h.sequenceNumber);Wg(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){me("RemoteStore","Failed to raise snapshot:",r),await Rh(n,r)}}async function Rh(n,e,t){if(!wo(e))throw e;n.L_.add(1),await Wl(n),n.q_.set("Offline"),t||(t=()=>LI(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{me("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await Bc(n)})}function GI(n,e){return e().catch(t=>Rh(n,t,e))}async function Ql(n){const e=Ae(n),t=ho(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;UO(e);)try{const s=await IO(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,jO(e,s)}catch(s){await Rh(e,s)}WI(e)&&QI(e)}function UO(n){return Eo(n)&&n.O_.length<10}function jO(n,e){n.O_.push(e);const t=ho(n);t.r_()&&t.V_&&t.m_(e.mutations)}function WI(n){return Eo(n)&&!ho(n).n_()&&n.O_.length>0}function QI(n){ho(n).start()}async function BO(n){ho(n).p_()}async function qO(n){const e=ho(n);for(const t of n.O_)e.m_(t.mutations)}async function zO(n,e,t){const r=n.O_.shift(),s=Og.from(r,e,t);await GI(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Ql(n)}async function HO(n,e){e&&ho(n).V_&&await async function(r,s){if(function(o){return iI(o)&&o!==Q.ABORTED}(s.code)){const i=r.O_.shift();ho(r).s_(),await GI(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Ql(r)}}(n,e),WI(n)&&QI(n)}async function J_(n,e){const t=Ae(n);t.asyncQueue.verifyOperationInProgress(),me("RemoteStore","RemoteStore received new credentials");const r=Eo(t);t.L_.add(3),await Wl(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Bc(t)}async function Pm(n,e){const t=Ae(n);e?(t.L_.delete(2),await Bc(t)):e||(t.L_.add(2),await Wl(t),t.q_.set("Unknown"))}function Jl(n){return n.K_||(n.K_=function(t,r,s){const i=Ae(t);return i.w_(),new kO(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:MO.bind(null,n),Ro:LO.bind(null,n),mo:$O.bind(null,n),d_:FO.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Jg(n)?Qg(n):n.q_.set("Unknown")):(await n.K_.stop(),KI(n))})),n.K_}function ho(n){return n.U_||(n.U_=function(t,r,s){const i=Ae(t);return i.w_(),new DO(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:BO.bind(null,n),mo:HO.bind(null,n),f_:qO.bind(null,n),g_:zO.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await Ql(n)):(await n.U_.stop(),n.O_.length>0&&(me("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yg{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Kn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Yg(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ge(Q.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Yl(n,e){if(Tn("AsyncQueue",`${e}: ${n}`),wo(n))return new ge(Q.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gl{constructor(e){this.comparator=e?(t,r)=>e(t,r)||Pe.comparator(t.key,r.key):(t,r)=>Pe.comparator(t.key,r.key),this.keyedMap=Cu(),this.sortedSet=new tn(this.comparator)}static emptySet(e){return new gl(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof gl)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new gl;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y_{constructor(){this.W_=new tn(Pe.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):ke():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Ml{constructor(e,t,r,s,i,o,a,l,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Ml(e,t,gl.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Mc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KO{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class GO{constructor(){this.queries=X_(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=Ae(t),i=s.queries;s.queries=X_(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new ge(Q.ABORTED,"Firestore shutting down"))}}function X_(){return new gi(n=>zE(n),Mc)}async function Xg(n,e){const t=Ae(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new KO,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Yl(o,`Initialization of query '${rl(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&ev(t)}async function Zg(n,e){const t=Ae(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function WO(n,e){const t=Ae(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&ev(t)}function QO(n,e,t){const r=Ae(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function ev(n){n.Y_.forEach(e=>{e.next()})}var Rm,Z_;(Z_=Rm||(Rm={})).ea="default",Z_.Cache="cache";class tv{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Ml(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Ml.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Rm.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JO{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eb{constructor(e){this.serializer=e}Es(e){return ks(this.serializer,e)}ds(e){return e.metadata.exists?mI(this.serializer,e.document,!1):rn.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Pn(e)}}class YO{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=JI(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=Et.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new eb(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||lt()).add(i);t.set(o,a)}}return t}async complete(){const e=await TO(this.localStore,new eb(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await AO(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function JI(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YI{constructor(e){this.key=e}}class XI{constructor(e){this.key=e}}class ZI{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=lt(),this.mutatedKeys=lt(),this.Aa=KE(e),this.Ra=new gl(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new Y_,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const g=s.get(h),v=Lc(this.query,f)?f:null,w=!!g&&this.mutatedKeys.has(g.key),b=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let x=!1;g&&v?g.data.isEqual(v.data)?w!==b&&(r.track({type:3,doc:v}),x=!0):this.ga(g,v)||(r.track({type:2,doc:v}),x=!0,(l&&this.Aa(v,l)>0||d&&this.Aa(v,d)<0)&&(a=!0)):!g&&v?(r.track({type:0,doc:v}),x=!0):g&&!v&&(r.track({type:1,doc:g}),x=!0,(l||d)&&(a=!0)),x&&(v?(o=o.add(v),i=b?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((h,f)=>function(v,w){const b=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ke()}};return b(v)-b(w)}(h.type,f.type)||this.Aa(h.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,d=l!==this.Ea;return this.Ea=l,o.length!==0||d?{snapshot:new Ml(this.query,e.Ra,i,o,e.mutatedKeys,l===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Y_,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=lt(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new XI(r))}),this.da.forEach(r=>{e.has(r)||t.push(new YI(r))}),t}ba(e){this.Ta=e.Ts,this.da=lt();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Ml.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class XO{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class ZO{constructor(e){this.key=e,this.va=!1}}class eV{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new gi(a=>zE(a),Mc),this.Ma=new Map,this.xa=new Set,this.Oa=new tn(Pe.comparator),this.Na=new Map,this.La=new jg,this.Ba={},this.ka=new Map,this.qa=ya.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function tV(n,e,t=!0){const r=vf(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await eT(r,e,t,!0),s}async function nV(n,e){const t=vf(n);await eT(t,e,!0,!1)}async function eT(n,e,t,r){const s=await Nl(n.localStore,hr(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await nv(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&gf(n.remoteStore,s),a}async function nv(n,e,t,r,s){n.Ka=(f,g,v)=>async function(b,x,M,O){let A=x.view.ma(M);A.ns&&(A=await Ah(b.localStore,x.query,!1).then(({documents:k})=>x.view.ma(k,A)));const j=O&&O.targetChanges.get(x.targetId),de=O&&O.targetMismatches.get(x.targetId)!=null,re=x.view.applyChanges(A,b.isPrimaryClient,j,de);return Cm(b,x.targetId,re.wa),re.snapshot}(n,f,g,v);const i=await Ah(n.localStore,e,!0),o=new ZI(e,i.Ts),a=o.ma(i.documents),l=Uc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),d=o.applyChanges(a,n.isPrimaryClient,l);Cm(n,t,d.wa);const h=new XO(e,t,o);return n.Fa.set(e,h),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),d.snapshot}async function rV(n,e,t){const r=Ae(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!Mc(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Ol(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Vl(r.remoteStore,s.targetId),Ll(r,s.targetId)}).catch(bo)):(Ll(r,s.targetId),await Ol(r.localStore,s.targetId,!0))}async function sV(n,e){const t=Ae(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Vl(t.remoteStore,r.targetId))}async function iV(n,e,t){const r=ov(n);try{const s=await function(o,a){const l=Ae(o),d=hn.now(),h=a.reduce((v,w)=>v.add(w.key),lt());let f,g;return l.persistence.runTransaction("Locally write mutations","readwrite",v=>{let w=Pr(),b=lt();return l.cs.getEntries(v,h).next(x=>{w=x,w.forEach((M,O)=>{O.isValidDocument()||(b=b.add(M))})}).next(()=>l.localDocuments.getOverlayedDocuments(v,w)).next(x=>{f=x;const M=[];for(const O of a){const A=kN(O,f.get(O.key).overlayedDocument);A!=null&&M.push(new vi(O.key,A,NE(A.value.mapValue),un.exists(!0)))}return l.mutationQueue.addMutationBatch(v,d,M,a)}).next(x=>{g=x;const M=x.applyToLocalDocumentSet(f,b);return l.documentOverlayCache.saveOverlays(v,x.batchId,M)})}).then(()=>({batchId:g.batchId,changes:WE(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let d=o.Ba[o.currentUser.toKey()];d||(d=new tn(et)),d=d.insert(a,l),o.Ba[o.currentUser.toKey()]=d}(r,s.batchId,t),await yi(r,s.changes),await Ql(r.remoteStore)}catch(s){const i=Yl(s,"Failed to persist write");t.reject(i)}}async function tT(n,e){const t=Ae(n);try{const r=await EO(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(Me(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Me(o.va):s.removedDocuments.size>0&&(Me(o.va),o.va=!1))}),await yi(t,r,e)}catch(r){await bo(r)}}function tb(n,e,t){const r=Ae(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=Ae(o);l.onlineState=a;let d=!1;l.queries.forEach((h,f)=>{for(const g of f.j_)g.Z_(a)&&(d=!0)}),d&&ev(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function oV(n,e,t){const r=Ae(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new tn(Pe.comparator);o=o.insert(i,rn.newNoDocument(i,Fe.min()));const a=lt().add(i),l=new Fc(Fe.min(),new Map,new tn(et),o,a);await tT(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),iv(r)}else await Ol(r.localStore,e,!1).then(()=>Ll(r,e,t)).catch(bo)}async function aV(n,e){const t=Ae(n),r=e.batch.batchId;try{const s=await xO(t.localStore,e);sv(t,r,null),rv(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await yi(t,s)}catch(s){await bo(s)}}async function lV(n,e,t){const r=Ae(n);try{const s=await function(o,a){const l=Ae(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let h;return l.mutationQueue.lookupMutationBatch(d,a).next(f=>(Me(f!==null),h=f.keys(),l.mutationQueue.removeMutationBatch(d,f))).next(()=>l.mutationQueue.performConsistencyCheck(d)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(d,h,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,h)).next(()=>l.localDocuments.getDocuments(d,h))})}(r.localStore,e);sv(r,e,t),rv(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await yi(r,s)}catch(s){await bo(s)}}async function uV(n,e){const t=Ae(n);Eo(t.remoteStore)||me("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=Ae(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=Yl(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function rv(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function sv(n,e,t){const r=Ae(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function Ll(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||nT(n,r)})}function nT(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Vl(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),iv(n))}function Cm(n,e,t){for(const r of t)r instanceof YI?(n.La.addReference(r.key,e),cV(n,r)):r instanceof XI?(me("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||nT(n,r.key)):ke()}function cV(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(me("SyncEngine","New document in limbo: "+t),n.xa.add(r),iv(n))}function iv(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new Pe(Et.fromString(e)),r=n.qa.next();n.Na.set(r,new ZO(t)),n.Oa=n.Oa.insert(t,r),gf(n.remoteStore,new Js(hr(Hl(t.path)),r,"TargetPurposeLimboResolution",Ar.oe))}}async function yi(n,e,t){const r=Ae(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(d=>{var h;if((d||t)&&r.isPrimaryClient){const f=d?!d.fromCache:(h=t==null?void 0:t.targetChanges.get(l.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(d){s.push(d);const f=Hg.Wi(l.targetId,d);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,d){const h=Ae(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>H.forEach(d,g=>H.forEach(g.$i,v=>h.persistence.referenceDelegate.addReference(f,g.targetId,v)).next(()=>H.forEach(g.Ui,v=>h.persistence.referenceDelegate.removeReference(f,g.targetId,v)))))}catch(f){if(!wo(f))throw f;me("LocalStore","Failed to update sequence numbers: "+f)}for(const f of d){const g=f.targetId;if(!f.fromCache){const v=h.os.get(g),w=v.snapshotVersion,b=v.withLastLimboFreeSnapshotVersion(w);h.os=h.os.insert(g,b)}}}(r.localStore,i))}async function dV(n,e){const t=Ae(n);if(!t.currentUser.isEqual(e)){me("SyncEngine","User change. New user:",e.toKey());const r=await MI(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new ge(Q.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await yi(t,r.hs)}}function hV(n,e){const t=Ae(n),r=t.Na.get(e);if(r&&r.va)return lt().add(r.key);{let s=lt();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function fV(n,e){const t=Ae(n),r=await Ah(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&Cm(t,e.targetId,s.wa),s}async function pV(n,e){const t=Ae(n);return UI(t.localStore,e).then(r=>yi(t,r))}async function mV(n,e,t,r){const s=Ae(n),i=await function(a,l){const d=Ae(a),h=Ae(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.Mn(f,l).next(g=>g?d.localDocuments.getDocuments(f,g):H.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await Ql(s.remoteStore):t==="acknowledged"||t==="rejected"?(sv(s,e,r||null),rv(s,e),function(a,l){Ae(Ae(a).mutationQueue).On(l)}(s.localStore,e)):ke(),await yi(s,i)):me("SyncEngine","Cannot apply mutation batch with id: "+e)}async function gV(n,e){const t=Ae(n);if(vf(t),ov(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await nb(t,r.toArray());t.Qa=!0,await Pm(t.remoteStore,!0);for(const i of s)gf(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Ll(t,o),Ol(t.localStore,o,!0))),Vl(t.remoteStore,o)}),await s,await nb(t,r),function(o){const a=Ae(o);a.Na.forEach((l,d)=>{Vl(a.remoteStore,d)}),a.La.pr(),a.Na=new Map,a.Oa=new tn(Pe.comparator)}(t),t.Qa=!1,await Pm(t.remoteStore,!1)}}async function nb(n,e,t){const r=Ae(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await Nl(r.localStore,hr(l[0]));for(const d of l){const h=r.Fa.get(d),f=await fV(r,h);f.snapshot&&i.push(f.snapshot)}}else{const d=await FI(r.localStore,o);a=await Nl(r.localStore,d),await nv(r,rT(d),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function rT(n){return jE(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function vV(n){return function(t){return Ae(Ae(t).persistence).Qi()}(Ae(n).localStore)}async function yV(n,e,t,r){const s=Ae(n);if(s.Qa)return void me("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await UI(s.localStore,HE(i[0])),a=Fc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",vn.EMPTY_BYTE_STRING);await yi(s,o,a);break}case"rejected":await Ol(s.localStore,e,!0),Ll(s,e,r);break;default:ke()}}async function _V(n,e,t){const r=vf(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){me("SyncEngine","Adding an already active target "+s);continue}const i=await FI(r.localStore,s),o=await Nl(r.localStore,i);await nv(r,rT(i),o.targetId,!1,o.resumeToken),gf(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await Ol(r.localStore,s,!1).then(()=>{Vl(r.remoteStore,s),Ll(r,s)}).catch(bo)}}function vf(n){const e=Ae(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=tT.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=hV.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=oV.bind(null,e),e.Ca.d_=WO.bind(null,e.eventManager),e.Ca.$a=QO.bind(null,e.eventManager),e}function ov(n){const e=Ae(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=aV.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=lV.bind(null,e),e}function bV(n,e,t){const r=Ae(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(v,w){const b=Ae(v),x=Pn(w.createTime);return b.persistence.runTransaction("hasNewerBundle","readonly",M=>b.Gr.getBundleMetadata(M,w.id)).then(M=>!!M&&M.createTime.compareTo(x)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(v){return{taskState:"Success",documentsLoaded:v.totalDocuments,bytesLoaded:v.totalBytes,totalDocuments:v.totalDocuments,totalBytes:v.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(JI(l));const d=new YO(l,i.localStore,o.serializer);let h=await o.Ua();for(;h;){const g=await d.la(h);g&&a._updateProgress(g),h=await o.Ua()}const f=await d.complete();return await yi(i,f.Ia,void 0),await function(v,w){const b=Ae(v);return b.persistence.runTransaction("Save bundle","readwrite",x=>b.Gr.saveBundleMetadata(x,w))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(l){return es("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class fo{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=jc(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return VI(this.persistence,new OI,e.initialUser,this.serializer)}Ga(e){return new Bg(mf.Zr,this.serializer)}Wa(e){return new BI}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}fo.provider={build:()=>new fo};class wV extends fo{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){Me(this.persistence.referenceDelegate instanceof Th);const r=this.persistence.referenceDelegate.garbageCollector;return new RI(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?ar.withCacheSize(this.cacheSizeBytes):ar.DEFAULT;return new Bg(r=>Th.Zr(r,t),this.serializer)}}class av extends fo{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await ov(this.Ja.syncEngine),await Ql(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return VI(this.persistence,new OI,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new RI(r,e.asyncQueue,t)}Ha(e,t){const r=new qD(t,this.persistence);return new BD(e.asyncQueue,r)}Ga(e){const t=zg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?ar.withCacheSize(this.cacheSizeBytes):ar.DEFAULT;return new qg(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,qI(),Zd(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new BI}}class sT extends av{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof Op&&(this.sharedClientState.syncEngine={no:mV.bind(null,t),ro:yV.bind(null,t),io:_V.bind(null,t),Qi:vV.bind(null,t),eo:pV.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await gV(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=qI();if(!Op.D(t))throw new ge(Q.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=zg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Op(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class po{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>tb(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=dV.bind(null,this.syncEngine),await Pm(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new GO}()}createDatastore(e){const t=jc(e.databaseInfo.databaseId),r=function(i){return new CO(i)}(e.databaseInfo);return function(i,o,a,l){return new NO(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new VO(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>tb(this.syncEngine,t,0),function(){return Q_.D()?new Q_:new SO}())}createSyncEngine(e,t){return function(s,i,o,a,l,d,h){const f=new eV(s,i,o,a,l,d);return h&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=Ae(s);me("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await Wl(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}po.provider={build:()=>new po};function rb(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yf{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Tn("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xV{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new Kn,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new JO(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EV{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new ge(Q.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=Ae(s),a={documents:i.map(f=>yc(o.serializer,f))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,Et.emptyPath(),a,i.length),d=new Map;l.forEach(f=>{const g=UN(o.serializer,f);d.set(g.key.toString(),g)});const h=[];return i.forEach(f=>{const g=d.get(f.toString());Me(!!g),h.push(g)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Gl(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=Pe.fromPath(r);this.mutations.push(new Dg(s,this.precondition(s)))}),await async function(r,s){const i=Ae(r),o={writes:s.map(a=>_c(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,Et.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw ke();t=Fe.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new ge(Q.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Fe.min())?un.exists(!1):un.updateTime(t):un.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Fe.min()))throw new ge(Q.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return un.updateTime(t)}return un.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IV{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new Gg(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new EV(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!Oc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!iI(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TV{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=zn.UNAUTHENTICATED,this.clientId=gE.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{me("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(me("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Kn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Yl(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Mp(n,e){n.asyncQueue.verifyOperationInProgress(),me("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await MI(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function sb(n,e){n.asyncQueue.verifyOperationInProgress();const t=await lv(n);me("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>J_(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>J_(e.remoteStore,s)),n._onlineComponents=e}async function lv(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){me("FirestoreClient","Using user provided OfflineComponentProvider");try{await Mp(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===Q.FAILED_PRECONDITION||s.code===Q.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;es("Error using user provided cache. Falling back to memory cache: "+t),await Mp(n,new fo)}}else me("FirestoreClient","Using default OfflineComponentProvider"),await Mp(n,new fo);return n._offlineComponents}async function _f(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(me("FirestoreClient","Using user provided OnlineComponentProvider"),await sb(n,n._uninitializedComponentsProvider._online)):(me("FirestoreClient","Using default OnlineComponentProvider"),await sb(n,new po))),n._onlineComponents}function iT(n){return lv(n).then(e=>e.persistence)}function Xl(n){return lv(n).then(e=>e.localStore)}function oT(n){return _f(n).then(e=>e.remoteStore)}function uv(n){return _f(n).then(e=>e.syncEngine)}function aT(n){return _f(n).then(e=>e.datastore)}async function $l(n){const e=await _f(n),t=e.eventManager;return t.onListen=tV.bind(null,e.syncEngine),t.onUnlisten=rV.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=nV.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=sV.bind(null,e.syncEngine),t}function AV(n){return n.asyncQueue.enqueue(async()=>{const e=await iT(n),t=await oT(n);return e.setNetworkEnabled(!0),function(s){const i=Ae(s);return i.L_.delete(0),Bc(i)}(t)})}function SV(n){return n.asyncQueue.enqueue(async()=>{const e=await iT(n),t=await oT(n);return e.setNetworkEnabled(!1),async function(s){const i=Ae(s);i.L_.add(0),await Wl(i),i.q_.set("Offline")}(t)})}function PV(n,e){const t=new Kn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(d,h){const f=Ae(d);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new ge(Q.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=Yl(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await Xl(n),e,t)),t.promise}function lT(n,e,t={}){const r=new Kn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,d){const h=new yf({next:g=>{h.Za(),o.enqueueAndForget(()=>Zg(i,f));const v=g.docs.has(a);!v&&g.fromCache?d.reject(new ge(Q.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&g.fromCache&&l&&l.source==="server"?d.reject(new ge(Q.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(g)},error:g=>d.reject(g)}),f=new tv(Hl(a.path),h,{includeMetadataChanges:!0,_a:!0});return Xg(i,f)}(await $l(n),n.asyncQueue,e,t,r)),r.promise}function RV(n,e){const t=new Kn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await Ah(s,i,!0),l=new ZI(i,a.Ts),d=l.ma(a.documents),h=l.applyChanges(d,!1);o.resolve(h.snapshot)}catch(a){const l=Yl(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await Xl(n),e,t)),t.promise}function uT(n,e,t={}){const r=new Kn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,d){const h=new yf({next:g=>{h.Za(),o.enqueueAndForget(()=>Zg(i,f)),g.fromCache&&l.source==="server"?d.reject(new ge(Q.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(g)},error:g=>d.reject(g)}),f=new tv(a,h,{includeMetadataChanges:!0,_a:!0});return Xg(i,f)}(await $l(n),n.asyncQueue,e,t,r)),r.promise}function CV(n,e,t){const r=new Kn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await aT(n);r.resolve(async function(o,a,l){var d;const h=Ae(o),{request:f,ut:g,parent:v}=vI(h.serializer,BE(a),l);h.connection.Fo||delete f.parent;const w=(await h.Lo("RunAggregationQuery",h.serializer.databaseId,v,f,1)).filter(x=>!!x.result);Me(w.length===1);const b=(d=w[0].result)===null||d===void 0?void 0:d.aggregateFields;return Object.keys(b).reduce((x,M)=>(x[g[M]]=b[M],x),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function kV(n,e){const t=new yf(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){Ae(s).Y_.add(i),i.next()}(await $l(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){Ae(s).Y_.delete(i)}(await $l(n),t))}}function DV(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?aI().encode(o):o,function(h,f){return new xV(h,f)}(function(h,f){if(h instanceof Uint8Array)return rb(h,f);if(h instanceof ArrayBuffer)return rb(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,jc(e));n.asyncQueue.enqueueAndForget(async()=>{bV(await uv(n),s,r)})}function NV(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=Ae(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await Xl(n),e))}function OV(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=Ae(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(d=>function(f,g,v,w,b){f=[...f],g=[...g],f.sort(v),g.sort(v);const x=f.length,M=g.length;let O=0,A=0;for(;O<M&&A<x;){const j=v(f[A],g[O]);j<0?b(f[A++]):j>0?w(g[O++]):(O++,A++)}for(;O<M;)w(g[O++]);for(;A<x;)b(f[A++])}(d,s,$D,h=>{a.push(o.addFieldIndex(l,h))},h=>{a.push(o.deleteFieldIndex(l,h))})).next(()=>H.waitFor(a)))}(await Xl(n),e))}function VV(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){Ae(r).ss.zi=s}(await Xl(n),e))}function MV(n){return n.asyncQueue.enqueue(async()=>function(t){const r=Ae(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Xl(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cT(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ib=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cv(n,e,t){if(!t)throw new ge(Q.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function LV(n,e,t,r){if(e===!0&&r===!0)throw new ge(Q.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function ob(n){if(!Pe.isDocumentKey(n))throw new ge(Q.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ab(n){if(Pe.isDocumentKey(n))throw new ge(Q.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function bf(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ke()}function _t(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new ge(Q.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=bf(n);throw new ge(Q.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function dT(n,e){if(e<=0)throw new ge(Q.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lb{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new ge(Q.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ge(Q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}LV("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=cT((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new ge(Q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new ge(Q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new ge(Q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class qc{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new lb({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ge(Q.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ge(Q.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new lb(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new CD;switch(r.type){case"firstParty":return new OD(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new ge(Q.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=ib.get(t);r&&(me("ComponentProvider","Removing Datastore"),ib.delete(t),r.terminate())}(this),Promise.resolve()}}function $V(n,e,t,r={}){var s;const i=(n=_t(n,qc))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&es("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=zn.MOCK_USER;else{a=Px(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const d=r.mockUserToken.sub||r.mockUserToken.user_id;if(!d)throw new ge(Q.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new zn(d)}n._authCredentials=new kD(new pE(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tr{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new tr(this.firestore,e,this._query)}}class Rn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ds(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Rn(this.firestore,e,this._key)}}class Ds extends tr{constructor(e,t,r){super(e,t,Hl(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Rn(this.firestore,null,new Pe(e))}withConverter(e){return new Ds(this.firestore,e,this._path)}}function Je(n,e,...t){if(n=Ve(n),cv("collection","path",e),n instanceof qc){const r=Et.fromString(e,...t);return ab(r),new Ds(n,null,r)}{if(!(n instanceof Rn||n instanceof Ds))throw new ge(Q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Et.fromString(e,...t));return ab(r),new Ds(n.firestore,null,r)}}function kK(n,e){if(n=_t(n,qc),cv("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new ge(Q.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new tr(n,null,function(r){return new mi(Et.emptyPath(),r)}(e))}function ye(n,e,...t){if(n=Ve(n),arguments.length===1&&(e=gE.newId()),cv("doc","path",e),n instanceof qc){const r=Et.fromString(e,...t);return ob(r),new Rn(n,null,new Pe(r))}{if(!(n instanceof Rn||n instanceof Ds))throw new ge(Q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Et.fromString(e,...t));return ob(r),new Rn(n.firestore,n instanceof Ds?n.converter:null,new Pe(r))}}function DK(n,e){return n=Ve(n),e=Ve(e),(n instanceof Rn||n instanceof Ds)&&(e instanceof Rn||e instanceof Ds)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function hT(n,e){return n=Ve(n),e=Ve(e),n instanceof tr&&e instanceof tr&&n.firestore===e.firestore&&Mc(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ub{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Gg(this,"async_queue_retry"),this.Vu=()=>{const r=Zd();r&&me("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=Zd();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Zd();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new Kn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!wo(e))throw e;me("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Tn("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Yg.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&ke()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function km(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class FV{constructor(){this._progressObserver={},this._taskCompletionResolver=new Kn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NK=-1;class Yt extends qc{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new ub,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ub(e),this._firestoreClient=void 0,await e}}}function UV(n,e,t){t||(t="(default)");const r=pi(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(oo(i,e))return s;throw new ge(Q.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new ge(Q.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ge(Q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function OK(n,e){const t=typeof n=="object"?n:ql(),r=typeof n=="string"?n:e||"(default)",s=pi(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=Tx("firestore");i&&$V(s,...i)}return s}function fn(n){if(n._terminated)throw new ge(Q.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||fT(n),n._firestoreClient}function fT(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,d,h){return new cN(a,l,d,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,cT(h.experimentalLongPollingOptions),h.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new TV(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function VK(n,e){es("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return pT(n,po.provider,{build:r=>new av(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function MK(n){es("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();pT(n,po.provider,{build:t=>new sT(t,e.cacheSizeBytes)})}function pT(n,e,t){if((n=_t(n,Yt))._firestoreClient||n._terminated)throw new ge(Q.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new ge(Q.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},fT(n)}function LK(n){if(n._initialized&&!n._terminated)throw new ge(Q.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Kn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Cs.D())return Promise.resolve();const s=r+"main";await Cs.delete(s)}(zg(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function $K(n){return function(t){const r=new Kn;return t.asyncQueue.enqueueAndForget(async()=>uV(await uv(t),r)),r.promise}(fn(n=_t(n,Yt)))}function FK(n){return AV(fn(n=_t(n,Yt)))}function UK(n){return SV(fn(n=_t(n,Yt)))}function jK(n){return Gk(n.app,"firestore",n._databaseId.database),n._delete()}function BK(n,e){const t=fn(n=_t(n,Yt)),r=new FV;return DV(t,n._databaseId,e,r),r}function qK(n,e){return NV(fn(n=_t(n,Yt)),e).then(t=>t?new tr(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bc{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class jV{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _a{constructor(e){this._byteString=e}static fromBase64String(e){try{return new _a(vn.fromBase64String(e))}catch(t){throw new ge(Q.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new _a(vn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aa{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new ge(Q.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ln(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function zK(){return new Aa("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sa{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dv{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ge(Q.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ge(Q.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return et(this._lat,e._lat)||et(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wf{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BV=/^__.*__$/;class qV{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new vi(e,this.data,this.fieldMask,t,this.fieldTransforms):new Kl(e,this.data,t,this.fieldTransforms)}}class mT{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new vi(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function gT(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ke()}}class xf{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new xf(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Ch(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(gT(this.Cu)&&BV.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class zV{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||jc(e)}Qu(e,t,r,s=!1){return new xf({Cu:e,methodName:t,qu:r,path:ln.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Pa(n){const e=n._freezeSettings(),t=jc(n._databaseId);return new zV(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Ef(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);yv("Data must be an object, but it was:",o,r);const a=_T(r,o);let l,d;if(i.merge)l=new Sr(o.fieldMask),d=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const g=wc(e,f,t);if(!o.contains(g))throw new ge(Q.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);wT(h,g)||h.push(g)}l=new Sr(h),d=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,d=o.fieldTransforms;return new qV(new er(a),l,d)}class zc extends Sa{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof zc}}function vT(n,e,t){return new xf({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class hv extends Sa{_toFieldTransform(e){return new $c(e.path,new Cl)}isEqual(e){return e instanceof hv}}class fv extends Sa{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=vT(this,e,!0),r=this.Ku.map(i=>Ra(i,t)),s=new pa(r);return new $c(e.path,s)}isEqual(e){return e instanceof fv&&oo(this.Ku,e.Ku)}}class pv extends Sa{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=vT(this,e,!0),r=this.Ku.map(i=>Ra(i,t)),s=new ma(r);return new $c(e.path,s)}isEqual(e){return e instanceof pv&&oo(this.Ku,e.Ku)}}class mv extends Sa{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new kl(e.serializer,YE(e.serializer,this.$u));return new $c(e.path,t)}isEqual(e){return e instanceof mv&&this.$u===e.$u}}function gv(n,e,t,r){const s=n.Qu(1,e,t);yv("Data must be an object, but it was:",s,r);const i=[],o=er.empty();xo(r,(l,d)=>{const h=If(e,l,t);d=Ve(d);const f=s.Nu(h);if(d instanceof zc)i.push(h);else{const g=Ra(d,f);g!=null&&(i.push(h),o.set(h,g))}});const a=new Sr(i);return new mT(o,a,s.fieldTransforms)}function vv(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[wc(e,r,t)],l=[s];if(i.length%2!=0)throw new ge(Q.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)a.push(wc(e,i[g])),l.push(i[g+1]);const d=[],h=er.empty();for(let g=a.length-1;g>=0;--g)if(!wT(d,a[g])){const v=a[g];let w=l[g];w=Ve(w);const b=o.Nu(v);if(w instanceof zc)d.push(v);else{const x=Ra(w,b);x!=null&&(d.push(v),h.set(v,x))}}const f=new Sr(d);return new mT(h,f,o.fieldTransforms)}function yT(n,e,t,r=!1){return Ra(t,n.Qu(r?4:3,e))}function Ra(n,e){if(bT(n=Ve(n)))return yv("Unsupported field value:",e,n),_T(n,e);if(n instanceof Sa)return function(r,s){if(!gT(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=Ra(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Ve(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return YE(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=hn.fromDate(r);return{timestampValue:Dl(s.serializer,i)}}if(r instanceof hn){const i=new hn(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Dl(s.serializer,i)}}if(r instanceof dv)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof _a)return{bytesValue:cI(s.serializer,r._byteString)};if(r instanceof Rn){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Lg(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof wf)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return kg(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${bf(r)}`)}(n,e)}function _T(n,e){const t={};return RE(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):xo(n,(r,s)=>{const i=Ra(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function bT(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof hn||n instanceof dv||n instanceof _a||n instanceof Rn||n instanceof Sa||n instanceof wf)}function yv(n,e,t){if(!bT(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=bf(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function wc(n,e,t){if((e=Ve(e))instanceof Aa)return e._internalPath;if(typeof e=="string")return If(n,e);throw Ch("Field path arguments must be of type string or ",n,!1,void 0,t)}const HV=new RegExp("[~\\*/\\[\\]]");function If(n,e,t){if(e.search(HV)>=0)throw Ch(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Aa(...e.split("."))._internalPath}catch{throw Ch(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ch(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new ge(Q.INVALID_ARGUMENT,a+n+l)}function wT(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Rn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new KV(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Tf("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class KV extends xc{data(){return super.data()}}function Tf(n,e){return typeof e=="string"?If(n,e):e instanceof Aa?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xT(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new ge(Q.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class _v{}class Hc extends _v{}function mo(n,e,...t){let r=[];e instanceof _v&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof Zl).length,a=i.filter(l=>l instanceof Kc).length;if(o>1||o>0&&a>0)throw new ge(Q.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Kc extends Hc{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Kc(e,t,r)}_apply(e){const t=this._parse(e);return IT(e._query,t),new tr(e.firestore,e.converter,_m(e._query,t))}_parse(e){const t=Pa(e.firestore);return function(i,o,a,l,d,h,f){let g;if(d.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new ge(Q.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){db(f,h);const v=[];for(const w of f)v.push(cb(l,i,w));g={arrayValue:{values:v}}}else g=cb(l,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||db(f,h),g=yT(a,o,f,h==="in"||h==="not-in");return It.create(d,h,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Jr(n,e,t){const r=e,s=Tf("where",n);return Kc._create(s,r,t)}class Zl extends _v{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Zl(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:qt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)IT(o,l),o=_m(o,l)}(e._query,t),new tr(e.firestore,e.converter,_m(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function HK(...n){return n.forEach(e=>TT("or",e)),Zl._create("or",n)}function KK(...n){return n.forEach(e=>TT("and",e)),Zl._create("and",n)}class bv extends Hc{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new bv(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new ge(Q.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new ge(Q.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new vc(i,o)}(e._query,this._field,this._direction);return new tr(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new mi(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function GV(n,e="asc"){const t=e,r=Tf("orderBy",n);return bv._create(r,t)}class Af extends Hc{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Af(e,t,r)}_apply(e){return new tr(e.firestore,e.converter,bh(e._query,this._limit,this._limitType))}}function GK(n){return dT("limit",n),Af._create("limit",n,"F")}function WK(n){return dT("limitToLast",n),Af._create("limitToLast",n,"L")}class Sf extends Hc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Sf(e,t,r)}_apply(e){const t=ET(e,this.type,this._docOrFields,this._inclusive);return new tr(e.firestore,e.converter,function(s,i){return new mi(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function QK(...n){return Sf._create("startAt",n,!0)}function JK(...n){return Sf._create("startAfter",n,!1)}class Pf extends Hc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Pf(e,t,r)}_apply(e){const t=ET(e,this.type,this._docOrFields,this._inclusive);return new tr(e.firestore,e.converter,function(s,i){return new mi(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function YK(...n){return Pf._create("endBefore",n,!1)}function XK(...n){return Pf._create("endAt",n,!0)}function ET(n,e,t,r){if(t[0]=Ve(t[0]),t[0]instanceof xc)return function(i,o,a,l,d){if(!l)throw new ge(Q.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of ml(i))if(f.field.isKeyField())h.push(ha(o,l.key));else{const g=l.data.field(f.field);if(af(g))throw new ge(Q.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){const v=f.field.canonicalString();throw new ge(Q.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${v}' (used as the orderBy) does not exist.`)}h.push(g)}return new co(h,d)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Pa(n.firestore);return function(o,a,l,d,h,f){const g=o.explicitOrderBy;if(h.length>g.length)throw new ge(Q.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const v=[];for(let w=0;w<h.length;w++){const b=h[w];if(g[w].field.isKeyField()){if(typeof b!="string")throw new ge(Q.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof b}`);if(!Rg(o)&&b.indexOf("/")!==-1)throw new ge(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${b}' contains a slash.`);const x=o.path.child(Et.fromString(b));if(!Pe.isDocumentKey(x))throw new ge(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${x}' is not because it contains an odd number of segments.`);const M=new Pe(x);v.push(ha(a,M))}else{const x=yT(l,d,b);v.push(x)}}return new co(v,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function cb(n,e,t){if(typeof(t=Ve(t))=="string"){if(t==="")throw new ge(Q.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Rg(e)&&t.indexOf("/")!==-1)throw new ge(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Et.fromString(t));if(!Pe.isDocumentKey(r))throw new ge(Q.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ha(n,new Pe(r))}if(t instanceof Rn)return ha(n,t._key);throw new ge(Q.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${bf(t)}.`)}function db(n,e){if(!Array.isArray(n)||n.length===0)throw new ge(Q.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function IT(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new ge(Q.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ge(Q.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function TT(n,e){if(!(e instanceof Kc||e instanceof Zl))throw new ge(Q.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class AT{convertValue(e,t="none"){switch(lo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return an(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ui(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ke()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return xo(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>an(o.doubleValue));return new wf(i)}convertGeoPoint(e){return new dv(an(e.latitude),an(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=lf(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(pc(e));default:return null}}convertTimestamp(e){const t=li(e);return new hn(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Et.fromString(e);Me(wI(r));const s=new da(r.get(1),r.get(3)),i=new Pe(r.popFirst(5));return s.isEqual(t)||Tn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rf(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class WV extends AT{constructor(e){super(),this.firestore=e}convertBytes(e){return new _a(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Rn(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZK(n){return new bc("sum",wc("sum",n))}function eG(n){return new bc("avg",wc("average",n))}function QV(){return new bc("count")}function tG(n,e){var t,r;return n instanceof bc&&e instanceof bc&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function nG(n,e){return hT(n.query,e.query)&&oo(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ta{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Fl extends xc{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new eh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Tf("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class eh extends Fl{data(e={}){return super.data(e)}}class Ul{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new ta(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new eh(this._firestore,this._userDataWriter,r.key,r,new ta(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ge(Q.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new eh(s._firestore,s._userDataWriter,a.doc.key,a.doc,new ta(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new eh(s._firestore,s._userDataWriter,a.doc.key,a.doc,new ta(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,h=-1;return a.type!==0&&(d=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:JV(a.type),doc:l,oldIndex:d,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function JV(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ke()}}function rG(n,e){return n instanceof Fl&&e instanceof Fl?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Ul&&e instanceof Ul&&n._firestore===e._firestore&&hT(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mt(n){n=_t(n,Rn);const e=_t(n.firestore,Yt);return lT(fn(e),n._key).then(t=>wv(e,n,t))}class Io extends AT{constructor(e){super(),this.firestore=e}convertBytes(e){return new _a(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Rn(this.firestore,null,t)}}function sG(n){n=_t(n,Rn);const e=_t(n.firestore,Yt),t=fn(e),r=new Io(e);return PV(t,n._key).then(s=>new Fl(e,r,n._key,s,new ta(s!==null&&s.hasLocalMutations,!0),n.converter))}function iG(n){n=_t(n,Rn);const e=_t(n.firestore,Yt);return lT(fn(e),n._key,{source:"server"}).then(t=>wv(e,n,t))}function Dt(n){n=_t(n,tr);const e=_t(n.firestore,Yt),t=fn(e),r=new Io(e);return xT(n._query),uT(t,n._query).then(s=>new Ul(e,r,n,s))}function oG(n){n=_t(n,tr);const e=_t(n.firestore,Yt),t=fn(e),r=new Io(e);return RV(t,n._query).then(s=>new Ul(e,r,n,s))}function aG(n){n=_t(n,tr);const e=_t(n.firestore,Yt),t=fn(e),r=new Io(e);return uT(t,n._query,{source:"server"}).then(s=>new Ul(e,r,n,s))}function en(n,e,t){n=_t(n,Rn);const r=_t(n.firestore,Yt),s=Rf(n.converter,e,t);return Gc(r,[Ef(Pa(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,un.none())])}function To(n,e,t,...r){n=_t(n,Rn);const s=_t(n.firestore,Yt),i=Pa(s);let o;return o=typeof(e=Ve(e))=="string"||e instanceof Aa?vv(i,"updateDoc",n._key,e,t,r):gv(i,"updateDoc",n._key,e),Gc(s,[o.toMutation(n._key,un.exists(!0))])}function go(n){return Gc(_t(n.firestore,Yt),[new Gl(n._key,un.none())])}function _i(n,e){const t=_t(n.firestore,Yt),r=ye(n),s=Rf(n.converter,e);return Gc(t,[Ef(Pa(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,un.exists(!1))]).then(()=>r)}function lG(n,...e){var t,r,s;n=Ve(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||km(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(km(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,d,h;if(n instanceof Rn)d=_t(n.firestore,Yt),h=Hl(n._key.path),l={next:f=>{e[o]&&e[o](wv(d,n,f))},error:e[o+1],complete:e[o+2]};else{const f=_t(n,tr);d=_t(f.firestore,Yt),h=f._query;const g=new Io(d);l={next:v=>{e[o]&&e[o](new Ul(d,g,f,v))},error:e[o+1],complete:e[o+2]},xT(n._query)}return function(g,v,w,b){const x=new yf(b),M=new tv(v,x,w);return g.asyncQueue.enqueueAndForget(async()=>Xg(await $l(g),M)),()=>{x.Za(),g.asyncQueue.enqueueAndForget(async()=>Zg(await $l(g),M))}}(fn(d),h,a,l)}function uG(n,e){return kV(fn(n=_t(n,Yt)),km(e)?e:{next:e})}function Gc(n,e){return function(r,s){const i=new Kn;return r.asyncQueue.enqueueAndForget(async()=>iV(await uv(r),s,i)),i.promise}(fn(n),e)}function wv(n,e,t){const r=t.docs.get(e._key),s=new Io(n);return new Fl(n,s,e._key,r,new ta(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cG(n){return YV(n,{count:QV()})}function YV(n,e){const t=_t(n.firestore,Yt),r=fn(t),s=PE(e,(i,o)=>new sI(o,i.aggregateType,i._internalFieldPath));return CV(r,n._query,s).then(i=>function(a,l,d){const h=new Io(a);return new jV(l,h,d)}(t,n,i))}class XV{constructor(e){this.kind="memory",this._onlineComponentProvider=po.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=fo.provider}toJSON(){return{kind:this.kind}}}class ZV{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=sM(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class eM{constructor(){this.kind="memoryEager",this._offlineComponentProvider=fo.provider}toJSON(){return{kind:this.kind}}}class tM{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new wV(e)}}toJSON(){return{kind:this.kind}}}function dG(){return new eM}function hG(n){return new tM(n==null?void 0:n.cacheSizeBytes)}function fG(n){return new XV(n)}function pG(n){return new ZV(n)}class nM{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=po.provider,this._offlineComponentProvider={build:t=>new av(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class rM{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=po.provider,this._offlineComponentProvider={build:t=>new sT(t,e==null?void 0:e.cacheSizeBytes)}}}function sM(n){return new nM(n==null?void 0:n.forceOwnership)}function mG(){return new rM}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iM={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oM{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Pa(e)}set(e,t,r){this._verifyNotCommitted();const s=Gi(e,this._firestore),i=Rf(s.converter,t,r),o=Ef(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,un.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=Gi(e,this._firestore);let o;return o=typeof(t=Ve(t))=="string"||t instanceof Aa?vv(this._dataReader,"WriteBatch.update",i._key,t,r,s):gv(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,un.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Gi(e,this._firestore);return this._mutations=this._mutations.concat(new Gl(t._key,un.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new ge(Q.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Gi(n,e){if((n=Ve(n)).firestore!==e)throw new ge(Q.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aM extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Pa(t)}get(t){const r=Gi(t,this._firestore),s=new WV(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return ke();const o=i[0];if(o.isFoundDocument())return new xc(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new xc(this._firestore,s,r._key,null,r.converter);throw ke()})}set(t,r,s){const i=Gi(t,this._firestore),o=Rf(i.converter,r,s),a=Ef(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=Gi(t,this._firestore);let a;return a=typeof(r=Ve(r))=="string"||r instanceof Aa?vv(this._dataReader,"Transaction.update",o._key,r,s,i):gv(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=Gi(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Gi(e,this._firestore),r=new Io(this._firestore);return super.get(e).then(s=>new Fl(this._firestore,r,t._key,s._document,new ta(!1,!1),t.converter))}}function vG(n,e,t){n=_t(n,Yt);const r=Object.assign(Object.assign({},iM),t);return function(i){if(i.maxAttempts<1)throw new ge(Q.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new Kn;return i.asyncQueue.enqueueAndForget(async()=>{const d=await aT(i);new IV(i.asyncQueue,d,a,o,l).au()}),l.promise}(fn(n),s=>e(new aM(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yG(){return new zc("deleteField")}function yn(){return new hv("serverTimestamp")}function lM(...n){return new fv("arrayUnion",n)}function _G(...n){return new pv("arrayRemove",n)}function bG(n){return new mv("increment",n)}function wG(n){return new wf(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xv(n){return fn(n=_t(n,Yt)),new oM(n,e=>Gc(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xG(n,e){const t=fn(n=_t(n,Yt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return es("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(d){try{return JSON.parse(d)}catch(h){throw new ge(Q.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const d=hb(l,"collectionGroup"),h=[];if(Array.isArray(l.fields))for(const f of l.fields){const g=If("setIndexConfiguration",hb(f,"fieldPath"));f.arrayConfig==="CONTAINS"?h.push(new ia(g,2)):f.order==="ASCENDING"?h.push(new ia(g,0)):f.order==="DESCENDING"&&h.push(new ia(g,1))}a.push(new Al(Al.UNKNOWN_ID,d,h,Sl.empty()))}return a}(e);return OV(t,r)}function hb(n,e){if(typeof n[e]!="string")throw new ge(Q.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uM{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function EG(n){var e;n=_t(n,Yt);const t=fb.get(n);if(t)return t;if(((e=fn(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new uM(n);return fb.set(n,r),r}function IG(n){ST(n,!0)}function TG(n){ST(n,!1)}function AG(n){MV(fn(n._firestore)).then(e=>me("deleting all persistent cache indexes succeeded")).catch(e=>es("deleting all persistent cache indexes failed",e))}function ST(n,e){VV(fn(n._firestore),e).then(t=>me(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>es(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const fb=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SG(n){var e;const t=(e=fn(_t(n.firestore,Yt))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:hf(t,hr(n._query))._t}function PG(n,e){var t;const r=PE(e,(i,o)=>new sI(o,i.aggregateType,i._internalFieldPath)),s=(t=fn(_t(n.firestore,Yt))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:vI(s,BE(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RG{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return Ev.instance.onExistenceFilterMismatch(e)}}class Ev{constructor(){this.Uu=new Map}static get instance(){return Nd||(Nd=new Ev,function(t){if(wh)throw new Error("a TestingHooksSpi instance is already set");wh=t}(Nd)),Nd}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let Nd=null;(function(e,t=!0){(function(s){zl=s})(Ta),hs(new Zr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Yt(new DD(r.getProvider("auth-internal")),new VD(r.getProvider("app-check-internal")),function(d,h){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new ge(Q.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new da(d.options.projectId,h)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Rr(n_,"4.7.3",e),Rr(n_,"4.7.3","esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PT="firebasestorage.googleapis.com",RT="storageBucket",cM=2*60*1e3,dM=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn extends fs{constructor(e,t,r=0){super(Lp(e),`Firebase Storage: ${t} (${Lp(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,bn.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Lp(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var _n;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(_n||(_n={}));function Lp(n){return"storage/"+n}function Iv(){const n="An unknown error occurred, please check the error payload for server response.";return new bn(_n.UNKNOWN,n)}function hM(n){return new bn(_n.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function fM(n){return new bn(_n.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function pM(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new bn(_n.UNAUTHENTICATED,n)}function mM(){return new bn(_n.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function gM(n){return new bn(_n.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function vM(){return new bn(_n.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function yM(){return new bn(_n.CANCELED,"User canceled the upload/download.")}function _M(n){return new bn(_n.INVALID_URL,"Invalid URL '"+n+"'.")}function bM(n){return new bn(_n.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function wM(){return new bn(_n.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+RT+"' property when initializing the app?")}function xM(){return new bn(_n.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function EM(){return new bn(_n.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function IM(n){return new bn(_n.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Dm(n){return new bn(_n.INVALID_ARGUMENT,n)}function CT(){return new bn(_n.APP_DELETED,"The Firebase app was deleted.")}function TM(n){return new bn(_n.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Wu(n,e){return new bn(_n.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function Eu(n){throw new bn(_n.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ur{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=Ur.makeFromUrl(e,t)}catch{return new Ur(e,"")}if(r.path==="")return r;throw bM(e)}static makeFromUrl(e,t){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(j){j.path.charAt(j.path.length-1)==="/"&&(j.path_=j.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+s+o,"i"),l={bucket:1,path:3};function d(j){j.path_=decodeURIComponent(j.path)}const h="v[A-Za-z0-9_]+",f=t.replace(/[.]/g,"\\."),g="(/([^?#]*).*)?$",v=new RegExp(`^https?://${f}/${h}/b/${s}/o${g}`,"i"),w={bucket:1,path:3},b=t===PT?"(?:storage.googleapis.com|storage.cloud.google.com)":t,x="([^?#]*)",M=new RegExp(`^https?://${b}/${s}/${x}`,"i"),A=[{regex:a,indices:l,postModify:i},{regex:v,indices:w,postModify:d},{regex:M,indices:{bucket:1,path:2},postModify:d}];for(let j=0;j<A.length;j++){const de=A[j],re=de.regex.exec(e);if(re){const k=re[de.indices.bucket];let I=re[de.indices.path];I||(I=""),r=new Ur(k,I),de.postModify(r);break}}if(r==null)throw _M(e);return r}}class AM{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SM(n,e,t){let r=1,s=null,i=null,o=!1,a=0;function l(){return a===2}let d=!1;function h(...x){d||(d=!0,e.apply(null,x))}function f(x){s=setTimeout(()=>{s=null,n(v,l())},x)}function g(){i&&clearTimeout(i)}function v(x,...M){if(d){g();return}if(x){g(),h.call(null,x,...M);return}if(l()||o){g(),h.call(null,x,...M);return}r<64&&(r*=2);let A;a===1?(a=2,A=0):A=(r+Math.random())*1e3,f(A)}let w=!1;function b(x){w||(w=!0,g(),!d&&(s!==null?(x||(a=2),clearTimeout(s),f(0)):x||(a=1)))}return f(0),i=setTimeout(()=>{o=!0,b(!0)},t),b}function PM(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RM(n){return n!==void 0}function CM(n){return typeof n=="object"&&!Array.isArray(n)}function Tv(n){return typeof n=="string"||n instanceof String}function pb(n){return Av()&&n instanceof Blob}function Av(){return typeof Blob<"u"}function mb(n,e,t,r){if(r<e)throw Dm(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw Dm(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cf(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function kT(n){const e=encodeURIComponent;let t="?";for(const r in n)if(n.hasOwnProperty(r)){const s=e(r)+"="+e(n[r]);t=t+s+"&"}return t=t.slice(0,-1),t}var oa;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(oa||(oa={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kM(n,e){const t=n>=500&&n<600,s=[408,429].indexOf(n)!==-1,i=e.indexOf(n)!==-1;return t||s||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DM{constructor(e,t,r,s,i,o,a,l,d,h,f,g=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=d,this.progressCallback_=h,this.connectionFactory_=f,this.retry=g,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((v,w)=>{this.resolve_=v,this.reject_=w,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new Od(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=a=>{const l=a.loaded,d=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,d)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const a=i.getErrorCode()===oa.NO_ERROR,l=i.getStatus();if(!a||kM(l,this.additionalRetryCodes_)&&this.retry){const h=i.getErrorCode()===oa.ABORT;r(!1,new Od(!1,null,h));return}const d=this.successCodes_.indexOf(l)!==-1;r(!0,new Od(d,i))})},t=(r,s)=>{const i=this.resolve_,o=this.reject_,a=s.connection;if(s.wasSuccessCode)try{const l=this.callback_(a,a.getResponse());RM(l)?i(l):i()}catch(l){o(l)}else if(a!==null){const l=Iv();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(s.canceled){const l=this.appDelete_?CT():yM();o(l)}else{const l=vM();o(l)}};this.canceled_?t(!1,new Od(!1,null,!0)):this.backoffId_=SM(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&PM(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Od{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function NM(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function OM(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function VM(n,e){e&&(n["X-Firebase-GMPID"]=e)}function MM(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function LM(n,e,t,r,s,i,o=!0){const a=kT(n.urlParams),l=n.url+a,d=Object.assign({},n.headers);return VM(d,e),NM(d,t),OM(d,i),MM(d,r),new DM(l,n.method,d,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,s,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $M(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function FM(...n){const e=$M();if(e!==void 0){const t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}else{if(Av())return new Blob(n);throw new bn(_n.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function UM(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jM(n){if(typeof atob>"u")throw IM("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ss={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class $p{constructor(e,t){this.data=e,this.contentType=t||null}}function BM(n,e){switch(n){case Ss.RAW:return new $p(DT(e));case Ss.BASE64:case Ss.BASE64URL:return new $p(NT(n,e));case Ss.DATA_URL:return new $p(zM(e),HM(e))}throw Iv()}function DT(n){const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const i=r,o=n.charCodeAt(++t);r=65536|(i&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function qM(n){let e;try{e=decodeURIComponent(n)}catch{throw Wu(Ss.DATA_URL,"Malformed data URL.")}return DT(e)}function NT(n,e){switch(n){case Ss.BASE64:{const s=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(s||i)throw Wu(n,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case Ss.BASE64URL:{const s=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(s||i)throw Wu(n,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=jM(e)}catch(s){throw s.message.includes("polyfill")?s:Wu(n,"Invalid character found")}const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}class OT{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw Wu(Ss.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=t[1]||null;r!=null&&(this.base64=KM(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function zM(n){const e=new OT(n);return e.base64?NT(Ss.BASE64,e.rest):qM(e.rest)}function HM(n){return new OT(n).contentType}function KM(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wi{constructor(e,t){let r=0,s="";pb(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,t){if(pb(this.data_)){const r=this.data_,s=UM(r,e,t);return s===null?null:new Wi(s)}else{const r=new Uint8Array(this.data_.buffer,e,t-e);return new Wi(r,!0)}}static getBlob(...e){if(Av()){const t=e.map(r=>r instanceof Wi?r.data_:r);return new Wi(FM.apply(null,t))}else{const t=e.map(o=>Tv(o)?BM(Ss.RAW,o).data:o.data_);let r=0;t.forEach(o=>{r+=o.byteLength});const s=new Uint8Array(r);let i=0;return t.forEach(o=>{for(let a=0;a<o.length;a++)s[i++]=o[a]}),new Wi(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VT(n){let e;try{e=JSON.parse(n)}catch{return null}return CM(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GM(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function WM(n,e){const t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function MT(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QM(n,e){return e}class gr{constructor(e,t,r,s){this.server=e,this.local=t||e,this.writable=!!r,this.xform=s||QM}}let Vd=null;function JM(n){return!Tv(n)||n.length<2?n:MT(n)}function LT(){if(Vd)return Vd;const n=[];n.push(new gr("bucket")),n.push(new gr("generation")),n.push(new gr("metageneration")),n.push(new gr("name","fullPath",!0));function e(i,o){return JM(o)}const t=new gr("name");t.xform=e,n.push(t);function r(i,o){return o!==void 0?Number(o):o}const s=new gr("size");return s.xform=r,n.push(s),n.push(new gr("timeCreated")),n.push(new gr("updated")),n.push(new gr("md5Hash",null,!0)),n.push(new gr("cacheControl",null,!0)),n.push(new gr("contentDisposition",null,!0)),n.push(new gr("contentEncoding",null,!0)),n.push(new gr("contentLanguage",null,!0)),n.push(new gr("contentType",null,!0)),n.push(new gr("metadata","customMetadata",!0)),Vd=n,Vd}function YM(n,e){function t(){const r=n.bucket,s=n.fullPath,i=new Ur(r,s);return e._makeStorageReference(i)}Object.defineProperty(n,"ref",{get:t})}function XM(n,e,t){const r={};r.type="file";const s=t.length;for(let i=0;i<s;i++){const o=t[i];r[o.local]=o.xform(r,e[o.server])}return YM(r,n),r}function $T(n,e,t){const r=VT(e);return r===null?null:XM(n,r,t)}function ZM(n,e,t,r){const s=VT(e);if(s===null||!Tv(s.downloadTokens))return null;const i=s.downloadTokens;if(i.length===0)return null;const o=encodeURIComponent;return i.split(",").map(d=>{const h=n.bucket,f=n.fullPath,g="/b/"+o(h)+"/o/"+o(f),v=Cf(g,t,r),w=kT({alt:"media",token:d});return v+w})[0]}function eL(n,e){const t={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(t[i.server]=n[i.local])}return JSON.stringify(t)}class Sv{constructor(e,t,r,s){this.url=e,this.method=t,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FT(n){if(!n)throw Iv()}function tL(n,e){function t(r,s){const i=$T(n,s,e);return FT(i!==null),i}return t}function nL(n,e){function t(r,s){const i=$T(n,s,e);return FT(i!==null),ZM(i,s,n.host,n._protocol)}return t}function UT(n){function e(t,r){let s;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?s=mM():s=pM():t.getStatus()===402?s=fM(n.bucket):t.getStatus()===403?s=gM(n.path):s=r,s.status=t.getStatus(),s.serverResponse=r.serverResponse,s}return e}function jT(n){const e=UT(n);function t(r,s){let i=e(r,s);return r.getStatus()===404&&(i=hM(n.path)),i.serverResponse=s.serverResponse,i}return t}function rL(n,e,t){const r=e.fullServerUrl(),s=Cf(r,n.host,n._protocol),i="GET",o=n.maxOperationRetryTime,a=new Sv(s,i,nL(n,t),o);return a.errorHandler=jT(e),a}function sL(n,e){const t=e.fullServerUrl(),r=Cf(t,n.host,n._protocol),s="DELETE",i=n.maxOperationRetryTime;function o(l,d){}const a=new Sv(r,s,o,i);return a.successCodes=[200,204],a.errorHandler=jT(e),a}function iL(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function oL(n,e,t){const r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=iL(null,e)),r}function aL(n,e,t,r,s){const i=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let A="";for(let j=0;j<2;j++)A=A+Math.random().toString().slice(2);return A}const l=a();o["Content-Type"]="multipart/related; boundary="+l;const d=oL(e,r,s),h=eL(d,t),f="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+l+`\r
Content-Type: `+d.contentType+`\r
\r
`,g=`\r
--`+l+"--",v=Wi.getBlob(f,r,g);if(v===null)throw xM();const w={name:d.fullPath},b=Cf(i,n.host,n._protocol),x="POST",M=n.maxUploadRetryTime,O=new Sv(b,x,tL(n,t),M);return O.urlParams=w,O.headers=o,O.body=v.uploadData(),O.errorHandler=UT(e),O}class lL{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=oa.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=oa.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=oa.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,s){if(this.sent_)throw Eu("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),s!==void 0)for(const i in s)s.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,s[i].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Eu("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Eu("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Eu("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Eu("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class uL extends lL{initXhr(){this.xhr_.responseType="text"}}function Pv(){return new uL}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ba{constructor(e,t){this._service=e,t instanceof Ur?this._location=t:this._location=Ur.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new ba(e,t)}get root(){const e=new Ur(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return MT(this._location.path)}get storage(){return this._service}get parent(){const e=GM(this._location.path);if(e===null)return null;const t=new Ur(this._location.bucket,e);return new ba(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw TM(e)}}function cL(n,e,t){n._throwIfRoot("uploadBytes");const r=aL(n.storage,n._location,LT(),new Wi(e,!0),t);return n.storage.makeRequestWithTokens(r,Pv).then(s=>({metadata:s,ref:n}))}function dL(n){n._throwIfRoot("getDownloadURL");const e=rL(n.storage,n._location,LT());return n.storage.makeRequestWithTokens(e,Pv).then(t=>{if(t===null)throw EM();return t})}function hL(n){n._throwIfRoot("deleteObject");const e=sL(n.storage,n._location);return n.storage.makeRequestWithTokens(e,Pv)}function fL(n,e){const t=WM(n._location.path,e),r=new Ur(n._location.bucket,t);return new ba(n.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pL(n){return/^[A-Za-z]+:\/\//.test(n)}function mL(n,e){return new ba(n,e)}function BT(n,e){if(n instanceof Rv){const t=n;if(t._bucket==null)throw wM();const r=new ba(t,t._bucket);return e!=null?BT(r,e):r}else return e!==void 0?fL(n,e):n}function gL(n,e){if(e&&pL(e)){if(n instanceof Rv)return mL(n,e);throw Dm("To use ref(service, url), the first argument must be a Storage instance.")}else return BT(n,e)}function gb(n,e){const t=e==null?void 0:e[RT];return t==null?null:Ur.makeFromBucketSpec(t,n)}function vL(n,e,t,r={}){n.host=`${e}:${t}`,n._protocol="http";const{mockUserToken:s}=r;s&&(n._overrideAuthToken=typeof s=="string"?s:Px(s,n.app.options.projectId))}class Rv{constructor(e,t,r,s,i){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._bucket=null,this._host=PT,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=cM,this._maxUploadRetryTime=dM,this._requests=new Set,s!=null?this._bucket=Ur.makeFromBucketSpec(s,this._host):this._bucket=gb(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Ur.makeFromBucketSpec(this._url,e):this._bucket=gb(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){mb("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){mb("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ba(this,e)}_makeRequest(e,t,r,s,i=!0){if(this._deleted)return new AM(CT());{const o=LM(e,this._appId,r,s,t,this._firebaseVersion,i);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,s).getPromise()}}const vb="@firebase/storage",yb="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qT="storage";function yL(n,e,t){return n=Ve(n),cL(n,e,t)}function _L(n){return n=Ve(n),dL(n)}function bL(n){return n=Ve(n),hL(n)}function zT(n,e){return n=Ve(n),gL(n,e)}function wL(n=ql(),e){n=Ve(n);const r=pi(n,qT).getImmediate({identifier:e}),s=Tx("storage");return s&&xL(r,...s),r}function xL(n,e,t,r={}){vL(n,e,t,r)}function EL(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),s=n.getProvider("app-check-internal");return new Rv(t,r,s,e,Ta)}function IL(){hs(new Zr(qT,EL,"PUBLIC").setMultipleInstances(!0)),Rr(vb,yb,""),Rr(vb,yb,"esm2017")}IL();function Cv(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CG={PHONE:"phone",TOTP:"totp"},kG={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},DG={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},NG={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},OG={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TL(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function HT(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const VG=TL,AL=HT,KT=new Ia("auth","Firebase",HT()),MG={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kh=new pg("@firebase/auth");function SL(n,...e){kh.logLevel<=wt.WARN&&kh.warn(`Auth (${Ta}): ${n}`,...e)}function th(n,...e){kh.logLevel<=wt.ERROR&&kh.error(`Auth (${Ta}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cr(n,...e){throw Dv(n,...e)}function xr(n,...e){return Dv(n,...e)}function kv(n,e,t){const r=Object.assign(Object.assign({},AL()),{[e]:t});return new Ia("auth","Firebase",r).create(e,{appName:n.name})}function Gn(n){return kv(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function eu(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Cr(n,"argument-error"),kv(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Dv(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return KT.create(n,...e)}function Ee(n,e,...t){if(!n)throw Dv(e,...t)}function Ps(n){const e="INTERNAL ASSERTION FAILED: "+n;throw th(e),new Error(e)}function ci(n,e){n||Ps(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ec(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Nv(){return _b()==="http:"||_b()==="https:"}function _b(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PL(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Nv()||jC()||"connection"in navigator)?navigator.onLine:!0}function RL(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wc{constructor(e,t){this.shortDelay=e,this.longDelay=t,ci(t>e,"Short delay should be less than long delay!"),this.isMobile=$C()||BC()}get(){return PL()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ov(n,e){ci(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GT{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ps("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ps("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ps("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CL={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kL=new Wc(3e4,6e4);function sn(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function on(n,e,t,r,s={}){return WT(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Bl(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const d=Object.assign({method:e,headers:l},i);return UC()||(d.referrerPolicy="no-referrer"),GT.fetch()(QT(n,n.config.apiHost,t,a),d)})}async function WT(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},CL),e);try{const s=new NL(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Nu(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,d]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Nu(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Nu(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Nu(n,"user-disabled",o);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw kv(n,h,d);Cr(n,h)}}catch(s){if(s instanceof fs)throw s;Cr(n,"network-request-failed",{message:String(s)})}}async function bi(n,e,t,r,s={}){const i=await on(n,e,t,r,s);return"mfaPendingCredential"in i&&Cr(n,"multi-factor-auth-required",{_serverResponse:i}),i}function QT(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?Ov(n.config,s):`${n.config.apiScheme}://${s}`}function DL(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class NL{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(xr(this.auth,"network-request-failed")),kL.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Nu(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=xr(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bb(n){return n!==void 0&&n.getResponse!==void 0}function wb(n){return n!==void 0&&n.enterprise!==void 0}class JT{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return DL(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OL(n){return(await on(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function YT(n,e){return on(n,"GET","/v2/recaptchaConfig",sn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VL(n,e){return on(n,"POST","/v1/accounts:delete",e)}async function ML(n,e){return on(n,"POST","/v1/accounts:update",e)}async function XT(n,e){return on(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qu(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LG(n,e=!1){return Ve(n).getIdToken(e)}async function LL(n,e=!1){const t=Ve(n),r=await t.getIdToken(e),s=kf(r);Ee(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Qu(Fp(s.auth_time)),issuedAtTime:Qu(Fp(s.iat)),expirationTime:Qu(Fp(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Fp(n){return Number(n)*1e3}function kf(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return th("JWT malformed, contained fewer than 3 sections"),null;try{const s=Ex(t);return s?JSON.parse(s):(th("Failed to decode base64 JWT payload"),null)}catch(s){return th("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function xb(n){const e=kf(n);return Ee(e,"internal-error"),Ee(typeof e.exp<"u","internal-error"),Ee(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function di(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof fs&&$L(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function $L({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FL{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nm{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Qu(this.lastLoginAt),this.creationTime=Qu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ic(n){var e;const t=n.auth,r=await n.getIdToken(),s=await di(n,XT(t,{idToken:r}));Ee(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?ZT(i.providerUserInfo):[],a=jL(n.providerData,o),l=n.isAnonymous,d=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),h=l?d:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Nm(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,f)}async function UL(n){const e=Ve(n);await Ic(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function jL(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function ZT(n){return n.map(e=>{var{providerId:t}=e,r=Cv(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BL(n,e){const t=await WT(n,{},async()=>{const r=Bl({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=QT(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",GT.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function qL(n,e){return on(n,"POST","/v2/accounts:revokeToken",sn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ee(e.idToken,"internal-error"),Ee(typeof e.idToken<"u","internal-error"),Ee(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):xb(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ee(e.length!==0,"internal-error");const t=xb(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Ee(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await BL(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new vl;return r&&(Ee(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(Ee(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(Ee(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new vl,this.toJSON())}_performRefresh(){return Ps("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fi(n,e){Ee(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Ys{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=Cv(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new FL(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Nm(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await di(this,this.stsTokenManager.getToken(this.auth,e));return Ee(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return LL(this,e)}reload(){return UL(this)}_assign(e){this!==e&&(Ee(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Ys(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Ee(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Ic(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(An(this.auth.app))return Promise.reject(Gn(this.auth));const e=await this.getIdToken();return await di(this,VL(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,d,h;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,g=(s=t.email)!==null&&s!==void 0?s:void 0,v=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,w=(o=t.photoURL)!==null&&o!==void 0?o:void 0,b=(a=t.tenantId)!==null&&a!==void 0?a:void 0,x=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,M=(d=t.createdAt)!==null&&d!==void 0?d:void 0,O=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:A,emailVerified:j,isAnonymous:de,providerData:re,stsTokenManager:k}=t;Ee(A&&k,e,"internal-error");const I=vl.fromJSON(this.name,k);Ee(typeof A=="string",e,"internal-error"),Fi(f,e.name),Fi(g,e.name),Ee(typeof j=="boolean",e,"internal-error"),Ee(typeof de=="boolean",e,"internal-error"),Fi(v,e.name),Fi(w,e.name),Fi(b,e.name),Fi(x,e.name),Fi(M,e.name),Fi(O,e.name);const T=new Ys({uid:A,auth:e,email:g,emailVerified:j,displayName:f,isAnonymous:de,photoURL:w,phoneNumber:v,tenantId:b,stsTokenManager:I,createdAt:M,lastLoginAt:O});return re&&Array.isArray(re)&&(T.providerData=re.map(V=>Object.assign({},V))),x&&(T._redirectEventId=x),T}static async _fromIdTokenResponse(e,t,r=!1){const s=new vl;s.updateFromServerResponse(t);const i=new Ys({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Ic(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];Ee(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?ZT(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new vl;a.updateFromIdToken(r);const l=new Ys({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Nm(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,d),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eb=new Map;function Xs(n){ci(n instanceof Function,"Expected a class definition");let e=Eb.get(n);return e?(ci(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Eb.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eA{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}eA.type="NONE";const Ib=eA;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nh(n,e,t){return`firebase:${n}:${e}:${t}`}class yl{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=nh(this.userKey,s.apiKey,i),this.fullPersistenceKey=nh("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Ys._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new yl(Xs(Ib),e,r);const s=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||Xs(Ib);const o=nh(r,e.config.apiKey,e.name);let a=null;for(const d of t)try{const h=await d._get(o);if(h){const f=Ys._fromJSON(e,h);d!==i&&(a=f),i=d;break}}catch{}const l=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new yl(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async d=>{if(d!==i)try{await d._remove(o)}catch{}})),new yl(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tb(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(sA(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(tA(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(oA(e))return"Blackberry";if(aA(e))return"Webos";if(nA(e))return"Safari";if((e.includes("chrome/")||rA(e))&&!e.includes("edge/"))return"Chrome";if(iA(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function tA(n=Ln()){return/firefox\//i.test(n)}function nA(n=Ln()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function rA(n=Ln()){return/crios\//i.test(n)}function sA(n=Ln()){return/iemobile/i.test(n)}function iA(n=Ln()){return/android/i.test(n)}function oA(n=Ln()){return/blackberry/i.test(n)}function aA(n=Ln()){return/webos/i.test(n)}function Vv(n=Ln()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function zL(n=Ln()){var e;return Vv(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function HL(){return qC()&&document.documentMode===10}function lA(n=Ln()){return Vv(n)||iA(n)||aA(n)||oA(n)||/windows phone/i.test(n)||sA(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uA(n,e=[]){let t;switch(n){case"Browser":t=Tb(Ln());break;case"Worker":t=`${Tb(Ln())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Ta}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KL{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GL(n,e={}){return on(n,"GET","/v2/passwordPolicy",sn(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WL=6;class QL{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:WL,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JL{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ab(this),this.idTokenSubscription=new Ab(this),this.beforeStateQueue=new KL(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=KT,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Xs(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await yl.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await XT(this,{idToken:e}),r=await Ys._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(An(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return Ee(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ic(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=RL()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(An(this.app))return Promise.reject(Gn(this));const t=e?Ve(e):null;return t&&Ee(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ee(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return An(this.app)?Promise.reject(Gn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return An(this.app)?Promise.reject(Gn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Xs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await GL(this),t=new QL(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Ia("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await qL(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Xs(e)||this._popupRedirectResolver;Ee(t,this,"argument-error"),this.redirectPersistenceManager=await yl.create(this,[Xs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ee(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ee(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=uA(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&SL(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function wn(n){return Ve(n)}class Ab{constructor(e){this.auth=e,this.observer=null,this.addObserver=QC(t=>this.observer=t)}get next(){return Ee(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function YL(n){Qc=n}function Mv(n){return Qc.loadJS(n)}function XL(){return Qc.recaptchaV2Script}function ZL(){return Qc.recaptchaEnterpriseScript}function e4(){return Qc.gapiScript}function cA(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const t4="recaptcha-enterprise",n4="NO_RECAPTCHA";class dA{constructor(e){this.type=t4,this.auth=wn(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{YT(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const d=new JT(l);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,o(d.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;wb(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(d=>{o(d)}).catch(()=>{o(n4)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&wb(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=ZL();l.length!==0&&(l+=a),Mv(l).then(()=>{s(a,i,o)}).catch(d=>{o(d)})}}).catch(a=>{o(a)})})}}async function Sb(n,e,t,r=!1){const s=new dA(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Tc(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Sb(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await Sb(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function r4(n){const e=wn(n),t=await YT(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new JT(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new dA(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s4(n,e){const t=pi(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(oo(i,e??{}))return s;Cr(s,"already-initialized")}return t.initialize({options:e})}function i4(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Xs);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function o4(n,e,t){const r=wn(n);Ee(r._canInitEmulator,r,"emulator-config-failed"),Ee(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=hA(e),{host:o,port:a}=a4(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||l4()}function hA(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function a4(n){const e=hA(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Pb(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:Pb(o)}}}function Pb(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function l4(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ps("not implemented")}_getIdTokenResponse(e){return Ps("not implemented")}_linkToIdToken(e,t){return Ps("not implemented")}_getReauthenticationResolver(e){return Ps("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fA(n,e){return on(n,"POST","/v1/accounts:resetPassword",sn(n,e))}async function u4(n,e){return on(n,"POST","/v1/accounts:update",e)}async function c4(n,e){return on(n,"POST","/v1/accounts:signUp",e)}async function d4(n,e){return on(n,"POST","/v1/accounts:update",sn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function h4(n,e){return bi(n,"POST","/v1/accounts:signInWithPassword",sn(n,e))}async function Df(n,e){return on(n,"POST","/v1/accounts:sendOobCode",sn(n,e))}async function f4(n,e){return Df(n,e)}async function p4(n,e){return Df(n,e)}async function m4(n,e){return Df(n,e)}async function g4(n,e){return Df(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function v4(n,e){return bi(n,"POST","/v1/accounts:signInWithEmailLink",sn(n,e))}async function y4(n,e){return bi(n,"POST","/v1/accounts:signInWithEmailLink",sn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ac extends Jc{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Ac(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Ac(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Tc(e,t,"signInWithPassword",h4);case"emailLink":return v4(e,{email:this._email,oobCode:this._password});default:Cr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Tc(e,r,"signUpPassword",c4);case"emailLink":return y4(e,{idToken:t,email:this._email,oobCode:this._password});default:Cr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function si(n,e){return bi(n,"POST","/v1/accounts:signInWithIdp",sn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _4="http://localhost";class hi extends Jc{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new hi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Cr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=Cv(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new hi(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return si(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,si(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,si(e,t)}buildRequest(){const e={requestUri:_4,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Bl(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function b4(n,e){return on(n,"POST","/v1/accounts:sendVerificationCode",sn(n,e))}async function w4(n,e){return bi(n,"POST","/v1/accounts:signInWithPhoneNumber",sn(n,e))}async function x4(n,e){const t=await bi(n,"POST","/v1/accounts:signInWithPhoneNumber",sn(n,e));if(t.temporaryProof)throw Nu(n,"account-exists-with-different-credential",t);return t}const E4={USER_NOT_FOUND:"user-not-found"};async function I4(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return bi(n,"POST","/v1/accounts:signInWithPhoneNumber",sn(n,t),E4)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa extends Jc{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new aa({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new aa({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return w4(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return x4(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return I4(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new aa({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T4(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function A4(n){const e=Su(Pu(n)).link,t=e?Su(Pu(e)).deep_link_id:null,r=Su(Pu(n)).deep_link_id;return(r?Su(Pu(r)).link:null)||r||t||e||n}class Yc{constructor(e){var t,r,s,i,o,a;const l=Su(Pu(e)),d=(t=l.apiKey)!==null&&t!==void 0?t:null,h=(r=l.oobCode)!==null&&r!==void 0?r:null,f=T4((s=l.mode)!==null&&s!==void 0?s:null);Ee(d&&h&&f,"argument-error"),this.apiKey=d,this.operation=f,this.code=h,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=A4(e);try{return new Yc(t)}catch{return null}}}function $G(n){return Yc.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ca{constructor(){this.providerId=Ca.PROVIDER_ID}static credential(e,t){return Ac._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Yc.parseLink(t);return Ee(r,"argument-error"),Ac._fromEmailAndCode(e,r.code,r.tenantId)}}Ca.PROVIDER_ID="password";Ca.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Ca.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wi{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tu extends wi{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class rh extends tu{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return Ee("providerId"in t&&"signInMethod"in t,"argument-error"),hi._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return Ee(e.idToken||e.accessToken,"argument-error"),hi._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return rh.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return rh.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new rh(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qi extends tu{constructor(){super("facebook.com")}static credential(e){return hi._fromParams({providerId:Qi.PROVIDER_ID,signInMethod:Qi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Qi.credentialFromTaggedObject(e)}static credentialFromError(e){return Qi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Qi.credential(e.oauthAccessToken)}catch{return null}}}Qi.FACEBOOK_SIGN_IN_METHOD="facebook.com";Qi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji extends tu{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return hi._fromParams({providerId:Ji.PROVIDER_ID,signInMethod:Ji.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ji.credentialFromTaggedObject(e)}static credentialFromError(e){return Ji.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Ji.credential(t,r)}catch{return null}}}Ji.GOOGLE_SIGN_IN_METHOD="google.com";Ji.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yi extends tu{constructor(){super("github.com")}static credential(e){return hi._fromParams({providerId:Yi.PROVIDER_ID,signInMethod:Yi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Yi.credentialFromTaggedObject(e)}static credentialFromError(e){return Yi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Yi.credential(e.oauthAccessToken)}catch{return null}}}Yi.GITHUB_SIGN_IN_METHOD="github.com";Yi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S4="http://localhost";class Sc extends Jc{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return si(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,si(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,si(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new Sc(r,i)}static _create(e,t){return new Sc(e,t)}buildRequest(){return{requestUri:S4,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P4="saml.";class Om extends wi{constructor(e){Ee(e.startsWith(P4),"argument-error"),super(e)}static credentialFromResult(e){return Om.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Om.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Sc.fromJSON(e);return Ee(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Sc._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xi extends tu{constructor(){super("twitter.com")}static credential(e,t){return hi._fromParams({providerId:Xi.PROVIDER_ID,signInMethod:Xi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Xi.credentialFromTaggedObject(e)}static credentialFromError(e){return Xi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Xi.credential(t,r)}catch{return null}}}Xi.TWITTER_SIGN_IN_METHOD="twitter.com";Xi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pA(n,e){return bi(n,"POST","/v1/accounts:signUp",sn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ts{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Ys._fromIdTokenResponse(e,r,s),o=Rb(r);return new ts({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=Rb(r);return new ts({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function Rb(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mA(n){var e;if(An(n.app))return Promise.reject(Gn(n));const t=wn(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new ts({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await pA(t,{returnSecureToken:!0}),s=await ts._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dh extends fs{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Dh.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Dh(e,t,r,s)}}function gA(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Dh._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vA(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FG(n,e){const t=Ve(n);await Nf(!0,t,e);const{providerUserInfo:r}=await ML(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=vA(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Lv(n,e,t=!1){const r=await di(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return ts._forOperation(n,"link",r)}async function Nf(n,e,t){await Ic(e);const r=vA(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";Ee(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yA(n,e,t=!1){const{auth:r}=n;if(An(r.app))return Promise.reject(Gn(r));const s="reauthenticate";try{const i=await di(n,gA(r,s,e,n),t);Ee(i.idToken,r,"internal-error");const o=kf(i.idToken);Ee(o,r,"internal-error");const{sub:a}=o;return Ee(n.uid===a,r,"user-mismatch"),ts._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Cr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _A(n,e,t=!1){if(An(n.app))return Promise.reject(Gn(n));const r="signIn",s=await gA(n,r,e),i=await ts._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function $v(n,e){return _A(wn(n),e)}async function R4(n,e){const t=Ve(n);return await Nf(!1,t,e.providerId),Lv(t,e)}async function C4(n,e){return yA(Ve(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function k4(n,e){return bi(n,"POST","/v1/accounts:signInWithCustomToken",sn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UG(n,e){if(An(n.app))return Promise.reject(Gn(n));const t=wn(n),r=await k4(t,{token:e,returnSecureToken:!0}),s=await ts._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xc{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Fv._fromServerResponse(e,t):"totpInfo"in t?Uv._fromServerResponse(e,t):Cr(e,"internal-error")}}class Fv extends Xc{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Fv(t)}}class Uv extends Xc{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Uv(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Of(n,e,t){var r;Ee(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),Ee(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(Ee(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(Ee(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jv(n){const e=wn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function D4(n,e,t){const r=wn(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Of(r,s,t),await Tc(r,s,"getOobCode",p4)}async function N4(n,e,t){await fA(Ve(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&jv(n),r})}async function jG(n,e){await d4(Ve(n),{oobCode:e})}async function O4(n,e){const t=Ve(n),r=await fA(t,{oobCode:e}),s=r.requestType;switch(Ee(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":Ee(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":Ee(r.mfaInfo,t,"internal-error");default:Ee(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Xc._fromServerResponse(wn(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function V4(n,e){const{data:t}=await O4(Ve(n),e);return t.email}async function M4(n,e,t){if(An(n.app))return Promise.reject(Gn(n));const r=wn(n),o=await Tc(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",pA).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&jv(n),l}),a=await ts._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function bA(n,e,t){return An(n.app)?Promise.reject(Gn(n)):$v(Ve(n),Ca.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&jv(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BG(n,e,t){const r=wn(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){Ee(a.handleCodeInApp,r,"argument-error"),a&&Of(r,o,a)}i(s,t),await Tc(r,s,"getOobCode",m4)}function qG(n,e){const t=Yc.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function zG(n,e,t){if(An(n.app))return Promise.reject(Gn(n));const r=Ve(n),s=Ca.credentialWithLink(e,t||Ec());return Ee(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),$v(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function L4(n,e){return on(n,"POST","/v1/accounts:createAuthUri",sn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HG(n,e){const t=Nv()?Ec():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await L4(Ve(n),r);return s||[]}async function KG(n,e){const t=Ve(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Of(t.auth,s,e);const{email:i}=await f4(t.auth,s);i!==n.email&&await n.reload()}async function GG(n,e,t){const r=Ve(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Of(r.auth,i,t);const{email:o}=await g4(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $4(n,e){return on(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WG(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=Ve(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await di(r,$4(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function F4(n,e){const t=Ve(n);return An(t.auth.app)?Promise.reject(Gn(t.auth)):wA(t,e,null)}function U4(n,e){return wA(Ve(n),null,e)}async function wA(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await di(n,u4(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j4(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=kf(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new _l(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new B4(i,s);case"github.com":return new q4(i,s);case"google.com":return new z4(i,s);case"twitter.com":return new H4(i,s,n.screenName||null);case"custom":case"anonymous":return new _l(i,null);default:return new _l(i,r,s)}}class _l{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class xA extends _l{constructor(e,t,r,s){super(e,t,r),this.username=s}}class B4 extends _l{constructor(e,t){super(e,"facebook.com",t)}}class q4 extends xA{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class z4 extends _l{constructor(e,t){super(e,"google.com",t)}}class H4 extends xA{constructor(e,t,r){super(e,"twitter.com",t,r)}}function QG(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:j4(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K4(n,e){return Ve(n).setPersistence(e)}function JG(n){return r4(n)}async function YG(n,e){return wn(n).validatePassword(e)}function G4(n,e,t,r){return Ve(n).onIdTokenChanged(e,t,r)}function W4(n,e,t){return Ve(n).beforeAuthStateChanged(e,t)}function Q4(n,e,t,r){return Ve(n).onAuthStateChanged(e,t,r)}function XG(n){Ve(n).useDeviceLanguage()}function ZG(n,e){return Ve(n).updateCurrentUser(e)}function J4(n){return Ve(n).signOut()}function eW(n,e){return wn(n).revokeAccessToken(e)}async function tW(n){return Ve(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class na{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new na("enroll",e,t)}static _fromMfaPendingCredential(e){return new na("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return na._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return na._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bv{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=wn(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Xc._fromServerResponse(r,a));Ee(s.mfaPendingCredential,r,"internal-error");const o=na._fromMfaPendingCredential(s.mfaPendingCredential);return new Bv(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const d=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const h=await ts._fromIdTokenResponse(r,t.operationType,d);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return Ee(t.user,r,"internal-error"),ts._forOperation(t.user,t.operationType,d);default:Cr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function nW(n,e){var t;const r=Ve(n),s=e;return Ee(e.customData.operationType,r,"argument-error"),Ee((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),Bv._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y4(n,e){return on(n,"POST","/v2/accounts/mfaEnrollment:start",sn(n,e))}function X4(n,e){return on(n,"POST","/v2/accounts/mfaEnrollment:finalize",sn(n,e))}function Z4(n,e){return on(n,"POST","/v2/accounts/mfaEnrollment:start",sn(n,e))}function e3(n,e){return on(n,"POST","/v2/accounts/mfaEnrollment:finalize",sn(n,e))}function t3(n,e){return on(n,"POST","/v2/accounts/mfaEnrollment:withdraw",sn(n,e))}class qv{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Xc._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new qv(e)}async getSession(){return na._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await di(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await di(this.user,t3(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const Up=new WeakMap;function rW(n){const e=Ve(n);return Up.has(e)||Up.set(e,qv._fromUser(e)),Up.get(e)}const Nh="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EA{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Nh,"1"),this.storage.removeItem(Nh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n3=1e3,r3=10;class IA extends EA{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=lA(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);HL()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,r3):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},n3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}IA.type="LOCAL";const TA=IA;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AA extends EA{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}AA.type="SESSION";const SA=AA;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s3(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Vf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async d=>d(t.origin,i)),l=await s3(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Vf.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mf(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i3{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const d=Mf("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const g=f;if(g.data.eventId===d)switch(g.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(g.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dn(){return window}function o3(n){Dn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zv(){return typeof Dn().WorkerGlobalScope<"u"&&typeof Dn().importScripts=="function"}async function a3(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function l3(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function u3(){return zv()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PA="firebaseLocalStorageDb",c3=1,Oh="firebaseLocalStorage",RA="fbase_key";class Zc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Lf(n,e){return n.transaction([Oh],e?"readwrite":"readonly").objectStore(Oh)}function d3(){const n=indexedDB.deleteDatabase(PA);return new Zc(n).toPromise()}function Vm(){const n=indexedDB.open(PA,c3);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Oh,{keyPath:RA})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Oh)?e(r):(r.close(),await d3(),e(await Vm()))})})}async function Cb(n,e,t){const r=Lf(n,!0).put({[RA]:e,value:t});return new Zc(r).toPromise()}async function h3(n,e){const t=Lf(n,!1).get(e),r=await new Zc(t).toPromise();return r===void 0?null:r.value}function kb(n,e){const t=Lf(n,!0).delete(e);return new Zc(t).toPromise()}const f3=800,p3=3;class CA{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Vm(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>p3)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return zv()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Vf._getInstance(u3()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await a3(),!this.activeServiceWorker)return;this.sender=new i3(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||l3()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Vm();return await Cb(e,Nh,"1"),await kb(e,Nh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Cb(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>h3(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>kb(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Lf(s,!1).getAll();return new Zc(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),f3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}CA.type="LOCAL";const m3=CA;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g3(n,e){return on(n,"POST","/v2/accounts/mfaSignIn:start",sn(n,e))}function v3(n,e){return on(n,"POST","/v2/accounts/mfaSignIn:finalize",sn(n,e))}function y3(n,e){return on(n,"POST","/v2/accounts/mfaSignIn:finalize",sn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _3=500,b3=6e4,Md=1e12;class w3{constructor(e){this.auth=e,this.counter=Md,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new x3(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Md;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Md;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Md;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class x3{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;Ee(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=E3(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},b3)},_3))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function E3(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jp=cA("rcb"),I3=new Wc(3e4,6e4);class T3{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=Dn().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return Ee(A3(t),e,"argument-error"),this.shouldResolveImmediately(t)&&bb(Dn().grecaptcha)?Promise.resolve(Dn().grecaptcha):new Promise((r,s)=>{const i=Dn().setTimeout(()=>{s(xr(e,"network-request-failed"))},I3.get());Dn()[jp]=()=>{Dn().clearTimeout(i),delete Dn()[jp];const a=Dn().grecaptcha;if(!a||!bb(a)){s(xr(e,"internal-error"));return}const l=a.render;a.render=(d,h)=>{const f=l(d,h);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${XL()}?${Bl({onload:jp,render:"explicit",hl:t})}`;Mv(o).catch(()=>{clearTimeout(i),s(xr(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=Dn().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function A3(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class S3{async load(e){return new w3(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kA="recaptcha",P3={theme:"light",type:"image"};class sW{constructor(e,t,r=Object.assign({},P3)){this.parameters=r,this.type=kA,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=wn(e),this.isInvisible=this.parameters.size==="invisible",Ee(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;Ee(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new S3:new T3,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){Ee(!this.parameters.sitekey,this.auth,"argument-error"),Ee(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Ee(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=Dn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){Ee(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Ee(Nv()&&!zv(),this.auth,"internal-error"),await R3(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await OL(this.auth);Ee(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Ee(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function R3(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hv{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=aa._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function iW(n,e,t){if(An(n.app))return Promise.reject(Gn(n));const r=wn(n),s=await $f(r,e,Ve(t));return new Hv(s,i=>$v(r,i))}async function oW(n,e,t){const r=Ve(n);await Nf(!1,r,"phone");const s=await $f(r.auth,e,Ve(t));return new Hv(s,i=>R4(r,i))}async function aW(n,e,t){const r=Ve(n);if(An(r.auth.app))return Promise.reject(Gn(r.auth));const s=await $f(r.auth,e,Ve(t));return new Hv(s,i=>C4(r,i))}async function $f(n,e,t){var r;const s=await t.verify();try{Ee(typeof s=="string",n,"argument-error"),Ee(t.type===kA,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return Ee(o.type==="enroll",n,"internal-error"),(await Y4(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{Ee(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return Ee(a,n,"missing-multi-factor-info"),(await g3(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await b4(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function lW(n,e){const t=Ve(n);if(An(t.auth.app))return Promise.reject(Gn(t.auth));await Lv(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bl{constructor(e){this.providerId=bl.PROVIDER_ID,this.auth=wn(e)}verifyPhoneNumber(e,t){return $f(this.auth,e,Ve(t))}static credential(e,t){return aa._fromVerification(e,t)}static credentialFromResult(e){const t=e;return bl.credentialFromTaggedObject(t)}static credentialFromError(e){return bl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?aa._fromTokenResponse(t,r):null}}bl.PROVIDER_ID="phone";bl.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ka(n,e){return e?Xs(e):(Ee(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kv extends Jc{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return si(e,this._buildIdpRequest())}_linkToIdToken(e,t){return si(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return si(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function C3(n){return _A(n.auth,new Kv(n),n.bypassAuthState)}function k3(n){const{auth:e,user:t}=n;return Ee(t,e,"internal-error"),yA(t,new Kv(n),n.bypassAuthState)}async function D3(n){const{auth:e,user:t}=n;return Ee(t,e,"internal-error"),Lv(t,new Kv(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DA{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return C3;case"linkViaPopup":case"linkViaRedirect":return D3;case"reauthViaPopup":case"reauthViaRedirect":return k3;default:Cr(this.auth,"internal-error")}}resolve(e){ci(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ci(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N3=new Wc(2e3,1e4);async function uW(n,e,t){if(An(n.app))return Promise.reject(xr(n,"operation-not-supported-in-this-environment"));const r=wn(n);eu(n,e,wi);const s=ka(r,t);return new Zs(r,"signInViaPopup",e,s).executeNotNull()}async function cW(n,e,t){const r=Ve(n);if(An(r.auth.app))return Promise.reject(xr(r.auth,"operation-not-supported-in-this-environment"));eu(r.auth,e,wi);const s=ka(r.auth,t);return new Zs(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function dW(n,e,t){const r=Ve(n);eu(r.auth,e,wi);const s=ka(r.auth,t);return new Zs(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class Zs extends DA{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Zs.currentPopupAction&&Zs.currentPopupAction.cancel(),Zs.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ee(e,this.auth,"internal-error"),e}async onExecution(){ci(this.filter.length===1,"Popup operations only handle one event");const e=Mf();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(xr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(xr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Zs.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(xr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,N3.get())};e()}}Zs.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O3="pendingRedirect",sh=new Map;class V3 extends DA{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=sh.get(this.auth._key());if(!e){try{const r=await M3(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}sh.set(this.auth._key(),e)}return this.bypassAuthState||sh.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function M3(n,e){const t=OA(e),r=NA(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function Gv(n,e){return NA(n)._set(OA(e),"true")}function L3(n,e){sh.set(n._key(),e)}function NA(n){return Xs(n._redirectPersistence)}function OA(n){return nh(O3,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hW(n,e,t){return $3(n,e,t)}async function $3(n,e,t){if(An(n.app))return Promise.reject(Gn(n));const r=wn(n);eu(n,e,wi),await r._initializationPromise;const s=ka(r,t);return await Gv(s,r),s._openRedirect(r,e,"signInViaRedirect")}function fW(n,e,t){return F3(n,e,t)}async function F3(n,e,t){const r=Ve(n);if(eu(r.auth,e,wi),An(r.auth.app))return Promise.reject(Gn(r.auth));await r.auth._initializationPromise;const s=ka(r.auth,t);await Gv(s,r.auth);const i=await MA(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function pW(n,e,t){return U3(n,e,t)}async function U3(n,e,t){const r=Ve(n);eu(r.auth,e,wi),await r.auth._initializationPromise;const s=ka(r.auth,t);await Nf(!1,r,e.providerId),await Gv(s,r.auth);const i=await MA(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function mW(n,e){return await wn(n)._initializationPromise,VA(n,e,!1)}async function VA(n,e,t=!1){if(An(n.app))return Promise.reject(Gn(n));const r=wn(n),s=ka(r,e),o=await new V3(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function MA(n){const e=Mf(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j3=10*60*1e3;class B3{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!q3(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!LA(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(xr(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=j3&&this.cachedEventUids.clear(),this.cachedEventUids.has(Db(e))}saveEventToCache(e){this.cachedEventUids.add(Db(e)),this.lastProcessedEventTime=Date.now()}}function Db(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function LA({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function q3(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return LA(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function z3(n,e={}){return on(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H3=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,K3=/^https?/;async function G3(n){if(n.config.emulator)return;const{authorizedDomains:e}=await z3(n);for(const t of e)try{if(W3(t))return}catch{}Cr(n,"unauthorized-domain")}function W3(n){const e=Ec(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!K3.test(t))return!1;if(H3.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q3=new Wc(3e4,6e4);function Nb(){const n=Dn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function J3(n){return new Promise((e,t)=>{var r,s,i;function o(){Nb(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Nb(),t(xr(n,"network-request-failed"))},timeout:Q3.get()})}if(!((s=(r=Dn().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=Dn().gapi)===null||i===void 0)&&i.load)o();else{const a=cA("iframefcb");return Dn()[a]=()=>{gapi.load?o():t(xr(n,"network-request-failed"))},Mv(`${e4()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw ih=null,e})}let ih=null;function Y3(n){return ih=ih||J3(n),ih}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X3=new Wc(5e3,15e3),Z3="__/auth/iframe",e$="emulator/auth/iframe",t$={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},n$=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function r$(n){const e=n.config;Ee(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Ov(e,e$):`https://${n.config.authDomain}/${Z3}`,r={apiKey:e.apiKey,appName:n.name,v:Ta},s=n$.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Bl(r).slice(1)}`}async function s$(n){const e=await Y3(n),t=Dn().gapi;return Ee(t,n,"internal-error"),e.open({where:document.body,url:r$(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:t$,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=xr(n,"network-request-failed"),a=Dn().setTimeout(()=>{i(o)},X3.get());function l(){Dn().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i$={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},o$=500,a$=600,l$="_blank",u$="http://localhost";class Ob{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function c$(n,e,t,r=o$,s=a$){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},i$),{width:r.toString(),height:s.toString(),top:i,left:o}),d=Ln().toLowerCase();t&&(a=rA(d)?l$:t),tA(d)&&(e=e||u$,l.scrollbars="yes");const h=Object.entries(l).reduce((g,[v,w])=>`${g}${v}=${w},`,"");if(zL(d)&&a!=="_self")return d$(e||"",a),new Ob(null);const f=window.open(e||"",a,h);Ee(f,n,"popup-blocked");try{f.focus()}catch{}return new Ob(f)}function d$(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h$="__/auth/handler",f$="emulator/auth/handler",p$=encodeURIComponent("fac");async function Vb(n,e,t,r,s,i){Ee(n.config.authDomain,n,"auth-domain-config-required"),Ee(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Ta,eventId:s};if(e instanceof wi){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",WC(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))o[h]=f}if(e instanceof tu){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),d=l?`#${p$}=${encodeURIComponent(l)}`:"";return`${m$(n)}?${Bl(a).slice(1)}${d}`}function m$({config:n}){return n.emulator?Ov(n,f$):`https://${n.authDomain}/${h$}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bp="webStorageSupport";class g${constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=SA,this._completeRedirectFn=VA,this._overrideRedirectResult=L3}async _openPopup(e,t,r,s){var i;ci((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await Vb(e,t,r,Ec(),s);return c$(e,o,Mf())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await Vb(e,t,r,Ec(),s);return o3(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(ci(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await s$(e),r=new B3(e);return t.register("authEvent",s=>(Ee(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Bp,{type:Bp},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[Bp];o!==void 0&&t(!!o),Cr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=G3(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return lA()||nA()||Vv()}}const v$=g$;class $A{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Ps("unexpected MultiFactorSessionType")}}}class Wv extends $A{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Wv(e)}_finalizeEnroll(e,t,r){return X4(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return v3(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class y${constructor(){}static assertion(e){return Wv._fromCredential(e)}}y$.FACTOR_ID="phone";class _${static assertionForEnrollment(e,t){return Pc._fromSecret(e,t)}static assertionForSignIn(e,t){return Pc._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;Ee(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await Z4(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return Qv._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}_$.FACTOR_ID="totp";class Pc extends $A{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new Pc(t,void 0,e)}static _fromEnrollmentId(e,t){return new Pc(t,e)}async _finalizeEnroll(e,t,r){return Ee(typeof this.secret<"u",e,"argument-error"),e3(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){Ee(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return y3(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class Qv{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new Qv(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(Ld(e)||Ld(t))&&(s=!0),s&&(Ld(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),Ld(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Ld(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var Mb="@firebase/auth",Lb="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b${constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ee(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w$(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function x$(n){hs(new Zr("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;Ee(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:uA(n)},d=new JL(r,s,i,l);return i4(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),hs(new Zr("auth-internal",e=>{const t=wn(e.getProvider("auth").getImmediate());return(r=>new b$(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Rr(Mb,Lb,w$(n)),Rr(Mb,Lb,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E$=5*60,I$=Sx("authIdTokenMaxAge")||E$;let $b=null;const T$=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>I$)return;const s=t==null?void 0:t.token;$b!==s&&($b=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function A$(n=ql()){const e=pi(n,"auth");if(e.isInitialized())return e.getImmediate();const t=s4(n,{popupRedirectResolver:v$,persistence:[m3,TA,SA]}),r=Sx("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=T$(i.toString());W4(t,o,()=>o(t.currentUser)),G4(t,a=>o(a))}}const s=Ix("auth");return s&&o4(t,`http://${s}`),t}function S$(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}YL({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=xr("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",S$().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});x$("Browser");const P$={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},Jv=Nx(P$),ee=UV(Jv,{cacheSizeBytes:50*1024*1024,experimentalForceOwningTab:!1}),Yv=wL(Jv),$e=A$(Jv);try{K4($e,TA)}catch{}Q4($e,n=>{n||mA($e)});async function R$(n,e){try{return(await M4($e,n,e)).user}catch(t){throw t}}async function FA(n,e){try{return(await bA($e,n,e)).user}catch(t){throw t}}async function Xv(n){try{await D4($e,n)}catch(e){throw e}}async function C$(n){try{const e=$e.currentUser;if(e)await U4(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const Yr=Object.freeze(Object.defineProperty({__proto__:null,auth:$e,createPlayerAccount:R$,db:ee,getMessaging:Eg,resetPlayerPassword:Xv,signInPlayer:FA,storage:Yv,updatePlayerPassword:C$},Symbol.toStringTag,{value:"Module"})),Mm="BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8";async function Zv(){try{return await oE()}catch{return!1}}async function UA(){if(typeof navigator>"u"||!navigator.serviceWorker)return null;const n=await navigator.serviceWorker.getRegistration();if(n&&n.active)return n;const e=await navigator.serviceWorker.register("/service-worker.js");return new Promise(t=>{if(e.active){t(e);return}const r=()=>{e.active&&(e.removeEventListener("statechange",r),t(e))};e.addEventListener("statechange",r)})}async function jA(n){var i;if(!await Zv()||await Notification.requestPermission()!=="granted")return null;const t=Eg(ql());let r=n||await UA();const s=await aE(t,r?{vapidKey:Mm,serviceWorkerRegistration:r}:{vapidKey:Mm});try{const o=((i=$e==null?void 0:$e.currentUser)==null?void 0:i.email)||"anonymous";o&&s&&await en(ye(ee,"userPushTokens",o),{tokens:lM(s),lastToken:s,email:o,updatedAt:yn(),userAgent:navigator.userAgent,lastActivation:yn()},{merge:!0})}catch{}return s}async function Vh(){try{const n=localStorage.getItem("fcmToken");if(n){const r=Eg(ql());try{const s=await aE(r,{vapidKey:Mm});if(s===n)return{active:!0,token:s}}catch{}}const e=await UA(),t=await jA(e);return t?(localStorage.setItem("fcmToken",t),{active:!0,token:t}):{active:!1,error:"Failed to get token"}}catch(n){return{active:!1,error:n.message}}}function k$(){setInterval(async()=>{try{const n=await Vh();n.active||(console.log("Push notifications inactive, attempting to reactivate..."),window.dispatchEvent(new CustomEvent("push-status-changed",{detail:n})))}catch(n){console.warn("Push health check failed:",n)}},5*60*1e3)}const D$=["pin","pinCode","password","motdepasse","mdp","token","oobCode","apiKey","apikey","key","secret","authorization","auth","bearer"];function N$(){var t,r,s,i;const n=((r=(t=import.meta)==null?void 0:t.env)==null?void 0:r.MODE)==="development"?"debug":"warn";return((i=(s=import.meta)==null?void 0:s.env)==null?void 0:i.VITE_LOG_LEVEL)||n}function BA(n){switch(n){case"debug":return 10;case"info":return 20;case"warn":return 30;case"error":return 40;case"silent":return 100;default:return 30}}function O$(n){return typeof n!="string"?n:n.length<=2?"••":n.length>=8?`${n.slice(0,2)}••••${n.slice(-2)}`:"••••"}function qA(n){if(!n)return!1;const e=String(n).toLowerCase();return D$.some(t=>e.includes(t.toLowerCase()))}function Lm(n){if(n==null)return n;if(typeof n=="string"){if(n.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){const[r,s]=n.split("@"),i=r.length<=2?"••":`${r.slice(0,2)}••`,o=s.split("."),a=o[0].length<=2?"••":`${o[0].slice(0,2)}••`;return`${i}@${a}.${o.slice(1).join(".")}`}return n.length>=12&&!/\s/.test(n)?O$(n):n}if(typeof n=="number"){const e=String(n);return/^\d{4,6}$/.test(e)?"••••":n}if(Array.isArray(n))return n.map(e=>Lm(e));if(typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=qA(t)?"••••":Lm(r);return e}return n}function V$(n){const e=[];for(let t=0;t<n.length;t+=1){const r=n[t],s=t>0?n[t-1]:null;if(typeof s=="string"&&qA(s)&&(typeof r=="string"||typeof r=="number")){e.push("••••");continue}e.push(Lm(r))}return e}const M$=BA(N$());function $d(n,e){const t=BA(n);return(...r)=>{if(t<M$)return;const s=V$(r);console[e](...s)}}const L={debug:$d("debug","log"),info:$d("info","info"),warn:$d("warn","warn"),error:$d("error","error")},ey="userNavigation";async function Zo(n,e,t={}){try{if(!n||!e){L.warn("Données manquantes pour tracker la navigation",{userId:n,path:e});return}if(["/reset-password","/magic","/join","/login","/signup"].some(o=>e.startsWith(o)))return;const s={userId:n,lastVisitedPage:e,lastVisitedAt:yn(),deviceInfo:F$(),...t},i=n.includes("@")?`email_${n.replace(/[^a-zA-Z0-9]/g,"_")}`:n;await en(ye(ee,ey,i),s,{merge:!0})}catch(r){r.code!=="permission-denied"&&L.error("Erreur lors du tracking de la navigation",r)}}async function L$(n){try{if(!n)return L.warn("Aucun userId fourni pour récupérer la navigation"),null;const e=n.includes("@")?`email_${n.replace(/[^a-zA-Z0-9]/g,"_")}`:n,t=ye(ee,ey,e),r=await Mt(t);return r.exists()?r.data():null}catch(e){return L.error("Erreur lors de la récupération de la navigation",e),null}}async function $$(n){try{if(!n){L.warn("Aucun userId fourni pour effacer la navigation");return}const e=n.includes("@")?`email_${n.replace(/[^a-zA-Z0-9]/g,"_")}`:n,t=ye(ee,ey,e);await en(t,{userId:n,lastVisitedPage:null,lastVisitedAt:yn(),cleared:!0})}catch(e){e.code!=="permission-denied"&&L.error("Erreur lors de l'effacement de la navigation",e)}}function Fb(n){return!(!n||["/reset-password","/magic","/join","/login","/signup"].some(t=>n.startsWith(t))||n===window.location.pathname)}function F$(){try{return{userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,timestamp:new Date().toISOString()}}catch{return{timestamp:new Date().toISOString()}}}function U$(){try{const n=localStorage.getItem("hatcast_current_user_id");if(n)return n;const t=new URLSearchParams(window.location.search).get("email");return t||null}catch(n){return L.error("Erreur lors de la récupération de l'ID utilisateur",n),null}}const j$={class:"max-w-7xl mx-auto px-4 py-3 flex items-center justify-between"},B$={class:"flex items-center space-x-3"},q$={class:"max-w-7xl mx-auto px-4 py-3 flex items-center justify-between"},z$={class:"flex items-center space-x-3"},H$={key:0,class:"fixed top-0 left-0 right-0 z-[99999] bg-black text-white shadow-lg border-b border-gray-800"},K$={__name:"App",setup(n){const e=S(null),t=S(!1),r=S(!1),s=S(!1),i=S(!1),o=_o();Nt(()=>o.path,async(w,b)=>{if(w!==b){const x=U$();if(x){const M={};if(w.startsWith("/season/")){const O=w.split("/");O.length>=3&&(M.seasonSlug=O[2])}if(w.includes("/event/")){const O=w.match(/\/event\/([^\/]+)/);O&&(M.eventId=O[1])}await Zo(x,w,M)}}},{immediate:!0});function a(w){w.preventDefault(),e.value=w,t.value=!0;const b=localStorage.getItem("hatcast-pwa-banner-last-shown"),x=Date.now(),M=24*60*60*1e3;b&&x-parseInt(b)<M?t.value=!1:localStorage.setItem("hatcast-pwa-banner-last-shown",x.toString())}async function l(){if(e.value){try{e.value.prompt();const{outcome:w}=await e.value.userChoice;w==="accepted"?(console.log("PWA installée avec succès"),localStorage.setItem("hatcast-pwa-installed","true")):console.log("Installation PWA refusée par l'utilisateur")}catch(w){console.error("Erreur lors de l'installation PWA:",w)}t.value=!1,e.value=null,i.value=!0}}function d(){i.value=!0,localStorage.setItem("hatcast-pwa-banner-dismissed",Date.now().toString())}function h(){t.value=!1,e.value=null,i.value=!0,localStorage.setItem("hatcast-pwa-installed","true")}function f(){const w=localStorage.getItem("hatcast-pwa-installed"),b=localStorage.getItem("hatcast-pwa-banner-dismissed");if(w==="true"){t.value=!1;return}if(b){const x=Date.now(),M=60*60*1e3;x-parseInt(b)<M&&(i.value=!0)}}function g(){s.value=!0,console.log("🚀 Début de la mise à jour PWA..."),setTimeout(async()=>{try{if(console.log("📡 Vérification du service worker..."),"serviceWorker"in navigator){const w=await navigator.serviceWorker.getRegistration();console.log("🔍 Enregistrement SW trouvé:",w),w&&w.active?(console.log("✅ Service worker actif trouvé, envoi du message SKIP_WAITING..."),w.active.postMessage({type:"SKIP_WAITING"}),console.log("📤 Message SKIP_WAITING envoyé"),await new Promise(b=>setTimeout(b,500)),console.log("⏳ Attente de 500ms terminée"),w.waiting?(console.log("🔄 Service worker en attente détecté, attente de l'activation..."),await new Promise(b=>{const x=()=>{w.waiting?(console.log("⏳ Service worker toujours en attente, nouvelle vérification dans 100ms..."),setTimeout(x,100)):(console.log("✅ Service worker activé avec succès"),b())};x()})):console.log("ℹ️ Aucun service worker en attente")):console.warn("⚠️ Aucun service worker actif trouvé")}else console.warn("⚠️ Service Worker non supporté sur cet appareil");console.log("🔄 Rechargement de la page..."),window.location.reload()}catch(w){console.error("❌ Erreur lors de la mise à jour:",w),s.value=!1,alert(`Erreur lors de la mise à jour: ${w.message}

Veuillez rafraîchir manuellement la page.`)}},1e3)}function v(){r.value=!0}return Sn(()=>{f(),Vh().then(w=>{w.active?console.log("Notifications push actives au démarrage"):console.log("Notifications push inactives au démarrage:",w.error)}),window.addEventListener("beforeinstallprompt",a),window.addEventListener("appinstalled",h),window.addEventListener("pwa-update-test",v),window.addEventListener("show-pwa-install-banner",()=>{console.log("📱 Déclenchement manuel de la barre d'installation PWA"),e.value&&!i.value?(t.value=!0,i.value=!1,localStorage.removeItem("hatcast-pwa-banner-last-shown"),localStorage.removeItem("hatcast-pwa-banner-dismissed"),console.log("✅ Barre d'installation PWA affichée manuellement")):console.log("⚠️ Impossible d'afficher la barre d'installation PWA (déjà affichée ou non disponible)")}),"serviceWorker"in navigator&&(navigator.serviceWorker.addEventListener("controllerchange",()=>{s.value||(r.value=!0)}),navigator.serviceWorker.addEventListener("message",w=>{w.data&&w.data.type==="SW_UPDATING"&&console.log("Service worker en cours de mise à jour...")}),setInterval(()=>{navigator.serviceWorker.getRegistration().then(w=>{w&&w.update()})},60*60*1e3))}),sg(()=>{window.removeEventListener("beforeinstallprompt",a),window.removeEventListener("appinstalled",h),window.removeEventListener("pwa-update-test",v),window.removeEventListener("show-pwa-install-banner",()=>{})}),(w,b)=>{const x=tP("router-view");return C(),N(xt,null,[Be(x),Be(dp,{name:"install-banner",appear:""},{default:Ud(()=>[t.value&&!i.value?(C(),N("div",{key:0,class:"fixed top-0 left-0 right-0 z-[99999] bg-black text-white shadow-lg border-b border-gray-800",onClick:l},[c("div",j$,[b[2]||(b[2]=c("div",{class:"flex items-center space-x-3 flex-1"},[c("img",{src:gp,alt:"HatCast",class:"w-8 h-8 rounded-lg"}),c("div",{class:"flex-1"},[c("div",{class:"flex items-center space-x-2"},[c("span",{class:"font-semibold text-lg text-white"},"HatCast")]),c("p",{class:"text-sm text-gray-300 leading-tight"}," Installez l'app pour une meilleure expérience ")])],-1)),c("div",B$,[c("button",{class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",onClick:mt(l,["stop"])}," Installer "),c("button",{class:"text-gray-400 hover:text-white p-2 rounded-full hover:bg-gray-800 transition-colors",onClick:mt(d,["stop"]),"aria-label":"Fermer la barre d'installation"},b[1]||(b[1]=[c("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])])):ae("",!0)]),_:1}),Be(dp,{name:"install-banner",appear:""},{default:Ud(()=>[r.value&&!s.value?(C(),N("div",{key:0,class:"fixed top-0 left-0 right-0 z-[99999] bg-black text-white shadow-lg border-b border-gray-800",onClick:g},[c("div",q$,[b[4]||(b[4]=c("div",{class:"flex items-center space-x-3 flex-1"},[c("img",{src:gp,alt:"HatCast",class:"w-8 h-8 rounded-lg"}),c("div",{class:"flex-1"},[c("div",{class:"flex items-center space-x-2"},[c("span",{class:"font-semibold text-lg text-white"},"HatCast")]),c("p",{class:"text-sm text-gray-300 leading-tight"}," Une nouvelle version est disponible. Mettez à jour pour profiter des dernières améliorations. ")])],-1)),c("div",z$,[c("button",{class:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",onClick:mt(g,["stop"])}," Mettre à jour "),c("button",{class:"text-gray-400 hover:text-white p-2 rounded-full hover:bg-gray-800 transition-colors",onClick:b[0]||(b[0]=mt(M=>r.value=!1,["stop"])),"aria-label":"Fermer la barre de mise à jour"},b[3]||(b[3]=[c("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])])):ae("",!0)]),_:1}),Be(dp,{name:"install-banner",appear:""},{default:Ud(()=>[s.value?(C(),N("div",H$,b[5]||(b[5]=[c("div",{class:"max-w-7xl mx-auto px-4 py-3 flex items-center justify-between"},[c("div",{class:"flex items-center space-x-3 flex-1"},[c("img",{src:gp,alt:"HatCast",class:"w-8 h-8 rounded-lg"}),c("div",{class:"flex-1"},[c("div",{class:"flex items-center space-x-2"},[c("span",{class:"font-semibold text-lg text-white"},"HatCast")]),c("p",{class:"text-sm text-gray-300 leading-tight"}," Mise à jour en cours... Veuillez patienter ")])]),c("div",{class:"flex items-center space-x-3"},[c("div",{class:"flex items-center space-x-2"},[c("div",{class:"w-5 h-5 bg-blue-600 rounded-full flex items-center justify-center"},[c("svg",{class:"w-3 h-3 text-white animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})])]),c("span",{class:"text-sm text-gray-300"},"Mise à jour...")])])],-1)]))):ae("",!0)]),_:1})],64)}}},G$="modulepreload",W$=function(n){return"/"+n},Ub={},dt=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=W$(i),i in Ub)return;Ub[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const f=s[h];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const d=document.createElement("link");if(d.rel=o?"stylesheet":G$,o||(d.as="script",d.crossOrigin=""),d.href=i,document.head.appendChild(d),o)return new Promise((h,f)=>{d.addEventListener("load",h),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};function Q$(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:r,onRegistered:s,onRegisteredSW:i,onRegisterError:o}=n;let a,l;const d=async(f=!0)=>{await l};async function h(){if("serviceWorker"in navigator){const{Workbox:f}=await dt(()=>import("./workbox-window.prod.es5-5ffdab76.js"),[]);a=new f("/service-worker.js",{scope:"/",type:"classic"}),a.addEventListener("activated",g=>{(g.isUpdate||g.isExternal)&&window.location.reload()}),a.addEventListener("installed",g=>{g.isUpdate||r==null||r()}),a.register({immediate:e}).then(g=>{i?i("/service-worker.js",g):s==null||s(g)}).catch(g=>{o==null||o(g)})}}return l=h(),d}const Da="seasons";async function J$(n,e,t,r="",s=""){return await _i(Je(ee,Da),{name:n,slug:e,pinCode:t,description:r,logoUrl:s,createdAt:yn()})}async function Y$(n){return await go(ye(ee,Da,n))}async function ol(){const n=mo(Je(ee,Da),GV("createdAt","desc"));return(await Dt(n)).docs.map(t=>({id:t.id,...t.data()}))}async function Mh(n,e){const t=await Mt(ye(ee,Da,n));return t.exists()?t.data().pinCode===e:!1}async function $m(n){const e=await Mt(ye(ee,Da,n));return e.exists()?e.data().pinCode:null}async function Iu(n,e){const t=ye(ee,Da,n);await To(t,{sortOrder:e})}async function X$(n,e){const t=ye(ee,Da,n);await To(t,e)}const ty="lastVisitedSeason",zA="lastVisitedSeasonTimestamp";async function Z$(n){if(n)try{const e=$e.currentUser,t=e==null?void 0:e.email;try{localStorage.setItem(ty,n),localStorage.setItem(zA,Date.now().toString())}catch(r){L.warn("Erreur lors de la sauvegarde localStorage",r)}if(t)try{const r=ye(ee,"userPreferences",t);await en(r,{lastVisitedSeason:n,lastVisitedSeasonTimestamp:Date.now()},{merge:!0}),L.debug("Préférence de saison sauvegardée dans Firebase",{seasonSlug:n,userEmail:t})}catch(r){L.warn("Erreur lors de la sauvegarde Firebase",r)}}catch(e){L.error("Erreur lors de la mémorisation de la saison",e)}}async function HA(){try{const n=$e.currentUser,e=n==null?void 0:n.email;if(e)try{const t=ye(ee,"userPreferences",e),r=await Mt(t);if(r.exists()){const s=r.data();if(s.lastVisitedSeason)return L.debug("Préférence de saison récupérée depuis Firebase",{seasonSlug:s.lastVisitedSeason}),s.lastVisitedSeason}}catch(t){L.warn("Erreur lors de la récupération Firebase",t)}try{const t=localStorage.getItem(ty);if(t)return L.debug("Préférence de saison récupérée depuis localStorage",{seasonSlug:t}),t}catch(t){L.warn("Erreur lors de la lecture localStorage",t)}return null}catch(n){return L.error("Erreur lors de la récupération de la dernière saison",n),null}}async function eF(n=null){var e;try{const t=n||((e=$e.currentUser)==null?void 0:e.email);try{localStorage.removeItem(ty),localStorage.removeItem(zA)}catch(r){L.warn("Erreur lors du nettoyage localStorage",r)}if(t)try{const r=ye(ee,"userPreferences",t);await en(r,{lastVisitedSeason:null,lastVisitedSeasonTimestamp:null},{merge:!0}),L.debug("Préférence de saison nettoyée dans Firebase",{userEmail:t})}catch(r){L.warn("Erreur lors du nettoyage Firebase",r)}}catch(t){L.error("Erreur lors du nettoyage des préférences",t)}}function tF(n,e){return!n||!e||!Array.isArray(e)?!1:e.some(t=>t.slug===n)}const Rs=S(null),Rc=S(!1),al=S(!1),nF=He(()=>{var n;return!!Rs.value&&!((n=Rs.value)!=null&&n.isAnonymous)});He(()=>!!Rs.value);function wl(){var n;try{const e=$e.currentUser;e!==Rs.value&&(Rs.value=e,L.debug("Synchronisation forcée de l'état d'authentification",{user:((n=Rs.value)==null?void 0:n.email)||"non connecté"}))}catch(e){L.error("Erreur lors de la synchronisation forcée",e)}}function rF(){var n;if(!(Rc.value||al.value)){al.value=!0;try{Rs.value=$e.currentUser,L.debug("État initial de l'utilisateur:",((n=Rs.value)==null?void 0:n.email)||"non connecté");const e=$e.onAuthStateChanged(async t=>{const r=Rs.value;Rs.value=t,Rc.value=!0,al.value=!1;try{if(t&&!r){const s=window.location.pathname;s&&s!=="/"&&await Zo(t.uid,s)}else!t&&r&&await $$(r.uid)}catch(s){s.code!=="permission-denied"&&L.error("Erreur lors du tracking de navigation:",s)}});window._authStateUnsubscribe=e,L.info("Service d'état d'authentification initialisé avec succès")}catch(e){L.error("Erreur lors de l'initialisation du service d'authentification:",e),al.value=!1}}}function KA(){return new Promise((n,e)=>{if(Rc.value){n();return}if(!al.value){L.warn("Service d'authentification non initialisé et non en cours d'initialisation"),e(new Error("Service d'authentification non initialisé"));return}const t=setInterval(()=>{Rc.value&&(clearInterval(t),n())},100);setTimeout(()=>{clearInterval(t),L.warn("Timeout de waitForInitialization, rejet de la promesse"),e(new Error("Timeout d'initialisation du service d'authentification"))},5e3)})}function sF(){!Rc.value&&!al.value&&Lh()}function Lh(){if(typeof $e>"u"||!$e){L.warn("Firebase auth non disponible, nouvelle tentative dans 500ms"),setTimeout(Lh,500);return}try{rF()}catch(n){L.error("Erreur lors de l'auto-initialisation:",n),setTimeout(Lh,1e3)}}setTimeout(Lh,100);const iF={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center"},oF={class:"text-center"},aF={class:"text-white text-lg"},lF={__name:"SeasonResolver",setup(n){const e=Ea(),t=S("Chargement...");return Sn(async()=>{try{if(new URLSearchParams(window.location.search).get("p")==="reset-password"){L.info("Redirection vers la page de reset password"),e.replace("/reset-password");return}t.value="Vérification de votre session...",wl(),await KA();const i=await new Promise((l,d)=>{const h=setTimeout(()=>{d(new Error("Timeout Firebase Auth"))},3e3),f=$e.onAuthStateChanged(g=>{clearTimeout(h),f(),l(g)});$e.currentUser&&(clearTimeout(h),f(),l($e.currentUser))}),o=i==null?void 0:i.email;if(!o){L.info("Utilisateur non connecté, redirection vers /seasons"),e.replace("/seasons");return}t.value="Récupération de vos préférences...";const a=await HA();if(!a){L.info("Aucune saison mémorisée, redirection vers /seasons"),e.replace("/seasons");return}t.value="Vérification de la saison...";try{const l=await ol();if(!tF(a,l)){L.info("Saison mémorisée n'existe plus, redirection vers /seasons"),await eF(o),e.replace("/seasons");return}}catch(l){L.error("Erreur lors de la vérification des saisons",l),e.replace("/seasons");return}L.info("Redirection vers la saison mémorisée",{seasonSlug:a}),e.replace(`/season/${a}`)}catch(r){L.error("Erreur lors de la résolution de la saison",r),e.replace("/seasons")}}),(r,s)=>(C(),N("div",iF,[c("div",oF,[s[0]||(s[0]=c("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"},null,-1)),c("p",aF,oe(t.value),1)])]))}},uF="/logos/hatcast-mask.png",Fm="/logos/hatcast-logo-mobile.png";async function cF(n,e=800,t=800,r=.8){return new Promise((s,i)=>{const o=document.createElement("canvas"),a=o.getContext("2d"),l=new Image;l.onload=()=>{let{width:d,height:h}=l;d>e&&(h=h*e/d,d=e),h>t&&(d=d*t/h,h=t),o.width=d,o.height=h,a.drawImage(l,0,0,d,h),o.toBlob(f=>{if(f){const g=new File([f],n.name,{type:"image/jpeg",lastModified:Date.now()});s(g)}else i(new Error("Erreur lors du redimensionnement"))},"image/jpeg",r)},l.onerror=()=>i(new Error("Erreur lors du chargement de l'image")),l.src=URL.createObjectURL(n)})}async function GA(){if(!$e.currentUser){L.info("Aucun utilisateur connecté, tentative de connexion anonyme...");try{await mA($e),L.info("Connexion anonyme réussie")}catch(n){throw L.error("Erreur lors de la connexion anonyme:",n),new Error("Impossible de s'authentifier: "+n.message)}}await new Promise(n=>setTimeout(n,1e3))}async function dF(n,e,t={}){var r;try{if(L.info("Début upload image",{fileName:n.name,path:e,originalSize:`${(n.size/1024/1024).toFixed(2)}MB`}),await GA(),!n.type.startsWith("image/"))throw new Error("Le fichier doit être une image");if(n.size>10*1024*1024)throw new Error("L'image est trop volumineuse (max 10MB)");let s=n;if(t.resize!==!1&&(n.size>1024*1024||t.forceResize)){L.info("Redimensionnement de l'image pour optimiser les performances...");try{s=await cF(n,t.maxWidth||800,t.maxHeight||800,t.quality||.8),L.info("Image redimensionnée",{newSize:`${(s.size/1024/1024).toFixed(2)}MB`,compression:`${((1-s.size/n.size)*100).toFixed(1)}%`})}catch(w){L.warn("Erreur lors du redimensionnement, utilisation du fichier original:",w),s=n}}const a=`${Date.now()}_${n.name}`,l=`${e}/${a}`,d=zT(Yv,l);L.info("Tentative d'upload vers Firebase Storage...",{fullPath:l,user:(r=$e.currentUser)==null?void 0:r.uid,isAuthenticated:!!$e.currentUser,finalSize:`${(s.size/1024/1024).toFixed(2)}MB`});const h=yL(d,s),f=new Promise((w,b)=>setTimeout(()=>b(new Error("Timeout: Upload trop long")),3e4)),g=await Promise.race([h,f]);L.info("Image uploadée avec succès",{fullPath:l});const v=await _L(g.ref);return L.info("URL de téléchargement récupérée",{downloadURL:v}),v}catch(s){if(L.error("Erreur lors de l'upload de l'image",s),s.message.includes("CORS")||s.message.includes("preflight")||s.message.includes("permission")||s.message.includes("unauthenticated")||s.message.includes("ERR_FAILED")||s.message.includes("Timeout"))return L.warn("Erreur d'accès détectée, utilisation du stockage local temporaire",s.message),await hF(n,e);throw s}}async function hF(n,e){return new Promise((t,r)=>{const s=new FileReader;s.onload=i=>{const o=i.target.result;L.info("Image stockée localement en base64",{path:e}),t(o)},s.onerror=()=>r(new Error("Erreur lors de la lecture du fichier")),s.readAsDataURL(n)})}async function fF(n){var e;try{if(L.info("Début suppression image",{imageUrl:n}),n.startsWith("data:image/")){L.info("Image locale (base64), suppression ignorée");return}await GA();const r=(e=new URL(n).pathname.split("/o/")[1])==null?void 0:e.split("?")[0];if(!r)throw new Error("Impossible d'extraire le chemin de l'image");const s=decodeURIComponent(r),i=zT(Yv,s);await bL(i),L.info("Image supprimée avec succès",{decodedPath:s})}catch(t){throw L.error("Erreur lors de la suppression de l'image",t),t}}function pF(n){return n&&n.includes("firebasestorage.googleapis.com")}const qp=7*24*60*60*1e3,Tu="hatcast_pin_session";class mF{constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(Tu);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<qp){try{t.timestamp=Date.now(),localStorage.setItem(Tu,JSON.stringify(t))}catch{}return t}else this.clearSession()}}catch{console.error("Erreur lors du chargement de la session PIN")}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(Tu,JSON.stringify(r)),this.sessionData=r}catch{console.error("Erreur lors de la sauvegarde de la session PIN")}}isPinCached(e){if(!this.sessionData)return!1;const t=this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<qp;if(t)try{this.sessionData.timestamp=Date.now(),localStorage.setItem(Tu,JSON.stringify(this.sessionData))}catch{}return t}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(Tu),this.sessionData=null}catch{console.error("Erreur lors de la suppression de la session PIN")}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=qp-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const Jn=new mF,gF={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},vF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},yF={class:"text-center mb-6"},_F={class:"text-gray-300"},bF={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},wF={class:"text-sm text-green-400"},xF={class:"mb-6"},EF={class:"mb-4"},IF={key:0,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},TF={class:"flex justify-end space-x-3"},AF=["disabled"],WA={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S(""),o=S(null);Nt(()=>t.show,h=>{h&&(s.value="",i.value="",Bt(()=>{var f;(f=o.value)==null||f.focus()}))});function a(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function l(){s.value.length===4&&r("submit",s.value)}function d(){r("cancel")}return(h,f)=>n.show?(C(),N("div",gF,[c("div",vF,[c("div",yF,[f[1]||(f[1]=c("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[c("span",{class:"text-2xl"},"🔒")],-1)),f[2]||(f[2]=c("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),c("p",_F,oe(n.message),1),n.sessionInfo?(C(),N("div",bF,[c("p",wF," Session active : "+oe(n.sessionInfo.timeRemaining)+" min restantes ",1)])):ae("",!0)]),c("div",xF,[c("div",EF,[f[3]||(f[3]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),tt(c("input",{"onUpdate:modelValue":f[0]||(f[0]=g=>s.value=g),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:a,onKeydown:[or(l,["enter"]),or(d,["escape"])],ref_key:"pinInput",ref:o},null,544),[[Ut,s.value]])]),f[4]||(f[4]=c("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))]),i.value||t.error?(C(),N("div",IF,oe(i.value||t.error),1)):ae("",!0),c("div",TF,[c("button",{onClick:d,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),c("button",{onClick:l,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,AF)])])])):ae("",!0)}},jb="hatcast_trusted_players",Bb=180*24*60*60*1e3;class SF{constructor(){this.trustedMap=this.load()}load(){try{const e=localStorage.getItem(jb);if(!e)return{};const t=JSON.parse(e);return typeof t=="object"&&t!==null?t:{}}catch{return{}}}persist(){try{localStorage.setItem(jb,JSON.stringify(this.trustedMap))}catch{}}isPasswordCached(e){if(!e)return!1;const t=this.trustedMap[e];if(!t)return!1;const r=Date.now(),s=r-t<Bb;return s?(this.trustedMap[e]=r,this.persist()):(delete this.trustedMap[e],this.persist()),s}getCachedPassword(e){return null}saveSession(e,t){e&&(this.trustedMap[e]=Date.now(),this.persist())}clearSession(e){e&&(delete this.trustedMap[e],this.persist())}clearExpiredSessions(){const e=Date.now();let t=!1;for(const[r,s]of Object.entries(this.trustedMap))e-s>Bb&&(delete this.trustedMap[r],t=!0);t&&this.persist()}clearAllSessions(){this.trustedMap={},this.persist()}}const vo=new SF,Ff=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},PF={};function RF(n,e){return C(),N(xt,null,[e[0]||(e[0]=c("div",{class:"text-gray-300"},"🎭 Ça marche déjà super bien sans, mais avec un compte, c'est encore plus cool :",-1)),e[1]||(e[1]=c("div",null,[ft("• "),c("span",{class:"text-blue-300"},"🔒 Tes dispos sont à l'abri :"),ft(" plus personne ne peut modifier tes choix à ta place")],-1)),e[2]||(e[2]=c("div",null,[ft("• "),c("span",{class:"text-blue-300"},"📧 Alertes VIP :"),ft(" sois le premier informé des nouveaux spectacles et sélections")],-1)),e[3]||(e[3]=c("div",null,[ft("• "),c("span",{class:"text-blue-300"},"⚡ Saisie express :"),ft(" ton nom reste en haut de la liste, plus besoin de le chercher")],-1))],64)}const qb=Ff(PF,[["render",RF]]),CF={key:0,class:"mt-4"},kF={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-2"},DF={key:1},NF={key:0,class:"mt-3 pt-3 border-t border-blue-500/20 text-sm text-gray-300 space-y-2"},ny={__name:"AccountBenefitsHint",props:{inline:{type:Boolean,default:!1}},setup(n){const e=S(!1);return(t,r)=>n.inline?(C(),N("div",DF,[c("button",{onClick:r[1]||(r[1]=s=>e.value=!e.value),class:"text-blue-300 hover:text-blue-200 text-sm font-medium flex items-center gap-2 transition-colors"},[r[3]||(r[3]=c("span",null,"À quoi sert un compte ?",-1)),c("span",{class:Qt(["transition-transform duration-200",{"rotate-180":e.value}])},"▼",2)]),e.value?(C(),N("div",NF,[Be(qb)])):ae("",!0)])):(C(),N("div",CF,[c("button",{onClick:r[0]||(r[0]=s=>e.value=!e.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[r[2]||(r[2]=c("h3",{class:"text-sm font-semibold text-blue-300"},"💡 À quoi sert un compte ?",-1)),c("span",{class:Qt(["text-blue-300 transition-transform duration-200",{"rotate-180":e.value}])},"▼",2)]),e.value?(C(),N("div",kF,[Be(qb)])):ae("",!0)]))}},OF={class:"space-y-4"},VF={class:"flex items-center justify-between"},MF={class:"flex items-center gap-2 text-gray-300 text-sm"},LF={key:0,class:"p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},$F={key:1,class:"p-3 bg-green-500/20 border border-green-500/30 rounded-lg text-green-300 text-sm"},FF={class:"flex justify-center gap-3 mt-2"},UF=["disabled"],jF={key:0,class:"animate-spin"},BF={key:1},QA={__name:"AccountLoginModal",props:{show:{type:Boolean,default:!1}},emits:["close","success"],setup(n,{emit:e}){const t=e,r=S(""),s=S(""),i=S(!1),o=S(""),a=S(""),l=S(!0),d=He(()=>!!r.value&&r.value.includes("@")&&!!s.value);async function h(){if(d.value){i.value=!0,o.value="",a.value="";try{if(await FA(r.value.trim(),s.value),l.value)try{vo.saveSession(r.value.trim())}catch{}t("success")}catch{o.value="Email ou mot de passe incorrect"}finally{i.value=!1}}}async function f(){if(!r.value||!r.value.includes("@")){o.value="Saisissez votre email pour recevoir un lien de réinitialisation",setTimeout(()=>{o.value=""},2500);return}i.value=!0,o.value="",a.value="";try{await Xv(r.value.trim()),a.value="Email de réinitialisation envoyé"}catch{o.value="Impossible d'envoyer l'email de réinitialisation"}finally{i.value=!1}}return(g,v)=>n.show?(C(),N("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[170] p-4",onClick:v[6]||(v[6]=w=>g.$emit("close"))},[c("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:v[5]||(v[5]=mt(()=>{},["stop"]))},[c("button",{onClick:v[0]||(v[0]=w=>g.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),v[10]||(v[10]=_r('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Se connecter</h2><p class="text-sm text-gray-300">Connectez-vous pour gérer votre compte et vos préférences</p></div>',1)),c("div",OF,[Be(ny),c("div",null,[v[7]||(v[7]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Email",-1)),tt(c("input",{"onUpdate:modelValue":v[1]||(v[1]=w=>r.value=w),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Ut,r.value]])]),c("div",null,[v[8]||(v[8]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),tt(c("input",{"onUpdate:modelValue":v[2]||(v[2]=w=>s.value=w),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe"},null,512),[[Ut,s.value]])]),c("div",VF,[c("label",MF,[tt(c("input",{type:"checkbox","onUpdate:modelValue":v[3]||(v[3]=w=>l.value=w),class:"w-4 h-4"},null,512),[[Wr,l.value]]),v[9]||(v[9]=c("span",null,"Rester connecté sur cet appareil",-1))]),c("button",{onClick:f,class:"text-sm text-blue-400 hover:text-blue-300 underline"},"Mot de passe oublié ?")]),o.value?(C(),N("div",LF,oe(o.value),1)):ae("",!0),a.value?(C(),N("div",$F,oe(a.value),1)):ae("",!0),c("div",FF,[c("button",{onClick:h,disabled:!d.value||i.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(C(),N("span",jF,"⏳")):(C(),N("span",BF,"Se connecter"))],8,UF),c("button",{onClick:v[4]||(v[4]=w=>g.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])])):ae("",!0)}},Uf="magicLinks";function jf({seasonId:n,playerId:e,eventId:t,action:r}){return`${n}__${e}__${t}__${r}`}function ry(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function $h({seasonId:n,playerId:e,eventId:t,action:r,slug:s}){const i=jf({seasonId:n,playerId:e,eventId:t,action:r}),o=ry(40),a=ye(ee,Uf,i),l=Date.now()+1e3*60*60*24*7;await en(a,{seasonId:n,playerId:e,eventId:t,token:o,action:r,expiresAt:l});let h=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(r)}`;return s&&(h+=`&slug=${encodeURIComponent(s)}`),{id:i,token:o,url:h}}async function JA({seasonId:n,playerId:e,email:t}){const r="protection",s="verify_email",i=jf({seasonId:n,playerId:e,eventId:r,action:s}),o=ry(40),a=ye(ee,Uf,i),l=Date.now()+1e3*60*60*24*7;await en(a,{seasonId:n,playerId:e,eventId:r,token:o,action:s,email:t,expiresAt:l});const h=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(s)}`;return{id:i,token:o,url:h}}async function YA({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=jf({seasonId:n,playerId:e,eventId:t,action:s}),o=ye(ee,Uf,i),a=await Mt(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function Um({seasonId:n,playerId:e,eventId:t,action:r}){const s=jf({seasonId:n,playerId:e,eventId:t,action:r}),i=ye(ee,Uf,s);await go(i)}const sy="accountMagicLinks";function Bf(n){return`account__${n}`}async function XA({currentEmail:n,newEmail:e}){const t=ry(40),r=Bf(t),s=ye(ee,sy,r),i=Date.now()+1e3*60*60*24*7;await en(s,{token:t,currentEmail:n,newEmail:e,action:"account_email_update",expiresAt:i});const a=`${window.location.origin+"/"}magic?a=account_email_update&t=${encodeURIComponent(t)}`;return{id:r,token:t,url:a}}async function ZA({token:n}){const e=Bf(n),t=ye(ee,sy,e),r=await Mt(t);if(!r.exists())return{valid:!1,reason:"not_found"};const s=r.data();return s.token!==n?{valid:!1,reason:"token_mismatch"}:typeof s.expiresAt=="number"&&Date.now()>s.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:s}}async function e1({token:n}){const e=Bf(n),t=ye(ee,sy,e);await go(t)}const t1=Object.freeze(Object.defineProperty({__proto__:null,buildAccountId:Bf,consumeAccountEmailUpdateLink:e1,consumeMagicLink:Um,createAccountEmailUpdateLink:XA,createEmailVerificationLink:JA,createMagicLink:$h,verifyAccountEmailUpdateLink:ZA,verifyMagicLink:YA},Symbol.toStringTag,{value:"Module"}));async function ed({toEmail:n,title:e,body:t,data:r={},reason:s="generic"}){if(!n)return{success:!1,error:"missing_toEmail"};const i={to:n,title:e,body:t,data:r,reason:s,createdAt:yn()};return await _i(Je(ee,"pushQueue"),i),{success:!0}}const qF=Object.freeze(Object.defineProperty({__proto__:null,queuePushMessage:ed},Symbol.toStringTag,{value:"Module"}));function zF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,yesUrl:s,noUrl:i}){return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>${n?`<strong>${n}</strong>`:"<strong>Hello</strong>"},</p>
      <p>🎯 <strong>Nouveau spectacle à l'horizon !</strong></p>
      <p>Es-tu dispo le ${t} pour <a href="${r}" style="color:#3b82f6;text-decoration:underline;font-weight:600;">${e}</a> ?</p>
      <p>🎭 <em>On a besoin de toi pour que ça brille ! ✨</em></p>
      <p style="margin-top: 12px; text-align: center;">
        <a href="${s}" style="display:inline-block;padding:10px 12px;margin-right:8px;border:2px solid #16a34a;color:#16a34a;border-radius:8px;text-decoration:none;">✅ Dispo</a>
        <a href="${i}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Pas dispo</a>
      </p>
      <p style="margin-top: 16px; color:#6b7280;">Détails : <a href="${r}" style="color:#3b82f6;text-decoration:underline;">${r}</a></p>
    </div>
  `}function HF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r}){return`${n?`${n}`:"Hello"},

🎯 Nouveau spectacle à l'horizon ! 

Es-tu dispo le ${t} pour ${e} ?

🎭 On a besoin de toi pour que ça brille ! ✨

✅ Dispo ❌ Pas dispo

Lien direct : ${r}`}function KF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r}){return`${n?`Bonjour ${n}`:"Hello"},

Tu es sélectionné(e) pour ${e} le ${t}!

🕺 Prépares-toi à briller, toute l'équipe compte sur toi!

Un imprévu ?😬 
Pas de souci, signales vite ton indisponibilité ici pour qu'on relance la sélection du spectacle : ${r}`}function GF({playerName:n,eventTitle:e,eventUrl:t,activationUrl:r,seasonTitle:s}){return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>${n?`<strong>${n}</strong>`:"<strong>Hello</strong>"},</p>
      <p>🔔 <strong>Active tes notifications pour ne rien rater !</strong></p>
      <p>Tu veux être informé(e) en temps réel de <strong>tous tes événements</strong> de la saison <strong>${s}</strong> ?</p>
      <p>🎯 <em>Clique sur le bouton ci-dessous pour activer tes notifications et recevoir des alertes pour tes événements !</em></p>
      <p style="margin-top: 16px; text-align: center;">
        <a href="${r}" style="display:inline-block;padding:12px 24px;background:linear-gradient(135deg, #8b5cf6, #ec4899);color:white;border-radius:8px;text-decoration:none;font-weight:600;box-shadow:0 4px 12px rgba(139, 92, 246, 0.3);">🔔 Activer mes notifications</a>
      </p>
      <p style="margin-top: 16px; color:#6b7280; font-size: 14px;">
        <em>En activant tes notifications, tu recevras des alertes pour :</em><br>
        • Les demandes de disponibilité<br>
        • Les sélections de joueurs<br>
        • Les changements d'horaires<br>
        • Les annonces importantes
      </p>
      <p style="margin-top: 16px; color:#6b7280;">Détails de l'événement : <a href="${t}" style="color:#3b82f6;text-decoration:underline;">${t}</a></p>
    </div>
  `}const WF="HatCast <impropick@gmail.com>",QF="impropick@gmail.com";function td(n=null){return{from:n||WF,replyTo:n||QF}}async function JF({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,eventUrl:o=void 0,reason:a="new_event",fromEmail:l=void 0}){try{const v=ye(ee,"userPreferences",n),w=await Mt(v);if(w.exists()){const b=w.data();if((b==null?void 0:b.notifyAvailability)===!1)return{success:!0,skipped:!0}}}catch{}const d=zF({playerName:e,eventTitle:t,eventDate:r,eventUrl:o,yesUrl:s,noUrl:i}),h=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,f={to:n,message:{subject:h,html:d},createdAt:yn(),meta:{reason:a,eventTitle:t,eventDate:r,playerName:e}},g=td(l);f.from=g.from,f.replyTo=g.replyTo,await _i(Je(ee,"mail"),f);try{const v=ye(ee,"userPreferences",n),w=await Mt(v),b=w.exists()?w.data():{};if((b==null?void 0:b.notifyAvailabilityPush)!==!1){const x=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,M=`${e}, t'es dispo ?`;await ed({toEmail:n,title:x,body:M,data:{url:o||window.location.origin,yesUrl:s,noUrl:i,reason:a},reason:a==="reminder"?"availability_reminder":"availability_request"})}}catch{}return{success:!0}}async function n1({toEmail:n,verifyUrl:e,purpose:t="player_protection",displayName:r="utilisateur",fromEmail:s=void 0}){const i=t==="account_email_update",o=i?"Vérification de votre nouvelle adresse email":"Vérification de votre email",a=`Bonjour ${r},`,l=i?"Pour sécuriser votre compte, merci de confirmer que vous avez accès à cette nouvelle adresse email.":"Pour sécuriser votre joueur, merci de confirmer que vous avez accès à cette adresse email.",d=i?"Confirmer mon adresse email":"Vérifier mon email",h=i?"Confirmez votre nouvelle adresse email":"Confirmez votre email pour activer la protection",f=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>${o}</h2>
      <p>${a}</p>
      <p>${l}</p>
      <p>
        <a href="${e}" style="display:inline-block;padding:10px 16px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;">${d}</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Ce lien expirera dans 7 jours.</p>
    </div>
  `,g={to:n,message:{subject:h,html:f},createdAt:yn(),meta:{reason:t,displayName:r}},v=td(s);g.from=v.from,g.replyTo=v.replyTo,await _i(Je(ee,"mail"),g)}async function YF({toEmail:n,playerName:e,verifyUrl:t,fromEmail:r=void 0}){return n1({toEmail:n,verifyUrl:t,purpose:"player_protection",displayName:e,fromEmail:r})}async function XF({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,html:i=void 0,subject:o=void 0,fromEmail:a=void 0,noUrl:l=void 0}){try{const v=ye(ee,"userPreferences",n),w=await Mt(v);if(w.exists()){const b=w.data();if((b==null?void 0:b.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}L.debug("queueSelectionEmail",{forPlayer:e,hasCustomHtml:!!i,hasCustomSubject:!!o});const d=i||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>Bonjour ${e},</p>
      <p>Félicitations ! Tu as été sélectionné(e) pour <strong>${t}</strong> (${r}).</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Tu recevras bientôt plus d'informations sur l'organisation.</p>
    </div>
  `,h=o||`🎭 Sélection confirmée · ${t}`;L.debug("queueSelectionEmail html/subject ready");const f={to:n,message:{subject:h,html:d},createdAt:yn(),meta:{reason:"selection",eventTitle:t,eventDate:r,playerName:e}},g=td(a);f.from=g.from,f.replyTo=g.replyTo,L.debug("queueSelectionEmail firestore payload ready");try{await _i(Je(ee,"mail"),f);try{const v=ye(ee,"userPreferences",n),w=await Mt(v),b=w.exists()?w.data():{};console.log("Préférences utilisateur pour notifications push",{toEmail:n,prefs:b,notifySelectionPush:b==null?void 0:b.notifySelectionPush,shouldSendPush:(b==null?void 0:b.notifySelectionPush)!==!1}),(b==null?void 0:b.notifySelectionPush)!==!1?(console.log("Envoi notification push de sélection",{toEmail:n,playerName:e,eventTitle:t}),await ed({toEmail:n,title:"🎭 Sélection confirmée",body:`${e}, tu as été sélectionné(e) pour ${t} (${r}) 🎉`,data:{url:s||window.location.origin,noUrl:l},reason:"selection"}),console.log("Notification push de sélection envoyée avec succès")):console.log("Notification push de sélection désactivée par préférences utilisateur")}catch(v){console.error("Erreur lors de l'envoi de la notification push de sélection",v)}return L.info("Email ajouté à la queue Firestore",{playerName:e}),{success:!0}}catch(v){throw L.error("Erreur lors de l'ajout à Firestore",{playerName:e,error:v}),v}}async function ZF({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,newSelectedPlayers:i=[],html:o=void 0,subject:a=void 0,fromEmail:l=void 0}){try{const w=ye(ee,"userPreferences",n),b=await Mt(w);if(b.exists()){const x=b.data();if((x==null?void 0:x.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}const d=Array.isArray(i)?i.join(", "):"",h=o||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>🎭 Sélection mise à jour</h2>
      <p>Bonjour ${e},</p>
      <p>La sélection pour <strong>${t}</strong> (${r}) a été mise à jour et tu n'en fais plus partie 😔.</p>
      ${d?`<p>Nouvelle sélection: <strong>${d}</strong>.</p>`:""}
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#6b7280;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: mise à jour de sélection (relance auto ou ajustement manuel).</p>
    </div>
  `,f=a||`🎭 Tu n'es plus dans la sélection · ${t}`,g={to:n,message:{subject:f,html:h},createdAt:yn(),meta:{reason:"deselection",eventTitle:t,eventDate:r,playerName:e,newSelectedPlayers:i}},v=td(l);g.from=v.from,g.replyTo=v.replyTo,await _i(Je(ee,"mail"),g);try{const w=ye(ee,"userPreferences",n),b=await Mt(w),x=b.exists()?b.data():{};(x==null?void 0:x.notifySelectionPush)!==!1&&await ed({toEmail:n,title:"🎭 Sélection mise à jour",body:`${e}, tu n'es plus sélectionné(e) pour ${t} (${r}) 😔`,data:{url:s||window.location.origin,noUrl:s&&s.includes("/event/")?s.replace("/event/","/magic?auto=no&event="):void 0},reason:"deselection"})}catch{}return{success:!0}}async function eU({eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,players:i}){if(L.info("sendSelectionEmailsForEvent",{eventId:n,seasonId:r,seasonSlug:s,playersCount:i==null?void 0:i.length,selectedCount:t==null?void 0:t.length}),!e||!t||t.length===0)throw new Error("Données manquantes pour l'envoi des emails de sélection");const{getPlayerEmail:o}=await dt(()=>Promise.resolve().then(()=>wa),void 0),{createMagicLink:a}=await dt(()=>Promise.resolve().then(()=>t1),void 0),l=`${window.location.origin}/season/${s}/event/${n}`;t.join(", ");const d=`🎭 Sélection confirmée · ${e.title}`,h=[];for(const f of t){L.debug("Traitement du joueur",{playerName:f});try{const g=i==null?void 0:i.find(O=>O.name===f);if(!g){L.warn("Joueur non trouvé",{playerName:f});continue}L.debug("Joueur trouvé");const v=await o(g.id,r);if(!v){L.warn("Pas d'email pour le joueur",{playerName:f});continue}L.debug("Email trouvé pour joueur");const b=`${(await a({seasonId:r,playerId:g.id,eventId:n,action:"no"})).url}&slug=${encodeURIComponent(s)}`,x=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu as été sélectionné(e) pour <strong>${e.title}</strong> (${Fh(e.date)}).</p>
          <p>Un imprévu ?</p>
          <p>
            <a href="${b}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;margin-right:8px;">❌ Plus dispo</a>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
          </p>
        </div>
      `;L.debug("HTML généré pour joueur");const M=XF({toEmail:v,playerName:f,eventTitle:e.title,eventDate:Fh(e.date),eventUrl:l,html:x,subject:d,noUrl:b});h.push(M),L.info("Email ajouté à la queue",{playerName:f})}catch(g){L.error("Erreur lors de l'envoi de l'email de sélection",{playerName:f,error:g})}}return L.info("Nombre total d'emails à envoyer",{count:h.length}),await Promise.all(h),L.info("Tous les emails ont été envoyés avec succès"),{success:!0,count:h.length}}async function tU({eventId:n,eventData:e,removedPlayers:t,newSelectedPlayers:r,seasonId:s,seasonSlug:i,players:o}){if(L.info("sendDeselectionEmailsForEvent",{eventId:n,seasonId:s,removedCount:t==null?void 0:t.length}),!e||!t||t.length===0)return{success:!0,count:0};const{getPlayerEmail:a}=await dt(()=>Promise.resolve().then(()=>wa),void 0),l=`${window.location.origin}/season/${i}/event/${n}`,d=[],h=Array.isArray(r)?r.join(", "):"";for(const f of t)try{const g=o==null?void 0:o.find(b=>b.name===f);if(!g){L.warn("Joueur retiré non trouvé",{playerName:f});continue}const v=await a(g.id,s);if(!v){L.warn("Pas d'email pour le joueur retiré",{playerName:f});continue}const w=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2>🎭 Sélection mise à jour</h2>
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu n'es plus sélectionné(e) pour <strong>${e.title}</strong> (${Fh(e.date)}) 😔.</p>
          ${h?`<p>Nouvelle sélection: <strong>${h}</strong>.</p>`:""}
          <p>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #6b7280;color:#6b7280;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
          </p>
        </div>
      `;d.push(ZF({toEmail:v,playerName:f,eventTitle:e.title,eventDate:Fh(e.date),eventUrl:l,newSelectedPlayers:r,html:w}))}catch(g){L.error("Erreur lors de l'envoi de l'email de désélection",{playerName:f,error:g})}return await Promise.all(d),L.info("Emails de désélection envoyés",{count:d.length}),{success:!0,count:d.length}}function Fh(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}async function nU({toEmail:n,playerName:e,eventTitle:t,eventUrl:r,activationUrl:s,seasonTitle:i,fromEmail:o=void 0}){const a=GF({playerName:e,eventTitle:t,eventUrl:r,activationUrl:s,seasonTitle:i}),l=`🔔 Active tes notifications pour ${i}`,d={to:n,message:{subject:l,html:a},createdAt:yn(),meta:{reason:"notification_activation",eventTitle:t,playerName:e}},h=td(o);d.from=h.from,d.replyTo=h.replyTo;try{return await _i(Je(ee,"mail"),d),L.info("Email d'activation des notifications ajouté à la queue",{toEmail:n,playerName:e}),{success:!0}}catch(f){throw L.error("Erreur lors de l'ajout de l'email d'activation à la queue",f),f}}function iy(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}function r1(n){return`seasonPreferredPlayer:${n||"global"}`}function jm(n,e){try{const t=r1(n),r=localStorage.getItem(t);if(!r){localStorage.setItem(t,JSON.stringify([e]));return}if(r.startsWith("[")){const s=JSON.parse(r);s.includes(e)||(s.push(e),localStorage.setItem(t,JSON.stringify(s)))}else r!==e&&localStorage.setItem(t,JSON.stringify([r,e]))}catch{}}function rU(n,e){try{const t=r1(n),r=localStorage.getItem(t);if(!r)return;if(r.startsWith("[")){const s=JSON.parse(r).filter(i=>i!==e);s.length===0?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(s))}else r===e&&localStorage.removeItem(t)}catch{}}async function s1(n,e,t,r=null){try{L.info("Début protectPlayer",{playerId:n,seasonId:r});const s=await nu(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:l}=await dt(()=>import("./index.esm-7beab343.js"),[]),{db:d}=await dt(()=>Promise.resolve().then(()=>Yr),void 0),h=r?i(d,"seasons",r,"playerProtection"):i(d,"playerProtection"),f=o(h,a("email","==",e)),g=await l(f);if(!g.empty&&g.docs.find(A=>A.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");L.debug("Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:v}=await dt(()=>import("./index.esm-3f9d7d41.js"),[]),{auth:w}=await dt(()=>Promise.resolve().then(()=>Yr),void 0),b=await v(w,e,t);L.info("Compte Firebase Auth créé",{uid:b.user.uid});const x=iy(t),M=r?ye(d,"seasons",r,"playerProtection",n):ye(d,"playerProtection",n);return await en(M,{playerId:n,email:e,passwordHash:x,firebaseUid:b.user.uid,isProtected:!0,createdAt:new Date}),L.info("Protection sauvegardée dans Firestore"),r&&jm(r,n),{success:!0}}catch(s){throw L.error("Erreur lors de la protection du joueur",s),s}}async function i1({playerId:n,email:e,seasonId:t=null}){const r=t?ye(ee,"seasons",t,"playerProtection",n):ye(ee,"playerProtection",n);(await Mt(r)).exists()?await To(r,{email:e,updatedAt:new Date}):await en(r,{playerId:n,email:e,isProtected:!1,createdAt:new Date});const{url:i}=await JA({seasonId:t,playerId:n,email:e});return{success:!0,url:i}}async function o1({playerId:n,seasonId:e=null}){const t=e?ye(ee,"seasons",e,"playerProtection",n):ye(ee,"playerProtection",n);if(!(await Mt(t)).exists())throw new Error("Protection introuvable");return await To(t,{emailVerifiedAt:new Date}),{success:!0}}async function a1({playerId:n,seasonId:e=null}){const t=e?ye(ee,"seasons",e,"playerProtection",n):ye(ee,"playerProtection",n);return await To(t,{emailVerifiedAt:null}),{success:!0}}async function l1(n,e=null){try{const t=e?ye(ee,"seasons",e,"playerProtection",n):ye(ee,"playerProtection",n);return await en(t,{playerId:n,email:"",isProtected:!1,emailVerifiedAt:null,updatedAt:new Date}),e&&rU(e,n),{success:!0,email:""}}catch(t){throw L.error("Erreur lors de la suppression de la protection",t),t}}async function no(n,e=null){try{const t=e?ye(ee,"seasons",e,"playerProtection",n):ye(ee,"playerProtection",n),r=await Mt(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return L.error("Erreur lors de la vérification de protection",t),!1}}async function nu(n,e=null){try{const t=e?ye(ee,"seasons",e,"playerProtection",n):ye(ee,"playerProtection",n),r=await Mt(t);return r.exists()?r.data():null}catch(t){return t.code!=="not-found"&&t.code!=="permission-denied"&&L.error("Erreur lors de la récupération des données de protection",t),null}}async function u1(n,e=null){try{const t=await nu(n,e);return(t==null?void 0:t.email)||""}catch(t){return t.code!=="not-found"&&t.code!=="permission-denied"&&L.error("Erreur lors de la récupération de l'email",t),""}}async function Bm(n=null){try{const e=n?Je(ee,"seasons",n,"playerProtection"):Je(ee,"playerProtection");return(await Dt(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return e.code!=="not-found"&&e.code!=="permission-denied"&&L.error("Erreur lors du chargement des protections",e),[]}}async function qf(n){try{const e=[],t=mo(Je(ee,"playerProtection"),Jr("email","==",n));(await Dt(t)).forEach(i=>{const o=i.data();o!=null&&o.isProtected&&e.push({seasonId:null,playerId:i.id,...o})});const s=await Dt(Je(ee,"seasons"));for(const i of s.docs){const o=i.id,a=mo(Je(ee,"seasons",o,"playerProtection"),Jr("email","==",n));(await Dt(a)).forEach(d=>{var f;const h=d.data();h!=null&&h.isProtected&&e.push({seasonId:o,seasonName:(f=i.data())==null?void 0:f.name,playerId:d.id,...h})})}return e}catch(e){return e.code!=="not-found"&&e.code!=="permission-denied"&&L.error("Erreur listAssociationsForEmail",e),[]}}async function c1(n,e,t=null){try{const r=await nu(n,t);if(!r||!r.isProtected)return!1;if(r.email){L.debug("Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await dt(()=>import("./index.esm-3f9d7d41.js"),[]),{auth:i}=await dt(()=>Promise.resolve().then(()=>Yr),void 0);return await s(i,r.email,e),L.debug("Mot de passe Firebase Auth valide"),vo.saveSession(n),t&&jm(t,n),!0}catch(s){return L.debug("Mot de passe Firebase Auth invalide",{code:s.code}),!1}}else{L.debug("Vérification avec hash local");const s=iy(e),i=r.passwordHash===s;return i&&(vo.saveSession(n),t&&jm(t,n)),i}}catch(r){return L.error("Erreur lors de la vérification du mot de passe",r),!1}}async function d1({playerId:n,seasonId:e=null}){const t=e?ye(ee,"seasons",e,"playerProtection",n):ye(ee,"playerProtection",n),r=await Mt(t);if(!r.exists())throw new Error("Protection introuvable");const s=r.data();if(s!=null&&s.email)return await To(t,{isProtected:!0,updatedAt:new Date}),{success:!0};throw new Error("Email non défini pour cette protection")}function la(n){return vo.isPasswordCached(n)}function sU(n){return null}async function h1(n,e=null){try{L.info("Début sendPasswordResetEmail",{playerId:n,seasonId:e});const t=await nu(n,e);if(L.debug("Protection data disponible"),!t||!t.isProtected)throw new Error("Joueur non protégé");if(L.debug("Email à utiliser (masqué)"),t.firebaseUid){L.debug("Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await dt(()=>import("./index.esm-3f9d7d41.js"),[]),{auth:s}=await dt(()=>Promise.resolve().then(()=>Yr),void 0);L.debug("Tentative d'envoi d'email"),await r(s,t.email),L.info("Email envoyé avec succès via Firebase Auth")}else{L.debug("Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await dt(()=>import("./index.esm-3f9d7d41.js"),[]),{auth:i}=await dt(()=>Promise.resolve().then(()=>Yr),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);L.info("Compte temporaire créé",{uid:a.user.uid}),await s(i,t.email),L.info("Email envoyé avec succès");const{updateDoc:l}=await dt(()=>import("./index.esm-7beab343.js"),[]),{db:d}=await dt(()=>Promise.resolve().then(()=>Yr),void 0),h=e?ye(d,"seasons",e,"playerProtection",n):ye(d,"playerProtection",n);await l(h,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")L.debug("Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),L.info("Email envoyé avec succès");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw L.error("Erreur lors de l'envoi de l'email de réinitialisation",{error:t}),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}async function iU(n,e,t=null){try{const r=iy(e),s=t?ye(ee,"seasons",t,"playerProtection",n):ye(ee,"playerProtection",n);return await To(s,{passwordHash:r,updatedAt:new Date}),{success:!0}}catch(r){throw L.error("Erreur lors de la mise à jour du mot de passe",r),r}}async function oU(n){return new Promise((e,t)=>{L.debug("Demande de mot de passe pour disponibilité"),t(new Error("Gestion de mot de passe à implémenter côté composant"))})}const wa=Object.freeze(Object.defineProperty({__proto__:null,clearEmailVerificationForProtection:a1,finalizeProtectionAfterVerification:d1,getCachedPlayerPassword:sU,getPlayerEmail:u1,getPlayerProtectionData:nu,isPlayerPasswordCached:la,isPlayerProtected:no,listAssociationsForEmail:qf,listProtectedPlayers:Bm,markEmailVerifiedForProtection:o1,protectPlayer:s1,requirePlayerPasswordForAvailability:oU,sendPasswordResetEmail:h1,startEmailVerificationForProtection:i1,unprotectPlayer:l1,updatePlayerPasswordInFirestore:iU,verifyPlayerPassword:c1},Symbol.toStringTag,{value:"Module"})),aU={class:"mb-4 md:mb-6"},lU={class:"flex items-start gap-4"},uU={class:"flex items-center gap-3"},cU={class:"space-y-2"},dU={class:"flex items-center gap-2"},hU={class:"text-gray-400 text-xs md:text-sm"},fU={key:0,class:"flex items-center gap-2"},pU=["title"],mU={class:"text-blue-200"},gU={class:"space-y-4 md:space-y-6"},vU={class:"space-y-2 md:space-y-3"},yU={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5"},_U=["disabled"],bU={key:0,class:"mt-2 text-xs text-red-300"},wU={key:1,class:"mt-2 text-xs text-green-300"},xU={class:"space-y-2 md:space-y-3"},EU={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5"},IU={key:0,class:"space-y-2 md:space-y-3"},TU={class:"flex items-center justify-between"},AU=["title"],SU={key:0,class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},PU={class:"flex items-center justify-between"},RU=["disabled"],CU={key:0,class:"text-xs text-green-300"},kU={key:1,class:"text-xs text-red-300"},DU={key:2,class:"text-[10px] text-gray-400 break-all"},NU={class:"text-[10px] text-gray-500"},OU={class:"flex items-center justify-between mb-4"},VU={class:"space-y-4"},MU=["disabled"],LU={key:0,class:"text-xs text-red-300 text-center"},$U={key:1,class:"text-xs text-green-300 text-center"},FU={class:"flex items-center justify-between mb-4"},UU={class:"text-lg md:text-xl font-semibold text-white flex items-center gap-2"},jU={class:"space-y-3"},BU={key:0,class:"text-sm text-gray-400 text-center py-4"},qU={key:1,class:"space-y-2"},zU={class:"flex items-center gap-2 min-w-0 flex-1"},HU={class:"truncate"},KU={class:"text-white font-medium text-sm"},GU={class:"text-gray-400 text-xs"},WU=["onClick"],f1={__name:"AccountMenu",props:{show:{type:Boolean,default:!1},seasonId:{type:String,default:null}},emits:["close","delete-account","open-player"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S(""),o=S(!1),a=S(""),l=S(""),d=S(!1),h=S(!1),f=S(""),g=S(""),v=S([]),w=S(!1),b=S(!1),x=S(!1),M=S(!1),O=S(""),A=S(""),j=S(localStorage.getItem("fcmToken")||""),de=function(B){try{return B?B.length>20?B.slice(0,8)+"…"+B.slice(-6):B:""}catch{return""}}("BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8"),re=S(!1);Nt(s,se=>{i.value=se||""}),Nt(i,se=>{d.value=!!se&&se.includes("@")&&se!==s.value});async function k(){if(d.value){o.value=!0,a.value="",l.value="";try{const se=await XA({currentEmail:s.value,newEmail:i.value.trim()});await n1({toEmail:i.value.trim(),verifyUrl:se.url,purpose:"account_email_update",displayName:"utilisateur"}),l.value=`Un email de vérification a été envoyé à ${i.value.trim()}. Cliquez sur le lien pour confirmer le changement.`}catch(se){a.value=(se==null?void 0:se.code)==="auth/requires-recent-login"?"Veuillez vous reconnecter pour modifier votre email":"Impossible de mettre à jour l'email"}finally{o.value=!1}}}async function I(){if(s.value){h.value=!0,f.value="",g.value="";try{const se=window.location.pathname+window.location.search,B={lastVisitedPage:se,timestamp:Date.now(),email:s.value,context:"account_menu_password_reset",returnToAccountMenu:!0,modalState:{accountMenu:!0,eventDetails:se.includes("modal=event_details"),playerDetails:se.includes("modal=player_details"),eventId:new URLSearchParams(window.location.search).get("event"),playerId:new URLSearchParams(window.location.search).get("player")}};localStorage.setItem("pendingPasswordResetNavigation",JSON.stringify(B)),await Xv(s.value),g.value="Email de réinitialisation envoyé. Vérifiez votre boîte de réception."}catch{f.value="Impossible d'envoyer l'email de réinitialisation. Veuillez réessayer."}finally{h.value=!1}}}function T(se){return`${se.seasonId||"global"}__${se.playerId}`}async function V(){try{const se=s.value?await qf(s.value):[],B=[];for(const Se of se){let ne=Se.playerId,te=Se.seasonId||"—";try{if(Se.seasonId){const De=ye(ee,"seasons",Se.seasonId,"players",Se.playerId),gt=await Mt(De);gt.exists()&&(ne=gt.data().name||ne);const At=ye(ee,"seasons",Se.seasonId),St=await Mt(At);St.exists()&&(te=St.data().name||te)}}catch{}B.push({...Se,playerName:ne,seasonName:te})}v.value=B}catch{v.value=[]}}async function U(se){if(confirm(`Êtes-vous sûr de vouloir dissocier le joueur "${se.playerName}" de votre compte ?`))try{const{deleteDoc:B}=await dt(()=>import("./index.esm-7beab343.js"),[]);if(se.seasonId){const ne=ye(ee,"seasons",se.seasonId,"playerProtection",se.playerId);await B(ne)}else{const ne=ye(ee,"playerProtection",se.playerId);await B(ne)}try{if(se.seasonId){const ne=`seasonPreferredPlayer:${se.seasonId}`,te=localStorage.getItem(ne);if(te)if(te.startsWith("[")){const gt=(JSON.parse(te)||[]).filter(At=>At!==se.playerId);localStorage.setItem(ne,JSON.stringify(gt))}else te===se.playerId&&localStorage.removeItem(ne)}}catch{}await V();const Se=`Joueur "${se.playerName}" dissocié avec succès`}catch(B){console.error("Erreur lors de la dissociation:",B),alert(`Erreur lors de la dissociation: ${B.message||"Veuillez réessayer"}`)}}function $(se){r("open-player",se),We()}async function D(){if(s.value){M.value=!0,A.value="",O.value="";try{const{queuePushMessage:se}=await dt(()=>Promise.resolve().then(()=>qF),void 0);await se({toEmail:s.value,title:"Test HatCast",body:"Ceci est un test de notification",data:{url:"/"},reason:"manual_test"}),O.value="OK"}catch{A.value="Échec de l'envoi du test"}finally{M.value=!1}}}function je(){const se=new CustomEvent("pwa-update-test",{detail:{type:"test-update",timestamp:Date.now()}});window.dispatchEvent(se),alert(`🧪 Test de mise à jour PWA déclenché !

Vérifiez que la notification toast apparaît en bas à droite de l'interface.`)}function Tt(){if(window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches){alert("📱 Votre application est déjà installée en mode standalone.");return}if(window.deferredPrompt)window.deferredPrompt.prompt(),window.deferredPrompt.userChoice.then(se=>{se.outcome==="accepted"?console.log("✅ Installation PWA acceptée par l'utilisateur"):console.log("❌ Installation PWA refusée par l'utilisateur"),window.deferredPrompt=null});else{const se=new CustomEvent("show-pwa-install-banner",{detail:{type:"manual-trigger",timestamp:Date.now()}});window.dispatchEvent(se),alert(`📱 Barre d'installation PWA déclenchée !

Si elle n'apparaît pas, essayez de naviguer sur le site pendant quelques minutes pour déclencher les critères d'installation.`)}}function yt(){re.value=!re.value}function We(){r("close")}return Nt(()=>t.show,se=>{var B;if(se)try{s.value=((B=$e==null?void 0:$e.currentUser)==null?void 0:B.email)||"",V()}catch{}}),Sn(()=>{var se;if(t.show)try{s.value=((se=$e==null?void 0:$e.currentUser)==null?void 0:se.email)||"",V()}catch{}x.value=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.includes(".local")||window.location.search.includes("debug=true")}),(se,B)=>n.show?(C(),N("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-2 md:p-4",onClick:We},[c("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-lg md:max-w-xl max-h-[90vh] overflow-y-auto",onClick:B[3]||(B[3]=mt(()=>{},["stop"]))},[c("button",{onClick:We,class:"absolute right-2 md:right-3 top-2 md:top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),c("div",aU,[c("div",lU,[c("div",uU,[B[13]||(B[13]=c("div",{class:"w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full flex items-center justify-center flex-shrink-0"},[c("span",{class:"text-lg md:text-xl"},"👤")],-1)),c("div",cU,[B[12]||(B[12]=c("h3",{class:"text-white font-semibold text-base md:text-lg"},"Mon compte",-1)),c("div",dU,[c("span",hU,oe(s.value||"Non défini"),1),c("button",{onClick:B[0]||(B[0]=Se=>w.value=!0),class:"text-indigo-400 hover:text-indigo-300 transition-colors p-1 hover:bg-indigo-400/10 rounded flex-shrink-0",title:"Modifier l'email","aria-label":"Modifier l'email"}," ✏️ ")]),v.value.length>0?(C(),N("div",fU,[c("button",{onClick:B[1]||(B[1]=Se=>v.value.length===1?$(v.value[0]):b.value=!0),class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-xs md:text-sm hover:bg-blue-500/30 transition-colors cursor-pointer",title:v.value.length===1?`Voir ${v.value[0].playerName}`:"Gérer mes joueurs"},[B[11]||(B[11]=c("span",{class:"text-blue-300"},"⭐",-1)),c("span",mU,oe(v.value.length===1?v.value[0].playerName:`${v.value.length} joueurs`),1)],8,pU)])):ae("",!0)])])])]),B[23]||(B[23]=c("div",{class:"border-t border-white/10 mb-4 md:mb-6"},null,-1)),c("div",gU,[c("div",vU,[B[15]||(B[15]=c("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[c("span",{class:"text-green-400"},"🔑"),ft(" Mot de passe ")],-1)),c("div",yU,[B[14]||(B[14]=c("p",{class:"text-xs md:text-sm text-gray-400 mb-3"},"Vous pouvez changer votre mot de passe pour sécuriser vos opérations sensibles.",-1)),c("button",{onClick:I,disabled:h.value,class:"w-full px-3 md:px-4 py-2 md:py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm"},oe(h.value?"⏳":"Changer de mot de passe"),9,_U),f.value?(C(),N("div",bU,oe(f.value),1)):ae("",!0),g.value?(C(),N("div",wU,oe(g.value),1)):ae("",!0)])]),c("div",xU,[B[17]||(B[17]=c("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[c("span",{class:"text-red-400"},"⚠️"),ft(" Suppression de compte ")],-1)),c("div",EU,[B[16]||(B[16]=c("p",{class:"text-xs md:text-sm text-gray-400 mb-3"},"Cette action est irréversible et supprimera définitivement votre compte.",-1)),c("button",{onClick:B[2]||(B[2]=Se=>se.$emit("delete-account")),class:"w-full px-3 md:px-4 py-2 md:py-3 rounded-lg bg-red-600 text-white hover:bg-red-500 text-sm"},"Supprimer mon compte")])]),x.value?(C(),N("div",IU,[c("div",TU,[B[18]||(B[18]=c("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[c("span",{class:"text-purple-400"},"🛠️"),ft(" Développement ")],-1)),c("button",{onClick:yt,class:"text-purple-400 hover:text-purple-300 transition-colors p-1 hover:bg-purple-400/10 rounded",title:re.value?"Réduire":"Développer"},oe(re.value?"▼":"▶"),9,AU)]),re.value?(C(),N("div",SU,[B[22]||(B[22]=c("p",{class:"text-xs text-purple-200 mb-2"},"Outils de développement et de test",-1)),c("div",PU,[B[19]||(B[19]=c("div",{class:"text-xs text-gray-400"},"Test de notification push",-1)),c("button",{onClick:D,disabled:M.value||!s.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},oe(M.value?"Envoi…":"Envoyer un test"),9,RU)]),c("div",{class:"flex items-center justify-between"},[B[20]||(B[20]=c("div",{class:"text-xs text-gray-400"},"Test de mise à jour PWA",-1)),c("button",{onClick:je,class:"px-3 py-1 rounded bg-blue-600 text-white text-xs hover:bg-blue-500 transition-colors"}," 🧪 Simuler maj ")]),c("div",{class:"flex items-center justify-between"},[B[21]||(B[21]=c("div",{class:"text-xs text-gray-400"},"Renvoyer la barre d'installation PWA",-1)),c("button",{onClick:Tt,class:"px-3 py-1 rounded bg-yellow-600 text-white text-xs hover:bg-yellow-500 transition-colors"}," 📱 Afficher install ")]),O.value?(C(),N("div",CU,"Notification test envoyée (vérifiez votre appareil)")):ae("",!0),A.value?(C(),N("div",kU,oe(A.value),1)):ae("",!0),j.value?(C(),N("div",DU,"FCM token: "+oe(j.value),1)):ae("",!0),c("div",NU,"VAPID: "+oe($r(de)||"indisponible"),1)])):ae("",!0)])):ae("",!0)]),c("div",{class:"mt-4 md:mt-6 text-center"},[c("button",{onClick:We,class:"px-4 md:px-6 py-2 md:py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 text-sm"},"Fermer")])]),w.value?(C(),N("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:B[7]||(B[7]=Se=>w.value=!1)},[c("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-md",onClick:B[6]||(B[6]=mt(()=>{},["stop"]))},[c("div",OU,[B[24]||(B[24]=c("h3",{class:"text-lg md:text-xl font-semibold text-white flex items-center gap-2"},[c("span",{class:"text-blue-400"},"📧"),ft(" Modifier l'email ")],-1)),c("button",{onClick:B[4]||(B[4]=Se=>w.value=!1),class:"text-white/80 hover:text-white"},"✖️")]),c("div",VU,[c("div",null,[B[25]||(B[25]=c("label",{class:"block text-xs text-gray-400 mb-2"},"Nouvelle adresse email",-1)),tt(c("input",{"onUpdate:modelValue":B[5]||(B[5]=Se=>i.value=Se),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white placeholder-gray-400 text-sm",placeholder:"nouvel@email.com"},null,512),[[Ut,i.value]])]),c("button",{onClick:k,disabled:!d.value||o.value,class:"w-full px-4 py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm"},oe(o.value?"⏳":"Mettre à jour"),9,MU),a.value?(C(),N("div",LU,oe(a.value),1)):ae("",!0),l.value?(C(),N("div",$U,oe(l.value),1)):ae("",!0)])])])):ae("",!0),b.value?(C(),N("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:B[10]||(B[10]=Se=>b.value=!1)},[c("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-lg",onClick:B[9]||(B[9]=mt(()=>{},["stop"]))},[c("div",FU,[c("h3",UU,[B[26]||(B[26]=c("span",{class:"text-yellow-400"},"⭐",-1)),ft(" "+oe(v.value.length<=1?"Mon joueur":"Mes joueurs"),1)]),c("button",{onClick:B[8]||(B[8]=Se=>b.value=!1),class:"text-white/80 hover:text-white"},"✖️")]),c("div",jU,[v.value.length===0?(C(),N("div",BU," Aucun joueur associé pour le moment. ")):(C(),N("div",qU,[(C(!0),N(xt,null,Lr(v.value,Se=>(C(),N("div",{key:T(Se),class:"flex items-center justify-between p-3 bg-gray-800/30 rounded-lg"},[c("div",zU,[B[27]||(B[27]=c("span",{class:"text-yellow-400 text-sm"},"⭐",-1)),c("div",HU,[c("div",KU,oe(Se.playerName||"—"),1),c("div",GU,oe(Se.seasonName||Se.seasonId||"—"),1)])]),c("button",{onClick:ne=>U(Se),class:"p-1.5 rounded bg-red-600/20 text-red-400 hover:bg-red-600/30 hover:text-red-300 transition-colors duration-200 flex-shrink-0",title:"Dissocier ce joueur","aria-label":"Dissocier ce joueur"}," 🗑️ ",8,WU)]))),128))]))])])])):ae("",!0)])):ae("",!0)}},zb="/logos/hatcast-logo-desktop.png",QU={key:0,class:"w-10 h-10 bg-gray-600 animate-pulse rounded-full"},JU=["aria-expanded"],qm={__name:"AccountDropdown",props:{isConnected:{type:Boolean,default:!1},buttonClass:{type:String,default:"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700"}},emits:["open-account-menu","open-help","open-notifications","logout","open-login"],setup(n,{emit:e}){const t=n,r=e,s=S(!1),i=S(!0),o=S(null),a=S({});Nt(()=>t.isConnected,x=>{i.value=!1},{immediate:!0}),Sn(()=>{i.value=!1});function l(){r("open-login")}function d(){s.value=!s.value,s.value&&Bt(()=>h())}function h(){if(o.value){const x=o.value.getBoundingClientRect();a.value={top:`${x.bottom+8}px`,right:`${window.innerWidth-x.right}px`}}}function f(){s.value=!1,r("open-account-menu")}function g(){s.value=!1,r("open-help")}function v(){s.value=!1,r("open-notifications")}async function w(){s.value=!1;try{await $e.signOut(),r("logout")}catch(x){console.error("Erreur lors de la déconnexion:",x)}}function b(){s.value=!1}return Sn(()=>{document.addEventListener("click",b),window.addEventListener("resize",h),window.addEventListener("scroll",h,{passive:!0})}),ei(()=>{document.removeEventListener("click",b),window.removeEventListener("resize",h),window.removeEventListener("scroll",h)}),(x,M)=>(C(),N("div",{class:"relative",onClick:M[0]||(M[0]=mt(()=>{},["stop"]))},[i.value?(C(),N("div",QU)):n.isConnected?(C(),N("button",{key:2,onClick:d,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Mon compte","aria-label":"Mon compte","aria-expanded":s.value,"aria-haspopup":"true",ref_key:"dropdownButton",ref:o},M[2]||(M[2]=[c("span",{class:"text-2xl"},"👤",-1)]),8,JU)):(C(),N("button",{key:1,onClick:l,class:Qt(["px-2.5 py-1 md:px-4 md:py-2 text-xs md:text-base rounded-lg transition-all duration-300 border transition-colors",n.buttonClass])},M[1]||(M[1]=[c("span",{class:"md:hidden text-lg",title:"Se connecter"},"🔑",-1),c("span",{class:"hidden md:inline"},"Connexion",-1)]),2)),(C(),ti(ec,{to:"body"},[s.value&&n.isConnected?(C(),N("div",{key:0,class:"fixed w-auto min-w-[180px] max-w-[200px] md:min-w-[200px] md:max-w-[240px] bg-gray-900 border border-white/20 rounded-lg shadow-xl py-1 z-[9999]",style:Mr(a.value),role:"menu"},[c("button",{onClick:f,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},M[3]||(M[3]=[c("span",{class:"text-base md:text-lg flex-shrink-0"},"👤",-1),c("span",{class:"truncate"},"Mon compte",-1)])),c("button",{onClick:v,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},M[4]||(M[4]=[c("span",{class:"text-base md:text-lg flex-shrink-0"},"🔔",-1),c("span",{class:"truncate"},"Notifications",-1)])),c("button",{onClick:g,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},M[5]||(M[5]=[c("span",{class:"text-base md:text-lg flex-shrink-0"},"❓",-1),c("span",{class:"truncate"},"Aide",-1)])),M[7]||(M[7]=c("div",{class:"border-t border-white/10 my-1"},null,-1)),c("button",{onClick:w,class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},M[6]||(M[6]=[c("span",{class:"text-base md:text-lg flex-shrink-0"},"🚪",-1),c("span",{class:"truncate"},"Se déconnecter",-1)]))],4)):ae("",!0)]))]))}},YU={class:"container mx-auto px-4 py-4"},XU={class:"flex items-center justify-between"},ZU={class:"flex items-center"},e6={href:"/",class:"flex items-center"},t6={class:"relative w-48 h-12 md:w-56 md:h-14"},n6={class:"flex items-center gap-2"},r6={__name:"AppHeader",props:{isScrolled:{type:Boolean,default:!1}},emits:["open-account-menu","open-help","open-notifications","open-players","logout","open-login"],setup(n,{emit:e}){const t=n,r=e,s=_o(),i=He(()=>t.isScrolled?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700":"bg-white/10 hover:bg-white/20 text-white border-white/20 hover:border-white/40");Nt(()=>s.path,()=>{wl(),setTimeout(()=>{wl()},100)},{immediate:!0}),ei(()=>{window._appHeaderUnsubscribe&&(window._appHeaderUnsubscribe(),delete window._appHeaderUnsubscribe)});function o(){r("open-account-menu")}function a(){r("open-help")}function l(){r("open-notifications")}function d(){r("open-players")}function h(){r("logout")}function f(){r("open-login")}return(g,v)=>(C(),N("header",{class:Qt(["fixed top-0 left-0 right-0 z-50 transition-all duration-300",n.isScrolled?"bg-white/95 backdrop-blur-md border-b border-gray-200/50 shadow-lg":"bg-transparent"])},[c("nav",YU,[c("div",XU,[c("div",ZU,[c("a",e6,[c("div",t6,[n.isScrolled?(C(),N(xt,{key:1},[v[2]||(v[2]=c("img",{src:Fm,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 md:hidden"},null,-1)),v[3]||(v[3]=c("img",{src:zb,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 hidden md:block"},null,-1))],64)):(C(),N(xt,{key:0},[v[0]||(v[0]=c("img",{src:Fm,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 md:hidden brightness-0 invert"},null,-1)),v[1]||(v[1]=c("img",{src:zb,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 hidden md:block brightness-0 invert"},null,-1))],64))])])]),c("div",n6,[Be(qm,{"is-connected":$r(nF),"button-class":i.value,onOpenAccountMenu:o,onOpenHelp:a,onOpenNotifications:l,onOpenPlayers:d,onLogout:h,onOpenLogin:f},null,8,["is-connected","button-class"]),sP(g.$slots,"actions")])])])],2))}},s6={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},i6={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-2xl"},o6={class:"flex border-b border-white/10 mb-6"},a6={class:"space-y-6"},l6={key:0,class:"space-y-4"},u6={class:"p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},c6={class:"space-y-3"},d6={class:"flex items-center justify-between"},h6={class:"flex items-center gap-2"},f6={class:"flex items-center justify-between"},p6={class:"flex items-center gap-2"},m6={class:"p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},g6={class:"space-y-3 opacity-50"},v6={class:"flex items-center justify-between"},y6={class:"flex items-center gap-2 cursor-not-allowed"},_6={class:"flex items-center justify-between"},b6={class:"flex items-center gap-2 cursor-not-allowed"},w6={key:1,class:"space-y-4"},x6={class:"p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},E6={class:"flex items-center justify-between mb-3"},I6=["disabled"],T6={key:1,class:"inline-flex items-center text-xs text-gray-300"},A6={key:0,class:"text-xs text-gray-400 italic"},S6={class:"p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},P6={class:"space-y-3"},R6={class:"flex items-center justify-between"},C6={class:"flex items-center gap-2"},k6=["disabled"],D6={class:"flex items-center justify-between"},N6={class:"flex items-center gap-2"},O6=["disabled"],V6={class:"p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},M6={class:"space-y-3 opacity-50"},L6={class:"flex items-center justify-between"},$6={class:"flex items-center gap-2 cursor-not-allowed"},F6={class:"flex items-center justify-between"},U6={class:"flex items-center gap-2 cursor-not-allowed"},j6={key:0,class:"mt-4 text-xs text-red-300"},B6={key:1,class:"mt-4 text-xs text-green-300"},q6={class:"mt-6 flex justify-between items-center"},z6=["disabled"],p1={__name:"NotificationsModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S({notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0,notifyReminder7Days:!0,notifyReminder1Day:!0,notifyReminder7DaysPush:!0,notifyReminder1DayPush:!0}),o=S(!1),a=S(""),l=S(""),d=S(!1),h=S(localStorage.getItem("fcmToken")||""),f=S(!1),g=S("email");function v(O){const{active:A,token:j}=O.detail;A&&j?(h.value=j,f.value=!0,localStorage.setItem("fcmToken",j),console.log("Notifications push réactivées automatiquement")):(f.value=!1,h.value="",localStorage.removeItem("fcmToken"),console.log("Notifications push désactivées"))}async function w(){try{if(!s.value)return;const O=ye(ee,"userPreferences",s.value),A=await Mt(O);if(A.exists()){const j=A.data()||{};i.value.notifyAvailability=j.notifyAvailability!==!1,i.value.notifySelection=j.notifySelection!==!1,i.value.notifySelectionPush=j.notifySelectionPush!==!1,i.value.notifyAvailabilityPush=j.notifyAvailabilityPush!==!1,i.value.notifyReminder7Days=j.notifyReminder7Days!==!1,i.value.notifyReminder1Day=j.notifyReminder1Day!==!1,i.value.notifyReminder7DaysPush=j.notifyReminder7DaysPush!==!1,i.value.notifyReminder1DayPush=j.notifyReminder1DayPush!==!1}else i.value={notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0,notifyReminder7Days:!0,notifyReminder1Day:!0,notifyReminder7DaysPush:!0,notifyReminder1DayPush:!0}}catch{}}async function b(){try{if(d.value=!0,!await Zv()){a.value="Push non supporté sur cet appareil";return}const A=await Vh();A.active?(h.value=A.token,f.value=!0,localStorage.setItem("fcmToken",A.token),console.log("Notifications push activées avec succès")):a.value=`Activation impossible: ${A.error}`}catch(O){const A=typeof Notification<"u"?Notification.permission:"unknown",j=O&&(O.message||O.code)?` (${O.message||O.code})`:"";testPushError.value=`Activation impossible – permission: ${A}${j}`}finally{d.value=!1}}async function x(){if(s.value){o.value=!0,a.value="",l.value="";try{const O=ye(ee,"userPreferences",s.value);await en(O,{...i.value},{merge:!0}),l.value="Préférences sauvegardées"}catch{a.value="Impossible de sauvegarder vos préférences"}finally{o.value=!1}}}function M(){r("close")}return Nt(()=>t.show,O=>{O&&w()}),Sn(()=>{var O;try{s.value=((O=$e==null?void 0:$e.currentUser)==null?void 0:O.email)||"",f.value=typeof Notification<"u"&&Notification.permission==="granted"&&!!localStorage.getItem("fcmToken"),k$(),window.addEventListener("push-status-changed",v),Vh().then(A=>{A.active&&(h.value=A.token,f.value=!0,localStorage.setItem("fcmToken",A.token))})}catch{}t.show&&w()}),ei(()=>{window.removeEventListener("push-status-changed",v)}),(O,A)=>n.show?(C(),N("div",s6,[c("div",i6,[c("div",{class:"flex items-center justify-between mb-6"},[A[10]||(A[10]=c("h2",{class:"text-2xl font-bold text-white"},"🔔 Préférences de notifications",-1)),c("button",{onClick:M,class:"text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️")]),c("div",o6,[c("button",{onClick:A[0]||(A[0]=j=>g.value="email"),class:Qt(["px-4 py-2 text-sm font-medium transition-colors duration-200",g.value==="email"?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-white"])}," 📧 Emails ",2),c("button",{onClick:A[1]||(A[1]=j=>g.value="mobile"),class:Qt(["px-4 py-2 text-sm font-medium transition-colors duration-200",g.value==="mobile"?"text-emerald-400 border-b-2 border-emerald-400":"text-gray-400 hover:text-white"])}," 📱 Mobile ",2)]),c("div",a6,[g.value==="email"?(C(),N("div",l6,[c("div",u6,[A[13]||(A[13]=c("h4",{class:"text-sm font-medium text-gray-300 mb-3"},"Spectacles",-1)),c("div",c6,[c("div",d6,[c("label",h6,[tt(c("input",{type:"checkbox","onUpdate:modelValue":A[2]||(A[2]=j=>i.value.notifyAvailability=j),class:"w-4 h-4"},null,512),[[Wr,i.value.notifyAvailability]]),A[11]||(A[11]=c("span",{class:"text-sm text-white"},"M'envoyer un email lorsqu'un spectacle a besoin de joueurs",-1))])]),c("div",f6,[c("label",p6,[tt(c("input",{type:"checkbox","onUpdate:modelValue":A[3]||(A[3]=j=>i.value.notifySelection=j),class:"w-4 h-4"},null,512),[[Wr,i.value.notifySelection]]),A[12]||(A[12]=c("span",{class:"text-sm text-white"},"M'envoyer un email lorsque je suis concerné par une sélection",-1))])])])]),c("div",m6,[A[16]||(A[16]=c("h4",{class:"text-sm font-medium text-gray-300 mb-3"},"Rappels automatiques",-1)),A[17]||(A[17]=c("p",{class:"text-xs text-gray-400 italic mb-3"},"🚧 Bientôt disponible",-1)),c("div",g6,[c("div",v6,[c("label",y6,[tt(c("input",{type:"checkbox","onUpdate:modelValue":A[4]||(A[4]=j=>i.value.notifyReminder7Days=j),disabled:"",class:"w-4 h-4 cursor-not-allowed"},null,512),[[Wr,i.value.notifyReminder7Days]]),A[14]||(A[14]=c("span",{class:"text-sm text-gray-400"},"Rappel automatique 7 jours avant un spectacle",-1))])]),c("div",_6,[c("label",b6,[tt(c("input",{type:"checkbox","onUpdate:modelValue":A[5]||(A[5]=j=>i.value.notifyReminder1Day=j),disabled:"",class:"w-4 h-4 cursor-not-allowed"},null,512),[[Wr,i.value.notifyReminder1Day]]),A[15]||(A[15]=c("span",{class:"text-sm text-gray-400"},"Rappel automatique 1 jour avant un spectacle",-1))])])])])])):ae("",!0),g.value==="mobile"?(C(),N("div",w6,[A[26]||(A[26]=c("div",{class:"p-3 rounded-lg border border-orange-500/30 bg-orange-500/10"},[c("div",{class:"flex items-center gap-2 text-sm text-orange-300"},[c("span",null,"⚠️"),c("span",null,"Les notifications mobiles sont encore expérimentales")])],-1)),c("div",x6,[A[20]||(A[20]=c("h4",{class:"text-sm font-medium text-gray-300 mb-3"},"Notifications sur cet appareil",-1)),c("div",E6,[A[19]||(A[19]=c("span",{class:"text-sm text-white"},"Statut",-1)),f.value?(C(),N("span",T6,A[18]||(A[18]=[c("span",{class:"mr-1 text-emerald-400"},"✓",-1),ft(" Actif ")]))):(C(),N("button",{key:0,onClick:b,disabled:d.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},oe(d.value?"...":"Activer"),9,I6))]),f.value?ae("",!0):(C(),N("div",A6," ⚠️ Ces préférences sont désactivées car les notifications de l'application ne sont pas actives sur cet appareil "))]),c("div",S6,[A[21]||(A[21]=c("h4",{class:"text-sm font-medium text-gray-300 mb-3"},"Spectacles",-1)),c("div",P6,[c("div",R6,[c("label",C6,[tt(c("input",{type:"checkbox","onUpdate:modelValue":A[6]||(A[6]=j=>i.value.notifySelectionPush=j),disabled:!f.value,class:"w-4 h-4"},null,8,k6),[[Wr,i.value.notifySelectionPush]]),c("span",{class:Qt(["text-sm text-white",{"text-gray-400":!f.value}])},"Me notifier lorsque je suis concerné par une sélection",2)])]),c("div",D6,[c("label",N6,[tt(c("input",{type:"checkbox","onUpdate:modelValue":A[7]||(A[7]=j=>i.value.notifyAvailabilityPush=j),disabled:!f.value,class:"w-4 h-4"},null,8,O6),[[Wr,i.value.notifyAvailabilityPush]]),c("span",{class:Qt(["text-sm text-white",{"text-gray-400":!f.value}])},"Me notifier lorsqu'un spectacle a besoin de joueurs",2)])])])]),c("div",V6,[A[24]||(A[24]=c("h4",{class:"text-sm font-medium text-gray-300 mb-3"},"Rappels automatiques",-1)),A[25]||(A[25]=c("p",{class:"text-xs text-gray-400 italic mb-3"},"🚧 Bientôt disponible",-1)),c("div",M6,[c("div",L6,[c("label",$6,[tt(c("input",{type:"checkbox","onUpdate:modelValue":A[8]||(A[8]=j=>i.value.notifyReminder7DaysPush=j),disabled:"",class:"w-4 h-4 cursor-not-allowed"},null,512),[[Wr,i.value.notifyReminder7DaysPush]]),A[22]||(A[22]=c("span",{class:"text-sm text-gray-400"},"Rappel 7 jours avant (notifications)",-1))])]),c("div",F6,[c("label",U6,[tt(c("input",{type:"checkbox","onUpdate:modelValue":A[9]||(A[9]=j=>i.value.notifyReminder1DayPush=j),disabled:"",class:"w-4 h-4 cursor-not-allowed"},null,512),[[Wr,i.value.notifyReminder1DayPush]]),A[23]||(A[23]=c("span",{class:"text-sm text-gray-400"},"Rappel 1 jour avant (notifications)",-1))])])])])])):ae("",!0)]),a.value?(C(),N("div",j6,oe(a.value),1)):ae("",!0),l.value?(C(),N("div",B6,oe(l.value),1)):ae("",!0),c("div",q6,[c("button",{onClick:x,disabled:o.value,class:"px-4 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-500 disabled:opacity-50"},oe(o.value?"⏳":"Sauvegarder"),9,z6),c("button",{onClick:M,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"}," Fermer ")])])])):ae("",!0)}},H6={class:"space-y-3"},K6={key:0,class:"text-sm text-gray-400"},G6={key:1,class:"space-y-2"},W6={class:"flex items-center justify-between gap-3"},Q6={class:"truncate"},J6={class:"text-white font-semibold"},Y6={class:"text-gray-400 text-xs"},X6=["onClick"],m1={__name:"PlayersModal",props:{show:{type:Boolean,default:!1}},emits:["close","manage-player"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S([]);function o(h){return`${h.seasonId||"global"}__${h.playerId}`}async function a(){var h;try{s.value=((h=$e==null?void 0:$e.currentUser)==null?void 0:h.email)||""}catch{}try{const f=s.value?await qf(s.value):[],g=[];for(const v of f){let w=v.playerId;try{if(v.seasonId){const b=ye(ee,"seasons",v.seasonId,"players",v.playerId),x=await Mt(b);x.exists()&&(w=x.data().name||w)}}catch{}g.push({...v,playerName:w})}i.value=g}catch{i.value=[]}}function l(h){r("manage-player",h),d()}function d(){r("close")}return Nt(()=>t.show,h=>{h&&a()}),Sn(()=>{t.show&&a()}),(h,f)=>n.show?(C(),N("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:d},[c("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:f[0]||(f[0]=mt(()=>{},["stop"]))},[c("button",{onClick:d,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),f[2]||(f[2]=_r('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👥</span></div><h2 class="text-2xl font-bold text-white mb-1">Mes joueurs</h2><p class="text-sm text-gray-300">Gérez vos associations de joueurs</p></div>',1)),c("div",H6,[f[1]||(f[1]=c("h3",{class:"text-white font-semibold mb-2"},"Mes joueurs associés",-1)),i.value.length===0?(C(),N("div",K6,"Aucun joueur associé pour le moment.")):(C(),N("ul",G6,[(C(!0),N(xt,null,Lr(i.value,g=>(C(),N("li",{key:o(g),class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},[c("div",W6,[c("div",Q6,[c("div",J6,oe(g.seasonName||g.seasonId||"—"),1),c("div",Y6,"Joueur : "+oe(g.playerName||"—"),1)]),c("button",{onClick:v=>l(g),class:"px-3 py-2 rounded-lg bg-gray-700 text-white hover:bg-gray-600 text-xs"},"Gérer",8,X6)])]))),128))]))]),c("div",{class:"mt-6 text-center"},[c("button",{onClick:d,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):ae("",!0)}};function Z6({reason:n,recipientName:e,eventTitle:t,eventDate:r,urls:s={},prefs:i={},extra:o={}}){var l,d;const a={email:null,push:null};if(n==="availability_request"||n==="availability_reminder"){const h=(i==null?void 0:i.notifyAvailability)!==!1,f=(i==null?void 0:i.notifyAvailabilityPush)!==!1;a.email={enabled:h,subject:n==="availability_reminder"?`Rappel disponibilité · ${t} (${r})`:`Disponibilité demandée · ${t} (${r})`},a.push={enabled:f,title:n==="availability_reminder"?"⏰ Rappel disponibilité":"🎯 Nouveau spectacle !",body:n==="availability_reminder"?`${e}, ${t} (${r})`:`🎭 On a besoin de toi pour ${t} le ${r} !`,data:{url:s.eventUrl,yesUrl:s.yesUrl,noUrl:s.noUrl,reason:n}},console.log("URLs pour notifications de disponibilité:",{eventUrl:s.eventUrl,yesUrl:s.yesUrl,noUrl:s.noUrl,urls:s})}if(n==="selection"){const h=(i==null?void 0:i.notifySelection)!==!1,f=(i==null?void 0:i.notifySelectionPush)!==!1;a.email={enabled:h,subject:`🎭 Equipe pour ${t}`},a.push={enabled:f,title:"🎭 Tu es sélectionné(e) !",body:`🕺 Prépares-toi à briller pour ${t} le ${r}!`,data:{url:s.eventUrl,noUrl:s.noUrl,reason:n}},console.log("URLs pour notifications de sélection:",{eventUrl:s.eventUrl,noUrl:s.noUrl,urls:s})}if(n==="reminder_7days"||n==="reminder_1day"){const h=n==="reminder_7days"?(i==null?void 0:i.notifyReminder7Days)!==!1:(i==null?void 0:i.notifyReminder1Day)!==!1,f=n==="reminder_7days"?(i==null?void 0:i.notifyReminder7DaysPush)!==!1:(i==null?void 0:i.notifyReminder1DayPush)!==!1,g=n==="reminder_7days",v=g?"7 jours":"1 jour",w=g?"📅":"⏰";a.email={enabled:h,subject:`${w} Rappel : ${t} dans ${v}`},a.push={enabled:f,title:`${w} Rappel spectacle`,body:`${e}, ${t} dans ${v} ! Es-tu prêt(e) ?`,data:{url:s.eventUrl,noUrl:s.noUrl,reason:n,reminderType:n,eventId:o.eventId,seasonId:o.seasonId}},console.log("URLs pour notifications de rappel:",{eventUrl:s.eventUrl,noUrl:s.noUrl,reason:n,reminderType:n})}return console.log("buildNotificationPayloads",{reason:n,recipientName:e,prefs:i,payloads:a,emailEnabled:(l=a.email)==null?void 0:l.enabled,pushEnabled:(d=a.push)==null?void 0:d.enabled}),a}async function e5({reason:n,recipientEmail:e,recipientName:t,eventTitle:r,eventDate:s,urls:i={},extra:o={}}){if(!e)return{success:!1,skipped:!0,reason:"missing_email"};const a=await Mt(ye(ee,"userPreferences",e)).catch(()=>null),l=a!=null&&a.exists()?a.data():{},d=Z6({reason:n,recipientName:t,eventTitle:r,eventDate:s,urls:i,prefs:l,extra:o}),h=[];return d.email&&d.email.enabled&&(n==="availability_request"||n==="availability_reminder"?await JF({toEmail:e,playerName:t,eventTitle:r,eventDate:s,yesUrl:i.yesUrl,noUrl:i.noUrl,eventUrl:i.eventUrl,reason:n==="availability_reminder"?"reminder":"new_event"}).then(()=>h.push({channel:"email",success:!0})).catch(g=>{L.error("notifyRecipientAcrossChannels email error",g),h.push({channel:"email",success:!1})}):n==="selection"&&h.push({channel:"email",success:!0,skipped:!0,note:"batch_handled_elsewhere"})),d.push&&d.push.enabled&&await ed({toEmail:e,title:d.push.title,body:d.push.body,data:d.push.data||{},reason:n}).then(()=>{L.info("Notification push envoyée avec succès",{reason:n,recipientEmail:e}),h.push({channel:"push",success:!0})}).catch(g=>{L.error("notifyRecipientAcrossChannels push error",g),h.push({channel:"push",success:!1})}),{success:h.some(g=>g.success),results:h}}async function Hb({eventId:n,eventData:e,players:t,seasonId:r,seasonSlug:s,createMagicLink:i,reminder:o=!1,getAvailabilityForEvent:a=null}){const l=[],d=`${window.location.origin}/season/${s}/event/${n}`;for(const h of t)try{if(o&&typeof a=="function"){const v=await Promise.resolve(a(h.name,n));if(v===!0||v===!1)continue}const f={};if(typeof i=="function"){const v=await i({seasonId:r,playerId:h.id,eventId:n,action:"yes"}),w=await i({seasonId:r,playerId:h.id,eventId:n,action:"no"});f.yesUrl=`${v.url}&slug=${encodeURIComponent(s)}`,f.noUrl=`${w.url}&slug=${encodeURIComponent(s)}`}f.eventUrl=d,(await e5({reason:o?"availability_reminder":"availability_request",recipientEmail:h.email,recipientName:h.name,eventTitle:e.title,eventDate:t5(e.date),urls:f})).success||l.push(h.id)}catch{l.push(h.id)}return{success:!0,failures:l}}async function Kb(n){return eU(n)}function t5(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}async function g1({seasonId:n,eventId:e,playerEmail:t,playerName:r,eventTitle:s,eventDate:i,seasonSlug:o}){try{const a=new Date(i),l=new Date,d=new Date(a);d.setDate(a.getDate()-7);const h=new Date(a);h.setDate(a.getDate()-1);const f=[];a>l&&a.getTime()-l.getTime()<=7*24*60*60*1e3?f.push({type:"7days",scheduledFor:l,eventId:e,seasonId:n,playerEmail:t,playerName:r,eventTitle:s,eventDate:a,seasonSlug:o,status:"pending"}):d>l&&f.push({type:"7days",scheduledFor:d,eventId:e,seasonId:n,playerEmail:t,playerName:r,eventTitle:s,eventDate:a,seasonSlug:o,status:"pending"}),a>l&&a.getTime()-l.getTime()<=1*24*60*60*1e3?f.push({type:"1day",scheduledFor:l,eventId:e,seasonId:n,playerEmail:t,playerName:r,eventTitle:s,eventDate:a,seasonSlug:o,status:"pending"}):h>l&&f.push({type:"1day",scheduledFor:h,eventId:e,seasonId:n,playerEmail:t,playerName:r,eventTitle:s,eventDate:a,seasonSlug:o,status:"pending"});const g=[];for(const v of f)try{const w=await _i(Je(ee,"reminderQueue"),{...v,createdAt:yn(),updatedAt:yn()});g.push({success:!0,id:w.id,type:v.type}),L.info("Rappel créé avec succès",{reminderId:w.id,type:v.type,playerEmail:t}),console.log(`✅ Rappel ${v.type} créé:`,{id:w.id,playerEmail:t,eventTitle:v.eventTitle,scheduledFor:v.scheduledFor,eventDate:v.eventDate})}catch(w){L.error("Erreur lors de la création du rappel",{error:w,reminder:v}),g.push({success:!1,type:v.type,error:w.message})}return{success:!0,results:g}}catch(a){throw L.error("Erreur lors de la création des rappels",a),a}}async function v1({seasonId:n,eventId:e,playerEmail:t}){try{const r=mo(Je(ee,"reminderQueue"),Jr("seasonId","==",n),Jr("eventId","==",e),Jr("playerEmail","==",t)),s=await Dt(r),i=s.docs.map(o=>go(o.ref));return await Promise.all(i),L.info("Rappels supprimés pour le joueur",{seasonId:n,eventId:e,playerEmail:t,count:s.docs.length}),{success:!0,deletedCount:s.docs.length}}catch(r){throw L.error("Erreur lors de la suppression des rappels",r),r}}async function n5({seasonId:n,eventId:e}){try{const t=mo(Je(ee,"reminderQueue"),Jr("seasonId","==",n),Jr("eventId","==",e)),r=await Dt(t),s=r.docs.map(i=>go(i.ref));return await Promise.all(s),L.info("Rappels supprimés pour l'événement",{seasonId:n,eventId:e,count:r.docs.length}),{success:!0,deletedCount:r.docs.length}}catch(t){throw L.error("Erreur lors de la suppression des rappels de l'événement",t),t}}async function r5(n){try{const e=new Date(n);e.setHours(0,0,0,0);const t=new Date(n);t.setHours(23,59,59,999);const r=mo(Je(ee,"reminderQueue"),Jr("scheduledFor",">=",e),Jr("scheduledFor","<=",t),Jr("status","==","pending"));return(await Dt(r)).docs.map(i=>({id:i.id,...i.data()}))}catch(e){throw L.error("Erreur lors de la récupération des rappels en attente",e),e}}async function s5(n,e){try{await ye(ee,"reminderQueue",n).update({status:"processed",processedAt:yn(),result:e}),L.info("Rappel marqué comme traité",{reminderId:n,result:e})}catch(t){throw L.error("Erreur lors du marquage du rappel comme traité",t),t}}async function i5({seasonId:n,eventId:e,playerEmail:t,playerName:r,eventTitle:s,eventDate:i,seasonSlug:o}){try{const a=new Date,l=new Date(a.getTime()-24*60*60*1e3),d=[{type:"7days",scheduledFor:l,eventId:e,seasonId:n,playerEmail:t,playerName:r,eventTitle:s,eventDate:new Date(i),seasonSlug:o,status:"pending"},{type:"1day",scheduledFor:l,eventId:e,seasonId:n,playerEmail:t,playerName:r,eventTitle:s,eventDate:new Date(i),seasonSlug:o,status:"pending"}],h=[];for(const f of d)try{const g=await _i(Je(ee,"reminderQueue"),{...f,createdAt:yn(),updatedAt:yn()});h.push({success:!0,id:g.id,type:f.type}),L.info("Rappel de test créé avec succès",{reminderId:g.id,type:f.type,playerEmail:t})}catch(g){L.error("Erreur lors de la création du rappel de test",{error:g,reminder:f}),h.push({success:!1,type:f.type,error:g.message})}return{success:!0,results:h}}catch(a){throw L.error("Erreur lors de la création des rappels de test",a),a}}const o5=Object.freeze(Object.defineProperty({__proto__:null,createRemindersForSelection:g1,getPendingRemindersForDate:r5,markReminderProcessed:s5,removeRemindersForEvent:n5,removeRemindersForPlayer:v1,triggerRemindersForEvent:i5},Symbol.toStringTag,{value:"Module"}));let fr="mock",ro=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],xa=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function oy(n){fr=n}async function a5(){if(fr!=="firebase"||!(await Dt(Je(ee,"seasons"))).empty)return;const e=ye(Je(ee,"seasons"));await en(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:yn()});const t=await Dt(Je(ee,"players"));for(const o of t.docs)await en(ye(e,"players",o.id),o.data());const r=await Dt(Je(ee,"events"));for(const o of r.docs)await en(ye(e,"events",o.id),o.data());const s=await Dt(Je(ee,"availability"));for(const o of s.docs)await en(ye(e,"availability",o.id),o.data());const i=await Dt(Je(ee,"selections"));for(const o of i.docs)await en(ye(e,"selections",o.id),o.data())}async function y1(){fr==="firebase"&&await a5()}async function Uh(n=null){let e;return fr==="firebase"?n?e=(await Dt(Je(ee,"seasons",n,"events"))).docs.map(r=>({id:r.id,...r.data()})):e=(await Dt(Je(ee,"events"))).docs.map(r=>({id:r.id,...r.data()})):e=xa,e.sort((t,r)=>{const s=d=>{if(!d)return null;if(d instanceof Date)return d;if(typeof(d==null?void 0:d.toDate)=="function")return d.toDate();const h=new Date(d);return isNaN(h.getTime())?null:h},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,l=o?o.getTime():Number.POSITIVE_INFINITY;return a!==l?a-l:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function Ju(n=null){let e;return fr==="firebase"?n?e=(await Dt(Je(ee,"seasons",n,"players"))).docs.map(r=>({id:r.id,...r.data()})):e=(await Dt(Je(ee,"players"))).docs.map(r=>({id:r.id,...r.data()})):e=ro,e.sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function _1(n,e=null){if(fr==="firebase"){const t=ye(e?Je(ee,"seasons",e,"players"):Je(ee,"players"));return await en(t,{name:n}),t.id}else{const t=`p${ro.length+1}`;return ro.push({id:t,name:n}),t}}async function l5(n,e=null){if(fr==="firebase"){const t=e?ye(ee,"seasons",e,"players",n):ye(ee,"players",n);await go(t);const r=e?await Dt(Je(ee,"seasons",e,"availability")):await Dt(Je(ee,"availability")),s=xv(ee);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else ro=ro.filter(t=>t.id!==n)}async function u5(n,e,t=null){if(fr==="firebase"){const r=t?ye(ee,"seasons",t,"players",n):ye(ee,"players",n),s=await Mt(r),i=s.exists()&&s.data().name||null;if(await en(r,{name:e},{merge:!0}),i&&i!==e){const o=xv(ee);try{const a=t?ye(ee,"seasons",t,"availability",i):ye(ee,"availability",i),l=await Mt(a);if(l.exists()){const d=l.data()||{},h=t?ye(ee,"seasons",t,"availability",e):ye(ee,"availability",e);o.set(h,d,{merge:!0}),o.delete(a)}}catch{}try{const a=t?Je(ee,"seasons",t,"selections"):Je(ee,"selections");(await Dt(a)).forEach(d=>{var f;const h=Array.isArray((f=d.data())==null?void 0:f.players)?d.data().players:[];if(h.includes(i)){const g=h.map(v=>v===i?e:v);o.update(d.ref,{players:g})}})}catch{}await o.commit()}}else{const r=ro.findIndex(s=>s.id===n);r!==-1&&(ro[r]={...ro[r],name:e})}}async function Ko(n,e,t=null){if(fr==="firebase"){const r=t?await Dt(Je(ee,"seasons",t,"availability")):await Dt(Je(ee,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function Go(n=null){if(fr==="firebase"){const e=n?await Dt(Je(ee,"seasons",n,"selections")):await Dt(Je(ee,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function Gb(n,e,t=null){if(fr==="firebase"){const r=t?ye(ee,"seasons",t,"availability",n):ye(ee,"availability",n);await en(r,e)}}async function c5({seasonId:n,playerName:e,eventId:t,value:r}){if(fr!=="firebase")return;const s=n?ye(ee,"seasons",n,"availability",e):ye(ee,"availability",e),i=await Mt(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await en(s,a)}async function zm(n,e,t=null){console.log("🔍 saveSelection appelé:",{eventId:n,players:e,seasonId:t});try{if(fr==="firebase"){console.log("🔥 Mode Firebase activé");const r=t?ye(ee,"seasons",t,"selections",n):ye(ee,"selections",n);console.log("🔍 Référence sélection:",r.path),console.log("📖 Récupération ancienne sélection...");const s=await Mt(r);console.log("📄 Document récupéré:",{exists:s.exists,hasData:!!s.data(),data:s.data()});const i=s.exists&&s.data()?s.data().players||[]:[];console.log("🔍 Ancienne sélection:",i),console.log("🔍 Nouvelle sélection:",e),console.log("💾 Sauvegarde..."),await en(r,{players:e}),console.log("✅ Sélection sauvegardée avec succès");try{if(console.log("🔄 Début gestion des rappels automatiques"),t){console.log("📅 Récupération des infos événement et saison");const o=ye(ee,"seasons",t,"events",n),a=ye(ee,"seasons",t);console.log("🔍 Références:",{eventRef:o.path,seasonRef:a.path});const[l,d]=await Promise.all([Mt(o),Mt(a)]);if(console.log("📄 Documents récupérés:",{eventExists:l.exists,seasonExists:d.exists}),l.exists&&d.exists){const h=l.data(),f=d.data();console.log("📊 Données récupérées:",{eventTitle:h.title,eventDate:h.date,seasonSlug:f.slug});const g=i.filter(w=>!e.includes(w));console.log("🗑️ Joueurs à désélectionner:",g);for(const w of g)try{const{getPlayerEmail:b}=await dt(()=>Promise.resolve().then(()=>wa),void 0),x=await b(w,t);x&&await v1({seasonId:t,eventId:n,playerEmail:x})}catch(b){console.error("Erreur lors de la suppression des rappels pour",w,b)}const v=e.filter(w=>!i.includes(w));console.log("🆕 Nouveaux joueurs sélectionnés:",v);for(const w of v)try{console.log(`📧 Création rappels pour ${w}...`);const{getPlayerEmail:b}=await dt(()=>Promise.resolve().then(()=>wa),void 0),x=await b(w,t);if(console.log(`📧 Email pour ${w}:`,x?`✅ ${x}`:"❌ null"),x){console.log(`🎯 Création rappels pour ${w} (${x})`);const M=await g1({seasonId:t,eventId:n,playerEmail:x,playerName:w,eventTitle:h.title,eventDate:h.date,seasonSlug:f.slug});console.log(`✅ Rappels créés pour ${w}:`,M)}else console.log(`⚠️ Pas d'email pour ${w}, rappels non créés`)}catch(b){console.error(`❌ Erreur lors de la création des rappels pour ${w}:`,b)}}}}catch(o){console.error("Erreur lors de la gestion des rappels automatiques:",o)}}else console.log("🎭 Mode mock activé");console.log("✅ saveSelection terminé avec succès")}catch(r){throw console.error("❌ Erreur dans saveSelection:",r),r}}async function d5(n,e=null){if(L.info("Suppression de l'événement",{eventId:n}),fr==="firebase")try{L.debug("Suppression de l'événement dans Firestore");const t=e?ye(ee,"seasons",e,"events",n):ye(ee,"events",n);await go(t),L.debug("Suppression de la sélection associée");const r=e?ye(ee,"seasons",e,"selections",n):ye(ee,"selections",n);await go(r),L.debug("Suppression des disponibilités");const s=e?await Dt(Je(ee,"seasons",e,"availability")):await Dt(Je(ee,"availability")),i=xv(ee);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){L.debug("Mise à jour de la disponibilité pour un joueur");const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),L.info("Opérations de suppression terminées avec succès")}catch(t){throw L.error("Erreur lors de la suppression",t),t}else xa=xa.filter(t=>t.id!==n)}async function h5(n,e=null){if(fr==="firebase"){const t=ye(e?Je(ee,"seasons",e,"events"):Je(ee,"events"));return await en(t,n),t.id}else{const t=`event${xa.length+1}`;return xa.push({id:t,...n}),t}}async function Wb(n,e,t=null){if(fr==="firebase"){const r=t?ye(ee,"seasons",t,"events",n):ye(ee,"events",n);await en(r,e,{merge:!0})}else{const r=xa.findIndex(s=>s.id===n);r!==-1&&(xa[r]={id:n,...e})}}const f5={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},p5={class:"hero-section relative overflow-hidden pt-24"},m5={class:"hero-content py-16 md:py-24 px-4 relative z-10"},g5={class:"container mx-auto"},v5={class:"grid grid-cols-1 lg:grid-cols-2 gap-16 lg:gap-24 items-center"},y5={class:"text-center lg:text-left order-1 lg:order-2"},_5={class:"hero-cta mb-10"},b5={class:"flex flex-col sm:flex-row gap-4 items-center justify-center"},w5={class:"seasons-section py-16"},x5={class:"container mx-auto px-4"},E5=["aria-busy"],I5={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center animate-pulse"},T5={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center"},A5=["onClick"],S5={class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg overflow-hidden"},P5=["src","alt"],R5={key:1,class:"text-2xl"},C5={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},k5={key:0,class:"text-gray-300 text-sm mb-4 line-clamp-2 leading-relaxed"},D5={class:"flex justify-center gap-6 text-sm"},N5={class:"text-center"},O5={class:"text-white font-semibold"},V5={class:"text-center"},M5={class:"text-white font-semibold"},L5={class:"absolute top-4 right-4"},$5=["onClick","aria-expanded"],F5={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},U5=["onClick"],j5=["onClick"],B5=["onClick"],q5=["onClick"],z5=["onClick"],H5={class:"text-center mt-12"},K5={key:2,class:"text-center py-16"},G5={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},W5={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},Q5={class:"mb-6"},J5={class:"mb-6"},Y5={class:"mb-6"},X5={class:"mb-6"},Z5={class:"flex justify-end space-x-3"},ej=["disabled"],tj={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},nj={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},rj={class:"text-center mb-6"},sj={class:"text-gray-300"},ij={key:2,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},oj={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},aj={class:"text-center mb-6"},lj={class:"text-gray-300"},uj={class:"mb-6"},cj={class:"mb-6"},dj={class:"mb-6"},hj={key:0,class:"mb-4 text-center"},fj={class:"w-20 h-20 mx-auto mb-3 rounded-full overflow-hidden border-2 border-white/20"},pj=["src","alt"],mj=["disabled"],gj={key:0,class:"text-2xl mb-2 animate-spin"},vj={key:1,class:"text-2xl mb-2"},yj={class:"text-sm"},_j={key:0},bj={key:1},wj={key:2},xj={key:2,class:"text-xs text-gray-400 mt-1"},Ej={class:"flex justify-end space-x-3"},Ij=["disabled"],Tj={key:0,class:"flex items-center gap-2"},Aj={key:1},Sj={__name:"Seasons",setup(n){const e=S([]),t=S(!0),r=Ea(),s=S(null),i=S(!1),o=S(!1),a=S(!1),l=S(""),d=S(""),h=S(""),f=S(""),g=S(""),v=S(""),w=S(null),b=S(""),x=S(null),M=S(null),O=S(!1),A=S(!1),j=S(null),de=S(""),re=S(!1),k=S(!1),I=S(!1),T=S(!1),V=S(!1);Sn(async()=>{var z,we;try{L.info("Début du chargement des saisons"),oy("firebase"),L.info("Mode de stockage défini sur Firebase"),await y1(),L.info("Stockage initialisé"),L.info("Attente de l'initialisation du service d'authentification...");try{sF(),await KA(),L.info("Service d'authentification initialisé")}catch(ze){L.warn("Service d'authentification non initialisé, continuation sans authentification:",ze.message||"Erreur inconnue")}try{wl(),L.info("Synchronisation forcée effectuée")}catch(ze){L.warn("Erreur lors de la synchronisation forcée:",ze)}L.info("Chargement des saisons...");try{e.value=await ol(),L.info("Saisons chargées",{count:((z=e.value)==null?void 0:z.length)||0})}catch(ze){throw L.error("Erreur lors du chargement des saisons:",ze),ze}if(e.value.length>0){L.info("Chargement des données des saisons...");const ze=await Promise.all(e.value.map(async Ye=>{try{L.debug(`Chargement des données pour la saison: ${Ye.name} (ID: ${Ye.id})`);let ut,pt;try{ut=await Uh(Ye.id),L.debug(`Événements chargés pour ${Ye.name}:`,ut)}catch(Pt){L.warn(`Erreur lors du chargement des événements pour ${Ye.name}:`,Pt),ut=[]}try{pt=await Ju(Ye.id),L.debug(`Joueurs chargés pour ${Ye.name}:`,pt)}catch(Pt){L.warn(`Erreur lors du chargement des joueurs pour ${Ye.name}:`,Pt),pt=[]}return L.debug(`Saison ${Ye.name}: ${(ut==null?void 0:ut.length)||0} événements, ${(pt==null?void 0:pt.length)||0} joueurs`),{...Ye,events:ut||[],players:pt||[]}}catch(ut){return L.warn(`Erreur lors du chargement des données pour la saison ${Ye.id}:`,ut),{...Ye,events:[],players:[]}}}));e.value=ze,L.info("Données des saisons chargées",{count:e.value.length}),e.value.forEach(Ye=>{var ut,pt;L.info(`Saison finale ${Ye.name}: ${((ut=Ye.events)==null?void 0:ut.length)||0} événements, ${((pt=Ye.players)==null?void 0:pt.length)||0} joueurs`)})}De().catch(ze=>L.error("Migration sortOrder échouée",ze))}catch(ze){L.error("Erreur lors du chargement initial des saisons:",ze),L.error("Stack trace:",ze.stack);try{L.info("Tentative de fallback pour charger les saisons..."),e.value=await ol(),L.info("Saisons chargées en fallback",{count:((we=e.value)==null?void 0:we.length)||0})}catch(Ye){L.error("Échec du fallback pour charger les saisons:",Ye)}}finally{t.value=!1,L.info("Chargement terminé, isLoading = false")}const ue=()=>{V.value=window.scrollY>10};return window.addEventListener("scroll",ue,{passive:!0}),()=>{window.removeEventListener("scroll",ue)}});const U=He(()=>[...e.value].sort((ue,z)=>{var pt,Pt;const we=typeof ue.sortOrder=="number"?ue.sortOrder:Number.MAX_SAFE_INTEGER,ze=typeof z.sortOrder=="number"?z.sortOrder:Number.MAX_SAFE_INTEGER;if(we!==ze)return we-ze;const Ye=(pt=ue.createdAt)!=null&&pt.toMillis?ue.createdAt.toMillis():0,ut=(Pt=z.createdAt)!=null&&Pt.toMillis?z.createdAt.toMillis():0;return Ye!==ut?ut-Ye:(ue.name||"").localeCompare(z.name||"")}));function $(ue){r.push(`/season/${ue}`)}function D(ue){s.value=s.value===ue?null:ue}function je(){s.value=null}function Tt(ue){M.value=ue,g.value=ue.name,v.value=ue.description||"",w.value=null,b.value=ue.logoUrl||"",a.value=!0,je()}function yt(){a.value=!1,M.value=null,g.value="",v.value="",w.value=null,b.value="",O.value=!1}async function We(){a.value=!1,await pe({type:"editSeason",data:{seasonId:M.value.id,seasonName:M.value.name,newName:g.value.trim(),newDescription:v.value.trim(),newLogo:w.value,newLogoPreview:b.value,oldName:M.value.name,oldDescription:M.value.description||"",oldLogoUrl:M.value.logoUrl||""}})}function se(){const ue=document.querySelector(".help-section");ue&&ue.scrollIntoView({behavior:"smooth"})}function B(){const ue=document.querySelector(".seasons-section");ue&&ue.scrollIntoView({behavior:"smooth"})}function Se(ue){const z=ue.target.files[0];if(z){w.value=z,O.value=!0;const we=new FileReader;we.onload=ze=>{b.value=ze.target.result,O.value=!1},we.onerror=()=>{O.value=!1},we.readAsDataURL(z)}}function ne(){console.log("removeLogo appelé"),w.value=null,b.value="",console.log("Logo supprimé")}function te(){const ue=document.querySelector('input[type="file"][accept="image/*"]');ue?ue.click():console.error("Input file non trouvé pour triggerLogoUpload")}async function De(){if(!e.value.length)return;const ue=e.value.map(we=>typeof we.sortOrder=="number"?we.sortOrder:null).filter(we=>we!==null);let z=ue.length?Math.max(...ue):0;for(const we of e.value)if(typeof we.sortOrder!="number"){z+=1;try{await Iu(we.id,z),we.sortOrder=z}catch(ze){L.error("Erreur migration sortOrder",{seasonName:we==null?void 0:we.name,error:ze})}}}async function gt(ue){try{if(!(ue!=null&&ue.id)){alert("Saison introuvable");return}const[z,we]=await Promise.all([Uh(ue.id),Ju(ue.id)]),[ze,Ye]=await Promise.all([Ko(we,z,ue.id),Go(ue.id)]),ut=["Joueur",...z.map(Wn=>St(Wn))],pt=[];for(const Wn of we){const nr=(Wn==null?void 0:Wn.name)||"",Vn=(ze==null?void 0:ze[nr])||{},Ei=[nr,...z.map(Os=>ot(Vn[Os.id],Ye==null?void 0:Ye[Os.id],nr))];pt.push(Ei)}const Pt=xe([ut,...pt]),Fn=new Blob(["\uFEFF"+Pt],{type:"text/csv;charset=utf-8;"}),kt=(ue==null?void 0:ue.name)||(ue==null?void 0:ue.slug)||"saison",Er=`${Ne(kt)}-disponibilites.csv`,nt=URL.createObjectURL(Fn),ct=document.createElement("a");ct.href=nt,ct.download=Er,document.body.appendChild(ct),ct.click(),document.body.removeChild(ct),URL.revokeObjectURL(nt),L.info("Export CSV saison",{seasonId:ue.id,events:z.length,players:we.length})}catch(z){L.error("Erreur export CSV",z),alert("Erreur lors de l'export CSV. Veuillez réessayer.")}}function At(ue){if(!ue)return null;if(ue instanceof Date)return ue;if(typeof(ue==null?void 0:ue.toDate)=="function")return ue.toDate();if(typeof ue=="string"||typeof ue=="number"){const z=new Date(ue);return isNaN(z.getTime())?null:z}return null}function St(ue){const z=At(ue==null?void 0:ue.date),we=z?`${z.getFullYear()}-${String(z.getMonth()+1).padStart(2,"0")}-${String(z.getDate()).padStart(2,"0")}`:"",ze=(ue==null?void 0:ue.title)||"Sans titre";return`${we} · ${ze}`.trim()}function J(ue){return ue===!0||ue==="oui"?"disponible":ue===!1||ue==="non"?"non disponible":""}function xe(ue){return ue.map(z=>z.map(be).join(",")).join(`
`)}function be(ue){const z=String(ue??"");return/[",\n\r]/.test(z)?'"'+z.replace(/"/g,'""')+'"':z}function Ne(ue){return String(ue||"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9\-_. ]+/g,"-").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$|^\.+|\.+$/g,"")||"fichier"}function ot(ue,z,we){return Array.isArray(z)&&z.includes(we)?ue===!1||ue==="non"?"non disponible":"sélectionné":J(ue)}async function bt(ue){if(je(),ue<=0)return;const z=[...U.value],we=z[ue],ze=z[ue-1],Ye=we.sortOrder;we.sortOrder=ze.sortOrder,ze.sortOrder=Ye;try{await Promise.all([Iu(we.id,we.sortOrder),Iu(ze.id,ze.sortOrder)])}catch(ut){L.error("Erreur lors du déplacement vers le haut",ut)}}async function R(ue){je();const z=[...U.value];if(ue>=z.length-1)return;const we=z[ue],ze=z[ue+1],Ye=we.sortOrder;we.sortOrder=ze.sortOrder,ze.sortOrder=Ye;try{await Promise.all([Iu(we.id,we.sortOrder),Iu(ze.id,ze.sortOrder)])}catch(ut){L.error("Erreur lors du déplacement vers le bas",ut)}}function F(){l.value&&(d.value=l.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function G(){f.value=f.value.replace(/[^0-9]/g,""),f.value.length>4&&(f.value=f.value.slice(0,4))}async function he(){if(!l.value.trim()||!d.value.trim()||!f.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(f.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await J$(l.value.trim(),d.value.trim(),f.value.trim(),h.value.trim(),""),e.value=await ol(),await De(),le()}catch(ue){L.error("Erreur lors de la création de la saison",ue),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function le(){i.value=!1,l.value="",d.value="",h.value="",f.value=""}function fe(ue){x.value=ue,o.value=!0}async function Ie(){o.value=!1,await pe({type:"deleteSeason",data:{seasonId:x.value.id,seasonName:x.value.name}})}function X(){o.value=!1,x.value=null}function ve(){return j.value?{deleteSeason:"Suppression de saison - Code PIN requis",editSeason:"Modification de saison - Code PIN requis"}[j.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function pe(ue){const z=ue.type==="editSeason"?ue.data.seasonId:x.value.id;if(Jn.isPinCached(z)){const we=Jn.getCachedPin(z);if(L.debug("PIN en cache trouvé, utilisation automatique"),await Mh(z,we)){await qe(ue);return}else Jn.clearSession()}j.value=ue,A.value=!0}async function Ce(ue){var z,we,ze,Ye;L.debug("PIN soumis pour l'opération",{operationType:(z=j.value)==null?void 0:z.type});try{const ut=((ze=(we=j.value)==null?void 0:we.data)==null?void 0:ze.seasonId)||((Ye=x.value)==null?void 0:Ye.id),pt=await Mh(ut,ue);if(L.debug("PIN validé",{valid:pt}),pt){Jn.saveSession(ut,ue),L.debug("PIN correct, fermeture de la modal et exécution de l'opération"),A.value=!1;const Pt=j.value;j.value=null,L.debug("Appel de executePendingOperation",{operationType:Pt==null?void 0:Pt.type}),await qe(Pt)}else de.value="Code PIN incorrect",setTimeout(()=>{de.value=""},3e3)}catch(ut){L.error("Erreur lors de la vérification du PIN",ut),de.value="Erreur lors de la vérification du code PIN"}}function _e(){A.value=!1,j.value=null,de.value=""}function Oe(){return x.value&&Jn.isPinCached(x.value.id)?{timeRemaining:Jn.getTimeRemaining(),isExpiringSoon:Jn.isExpiringSoon()}:null}async function qe(ue){var ze;if(L.debug("executePendingOperation appelé",{hasOperation:!!ue}),!ue){L.warn("Aucune opération à exécuter");return}const{type:z,data:we}=ue;L.info("Exécution de l'opération",{type:z});try{switch(z){case"deleteSeason":L.info("Suppression de la saison",{seasonId:we.seasonId}),await Y$(we.seasonId),L.info("Saison supprimée, rechargement de la liste"),e.value=await ol(),L.info("Liste des saisons rechargée",{count:((ze=e.value)==null?void 0:ze.length)||0});break;case"editSeason":L.info("Modification de la saison",{seasonId:we.seasonId});const Ye=we.newName!==we.oldName,ut=we.newDescription!==we.oldDescription,pt=we.newLogo!==null;if(!Ye&&!ut&&!pt){L.info("Aucun changement détecté, opération annulée");return}const Pt={};if(we.newName!==we.oldName&&(Pt.name=we.newName),we.newDescription!==we.oldDescription&&(Pt.description=we.newDescription),we.newLogo)try{O.value=!0,L.info("Upload du nouveau logo...");const kt=await dF(we.newLogo,`season-logos/${we.seasonId}`,{resize:!0,maxWidth:64,maxHeight:64,quality:.6});if(Pt.logoUrl=kt,we.oldLogoUrl&&pF(we.oldLogoUrl))try{await fF(we.oldLogoUrl),L.info("Ancien logo supprimé")}catch(Er){L.warn("Erreur lors de la suppression de l'ancien logo:",Er)}}catch(kt){throw L.error("Erreur lors de l'upload du logo:",kt),new Error("Erreur lors de l'upload du logo: "+kt.message)}finally{O.value=!1}await X$(we.seasonId,Pt);const Fn=e.value.findIndex(kt=>kt.id===we.seasonId);Fn!==-1&&(Pt.name&&(e.value[Fn].name=we.newName),Pt.description!==void 0&&(e.value[Fn].description=we.newDescription),Pt.logoUrl&&(e.value[Fn].logoUrl=Pt.logoUrl)),L.info("Saison modifiée avec succès",{seasonId:we.seasonId,oldName:we.oldName,newName:we.newName,oldDescription:we.oldDescription,newDescription:we.newDescription});break;default:L.warn("Type d'opération non reconnu",{type:z})}}catch(Ye){L.error("Erreur lors de l'exécution de l'opération",Ye),alert("Erreur lors de l'opération. Veuillez réessayer.")}}function Ue(){re.value=!0}function Ze(){re.value=!1}function ht(){re.value=!1,xi()}function nn(){k.value=!0}function Xt(){k.value=!1}function xn(){I.value=!0}function zt(){I.value=!1}function pr(){T.value=!0}function kr(){T.value=!1}function cn(){L.debug("Gestion de joueur demandée")}async function On(){try{await $e.signOut(),k.value=!1,L.info("Utilisateur déconnecté avec succès")}catch(ue){L.error("Erreur lors de la déconnexion",ue),alert("Erreur lors de la déconnexion. Veuillez réessayer.")}}async function xi(){try{const ue=await HA();if(ue){r.push(`/season/${ue}`);return}}catch(ue){L.warn("Impossible de récupérer la saison préférée",ue)}B()}return Sn(()=>(wl(),()=>{})),Nt(()=>r.currentRoute.value.path,async ue=>{var z;if(ue==="/"&&(wl(),e.value.length===0&&!t.value)){t.value=!0;try{e.value=await ol(),L.info("Saisons rechargées lors du changement de route",{count:((z=e.value)==null?void 0:z.length)||0})}catch(we){L.error("Erreur lors du rechargement des saisons",we)}finally{t.value=!1}}},{immediate:!0}),(ue,z)=>{var we,ze,Ye,ut,pt,Pt,Fn,kt,Er;return C(),N("div",f5,[Be(r6,{"is-scrolled":V.value,onOpenAccountMenu:nn,onOpenHelp:se,onOpenNotifications:xn,onOpenPlayers:pr,onLogout:On,onOpenLogin:Ue},null,8,["is-scrolled"]),c("section",p5,[c("div",m5,[c("div",g5,[c("div",v5,[z[13]||(z[13]=_r('<div class="text-center order-2 lg:order-1"><div class="hero-content-wrapper"><div class="hero-illustration relative hidden lg:block"><div class="relative mx-auto lg:mx-0 w-full max-w-lg"><div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-4 shadow-2xl border border-white/10 relative overflow-hidden"><div class="absolute inset-0 bg-gradient-to-br from-pink-500/10 via-purple-500/10 to-cyan-500/10 rounded-3xl blur-xl"></div><div class="relative z-10"><div class="flex items-center gap-3 mb-4"><div class="flex gap-2"><div class="w-3 h-3 bg-red-500 rounded-full"></div><div class="w-3 h-3 bg-yellow-500 rounded-full"></div><div class="w-3 h-3 bg-green-500 rounded-full"></div></div><div class="text-gray-400 text-sm">HatCast - Grille des disponibilités</div></div></div><div class="bg-gray-700 rounded-2xl p-4 min-h-[300px]"><div class="grid grid-cols-4 gap-2 mb-4"><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">15 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">22 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">29 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">5 Fév</div></div><div class="space-y-2"><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Marie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-gray-500/20 border border-gray-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Pierre</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Sophie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div></div></div></div></div><div class="absolute -top-4 -right-4 w-20 h-20 bg-gradient-to-r from-pink-400 to-purple-500 rounded-2xl shadow-xl transform rotate-12 z-30"></div><div class="absolute -bottom-4 -left-4 w-16 h-16 bg-gradient-to-r from-cyan-400 to-blue-500 rounded-2xl shadow-xl transform -rotate-12 z-30 flex items-center justify-center"><img src="'+uF+'" alt="Masque HatCast" class="w-10 h-10 object-contain transform rotate-12"></div></div></div></div>',1)),c("div",y5,[z[12]||(z[12]=_r('<div class="hero-title mb-8"><h1 class="text-4xl md:text-6xl font-bold text-white mb-6 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent leading-tight"> Faites vos équipes d&#39;impro…<br>en un clin d&#39;œil </h1></div><div class="hero-subtitle mb-10"><p class="text-xl md:text-2xl text-gray-300 leading-relaxed max-w-2xl"> Plus de casse-tête pour savoir qui joue quand. Chacun indique ses dispos, <strong class="text-white">HatCast compose l&#39;équipe pour vous</strong>, équitablement et sans tension. </p></div>',2)),c("div",_5,[c("div",b5,[c("button",{onClick:z[0]||(z[0]=nt=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-5 px-10 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105 text-lg md:text-xl"}," 🚀 Démarrez "),c("button",{onClick:se,class:"inline-flex items-center gap-2 text-cyan-300 hover:text-cyan-200 font-medium py-3 px-6 rounded-lg hover:bg-cyan-500/10 transition-all duration-300 border border-cyan-500/30 hover:border-cyan-400/50"},z[10]||(z[10]=[c("span",null,"ℹ️",-1),ft(" En savoir plus ")]))])]),c("div",{class:"hero-hint text-center"},[c("button",{onClick:B,class:"inline-flex items-center gap-2 text-gray-400 hover:text-cyan-300 transition-all duration-300 text-sm cursor-pointer group"},z[11]||(z[11]=[c("span",{class:"group-hover:animate-bounce"},"↓",-1),c("span",null,"Vos saisons ci-dessous",-1),c("span",{class:"group-hover:animate-bounce"},"↓",-1)]))])])])])]),z[14]||(z[14]=c("div",{class:"hero-background absolute inset-0 z-0"},[c("div",{class:"absolute top-20 left-10 w-32 h-32 bg-pink-500/10 rounded-full blur-3xl"}),c("div",{class:"absolute bottom-20 right-10 w-40 h-40 bg-purple-500/10 rounded-full blur-3xl"}),c("div",{class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-cyan-500/5 rounded-full blur-3xl"})],-1))]),c("section",w5,[c("div",x5,[z[32]||(z[32]=c("div",{class:"text-center mb-12"},[c("h2",{class:"text-3xl md:text-4xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"}," Saisons en cours "),c("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto"}," Sélectionnez une saison pour gérer les disponibilités et équipes. ")],-1)),c("div",{class:"pb-16","aria-busy":t.value},[t.value?(C(),N("div",I5,[(C(),N(xt,null,Lr(8,nt=>c("div",{key:"skeleton-"+nt,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8 w-full max-w-sm"},z[15]||(z[15]=[c("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),c("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),c("div",{class:"h-px bg-white/10 mb-4"},null,-1),c("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(C(),N("div",T5,[(C(!0),N(xt,null,Lr(U.value,(nt,ct)=>{var Wn,nr;return C(),N("div",{key:nt.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20 w-full max-w-sm"},[c("div",{onClick:Vn=>$(nt.slug),class:"text-center cursor-pointer"},[c("div",S5,[nt.logoUrl?(C(),N("img",{key:0,src:nt.logoUrl,alt:`Logo de ${nt.name}`,class:"w-full h-full object-cover"},null,8,P5)):(C(),N("span",R5,"🎭"))]),c("h2",C5,oe(nt.name),1),nt.description?(C(),N("p",k5,oe(nt.description),1)):ae("",!0),z[18]||(z[18]=c("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),c("div",D5,[c("div",N5,[c("div",O5,oe(((Wn=nt.events)==null?void 0:Wn.length)||0),1),z[16]||(z[16]=c("div",{class:"text-gray-400 text-xs"},"Événements",-1))]),c("div",V5,[c("div",M5,oe(((nr=nt.players)==null?void 0:nr.length)||0),1),z[17]||(z[17]=c("div",{class:"text-gray-400 text-xs"},"Joueurs",-1))])])],8,A5),c("div",L5,[c("div",{class:"relative",onClick:z[1]||(z[1]=mt(()=>{},["stop"]))},[c("button",{onClick:Vn=>D(ct),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===ct,"aria-haspopup":"true",title:"Options"},z[19]||(z[19]=[c("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,$5),s.value===ct?(C(),N("div",F5,[c("button",{onClick:Vn=>{gt(nt),je()},class:"w-full text-left px-4 py-2 text-sm text-emerald-300 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},z[20]||(z[20]=[c("span",null,"📊",-1),ft(" Exporter CSV ")]),8,U5),z[25]||(z[25]=c("div",{class:"border-t border-white/10 my-1"},null,-1)),c("button",{onClick:Vn=>bt(ct),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},z[21]||(z[21]=[c("span",null,"⬆️",-1),ft(" Avancer ")]),8,j5),c("button",{onClick:Vn=>R(ct),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},z[22]||(z[22]=[c("span",null,"⬇️",-1),ft(" Reculer ")]),8,B5),z[26]||(z[26]=c("div",{class:"border-t border-white/10 my-1"},null,-1)),c("button",{onClick:Vn=>Tt(nt),class:"w-full text-left px-4 py-2 text-sm text-blue-300 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},z[23]||(z[23]=[c("span",null,"✏️",-1),ft(" Modifier ")]),8,q5),z[27]||(z[27]=c("div",{class:"border-t border-white/10 my-1"},null,-1)),c("button",{onClick:Vn=>fe(nt),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10 flex items-center gap-2",role:"menuitem"},z[24]||(z[24]=[c("span",null,"🗑️",-1),ft(" Supprimer ")]),8,z5)])):ae("",!0)])])])}),128))])):ae("",!0),c("div",H5,[c("button",{onClick:z[2]||(z[2]=nt=>i.value=!0),class:"inline-flex items-center gap-3 bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-semibold py-4 px-8 rounded-xl text-lg hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-pink-500/25"},z[28]||(z[28]=[c("span",null,"➕",-1),ft(" Nouvelle saison ")]))]),!t.value&&e.value.length===0?(C(),N("div",K5,[z[29]||(z[29]=c("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[c("span",{class:"text-4xl"},"🎪")],-1)),z[30]||(z[30]=c("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),z[31]||(z[31]=c("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),c("button",{onClick:z[3]||(z[3]=nt=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):ae("",!0)],8,E5)])]),i.value?(C(),N("div",G5,[c("div",W5,[z[39]||(z[39]=c("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),c("div",Q5,[z[33]||(z[33]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),tt(c("input",{"onUpdate:modelValue":z[4]||(z[4]=nt=>l.value=nt),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:F},null,544),[[Ut,l.value]])]),c("div",J5,[z[34]||(z[34]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),tt(c("input",{"onUpdate:modelValue":z[5]||(z[5]=nt=>d.value=nt),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[Ut,d.value]])]),c("div",Y5,[z[35]||(z[35]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description (optionnel)",-1)),tt(c("textarea",{"onUpdate:modelValue":z[6]||(z[6]=nt=>h.value=nt),rows:"3",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400 resize-none",placeholder:"Ex: Saison 2025-2026 de la troupe d'improvisation La Malice"},null,512),[[Ut,h.value]]),z[36]||(z[36]=c("p",{class:"text-xs text-gray-400 mt-1"},"Une brève description de votre saison",-1))]),c("div",X5,[z[37]||(z[37]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),tt(c("input",{"onUpdate:modelValue":z[7]||(z[7]=nt=>f.value=nt),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:G},null,544),[[Ut,f.value]]),z[38]||(z[38]=c("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),c("div",Z5,[c("button",{onClick:le,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),c("button",{onClick:he,disabled:!l.value.trim()||!d.value.trim()||!f.value.trim()||f.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,ej)])])])):ae("",!0),o.value?(C(),N("div",tj,[c("div",nj,[c("div",rj,[z[40]||(z[40]=c("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[c("span",{class:"text-2xl"},"⚠️")],-1)),z[41]||(z[41]=c("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),c("p",sj,'Êtes-vous sûr de vouloir supprimer la saison "'+oe((we=x.value)==null?void 0:we.name)+'" ?',1)]),z[42]||(z[42]=c("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),c("div",{class:"flex justify-end space-x-3"},[c("button",{onClick:X,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),c("button",{onClick:Ie,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ae("",!0),a.value?(C(),N("div",ij,[c("div",oj,[c("div",aj,[z[43]||(z[43]=c("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[c("span",{class:"text-2xl"},"✏️")],-1)),z[44]||(z[44]=c("h2",{class:"text-2xl font-bold text-white mb-2"},"Modifier la saison",-1)),c("p",lj,'Modifiez les informations de la saison "'+oe((ze=M.value)==null?void 0:ze.name)+'"',1)]),c("div",uj,[z[45]||(z[45]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),tt(c("input",{"onUpdate:modelValue":z[8]||(z[8]=nt=>g.value=nt),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026"},null,512),[[Ut,g.value]])]),c("div",cj,[z[46]||(z[46]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description (optionnel)",-1)),tt(c("textarea",{"onUpdate:modelValue":z[9]||(z[9]=nt=>v.value=nt),rows:"3",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400 resize-none",placeholder:"Ex: Saison 2025-2026 de la troupe d'improvisation La Malice"},null,512),[[Ut,v.value]])]),c("div",dj,[z[47]||(z[47]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Logo de la troupe (optionnel)",-1)),b.value||(Ye=M.value)!=null&&Ye.logoUrl?(C(),N("div",hj,[c("div",fj,[c("img",{src:b.value||((ut=M.value)==null?void 0:ut.logoUrl),alt:`Logo de ${(pt=M.value)==null?void 0:pt.name}`,class:"w-full h-full object-cover"},null,8,pj)]),b.value||(Pt=M.value)!=null&&Pt.logoUrl?(C(),N("button",{key:0,onClick:ne,type:"button",class:"text-xs text-red-400 hover:text-red-300 transition-colors"}," Supprimer le logo ")):ae("",!0)])):ae("",!0),c("div",{class:Qt(["border-2 border-dashed rounded-lg p-6 text-center transition-all duration-300",O.value?"border-blue-500 bg-blue-900/20 animate-pulse":"border-gray-600 hover:border-gray-500"])},[c("input",{ref:"logoFileInput",type:"file",accept:"image/*",onChange:Se,class:"hidden"},null,544),c("button",{onClick:te,type:"button",disabled:O.value,class:"text-gray-300 hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[O.value?(C(),N("div",gj,"⏳")):(C(),N("div",vj,"📷")),c("div",yj,[O.value?(C(),N("span",_j," Upload en cours... ")):!b.value&&!((Fn=M.value)!=null&&Fn.logoUrl)?(C(),N("span",bj," Cliquez pour ajouter un logo ")):(C(),N("span",wj," Cliquez pour changer le logo "))]),O.value?ae("",!0):(C(),N("div",xj," PNG, JPG, GIF (max 5MB) "))],8,mj)],2)]),z[49]||(z[49]=c("p",{class:"mb-6 text-sm text-blue-400 bg-blue-900/20 p-3 rounded-lg border border-blue-500/20"}," ℹ️ Le slug de l'URL restera inchangé pour préserver les liens existants. ",-1)),c("div",Ej,[c("button",{onClick:yt,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),c("button",{onClick:We,disabled:!g.value.trim()||g.value.trim()===((kt=M.value)==null?void 0:kt.name)&&v.value===(((Er=M.value)==null?void 0:Er.description)||"")&&!w.value||O.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"},[O.value?(C(),N("span",Tj,z[48]||(z[48]=[c("span",{class:"animate-spin"},"⏳",-1),ft(" Upload en cours... ")]))):(C(),N("span",Aj,"Modifier"))],8,Ij)])])])):ae("",!0),Be(WA,{show:A.value,message:ve(),error:de.value,"session-info":Oe(),onSubmit:Ce,onCancel:_e},null,8,["show","message","error","session-info"]),z[50]||(z[50]=_r('<section class="help-section py-20 bg-gradient-to-br from-gray-900/50 to-gray-800/50 border-t border-white/10"><div class="container mx-auto px-4"><div class="max-w-6xl mx-auto"><div class="text-center mb-16"><h2 class="text-4xl md:text-5xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"> Qu&#39;est-ce que HatCast ? </h2><p class="text-xl text-purple-300 max-w-3xl mx-auto"> L&#39;appli pour sélectionner vos joueurs d&#39;impro simplement, équitablement et sans prise de tête </p></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16"><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-pink-500/20 to-purple-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-pink-500/30"><span class="text-4xl">🎭</span></div><h3 class="text-xl font-bold text-white mb-3">Gestion des saisons</h3><p class="text-gray-300 text-sm leading-relaxed"> Déclarez tous vos spectacles et indiquez combien de joueurs vous aurez besoin. Organisez votre saison d&#39;impro de A à Z. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-purple-500/20 to-cyan-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-purple-500/30"><span class="text-4xl">📅</span></div><h3 class="text-xl font-bold text-white mb-3">Sondage de disponibilités</h3><p class="text-gray-300 text-sm leading-relaxed"> Créez des sondages pour vos événements. Chaque joueur indique ses disponibilités et HatCast optimise la composition des équipes. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-cyan-500/20 to-pink-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-cyan-500/30"><span class="text-4xl">🎲</span></div><h3 class="text-xl font-bold text-white mb-3">Sélection auto ou manuelle</h3><p class="text-gray-300 text-sm leading-relaxed"> Laissez le hasard pondéré décider ou reprenez la main à tout moment. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-green-500/20 to-blue-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-green-500/30"><span class="text-4xl">📱</span></div><h3 class="text-xl font-bold text-white mb-3">Pensé pour le mobile</h3><p class="text-gray-300 text-sm leading-relaxed"> Utilisez HatCast facilement sur smartphone ou tablette, où que vous soyez. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-blue-500/20 to-indigo-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-blue-500/30"><span class="text-4xl">🔐</span></div><h3 class="text-xl font-bold text-white mb-3">Comptes facultatifs</h3><p class="text-gray-300 text-sm leading-relaxed"> Créez un compte pour recevoir des rappels et sécuriser vos infos. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-emerald-500/20 to-teal-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-emerald-500/30"><span class="text-4xl">🔔</span></div><h3 class="text-xl font-bold text-white mb-3">Notifications intelligentes</h3><p class="text-gray-300 text-sm leading-relaxed"> Recevez des alertes par email et push pour les événements et sélections. Restez informé sans être submergé. </p></div></div></div></div></section><footer class="border-t border-white/10 bg-gradient-to-br from-gray-950 to-black"><div class="container mx-auto px-4 py-12"><div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8"><div><div class="flex items-center gap-3 mb-4"><div class="relative w-32 h-8"><img src="'+Fm+'" alt="Logo HatCast" class="w-full h-full brightness-0 invert"></div></div><p class="text-gray-300 text-sm leading-relaxed max-w-md"> L&#39;appli pour sélectionner vos joueurs d&#39;impro simplement, équitablement et sans prise de tête. </p></div><div><h4 class="text-white font-semibold mb-4 text-sm uppercase tracking-wider">Feedback</h4><div class="space-y-2"><a href="https://github.com/plamarque/hatcast/issues" target="_blank" rel="noopener noreferrer" class="block text-gray-300 hover:text-blue-300 transition-colors text-sm"> 🐛 Signaler un bug </a><a href="https://github.com/plamarque/hatcast" target="_blank" rel="noopener noreferrer" class="block text-gray-300 hover:text-blue-300 transition-colors text-sm"> 🔗 Code source </a></div></div></div><div class="text-center text-xs text-gray-500 pt-6"><span>© Patrice Lamarque 2025</span></div></div></footer>',2)),Be(QA,{show:re.value,onClose:Ze,onSuccess:ht},null,8,["show"]),Be(f1,{show:k.value,onClose:Xt,onLogoutDevice:On},null,8,["show"]),Be(p1,{show:I.value,onClose:zt},null,8,["show"]),Be(m1,{show:T.value,onClose:kr,onManagePlayer:cn},null,8,["show"])])}}};function Pj(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//HatCast//Calendar Event//FR","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${n.id}@impropick.com`,`DTSTAMP:${new Date().toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTSTART:${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTEND:${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`SUMMARY:${n.title}`,`DESCRIPTION:${n.description||""}${e?`\\n\\nSaison : ${e}`:""}`,"STATUS:CONFIRMED","SEQUENCE:0","BEGIN:VALARM","TRIGGER:-PT1H","ACTION:DISPLAY",`DESCRIPTION:Rappel : ${n.title}`,"END:VALARM","END:VEVENT","END:VCALENDAR"].join(`\r
`)}function Rj(n,e=""){const t=Pj(n,e),r=new Blob([t],{type:"text/calendar;charset=utf-8"}),s=URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=`${n.title.replace(/[^a-z0-9]/gi,"_")}_${n.date}.ics`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)}function Cj(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://calendar.google.com/calendar/render?${new URLSearchParams({action:"TEMPLATE",text:n.title,dates:`${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z/${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,details:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"HatCast",sf:"true",output:"xml"}).toString()}`}function kj(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://outlook.live.com/calendar/0/deeplink/compose?${new URLSearchParams({subject:n.title,startdt:r.toISOString(),enddt:s.toISOString(),body:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"HatCast",allday:"false"}).toString()}`}function Dj(n,e=""){const t=Cj(n,e);window.open(t,"_blank")}function Nj(n,e=""){const t=kj(n,e);window.open(t,"_blank")}function Oj(n,e,t=""){switch(n){case"ics":Rj(e,t);break;case"google":Dj(e,t);break;case"outlook":Nj(e,t);break;default:console.warn("Type de calendrier non supporté:",n)}}function b1(){const n=!!localStorage.getItem("fcmToken")||!!localStorage.getItem("userEmail")||!!localStorage.getItem("authUser"),e=Notification.permission==="granted"&&!!localStorage.getItem("fcmToken");return!n&&!e}async function w1({seasonId:n,eventId:e,playerName:t,email:r,eventTitle:s,seasonSlug:i}){try{let o=i;try{const d=await Mt(ye(ee,"seasons",n));d.exists()&&(o=d.data().title||i)}catch(d){console.warn("Impossible de récupérer le titre de la saison, utilisation du slug:",d)}const a=await $h({seasonId:n,playerId:"notification_activation",eventId:e,action:"activate_notifications",slug:i}),l=`${n}_${e}_${r.replace(/[^a-zA-Z0-9]/g,"_")}`;return await en(ye(ee,"notificationActivations",l),{seasonId:n,eventId:e,playerName:t,email:r,eventTitle:s,seasonSlug:i,magicLinkId:a.id,magicLinkUrl:a.url,requestedAt:yn(),status:"pending"}),await nU({toEmail:r,playerName:t,eventTitle:s,eventUrl:`${window.location.origin}/season/${i}/event/${e}`,activationUrl:a.url,seasonTitle:o}),L.info("Demande d'activation des notifications créée",{activationId:l,email:r,playerName:t,eventId:e}),{success:!0,activationId:l,magicLink:a}}catch(o){throw L.error("Erreur lors de la création de la demande d'activation",o),o}}async function Vj(n){try{const e=await Mj(n);if(!e)throw new Error("Données d'activation introuvables");const{verifyMagicLink:t}=await dt(()=>Promise.resolve().then(()=>t1),void 0);if(!(await t({seasonId:e.seasonId,playerId:"notification_activation",eventId:e.eventId,token:n,action:"activate_notifications"})).valid)throw new Error("Magic link invalide ou expiré");const s=await x1(),i=await Fj(e.email);return await E1(e.email,{notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}),await Lj(e.activationId),await I1(e),L.info("Notifications activées avec succès",{email:e.email,playerName:e.playerName,pushStatus:s}),{success:!0,email:e.email,playerName:e.playerName,pushStatus:s,accountStatus:i}}catch(e){throw L.error("Erreur lors de l'activation des notifications",e),e}}async function Mj(n){try{const{collection:e,query:t,where:r,getDocs:s}=await dt(()=>import("./index.esm-7beab343.js"),[]),i=t(e(ee,"notificationActivations"),r("status","==","pending")),o=await s(i);for(const a of o.docs){const l=a.data();if(l.magicLinkUrl&&l.magicLinkUrl.includes(n))return{...l,activationId:a.id}}return null}catch(e){return L.error("Erreur lors de la récupération des données d'activation",e),null}}async function x1(){try{if(!await Zv())return{active:!1,reason:"not_supported"};if(await Notification.requestPermission()!=="granted")return{active:!1,reason:"permission_denied"};const e=await jA();return e?{active:!0,token:e}:{active:!1,reason:"token_failed"}}catch(n){return L.error("Erreur lors de l'activation des notifications push",n),{active:!1,reason:"error",error:n.message}}}async function E1(n,e){try{await en(ye(ee,"userPreferences",n),{...e,updatedAt:yn(),notificationActivatedAt:yn()},{merge:!0})}catch(t){throw L.error("Erreur lors de la mise à jour des préférences",t),t}}async function Lj(n){try{await To(ye(ee,"notificationActivations",n),{status:"completed",completedAt:yn()})}catch(e){L.error("Erreur lors de la finalisation de l'activation",e)}}async function I1(n){try{const{collection:e,query:t,where:r,getDocs:s,setDoc:i}=await dt(()=>import("./index.esm-7beab343.js"),[]),o=t(e(ee,"playerAssociations"),r("email","==",n.email),r("seasonId","==",n.seasonId));if(!(await s(o)).empty){L.info("Association joueur-email déjà existante",{email:n.email,seasonId:n.seasonId});return}await i(ye(ee,"playerAssociations",`${n.seasonId}_${n.email}`),{email:n.email,seasonId:n.seasonId,playerName:n.playerName,associatedAt:yn(),source:"notification_activation"}),L.info("Joueur associé à l'email",{email:n.email,playerName:n.playerName,seasonId:n.seasonId})}catch(e){L.error("Erreur lors de l'association du joueur",e)}}async function $j({seasonId:n,eventId:e,playerName:t,email:r,eventTitle:s,seasonSlug:i}){try{console.log("🔔 Activation directe des notifications pour utilisateur connecté");const o=await x1();return await E1(r,{notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}),await I1({seasonId:n,eventId:e,playerName:t,email:r,eventTitle:s,seasonSlug:i}),L.info("Notifications activées directement pour utilisateur connecté",{email:r,playerName:t,eventId:e,pushStatus:o}),{success:!0,email:r,playerName:t,pushStatus:o,directActivation:!0}}catch(o){throw L.error("Erreur lors de l'activation directe des notifications",o),o}}async function Fj(n){try{const{auth:e}=await dt(()=>Promise.resolve().then(()=>Yr),void 0),{signInWithEmailAndPassword:t,createUserWithEmailAndPassword:r}=await dt(()=>import("./index.esm-3f9d7d41.js"),[]);try{return await t(e,n,"temp_password_123"),L.info("Compte Firebase Auth existant trouvé",{email:n}),{created:!1,reason:"already_exists"}}catch(s){if(s.code==="auth/user-not-found")try{const i=await r(e,n,"temp_password_123"),{sendPasswordResetEmail:o}=await dt(()=>import("./index.esm-3f9d7d41.js"),[]);return await o(e,n),L.info("Compte Firebase Auth créé avec succès",{email:n,uid:i.user.uid}),{created:!0,reason:"new_account_created",uid:i.user.uid,passwordResetSent:!0}}catch(i){return L.error("Erreur lors de la création du compte Firebase Auth",i),{created:!1,reason:"creation_failed",error:i.message}}else return L.warn("Erreur de connexion Firebase Auth",{email:n,error:s.code}),{created:!1,reason:"auth_error",error:s.code}}}catch(e){return L.error("Erreur lors de la vérification/création du compte Firebase Auth",e),{created:!1,reason:"general_error",error:e.message}}}const T1=Object.freeze(Object.defineProperty({__proto__:null,activateNotificationsForConnectedUser:$j,createNotificationActivationRequest:w1,processNotificationActivation:Vj,shouldPromptForNotifications:b1},Symbol.toStringTag,{value:"Module"}));const Uj={class:"space-y-4"},jj={class:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2"},Bj={key:0,class:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-3"},qj={class:"bg-gray-800 border border-gray-600 rounded-lg p-3"},zj={key:0,class:"space-y-3"},Hj={class:"text-gray-300 text-sm mb-3"},Kj={class:"text-white font-medium"},Gj={class:"text-green-400 font-medium"},Wj={class:"text-yellow-400 font-medium"},Qj={class:"flex flex-wrap gap-2"},Jj=["title"],Yj={key:0,class:"text-green-400 text-xs"},Xj={key:1,class:"text-yellow-400 text-xs"},Zj={key:1,class:"text-amber-400 text-sm"},eB={class:"space-y-3"},tB={key:0,class:"fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in"},nB={class:"whitespace-pre-wrap font-sans"},rB={__name:"MessagePreview",props:{mode:{type:String,required:!0,validator:n=>["event","selection"].includes(n)},event:{type:Object,required:!0},seasonId:{type:String,required:!0},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},selectedPlayers:{type:Array,default:()=>[]},availabilityByPlayer:{type:Object,default:()=>({})}},setup(n){const e=n,t=S(!1),r=S(!1),s=S([]),i=S([]),o=S([]),a=He(()=>!e.event||!e.seasonSlug?"":`${window.location.origin}/season/${e.seasonSlug}/event/${e.event.id}`),l=He(()=>{const w=i.value.map(x=>({...x,hasContact:x.id!=="ALL",missingReason:""})),b=o.value.map(x=>({...x,hasContact:!1,missingReason:"Aucun canal actif"}));return[{id:"ALL",name:"Tous",hasContact:!0},...w.filter(x=>x.id!=="ALL"),...b]}),d=He(()=>{var M,O;if(!e.event)return"";const w=g((M=e.event)==null?void 0:M.date),b=(O=e.event)==null?void 0:O.title,x=a.value;return e.mode==="event"?HF({playerName:"",eventTitle:b,eventDate:w,eventUrl:x}):KF({playerName:"",eventTitle:b,eventDate:w,eventUrl:x})}),h=He(()=>d.value);function f(){navigator.clipboard.writeText(h.value),r.value=!0,setTimeout(()=>{r.value=!1},2e3)}function g(w){if(!w)return"";const b=new Date(w),x={weekday:"long",day:"numeric",month:"long",year:"numeric"};return b.toLocaleDateString("fr-FR",x)}async function v(){if(!e.seasonId)return;let w=[];e.mode==="selection"?(w=e.players.filter(O=>e.selectedPlayers.includes(O.name)),console.log("Mode sélection - targetPlayers:",w)):(w=e.players,console.log("Mode événement - targetPlayers (tous):",w));const b=[];for(const O of w)try{const{getPlayerEmail:A}=await dt(()=>Promise.resolve().then(()=>wa),void 0),j=await A(O.id,e.seasonId);console.log(`Email pour ${O.name}:`,j),j&&b.push({...O,email:j})}catch(A){console.warn(`Impossible de charger l'email pour ${O.name}:`,A)}console.log("Players avec email:",b),s.value=b;const x={id:"ALL",name:"Tous"};i.value=[x,...b];const M=w.filter(O=>!b.find(A=>A.id===O.id)).map(O=>({id:O.id,name:O.name}));o.value=M,console.log("Recipients finaux:",{recipients:i.value,nonContactRecipients:o.value,allDisplayRecipients:l.value})}return Sn(()=>{v()}),Nt(()=>[e.selectedPlayers,e.availabilityByPlayer],()=>{v()},{deep:!0}),(w,b)=>(C(),N("div",Uj,[c("div",null,[c("label",jj,[b[1]||(b[1]=ft(" Personnes à Prévenir ")),c("button",{onClick:b[0]||(b[0]=x=>t.value=!t.value),class:"text-blue-400 hover:text-blue-300 text-lg cursor-help",title:"Cliquer pour plus d'information"}," ? ")]),t.value?(C(),N("div",Bj,b[2]||(b[2]=[c("p",{class:"text-blue-200 text-sm"},[ft(" Cette liste montre tous les joueurs ciblés: "),c("span",{class:"text-gray-200"},"ceux notifiables (email/push actifs)"),ft(" et "),c("span",{class:"text-yellow-300"},"ceux en jaune sans canal actif"),ft(". Les joueurs en jaune ne peuvent pas être notifiés automatiquement. Utilise le message ci-dessous pour les contacter manuellement. ")],-1)]))):ae("",!0),c("div",qj,[l.value.length>0?(C(),N("div",zj,[c("div",Hj,[c("span",Kj,oe(l.value.length-1),1),b[3]||(b[3]=ft(" personnes à prévenir. ")),c("span",Gj,oe(s.value.length),1),b[4]||(b[4]=ft(" seront notifiées, ")),c("span",Wj,oe(o.value.length),1),b[5]||(b[5]=ft(" devront être prévenues manuellement. "))]),c("div",Qj,[(C(!0),N(xt,null,Lr(l.value.filter(x=>x.id!=="ALL"),x=>(C(),N("span",{key:x.id||x.name,class:Qt(["px-3 py-1 rounded text-sm border flex items-center gap-1",x.hasContact?"bg-gray-700 border-gray-600 text-white":"bg-yellow-900/20 border-yellow-600/40 text-yellow-200 opacity-75"]),title:x.hasContact?"Peut être notifié automatiquement":"Aucun canal actif - notification manuelle requise"},[ft(oe(x.name)+" ",1),x.hasContact?(C(),N("span",Yj,"✓")):(C(),N("span",Xj,"⚠️"))],10,Jj))),128))])])):(C(),N("div",Zj," ⚠️ Aucun destinataire disponible. "))])]),c("div",null,[b[6]||(b[6]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Message à copier pour les contacts manuels :",-1)),c("div",eB,[r.value?(C(),N("div",tB," ✅ Copié ! ")):ae("",!0),c("div",{class:"w-full p-3 bg-gray-800 border border-gray-700 rounded-md text-white text-sm cursor-pointer hover:bg-gray-700 transition-colors",onClick:f,title:"Cliquer pour copier le texte"},[c("pre",nB,oe(h.value),1)])])])]))}},sB=Ff(rB,[["__scopeId","data-v-88cc77b7"]]);const iB={class:"relative p-5 pb-4 border-b border-white/10"},oB={class:"text-xl md:text-2xl font-bold text-white pr-10 flex items-center gap-2"},aB={class:"hidden sm:inline"},lB={key:0,class:"text-sm text-purple-300 mt-1"},uB={class:"px-4 md:px-6 py-4 md:py-6 space-y-6 overflow-y-auto"},cB={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},dB={class:"flex items-center gap-2 w-full"},hB=["disabled"],fB={key:0},pB={key:1,class:"inline-flex items-center gap-2"},mB={__name:"EventAnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},mode:{type:String,default:"event",validator:n=>["event","selection"].includes(n)},selectedPlayers:{type:Array,default:()=>[]},sending:{type:Boolean,default:!1},availabilityByPlayer:{type:Object,default:()=>({})}},emits:["close","notifications-sent","send-notifications"],setup(n,{emit:e}){const t=n,r=e,s=S(!1),i=He(()=>t.sending||s.value);function o(){r("close")}function a(d){var f;return d?(typeof d=="string"?new Date(d):((f=d.toDate)==null?void 0:f.call(d))||d).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}async function l(){if(t.event){s.value=!0;try{r("send-notifications",{eventId:t.event.id,eventData:t.event,reason:t.mode==="selection"?"selection":"event",selectedPlayers:t.selectedPlayers,scope:"all"})}catch(d){console.error("Erreur lors de l'envoi des notifications:",d),alert("Erreur lors de l'envoi des notifications. Veuillez réessayer."),s.value=!1}}}return Nt(()=>t.sending,d=>{d||(s.value=!1)}),(d,h)=>n.show?(C(),N("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:o},[c("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] flex flex-col",onClick:h[0]||(h[0]=mt(()=>{},["stop"]))},[c("div",iB,[c("button",{onClick:o,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),c("h2",oB,[c("span",aB,oe(n.mode==="selection"?"📣":"📢"),1),c("span",null,oe(n.mode==="selection"?"Confirmer la sélection":"Confirmer l'événement"),1)]),n.event?(C(),N("p",lB,oe(n.event.title)+" — "+oe(a(n.event.date)),1)):ae("",!0)]),c("div",uB,[Be(sB,{mode:n.mode,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,"selected-players":n.selectedPlayers,"availability-by-player":n.availabilityByPlayer},null,8,["mode","event","season-id","season-slug","players","selected-players","availability-by-player"])]),c("div",cB,[c("div",dB,[c("button",{onClick:l,disabled:i.value,class:"h-12 px-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600 flex-1"},[i.value?(C(),N("span",pB,h[2]||(h[2]=[c("svg",{class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[c("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),c("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),ft(" Envoi en cours... ")]))):(C(),N("span",fB,h[1]||(h[1]=[c("span",{class:"hidden sm:inline"},"🔔 Confirmer et notifier",-1),c("span",{class:"sm:hidden"},"🔔 Confirmer",-1)])))],8,hB)]),c("button",{onClick:o,class:"h-12 px-4 bg-gray-700 text-white rounded-lg"}," Fermer ")])])])):ae("",!0)}},A1=Ff(mB,[["__scopeId","data-v-4b6a7b48"]]),gB={class:"relative p-6 pb-4 border-b border-white/10"},vB={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},yB={__name:"AppHelpModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(C(),N("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[95] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[c("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=mt(()=>{},["stop"]))},[c("div",gB,[c("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=c("div",{class:"flex items-center gap-3"},[c("div",{class:"w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-2xl"},"❓"),c("div",null,[c("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Kezako ?"),c("p",{class:"text-sm text-purple-300"},"L'appli pour organiser vos spectacles d'improvisation de manière simple et apaisée")])],-1))]),s[5]||(s[5]=_r('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">C&#39;est quoi ?</h3><p> HatCast est une appli conçue pour faciliter <span class="text-white">la sélection des joueurs d&#39;impro</span> pour les spectacles. L&#39;idée est née au sein de <span class="text-purple-300">La Malice</span> pour <span class="text-white">dépersonnaliser une tâche délicate</span> qui créait des tensions depuis des années. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">Comment ça marche</h3><p> L&#39;asso déclare ses dates et le nombre de personnes nécessaires. Les joueurs indiquent leurs disponibilités. L&#39;appli propose des sélections. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Sélection auto ou manuelle</h3><p> Le <span class="text-white">mode sélection auto</span> s&#39;appuie sur le hasard (pondéré) pour simplifier la vie. Vous pouvez aussi repasser en mode <span class="text-white">manuel</span> si besoin. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Pensée mobile • Libre d&#39;utilisation</h3><p> L&#39;appli est <span class="text-white">pensée pour le mobile</span> et peut être utilisée librement par La Malice ou <span class="text-white">toute autre troupe</span>. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Comptes (facultatif)</h3><p> Les joueurs qui le souhaitent peuvent créer un compte via leur email pour <span class="text-white">recevoir des notifications</span>, <span class="text-white">protéger leurs saisies</span> et bénéficier d&#39;un meilleur confort d&#39;utilisation. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2 text-sm"><h3 class="text-white font-semibold">Statut &amp; licence</h3><p> Application <span class="text-white">en cours de développement</span>, <span class="text-white">sans garanties</span> à ce stade. Licence libre <span class="text-white">MIT</span>. </p><p>Contact &amp; retours : <a href="mailto:impropick@gmail.com" class="text-blue-300 underline">impropick@gmail.com</a></p></div></div>',1)),c("div",vB,[c("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ae("",!0)}},_B={class:"text-center mb-6"},bB={class:"text-lg text-gray-300"},wB={class:"mb-6"},xB={class:"space-y-4"},EB={class:"flex items-center gap-2 text-gray-300 text-sm"},IB=["disabled"],TB={key:0,class:"animate-spin"},AB={key:1},SB={class:"mb-6 text-center"},PB={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},RB={class:"text-red-300 text-sm"},CB={class:"text-center mb-6"},kB={class:"text-lg text-gray-300"},DB={class:"mb-6"},NB=["disabled"],OB={key:0,class:"animate-spin"},VB={key:1},MB={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},LB={class:"text-red-300 text-sm"},$B={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},FB={class:"text-green-300 text-sm"},UB={class:"flex justify-center"},ay={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S(!1),o=S(""),a=S(!1),l=S(""),d=S(""),h=S(null),f=S(!0);async function g(){if(s.value){i.value=!0,o.value="";try{const b=await $m(t.seasonId);if(s.value===b){if(f.value)try{vo.saveSession(t.player.id)}catch{}r("verified",{type:"season_pin"}),w();return}if(await c1(t.player.id,s.value,t.seasonId)){if(f.value)try{vo.saveSession(t.player.id)}catch{}r("verified",{type:"player_password"}),w()}else o.value="Mot de passe incorrect. Veuillez réessayer."}catch(b){L.error("Erreur lors de la vérification",b),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function v(){i.value=!0,l.value="",d.value="";try{const b=await h1(t.player.id,t.seasonId);d.value=b.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(b){L.error("Erreur lors de l'envoi de l'email",b),l.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function w(){r("close"),s.value="",o.value="",a.value=!1,l.value="",d.value=""}return Nt(()=>t.show,b=>{b&&Bt(()=>{h.value&&h.value.focus()})}),(b,x)=>{var M,O;return C(),N(xt,null,[n.show?(C(),N("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:w},[c("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:x[3]||(x[3]=mt(()=>{},["stop"]))},[c("div",_B,[x[7]||(x[7]=c("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[c("span",{class:"text-2xl"},"🔐")],-1)),x[8]||(x[8]=c("h2",{class:"text-2xl font-bold text-white mb-2"},"Vérification requise",-1)),c("p",bB,oe((M=n.player)==null?void 0:M.name),1),x[9]||(x[9]=c("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protégé par mot de passe",-1))]),c("div",wB,[c("div",xB,[c("div",null,[x[10]||(x[10]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),tt(c("input",{"onUpdate:modelValue":x[0]||(x[0]=A=>s.value=A),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:or(g,["enter"]),ref_key:"passwordInput",ref:h},null,544),[[Ut,s.value]])]),c("div",EB,[tt(c("input",{id:"staySignedIn",type:"checkbox","onUpdate:modelValue":x[1]||(x[1]=A=>f.value=A),class:"w-4 h-4"},null,512),[[Wr,f.value]]),x[11]||(x[11]=c("label",{for:"staySignedIn"},"Rester connecté sur cet appareil",-1))])]),c("button",{onClick:g,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(C(),N("span",TB,"⏳")):(C(),N("span",AB,"🔓")),c("span",null,oe(i.value?"Vérification...":"Vérifier"),1)],8,IB)]),c("div",SB,[c("button",{onClick:x[2]||(x[2]=A=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(C(),N("div",PB,[c("div",RB,oe(o.value),1)])):ae("",!0),c("div",{class:"flex justify-center"},[c("button",{onClick:w,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ae("",!0),a.value?(C(),N("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:x[6]||(x[6]=A=>a.value=!1)},[c("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:x[5]||(x[5]=mt(()=>{},["stop"]))},[c("div",CB,[x[12]||(x[12]=c("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[c("span",{class:"text-2xl"},"📧")],-1)),x[13]||(x[13]=c("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oublié",-1)),c("p",kB,oe((O=n.player)==null?void 0:O.name),1)]),c("div",DB,[x[14]||(x[14]=c("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),c("button",{onClick:v,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(C(),N("span",OB,"⏳")):(C(),N("span",VB,"📧")),c("span",null,oe(i.value?"Envoi...":"Envoyer l'email"),1)],8,NB)]),l.value?(C(),N("div",MB,[c("div",LB,oe(l.value),1)])):ae("",!0),d.value?(C(),N("div",$B,[c("div",FB,oe(d.value),1)])):ae("",!0),c("div",UB,[c("button",{onClick:x[4]||(x[4]=A=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ae("",!0)],64)}}},jB={class:"text-center mb-6"},BB={class:"text-sm text-gray-300"},qB={key:0,class:"space-y-4"},zB={key:0,class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},HB={key:1,class:"space-y-4"},KB=["disabled"],GB={key:0,class:"animate-spin"},WB={key:1},QB={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},JB={class:"mt-6 flex justify-center gap-3"},YB=["disabled"],XB={key:0,class:"animate-spin"},ZB={key:1},S1={__name:"AccountClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=e,s=S(1),i=S(""),o=S(""),a=S(""),l=S(!1),d=S(""),h=S(!1),f=_o(),g=He(()=>i.value&&i.value.includes("@")),v=He(()=>o.value&&a.value&&o.value===a.value&&o.value.length>=6);async function w(){var O,A,j;if(!(!g.value||!((O=t.player)!=null&&O.id))){l.value=!0,d.value="";try{const de=await i1({playerId:t.player.id,email:i.value.trim(),seasonId:t.seasonId}),re=(A=f.params)==null?void 0:A.slug,k=`${de.url}${re?`&slug=${encodeURIComponent(re)}`:""}&player=${encodeURIComponent(t.player.id)}&open=protection`;await YF({toEmail:i.value,playerName:((j=t.player)==null?void 0:j.name)||"joueur",verifyUrl:k}),h.value=!0}catch{d.value="Impossible d'envoyer l'email de vérification"}finally{l.value=!1}}}async function b(){try{await a1({playerId:t.player.id,seasonId:t.seasonId})}catch{}s.value=1,h.value=!1,i.value="",o.value="",a.value=""}async function x(){var O;try{const A=await nu((O=t.player)==null?void 0:O.id,t.seasonId);A!=null&&A.email&&(A!=null&&A.emailVerifiedAt)?s.value=2:s.value=1}catch{s.value=1}}Sn(()=>{x()}),Nt(()=>t.show,O=>{O&&x()});async function M(){if(v.value){l.value=!0,d.value="";try{await s1(t.player.id,i.value.trim(),o.value,t.seasonId),r("success")}catch(O){d.value=(O==null?void 0:O.message)||"Erreur lors de l'association"}finally{l.value=!1}}}return(O,A)=>{var j;return n.show?(C(),N("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:A[6]||(A[6]=de=>O.$emit("close"))},[c("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:A[5]||(A[5]=mt(()=>{},["stop"]))},[c("button",{onClick:A[0]||(A[0]=de=>O.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),c("div",jB,[A[7]||(A[7]=c("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[c("span",{class:"text-2xl"},"👤")],-1)),A[8]||(A[8]=c("h2",{class:"text-2xl font-bold text-white mb-1"},"Associer un compte",-1)),c("p",BB,"Pour sécuriser les saisies de "+oe((j=n.player)==null?void 0:j.name),1),Be(ny)]),s.value===1?(C(),N("div",qB,[c("div",null,[A[9]||(A[9]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),tt(c("input",{"onUpdate:modelValue":A[1]||(A[1]=de=>i.value=de),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Ut,i.value]])]),h.value?(C(),N("div",zB,[A[10]||(A[10]=c("span",null,"✅",-1)),c("span",null,"Un email a été envoyé à "+oe(i.value)+". Cliquez sur le lien contenu dans l'email pour continuer.",1)])):ae("",!0)])):s.value===2?(C(),N("div",HB,[c("div",{class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},[A[11]||(A[11]=c("span",null,"✅",-1)),A[12]||(A[12]=c("span",null,"Adresse email vérifiée",-1)),c("button",{type:"button",onClick:b,title:"Changer d'adresse email",class:"ml-auto px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-colors"},"✏️")]),c("div",null,[A[13]||(A[13]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),tt(c("input",{"onUpdate:modelValue":A[2]||(A[2]=de=>o.value=de),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé (min. 6 caractères)"},null,512),[[Ut,o.value]])]),c("div",null,[A[14]||(A[14]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),tt(c("input",{"onUpdate:modelValue":A[3]||(A[3]=de=>a.value=de),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[Ut,a.value]])]),c("button",{onClick:M,disabled:!v.value||l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(C(),N("span",GB,"⏳")):(C(),N("span",WB,"🔒")),c("span",null,oe(l.value?"Association...":"Associer ce joueur"),1)],8,KB)])):ae("",!0),d.value?(C(),N("div",QB,oe(d.value),1)):ae("",!0),c("div",JB,[s.value===1?(C(),N("button",{key:0,onClick:w,disabled:!g.value||l.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(C(),N("span",XB,"⏳")):(C(),N("span",ZB,"✉️")),c("span",null,oe(l.value?"Envoi...":"Envoyer le lien de vérification"),1)],8,YB)):ae("",!0),c("button",{onClick:A[4]||(A[4]=de=>O.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])):ae("",!0)}}},eq={class:"text-center mb-6"},tq={class:"text-2xl font-bold text-white mb-2"},nq={class:"text-lg text-gray-300"},rq={class:"mb-6"},sq={class:"flex items-center space-x-3"},iq={class:"text-2xl"},oq={class:"font-semibold text-white"},aq={class:"text-sm text-gray-300"},lq={key:0,class:"mb-6"},uq={key:1,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},cq={class:"text-red-300 text-sm"},dq={key:2,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},hq={class:"text-green-300 text-sm"},fq={class:"flex justify-center gap-3"},pq=["disabled"],mq={__name:"PlayerClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null},onboarding:{type:Boolean,default:!1}},emits:["close","update","onboarding-finished"],setup(n,{emit:e}){const t=n,r=e,s=S(!1),i=S(!1),o=S(!1),a=S(""),l=S(""),d=S(!1);_o();const h=S(!1);He(()=>!1),He(()=>!1);function f(){l.value="Compte créé et joueur associé !",s.value=!0,d.value=!1,r("update")}async function g(){var M;if((M=t.player)!=null&&M.id){s.value=await no(t.player.id,t.seasonId);try{const{isPlayerPasswordCached:O}=await dt(()=>Promise.resolve().then(()=>wa),void 0);i.value=O(t.player.id)}catch{i.value=!1}}}function v(){var M;a.value="";try{if((M=t.player)!=null&&M.id&&la(t.player.id)){w();return}}catch{}h.value=!0}async function w(){o.value=!0,a.value="",l.value="";try{const M=await l1(t.player.id,t.seasonId);l.value="Joueur déverrouillé!",s.value=!1,M.email&&(email.value=M.email),r("update")}catch(M){logger.error("Erreur lors de la désactivation de la protection",M),a.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{o.value=!1}}function b(){h.value=!1,w()}function x(){r("close")}return Nt(()=>t.player,()=>{t.show&&t.player&&g()},{immediate:!0}),Nt(()=>t.show,M=>{M&&t.player&&(a.value="",l.value="",h.value=!1,g(),t.onboarding&&Bt(()=>{}))}),(M,O)=>{var A;return C(),N(xt,null,[n.show?(C(),N("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:x},[c("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:O[1]||(O[1]=mt(()=>{},["stop"]))},[c("button",{onClick:x,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),c("div",eq,[O[4]||(O[4]=c("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[c("span",{class:"text-2xl"},"🔒")],-1)),c("h2",tq,oe(s.value?"Déverrouiller ce joueur":"Verrouiller ce joueur"),1),c("p",nq,oe((A=n.player)==null?void 0:A.name),1)]),c("div",rq,[c("div",{class:Qt(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[c("div",sq,[c("span",iq,oe(s.value?"🔒":"🔓"),1),c("div",null,[c("div",oq,oe(s.value?i.value?"Joueur associé à votre compte":"Ce joueur est associé à un compte utilisateur":"Joueur sans compte"),1),c("div",aq,oe(s.value?i.value?"Seul vous pouvez modifier":"Seul le titulaire peut modifier les disponibilités":"Tout le monde peut modifier les disponibilités"),1)])])],2)]),s.value?ae("",!0):(C(),N("div",lq,O[5]||(O[5]=[c("div",{class:"text-sm text-gray-300"},"Vous pouvez protéger vos saisies de disponibilités avec un compte utilisateur.",-1)]))),a.value?(C(),N("div",uq,[c("div",cq,oe(a.value),1)])):ae("",!0),l.value?(C(),N("div",dq,[c("div",hq,oe(l.value),1)])):ae("",!0),c("div",fq,[s.value?(C(),N("button",{key:1,onClick:v,disabled:o.value,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," 🔓 Dissocier ",8,pq)):(C(),N("button",{key:0,onClick:O[0]||(O[0]=j=>d.value=!0),class:"px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300"}," Associer un compte ")),c("button",{onClick:x,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ae("",!0),Be(S1,{show:d.value,player:n.player,"season-id":n.seasonId,onClose:O[2]||(O[2]=j=>d.value=!1),onSuccess:f},null,8,["show","player","season-id"]),Be(ay,{show:h.value,player:n.player,seasonId:n.seasonId,onClose:O[3]||(O[3]=j=>h.value=!1),onVerified:b},null,8,["show","player","seasonId"])],64)}}};const gq={class:"relative p-4 md:p-6 border-b border-white/10"},vq={class:"flex items-start gap-4 md:gap-6"},yq={class:"flex-1 min-w-0"},_q={class:"flex items-center gap-3 mb-2"},bq={class:"text-xl md:text-2xl font-bold text-white leading-tight"},wq={class:"flex items-center gap-2"},xq={key:0,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border border-yellow-500/30 rounded-full"},Eq={key:1,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30 rounded-full"},Iq={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},Tq={class:"grid grid-cols-3 gap-3 md:gap-4"},Aq={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},Sq={class:"text-xl md:text-2xl font-bold text-white"},Pq={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},Rq={class:"text-xl md:text-2xl font-bold text-white"},Cq={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30 text-center"},kq={class:"text-xl md:text-2xl font-bold text-white"},Dq={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},Nq={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},Oq={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},Vq={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},Mq={class:"mb-6"},Lq={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null},onboardingStep:{type:Number,default:0},onboardingPlayerId:{type:[String,null],default:null},isProtected:{type:Boolean,default:!1},isPreferred:{type:Boolean,default:!1}},emits:["close","update","delete","refresh","advance-onboarding"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=S(!1),o=S(""),a=S(null),l=S(!1),d=S(!1),h=S(null);S(!1);const f=S(!1),g=S(!1),v=S(null),w=S(null),b=S({position:"fixed",top:"0px",left:"0px"}),x=S(null),M=S({position:"fixed",top:"0px",left:"0px"}),O=S(!1),A=S(!1);function j(){s("close"),f.value=!1,g.value=!1,b.value={position:"fixed",top:"0px",left:"0px"},M.value={position:"fixed",top:"0px",left:"0px"}}function de(){var se;o.value=((se=r.player)==null?void 0:se.name)||"",i.value=!0,Bt(()=>{a.value&&a.value.focus()})}function re(){i.value=!1,o.value=""}async function k(){var B,Se;if(!o.value.trim())return;if(await no((B=r.player)==null?void 0:B.id,r.seasonId)){la((Se=r.player)==null?void 0:Se.id)?I():(h.value="update",d.value=!0);return}I()}function I(){var se;s("update",{playerId:(se=r.player)==null?void 0:se.id,newName:o.value.trim()}),i.value=!1,o.value=""}async function T(){var B,Se;if(await no((B=r.player)==null?void 0:B.id,r.seasonId)){la((Se=r.player)==null?void 0:Se.id)?V():(h.value="delete",d.value=!0);return}V()}function V(){var se;s("delete",(se=r.player)==null?void 0:se.id)}function U(){s("refresh")}function $(se){h.value==="update"?I():h.value==="delete"&&V(),h.value=null}function D(){try{const se=v.value;if(!se)return;const B=se.getBoundingClientRect(),Se=8;if(window.innerWidth>768){const ne=Math.max(Se,Math.round(B.top-Se)),te=Math.max(Se,Math.round(B.left));b.value={position:"fixed",top:`${ne}px`,left:`${te}px`,zIndex:400}}else{const ne=Math.min(window.innerHeight-Se,Math.round(B.bottom+Se)),te=Math.max(Se,Math.round(B.left));b.value={position:"fixed",top:`${ne}px`,left:`${te}px`,zIndex:400}}}catch{}}function je(){try{const ne=Math.max(8,window.innerHeight-8-48-120),te=Math.max(8,Math.round(window.innerWidth-200-8));M.value={position:"fixed",top:`${ne}px`,left:`${te}px`,zIndex:400}}catch{}}function Tt(){f.value=!f.value,f.value&&Bt(()=>D())}function yt(){g.value=!g.value,g.value&&Bt(()=>je())}Nt(()=>r.show,se=>{var B;se||(i.value=!1,o.value="",h.value=null,l.value=!1,f.value=!1,g.value=!1),se&&((B=r.player)!=null&&B.id)&&(no(r.player.id,r.seasonId).then(Se=>{O.value=!!Se}),dt(()=>Promise.resolve().then(()=>wa),void 0).then(Se=>{try{A.value=!!Se.isPlayerPasswordCached(r.player.id)}catch{A.value=!1}}))}),Sn(()=>{document.addEventListener("click",se=>{if(f.value){const B=v.value,Se=w.value,ne=B&&B.contains(se.target),te=Se&&Se.contains(se.target);!ne&&!te&&(f.value=!1)}if(g.value){const B=x.value;B&&B.contains(se.target)||(g.value=!1)}}),document.addEventListener("keydown",se=>{se.key==="Escape"&&(f.value&&(f.value=!1),g.value&&(g.value=!1))}),window.addEventListener("resize",()=>{f.value&&D(),g.value&&je()}),window.addEventListener("scroll",()=>{f.value&&D(),g.value&&je()},{passive:!0})}),e({openProtection(){l.value=!0}});const We=S({position:null});return Nt(()=>r.show,se=>{se&&r.onboardingStep===4?Bt(()=>{const B=document.querySelectorAll("button");let Se=null;if(B.forEach(ne=>{!Se&&ne.textContent&&ne.textContent.includes("Protection")&&(Se=ne)}),Se){const ne=Se.getBoundingClientRect();We.value.position={x:Math.round(ne.right+8),y:Math.round(ne.top+window.scrollY-4)}}}):se||(We.value.position=null)}),(se,B)=>{var Se;return C(),N(xt,null,[n.show?(C(),N("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:j},[c("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-xl max-h-[92vh] flex flex-col",onClick:B[6]||(B[6]=mt(()=>{},["stop"]))},[c("div",gq,[c("button",{onClick:j,class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),c("div",vq,[B[15]||(B[15]=c("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full flex-shrink-0 flex items-center justify-center"},[c("span",{class:"text-xl md:text-2xl"},"👤")],-1)),c("div",yq,[c("div",_q,[c("h2",bq,oe((Se=n.player)==null?void 0:Se.name),1),c("div",wq,[n.isProtected?(C(),N("div",xq,B[13]||(B[13]=[c("span",{class:"text-yellow-400 text-sm"},"🔒",-1),c("span",{class:"text-yellow-300 text-xs font-medium"},"Protégé",-1)]))):ae("",!0),n.isPreferred?(C(),N("div",Eq,B[14]||(B[14]=[c("span",{class:"text-purple-400 text-sm"},"⭐",-1),c("span",{class:"text-purple-300 text-xs font-medium"},"Favori",-1)]))):ae("",!0)])])])])]),c("div",Iq,[c("div",null,[c("div",Tq,[c("div",Aq,[c("div",Sq,oe(r.stats.availability),1),B[16]||(B[16]=c("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibilités",-1))]),c("div",Pq,[c("div",Rq,oe(r.stats.selection),1),B[17]||(B[17]=c("div",{class:"text-xs md:text-sm text-gray-300"},"Sélections",-1))]),c("div",Cq,[c("div",kq,oe(r.stats.ratio),1),B[18]||(B[18]=c("div",{class:"text-xs md:text-sm text-gray-300"},"% de sélection",-1))])])]),c("div",Dq,[c("button",{onClick:B[0]||(B[0]=ne=>l.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},[c("span",null,oe(O.value?"🔓":"🔒"),1),c("span",null,oe(O.value?"Déverrouiller":"Verrouiller"),1)]),c("div",{class:"relative",ref_key:"playerMoreActionsRef",ref:v},[c("button",{onClick:B[1]||(B[1]=ne=>Tt()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},B[19]||(B[19]=[c("span",null,"⋯",-1),c("span",null,"Plus",-1)]))],512),c("button",{onClick:j,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer "),(C(),ti(ec,{to:"body"},[f.value?(C(),N("div",{key:0,ref_key:"playerMoreActionsDropdownRef",ref:w,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:Mr(b.value)},[c("button",{onClick:B[2]||(B[2]=ne=>{de(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},B[20]||(B[20]=[c("span",null,"✏️",-1),c("span",null,"Renommer",-1)])),c("button",{onClick:B[3]||(B[3]=ne=>{T(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},B[21]||(B[21]=[c("span",null,"🗑️",-1),c("span",null,"Supprimer",-1)]))],4)):ae("",!0)]))])]),c("div",Nq,[c("button",{onClick:B[4]||(B[4]=ne=>l.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"},oe(O.value?"🔓 Déverrouiller":"🔒 Verrouiller"),1),c("button",{onClick:B[5]||(B[5]=ne=>yt()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ "),c("button",{onClick:j,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer ")])])])):ae("",!0),(C(),ti(ec,{to:"body"},[g.value?(C(),N("div",{key:0,ref_key:"playerMoreActionsMobileDropdownRef",ref:x,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:Mr(M.value)},[c("button",{onClick:B[7]||(B[7]=ne=>{de(),g.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},B[22]||(B[22]=[c("span",null,"✏️",-1),c("span",null,"Renommer",-1)])),c("button",{onClick:B[8]||(B[8]=ne=>{T(),g.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},B[23]||(B[23]=[c("span",null,"🗑️",-1),c("span",null,"Supprimer",-1)]))],4)):ae("",!0)])),i.value?(C(),N("div",Oq,[c("div",Vq,[B[25]||(B[25]=c("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Renommer le joueur",-1)),c("div",Mq,[B[24]||(B[24]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),tt(c("input",{"onUpdate:modelValue":B[9]||(B[9]=ne=>o.value=ne),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[or(re,["esc"]),or(k,["enter"])],ref_key:"editNameInput",ref:a},null,544),[[Ut,o.value]])]),c("div",{class:"flex justify-end space-x-3"},[c("button",{onClick:re,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),c("button",{onClick:k,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ae("",!0),Be(mq,{show:l.value,player:n.player,seasonId:n.seasonId,onboarding:n.onboardingStep===4,onClose:B[10]||(B[10]=ne=>l.value=!1),onUpdate:U,onOnboardingFinished:B[11]||(B[11]=ne=>se.$emit("advance-onboarding",5))},null,8,["show","player","seasonId","onboarding"]),Be(ay,{show:d.value,player:n.player,seasonId:n.seasonId,onClose:B[12]||(B[12]=ne=>d.value=!1),onVerified:$},null,8,["show","player","seasonId"])],64)}}},$q=Ff(Lq,[["__scopeId","data-v-8237d7ee"]]),Fq={class:"relative p-6 pb-4 border-b border-white/10"},Uq={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},jq={__name:"HowItWorksModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(C(),N("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[c("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=mt(()=>{},["stop"]))},[c("div",Fq,[c("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=c("div",{class:"flex items-center gap-3"},[c("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-2xl"},"❓"),c("div",null,[c("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Comment fonctionne la sélection automatique ?"),c("p",{class:"text-sm text-blue-300"},"Tirage au sort pondéré pour favoriser l'équité")])],-1))]),s[5]||(s[5]=_r('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">En bref</h3><p>On tire au sort uniquement parmi les joueurs <span class="text-green-300">disponibles</span>. Ceux qui ont <span class="text-purple-300">moins joué</span> ont plus de chances d&#39;être tirés. À long terme, tout le monde joue à peu près autant.</p></div><div class="space-y-3"><h3 class="text-white font-semibold">Détails du tirage</h3><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><span class="text-white">Qui participe ?</span> Tous les joueurs marqués « ✅ Disponible » pour l’événement.</li><li><span class="text-white">Un coup de pouce aux moins joués</span> : si vous avez moins joué récemment, le tirage vous favorise un peu plus.</li><li><span class="text-white">Comment se fait le tirage ?</span> On tire un nom au hasard en tenant compte de cet avantage, on le met de côté, puis on recommence jusqu’à avoir assez de joueurs.</li><li><span class="text-white">Si on relance</span> : on garde les joueurs encore disponibles et on complète seulement les places manquantes.</li><li><span class="text-white">Indisponibles</span> : ils ne sont jamais tirés au sort.</li></ol></div><div class="space-y-2"><h3 class="text-white font-semibold">Estimation des chances</h3><p>L’application peut afficher un pourcentage indicatif pour aider à comprendre : si Alice a moins joué que Bob, elle aura un pourcentage plus élevé. C’est une indication, pas une promesse : deux tirages peuvent donner des résultats différents.</p></div><div class="space-y-2"><h3 class="text-white font-semibold">Pourquoi c’est juste</h3><ul class="list-disc list-inside space-y-1 text-gray-300"><li>Ceux qui ont moins joué ont automatiquement plus de chances.</li><li>Après une sélection, vos chances diminuent un peu pour laisser la place aux autres.</li><li>Sur la durée, les sélections s’<span class="text-green-300">équilibrent naturellement</span>.</li></ul></div><div class="space-y-2"><h3 class="text-white font-semibold">Exemples rapides</h3><p> • Alice n’a encore jamais été sélectionnée, Bob a été sélectionné une fois, Charlie plusieurs fois. Pour 1 place, on aura environ : Alice 57 %, Bob 29 %, Charlie 14 %.<br> • S’il y a 2 places, les chances de chacun augmentent, mais l’ordre reste aléatoire : un tirage peut donner Alice + Bob, un autre Alice + Charlie. </p></div><div class="text-xs text-gray-400"> Remarque : l’algorithme favorise l’équité à long terme, mais <span class="text-gray-300">n’assure pas</span> une rotation parfaite à chaque événement. </div></div>',1)),c("div",Uq,[c("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ae("",!0)}},Bq={class:"relative p-4 md:p-6 border-b border-white/10"},qq={class:"flex items-start gap-4 md:gap-6"},zq={class:"flex-1 min-w-0"},Hq={class:"text-xl md:text-2xl font-bold text-white leading-tight mb-2"},Kq={class:"flex items-center gap-3"},Gq={class:"text-base md:text-lg text-purple-300"},Wq={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},Qq={class:"text-blue-200"},Jq={key:0,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm flex items-center gap-1",title:"Prêt pour la sélection"},Yq={key:1,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded text-sm flex items-center gap-1",title:"Sélection complète"},Xq={key:2,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded text-sm flex items-center gap-1",title:"Sélection incomplète"},Zq={key:3,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded text-sm flex items-center gap-1",title:"Pas assez de joueurs disponibles"},e9={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},t9={class:"grid grid-cols-3 gap-3 md:gap-4 mb-4"},n9={class:"bg-gradient-to-r from-yellow-500/20 to-orange-500/20 p-3 md:p-4 rounded-lg border border-yellow-500/30 text-center"},r9={class:"text-xl md:text-2xl font-bold text-yellow-300"},s9={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},i9={class:"text-xl md:text-2xl font-bold text-white"},o9={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},a9={class:"text-xl md:text-2xl font-bold text-white"},l9={class:"mb-3"},u9={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},c9={key:0,class:"flex items-center justify-between gap-2"},d9=["title"],h9={key:0,class:"text-purple-400 mr-2"},f9={key:1,class:"text-green-400 mr-2"},p9={key:2,class:"text-red-400 mr-2"},m9={key:3,class:"text-gray-400 mr-2"},g9=["onClick"],v9={key:1,class:"flex items-center justify-center"},y9=["onChange"],_9=["value"],b9=["onClick"],w9={key:0,class:"mb-3"},x9={key:1,class:"mb-3"},E9={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},I9={class:"flex-1"},T9={class:"text-blue-300 text-sm font-medium"},A9={class:"sticky bottom-0 w-full p-3 bg-gray-900/80 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},S9=["disabled","title"],P9=["disabled"],R9={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]}},emits:["close","selection","perfect","send-notifications","updateSelection"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=S(!1),o=S("Copier le message"),a=S(!1),l=S(!1),d=S(""),h=S(!1),f=S(!1),g=He(()=>{var ne;return((ne=r.event)==null?void 0:ne.playerCount)||6}),v=S([]),w=S(null),b=He(()=>(r.players||[]).map(ne=>ne.name).filter(ne=>{var te;return((te=r.playerAvailability)==null?void 0:te[ne])===!0}).sort((ne,te)=>ne.localeCompare(te,"fr",{sensitivity:"base"})));function x(ne){const te=new Set(v.value.filter(Boolean)),De=v.value[ne];return De&&te.delete(De),b.value.filter(gt=>!te.has(gt))}function M(ne){w.value=ne}function O(){w.value=null}async function A(ne,te){var gt;const De=((gt=ne==null?void 0:ne.target)==null?void 0:gt.value)||"";De&&(v.value[te]=De,await U()),w.value=null}async function j(ne){v.value[ne]=null,await U()}He(()=>(x(-1).length<g.value,""));const de=He(()=>r.currentSelection&&r.currentSelection.length>0);function re(){var gt;const ne=r.currentSelection||[],te=((gt=r.event)==null?void 0:gt.playerCount)||6,De=r.availableCount||0;if(ne.length>0){const At=ne.some(J=>!Tt(J)),St=De<te;if(At||St)return{type:"incomplete",hasUnavailablePlayers:At,hasInsufficientPlayers:St,unavailablePlayers:ne.filter(J=>!Tt(J)),availableCount:De,requiredCount:te}}return De<te?{type:"insufficient",availableCount:De,requiredCount:te}:ne.length===0?{type:"ready",availableCount:De,requiredCount:te}:{type:"complete",availableCount:De,requiredCount:te}}const k=He(()=>{var gt;if(!de.value)return!1;const ne=r.currentSelection.some(At=>!Tt(At)),te=((gt=r.event)==null?void 0:gt.playerCount)||6,De=r.availableCount<te;return ne||De});He(()=>{var De;if(!k.value)return"";const ne=r.currentSelection.filter(gt=>!Tt(gt)),te=((De=r.event)==null?void 0:De.playerCount)||6;return ne.length>0?ne.length===1?`${ne[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${ne.length} joueurs ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<te?`Seulement ${r.availableCount} joueurs disponibles pour ${te} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de joueurs à sélectionner.`:"Sélection incomplète"}),He(()=>{if(!r.event||!de.value)return"";const ne=I(r.event.date),te=r.currentSelection.join(", ");return`Sélection pour ${r.event.title} du ${ne} : ${te}`}),Nt(()=>r.show,ne=>{if(ne){i.value=!1,o.value="Copier le message",l.value=!1,d.value="",h.value=!1,a.value=!1;const te=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],De=g.value;v.value=Array.from({length:De},(gt,At)=>te[At]||null),w.value=null}}),Nt([g,()=>r.currentSelection,()=>{var ne;return(ne=r.event)==null?void 0:ne.id}],()=>{if(!r.show)return;const ne=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],te=g.value,De=Array.from({length:te},(gt,At)=>ne[At]||v.value[At]||null);v.value=De.slice(0,te)});function I(ne){var De;return ne?(typeof ne=="string"?new Date(ne):((De=ne.toDate)==null?void 0:De.call(ne))||ne).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function T(){s("selection")}function V(){s("perfect")}async function U(){var ne;if(!(!((ne=r.event)!=null&&ne.id)||!r.seasonId))try{const te=v.value.filter(Boolean);await zm(r.event.id,te,r.seasonId),console.debug("Sélection sauvegardée automatiquement")}catch(te){console.error("Erreur lors de la sauvegarde automatique:",te)}}function $(){s("close")}function D(){a.value=!0}function je(){f.value=!0}function Tt(ne){return r.playerAvailability[ne]===!0}function yt(ne){return r.playerAvailability[ne]===!1}function We(ne){return r.currentSelection.includes(ne)&&Tt(ne)}function se(ne=!1,te=!1){if(h.value=ne,ne){const De=I(r.event.date),gt=r.currentSelection.join(", ");te?d.value=`Sélection mise à jour pour ${r.event.title} du ${De} : ${gt}. Pensez à prévenir les joueurs via le bouton "Annoncer" !`:d.value=`Nouvelle sélection pour ${r.event.title} du ${De} : ${gt}. Pensez à prévenir les joueurs via le bouton "Annoncer" !`}else d.value="Sélection effectuée avec succès !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function B(){l.value=!1}e({showSuccess:se});function Se(ne){s("send-notifications",ne)}return(ne,te)=>{var De,gt,At,St;return C(),N(xt,null,[n.show?(C(),N("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:$},[c("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:te[1]||(te[1]=mt(()=>{},["stop"]))},[c("div",Bq,[c("button",{onClick:$,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),c("div",qq,[te[9]||(te[9]=c("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[c("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),c("div",zq,[c("h2",Hq,"Sélection pour "+oe((De=n.event)==null?void 0:De.title),1),c("div",Kq,[c("p",Gq,oe(I((gt=n.event)==null?void 0:gt.date)),1),c("div",Wq,[te[4]||(te[4]=c("span",{class:"text-blue-300"},"👥",-1)),c("span",Qq,oe(((At=n.event)==null?void 0:At.playerCount)||6)+" joueurs",1)]),re().type==="ready"?(C(),N("div",Jq,te[5]||(te[5]=[c("span",{class:"text-blue-300 text-xs"},"🆕",-1),c("span",{class:"text-blue-200 text-xs"},"Nouveau",-1)]))):re().type==="complete"?(C(),N("div",Yq,te[6]||(te[6]=[c("span",{class:"text-green-300 text-xs"},"✅",-1),c("span",{class:"text-green-200 text-xs"},"Complet",-1)]))):re().type==="incomplete"?(C(),N("div",Xq,te[7]||(te[7]=[c("span",{class:"text-orange-300 text-xs"},"⚠️",-1),c("span",{class:"text-orange-200 text-xs"},"À finaliser",-1)]))):re().type==="insufficient"?(C(),N("div",Zq,te[8]||(te[8]=[c("span",{class:"text-red-300 text-xs"},"❌",-1),c("span",{class:"text-red-200 text-xs"},"Manque",-1)]))):ae("",!0)])])])]),c("div",e9,[c("div",t9,[c("div",n9,[c("div",r9,oe(Math.max((((St=n.event)==null?void 0:St.playerCount)||6)-n.selectedCount,0)),1),te[10]||(te[10]=c("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))]),c("div",s9,[c("div",i9,oe(n.availableCount),1),te[11]||(te[11]=c("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),c("div",o9,[c("div",a9,oe(n.selectedCount),1),te[12]||(te[12]=c("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))])]),c("div",l9,[c("div",{class:"flex items-center gap-2 mb-2"},[te[14]||(te[14]=c("h3",{class:"text-base md:text-lg font-semibold text-white"},"Joueurs sélectionnés",-1)),c("button",{onClick:je,class:"text-blue-300 hover:text-blue-200 p-1 rounded-full hover:bg-blue-500/10 transition-colors",title:"Comment fonctionne la sélection automatique ?"},te[13]||(te[13]=[c("span",{class:"text-sm"},"❓",-1)]))]),c("div",u9,[(C(!0),N(xt,null,Lr(v.value,(J,xe)=>(C(),N("div",{key:"sel-slot-"+xe,class:Qt(["relative p-3 rounded-lg border text-center transition-colors",J?["bg-gradient-to-r",yt(J)?"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":Tt(J)?"from-green-500/20 to-emerald-500/20 border-green-500/30":"from-red-500/20 to-red-600/20 border-red-500/30"]:"border-dashed border-white/20 hover:border-white/40 bg-white/5"])},[J?(C(),N("div",c9,[c("div",{class:"flex-1 text-white font-medium truncate",title:J},[We(J)?(C(),N("span",h9,"🎭")):Tt(J)?(C(),N("span",f9,"✅")):yt(J)?(C(),N("span",p9,"❌")):(C(),N("span",m9,"–")),ft(" "+oe(J),1)],8,d9),c("button",{onClick:be=>j(xe),class:"text-white/80 hover:text-white rounded-full hover:bg-white/10 px-2 py-1",title:"Retirer ce joueur"}," × ",8,g9)])):(C(),N("div",v9,[w.value===xe?(C(),N("select",{key:0,class:"w-full bg-gray-800 text-white rounded-md p-2 border border-white/20 focus:outline-none",onChange:be=>A(be,xe),onBlur:te[0]||(te[0]=be=>O())},[te[15]||(te[15]=c("option",{value:""},"— Choisir —",-1)),(C(!0),N(xt,null,Lr(x(xe),be=>(C(),N("option",{key:be,value:be},oe(be),9,_9))),128))],40,y9)):(C(),N("button",{key:1,onClick:be=>M(xe),class:"flex items-center gap-2 text-white/80 hover:text-white px-2 py-1 rounded-md hover:bg-white/10",title:"Ajouter un joueur"},te[16]||(te[16]=[c("span",{class:"text-lg"},"＋",-1),c("span",{class:"text-sm"},"Ajouter",-1)]),8,b9))]))],2))),128))])]),de.value?(C(),N("div",w9,te[17]||(te[17]=[c("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[c("div",{class:"text-yellow-400"},"⚠️"),c("div",{class:"text-yellow-200 text-sm"},"Pensez à prévenir les gens de vos changements !")],-1)]))):ae("",!0),l.value?(C(),N("div",x9,[c("div",E9,[te[19]||(te[19]=c("div",{class:"text-blue-400 text-xl"},"✨",-1)),c("div",I9,[c("p",T9,oe(d.value),1)]),c("button",{onClick:B,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},te[18]||(te[18]=[c("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):ae("",!0)]),c("div",A9,[c("button",{onClick:T,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":de.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},te[20]||(te[20]=[ft(" ✨ "),c("span",{class:"hidden sm:inline"},"Sélection Auto",-1),c("span",{class:"sm:hidden"},"Auto",-1)]),8,S9),c("button",{onClick:D,disabled:!de.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},te[21]||(te[21]=[ft(" 📣 "),c("span",{class:"hidden sm:inline"},"Annoncer",-1),c("span",{class:"sm:hidden"},"Annoncer",-1)]),8,P9),c("button",{onClick:V,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 whitespace-nowrap"},te[22]||(te[22]=[c("span",{class:"hidden sm:inline"},"Fermer",-1),c("span",{class:"sm:hidden"},"Fermer",-1)]))])])])):ae("",!0),Be(A1,{show:a.value,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,mode:"selection","selected-players":n.currentSelection,onClose:te[2]||(te[2]=J=>a.value=!1),onSendNotifications:Se},null,8,["show","event","season-id","season-slug","players","selected-players"]),Be(jq,{show:f.value,onClose:te[3]||(te[3]=J=>f.value=!1)},null,8,["show"])],64)}}},C9={class:"flex flex-col items-center justify-center"},k9={key:0,class:"text-center"},D9={key:1,class:"text-center"},N9={key:2,class:"text-center"},O9={key:3,class:"text-center text-gray-400"},V9=["title"],Qb={__name:"AvailabilityCell",props:{playerName:{type:String,required:!0},compact:{type:Boolean,default:!1},eventId:{type:String,required:!0},isAvailable:{type:Boolean,default:null},isSelected:{type:Boolean,default:!1},chancePercent:{type:Number,default:null},showSelectedChance:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["toggle"],setup(n,{emit:e}){const t=n,r=e,s=S(!1),i=He(()=>!(t.chancePercent==null||t.isAvailable!==!0)),o=He(()=>t.disabled?"Événement archivé — désarchivez pour modifier":t.isSelected&&t.isAvailable===!0?i.value?`${t.playerName} est sélectionné pour cet événement • avait ~${t.chancePercent}% de chances`:`${t.playerName} est sélectionné pour cet événement`:t.isAvailable===!0?t.chancePercent!=null?`${t.playerName} est disponible • ~${t.chancePercent}% de chances d'être sélectionné`:`${t.playerName} est disponible`:t.isAvailable===!1?`${t.playerName} n'est pas disponible`:`Cliquer pour indiquer la disponibilité de ${t.playerName}`);function a(){t.disabled||r("toggle",t.playerName,t.eventId)}return(l,d)=>(C(),N("div",{class:Qt(["flex items-center justify-center transition-all duration-200 rounded font-medium text-white mx-0.5 my-0.25",[n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer hover:scale-105",n.compact?"min-h-0 p-1 md:p-2 text-xs":"min-h-20 p-2 md:p-3 text-sm",n.isSelected&&n.isAvailable===!0?"bg-gradient-to-br from-purple-500/60 to-pink-500/60":"",!n.isSelected&&n.isAvailable===!0?"bg-green-500/60":"",n.isAvailable===!1?"bg-red-500/60":"",n.isAvailable===null||n.isAvailable===void 0?"bg-gray-500/40":""]]),onClick:a,onMouseenter:d[0]||(d[0]=h=>s.value=!0),onMouseleave:d[1]||(d[1]=h=>s.value=!1)},[c("div",C9,[n.isSelected&&n.isAvailable===!0?(C(),N("span",k9," Joue ")):n.isAvailable===!0?(C(),N("span",D9," Disponible ")):n.isAvailable===!1?(C(),N("span",N9," Pas disponible ")):(C(),N("span",O9," – ")),i.value&&n.isAvailable===!0?(C(),N("span",{key:4,class:"text-[10px] md:text-xs px-1.5 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 mt-1",title:o.value},oe(n.chancePercent)+"% ",9,V9)):ae("",!0)])],34))}},M9={key:0,class:"fixed inset-0 z-[130] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},L9={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},$9={class:"text-2xl md:text-3xl font-bold text-white mb-3"},F9={class:"text-gray-300 mb-6"},U9={class:"flex flex-col items-stretch justify-center gap-3"},j9=["value"],B9={__name:"CreatorOnboardingModal",props:{seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},onboardingDone:{type:Boolean,default:!1}},emits:["create-event","add-player","copy-link","dismissed"],setup(n,{emit:e}){const t=n,r=e,s=window.location.origin,i=He(()=>`${s}/season/${t.seasonSlug}`),o=S(!1);try{t.seasonId&&(o.value=!!localStorage.getItem(`dismissCreatorOnboarding:${t.seasonId}`))}catch{}const a=He(()=>t.onboardingDone?0:t.eventsCount===0&&t.playersCount===0?1:t.eventsCount>0&&t.playersCount===0?2:t.eventsCount>0&&t.playersCount>0&&!o.value?3:0),l=He(()=>a.value>0),d=S(l.value);Nt(a,x=>{d.value=x>0});const h=He(()=>{switch(a.value){case 1:return"Commençons par créer votre premier événement";case 2:return"Super ! Ajoutez votre premier joueur";case 3:return"Vous y êtes presque! Maintenant, invitez vos joueurs.";default:return""}}),f=He(()=>{switch(a.value){case 1:return"Un titre, une date... et c’est parti.";case 2:return"Ajoutez au moins un joueur pour commencer à saisir des disponibilités.";case 3:return"Laissez vos membres s’inscrire eux-même et indiquer leurs disponibilités en leur envoyant le lien direct.";default:return""}});function g(){d.value=!1,r("create-event")}function v(){d.value=!1,r("add-player")}function w(){var x;try{(x=navigator.clipboard)==null||x.writeText(i.value)}catch{}r("copy-link")}async function b(){try{if(t.seasonId){const{db:x}=await dt(()=>Promise.resolve().then(()=>Yr),void 0),{doc:M,updateDoc:O}=await dt(()=>import("./index.esm-7beab343.js"),[]);await O(M(x,"seasons",t.seasonId),{onboardingCreatorDone:!0})}else localStorage.setItem("dismissCreatorOnboarding","1")}catch{}o.value=!0,d.value=!1,r("dismissed")}return(x,M)=>l.value&&d.value?(C(),N("div",M9,[c("div",L9,[M[1]||(M[1]=c("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[c("span",{class:"text-3xl"},"🎬")],-1)),c("h2",$9,oe(h.value),1),c("p",F9,oe(f.value),1),c("div",U9,[a.value===1?(C(),N("button",{key:0,onClick:g,class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all"}," ✨ Créer un événement ")):a.value===2?(C(),N("button",{key:1,onClick:v,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"}," 👤 Ajouter un joueur ")):a.value===3?(C(),N(xt,{key:2},[c("input",{value:i.value,type:"text",readonly:"",class:"w-full px-3 py-2 bg-gray-800 border border-white/20 rounded-lg text-white text-sm select-all",onFocus:M[0]||(M[0]=O=>O.target.select())},null,40,j9),c("div",{class:"flex gap-3 justify-center"},[c("button",{onClick:w,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"}," 🔗 Copier le lien "),c("button",{onClick:b,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"}," J’ai compris ")])],64)):ae("",!0)])])])):ae("",!0)}},q9={class:"sticky top-0 z-[60] text-center py-3 md:py-6 px-2 md:px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},z9={class:"text-2xl md:text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent px-6 md:px-16 truncate max-w-full"},H9={class:"absolute right-1 md:right-4 top-1/2 -translate-y-1/2 flex items-center gap-1 md:gap-2"},K9={class:"hidden md:flex items-center gap-2"},G9={class:"md:hidden"},W9={__name:"SeasonHeader",props:{seasonName:{type:String,default:""},isScrolled:{type:Boolean,default:!1}},emits:["go-back","open-account-menu","open-help","open-notifications","open-players","logout","open-login","open-account"],setup(n,{emit:e}){const t=n,r=e,s=S(null),i=He(()=>{var b;return!!s.value&&!((b=s.value)!=null&&b.isAnonymous)}),o=He(()=>t.isScrolled?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700":"bg-white/10 hover:bg-white/20 text-white border-white/20 hover:border-white/40");function a(b){s.value=b}Sn(()=>{s.value=$e.currentUser;const b=$e.onAuthStateChanged(a);window._seasonHeaderUnsubscribe=b}),ei(()=>{window._seasonHeaderUnsubscribe&&(window._seasonHeaderUnsubscribe(),delete window._seasonHeaderUnsubscribe)});function l(){r("go-back")}function d(){r("open-account-menu")}function h(){r("open-login")}function f(){r("open-help")}function g(){r("open-notifications")}function v(){r("open-players")}function w(){r("logout")}return(b,x)=>(C(),N("div",q9,[c("button",{onClick:l,class:"absolute left-1 md:left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-1.5 md:p-2 rounded-full hover:bg-white/10",title:"Retour aux saisons"},x[0]||(x[0]=[c("svg",{class:"w-6 h-6 md:w-8 md:h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),c("h1",z9,oe(n.seasonName?n.seasonName:"Chargement..."),1),c("div",H9,[c("div",K9,[Be(qm,{"is-connected":i.value,"button-class":o.value,onOpenAccountMenu:d,onOpenHelp:f,onOpenNotifications:g,onOpenPlayers:v,onLogout:w,onOpenLogin:h},null,8,["is-connected","button-class"]),i.value?ae("",!0):(C(),N("button",{key:0,onClick:f,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Kezako ?","aria-label":"Kezako ?"},x[1]||(x[1]=[c("span",{class:"text-2xl"},"❓",-1)])))]),c("div",G9,[Be(qm,{"is-connected":i.value,"button-class":o.value,onOpenAccountMenu:d,onOpenHelp:f,onOpenNotifications:g,onOpenPlayers:v,onLogout:w,onOpenLogin:h},null,8,["is-connected","button-class"])])])]))}},Q9={key:0,class:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/50"},J9={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-2xl shadow-2xl w-full max-w-md p-6 relative"},Y9={class:"text-center mb-6"},X9={class:"text-gray-300 text-sm"},Z9={class:"font-medium text-white"},ez={key:0,class:"space-y-4"},tz=["disabled"],nz={key:0,class:"mt-2 text-xs"},rz={key:0,class:"text-green-400"},sz={key:1,class:"text-red-400"},iz={class:"flex gap-3"},oz=["disabled"],az={key:0,class:"animate-spin"},lz={key:1},uz={key:1,class:"text-center"},cz={class:"text-green-400 text-sm mb-4"},dz={class:"font-medium text-white"},hz={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg"},fz={class:"text-red-300 text-sm"},pz={__name:"NotificationPromptModal",props:{show:{type:Boolean,default:!1},playerName:{type:String,required:!0},eventTitle:{type:String,required:!0},seasonId:{type:String,required:!0},seasonSlug:{type:String,required:!0},eventId:{type:String,required:!0}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S(!1),o=S(""),a=S(!1),l=He(()=>{const h=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,f=s.value,g=h.test(f),v=i.value;return f&&g&&!v});async function d(){var h;if(l.value){i.value=!0,o.value="";try{console.log("🚀 Début de l'activation des notifications...");const{auth:f}=await dt(()=>Promise.resolve().then(()=>Yr),void 0),g=((h=f.currentUser)==null?void 0:h.email)===s.value;if(g){console.log("✅ Utilisateur déjà connecté, activation directe...");const{activateNotificationsForConnectedUser:v}=await dt(()=>Promise.resolve().then(()=>T1),void 0),w=await v({seasonId:t.seasonId,eventId:t.eventId,playerName:t.playerName,email:s.value,eventTitle:t.eventTitle,seasonSlug:t.seasonSlug});console.log("✅ Notifications activées directement:",w),a.value=!0,r("success",{email:s.value,playerName:t.playerName,directActivation:!0})}else{console.log("📧 Utilisateur non connecté, envoi de l'email d'activation...");const v=await w1({seasonId:t.seasonId,eventId:t.eventId,playerName:t.playerName,email:s.value,eventTitle:t.eventTitle,seasonSlug:t.seasonSlug});console.log("✅ Résultat de la création:",v),a.value=!0,r("success",{email:s.value,playerName:t.playerName,directActivation:!1})}L.info("Activation des notifications terminée",{email:s.value,playerName:t.playerName,eventId:t.eventId,directActivation:g})}catch(f){console.error("❌ Erreur lors de l'activation:",f),L.error("Erreur lors de l'activation des notifications",f),o.value="Impossible d'activer les notifications. Veuillez réessayer."}finally{i.value=!1}}}return(h,f)=>n.show?(C(),N("div",Q9,[c("div",J9,[c("button",{onClick:f[0]||(f[0]=g=>h.$emit("close")),class:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors p-1 rounded-full hover:bg-white/10",title:"Fermer"},f[3]||(f[3]=[c("span",{class:"text-xl"},"✖️",-1)])),c("div",Y9,[f[5]||(f[5]=c("div",{class:"w-16 h-16 rounded-full mx-auto mb-4 flex items-center justify-center bg-gradient-to-r from-purple-500 to-pink-600"},[c("span",{class:"text-2xl"},"🔔")],-1)),f[6]||(f[6]=c("h2",{class:"text-xl font-bold text-white mb-2"},"Ne rates rien !",-1)),c("p",X9,[c("span",Z9,oe(n.playerName),1),f[4]||(f[4]=ft(", active tes notifications pour recevoir des alertes en temps réel sur tes événements. "))])]),a.value?(C(),N("div",uz,[c("p",cz,[f[8]||(f[8]=ft(" Email envoyé à ")),c("span",dz,oe(s.value),1)]),f[9]||(f[9]=c("p",{class:"text-gray-300 text-xs"}," Clique sur le lien qu'il contient pour activer tes notifications ",-1))])):(C(),N("div",ez,[c("div",null,[f[7]||(f[7]=c("label",{for:"email",class:"block text-sm font-medium text-gray-300 mb-2"}," Ton adresse email ",-1)),tt(c("input",{id:"email","onUpdate:modelValue":f[1]||(f[1]=g=>s.value=g),type:"email",placeholder:"votre@email.com",class:Qt(["w-full px-4 py-3 bg-gray-800 border rounded-lg text-white placeholder-gray-400 focus:outline-none transition-colors",[s.value&&!l.value?"border-red-500 focus:border-red-500":s.value&&l.value?"border-green-500 focus:border-green-500":"border-white/20 focus:border-purple-500"]]),disabled:i.value},null,10,tz),[[Ut,s.value]]),s.value&&!i.value?(C(),N("div",nz,[l.value?(C(),N("span",rz,"✅ Email valide")):(C(),N("span",sz,"❌ Format d'email invalide"))])):ae("",!0)]),c("div",iz,[c("button",{onClick:d,disabled:!l.value||i.value,class:Qt(["flex-1 px-6 py-3 rounded-lg transition-all duration-300 font-medium",[l.value&&!i.value?"bg-gradient-to-r from-purple-500 to-pink-600 text-white hover:from-purple-600 hover:to-pink-700":"bg-gray-600 text-gray-300 cursor-not-allowed"]])},[i.value?(C(),N("span",az,"⏳")):(C(),N("span",lz,"Activer les notifications"))],10,oz),c("button",{onClick:f[2]||(f[2]=g=>h.$emit("close")),class:"flex-1 px-6 py-3 bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600 transition-all duration-300 font-medium"}," Pas Maintenant ")])])),o.value?(C(),N("div",hz,[c("div",fz,oe(o.value),1)])):ae("",!0)])])):ae("",!0)}},mz={key:0,class:"fixed inset-0 z-[300] flex items-center justify-center p-4 bg-black/60"},gz={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center relative"},vz={class:"text-gray-300 mb-6"},yz={class:"font-semibold text-white"},_z={class:"bg-blue-500/20 border border-blue-500/30 rounded-lg p-4 mb-6"},bz={class:"flex items-start gap-3"},wz={class:"text-left flex-1"},xz={key:0,class:"mb-6 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},Ez={class:"flex items-start gap-3"},Iz={class:"text-left"},Tz={class:"text-green-200 text-sm"},Az={class:"font-mono"},Sz={class:"flex gap-3"},Pz=["disabled"],Rz={key:0,class:"animate-spin"},Cz={key:1},kz={__name:"NotificationSuccessModal",props:{show:{type:Boolean,default:!1},playerName:{type:String,required:!0},email:{type:String,required:!0},seasonSlug:{type:String,required:!0},eventId:{type:String,default:null}},emits:["close","createPassword"],setup(n,{emit:e}){const t=n;Ea();const r=S(!1),s=S(!1);async function i(){s.value=!0;try{const{createUserWithEmailAndPassword:o,sendPasswordResetEmail:a}=await dt(()=>import("./index.esm-3f9d7d41.js"),[]),{auth:l}=await dt(()=>Promise.resolve().then(()=>Yr),void 0);console.log("🚀 Tentative de création de compte pour:",t.email);const d={lastVisitedPage:window.location.pathname+window.location.search,timestamp:Date.now(),email:t.email};localStorage.setItem("pendingPasswordResetNavigation",JSON.stringify(d)),console.log("💾 Navigation sauvegardée pour redirection après reset:",d);const h="TempPass123!",f=await o(l,t.email,h);console.log("✅ Compte créé avec succès, UID:",f.user.uid),console.log("📧 Envoi de l'email de réinitialisation..."),await a(l,t.email),console.log("✅ Email de réinitialisation envoyé avec succès à",t.email),await l.signOut(),r.value=!0}catch(o){if(console.error("❌ Erreur lors de la création du compte:",o),o.code==="auth/email-already-in-use")try{console.log("📧 Utilisateur existant, envoi direct de l'email de réinitialisation...");const{sendPasswordResetEmail:a}=await dt(()=>import("./index.esm-3f9d7d41.js"),[]),l={lastVisitedPage:window.location.pathname+window.location.search,timestamp:Date.now(),email:t.email};localStorage.setItem("pendingPasswordResetNavigation",JSON.stringify(l)),console.log("💾 Navigation sauvegardée pour utilisateur existant:",l),await a(auth,t.email),console.log("✅ Email de réinitialisation envoyé avec succès à",t.email),r.value=!0}catch(a){console.error("❌ Erreur lors de l'envoi de l'email de réinitialisation:",a)}else o.code==="auth/weak-password"?console.error("❌ Mot de passe temporaire trop faible"):o.code==="auth/invalid-email"?console.error("❌ Email invalide"):console.error("❌ Erreur inconnue:",o.message)}finally{s.value=!1}}return(o,a)=>n.show?(C(),N("div",mz,[c("div",gz,[c("button",{onClick:a[0]||(a[0]=l=>o.$emit("close")),class:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors duration-200 text-xl font-bold",title:"Fermer"}," ✖️ "),a[9]||(a[9]=c("div",{class:"w-20 h-20 rounded-full mx-auto mb-6 flex items-center justify-center bg-green-500"},[c("span",{class:"text-3xl"},"✅")],-1)),a[10]||(a[10]=c("h1",{class:"text-2xl font-bold text-white mb-4"},"Notifications activées !",-1)),c("p",vz,[a[2]||(a[2]=ft(" Nous enverrons désormais les alertes spectacle à ")),c("span",yz,oe(n.email),1)]),c("div",_z,[c("div",bz,[a[4]||(a[4]=c("span",{class:"text-blue-400 text-lg"},"💡",-1)),c("div",wz,[a[3]||(a[3]=c("p",{class:"text-blue-300 text-sm font-medium mb-3"}," Psst... tant que tu y es : ajoute un mot de passe pour sécuriser ton compte ! ",-1)),Be(ny,{inline:!0})])])]),r.value?(C(),N("div",xz,[c("div",Ez,[a[8]||(a[8]=c("span",{class:"text-green-400 text-lg"},"✅",-1)),c("div",Iz,[a[7]||(a[7]=c("p",{class:"text-green-300 text-sm font-medium mb-1"},"Email envoyé !",-1)),c("p",Tz,[a[5]||(a[5]=ft(" Vérifie ta boîte mail à ")),c("span",Az,oe(n.email),1),a[6]||(a[6]=ft(" et clique sur le lien pour créer ton mot de passe. "))])])])])):ae("",!0),c("div",Sz,[c("button",{onClick:i,class:Qt(["flex-1 px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 font-medium",{"opacity-50 cursor-not-allowed":r.value||s.value}]),disabled:r.value||s.value},[s.value?(C(),N("span",Rz,"⏳")):(C(),N("span",Cz,"🔐 Créer mon mot de passe"))],10,Pz),c("button",{onClick:a[1]||(a[1]=l=>o.$emit("close")),class:"flex-1 px-6 py-3 bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600 transition-all duration-300 font-medium"},oe(r.value?"Fermer":"Plus tard"),1)])])])):ae("",!0)}};const Dz={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},Nz={class:"w-full px-0 md:px-0 pb-0 pt-[64px] md:pt-[80px] -mt-[64px] md:-mt-[80px] bg-gray-900"},Oz={class:"flex items-stretch relative"},Vz={key:0,class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},Mz={class:"flex flex-col items-center justify-between h-full gap-3"},Lz={class:"flex items-center justify-center p-1 relative z-[90]"},$z={key:0,class:"w-16 h-16 md:w-14 md:h-14 rounded-lg overflow-hidden shadow-lg"},Fz=["src","alt"],Uz={key:1,class:"w-16 h-16 md:w-14 md:h-14 text-3xl md:text-2xl flex items-center justify-center text-white"},jz={class:"flex-1 overflow-hidden"},Bz=["data-event-id"],qz=["title","onClick"],zz={class:"flex flex-col items-center flex-1 justify-center"},Hz={class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2 group-hover:text-purple-300 transition-colors duration-200"},Kz={key:0,class:"mt-1 text-xs text-gray-400"},Gz={class:"relative"},Wz=["onClick","title"],Qz={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},Jz={class:"p-2"},Yz=["onClick"],Xz=["onClick"],Zz=["onClick"],e8={class:"flex flex-col items-center mt-2"},t8={key:0,class:"px-2 py-1 bg-gray-500/20 border border-gray-400/30 rounded-md mx-auto flex items-center justify-center",title:"Événement archivé"},n8=["title","onClick"],r8=["title","onClick"],s8=["title","onClick"],i8=["title","onClick"],o8=["title","aria-label"],a8={class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},l8={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3l18 18"},u8={key:0,class:"pointer-events-none"},c8={class:"flex items-center justify-between"},d8={key:1,class:"pointer-events-none"},h8={id:"coachmark-avail",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-pink-500/40 rounded-xl shadow-2xl p-3 text-white relative"},f8={class:"flex items-center justify-between"},p8={key:2,class:"pointer-events-none"},m8={id:"coachmark-name",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-yellow-500/40 rounded-xl shadow-2xl p-3 text-white relative"},g8={class:"flex items-center justify-between"},v8={class:"table-auto border-separate border-spacing-0 table-fixed w-auto min-w-max"},y8=["data-player-id"],_8={class:"px-0 py-4 md:py-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900 left-col-td"},b8={class:"px-4 md:px-5 font-bold text-xl md:text-2xl flex items-center w-full min-w-0"},w8={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Mon joueur"},x8={key:1,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protégé par mot de passe"},E8=["onClick","title"],I8={class:"group-hover:text-purple-300 transition-colors duration-200"},T8=["data-event-id"],A8={class:"border-t border-white/10"},S8={class:"px-0 py-4 md:py-5 sticky left-0 z-40 bg-gray-900 left-col-td"},P8={class:"px-4 md:px-5 flex items-center"},R8=["data-event-id"],C8={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},k8={class:"text-center"},D8={class:"text-white text-lg"},N8={class:"mt-3 w-64 h-2 bg-white/10 rounded-full overflow-hidden"},O8={class:"text-white/60 text-xs mt-2"},V8={key:3,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-[200]"},M8={class:"flex items-center space-x-2"},L8={key:4,class:"fixed bottom-4 left-4 bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl shadow-2xl border border-red-400/30 backdrop-blur-sm z-[200]"},$8={class:"flex items-center space-x-2"},F8={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},U8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},j8={class:"mb-6"},B8={class:"mb-6"},q8={class:"mb-6"},z8={class:"mb-6 flex items-center gap-3"},H8={class:"mb-6"},K8={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},G8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},W8={class:"mb-6"},Q8={class:"flex justify-end space-x-3"},J8={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},Y8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},X8={class:"flex justify-end space-x-3"},Z8={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},eH={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},tH={class:"flex justify-end space-x-3"},nH={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},rH={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},sH={class:"text-center mb-6"},iH={class:"text-gray-300"},oH={key:0},aH={key:1},lH={class:"relative p-4 md:p-6 border-b border-white/10"},uH={class:"flex items-start gap-4 md:gap-6"},cH={class:"flex-1 min-w-0"},dH={class:"flex items-center gap-3 mb-2"},hH={class:"text-xl md:text-2xl font-bold text-white leading-tight"},fH={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},pH={class:"text-blue-200"},mH={class:"flex items-center gap-3 mb-3"},gH={class:"text-base md:text-lg text-purple-300"},vH={class:"relative"},yH={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},_H={class:"p-2"},bH={key:0,class:"text-sm text-gray-300 bg-gray-800/30 p-3 rounded-lg border border-gray-600/30"},wH={class:"flex items-center gap-2 mt-3"},xH={key:0,class:"flex items-center gap-2 px-3 py-1.5 bg-blue-500/15 border border-blue-400/25 rounded text-sm"},EH={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},IH={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},TH={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},AH={class:"text-xl md:text-2xl font-bold text-white"},SH={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},PH={class:"text-xl md:text-2xl font-bold text-white"},RH={class:"p-3 md:p-4 rounded-lg border border-yellow-500/30 bg-yellow-500/10 text-center"},CH={class:"text-xl md:text-2xl font-bold text-yellow-300"},kH={key:0,class:"mb-4 md:mb-6"},DH={class:"mb-3 flex items-center"},NH=["title"],OH={class:"truncate"},VH={class:"space-y-0.5"},MH={class:"flex items-center min-w-0 gap-1.5"},LH={key:0,class:"text-yellow-400 mr-1 text-xs",title:"Mon joueur"},$H={key:1,class:"text-yellow-400 mr-1 text-xs",title:"Joueur protégé par mot de passe"},FH=["title"],UH={class:"flex-0 p-0"},jH={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},BH=["disabled","title"],qH=["title"],zH={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},HH=["disabled","title"],KH={key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},GH={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},WH={class:"mb-6"},QH={class:"mb-6"},JH={class:"mb-6"},YH={class:"mb-6 flex items-center gap-3"},XH={class:"mb-6"},ZH={key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},e7={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},t7={class:"mb-6"},n7={class:"space-y-4"},r7=["disabled"],s7={key:0,class:"animate-spin"},i7={key:1},o7={class:"mb-6 text-center"},a7={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},l7={class:"text-red-300 text-sm"},u7={key:13,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},c7={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},d7={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},h7={class:"space-y-4"},f7={class:"mt-2 text-center"},p7={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},m7={class:"text-red-300 text-sm"},g7={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},v7=["disabled"],y7={key:0,class:"animate-spin"},_7={key:1},b7={class:"mb-6"},w7=["disabled"],x7={key:0,class:"animate-spin"},E7={key:1},I7={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},T7={class:"text-red-300 text-sm"},A7={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},S7={class:"text-green-300 text-sm"},P7={class:"flex justify-center"},R7={class:"mb-6"},C7=["disabled"],k7={key:0,class:"animate-spin"},D7={key:1},N7={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},O7={class:"text-red-300 text-sm"},V7={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},M7={class:"text-green-300 text-sm"},L7={class:"flex justify-center"},$7={key:16,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},F7={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl max-w-md"},U7={class:"flex gap-3"},Jb={__name:"GridBoard",props:{slug:{type:String,required:!0},eventId:{type:String,required:!1}},setup(n){const e=n,t=Ea(),r=_o(),s=S(null);function i(_){s.value=_,Bt(()=>{a()})}const o=S(!1);async function a(){var _;if(!((_=X.value)!=null&&_.id)){o.value=!1;return}try{o.value=await W1(X.value.id)}catch(m){console.error("Erreur lors de la mise à jour de l'état de surveillance:",m),o.value=!1}}const l=e.slug,d=S(""),h=S(""),f=S({}),g=S(!1),v=S(!1),w=S(null),b=S(null),x=S(""),M=S(""),O=S(6),A=S(!1),j=S(""),de=S(null),re=S(null),k=S(null),I=S({position:null,side:null}),T=S({position:null}),V=S({position:null}),U=S(!1),$=S(null),D=S(!1),je=S(null),Tt=S(null),yt=S(!1),We=S(null),se=S(""),B=S(!1),Se=S(null),ne=S(""),te=S(""),De=S(!1),gt=S(null),At=S(!1),St=S(null),J=S(""),xe=S(""),be=S(!1),Ne=S(null),ot=S(!1),bt=S(!1),R=S(""),F=S(""),G=S(!1),he=S(!1),le=S(""),fe=S(""),Ie=S(!1),X=S(null),ve=S(""),pe=S(!1),Ce=S(!1),_e=S(!1),Oe=S(null),qe=S(null),Ue=S({position:"fixed",top:"0px",left:"0px"}),Ze=S(null),ht=S({position:"fixed",top:"0px",left:"0px"}),nn=S(null),Xt=S(!1),xn=S(!1),zt=S(null),pr=S(!1),kr=S(null);function cn(){try{const _=Oe.value;if(!_)return;const m=_.getBoundingClientRect(),P=8;if(window.innerWidth>768){const W=Math.max(P,Math.round(m.top-P)),Z=Math.max(P,Math.round(m.left));Ue.value={position:"fixed",top:`${W}px`,left:`${Z}px`,zIndex:400}}else{const W=Math.min(window.innerHeight-P,Math.round(m.bottom+P)),Z=Math.max(P,Math.round(m.left));Ue.value={position:"fixed",top:`${W}px`,left:`${Z}px`,zIndex:400}}}catch{}}function On(){try{const W=Math.max(8,window.innerHeight-8-48-200),Z=Math.max(8,Math.round(window.innerWidth-200-8));ht.value={position:"fixed",top:`${W}px`,left:`${Z}px`,zIndex:400}}catch{}}function xi(){_e.value=!_e.value,_e.value&&Bt(()=>cn())}function ue(){Ce.value=!Ce.value,Ce.value&&Bt(()=>On())}function z(_){nn.value===_?nn.value=null:nn.value=_}function we(){nn.value=null}function ze(){Xt.value=!Xt.value}function Ye(){Xt.value=!1}const ut=S(!1),pt=S(null),Pt=S(null),Fn=S(null),kt=S(0);function Er(){var _;try{if(!h.value||!f.value||f.value.onboardingCreatorDone!==!0||Qe.value.length===0)return;const m=localStorage.getItem(`playerTourCompleted:${h.value}`);try{const W=((_=$e==null?void 0:$e.currentUser)==null?void 0:_.email)||"";W&&qf(W).then(async Z=>{const ce=Z.filter(ie=>ie.seasonId===h.value);if(ce.length>0){const ie=`seasonPreferredPlayer:${h.value}`,Re=localStorage.getItem(ie);let Ke=[];if(Re)if(Re.startsWith("["))try{Ke=JSON.parse(Re)||[]}catch{}else Ke=[Re];const Xe=new Set(Ke);ce.forEach(Ht=>Xe.add(Ht.playerId));const at=Array.from(Xe);localStorage.setItem(ie,JSON.stringify(at))}}).catch(()=>{})}catch{}const P=localStorage.getItem(`startPlayerTour:${h.value}`);!m&&P&&(kt.value=1,localStorage.removeItem(`startPlayerTour:${h.value}`),Bt(()=>{const W=document.querySelector('button[data-onboarding="add-player"]');if(W){W.scrollIntoView({behavior:"smooth",block:"end"});const Z=W.getBoundingClientRect(),ce=document.getElementById("coachmark-add"),ie=280,Re=100,Ke=(ce==null?void 0:ce.offsetWidth)||ie,Xe=(ce==null?void 0:ce.offsetHeight)||Re,at=Math.round(Z.right+12);if(at+Ke<=window.innerWidth-12){const En=Z.top+Z.height/2-Xe/2,In=-14,Lt=12,Vr=window.innerHeight-Xe-12,is=Math.max(Lt,Math.min(Math.round(En+In),Vr));I.value={position:{x:at,y:is},side:"right"}}else{const En=Math.round(Z.left+Z.width/2-Ke/2),In=Math.round(Z.top-Xe-8),Lt=8,Vr=window.innerWidth-Ke-8;I.value={position:{x:Math.max(Lt,Math.min(En,Vr)),y:In},side:null}}}}))}catch{}}const nt=S(!1),ct=S(null),Wn=S(null),nr=S(!1),Vn=S(null),Ei=S(!1),Os=S(null),ps=S(!1),Vs=S(!1),ru=S(!1),ms=S(!1),Na=S(!1),Ao=S(!1),So=S(null);function gs(){Vs.value=!0;const _=`/season/${e.slug}`,m=new URLSearchParams(window.location.search);m.delete("open"),m.set("open","account");const P=`${_}?${m.toString()}`;t.push(P)}function Oa(){Vs.value=!1;const _=`/season/${e.slug}`,m=new URLSearchParams(window.location.search);m.delete("open");const P=m.toString()?`${_}?${m.toString()}`:_;t.push(P)}function nd(){Na.value=!0}function su(){Na.value=!1}function iu(){Ao.value=!0}function rd(){Ao.value=!1}function ou(){try{const W=$e==null?void 0:$e.currentUser;if(!W||W.isAnonymous){let Z=null;if(ss.value&&ss.value.size>0){const ce=ss.value.values().next().value;Z=it.value.find(ie=>ie.id===ce)||null}Z||(Z=it.value[0]||null),ms.value=!0,Z&&(So.value=Z);return}}catch{}Vs.value=!0;const _=`/season/${e.slug}`,m=new URLSearchParams(window.location.search);m.delete("open"),m.set("open","account");const P=`${_}?${m.toString()}`;t.push(P)}async function zf(){var _;try{const m=(_=$e==null?void 0:$e.currentUser)==null?void 0:_.email;if(!m)return;const{resetPlayerPassword:P}=await dt(()=>Promise.resolve().then(()=>Yr),void 0);await P(m),Le.value=!0,vt.value="Email de réinitialisation envoyé.",setTimeout(()=>{Le.value=!1},3e3)}catch{Un.value=!0,Si.value="Impossible d'envoyer l'email de réinitialisation.",setTimeout(()=>{Un.value=!1},3e3)}}async function Po(){try{await J4($e),Oa();const _=`/season/${e.slug}`,m=new URLSearchParams(window.location.search);m.delete("open");const P=m.toString()?`${_}?${m.toString()}`:_;t.push(P),Le.value=!0,vt.value="Déconnecté de cet appareil.",setTimeout(()=>{Le.value=!1},2500)}catch{Un.value=!0,Si.value="Déconnexion impossible.",setTimeout(()=>{Un.value=!1},3e3)}}async function sd(){alert("Suppression de compte: contactez l'organisateur pour dissocier vos joueurs. Fonction complète à venir.")}async function Va(_){var m;Oa();try{if(_.seasonId&&_.seasonId!==h.value){const P=ye(ee,"seasons",_.seasonId),Z=(await Dt(Je(ee,"seasons"))).docs.find(ie=>ie.id===_.seasonId),ce=(m=Z==null?void 0:Z.data())==null?void 0:m.slug;if(ce){t.push(`/season/${ce}?player=${encodeURIComponent(_.playerId)}&open=protection`);return}}else{const P=it.value.find(W=>W.id===_.playerId);if(P){bd(P);return}t.push(`?player=${encodeURIComponent(_.playerId)}&open=protection`)}}catch{}}Sn(async()=>{s.value=$e.currentUser;const _=$e.onAuthStateChanged(i);window._gridBoardUnsubscribe=_;try{h.value&&localStorage.getItem(`dismissCreatorOnboarding:${h.value}`)&&(onboardingDismissedShare.value=!0)}catch{}try{const P=window.location.pathname;if(P&&P!=="/"){const Z=new URLSearchParams(window.location.search).get("email")||localStorage.getItem("hatcast_last_email");Z&&await Zo(Z,P,{seasonSlug:e.slug,source:"grid_board"})}}catch(P){P.code!=="permission-denied"&&L.error("Erreur lors du tracking de navigation:",P)}try{const P=new URLSearchParams(window.location.search);if(P.get("open")==="account"&&Bt(()=>{Vs.value=!0}),P.get("modal")==="event_details"&&P.get("event")){const W=P.get("event"),Z=Qe.value.find(ce=>ce.id===W);Z&&Bt(()=>{yd(Z)})}if(P.get("modal")==="player_details"&&P.get("player")){const W=P.get("player"),Z=it.value.find(ce=>ce.id===W);Z&&Bt(()=>{bd(Z)})}}catch(P){L.error("Erreur lors de la détection automatique des modales:",P)}const m=()=>{g.value=window.scrollY>10};return window.addEventListener("scroll",m,{passive:!0}),document.addEventListener("click",P=>{if(_e.value){const W=Oe.value,Z=qe.value,ce=W&&W.contains(P.target),ie=Z&&Z.contains(P.target);!ce&&!ie&&(_e.value=!1)}if(Ce.value){const W=Ze.value;W&&W.contains(P.target)||(Ce.value=!1)}}),document.addEventListener("keydown",P=>{P.key==="Escape"&&(_e.value&&(_e.value=!1),Ce.value&&(Ce.value=!1))}),window.addEventListener("resize",()=>{_e.value&&cn(),Ce.value&&On()}),window.addEventListener("scroll",()=>{_e.value&&cn(),Ce.value&&On()},{passive:!0}),()=>{window.removeEventListener("scroll",m)}});function Ro(){Bt(()=>{Co()})}const rr=S(new Set),ns=S(!0),vs=S(0),Ms=S("Préparation de la grille"),rs=S(e.eventId||null),au=S(!1),Ii=S(null);Nt(()=>e.eventId,_=>{if(_)if(rs.value=_,Qe.value.length>0)my(_);else{const m=Nt(Qe,P=>{P.length>0&&(my(_),m())},{immediate:!0})}});const Ls=He(()=>it.value.map(_=>({..._,isProtected:rr.value.has(_.id),email:null}))),id=He(()=>rs.value?sr.value.findIndex(_=>_.id===rs.value):-1);He(()=>{if(!rs.value||id.value===-1)return!1;if(window.innerWidth<=768){const _=document.querySelector(`[data-event-id="${rs.value}"]`);if(_){const m=_.getBoundingClientRect();return m.left>=0&&m.right<=window.innerWidth}}return!0});const Dr=S(null),od=S(!1),ad=S(!1),Ma=S(0),ld=S(null),mr=S(null),Br=S(null);function Cn(){const _=Dr.value;if(!_)return;const{scrollLeft:m,scrollWidth:P,clientWidth:W}=_;od.value=m>2,ad.value=m<P-W-2}function Co(){var _;try{Cn(),Ma.value=((_=Dr.value)==null?void 0:_.scrollLeft)||0}catch{}}function ko(_){const m=Dr.value;if(!m)return;let P=0;const W=m.querySelector("tbody tr td[data-event-id]");if(W)P=W.getBoundingClientRect().width;else if(mr!=null&&mr.value){const ce=mr.value.querySelector(".col-event");ce&&(P=ce.getBoundingClientRect().width)}(!P||!isFinite(P))&&(P=m.clientWidth*.6);const Z=m.scrollLeft+_*P;m.scrollTo({left:Z,behavior:"smooth"})}const Ti=S(null);S(0);const Ot=S(!1),$s=S(!1),qr=S(0);function Ai(_,m){m&&typeof m.preventDefault=="function"&&m.preventDefault(),zr(),ko(_)}function La(_,m){if(m&&typeof m.preventDefault=="function"&&m.preventDefault(),Ot.value)return;Ot.value=!0,qr.value=_,$s.value=!1;const P=Dr.value;if(!P)return;let W=0;const Z=P.querySelector("tbody tr td[data-event-id]");if(Z)W=Z.getBoundingClientRect().width;else if(mr!=null&&mr.value){const Ke=mr.value.querySelector(".col-event");Ke&&(W=Ke.getBoundingClientRect().width)}(!W||!isFinite(W))&&(W=P.clientWidth*.6);const ce=W/6,ie=120,Re=()=>{if(!Ot.value||qr.value===0)return;$s.value||($s.value=!0);const Ke=P.scrollLeft+qr.value*ce;P.scrollTo({left:Ke,behavior:"auto"}),Ti.value=window.setTimeout(Re,ie)};Ti.value=window.setTimeout(Re,250)}function zr(_){_&&typeof _.preventDefault=="function"&&_.preventDefault();const m=Ot.value,P=$s.value;if(Ot.value=!1,Ti.value&&(clearTimeout(Ti.value),Ti.value=null),_&&typeof _.type=="string"&&_.type.startsWith("touch")&&!P){const W=qr.value||0;W!==0&&ko(W),qr.value=0;return}qr.value=0,m&&P&&Hf()}function Hf(){const _=Dr.value;if(!_)return;let m=0;const P=_.querySelector("tbody tr td[data-event-id]");if(P)m=P.getBoundingClientRect().width;else if(mr!=null&&mr.value){const ie=mr.value.querySelector(".col-event");ie&&(m=ie.getBoundingClientRect().width)}if(!m||!isFinite(m)||m<=0)return;const W=_.scrollLeft,ce=Math.round(W/m)*m;_.scrollTo({left:ce,behavior:"smooth"})}function Kf(_){de.value=_;const m=document.querySelector(`[data-player-id="${_}"]`);m&&m.scrollIntoView({behavior:"smooth",block:"center"}),Le.value=!0,vt.value="Nouveau joueur ajouté !",setTimeout(()=>{Le.value=!1},3e3)}function Gf(){if(kt.value!==1)return;const _=document.querySelector('button[data-onboarding="add-player"]');if(!_)return;const m=_.getBoundingClientRect(),P=document.getElementById("coachmark-add"),W=280,Z=100,ce=P!=null&&P.offsetWidth&&P.offsetWidth>0?P.offsetWidth:W,ie=P!=null&&P.offsetHeight&&P.offsetHeight>0?P.offsetHeight:Z,Re=Math.round(m.right+12);if(Re+ce<=window.innerWidth-12){const Xe=m.top+m.height/2-ie/2,Ht=ud(Xe+-14,ie);I.value={position:{x:Re,y:Ht},side:"right"}}else{const Xe=Math.round(m.left+m.width/2-ce/2),at=ud(m.top-ie-8,ie),Ht=8,En=window.innerWidth-ce-8;I.value={position:{x:Math.max(Ht,Math.min(Xe,En)),y:at},side:null}}}function ud(_,m){const P=pageHeaderRef==null?void 0:pageHeaderRef.value,W=P?Math.max(0,Math.round(P.getBoundingClientRect().height||0)):0,Z=Math.max(12,W+8),ce=window.innerHeight-m-12;return Math.max(Z,Math.min(Math.round(_),ce))}function ys(){var _;kt.value===1&&((_=I.value)!=null&&_.position)&&Gf()}Sn(()=>{window.addEventListener("scroll",ys,{passive:!0}),window.addEventListener("resize",ys)}),ei(()=>{window._gridBoardUnsubscribe&&(window._gridBoardUnsubscribe(),delete window._gridBoardUnsubscribe),window.removeEventListener("scroll",ys),window.removeEventListener("resize",ys)});function Nr(_){return rr.value.has(_)}async function $a(){if(h.value)try{const _=await Bm(h.value),m=new Set;_.forEach(P=>{P.isProtected&&m.add(P.playerId||P.id)}),rr.value=m}catch{const m=new Set;for(const P of it.value)await no(P.id,h.value)&&m.add(P.id);rr.value=m}}const Le=S(!1),vt=S(""),Un=S(!1),Si=S("");function Wf(){try{const _=`${window.location.origin}/season/${l}`;navigator.clipboard.writeText(_),Le.value=!0,vt.value="Lien copié dans le presse-papiers",setTimeout(()=>{Le.value=!1},2500)}catch{Un.value=!0,Si.value="Impossible de copier le lien",setTimeout(()=>{Un.value=!1},2500)}}async function cd(_){await pn({type:"deleteEvent",data:{eventId:_}})}async function _s(_=null){const m=_||w.value;if(!m){console.error("Aucun événement à supprimer");return}try{await d5(m,h.value),Qe.value=Qe.value.filter(P=>P.id!==m),await Promise.all([Uh(h.value),Ko(it.value,Qe.value,h.value),Go(h.value)]).then(([P,W,Z])=>{Qe.value=P,dn.value=W,rt.value=Z}),v.value=!1,w.value=null,Le.value=!0,vt.value="Événement supprimé avec succès !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de la suppression de l'événement"),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function Qf(){v.value=!1,w.value=null}async function lu(){if(!b.value||!x.value.trim()||!M.value)return;const _=parseInt(O.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}try{const m={title:x.value.trim(),date:M.value,description:ve.value.trim()||"",playerCount:_,archived:!!pe.value},P=Qe.value.find(ce=>ce.id===b.value),Z=(P==null?void 0:P.date)!==M.value;if(await Wb(b.value,m,h.value),Z&&!m.archived)try{const{createRemindersForSelection:ce,removeRemindersForEvent:ie}=await dt(()=>Promise.resolve().then(()=>o5),void 0);await ie({seasonId:h.value,eventId:b.value});const Re=rt.value[b.value]||[];console.log("🔍 Debug sélection:",{editingEventId:b.value,allSelections:Object.keys(rt.value),selectedPlayersForEvent:Re,selectionsValue:rt.value});const Ke=[];for(const Xe of Re)try{const at=it.value.find(Ht=>Ht.name===Xe);if(at!=null&&at.email){const Ht=await ce({seasonId:h.value,eventId:b.value,playerEmail:at.email,playerName:at.name,eventTitle:m.title,eventDate:m.date,seasonSlug:e.slug});Ht.success&&Ke.push(...Ht.results)}}catch(at){console.error("Erreur lors de la recréation des rappels pour",Xe,at)}if(console.log("🎯 Rappels mis à jour pour la nouvelle date:",{eventId:b.value,eventTitle:m.title,newDate:m.date,selectedPlayers:Re.length,remindersCreated:Ke.filter(Xe=>Xe.success).length}),Ke.length>0){const Xe=Ke.filter(at=>at.success).length;console.log(`✅ ${Xe} rappels recréés avec succès`)}}catch(ce){console.error("Erreur lors de la mise à jour des rappels:",ce)}!m.archived&&it.value.length>0&&rr.value.size>0&&(Os.value={id:b.value,...m},Ei.value=!0),await Promise.all([Uh(h.value),Ko(it.value,Qe.value,h.value),Go(h.value)]).then(([ce,ie,Re])=>{Qe.value=ce,dn.value=ie,rt.value=Re}),b.value=null,x.value="",M.value="",ve.value="",O.value=6,pe.value=!1,Le.value=!0,vt.value="Événement mis à jour avec succès !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de l'édition de l'événement"),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function Fa(){if(j.value.trim())try{const _=j.value.trim(),m=await _1(_,h.value);await Promise.all([Ju(h.value),Ko(it.value,Qe.value,h.value),Go(h.value)]).then(([P,W,Z])=>{it.value=P,dn.value=W,rt.value=Z,$a();const ce=it.value.find(Re=>Re.id===m);Kf(m),re.value=m,k.value=sr.value&&sr.value[0]&&sr.value[0].id?sr.value[0].id:null;try{h.value&&localStorage.setItem(`lastAddedPlayerId:${h.value}`,m)}catch{}try{typeof kt<"u"&&(kt.value=2)}catch{}const ie=document.querySelector(`[data-player-id="${m}"]`);ie&&ie.scrollIntoView({behavior:"smooth",block:"center"}),Bt(()=>{const Re=`[data-player-id="${re.value}"] td[data-event-id="${k.value}"]`,Ke=document.querySelector(Re);if(Ke){const Xe=Ke.getBoundingClientRect();T.value.position={x:Math.round(Xe.left),y:Math.round(Xe.top+window.scrollY-48)}}}),Le.value=!0,vt.value="Joueur ajouté avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{Le.value=!1},3e3),setTimeout(()=>{Le.value=!1,vt.value=""},5e3)}),A.value=!1,j.value=""}catch{console.error("Erreur lors de l'ajout du joueur"),alert("Erreur lors de l'ajout du joueur. Veuillez réessayer.")}}function bs(){b.value=null,x.value="",M.value="",ve.value="",O.value=6}S(null);const Do=S(!1),Hr=S(""),Kr=S(""),Pi=S(""),Fs=S(6),Gt=S(!1);async function Jf(){if(!Hr.value.trim()||!Kr.value){alert("Veuillez remplir le titre et la date de l'événement");return}const _=parseInt(Fs.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}const m={title:Hr.value.trim(),date:Kr.value,description:Pi.value.trim()||"",playerCount:_,archived:!!Gt.value};await Yf(m)}async function Yf(_){try{const m=await h5(_,h.value);Qe.value=[...Qe.value,{id:m,..._}];const P={};for(const W of it.value)P[W.name]=dn.value[W.name]||{},P[W.name][m]=null,await Gb(W.name,P[W.name],h.value);Hr.value="",Kr.value="",Pi.value="",Fs.value=6,Gt.value=!1,Do.value=!1,await Promise.resolve(),Le.value=!0,vt.value="Événement créé avec succès !",!_.archived&&it.value.length>0&&rr.value.size>0&&(Os.value={id:m,..._},Ei.value=!0),setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de la création de l'événement"),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function dd(){Hr.value="",Kr.value="",Pi.value="",Fs.value=6,Do.value=!1}async function uu(){await pn({type:"addEvent",data:{}})}const Qe=S([]),it=S([]),dn=S({}),rt=S({}),hd=S({}),cu=S({});Nt([()=>Qe.value.length,()=>it.value.length,ns],()=>{ns.value||Bt(()=>{Co()})}),Nt([()=>it.value.length,()=>Qe.value.length,h],()=>{Er()}),Sn(async()=>{try{oy("firebase"),await y1();const m=mo(Je(ee,"seasons"),Jr("slug","==",e.slug)),P=await Dt(m);if(P.empty){t.push("/seasons");return}else{const ie=P.docs[0];h.value=ie.id;const Re=ie.data();d.value=Re.name,f.value=Re,document.title=`Saison : ${d.value}`,Z$(e.slug)}if(h.value){Ms.value="Chargement des événements de la saison",vs.value=20;const ie=await Dt(Je(ee,"seasons",h.value,"events"));Qe.value=ie.docs.map(Lt=>({id:Lt.id,...Lt.data(),playerCount:Lt.data().playerCount||6})),Ms.value="Chargement des joueurs",vs.value=45;const Re=await Dt(Je(ee,"seasons",h.value,"players"));it.value=Re.docs.map(Lt=>({id:Lt.id,...Lt.data()})),Ms.value="Chargement des disponibilités",vs.value=70;const Ke=await Dt(Je(ee,"seasons",h.value,"availability")),Xe={};Ke.docs.forEach(Lt=>{const Vr=Lt.data(),is={};Object.keys(Vr).forEach(Lo=>{const Wa=Vr[Lo];is[Lo]=Wa==="oui"?!0:Wa==="non"?!1:Wa}),Xe[Lt.id]=is}),dn.value=Xe,Ms.value="Chargement des sélections",vs.value=85;const at=await Dt(Je(ee,"seasons",h.value,"selections")),Ht={};at.docs.forEach(Lt=>{Ht[Lt.id]=Lt.data().players||[]}),rt.value=Ht;const En=await Bm(h.value),In=new Set;Array.isArray(En)&&En.forEach(Lt=>{Lt.isProtected&&In.add(Lt.playerId||Lt.id)}),rr.value=In}const W=ie=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>ie()):setTimeout(ie,0)};Ms.value="Préparation de l'interface",vs.value=95,W(()=>{p(),y()}),await Bt(),vs.value=100,ns.value=!1,Bt(()=>{Cn(),requestAnimationFrame(()=>Cn()),setTimeout(()=>Cn(),250);const ie=Dr.value;ie&&(ie.addEventListener("scroll",Re=>{Cn(),Ma.value=ie.scrollLeft||0},{passive:!0}),window.addEventListener("resize",Cn),typeof ResizeObserver<"u"&&(Br.value=new ResizeObserver(()=>{Cn()}),Br.value.observe(ie)))});const Z=r.query.event;if(Z&&Qe.value.length>0){const ie=Qe.value.find(Re=>Re.id===Z);ie?(await tp(Z,ie),r.query.modal==="event_details"&&yd(ie)):(console.warn("Événement non trouvé avec l'ID"),Un.value=!0,Si.value="Événement non trouvé",setTimeout(()=>{Un.value=!1},3e3))}const ce=r.query.player;if(ce&&it.value.length>0){const ie=it.value.find(Re=>Re.id===ce);ie&&(bd(ie),await Bt(),r.query.verified==="1"&&(Le.value=!0,vt.value="Joueur associé à votre compte.",setTimeout(()=>{Le.value=!1},2500)))}if(r.query.notificationSuccess==="1")console.debug("✅ Paramètres notificationSuccess détectés"),kr.value={email:decodeURIComponent(r.query.email||""),playerName:decodeURIComponent(r.query.playerName||""),eventId:r.query.eventId||null},setTimeout(()=>{pr.value=!0},100),t.replace({query:{...r.query,notificationSuccess:void 0,email:void 0,playerName:void 0,eventId:void 0}});else{const ie=new URLSearchParams(window.location.search),Re=ie.get("notificationSuccess"),Ke=ie.get("email"),Xe=ie.get("playerName"),at=ie.get("eventId");Re==="1"&&(console.debug("✅ Paramètres détectés via fallback"),kr.value={email:decodeURIComponent(Ke||""),playerName:decodeURIComponent(Xe||""),eventId:at||null},setTimeout(()=>{pr.value=!0},100),t.replace({query:{...r.query,notificationSuccess:void 0,email:void 0,playerName:void 0,eventId:void 0}}))}}catch(_){console.error("Erreur lors du chargement de la grille:",_),Un.value=!0,Si.value="Erreur lors du chargement des données",setTimeout(()=>{Un.value=!1},5e3),ns.value=!1}}),Nt(()=>r.params.eventId,_=>{if(_){const m=()=>{const P=Qe.value.find(W=>W.id===_);return P?(yd(P),!0):!1};if(Qe.value.length>0)m();else{const P=Nt(Qe,W=>{W.length>0&&m()&&P()},{immediate:!0})}}},{immediate:!0});function Ri(_){if(!_)return null;if(_ instanceof Date)return _;if(typeof(_==null?void 0:_.toDate)=="function")return _.toDate();if(typeof _=="string"||typeof _=="number"){const m=new Date(_);return isNaN(m.getTime())?null:m}return null}const Us=He(()=>{let _=null;try{h.value&&(_=localStorage.getItem(`seasonPreferredPlayer:${h.value}`))}catch{}const m=[...it.value].sort((ie,Re)=>(ie.name||"").localeCompare(Re.name||"","fr",{sensitivity:"base"}));if(!_)return m;let P=[];try{_.startsWith("[")?P=JSON.parse(_):_&&(P=[_])}catch{P=[]}const W=new Set(P);if(W.size===0)return m;const Z=m.filter(ie=>W.has(ie.id)),ce=m.filter(ie=>!W.has(ie.id));return[...Z,...ce]}),ss=He(()=>{try{if(h.value){const _=localStorage.getItem(`seasonPreferredPlayer:${h.value}`);if(!_)return new Set;if(_.startsWith("[")){const m=JSON.parse(_);return new Set(Array.isArray(m)?m:[])}return new Set([_])}}catch{}return new Set}),Ua=He(()=>[...Qe.value].sort((_,m)=>{const P=Ri(_.date),W=Ri(m.date),Z=P?P.getTime():Number.POSITIVE_INFINITY,ce=W?W.getTime():Number.POSITIVE_INFINITY;return Z!==ce?Z-ce:(_.title||"").localeCompare(m.title||"","fr",{sensitivity:"base"})})),js=S(!1),sr=He(()=>{const _=Ua.value;return js.value?_:_.filter(m=>!m.archived)});function Xf(){js.value=!js.value}const ja=S("selected"),No=He(()=>{var P;if(!X.value)return Us.value;const _=X.value.id,m=new Set(((P=rt.value)==null?void 0:P[_])||[]);return Us.value.filter(W=>{var Re;const Z=W.name,ce=(Re=dn.value[Z])==null?void 0:Re[_],ie=m.has(Z);switch(ja.value){case"selected":return ie;case"available":return ce===!0&&!ie;case"unavailable":return ce===!1;case"unknown":return ce!==!0&&ce!==!1;case"all":default:return!0}})}),fd=He(()=>X.value?Vo(X.value.id):null),pd=He(()=>{if(!X.value)return!1;const _=Vo(X.value.id);return _.type==="incomplete"||_.type==="insufficient"}),Ba=He(()=>X.value?fu(X.value.id):"");async function Ci(_,m){const P=it.value.find(ce=>ce.name===_);if(!P){console.error("Joueur non trouvé");return}const W=Qe.value.find(ce=>ce.id===m);if(!W){console.error("Événement non trouvé");return}if(W.archived){Le.value=!0,vt.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Le.value=!1},3e3);return}if(Nr(P.id)){const ce=la(P.id),ie=Fn.value===P.id;ce||ie?(ie&&(Fn.value=null),qa(P,m)):(Pt.value={playerName:_,eventId:m},pt.value=P,ut.value=!0);return}qa(P,m)}function qa(_,m){var Z,ce,ie;const P=(Z=dn.value[_.name])==null?void 0:Z[m];let W;P===!0?W=!1:P===!1?W=void 0:W=!0,W===void 0?dn.value[_.name]&&delete dn.value[_.name][m]:(dn.value[_.name]||(dn.value[_.name]={}),dn.value[_.name][m]=W);try{typeof kt<"u"&&kt.value===1&&_.id===(re.value||((ce=Us.value[0])==null?void 0:ce.id))&&m===(k.value||((ie=sr.value[0])==null?void 0:ie.id))&&(kt.value=3,Bt(()=>{const Ke=document.querySelector(`[data-player-id="${_.id}"]`);if(Ke){const Xe=Ke.querySelector(".player-name");if(Xe){const at=Xe.getBoundingClientRect();V.value.position={x:Math.round(at.right+8),y:Math.round(at.top+window.scrollY-4)}}}}),ei(()=>{try{window.removeEventListener("resize",Cn)}catch{}try{Br.value&&Br.value.disconnect()}catch{}}))}catch{}Gb(_.name,dn.value[_.name],h.value).then(async()=>{await Bt(),y(),Le.value=!0,vt.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{Le.value=!1},3e3)}).catch(Re=>{console.error("Erreur lors de la mise à jour de la disponibilité"),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}function Qn(_,m){var P;return(P=dn.value[_])==null?void 0:P[m]}function md(_,m){var Z;const P=rt.value[m]||[],W=(Z=dn.value[_])==null?void 0:Z[m];return P.includes(_)&&W===!0}async function gd(_,m=6){console.log("🎲 tirer appelé:",{eventId:_,count:m});const P=Qe.value.find(ie=>ie.id===_),W=(P==null?void 0:P.playerCount)||6;console.log("📅 Événement trouvé:",{eventTitle:P==null?void 0:P.title,requiredCount:W});const Z=rt.value[_]||[];if(console.log("👥 Sélection actuelle:",Z),Z.length>0&&Z.every(ie=>Qn(ie,_))){const Re=it.value.filter(at=>Qn(at.name,_)).map(at=>{const Ht=Bs(at.name);return{name:at.name,weight:1/(1+Ht)}}),Ke=[],Xe=[...Re];for(;Ke.length<W&&Xe.length>0;){const at=Xe.reduce((In,Lt)=>In+Lt.weight,0);let Ht=Math.random()*at;const En=Xe.findIndex(In=>(Ht-=In.weight,Ht<=0));En>=0&&(Ke.push(Xe[En].name),Xe.splice(En,1))}rt.value[_]=Ke}else{const ie=Z.filter(Ke=>Qn(Ke,_)),Re=W-ie.length;if(Re<=0)rt.value[_]=ie;else{const Ke=new Set(ie),at=it.value.filter(In=>Qn(In.name,_)&&!Ke.has(In.name)).map(In=>{const Lt=Bs(In.name);return{name:In.name,weight:1/(1+Lt)}}),Ht=[],En=[...at];for(;Ht.length<Re&&En.length>0;){const In=En.reduce((is,Lo)=>is+Lo.weight,0);let Lt=Math.random()*In;const Vr=En.findIndex(is=>(Lt-=is.weight,Lt<=0));Vr>=0&&(Ht.push(En[Vr].name),En.splice(Vr,1))}rt.value[_]=[...ie,...Ht]}}console.log("💾 Sauvegarde de la sélection:",{eventId:_,players:rt.value[_],seasonId:h.value}),await zm(_,rt.value[_],h.value),console.log("✅ saveSelection terminé"),p(),y()}async function ws(_,m=6){var ie,Re;console.log("🛡️ tirerProtected appelé:",{eventId:_,count:m});const P=nt.value,W=(ie=ct.value)==null?void 0:ie.id,Z=rt.value[_]&&rt.value[_].length>0,ce=Z?[...rt.value[_]]:[];if(console.log("🎲 Appel de tirer..."),await gd(_,m),console.log("✅ tirer terminé"),P&&!nt.value&&(nt.value=!0,ct.value=Qe.value.find(Ke=>Ke.id===W)),nt.value&&((Re=ct.value)==null?void 0:Re.id)===_){if(await Bt(),Wn.value&&Wn.value.showSuccess){const Ke=rt.value[_]||[],Xe=ce.filter(Ht=>Ke.includes(Ht)),at=Xe.length>0&&Xe.length<ce.length;Wn.value.showSuccess(Z,at)}}else Le.value=!0,Qe.value.find(Ke=>Ke.id===_),rt.value[_],Z?vt.value="Sélection mise à jour avec succès !":vt.value="Sélection effectuée avec succès !",setTimeout(()=>{Le.value=!1},3e3)}function za(_){_===0?I.value.position=null:_===1?T.value.position=null:_===2&&(V.value.position=null)}function vd(_){var P;return _?(typeof _=="string"?new Date(_):((P=_.toDate)==null?void 0:P.call(_))||_).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function du(_){var P;return _?(typeof _=="string"?new Date(_):((P=_.toDate)==null?void 0:P.call(_))||_).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function Bs(_){return Object.values(rt.value).filter(m=>m.includes(_)).length}function ki(_){const m=dn.value[_]||{};return Object.values(m).filter(P=>P===!0).length}function jn(_){return _?Object.values(dn.value).filter(m=>m[_]===!0).length:0}function Oo(_){return _?(rt.value[_]||[]).length:0}function hu(_){const m=Qe.value.find(W=>W.id===_),P=(m==null?void 0:m.playerCount)||6;return Oo(_)>=P}function Di(_){const m=ki(_),P=Bs(_);return m===0?0:P/m}function u(_){hd.value[_]={availability:ki(_),selection:Bs(_),ratio:Di(_)}}function p(){it.value.forEach(_=>u(_.name))}function y(){const _={};Qe.value.forEach(m=>{const P=m.playerCount||6,Z=it.value.filter(ie=>Qn(ie.name,m.id)===!0).map(ie=>{const Re=Bs(ie.name);return{name:ie.name,weight:1/(1+Re)}}),ce=Z.reduce((ie,Re)=>ie+Re.weight,0);Z.forEach(ie=>{const Re=Math.min(1,ie.weight/ce*P);_[ie.name]||(_[ie.name]={}),_[ie.name][m.id]=Math.round(Re*100)})}),cu.value=_}const E=S(null),q=S(!1);async function Y(_=null){const m=_||E.value;if(!m){console.error("Aucun joueur à supprimer");return}try{await l5(m,h.value),it.value=it.value.filter(P=>P.id!==m),q.value=!1,E.value=null,Le.value=!0,vt.value="Joueur supprimé avec succès !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de la suppression du joueur"),alert("Erreur lors de la suppression du joueur. Veuillez réessayer.")}}function Te(){q.value=!1,E.value=null}async function jt(_){dy(),await no(_,h.value)?await Ni({type:"deletePlayer",data:{playerId:_}}):await pn({type:"deletePlayer",data:{playerId:_}})}async function Mn(){if($.value){const _=Qe.value.find(P=>P.id===$.value),m=(_==null?void 0:_.playerCount)||6;await ws($.value,m),U.value=!1,$.value=null}}function Rt(){U.value=!1,$.value=null}function Bn(){return We.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis",toggleArchive:"Archivage d'événement - Code PIN requis",updateSelection:"Mise à jour de sélection - Code PIN requis"}[We.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function pn(_){if(Jn.isPinCached(h.value)){const m=Jn.getCachedPin(h.value);if(await Mh(h.value,m)){await Oi(_);return}else Jn.clearSession()}We.value=_,yt.value=!0}async function Ni(_){const m=_.data.playerId;try{if(Jn.isPinCached(h.value)){await Oi(_);return}}catch{}if(la(m)){await Oi(_);return}Se.value=_,B.value=!0}async function Or(_){try{if(await Mh(h.value,_)){Jn.saveSession(h.value,_),yt.value=!1;const P=We.value;We.value=null,await Oi(P)}else se.value="Code PIN incorrect",setTimeout(()=>{se.value=""},3e3)}catch{console.error("Erreur lors de la vérification du PIN"),se.value="Erreur lors de la vérification du code PIN"}}function Ha(){yt.value=!1,We.value=null,se.value=""}async function Ka(_){if(_){De.value=!0,ne.value="";try{const m=Se.value.data.playerId,P=await $m(h.value);if(_===P){try{Jn.saveSession(h.value,_)}catch{}try{vo.saveSession(Se.value.data.playerId)}catch{}B.value=!1;const Z=Se.value;Se.value=null,te.value="",await Oi(Z);return}if(await verifyPlayerPassword(m,_,h.value)){B.value=!1;const Z=Se.value;Se.value=null,te.value="",await Oi(Z)}else ne.value="Mot de passe incorrect",setTimeout(()=>{ne.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),ne.value="Erreur lors de la vérification du mot de passe"}finally{De.value=!1}}}function R1(){B.value=!1,Se.value=null,ne.value="",te.value="",De.value=!1}async function ly(_){if(_){be.value=!0,J.value="";try{const m=St.value.data.player,P=await $m(h.value);if(_===P){try{Jn.saveSession(h.value,_)}catch{}try{vo.saveSession(St.value.data.player.id)}catch{}At.value=!1;const Z=St.value;St.value=null,xe.value="",await Oi(Z);return}if(await verifyPlayerPassword(m.id,_,h.value)){At.value=!1;const Z=St.value;St.value=null,xe.value="",await Oi(Z)}else J.value="Mot de passe incorrect",setTimeout(()=>{J.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),J.value="Erreur lors de la vérification du mot de passe"}finally{be.value=!1}}}function C1(){At.value=!1,St.value=null,J.value="",xe.value="",be.value=!1}async function k1(){bt.value=!0,R.value="",F.value="";try{const _=St.value.data.player,m=await sendPasswordResetEmail(_.id,h.value);F.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),R.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{bt.value=!1}}async function D1(){he.value=!0,le.value="",fe.value="";try{const _=Se.value.data.playerId,m=await sendPasswordResetEmail(_,h.value);fe.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),le.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{he.value=!1}}function N1(){return Jn.isPinCached(h.value)?{timeRemaining:Jn.getTimeRemaining(),isExpiringSoon:Jn.isExpiringSoon()}:null}async function Oi(_){var W;if(!_)return;const{type:m,data:P}=_;try{switch(m){case"deleteEvent":w.value=P.eventId,v.value=!0;break;case"addEvent":Do.value=!0;break;case"deletePlayer":E.value=P.playerId,q.value=!0;break;case"launchSelection":console.log("🚀 launchSelection appelé:",{eventId:P.eventId,count:P.count}),rt.value[P.eventId]&&rt.value[P.eventId].length>0?(console.log("🔄 Sélection existante, affichage confirmation"),$.value=P.eventId,U.value=!0,Ie.value=!1):(console.log("🎯 Pas de sélection existante, lancement direct"),await ws(P.eventId,P.count),Ie.value=!1);break;case"toggleAvailability":qa(P.player,P.eventId);break;case"toggleArchive":await setEventArchived(P.eventId,P.archived,h.value);{const Z=Qe.value.findIndex(ce=>ce.id===P.eventId);Z!==-1&&(Qe.value[Z]={...Qe.value[Z],archived:!!P.archived}),pe.value=!!P.archived}break;case"updateSelection":{const{eventId:Z,players:ce}=P,ie=[...rt.value[Z]||[]],Re=Array.isArray(ce)?ce:[];await zm(Z,Re,h.value),rt.value[Z]=Re;try{const Ke=ie.filter(Xe=>!Re.includes(Xe));if(Ke.length>0){const Xe=Qe.value.find(at=>at.id===Z);await tU({eventId:Z,eventData:Xe,removedPlayers:Ke,newSelectedPlayers:Re,seasonId:h.value,seasonSlug:l,players:Ls.value})}}catch{}try{(W=Wn.value)==null||W.showSuccess(!0,!0)}catch{}}break}}catch{console.error("Erreur lors de l'exécution de l'opération"),Le.value=!0,vt.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{Le.value=!1},3e3)}}function O1(){t.push("/seasons")}ei(()=>{const _=Dr.value;_&&_.removeEventListener("scroll",Cn),window.removeEventListener("resize",Cn)});async function yd(_){X.value=_,ve.value=_.description||"",pe.value=!!_.archived;const m=`/season/${e.slug}?event=${_.id}&modal=event_details`;t.push(m);try{const P=getCurrentUserId();P&&await Zo(P,m,{seasonSlug:e.slug,eventId:_.id,eventTitle:_.title,navigationType:"event_details",context:{currentPage:m,timestamp:new Date().toISOString()}})}catch(P){P.code!=="permission-denied"&&L.error("Erreur lors du tracking de l'état de navigation:",P)}try{const[P,W]=await Promise.all([Ko(it.value,Qe.value,h.value),Go(h.value)]);dn.value=P,rt.value=W}catch(P){console.warn("Impossible de rafraîchir les données avant ouverture des détails:",P)}Ie.value=!0,Bt(()=>{a()})}function V1(){Ie.value=!1,X.value=null,ve.value="",Ce.value=!1,_e.value=!1,we(),Ye(),Ue.value={position:"fixed",top:"0px",left:"0px"},ht.value={position:"fixed",top:"0px",left:"0px"}}function Ga(_,m=null){const P=m||X.value;if(P)try{Oj(_,P,d.value),Le.value=!0,_==="ics"?vt.value="Fichier .ics téléchargé ! Importez-le dans votre agenda":_==="google"?vt.value="Google Calendar ouvert dans un nouvel onglet":_==="outlook"&&(vt.value="Outlook ouvert dans un nouvel onglet"),setTimeout(()=>{Le.value=!1},3e3)}catch(W){console.error("Erreur lors de l'ajout au calendrier:",W),Le.value=!0,vt.value="Erreur lors de l'ajout au calendrier",setTimeout(()=>{Le.value=!1},3e3)}}function _d(){V1();const _=`/season/${e.slug}`;t.push(_);try{const m=getCurrentUserId();m&&Zo(m,_,{seasonSlug:e.slug,navigationType:"season_overview",context:{previousPage:r.path,timestamp:new Date().toISOString()}})}catch(m){m.code!=="permission-denied"&&L.error("Erreur lors du tracking du retour à la vue d'ensemble:",m)}}async function M1(_,m){var ce;const P=it.value.find(ie=>ie.name===_);if(!P){console.error("Joueur non trouvé");return}const W=Qe.value.find(ie=>ie.id===m);if(W!=null&&W.archived){Le.value=!0,vt.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Le.value=!1},3e3);return}const Z=Nr(P.id);if(Z)if(la(P.id))await Ci(_,m);else{Pt.value={playerName:_,eventId:m},pt.value=P,ut.value=!0;return}else await Ci(_,m);(ce=$e.currentUser)!=null&&ce.email||(!Z&&b1()?(zt.value={playerName:_,eventTitle:(W==null?void 0:W.title)||"cet événement",eventId:m},xn.value=!0):Z||(ms.value=!0))}function L1(_,m){return(rt.value[m]||[]).includes(_)}async function $1(_){if(pt.value&&(Fn.value=pt.value.id),Pt.value){const{playerName:m,eventId:P}=Pt.value;await Ci(m,P),Pt.value=null}ut.value=!1,pt.value=null}function uy(){b.value=X.value.id,x.value=X.value.title,M.value=X.value.date,ve.value=X.value.description||"",O.value=X.value.playerCount||6,Ie.value=!1}async function cy(){if(X.value)try{const _=!X.value.archived,m={...X.value,archived:_};await Wb(X.value.id,m,h.value),X.value.archived=_;const P=Qe.value.findIndex(W=>W.id===X.value.id);P!==-1&&(Qe.value[P].archived=_),Le.value=!0,vt.value=_?"Événement archivé avec succès !":"Événement désarchivé avec succès !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de la modification de l'archivage"),alert("Erreur lors de la modification de l'archivage. Veuillez réessayer.")}}function bd(_){je.value=_,D.value=!0;const m=`/season/${e.slug}?player=${_.id}&modal=player_details`;t.push(m);try{const P=getCurrentUserId();P&&Zo(P,m,{seasonSlug:e.slug,playerId:_.id,playerName:_.name,navigationType:"player_details",context:{currentPage:m,timestamp:new Date().toISOString()}})}catch(P){P.code!=="permission-denied"&&L.error("Erreur lors du tracking de l'état de navigation joueur:",P)}try{typeof kt<"u"&&kt.value}catch{}}function dy(){D.value=!1,je.value=null;const _=`/season/${e.slug}`;if(r.path!==_){t.push(_);try{const m=getCurrentUserId();m&&Zo(m,_,{seasonSlug:e.slug,navigationType:"season_overview",context:{previousPage:r.path,timestamp:new Date().toISOString()}})}catch(m){m.code!=="permission-denied"&&L.error("Erreur lors du tracking du retour à la vue d'ensemble:",m)}}}async function F1({playerId:_,newName:m}){try{await u5(_,m,h.value),await Promise.all([Ju(h.value),Ko(it.value,Qe.value,h.value),Go(h.value)]).then(([P,W,Z])=>{if(it.value=P,dn.value=W,rt.value=Z,$a(),je.value&&je.value.id===_){const ce=P.find(ie=>ie.id===_);ce&&(je.value=ce)}}),Le.value=!0,vt.value="Joueur mis à jour avec succès !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de l'édition du joueur"),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function U1(){try{await Promise.all([Ju(h.value),Ko(it.value,Qe.value,h.value),Go(h.value)]).then(([_,m,P])=>{if(it.value=_,dn.value=m,rt.value=P,$a(),je.value){const W=_.find(Z=>Z.id===je.value.id);W&&(je.value=W)}}),Le.value=!0,vt.value="Données mises à jour !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors du rafraîchissement")}}function j1(_){if(!_)return{availability:0,selection:0,ratio:0};const m=ki(_.name),P=Bs(_.name),W=m===0?0:Math.round(P/m*100);return{availability:m,selection:P,ratio:W}}function Vo(_){const m=rt.value[_]||[],P=Qe.value.find(ce=>ce.id===_),W=(P==null?void 0:P.playerCount)||6,Z=jn(_);if(m.length>0){const ce=m.some(Re=>!Qn(Re,_)),ie=Z<W;if(ce||ie)return{type:"incomplete",hasUnavailablePlayers:ce,hasInsufficientPlayers:ie,unavailablePlayers:m.filter(Re=>!Qn(Re,_)),availableCount:Z,requiredCount:W}}return Z<W?{type:"insufficient",availableCount:Z,requiredCount:W}:m.length===0?{type:"ready",availableCount:Z,requiredCount:W}:{type:"complete",availableCount:Z,requiredCount:W}}function fu(_){const m=Vo(_);switch(m.type){case"incomplete":return m.hasUnavailablePlayers?m.unavailablePlayers.length===1?`Sélection incomplète : ${m.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${m.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${m.availableCount} joueurs disponibles pour ${m.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${m.availableCount} disponibles pour ${m.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${m.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${m.availableCount} joueurs disponibles`;default:return""}}async function B1(){const _=[];for(const m of it.value){if(!await no(m.id,h.value))continue;const W=await u1(m.id,h.value);W&&_.push({...m,email:W})}return _}function wd(_){if(_!=null&&_.archived){Le.value=!0,vt.value="Impossible d'annoncer un événement archivé",setTimeout(()=>{Le.value=!1},3e3);return}hy(),Vn.value=_,nr.value=!0;try{const m=new URLSearchParams(window.location.search);m.set("modal","announce"),m.set("event",(_==null?void 0:_.id)||""),history.replaceState(null,"",`${window.location.pathname}?${m.toString()}`)}catch{}}function q1(){nr.value=!1,Vn.value=null;try{const _=new URLSearchParams(window.location.search);_.get("modal")==="announce"&&(_.delete("modal"),_.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${_.toString()}`))}catch{}}function hy(){Ei.value=!1,Os.value=null}const Zf=S(!1);async function fy({eventId:_,eventData:m,reason:P,selectedPlayers:W,scope:Z="all",recipient:ce=null}){Zf.value=!0;try{P==="selection"?(Z==="single"&&(ce!=null&&ce.email)?await Kb({eventId:_,eventData:m,selectedPlayers:[ce.name],seasonId:h.value,seasonSlug:l,players:Ls.value}):await Kb({eventId:_,eventData:m,selectedPlayers:W,seasonId:h.value,seasonSlug:l,players:Ls.value}),Le.value=!0,vt.value=Z==="single"?`Notification envoyée à ${(ce==null?void 0:ce.name)||"1 joueur"}`:"Notifications de sélection envoyées à tous les joueurs sélectionnés !",setTimeout(()=>{Le.value=!1},3e3)):(Z==="single"&&(ce!=null&&ce.email)?await Hb({eventId:_,eventData:m,players:[ce],seasonId:h.value,seasonSlug:l,createMagicLink:$h,reminder:!1,getAvailabilityForEvent:(ie,Re)=>Qn(ie,Re)}):await Hb({eventId:_,eventData:m,players:await B1(),seasonId:h.value,seasonSlug:l,createMagicLink:$h,reminder:!1,getAvailabilityForEvent:(ie,Re)=>Qn(ie,Re)}),Le.value=!0,vt.value=Z==="single"?`Notification envoyée à ${(ce==null?void 0:ce.name)||"1 joueur"}`:"Notifications envoyées à tous les joueurs protégés !",setTimeout(()=>{Le.value=!1},3e3))}catch{console.error("Erreur lors de l'envoi des notifications"),Le.value=!0,vt.value="Erreur lors de l'envoi des notifications",setTimeout(()=>{Le.value=!1},3e3)}Zf.value=!1}function ep(_){if(!_)return{};const m={};return it.value.forEach(P=>{m[P.name]=Qn(P.name,_)}),m}function Mo(_){if(_!=null&&_.archived){Le.value=!0,vt.value="Impossible d'ouvrir la sélection sur un événement archivé",setTimeout(()=>{Le.value=!1},3e3);return}ct.value=_,nt.value=!0;try{const m=new URLSearchParams(window.location.search);m.set("modal","selection"),m.set("event",(_==null?void 0:_.id)||""),history.replaceState(null,"",`${window.location.pathname}?${m.toString()}`)}catch{}}function py(){nt.value=!1,ct.value=null;try{const _=new URLSearchParams(window.location.search);_.get("modal")==="selection"&&(_.delete("modal"),_.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${_.toString()}`))}catch{}}async function z1(){if(!ct.value)return;const _=ct.value.id,m=ct.value.playerCount||6;if(jn(_)===0){Le.value=!0,vt.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{Le.value=!1},3e3);return}await pn({type:"launchSelection",data:{eventId:_,count:m}})}function H1(){py(),Le.value=!0,vt.value="Sélection validée !",setTimeout(()=>{Le.value=!1},3e3)}async function K1(_){if(!_||!_.eventId)return;const{eventId:m,players:P}=_;await pn({type:"updateSelection",data:{eventId:m,players:P}})}async function tp(_,m){if(!_||!m)return;gy(),rs.value=_,au.value=!0,await Bt();const P=document.querySelector(`[data-event-id="${_}"]`);if(!P){console.warn("Élément événement non trouvé dans le DOM");return}document.querySelectorAll(".focused-event-highlight").forEach(ie=>{ie.classList.remove("focused-event-highlight")});const W=document.querySelectorAll(`[data-event-id="${_}"]`);W.forEach(ie=>{ie.classList.add("focused-event-highlight")});const Z=W[0],ce=W[W.length-1];Z&&Z.classList.add("focused-event-column-start"),ce&&ce.classList.add("focused-event-column-end"),await G1(P),Le.value=!0,vt.value=`Événement ciblé : ${m.title}`,setTimeout(()=>{Le.value=!1},4e3),Ii.value=setTimeout(()=>{gy()},8e3)}function my(_){if(!_)return;const m=Qe.value.find(P=>P.id===_);if(!m){console.warn("Événement non trouvé dans la liste des événements"),setTimeout(()=>{const P=Qe.value.find(W=>W.id===_);P?tp(_,P):console.error("Événement toujours introuvable après retry")},500);return}tp(_,m)}Nt(Qe,_=>{try{const m=new URLSearchParams(window.location.search),P=m.get("modal"),W=m.get("event");if(!P||!W)return;const Z=_.find(ce=>ce.id===W);if(!Z)return;P==="announce"&&wd(Z),P==="selection"&&Mo(Z)}catch{}},{immediate:!0});async function G1(_){if(!_)return;if(await new Promise(P=>setTimeout(P,100)),window.innerWidth<=768){const P=Dr.value;if(P){const W=_.offsetLeft,Z=_.offsetWidth,ce=P.clientWidth,ie=W-ce/2+Z/2,Re=P.scrollWidth-ce,Ke=Math.max(0,Math.min(ie,Re));P.scrollTo({left:Ke,behavior:"smooth"}),setTimeout(()=>{const Xe=_.getBoundingClientRect();if(Xe.left<0||Xe.right>window.innerWidth){const at=W-20;P.scrollTo({left:Math.max(0,at),behavior:"smooth"})}},500)}}else _.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const m=Dr.value;m&&setTimeout(()=>{const P=document.querySelector(`[data-event-id="${rs.value}"]`);if(P&&P.closest("tbody")){const W=P.offsetLeft,Z=P.offsetWidth,ce=m.clientWidth,ie=W-ce/2+Z/2,Re=m.scrollWidth-ce,Ke=Math.max(0,Math.min(ie,Re));m.scrollTo({left:Ke,behavior:"smooth"})}},300)}function gy(){Ii.value&&(clearTimeout(Ii.value),Ii.value=null),rs.value=null,au.value=!1,document.querySelectorAll(".focused-event-highlight").forEach(_=>{_.classList.remove("focused-event-highlight")}),document.querySelectorAll(".focused-event-column-start, .focused-event-column-end").forEach(_=>{_.classList.remove("focused-event-column-start","focused-event-column-end")})}async function W1(_){var m;if(!_)return!1;try{if(!((m=s.value)!=null&&m.email))return!1;const{db:P}=await dt(()=>Promise.resolve().then(()=>Yr),void 0),{doc:W,getDoc:Z}=await dt(()=>import("./index.esm-7beab343.js"),[]),ce=await Z(W(P,"userPreferences",s.value.email));if(ce.exists()){const ie=ce.data(),Re=ie.notifyAvailability===!0||ie.notifySelection===!0,Ke=(ie.notifyAvailabilityPush===!0||ie.notifySelectionPush===!0)&&!!localStorage.getItem("fcmToken");return Re||Ke}return!1}catch(P){return console.error("Erreur lors de la vérification de surveillance:",P),!1}}function Q1(_){_&&(zt.value={playerName:"Vous",eventTitle:_.title||"ce spectacle",seasonId:h.value,seasonSlug:e.slug,eventId:_.id},xn.value=!0)}function J1(_){xn.value=!1,zt.value=null,Le.value=!0,_.directActivation?vt.value=`Notifications activées directement pour ${_.playerName} !`:vt.value=`Email envoyé à ${_.email} pour activer les notifications !`,setTimeout(()=>{Le.value=!1},4e3),L.info("Activation des notifications terminée avec succès",_)}return(_,m)=>{var P,W,Z,ce,ie,Re,Ke,Xe,at,Ht,En,In,Lt,Vr,is,Lo,Wa,vy,yy,_y,by,wy,xy,Ey,Iy,Ty,Ay,Sy,Py,Ry,Cy;return C(),N(xt,null,[c("div",Dz,[Be(W9,{"season-name":d.value,"is-scrolled":g.value,onGoBack:O1,onOpenAccountMenu:gs,onOpenHelp:m[0]||(m[0]=K=>ps.value=!0),onOpenNotifications:nd,onOpenPlayers:iu,onLogout:Po,onOpenLogin:ou,onOpenAccount:ou},null,8,["season-name","is-scrolled"]),c("div",Nz,[c("div",{ref_key:"headerBarRef",ref:ld,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[c("div",Oz,[Qe.value.length===0&&it.value.length===0?ae("",!0):(C(),N("div",Vz,[c("div",Mz,[c("button",{onClick:uu,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel événement"},m[77]||(m[77]=[c("span",{class:"text-lg"},"➕",-1),c("span",{class:"hidden sm:inline"},"Ajouter un événement",-1),c("span",{class:"sm:hidden"},"Événement",-1)])),c("div",Lz,[(P=f.value)!=null&&P.logoUrl?(C(),N("div",$z,[c("img",{src:f.value.logoUrl,alt:`Logo de ${d.value}`,class:"w-full h-full object-cover"},null,8,Fz)])):(C(),N("span",Uz,"🎭"))])])])),c("div",jz,[c("div",{ref_key:"headerEventsRef",ref:mr,class:"flex relative z-[60]",style:Mr({transform:`translateX(-${Ma.value}px)`})},[(C(!0),N(xt,null,Lr(sr.value,K=>(C(),N("div",{key:"h-"+K.id,"data-event-id":K.id,class:Qt(["col-event flex-shrink-0 p-3 text-center flex flex-col justify-between",{"archived-header":K.archived}])},[c("div",{class:"flex flex-col items-center justify-between p-2 rounded-lg hover:bg-white/10 transition-colors duration-200 cursor-pointer group h-24",title:K.title+" - Cliquez pour voir les détails",onClick:mt(mn=>yd(K),["stop"])},[c("div",zz,[c("div",Hz,oe(K.title||"Sans titre"),1),K.archived?(C(),N("div",Kz,"(Archivé)")):ae("",!0)]),c("div",Gz,[c("div",{onClick:mt(mn=>z(K.id),["stop"]),class:"header-date text-[16px] md:text-base text-gray-300 group-hover:text-purple-200 transition-colors duration-200 cursor-pointer hover:bg-white/10 px-2 py-1 rounded",title:du(K.date)+" - Cliquez pour ajouter à votre agenda"},oe(vd(K.date)),9,Wz),nn.value===K.id?(C(),N("div",Qz,[c("div",Jz,[c("button",{onClick:mt(mn=>{Ga("google",K),we()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},m[78]||(m[78]=[c("span",null,"🌐",-1),c("span",null,"Google Calendar",-1)]),8,Yz),c("button",{onClick:mt(mn=>{Ga("outlook",K),we()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},m[79]||(m[79]=[c("span",null,"📧",-1),c("span",null,"Outlook",-1)]),8,Xz),c("button",{onClick:mt(mn=>{Ga("ics",K),we()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Télécharger un fichier .ics compatible avec tous les agendas"},m[80]||(m[80]=[c("span",null,"📥",-1),c("span",null,"Télécharger (.ics)",-1)]),8,Zz)])])):ae("",!0)])],8,qz),c("div",e8,[K.archived?(C(),N("div",t8,m[81]||(m[81]=[c("span",{class:"text-xs text-gray-300 font-medium"},"📁",-1),c("span",{class:"text-xs text-gray-200 font-medium ml-1"},"Archivé",-1)]))):Vo(K.id).type==="ready"?(C(),N("div",{key:1,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-blue-500/30 transition-colors duration-200 cursor-pointer group",title:fu(K.id)+" - Cliquez pour ouvrir la sélection",onClick:mt(mn=>Mo(K),["stop"])},m[82]||(m[82]=[c("span",{class:"text-xs text-blue-300 font-medium group-hover:text-blue-200"},"🆕",-1),c("span",{class:"text-xs text-blue-200 font-medium ml-1 group-hover:text-blue-100"},"Nouveau",-1)]),8,n8)):Vo(K.id).type==="complete"?(C(),N("div",{key:2,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-green-500/30 transition-colors duration-200 cursor-pointer group",title:fu(K.id)+" - Cliquez pour ouvrir la sélection",onClick:mt(mn=>Mo(K),["stop"])},m[83]||(m[83]=[c("span",{class:"text-xs text-green-300 font-medium group-hover:text-green-200"},"✅",-1),c("span",{class:"text-xs text-green-200 font-medium ml-1 group-hover:text-green-100"},"Complet",-1)]),8,r8)):Vo(K.id).type==="incomplete"?(C(),N("div",{key:3,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-orange-500/30 transition-colors duration-200 cursor-pointer group",title:fu(K.id)+" - Cliquez pour ouvrir la sélection",onClick:mt(mn=>Mo(K),["stop"])},m[84]||(m[84]=[c("span",{class:"text-xs text-orange-300 font-medium group-hover:text-orange-200"},"⚠️",-1),c("span",{class:"text-xs text-orange-200 font-medium ml-1 group-hover:text-orange-100"},"À finaliser",-1)]),8,s8)):Vo(K.id).type==="insufficient"?(C(),N("div",{key:4,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-red-500/30 transition-colors duration-200 cursor-pointer group",title:fu(K.id)+" - Cliquez pour ouvrir la sélection",onClick:mt(mn=>Mo(K),["stop"])},m[85]||(m[85]=[c("span",{class:"text-xs text-red-300 font-medium group-hover:text-red-200"},"❌",-1),c("span",{class:"text-xs text-red-200 font-medium ml-1 group-hover:text-red-100"},"Manque",-1)]),8,i8)):ae("",!0)])],10,Bz))),128))],4)]),m[88]||(m[88]=c("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),c("button",{onClick:Xf,class:"absolute right-2 top-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[86] backdrop-blur-sm",title:js.value?"Masquer les événements archivés":"Afficher les événements archivés","aria-label":js.value?"Masquer les événements archivés":"Afficher les événements archivés"},[(C(),N("svg",a8,[m[86]||(m[86]=c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.25 12c1.5-4 5.25-7.5 9.75-7.5S20.25 8 21.75 12c-1.5 4-5.25 7.5-9.75 7.5S3.75 16 2.25 12z"},null,-1)),m[87]||(m[87]=c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)),js.value?ae("",!0):(C(),N("path",l8))]))],8,o8),tt(c("button",{onClick:m[1]||(m[1]=mt(K=>Ai(-1,K),["prevent"])),onMousedown:m[2]||(m[2]=mt(K=>La(-1,K),["prevent"])),onMouseup:m[3]||(m[3]=K=>zr(K)),onMouseleave:m[4]||(m[4]=K=>zr(K)),onTouchstart:m[5]||(m[5]=mt(K=>La(-1,K),["prevent"])),onTouchend:m[6]||(m[6]=K=>zr(K)),onTouchcancel:m[7]||(m[7]=K=>zr(K)),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements précédents — cliquez pour défiler"}," ‹ ",544),[[fp,od.value]]),tt(c("button",{onClick:m[8]||(m[8]=mt(K=>Ai(1,K),["prevent"])),onMousedown:m[9]||(m[9]=mt(K=>La(1,K),["prevent"])),onMouseup:m[10]||(m[10]=K=>zr(K)),onMouseleave:m[11]||(m[11]=K=>zr(K)),onTouchstart:m[12]||(m[12]=mt(K=>La(1,K),["prevent"])),onTouchend:m[13]||(m[13]=K=>zr(K)),onTouchcancel:m[14]||(m[14]=K=>zr(K)),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements suivants — cliquez pour défiler"}," › ",544),[[fp,ad.value]])])],512),tt(c("div",{ref_key:"gridboardRef",ref:Dr,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[kt.value===1?(C(),N("div",u8,[I.value.position?(C(),N("div",{key:0,class:"fixed z-[400]",style:Mr({left:I.value.position.x+"px",top:I.value.position.y+"px"})},[c("div",{id:"coachmark-add",class:Qt(["coachmark pointer-events-auto max-w-sm bg-gray-900 border border-purple-500/40 rounded-xl shadow-2xl p-3 text-white relative",{"coachmark-right":I.value.side==="right","coachmark-left":I.value.side==="left"}])},[m[90]||(m[90]=c("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ajoutez votre nom",-1)),m[91]||(m[91]=c("div",{class:"text-base md:text-sm text-gray-300 mb-2"},'Cliquez sur "Ajouter un joueur" pour vous inscrire',-1)),c("div",c8,[m[89]||(m[89]=c("span",{class:"text-purple-300 text-base md:text-sm"},"Étape 1/4",-1)),c("button",{onClick:m[15]||(m[15]=K=>za(0)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant >")])],2)],4)):ae("",!0)])):ae("",!0),kt.value===2&&re.value&&k.value?(C(),N("div",d8,[T.value.position?(C(),N("div",{key:0,class:"fixed z-[400]",style:Mr({position:"absolute",left:T.value.position.x+"px",top:T.value.position.y+"px"})},[c("div",h8,[m[93]||(m[93]=c("div",{class:"text-lg md:text-base font-semibold mb-1"},"Indiquez vos disponibilités",-1)),m[94]||(m[94]=c("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez cette case pour alterner Oui / Non / Vide",-1)),c("div",f8,[m[92]||(m[92]=c("span",{class:"text-pink-300 text-base md:text-sm"},"Étape 2/4",-1)),c("button",{onClick:m[16]||(m[16]=K=>za(1)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ae("",!0)])):ae("",!0),kt.value===3&&re.value?(C(),N("div",p8,[V.value.position?(C(),N("div",{key:0,class:"fixed z-[400]",style:Mr({position:"absolute",left:V.value.position.x+"px",top:V.value.position.y+"px"})},[c("div",m8,[m[96]||(m[96]=c("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ouvrez votre fiche",-1)),m[97]||(m[97]=c("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez sur votre nom pour voir les détails et la protection",-1)),c("div",g8,[m[95]||(m[95]=c("span",{class:"text-yellow-300 text-base md:text-sm"},"Étape 3/4",-1)),c("button",{onClick:m[17]||(m[17]=K=>za(2)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ae("",!0)])):ae("",!0),c("table",v8,[c("colgroup",null,[m[98]||(m[98]=c("col",{class:"col-left"},null,-1)),(C(!0),N(xt,null,Lr(sr.value,(K,mn)=>(C(),N("col",{key:"c"+mn,class:"col-event"}))),128)),m[99]||(m[99]=c("col",{class:"col-right"},null,-1))]),m[103]||(m[103]=c("thead",{class:"hidden"},null,-1)),c("tbody",null,[(C(!0),N(xt,null,Lr(Us.value,K=>{var mn;return C(),N("tr",{key:K.id,class:Qt(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":K.id===de.value,"preferred-player":ss.value.has(K.id)}]),"data-player-id":K.id},[c("td",_8,[c("div",b8,[ss.value.has(K.id)?(C(),N("span",w8," ⭐ ")):Nr(K.id)?(C(),N("span",x8," 🔒 ")):ae("",!0),c("div",{onClick:Ir=>bd(K),class:Qt(["player-name hover:bg-white/10 rounded-lg p-2 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight block truncate max-w-full flex-1 min-w-0 group",{"inline-block rounded px-1 ring-2 ring-yellow-400 animate-pulse":kt.value===3&&K.id===(re.value||((mn=Us.value[0])==null?void 0:mn.id))}]),title:"Cliquez pour voir les détails : "+K.name},[c("span",I8,oe(K.name),1)],10,E8)])]),(C(!0),N(xt,null,Lr(sr.value,Ir=>{var ky,Dy,Ny;return C(),N("td",{key:Ir.id,"data-event-id":Ir.id,class:Qt(["p-0",Ir.archived?"archived-col":"",{"relative ring-2 ring-pink-400 rounded-md animate-pulse":kt.value===2&&K.id===(re.value||((ky=Us.value[0])==null?void 0:ky.id))&&Ir.id===(k.value||((Dy=sr.value[0])==null?void 0:Dy.id))}])},[Be(Qb,{"player-name":K.name,"event-id":Ir.id,"is-available":Qn(K.name,Ir.id),"is-selected":md(K.name,Ir.id),"chance-percent":((Ny=cu.value[K.name])==null?void 0:Ny[Ir.id])??null,"show-selected-chance":hu(Ir.id),disabled:Ir.archived===!0,onToggle:Ci},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])],10,T8)}),128)),m[100]||(m[100]=c("td",{class:"p-3 md:p-4"},null,-1))],10,y8)}),128)),c("tr",A8,[c("td",S8,[c("div",P8,[c("button",{onClick:m[18]||(m[18]=K=>A.value=!0),class:"w-full md:w-auto flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur","data-onboarding":"add-player"},m[101]||(m[101]=[c("span",{class:"text-lg"},"➕",-1),c("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),c("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(C(!0),N(xt,null,Lr(sr.value,K=>(C(),N("td",{key:"add-row-"+K.id,"data-event-id":K.id,class:Qt(["p-3 md:p-5",K.archived?"archived-col":""])},null,10,R8))),128)),m[102]||(m[102]=c("td",{class:"p-3 md:p-4"},null,-1))])])])],512),[[fp,!ns.value]])])]),ns.value?(C(),N("div",C8,[c("div",k8,[m[104]||(m[104]=c("div",{class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"},[c("span",{class:"text-3xl"},"🎭")],-1)),c("p",D8,oe(Ms.value)+"…",1),c("div",N8,[c("div",{class:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-300",style:Mr({width:vs.value+"%"})},null,4)]),c("p",O8,oe(vs.value)+"%",1)])])):ae("",!0),ns.value?ae("",!0):(C(),ti(B9,{key:1,"season-id":h.value,"season-slug":$r(l),"players-count":it.value.length,"events-count":Qe.value.length,"onboarding-done":((W=f.value)==null?void 0:W.onboardingCreatorDone)===!0,onCreateEvent:uu,onAddPlayer:m[19]||(m[19]=()=>{A.value=!0}),onCopyLink:Wf,onDismissed:Ro},null,8,["season-id","season-slug","players-count","events-count","onboarding-done"])),ae("",!0),Le.value?(C(),N("div",V8,[c("div",M8,[m[105]||(m[105]=c("span",{class:"text-xl"},"✨",-1)),c("span",null,oe(vt.value),1)])])):ae("",!0),Un.value?(C(),N("div",L8,[c("div",$8,[m[106]||(m[106]=c("span",{class:"text-xl"},"⚠️",-1)),c("span",null,oe(Si.value),1)])])):ae("",!0),Do.value?(C(),N("div",F8,[c("div",U8,[m[112]||(m[112]=c("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvel événement",-1)),c("div",j8,[m[107]||(m[107]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),tt(c("input",{"onUpdate:modelValue":m[20]||(m[20]=K=>Hr.value=K),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'événement"},null,512),[[Ut,Hr.value]])]),c("div",B8,[m[108]||(m[108]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),tt(c("input",{"onUpdate:modelValue":m[21]||(m[21]=K=>Kr.value=K),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[Ut,Kr.value]])]),c("div",q8,[m[109]||(m[109]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),tt(c("textarea",{"onUpdate:modelValue":m[22]||(m[22]=K=>Pi.value=K),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)"},null,512),[[Ut,Pi.value]])]),c("div",z8,[tt(c("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":m[23]||(m[23]=K=>Gt.value=K),class:"w-4 h-4"},null,512),[[Wr,Gt.value]]),m[110]||(m[110]=c("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Créer comme archivé",-1))]),c("div",H8,[m[111]||(m[111]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),tt(c("input",{"onUpdate:modelValue":m[24]||(m[24]=K=>Fs.value=K),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[Ut,Fs.value]])]),c("div",{class:"flex justify-end space-x-3"},[c("button",{onClick:dd,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),c("button",{onClick:Jf,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):ae("",!0),A.value?(C(),N("div",K8,[c("div",G8,[m[114]||(m[114]=c("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau joueur",-1)),c("div",W8,[m[113]||(m[113]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),tt(c("input",{"onUpdate:modelValue":m[25]||(m[25]=K=>j.value=K),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[Ut,j.value]])]),c("div",Q8,[c("button",{onClick:m[26]||(m[26]=K=>A.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),c("button",{onClick:Fa,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):ae("",!0),v.value?(C(),N("div",J8,[c("div",Y8,[m[115]||(m[115]=_r('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cet événement ?</p></div>',1)),c("div",X8,[c("button",{onClick:Qf,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),c("button",{onClick:m[27]||(m[27]=()=>_s()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ae("",!0),q.value?(C(),N("div",Z8,[c("div",eH,[m[116]||(m[116]=_r('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce joueur ?</p></div>',1)),c("div",tH,[c("button",{onClick:Te,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),c("button",{onClick:m[28]||(m[28]=()=>Y()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):ae("",!0),U.value?(C(),N("div",nH,[c("div",rH,[c("div",sH,[m[117]||(m[117]=c("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[c("span",{class:"text-2xl"},"🎭")],-1)),m[118]||(m[118]=c("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),c("p",iH,[$.value&&rt.value[$.value]&&rt.value[$.value].every(K=>Qn(K,$.value))?(C(),N("span",oH,"Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.")):(C(),N("span",aH,"La sélection sera mise à jour : les joueurs disponibles seront conservés, les slots vides seront complétés."))])]),c("div",{class:"flex justify-end space-x-3"},[c("button",{onClick:Rt,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),c("button",{onClick:Mn,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):ae("",!0),Ie.value?(C(),N("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:_d},[c("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:m[43]||(m[43]=mt(()=>{},["stop"]))},[c("div",lH,[c("button",{onClick:_d,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),c("div",uH,[m[126]||(m[126]=c("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[c("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),c("div",cH,[c("div",dH,[c("h2",hH,oe((Z=X.value)==null?void 0:Z.title),1),c("div",fH,[m[119]||(m[119]=c("span",{class:"text-blue-300"},"👥",-1)),c("span",pH,oe(((ce=X.value)==null?void 0:ce.playerCount)||6)+" joueurs",1)])]),c("div",mH,[c("p",gH,oe(du((ie=X.value)==null?void 0:ie.date)),1),c("div",vH,[c("button",{onClick:m[29]||(m[29]=K=>ze()),class:"px-3 py-1.5 hover:bg-white/20 rounded text-purple-300 hover:text-green-400 transition-colors duration-200 text-sm flex items-center gap-2 border border-purple-500/30",title:"Ajouter à votre agenda"},m[120]||(m[120]=[c("span",null,"📅",-1),c("span",null,"Agenda",-1)])),Xt.value?(C(),N("div",yH,[c("div",_H,[c("button",{onClick:m[30]||(m[30]=K=>{Ga("google"),Ye()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},m[121]||(m[121]=[c("span",null,"🌐",-1),c("span",null,"Google Calendar",-1)])),c("button",{onClick:m[31]||(m[31]=K=>{Ga("outlook"),Ye()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},m[122]||(m[122]=[c("span",null,"📧",-1),c("span",null,"Outlook",-1)])),c("button",{onClick:m[32]||(m[32]=K=>{Ga("ics"),Ye()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Télécharger un fichier .ics compatible avec tous les agendas"},m[123]||(m[123]=[c("span",null,"📥",-1),c("span",null,"Télécharger (.ics)",-1)]))])])):ae("",!0)])]),(Re=X.value)!=null&&Re.description?(C(),N("div",bH,oe(X.value.description),1)):ae("",!0),c("div",wH,[o.value?(C(),N("div",xH,m[124]||(m[124]=[c("span",{class:"text-blue-300"},"✅",-1),c("span",{class:"text-blue-200"},"Notifications activées",-1)]))):(C(),N("button",{key:1,onClick:m[33]||(m[33]=K=>Q1(X.value)),class:"flex items-center gap-2 px-3 py-1.5 bg-gray-500/15 border border-gray-400/25 rounded text-sm hover:bg-gray-500/25 transition-colors duration-200 cursor-pointer",title:"Reçois des alertes en temps réel : sélections, changements d'horaires, et plus !"},m[125]||(m[125]=[c("span",{class:"text-gray-300"},"🔔",-1),c("span",{class:"text-gray-200"},"Activer les notifications",-1)])))])])])]),c("div",EH,[c("div",IH,[c("div",TH,[c("div",AH,oe(jn((Ke=X.value)==null?void 0:Ke.id)),1),m[127]||(m[127]=c("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),c("div",SH,[c("div",PH,oe(Oo((Xe=X.value)==null?void 0:Xe.id)),1),m[128]||(m[128]=c("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),c("div",RH,[c("div",CH,oe(Math.max((((at=X.value)==null?void 0:at.playerCount)||6)-Oo((Ht=X.value)==null?void 0:Ht.id),0)),1),m[129]||(m[129]=c("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))])]),X.value?(C(),N("div",kH,[c("div",DH,[pd.value?(C(),N("div",{key:0,class:Qt(["flex items-center gap-2 px-2 py-1 rounded-md border text-[11px] md:text-xs max-w-[70%] truncate",((En=fd.value)==null?void 0:En.type)==="incomplete"?"bg-yellow-500/10 border-yellow-500/30 text-yellow-200":"bg-orange-500/10 border-orange-500/30 text-orange-200"]),title:Ba.value},[m[130]||(m[130]=c("span",null,"⚠️",-1)),c("span",OH,oe(Ba.value),1)],10,NH)):ae("",!0),tt(c("select",{"onUpdate:modelValue":m[34]||(m[34]=K=>ja.value=K),class:"ml-auto bg-gray-800 text-white rounded-md px-3 py-2 border border-white/10 focus:outline-none text-sm",title:"Filtrer les joueurs par statut"},m[131]||(m[131]=[_r('<option value="selected">Sélectionnés</option><option value="available">Disponibles</option><option value="unavailable">Non Disponibles</option><option value="unknown">Pas de réponse</option><option value="all">Tous</option>',5)]),512),[[yR,ja.value]])]),c("div",VH,[(C(!0),N(xt,null,Lr(No.value,K=>{var mn,Ir;return C(),N("div",{key:K.id,class:"flex items-center justify-between px-2 py-1.5 rounded-md hover:bg-gray-800/40 transition-colors"},[c("div",MH,[ss.value.has(K.id)?(C(),N("span",LH," ⭐ ")):Nr(K.id)?(C(),N("span",$H," 🔒 ")):ae("",!0),c("span",{class:"text-white text-sm md:text-base block truncate max-w-full flex-1 min-w-0",title:K.name},oe(K.name),9,FH)]),c("div",UH,[Be(Qb,{"player-name":K.name,"event-id":X.value.id,"is-available":ep(X.value.id)[K.name],"is-selected":L1(K.name,X.value.id),"chance-percent":((mn=cu.value[K.name])==null?void 0:mn[X.value.id])??null,"show-selected-chance":hu(X.value.id),disabled:((Ir=X.value)==null?void 0:Ir.archived)===!0,compact:!0,onToggle:M1},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])])])}),128))])])):ae("",!0),c("div",jH,[c("button",{onClick:m[35]||(m[35]=K=>Mo(X.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},m[132]||(m[132]=[c("span",null,"🎭",-1),c("span",null,"Sélectionner",-1)])),c("button",{onClick:m[36]||(m[36]=K=>wd(X.value)),disabled:(In=X.value)==null?void 0:In.archived,class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(Lt=X.value)!=null&&Lt.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[133]||(m[133]=[c("span",null,"📢",-1),c("span",null,"Annoncer",-1)]),8,BH),c("div",{class:"relative",ref_key:"eventMoreActionsRef",ref:Oe},[c("button",{onClick:m[37]||(m[37]=K=>xi()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},m[134]||(m[134]=[c("span",null,"⋯",-1),c("span",null,"Plus",-1)]))],512),c("button",{onClick:_d,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),(C(),ti(ec,{to:"body"},[_e.value?(C(),N("div",{key:0,ref_key:"eventMoreActionsDropdownRef",ref:qe,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:Mr(Ue.value)},[c("button",{onClick:m[38]||(m[38]=K=>{uy(),_e.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},m[135]||(m[135]=[c("span",null,"✏️",-1),c("span",null,"Modifier",-1)])),c("button",{onClick:m[39]||(m[39]=K=>{cy(),_e.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10",title:(Vr=X.value)!=null&&Vr.archived?"Désarchiver cet événement":"Archiver cet événement"},[c("span",null,oe((is=X.value)!=null&&is.archived?"📂":"📁"),1),c("span",null,oe((Lo=X.value)!=null&&Lo.archived?"Désarchiver":"Archiver"),1)],8,qH),c("button",{onClick:m[40]||(m[40]=K=>{var mn;cd((mn=X.value)==null?void 0:mn.id),_e.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[136]||(m[136]=[c("span",null,"🗑️",-1),c("span",null,"Supprimer",-1)]))],4)):ae("",!0)]))])]),c("div",zH,[c("button",{onClick:m[41]||(m[41]=K=>Mo(X.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélectionner"),c("button",{onClick:_d,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),c("button",{onClick:m[42]||(m[42]=K=>ue()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):ae("",!0),(C(),ti(ec,{to:"body"},[Ce.value?(C(),N("div",{key:0,ref_key:"eventMoreActionsMobileDropdownRef",ref:Ze,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:Mr(ht.value)},[c("button",{onClick:m[44]||(m[44]=K=>{wd(X.value),Ce.value=!1}),disabled:(Wa=X.value)==null?void 0:Wa.archived,class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10 disabled:opacity-50 disabled:cursor-not-allowed",title:(vy=X.value)!=null&&vy.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[137]||(m[137]=[c("span",null,"📢",-1),c("span",null,"Annoncer",-1)]),8,HH),c("button",{onClick:m[45]||(m[45]=K=>{uy(),Ce.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},m[138]||(m[138]=[c("span",null,"✏️",-1),c("span",null,"Modifier",-1)])),c("button",{onClick:m[46]||(m[46]=K=>{cy(),Ce.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},[c("span",null,oe((yy=X.value)!=null&&yy.archived?"📂":"📁"),1),c("span",null,oe((_y=X.value)!=null&&_y.archived?"Désarchiver":"Archiver"),1)]),c("button",{onClick:m[47]||(m[47]=K=>{var mn;cd((mn=X.value)==null?void 0:mn.id),Ce.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[139]||(m[139]=[c("span",null,"🗑️",-1),c("span",null,"Supprimer",-1)]))],4)):ae("",!0)])),Be(ay,{show:ut.value,player:pt.value,seasonId:h.value,onClose:m[48]||(m[48]=K=>ut.value=!1),onVerified:$1},null,8,["show","player","seasonId"]),b.value?(C(),N("div",KH,[c("div",GH,[m[145]||(m[145]=c("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier l'événement",-1)),c("div",WH,[m[140]||(m[140]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),tt(c("input",{"onUpdate:modelValue":m[49]||(m[49]=K=>x.value=K),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[or(bs,["esc"]),or(lu,["enter"])],ref:"editTitleInput"},null,544),[[Ut,x.value]])]),c("div",QH,[m[141]||(m[141]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),tt(c("input",{"onUpdate:modelValue":m[50]||(m[50]=K=>M.value=K),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[or(bs,["esc"]),or(lu,["enter"])]},null,544),[[Ut,M.value]])]),c("div",JH,[m[142]||(m[142]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),tt(c("textarea",{"onUpdate:modelValue":m[51]||(m[51]=K=>ve.value=K),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)",onKeydown:or(bs,["esc"])},null,544),[[Ut,ve.value]])]),c("div",YH,[tt(c("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":m[52]||(m[52]=K=>pe.value=K),class:"w-4 h-4"},null,512),[[Wr,pe.value]]),m[143]||(m[143]=c("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver cet événement",-1))]),c("div",XH,[m[144]||(m[144]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),tt(c("input",{"onUpdate:modelValue":m[53]||(m[53]=K=>O.value=K),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:or(bs,["esc"])},null,544),[[Ut,O.value]])]),c("div",{class:"flex justify-end space-x-3"},[c("button",{onClick:bs,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),c("button",{onClick:lu,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ae("",!0),Be(WA,{show:yt.value,message:Bn(),error:se.value,"session-info":N1(),onSubmit:Or,onCancel:Ha},null,8,["show","message","error","session-info"]),B.value?(C(),N("div",ZH,[c("div",e7,[m[147]||(m[147]=_r('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protégé par mot de passe</p></div>',1)),c("div",t7,[c("div",n7,[c("div",null,[m[146]||(m[146]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),tt(c("input",{"onUpdate:modelValue":m[54]||(m[54]=K=>te.value=K),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[55]||(m[55]=or(K=>Ka(te.value),["enter"])),ref_key:"playerPasswordInputRef",ref:gt},null,544),[[Ut,te.value]])])]),c("button",{onClick:m[56]||(m[56]=K=>Ka(te.value)),disabled:!te.value||De.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[De.value?(C(),N("span",s7,"⏳")):(C(),N("span",i7,"🔓")),c("span",null,oe(De.value?"Vérification...":"Vérifier et supprimer"),1)],8,r7)]),c("div",o7,[c("button",{onClick:m[57]||(m[57]=K=>G.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),ne.value?(C(),N("div",a7,[c("div",l7,oe(ne.value),1)])):ae("",!0),c("div",{class:"flex justify-center"},[c("button",{onClick:R1,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ae("",!0),At.value?(C(),N("div",u7,[c("div",c7,[m[150]||(m[150]=_r('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protégé par mot de passe</p></div>',1)),c("div",d7,[c("div",h7,[c("div",null,[m[148]||(m[148]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),tt(c("input",{"onUpdate:modelValue":m[58]||(m[58]=K=>xe.value=K),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[59]||(m[59]=or(K=>ly(xe.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:Ne},null,544),[[Ut,xe.value]])])]),c("div",f7,[c("button",{onClick:m[60]||(m[60]=K=>ot.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),J.value?(C(),N("div",p7,[c("div",m7,oe(J.value),1)])):ae("",!0)]),c("div",g7,[c("button",{onClick:C1,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),c("button",{onClick:m[61]||(m[61]=K=>ly(xe.value)),disabled:!xe.value||be.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[be.value?(C(),N("span",y7,"⏳")):(C(),N("span",_7,"🔓")),c("span",null,[ft(oe(be.value?"Vérification...":"Vérifier"),1),m[149]||(m[149]=c("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,v7)])])])):ae("",!0),ot.value?(C(),N("div",{key:14,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[64]||(m[64]=K=>ot.value=!1)},[c("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[63]||(m[63]=mt(()=>{},["stop"]))},[m[152]||(m[152]=_r('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),c("div",b7,[m[151]||(m[151]=c("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),c("button",{onClick:k1,disabled:bt.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[bt.value?(C(),N("span",x7,"⏳")):(C(),N("span",E7,"📧")),c("span",null,oe(bt.value?"Envoi...":"Envoyer l'email"),1)],8,w7)]),R.value?(C(),N("div",I7,[c("div",T7,oe(R.value),1)])):ae("",!0),F.value?(C(),N("div",A7,[c("div",S7,oe(F.value),1)])):ae("",!0),c("div",P7,[c("button",{onClick:m[62]||(m[62]=K=>ot.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ae("",!0),G.value?(C(),N("div",{key:15,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[67]||(m[67]=K=>G.value=!1)},[c("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[66]||(m[66]=mt(()=>{},["stop"]))},[m[154]||(m[154]=_r('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p></div>',1)),c("div",R7,[m[153]||(m[153]=c("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),c("button",{onClick:D1,disabled:he.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[he.value?(C(),N("span",k7,"⏳")):(C(),N("span",D7,"📧")),c("span",null,oe(he.value?"Envoi...":"Envoyer l'email"),1)],8,C7)]),le.value?(C(),N("div",N7,[c("div",O7,oe(le.value),1)])):ae("",!0),fe.value?(C(),N("div",V7,[c("div",M7,oe(fe.value),1)])):ae("",!0),c("div",L7,[c("button",{onClick:m[65]||(m[65]=K=>G.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ae("",!0),Be($q,{ref_key:"playerModalRef",ref:Tt,show:D.value,player:je.value,stats:j1(je.value),seasonId:h.value,"onboarding-step":kt.value,"onboarding-player-id":re.value,"is-protected":je.value?rr.value.has(je.value.id):!1,"is-preferred":je.value?ss.value.has(je.value.id):!1,onClose:dy,onUpdate:F1,onDelete:jt,onRefresh:U1,onAdvanceOnboarding:m[68]||(m[68]=K=>{try{typeof kt.value<"u"&&(kt.value.value=K)}catch{}})},null,8,["show","player","stats","seasonId","onboarding-step","onboarding-player-id","is-protected","is-preferred"]),Be(R9,{ref_key:"selectionModalRef",ref:Wn,show:nt.value,event:ct.value,"current-selection":rt.value[(by=ct.value)==null?void 0:by.id]||[],"available-count":jn((wy=ct.value)==null?void 0:wy.id),"selected-count":Oo((xy=ct.value)==null?void 0:xy.id),"player-availability":ep((Ey=ct.value)==null?void 0:Ey.id),"season-id":h.value,"season-slug":$r(l),players:Ls.value,onClose:py,onSelection:z1,onPerfect:H1,onSendNotifications:fy,onUpdateSelection:K1},null,8,["show","event","current-selection","available-count","selected-count","player-availability","season-id","season-slug","players"]),Be(A1,{show:nr.value,event:Vn.value,"season-id":h.value,"season-slug":$r(l),players:Ls.value,sending:Zf.value,"availability-by-player":ep((Iy=Vn.value)==null?void 0:Iy.id),onClose:q1,onSendNotifications:fy},null,8,["show","event","season-id","season-slug","players","sending","availability-by-player"]),Be(yB,{show:ps.value,onClose:m[69]||(m[69]=K=>ps.value=!1)},null,8,["show"]),Be(f1,{show:Vs.value,"season-id":h.value,onClose:Oa,onManagePlayer:Va,onChangePassword:zf,onLogoutDevice:Po,onDeleteAccount:sd},null,8,["show","season-id"]),Be(p1,{show:Na.value,onClose:su},null,8,["show"]),Be(m1,{show:Ao.value,onClose:rd,onManagePlayer:Va},null,8,["show"]),Be(pz,{show:xn.value,"player-name":((Ty=zt.value)==null?void 0:Ty.playerName)||"","event-title":((Ay=zt.value)==null?void 0:Ay.eventTitle)||"","season-id":h.value,"season-slug":$r(l),"event-id":((Sy=zt.value)==null?void 0:Sy.eventId)||"",onClose:m[70]||(m[70]=K=>xn.value=!1),onSuccess:J1},null,8,["show","player-name","event-title","season-id","season-slug","event-id"]),Be(kz,{show:pr.value,"player-name":((Py=kr.value)==null?void 0:Py.playerName)||"",email:((Ry=kr.value)==null?void 0:Ry.email)||"","season-slug":$r(l),"event-id":((Cy=kr.value)==null?void 0:Cy.eventId)||null,onClose:m[71]||(m[71]=K=>pr.value=!1)},null,8,["show","player-name","email","season-slug","event-id"]),Be(S1,{show:ru.value,player:So.value,"season-id":h.value,onClose:m[72]||(m[72]=K=>ru.value=!1),onSuccess:m[73]||(m[73]=()=>{ru.value=!1,Vs.value=!0})},null,8,["show","player","season-id"]),Be(QA,{show:ms.value,onClose:m[74]||(m[74]=K=>ms.value=!1),onSuccess:m[75]||(m[75]=()=>{ms.value=!1,Vs.value=!0})},null,8,["show"]),Ei.value?(C(),N("div",$7,[c("div",F7,[m[155]||(m[155]=c("h3",{class:"text-xl font-bold text-white mb-4 text-center"},"Voulez-vous annoncer cet événement ?",-1)),m[156]||(m[156]=c("p",{class:"text-gray-300 text-center mb-6"},"Envoyer des notifications aux joueurs pour qu'ils indiquent leur disponibilité",-1)),c("div",U7,[c("button",{onClick:m[76]||(m[76]=K=>wd(Os.value)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300"}," 📢 Oui "),c("button",{onClick:hy,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300"}," Plus tard ")])])])):ae("",!0)],64)}}},j7={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},B7={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},q7={key:0,class:"text-center py-8"},z7={key:1,class:"text-center py-8"},H7={class:"text-gray-300 mb-6"},K7={key:2,class:"space-y-6"},G7={class:"text-center"},W7={class:"text-gray-300 mb-4"},Q7={class:"font-semibold text-white"},J7={class:"space-y-4"},Y7=["disabled"],X7={key:0,class:"animate-spin"},Z7={key:1},eK={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},tK={class:"text-red-300 text-sm"},nK={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},rK={class:"text-green-300 text-sm"},sK={__name:"PasswordReset",setup(n){const e=_o(),t=Ea(),r=S(!0),s=S(""),i=S(""),o=S(""),a=S(""),l=S(""),d=S(!1),h=S(""),f=S(""),g=He(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);Sn(async()=>{try{const{oobCode:b}=e.query;if(L.debug("Token reçu (masqué)"),!b){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=b;try{L.debug("Vérification du token et récupération de l'email...");const x=await V4($e,b);i.value=x,L.info("Email récupéré depuis le token:",x)}catch(x){L.error("Erreur lors de la vérification du token:",x),s.value="Lien de réinitialisation invalide ou expiré",r.value=!1;return}r.value=!1}catch(b){L.error("Erreur lors de la vérification du lien",b),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function v(){if(g.value){d.value=!0,h.value="",f.value="";try{L.debug("Début réinitialisation avec token (masqué)"),await N4($e,o.value,a.value),L.info("Mot de passe Firebase Auth mis à jour"),L.info("Réinitialisation terminée avec Firebase Auth");try{L.debug("Tentative de connexion automatique...");const b=await bA($e,i.value,a.value);L.info("Connexion automatique réussie après reset",{uid:b.user.uid}),f.value="Mot de passe réinitialisé et connexion réussie ! Redirection...",setTimeout(()=>{w()},2e3)}catch(b){L.error("Erreur lors de la connexion automatique",b),f.value="Mot de passe réinitialisé ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{w()},3e3)}}catch(b){L.error("Erreur lors de la réinitialisation",b),b.code==="auth/weak-password"?h.value="Le mot de passe doit contenir au moins 6 caractères":b.code==="auth/invalid-action-code"?h.value="Lien de réinitialisation invalide ou expiré":h.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{d.value=!1}}}async function w(){try{const b=localStorage.getItem("pendingPasswordResetNavigation");if(b)try{const M=JSON.parse(b),{lastVisitedPage:O,timestamp:A,email:j}=M,de=Date.now()-A<36e5,re=j===i.value;if(de&&re&&Fb(O)){if(L.info("✅ Redirection vers la page sauvegardée:",O),localStorage.removeItem("pendingPasswordResetNavigation"),M.returnToAccountMenu){const k=new URL(O,window.location.origin),I=new URLSearchParams(k.search);if(M.modalState){const{modalState:V}=M;V.eventId&&(I.set("event",V.eventId),I.set("modal","event_details")),V.playerId&&(I.set("player",V.playerId),I.set("modal","player_details")),I.set("open","account")}const T=`${k.pathname}?${I.toString()}`;L.info('🔄 Redirection vers "Mon Compte" avec état complet:',T),t.push(T)}else t.push(O);return}else L.info("⚠️ Navigation sauvegardée invalide ou expirée, nettoyage..."),localStorage.removeItem("pendingPasswordResetNavigation")}catch(M){L.error("Erreur lors du parsing de la navigation sauvegardée:",M),localStorage.removeItem("pendingPasswordResetNavigation")}const x=await L$(i.value);x!=null&&x.lastVisitedPage&&Fb(x.lastVisitedPage)?(L.info("Redirection vers la dernière page visitée (Firestore):",x.lastVisitedPage),t.push(x.lastVisitedPage)):(L.info("Aucune page précédente valide, redirection vers les saisons"),t.push("/seasons"))}catch(b){L.error("Erreur lors de la récupération de la navigation, redirection vers les saisons",b),t.push("/seasons")}}return(b,x)=>(C(),N("div",j7,[c("div",B7,[x[8]||(x[8]=_r('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(C(),N("div",q7,x[2]||(x[2]=[c("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),c("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(C(),N("div",z7,[x[3]||(x[3]=c("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[c("span",{class:"text-2xl"},"❌")],-1)),x[4]||(x[4]=c("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),c("p",H7,oe(s.value),1),c("button",{onClick:w,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):o.value?(C(),N("div",K7,[c("div",G7,[c("p",W7,[x[5]||(x[5]=ft(" Réinitialisation pour ")),c("span",Q7,oe(i.value),1)])]),c("div",J7,[c("div",null,[x[6]||(x[6]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),tt(c("input",{"onUpdate:modelValue":x[0]||(x[0]=M=>a.value=M),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:or(v,["enter"])},null,544),[[Ut,a.value]])]),c("div",null,[x[7]||(x[7]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),tt(c("input",{"onUpdate:modelValue":x[1]||(x[1]=M=>l.value=M),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:or(v,["enter"])},null,544),[[Ut,l.value]])])]),c("button",{onClick:v,disabled:!g.value||d.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[d.value?(C(),N("span",X7,"⏳")):(C(),N("span",Z7,"🔑")),c("span",null,oe(d.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,Y7),h.value?(C(),N("div",eK,[c("div",tK,oe(h.value),1)])):ae("",!0),f.value?(C(),N("div",nK,[c("div",rK,oe(f.value),1)])):ae("",!0)])):ae("",!0)])]))}},iK={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},oK={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},aK={class:"text-3xl"},lK={class:"text-2xl font-bold text-white mb-2"},uK={class:"text-gray-300 mb-6"},cK={__name:"MagicLink",setup(n){const e=_o(),t=Ea(),r=S("loading"),s=S("Traitement en cours..."),i=S("Merci de patienter pendant la validation du lien."),o=He(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/seasons")}return Sn(async()=>{var l,d,h;try{oy("firebase");const f=String(e.query.sid||""),g=String(e.query.pid||"");let v=String(e.query.eid||"");const w=String(e.query.t||""),b=String(e.query.a||""),x=String(e.query.slug||"");if(!w||!b){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants.";return}if(b==="account_email_update"){const re=await ZA({token:w});if(!re.valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}try{await F4($e.currentUser,re.data.newEmail),await e1({token:w}),r.value="ok",s.value="Email mis à jour",i.value="Votre adresse email a été mise à jour avec succès."}catch{r.value="error",s.value="Action impossible",i.value="Veuillez vous reconnecter puis réessayer."}return}if(b==="verify_email"&&(v="protection"),!(await YA({seasonId:f,playerId:g,eventId:v,token:w,action:b})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}if(b==="verify_email"){await o1({playerId:g,seasonId:f});try{await d1({playerId:g,seasonId:f})}catch{}await Um({seasonId:f,playerId:g,eventId:"protection",action:b}),r.value="ok",s.value="Email vérifié",i.value="Merci ! Vous pouvez maintenant définir votre mot de passe.",setTimeout(x?()=>t.push(`/season/${x}?player=${encodeURIComponent(g)}&verified=1`):()=>t.push("/seasons"),800);return}if(b==="activate_notifications"){try{const{processNotificationActivation:re}=await dt(()=>Promise.resolve().then(()=>T1),void 0),k=await re(w);if(k.success)r.value="ok",s.value="Notifications activées !",(l=k.accountStatus)!=null&&l.created?i.value=`Parfait ! Tes notifications sont maintenant actives pour ${k.playerName}. Un compte a été créé avec ton email et tu recevras un email pour définir ton mot de passe.`:i.value=`Parfait ! Tes notifications sont maintenant actives pour ${k.playerName}. Tu recevras des alertes pour tes événements.`,i.value+=`

💡 Conseil : Pour une meilleure expérience, tu peux créer un mot de passe pour ton compte et te connecter directement à l'avenir.`,(d=k.accountStatus)!=null&&d.created?x&&v?t.push(`/season/${x}?event=${v}&modal=event_details&notificationSuccess=1&email=${encodeURIComponent(k.email)}&playerName=${encodeURIComponent(k.playerName)}&eventId=${v}`):x?t.push(`/season/${x}?notificationSuccess=1&email=${encodeURIComponent(k.email)}&playerName=${encodeURIComponent(k.playerName)}`):t.push("/seasons"):x&&v?t.push(`/season/${x}?event=${v}&modal=event_details`):x?t.push(`/season/${x}`):t.push("/seasons");else throw new Error("Échec de l'activation des notifications")}catch(re){L.error("Erreur lors de l'activation des notifications",re),r.value="error",s.value="Erreur d'activation",i.value="Impossible d'activer tes notifications. Veuillez réessayer."}return}const O=ye(ee,"seasons",f,"players",g),A=await Mt(O),j=A.exists()&&A.data().name||"";if(!j){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}if(await c5({seasonId:f,playerName:j,eventId:v,value:b==="yes"}),b==="no")try{const re=ye(ee,"seasons",f,"selections",v),k=await Mt(re);if(k.exists()){const I=Array.isArray((h=k.data())==null?void 0:h.players)?k.data().players:[],T=I.filter(V=>V!==j);T.length!==I.length&&await setDoc(re,{players:T},{merge:!0})}}catch{}await Um({seasonId:f,playerId:g,eventId:v,action:b}),r.value="ok",s.value="Merci !",i.value=b==="yes"?"Votre disponibilité a été enregistrée: Disponible.":"Votre disponibilité a été enregistrée: Non disponible. (Si vous étiez sélectionné(e), vous avez été retiré(e) de la sélection.)",setTimeout(x?()=>t.push(`/season/${x}/event/${v}`):()=>t.push("/seasons"),1200)}catch(f){L.error("Magic link error",f),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,d)=>(C(),N("div",iK,[c("div",oK,[c("div",{class:Qt(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[c("span",aK,oe(o.value),1)],2),c("h1",lK,oe(s.value),1),c("p",uK,oe(i.value),1),c("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},dK={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},hK={class:"text-center py-12 px-4"},fK={class:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},pK={class:"container mx-auto px-4 pb-16"},mK={class:"max-w-xl mx-auto bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl"},gK={class:"space-y-5"},vK=["onKeydown"],yK={class:"flex items-center justify-end gap-3 pt-2"},_K=["disabled"],bK={key:0,class:"mt-6 text-sm text-gray-200"},wK={__name:"JoinSeason",setup(n){const e=_o(),t=Ea(),r=e.params.slug,s=S(""),i=S(""),o=S(""),a=S(!1),l=S("");Sn(async()=>{const f=mo(Je(ee,"seasons"),Jr("slug","==",r)),g=await Dt(f);if(g.empty)l.value="Saison introuvable";else{const v=g.docs[0];s.value=v.id,i.value=v.data().name,document.title=`Rejoindre : ${i.value}`}});function d(){t.push(`/season/${r}`)}async function h(){if(!(!o.value.trim()||!s.value)){a.value=!0,l.value="";try{await _1(o.value.trim(),s.value),l.value="Inscription réussie. Vous pouvez maintenant indiquer vos disponibilités.";try{localStorage.setItem(`startPlayerTour:${s.value}`,"1"),localStorage.setItem(`dismissCreatorOnboarding:${s.value}`,"1")}catch{}setTimeout(()=>{d()},600)}catch(f){L.error("Erreur inscription",f),l.value=`Erreur lors de l'inscription: ${(f==null?void 0:f.message)||"Veuillez réessayer"}`}finally{a.value=!1}}}return(f,g)=>(C(),N("div",dK,[c("div",hK,[c("h1",fK,oe(i.value||"Rejoindre la saison"),1),g[1]||(g[1]=c("p",{class:"text-gray-300"},"Inscrivez-vous pour indiquer vos disponibilités aux événements",-1))]),c("div",pK,[c("div",mK,[g[3]||(g[3]=c("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Je rejoins la saison",-1)),c("div",gK,[c("div",null,[g[2]||(g[2]=c("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Votre nom",-1)),tt(c("input",{"onUpdate:modelValue":g[0]||(g[0]=v=>o.value=v),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: Marie Dupont",onKeydown:or(mt(h,["prevent"]),["enter"])},null,40,vK),[[Ut,o.value]])]),c("div",yK,[c("button",{onClick:d,class:"px-5 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),c("button",{disabled:!o.value.trim()||a.value,onClick:h,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Rejoindre ",8,_K)])]),l.value?(C(),N("div",bK,oe(l.value),1)):ae("",!0)])])]))}};{const n=()=>{};console.debug=n,console.log=n,console.info=n}const xK=[{path:"/",component:lF},{path:"/seasons",component:Sj},{path:"/season/:slug",component:Jb,props:!0},{path:"/season/:slug/event/:eventId",component:Jb,props:!0},{path:"/season/:slug/join",component:wK,props:!0},{path:"/reset-password",component:sK},{path:"/magic",component:cK}],EK=PC({history:rC("/"),routes:xK});let ll;window.addEventListener("beforeinstallprompt",n=>{n.preventDefault(),ll=n,console.log("Événement beforeinstallprompt capturé")});window.addEventListener("appinstalled",n=>{console.log("Application installée"),ll=null});window.triggerInstall=()=>{ll&&(ll.prompt(),ll.userChoice.then(n=>{n.outcome==="accepted"?console.log("Utilisateur a accepté l'installation"):console.log("Utilisateur a refusé l'installation"),ll=null}))};window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches&&console.log("Application déjà installée en mode standalone");const P1=IR(K$);P1.use(EK);P1.mount("#app");Q$({immediate:!0,onRegistered(n){window.__swReg=n}});export{Je as $,AT as A,_a as B,Ds as C,Rn as D,PG as E,Aa as F,dv as G,SG as H,PK as I,es as J,LV as K,FV as L,_i as M,tG as N,nG as O,uM as P,tr as Q,KK as R,NK as S,hn as T,_G as U,wf as V,oM as W,lM as X,eG as Y,LK as Z,gE as _,bc as a,Yc as a$,kK as a0,$V as a1,QV as a2,AG as a3,go as a4,yG as a5,UK as a6,TG as a7,ye as a8,zK as a9,qK as aA,lG as aB,uG as aC,HK as aD,GV as aE,pG as aF,mG as aG,sM as aH,mo as aI,hT as aJ,DK as aK,vG as aL,yn as aM,en as aN,xG as aO,IK as aP,rG as aQ,JK as aR,QK as aS,ZK as aT,jK as aU,To as aV,wG as aW,$K as aX,Jr as aY,xv as aZ,OG as a_,VK as aa,MK as ab,FK as ac,IG as ad,XK as ae,YK as af,fn as ag,Gc as ah,YV as ai,cG as aj,Mt as ak,sG as al,iG as am,Dt as an,oG as ao,aG as ap,OK as aq,EG as ar,bG as as,UV as at,GK as au,WK as av,BK as aw,dG as ax,fG as ay,hG as az,jV as b,mA as b$,Jc as b0,MG as b1,Ac as b2,Ca as b3,Qi as b4,CG as b5,Yi as b6,Ji as b7,hi as b8,rh as b9,LL as bA,nW as bB,mW as bC,Ib as bD,m3 as bE,s4 as bF,JG as bG,qG as bH,R4 as bI,oW as bJ,dW as bK,pW as bL,rW as bM,Q4 as bN,G4 as bO,$G as bP,AL as bQ,C4 as bR,aW as bS,cW as bT,fW as bU,UL as bV,eW as bW,KG as bX,D4 as bY,BG as bZ,K4 as b_,NG as ba,aa as bb,bl as bc,y$ as bd,kG as be,sW as bf,Om as bg,DG as bh,_$ as bi,Qv as bj,Xi as bk,jG as bl,W4 as bm,TA as bn,v$ as bo,SA as bp,O4 as bq,N4 as br,o4 as bs,M4 as bt,VG as bu,tW as bv,HG as bw,QG as bx,A$ as by,LG as bz,Fl as c,$v as c0,UG as c1,bA as c2,zG as c3,iW as c4,uW as c5,hW as c6,J4 as c7,FG as c8,ZG as c9,F4 as ca,U4 as cb,lW as cc,WG as cd,XG as ce,YG as cf,GG as cg,V4 as ch,Sa as d,Yt as e,ge as f,Zl as g,Hc as h,eh as i,Pf as j,Kc as k,Af as l,bv as m,Ul as n,Sf as o,ta as p,aM as q,vn as r,da as s,Pe as t,AK as u,CD as v,ln as w,RG as x,_t as y,TK as z};
