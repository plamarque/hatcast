(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Yp(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const Ct={},Da=[],$r=()=>{},DT=()=>!1,oh=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),Xp=n=>n.startsWith("onUpdate:"),Cn=Object.assign,Zp=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},NT=Object.prototype.hasOwnProperty,wt=(n,e)=>NT.call(n,e),qe=Array.isArray,Na=n=>nc(n)==="[object Map]",cl=n=>nc(n)==="[object Set]",xv=n=>nc(n)==="[object Date]",Qe=n=>typeof n=="function",pn=n=>typeof n=="string",us=n=>typeof n=="symbol",Mt=n=>n!==null&&typeof n=="object",A_=n=>(Mt(n)||Qe(n))&&Qe(n.then)&&Qe(n.catch),S_=Object.prototype.toString,nc=n=>S_.call(n),VT=n=>nc(n).slice(8,-1),P_=n=>nc(n)==="[object Object]",em=n=>pn(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,uu=Yp(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),ah=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},OT=/-(\w)/g,Rr=ah(n=>n.replace(OT,(e,t)=>t?t.toUpperCase():"")),MT=/\B([A-Z])/g,Ui=ah(n=>n.replace(MT,"-$1").toLowerCase()),lh=ah(n=>n.charAt(0).toUpperCase()+n.slice(1)),yf=ah(n=>n?`on${lh(n)}`:""),Ei=(n,e)=>!Object.is(n,e),id=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},ep=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},Ad=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let Iv;const uh=()=>Iv||(Iv=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function gr(n){if(qe(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=pn(r)?UT(r):gr(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(pn(n)||Mt(n))return n}const LT=/;(?![^(]*\))/g,$T=/:([^]+)/,FT=/\/\*[^]*?\*\//g;function UT(n){const e={};return n.replace(FT,"").split(LT).forEach(t=>{if(t){const r=t.split($T);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function Ot(n){let e="";if(pn(n))e=n;else if(qe(n))for(let t=0;t<n.length;t++){const r=Ot(n[t]);r&&(e+=r+" ")}else if(Mt(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const jT="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",qT=Yp(jT);function R_(n){return!!n||n===""}function BT(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=rc(n[r],e[r]);return t}function rc(n,e){if(n===e)return!0;let t=xv(n),r=xv(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=us(n),r=us(e),t||r)return n===e;if(t=qe(n),r=qe(e),t||r)return t&&r?BT(n,e):!1;if(t=Mt(n),r=Mt(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!rc(n[o],e[o]))return!1}}return String(n)===String(e)}function tm(n,e){return n.findIndex(t=>rc(t,e))}const C_=n=>!!(n&&n.__v_isRef===!0),le=n=>pn(n)?n:n==null?"":qe(n)||Mt(n)&&(n.toString===S_||!Qe(n.toString))?C_(n)?le(n.value):JSON.stringify(n,k_,2):String(n),k_=(n,e)=>C_(e)?k_(n,e.value):Na(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[_f(r,i)+" =>"]=s,t),{})}:cl(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>_f(t))}:us(e)?_f(e):Mt(e)&&!qe(e)&&!P_(e)?String(e):e,_f=(n,e="")=>{var t;return us(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let sr;class zT{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=sr,!e&&sr&&(this.index=(sr.scopes||(sr.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=sr;try{return sr=this,e()}finally{sr=t}}}on(){++this._on===1&&(this.prevScope=sr,sr=this)}off(){this._on>0&&--this._on===0&&(sr=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function KT(){return sr}let Nt;const bf=new WeakSet;class D_{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,sr&&sr.active&&sr.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,bf.has(this)&&(bf.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||V_(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Ev(this),O_(this);const e=Nt,t=Fr;Nt=this,Fr=!0;try{return this.fn()}finally{M_(this),Nt=e,Fr=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)sm(e);this.deps=this.depsTail=void 0,Ev(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?bf.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){tp(this)&&this.run()}get dirty(){return tp(this)}}let N_=0,cu,du;function V_(n,e=!1){if(n.flags|=8,e){n.next=du,du=n;return}n.next=cu,cu=n}function nm(){N_++}function rm(){if(--N_>0)return;if(du){let e=du;for(du=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;cu;){let e=cu;for(cu=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function O_(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function M_(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),sm(r),GT(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function tp(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(L_(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function L_(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===Su)||(n.globalVersion=Su,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!tp(n))))return;n.flags|=2;const e=n.dep,t=Nt,r=Fr;Nt=n,Fr=!0;try{O_(n);const s=n.fn(n._value);(e.version===0||Ei(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{Nt=t,Fr=r,M_(n),n.flags&=-3}}function sm(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)sm(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function GT(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let Fr=!0;const $_=[];function Os(){$_.push(Fr),Fr=!1}function Ms(){const n=$_.pop();Fr=n===void 0?!0:n}function Ev(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=Nt;Nt=void 0;try{e()}finally{Nt=t}}}let Su=0;class HT{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class im{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Nt||!Fr||Nt===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Nt)t=this.activeLink=new HT(Nt,this),Nt.deps?(t.prevDep=Nt.depsTail,Nt.depsTail.nextDep=t,Nt.depsTail=t):Nt.deps=Nt.depsTail=t,F_(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=Nt.depsTail,t.nextDep=void 0,Nt.depsTail.nextDep=t,Nt.depsTail=t,Nt.deps===t&&(Nt.deps=r)}return t}trigger(e){this.version++,Su++,this.notify(e)}notify(e){nm();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{rm()}}}function F_(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)F_(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const np=new WeakMap,Oo=Symbol(""),rp=Symbol(""),Pu=Symbol("");function Kn(n,e,t){if(Fr&&Nt){let r=np.get(n);r||np.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new im),s.map=r,s.key=t),s.track()}}function As(n,e,t,r,s,i){const o=np.get(n);if(!o){Su++;return}const a=l=>{l&&l.trigger()};if(nm(),e==="clear")o.forEach(a);else{const l=qe(n),c=l&&em(t);if(l&&t==="length"){const h=Number(r);o.forEach((f,g)=>{(g==="length"||g===Pu||!us(g)&&g>=h)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(Pu)),e){case"add":l?c&&a(o.get("length")):(a(o.get(Oo)),Na(n)&&a(o.get(rp)));break;case"delete":l||(a(o.get(Oo)),Na(n)&&a(o.get(rp)));break;case"set":Na(n)&&a(o.get(Oo));break}}rm()}function ba(n){const e=bt(n);return e===n?e:(Kn(e,"iterate",Pu),Sr(n)?e:e.map($n))}function ch(n){return Kn(n=bt(n),"iterate",Pu),n}const WT={__proto__:null,[Symbol.iterator](){return wf(this,Symbol.iterator,$n)},concat(...n){return ba(this).concat(...n.map(e=>qe(e)?ba(e):e))},entries(){return wf(this,"entries",n=>(n[1]=$n(n[1]),n))},every(n,e){return xs(this,"every",n,e,void 0,arguments)},filter(n,e){return xs(this,"filter",n,e,t=>t.map($n),arguments)},find(n,e){return xs(this,"find",n,e,$n,arguments)},findIndex(n,e){return xs(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return xs(this,"findLast",n,e,$n,arguments)},findLastIndex(n,e){return xs(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return xs(this,"forEach",n,e,void 0,arguments)},includes(...n){return xf(this,"includes",n)},indexOf(...n){return xf(this,"indexOf",n)},join(n){return ba(this).join(n)},lastIndexOf(...n){return xf(this,"lastIndexOf",n)},map(n,e){return xs(this,"map",n,e,void 0,arguments)},pop(){return zl(this,"pop")},push(...n){return zl(this,"push",n)},reduce(n,...e){return Tv(this,"reduce",n,e)},reduceRight(n,...e){return Tv(this,"reduceRight",n,e)},shift(){return zl(this,"shift")},some(n,e){return xs(this,"some",n,e,void 0,arguments)},splice(...n){return zl(this,"splice",n)},toReversed(){return ba(this).toReversed()},toSorted(n){return ba(this).toSorted(n)},toSpliced(...n){return ba(this).toSpliced(...n)},unshift(...n){return zl(this,"unshift",n)},values(){return wf(this,"values",$n)}};function wf(n,e,t){const r=ch(n),s=r[e]();return r!==n&&!Sr(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const QT=Array.prototype;function xs(n,e,t,r,s,i){const o=ch(n),a=o!==n&&!Sr(n),l=o[e];if(l!==QT[e]){const f=l.apply(n,i);return a?$n(f):f}let c=t;o!==n&&(a?c=function(f,g){return t.call(this,$n(f),g,n)}:t.length>2&&(c=function(f,g){return t.call(this,f,g,n)}));const h=l.call(o,c,r);return a&&s?s(h):h}function Tv(n,e,t,r){const s=ch(n);let i=t;return s!==n&&(Sr(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,$n(a),l,n)}),s[e](i,...r)}function xf(n,e,t){const r=bt(n);Kn(r,"iterate",Pu);const s=r[e](...t);return(s===-1||s===!1)&&lm(t[0])?(t[0]=bt(t[0]),r[e](...t)):s}function zl(n,e,t=[]){Os(),nm();const r=bt(n)[e].apply(n,t);return rm(),Ms(),r}const JT=Yp("__proto__,__v_isRef,__isVue"),U_=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(us));function YT(n){us(n)||(n=String(n));const e=bt(this);return Kn(e,"has",n),e.hasOwnProperty(n)}class j_{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?aA:K_:i?z_:B_).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=qe(e);if(!s){let l;if(o&&(l=WT[t]))return l;if(t==="hasOwnProperty")return YT}const a=Reflect.get(e,t,Hn(e)?e:r);return(us(t)?U_.has(t):JT(t))||(s||Kn(e,"get",t),i)?a:Hn(a)?o&&em(t)?a:a.value:Mt(a)?s?H_(a):dh(a):a}}class q_ extends j_{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=Ri(i);if(!Sr(r)&&!Ri(r)&&(i=bt(i),r=bt(r)),!qe(e)&&Hn(i)&&!Hn(r))return l?!1:(i.value=r,!0)}const o=qe(e)&&em(t)?Number(t)<e.length:wt(e,t),a=Reflect.set(e,t,r,Hn(e)?e:s);return e===bt(s)&&(o?Ei(r,i)&&As(e,"set",t,r):As(e,"add",t,r)),a}deleteProperty(e,t){const r=wt(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&As(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!us(t)||!U_.has(t))&&Kn(e,"has",t),r}ownKeys(e){return Kn(e,"iterate",qe(e)?"length":Oo),Reflect.ownKeys(e)}}class XT extends j_{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const ZT=new q_,eA=new XT,tA=new q_(!0);const sp=n=>n,Kc=n=>Reflect.getPrototypeOf(n);function nA(n,e,t){return function(...r){const s=this.__v_raw,i=bt(s),o=Na(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...r),h=t?sp:e?Sd:$n;return!e&&Kn(i,"iterate",l?rp:Oo),{next(){const{value:f,done:g}=c.next();return g?{value:f,done:g}:{value:a?[h(f[0]),h(f[1])]:h(f),done:g}},[Symbol.iterator](){return this}}}}function Gc(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function rA(n,e){const t={get(s){const i=this.__v_raw,o=bt(i),a=bt(s);n||(Ei(s,a)&&Kn(o,"get",s),Kn(o,"get",a));const{has:l}=Kc(o),c=e?sp:n?Sd:$n;if(l.call(o,s))return c(i.get(s));if(l.call(o,a))return c(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&Kn(bt(s),"iterate",Oo),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=bt(i),a=bt(s);return n||(Ei(s,a)&&Kn(o,"has",s),Kn(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=bt(a),c=e?sp:n?Sd:$n;return!n&&Kn(l,"iterate",Oo),a.forEach((h,f)=>s.call(i,c(h),c(f),o))}};return Cn(t,n?{add:Gc("add"),set:Gc("set"),delete:Gc("delete"),clear:Gc("clear")}:{add(s){!e&&!Sr(s)&&!Ri(s)&&(s=bt(s));const i=bt(this);return Kc(i).has.call(i,s)||(i.add(s),As(i,"add",s,s)),this},set(s,i){!e&&!Sr(i)&&!Ri(i)&&(i=bt(i));const o=bt(this),{has:a,get:l}=Kc(o);let c=a.call(o,s);c||(s=bt(s),c=a.call(o,s));const h=l.call(o,s);return o.set(s,i),c?Ei(i,h)&&As(o,"set",s,i):As(o,"add",s,i),this},delete(s){const i=bt(this),{has:o,get:a}=Kc(i);let l=o.call(i,s);l||(s=bt(s),l=o.call(i,s)),a&&a.call(i,s);const c=i.delete(s);return l&&As(i,"delete",s,void 0),c},clear(){const s=bt(this),i=s.size!==0,o=s.clear();return i&&As(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=nA(s,n,e)}),t}function om(n,e){const t=rA(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(wt(t,s)&&s in r?t:r,s,i)}const sA={get:om(!1,!1)},iA={get:om(!1,!0)},oA={get:om(!0,!1)};const B_=new WeakMap,z_=new WeakMap,K_=new WeakMap,aA=new WeakMap;function lA(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function uA(n){return n.__v_skip||!Object.isExtensible(n)?0:lA(VT(n))}function dh(n){return Ri(n)?n:am(n,!1,ZT,sA,B_)}function G_(n){return am(n,!1,tA,iA,z_)}function H_(n){return am(n,!0,eA,oA,K_)}function am(n,e,t,r,s){if(!Mt(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=uA(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function Va(n){return Ri(n)?Va(n.__v_raw):!!(n&&n.__v_isReactive)}function Ri(n){return!!(n&&n.__v_isReadonly)}function Sr(n){return!!(n&&n.__v_isShallow)}function lm(n){return n?!!n.__v_raw:!1}function bt(n){const e=n&&n.__v_raw;return e?bt(e):n}function cA(n){return!wt(n,"__v_skip")&&Object.isExtensible(n)&&ep(n,"__v_skip",!0),n}const $n=n=>Mt(n)?dh(n):n,Sd=n=>Mt(n)?H_(n):n;function Hn(n){return n?n.__v_isRef===!0:!1}function S(n){return W_(n,!1)}function dA(n){return W_(n,!0)}function W_(n,e){return Hn(n)?n:new hA(n,e)}class hA{constructor(e,t){this.dep=new im,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:bt(e),this._value=t?e:$n(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||Sr(e)||Ri(e);e=r?e:bt(e),Ei(e,t)&&(this._rawValue=e,this._value=r?e:$n(e),this.dep.trigger())}}function is(n){return Hn(n)?n.value:n}const fA={get:(n,e,t)=>e==="__v_raw"?n:is(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return Hn(s)&&!Hn(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function Q_(n){return Va(n)?n:new Proxy(n,fA)}class pA{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new im(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Su-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&Nt!==this)return V_(this,!0),!0}get value(){const e=this.dep.track();return L_(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function mA(n,e,t=!1){let r,s;return Qe(n)?r=n:(r=n.get,s=n.set),new pA(r,s,t)}const Hc={},Pd=new WeakMap;let xo;function gA(n,e=!1,t=xo){if(t){let r=Pd.get(t);r||Pd.set(t,r=[]),r.push(n)}}function vA(n,e,t=Ct){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,c=z=>s?z:Sr(z)||s===!1||s===0?Ss(z,1):Ss(z);let h,f,g,y,I=!1,A=!1;if(Hn(n)?(f=()=>n.value,I=Sr(n)):Va(n)?(f=()=>c(n),I=!0):qe(n)?(A=!0,I=n.some(z=>Va(z)||Sr(z)),f=()=>n.map(z=>{if(Hn(z))return z.value;if(Va(z))return c(z);if(Qe(z))return l?l(z,2):z()})):Qe(n)?e?f=l?()=>l(n,2):n:f=()=>{if(g){Os();try{g()}finally{Ms()}}const z=xo;xo=h;try{return l?l(n,3,[y]):n(y)}finally{xo=z}}:f=$r,e&&s){const z=f,he=s===!0?1/0:s;f=()=>Ss(z(),he)}const P=KT(),j=()=>{h.stop(),P&&P.active&&Zp(P.effects,h)};if(i&&e){const z=e;e=(...he)=>{z(...he),j()}}let B=A?new Array(n.length).fill(Hc):Hc;const $=z=>{if(!(!(h.flags&1)||!h.dirty&&!z))if(e){const he=h.run();if(s||I||(A?he.some((ve,T)=>Ei(ve,B[T])):Ei(he,B))){g&&g();const ve=xo;xo=h;try{const T=[he,B===Hc?void 0:A&&B[0]===Hc?[]:B,y];B=he,l?l(e,3,T):e(...T)}finally{xo=ve}}}else h.run()};return a&&a($),h=new D_(f),h.scheduler=o?()=>o($,!1):$,y=z=>gA(z,!1,h),g=h.onStop=()=>{const z=Pd.get(h);if(z){if(l)l(z,4);else for(const he of z)he();Pd.delete(h)}},e?r?$(!0):B=h.run():o?o($.bind(null,!0),!0):h.run(),j.pause=h.pause.bind(h),j.resume=h.resume.bind(h),j.stop=j,j}function Ss(n,e=1/0,t){if(e<=0||!Mt(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,Hn(n))Ss(n.value,e,t);else if(qe(n))for(let r=0;r<n.length;r++)Ss(n[r],e,t);else if(cl(n)||Na(n))n.forEach(r=>{Ss(r,e,t)});else if(P_(n)){for(const r in n)Ss(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&Ss(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function sc(n,e,t,r){try{return r?n(...r):n()}catch(s){hh(s,e,t)}}function cs(n,e,t,r){if(Qe(n)){const s=sc(n,e,t,r);return s&&A_(s)&&s.catch(i=>{hh(i,e,t)}),s}if(qe(n)){const s=[];for(let i=0;i<n.length;i++)s.push(cs(n[i],e,t,r));return s}}function hh(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||Ct;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const h=a.ec;if(h){for(let f=0;f<h.length;f++)if(h[f](n,l,c)===!1)return}a=a.parent}if(i){Os(),sc(i,null,10,[n,l,c]),Ms();return}}yA(n,t,s,r,o)}function yA(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const er=[];let es=-1;const Oa=[];let di=null,Ta=0;const J_=Promise.resolve();let Rd=null;function Bt(n){const e=Rd||J_;return n?e.then(this?n.bind(this):n):e}function _A(n){let e=es+1,t=er.length;for(;e<t;){const r=e+t>>>1,s=er[r],i=Ru(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function um(n){if(!(n.flags&1)){const e=Ru(n),t=er[er.length-1];!t||!(n.flags&2)&&e>=Ru(t)?er.push(n):er.splice(_A(e),0,n),n.flags|=1,Y_()}}function Y_(){Rd||(Rd=J_.then(Z_))}function bA(n){qe(n)?Oa.push(...n):di&&n.id===-1?di.splice(Ta+1,0,n):n.flags&1||(Oa.push(n),n.flags|=1),Y_()}function Av(n,e,t=es+1){for(;t<er.length;t++){const r=er[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;er.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function X_(n){if(Oa.length){const e=[...new Set(Oa)].sort((t,r)=>Ru(t)-Ru(r));if(Oa.length=0,di){di.push(...e);return}for(di=e,Ta=0;Ta<di.length;Ta++){const t=di[Ta];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}di=null,Ta=0}}const Ru=n=>n.id==null?n.flags&2?-1:1/0:n.id;function Z_(n){const e=$r;try{for(es=0;es<er.length;es++){const t=er[es];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),sc(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;es<er.length;es++){const t=er[es];t&&(t.flags&=-2)}es=-1,er.length=0,X_(),Rd=null,(er.length||Oa.length)&&Z_()}}let vr=null,eb=null;function Cd(n){const e=vr;return vr=n,eb=n&&n.type.__scopeId||null,e}function wA(n,e=vr,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&$v(-1);const i=Cd(e);let o;try{o=n(...s)}finally{Cd(i),r._d&&$v(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function tt(n,e){if(vr===null)return n;const t=gh(vr),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=Ct]=e[s];i&&(Qe(i)&&(i={mounted:i,updated:i}),i.deep&&Ss(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function _o(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(Os(),cs(l,t,8,[n.el,a,n,e]),Ms())}}const tb=Symbol("_vte"),xA=n=>n.__isTeleport,hu=n=>n&&(n.disabled||n.disabled===""),Sv=n=>n&&(n.defer||n.defer===""),Pv=n=>typeof SVGElement<"u"&&n instanceof SVGElement,Rv=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,ip=(n,e)=>{const t=n&&n.to;return pn(t)?e?e(t):null:t},nb={name:"Teleport",__isTeleport:!0,process(n,e,t,r,s,i,o,a,l,c){const{mc:h,pc:f,pbc:g,o:{insert:y,querySelector:I,createText:A,createComment:P}}=c,j=hu(e.props);let{shapeFlag:B,children:$,dynamicChildren:z}=e;if(n==null){const he=e.el=A(""),ve=e.anchor=A("");y(he,t,r),y(ve,t,r);const T=(E,D)=>{B&16&&(s&&s.isCE&&(s.ce._teleportTarget=E),h($,E,D,s,i,o,a,l))},w=()=>{const E=e.target=ip(e.props,I),D=rb(E,e,A,y);E&&(o!=="svg"&&Pv(E)?o="svg":o!=="mathml"&&Rv(E)&&(o="mathml"),j||(T(E,D),od(e,!1)))};j&&(T(t,ve),od(e,!0)),Sv(e.props)?(e.el.__isMounted=!1,Zn(()=>{w(),delete e.el.__isMounted},i)):w()}else{if(Sv(e.props)&&n.el.__isMounted===!1){Zn(()=>{nb.process(n,e,t,r,s,i,o,a,l,c)},i);return}e.el=n.el,e.targetStart=n.targetStart;const he=e.anchor=n.anchor,ve=e.target=n.target,T=e.targetAnchor=n.targetAnchor,w=hu(n.props),E=w?t:ve,D=w?he:T;if(o==="svg"||Pv(ve)?o="svg":(o==="mathml"||Rv(ve))&&(o="mathml"),z?(g(n.dynamicChildren,z,E,s,i,o,a),pm(n,e,!0)):l||f(n,e,E,D,s,i,o,a,!1),j)w?e.props&&n.props&&e.props.to!==n.props.to&&(e.props.to=n.props.to):Wc(e,t,he,c,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const L=e.target=ip(e.props,I);L&&Wc(e,L,null,c,0)}else w&&Wc(e,ve,T,c,1);od(e,j)}},remove(n,e,t,{um:r,o:{remove:s}},i){const{shapeFlag:o,children:a,anchor:l,targetStart:c,targetAnchor:h,target:f,props:g}=n;if(f&&(s(c),s(h)),i&&s(l),o&16){const y=i||!hu(g);for(let I=0;I<a.length;I++){const A=a[I];r(A,e,t,y,!!A.dynamicChildren)}}},move:Wc,hydrate:IA};function Wc(n,e,t,{o:{insert:r},m:s},i=2){i===0&&r(n.targetAnchor,e,t);const{el:o,anchor:a,shapeFlag:l,children:c,props:h}=n,f=i===2;if(f&&r(o,e,t),(!f||hu(h))&&l&16)for(let g=0;g<c.length;g++)s(c[g],e,t,2);f&&r(a,e,t)}function IA(n,e,t,r,s,i,{o:{nextSibling:o,parentNode:a,querySelector:l,insert:c,createText:h}},f){const g=e.target=ip(e.props,l);if(g){const y=hu(e.props),I=g._lpa||g.firstChild;if(e.shapeFlag&16)if(y)e.anchor=f(o(n),e,a(n),t,r,s,i),e.targetStart=I,e.targetAnchor=I&&o(I);else{e.anchor=o(n);let A=I;for(;A;){if(A&&A.nodeType===8){if(A.data==="teleport start anchor")e.targetStart=A;else if(A.data==="teleport anchor"){e.targetAnchor=A,g._lpa=e.targetAnchor&&o(e.targetAnchor);break}}A=o(A)}e.targetAnchor||rb(g,e,h,c),f(I&&o(I),e,g,t,r,s,i)}od(e,y)}return e.anchor&&o(e.anchor)}const fu=nb;function od(n,e){const t=n.ctx;if(t&&t.ut){let r,s;for(e?(r=n.el,s=n.anchor):(r=n.targetStart,s=n.targetAnchor);r&&r!==s;)r.nodeType===1&&r.setAttribute("data-v-owner",t.uid),r=r.nextSibling;t.ut()}}function rb(n,e,t,r){const s=e.targetStart=t(""),i=e.targetAnchor=t("");return s[tb]=i,n&&(r(s,n),r(i,n)),i}function cm(n,e){n.shapeFlag&6&&n.component?(n.transition=e,cm(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}/*! #__NO_SIDE_EFFECTS__ */function sb(n,e){return Qe(n)?(()=>Cn({name:n.name},e,{setup:n}))():n}function ib(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function pu(n,e,t,r,s=!1){if(qe(n)){n.forEach((I,A)=>pu(I,e&&(qe(e)?e[A]:e),t,r,s));return}if(mu(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&pu(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?gh(r.component):r.el,o=s?null:i,{i:a,r:l}=n,c=e&&e.r,h=a.refs===Ct?a.refs={}:a.refs,f=a.setupState,g=bt(f),y=f===Ct?()=>!1:I=>wt(g,I);if(c!=null&&c!==l&&(pn(c)?(h[c]=null,y(c)&&(f[c]=null)):Hn(c)&&(c.value=null)),Qe(l))sc(l,a,12,[o,h]);else{const I=pn(l),A=Hn(l);if(I||A){const P=()=>{if(n.f){const j=I?y(l)?f[l]:h[l]:l.value;s?qe(j)&&Zp(j,i):qe(j)?j.includes(i)||j.push(i):I?(h[l]=[i],y(l)&&(f[l]=h[l])):(l.value=[i],n.k&&(h[n.k]=l.value))}else I?(h[l]=o,y(l)&&(f[l]=o)):A&&(l.value=o,n.k&&(h[n.k]=o))};o?(P.id=-1,Zn(P,t)):P()}}}uh().requestIdleCallback;uh().cancelIdleCallback;const mu=n=>!!n.type.__asyncLoader,ob=n=>n.type.__isKeepAlive;function EA(n,e){ab(n,"a",e)}function TA(n,e){ab(n,"da",e)}function ab(n,e,t=Gn){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(fh(e,r,t),t){let s=t.parent;for(;s&&s.parent;)ob(s.parent.vnode)&&AA(r,e,t,s),s=s.parent}}function AA(n,e,t,r){const s=fh(e,n,r,!0);ka(()=>{Zp(r[e],s)},t)}function fh(n,e,t=Gn,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{Os();const a=ic(t),l=cs(e,t,n,o);return a(),Ms(),l});return r?s.unshift(i):s.push(i),i}}const Bs=n=>(e,t=Gn)=>{(!ku||n==="sp")&&fh(n,(...r)=>e(...r),t)},SA=Bs("bm"),Un=Bs("m"),PA=Bs("bu"),RA=Bs("u"),lb=Bs("bum"),ka=Bs("um"),CA=Bs("sp"),kA=Bs("rtg"),DA=Bs("rtc");function NA(n,e=Gn){fh("ec",n,e)}const ub="components";function VA(n,e){return MA(ub,n,!0,e)||n}const OA=Symbol.for("v-ndc");function MA(n,e,t=!0,r=!1){const s=vr||Gn;if(s){const i=s.type;if(n===ub){const a=x1(i,!1);if(a&&(a===e||a===Rr(e)||a===lh(Rr(e))))return i}const o=Cv(s[n]||i[n],e)||Cv(s.appContext[n],e);return!o&&r?i:o}}function Cv(n,e){return n&&(n[e]||n[Rr(e)]||n[lh(Rr(e))])}function Ar(n,e,t,r){let s;const i=t&&t[r],o=qe(n);if(o||pn(n)){const a=o&&Va(n);let l=!1,c=!1;a&&(l=!Sr(n),c=Ri(n),n=ch(n)),s=new Array(n.length);for(let h=0,f=n.length;h<f;h++)s[h]=e(l?c?Sd($n(n[h])):$n(n[h]):n[h],h,void 0,i&&i[h])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(Mt(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const h=a[l];s[l]=e(n[h],h,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}const op=n=>n?Sb(n)?gh(n):op(n.parent):null,gu=Cn(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>op(n.parent),$root:n=>op(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>dm(n),$forceUpdate:n=>n.f||(n.f=()=>{um(n.update)}),$nextTick:n=>n.n||(n.n=Bt.bind(n.proxy)),$watch:n=>r1.bind(n)}),If=(n,e)=>n!==Ct&&!n.__isScriptSetup&&wt(n,e),LA={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const y=o[e];if(y!==void 0)switch(y){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(If(r,e))return o[e]=1,r[e];if(s!==Ct&&wt(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&wt(c,e))return o[e]=3,i[e];if(t!==Ct&&wt(t,e))return o[e]=4,t[e];ap&&(o[e]=0)}}const h=gu[e];let f,g;if(h)return e==="$attrs"&&Kn(n.attrs,"get",""),h(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==Ct&&wt(t,e))return o[e]=4,t[e];if(g=l.config.globalProperties,wt(g,e))return g[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return If(s,e)?(s[e]=t,!0):r!==Ct&&wt(r,e)?(r[e]=t,!0):wt(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==Ct&&wt(n,o)||If(e,o)||(a=i[0])&&wt(a,o)||wt(r,o)||wt(gu,o)||wt(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:wt(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function kv(n){return qe(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let ap=!0;function $A(n){const e=dm(n),t=n.proxy,r=n.ctx;ap=!1,e.beforeCreate&&Dv(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:c,created:h,beforeMount:f,mounted:g,beforeUpdate:y,updated:I,activated:A,deactivated:P,beforeDestroy:j,beforeUnmount:B,destroyed:$,unmounted:z,render:he,renderTracked:ve,renderTriggered:T,errorCaptured:w,serverPrefetch:E,expose:D,inheritAttrs:L,components:q,directives:R,filters:ft}=e;if(c&&FA(c,r,null),o)for(const F in o){const W=o[F];Qe(W)&&(r[F]=W.bind(t))}if(s){const F=s.call(t,t);Mt(F)&&(n.data=dh(F))}if(ap=!0,i)for(const F in i){const W=i[F],se=Qe(W)?W.bind(t,t):Qe(W.get)?W.get.bind(t,t):$r,Pe=!Qe(W)&&Qe(W.set)?W.set.bind(t):$r,te=je({get:se,set:Pe});Object.defineProperty(r,F,{enumerable:!0,configurable:!0,get:()=>te.value,set:J=>te.value=J})}if(a)for(const F in a)cb(a[F],r,t,F);if(l){const F=Qe(l)?l.call(t):l;Reflect.ownKeys(F).forEach(W=>{ad(W,F[W])})}h&&Dv(h,n,"c");function ne(F,W){qe(W)?W.forEach(se=>F(se.bind(t))):W&&F(W.bind(t))}if(ne(SA,f),ne(Un,g),ne(PA,y),ne(RA,I),ne(EA,A),ne(TA,P),ne(NA,w),ne(DA,ve),ne(kA,T),ne(lb,B),ne(ka,z),ne(CA,E),qe(D))if(D.length){const F=n.exposed||(n.exposed={});D.forEach(W=>{Object.defineProperty(F,W,{get:()=>t[W],set:se=>t[W]=se})})}else n.exposed||(n.exposed={});he&&n.render===$r&&(n.render=he),L!=null&&(n.inheritAttrs=L),q&&(n.components=q),R&&(n.directives=R),E&&ib(n)}function FA(n,e,t=$r){qe(n)&&(n=lp(n));for(const r in n){const s=n[r];let i;Mt(s)?"default"in s?i=Ur(s.from||r,s.default,!0):i=Ur(s.from||r):i=Ur(s),Hn(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function Dv(n,e,t){cs(qe(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function cb(n,e,t,r){let s=r.includes(".")?xb(t,r):()=>t[r];if(pn(n)){const i=e[n];Qe(i)&&St(s,i)}else if(Qe(n))St(s,n.bind(t));else if(Mt(n))if(qe(n))n.forEach(i=>cb(i,e,t,r));else{const i=Qe(n.handler)?n.handler.bind(t):e[n.handler];Qe(i)&&St(s,i,n)}}function dm(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(c=>kd(l,c,o,!0)),kd(l,e,o)),Mt(e)&&i.set(e,l),l}function kd(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&kd(n,i,t,!0),s&&s.forEach(o=>kd(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=UA[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const UA={data:Nv,props:Vv,emits:Vv,methods:tu,computed:tu,beforeCreate:Xn,created:Xn,beforeMount:Xn,mounted:Xn,beforeUpdate:Xn,updated:Xn,beforeDestroy:Xn,beforeUnmount:Xn,destroyed:Xn,unmounted:Xn,activated:Xn,deactivated:Xn,errorCaptured:Xn,serverPrefetch:Xn,components:tu,directives:tu,watch:qA,provide:Nv,inject:jA};function Nv(n,e){return e?n?function(){return Cn(Qe(n)?n.call(this,this):n,Qe(e)?e.call(this,this):e)}:e:n}function jA(n,e){return tu(lp(n),lp(e))}function lp(n){if(qe(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function Xn(n,e){return n?[...new Set([].concat(n,e))]:e}function tu(n,e){return n?Cn(Object.create(null),n,e):e}function Vv(n,e){return n?qe(n)&&qe(e)?[...new Set([...n,...e])]:Cn(Object.create(null),kv(n),kv(e??{})):e}function qA(n,e){if(!n)return e;if(!e)return n;const t=Cn(Object.create(null),n);for(const r in e)t[r]=Xn(n[r],e[r]);return t}function db(){return{app:null,config:{isNativeTag:DT,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let BA=0;function zA(n,e){return function(r,s=null){Qe(r)||(r=Cn({},r)),s!=null&&!Mt(s)&&(s=null);const i=db(),o=new WeakSet,a=[];let l=!1;const c=i.app={_uid:BA++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:E1,get config(){return i.config},set config(h){},use(h,...f){return o.has(h)||(h&&Qe(h.install)?(o.add(h),h.install(c,...f)):Qe(h)&&(o.add(h),h(c,...f))),c},mixin(h){return i.mixins.includes(h)||i.mixins.push(h),c},component(h,f){return f?(i.components[h]=f,c):i.components[h]},directive(h,f){return f?(i.directives[h]=f,c):i.directives[h]},mount(h,f,g){if(!l){const y=c._ceVNode||nt(r,s);return y.appContext=i,g===!0?g="svg":g===!1&&(g=void 0),f&&e?e(y,h):n(y,h,g),l=!0,c._container=h,h.__vue_app__=c,gh(y.component)}},onUnmount(h){a.push(h)},unmount(){l&&(cs(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(h,f){return i.provides[h]=f,c},runWithContext(h){const f=Ma;Ma=c;try{return h()}finally{Ma=f}}};return c}}let Ma=null;function ad(n,e){if(Gn){let t=Gn.provides;const r=Gn.parent&&Gn.parent.provides;r===t&&(t=Gn.provides=Object.create(r)),t[n]=e}}function Ur(n,e,t=!1){const r=Gn||vr;if(r||Ma){let s=Ma?Ma._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&Qe(e)?e.call(r&&r.proxy):e}}const hb={},fb=()=>Object.create(hb),pb=n=>Object.getPrototypeOf(n)===hb;function KA(n,e,t,r=!1){const s={},i=fb();n.propsDefaults=Object.create(null),mb(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:G_(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function GA(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=bt(s),[l]=n.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const h=n.vnode.dynamicProps;for(let f=0;f<h.length;f++){let g=h[f];if(ph(n.emitsOptions,g))continue;const y=e[g];if(l)if(wt(i,g))y!==i[g]&&(i[g]=y,c=!0);else{const I=Rr(g);s[I]=up(l,a,I,y,n,!1)}else y!==i[g]&&(i[g]=y,c=!0)}}}else{mb(n,e,s,i)&&(c=!0);let h;for(const f in a)(!e||!wt(e,f)&&((h=Ui(f))===f||!wt(e,h)))&&(l?t&&(t[f]!==void 0||t[h]!==void 0)&&(s[f]=up(l,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!wt(e,f))&&(delete i[f],c=!0)}c&&As(n.attrs,"set","")}function mb(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(uu(l))continue;const c=e[l];let h;s&&wt(s,h=Rr(l))?!i||!i.includes(h)?t[h]=c:(a||(a={}))[h]=c:ph(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(i){const l=bt(t),c=a||Ct;for(let h=0;h<i.length;h++){const f=i[h];t[f]=up(s,l,f,c[f],n,!wt(c,f))}}return o}function up(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=wt(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&Qe(l)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const h=ic(s);r=c[t]=l.call(null,e),h()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===Ui(t))&&(r=!0))}return r}const HA=new WeakMap;function gb(n,e,t=!1){const r=t?HA:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!Qe(n)){const h=f=>{l=!0;const[g,y]=gb(f,e,!0);Cn(o,g),y&&a.push(...y)};!t&&e.mixins.length&&e.mixins.forEach(h),n.extends&&h(n.extends),n.mixins&&n.mixins.forEach(h)}if(!i&&!l)return Mt(n)&&r.set(n,Da),Da;if(qe(i))for(let h=0;h<i.length;h++){const f=Rr(i[h]);Ov(f)&&(o[f]=Ct)}else if(i)for(const h in i){const f=Rr(h);if(Ov(f)){const g=i[h],y=o[f]=qe(g)||Qe(g)?{type:g}:Cn({},g),I=y.type;let A=!1,P=!0;if(qe(I))for(let j=0;j<I.length;++j){const B=I[j],$=Qe(B)&&B.name;if($==="Boolean"){A=!0;break}else $==="String"&&(P=!1)}else A=Qe(I)&&I.name==="Boolean";y[0]=A,y[1]=P,(A||wt(y,"default"))&&a.push(f)}}const c=[o,a];return Mt(n)&&r.set(n,c),c}function Ov(n){return n[0]!=="$"&&!uu(n)}const hm=n=>n[0]==="_"||n==="$stable",fm=n=>qe(n)?n.map(ts):[ts(n)],WA=(n,e,t)=>{if(e._n)return e;const r=wA((...s)=>fm(e(...s)),t);return r._c=!1,r},vb=(n,e,t)=>{const r=n._ctx;for(const s in n){if(hm(s))continue;const i=n[s];if(Qe(i))e[s]=WA(s,i,r);else if(i!=null){const o=fm(i);e[s]=()=>o}}},yb=(n,e)=>{const t=fm(e);n.slots.default=()=>t},_b=(n,e,t)=>{for(const r in e)(t||!hm(r))&&(n[r]=e[r])},QA=(n,e,t)=>{const r=n.slots=fb();if(n.vnode.shapeFlag&32){const s=e.__;s&&ep(r,"__",s,!0);const i=e._;i?(_b(r,e,t),t&&ep(r,"_",i,!0)):vb(e,r)}else e&&yb(n,e)},JA=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=Ct;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:_b(s,e,t):(i=!e.$stable,vb(e,s)),o=e}else e&&(yb(n,e),o={default:1});if(i)for(const a in s)!hm(a)&&o[a]==null&&delete s[a]},Zn=c1;function YA(n){return XA(n)}function XA(n,e){const t=uh();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:c,setElementText:h,parentNode:f,nextSibling:g,setScopeId:y=$r,insertStaticContent:I}=n,A=(x,C,M,ue=null,re=null,ae=null,be=void 0,U=null,O=!!C.dynamicChildren)=>{if(x===C)return;x&&!Kl(x,C)&&(ue=Z(x),J(x,re,ae,!0),x=null),C.patchFlag===-2&&(O=!1,C.dynamicChildren=null);const{type:Q,ref:ce,shapeFlag:fe}=C;switch(Q){case mh:P(x,C,M,ue);break;case Ci:j(x,C,M,ue);break;case ld:x==null&&B(C,M,ue,be);break;case ct:q(x,C,M,ue,re,ae,be,U,O);break;default:fe&1?he(x,C,M,ue,re,ae,be,U,O):fe&6?R(x,C,M,ue,re,ae,be,U,O):(fe&64||fe&128)&&Q.process(x,C,M,ue,re,ae,be,U,O,De)}ce!=null&&re?pu(ce,x&&x.ref,ae,C||x,!C):ce==null&&x&&x.ref!=null&&pu(x.ref,null,ae,x,!0)},P=(x,C,M,ue)=>{if(x==null)r(C.el=a(C.children),M,ue);else{const re=C.el=x.el;C.children!==x.children&&c(re,C.children)}},j=(x,C,M,ue)=>{x==null?r(C.el=l(C.children||""),M,ue):C.el=x.el},B=(x,C,M,ue)=>{[x.el,x.anchor]=I(x.children,C,M,ue,x.el,x.anchor)},$=({el:x,anchor:C},M,ue)=>{let re;for(;x&&x!==C;)re=g(x),r(x,M,ue),x=re;r(C,M,ue)},z=({el:x,anchor:C})=>{let M;for(;x&&x!==C;)M=g(x),s(x),x=M;s(C)},he=(x,C,M,ue,re,ae,be,U,O)=>{C.type==="svg"?be="svg":C.type==="math"&&(be="mathml"),x==null?ve(C,M,ue,re,ae,be,U,O):E(x,C,re,ae,be,U,O)},ve=(x,C,M,ue,re,ae,be,U)=>{let O,Q;const{props:ce,shapeFlag:fe,transition:xe,dirs:Oe}=x;if(O=x.el=o(x.type,ae,ce&&ce.is,ce),fe&8?h(O,x.children):fe&16&&w(x.children,O,null,ue,re,Ef(x,ae),be,U),Oe&&_o(x,null,ue,"created"),T(O,x,x.scopeId,be,ue),ce){for(const Be in ce)Be!=="value"&&!uu(Be)&&i(O,Be,null,ce[Be],ae,ue);"value"in ce&&i(O,"value",null,ce.value,ae),(Q=ce.onVnodeBeforeMount)&&Zr(Q,ue,x)}Oe&&_o(x,null,ue,"beforeMount");const ke=ZA(re,xe);ke&&xe.beforeEnter(O),r(O,C,M),((Q=ce&&ce.onVnodeMounted)||ke||Oe)&&Zn(()=>{Q&&Zr(Q,ue,x),ke&&xe.enter(O),Oe&&_o(x,null,ue,"mounted")},re)},T=(x,C,M,ue,re)=>{if(M&&y(x,M),ue)for(let ae=0;ae<ue.length;ae++)y(x,ue[ae]);if(re){let ae=re.subTree;if(C===ae||Eb(ae.type)&&(ae.ssContent===C||ae.ssFallback===C)){const be=re.vnode;T(x,be,be.scopeId,be.slotScopeIds,re.parent)}}},w=(x,C,M,ue,re,ae,be,U,O=0)=>{for(let Q=O;Q<x.length;Q++){const ce=x[Q]=U?hi(x[Q]):ts(x[Q]);A(null,ce,C,M,ue,re,ae,be,U)}},E=(x,C,M,ue,re,ae,be)=>{const U=C.el=x.el;let{patchFlag:O,dynamicChildren:Q,dirs:ce}=C;O|=x.patchFlag&16;const fe=x.props||Ct,xe=C.props||Ct;let Oe;if(M&&bo(M,!1),(Oe=xe.onVnodeBeforeUpdate)&&Zr(Oe,M,C,x),ce&&_o(C,x,M,"beforeUpdate"),M&&bo(M,!0),(fe.innerHTML&&xe.innerHTML==null||fe.textContent&&xe.textContent==null)&&h(U,""),Q?D(x.dynamicChildren,Q,U,M,ue,Ef(C,re),ae):be||W(x,C,U,null,M,ue,Ef(C,re),ae,!1),O>0){if(O&16)L(U,fe,xe,M,re);else if(O&2&&fe.class!==xe.class&&i(U,"class",null,xe.class,re),O&4&&i(U,"style",fe.style,xe.style,re),O&8){const ke=C.dynamicProps;for(let Be=0;Be<ke.length;Be++){const et=ke[Be],on=fe[et],jt=xe[et];(jt!==on||et==="value")&&i(U,et,on,jt,re,M)}}O&1&&x.children!==C.children&&h(U,C.children)}else!be&&Q==null&&L(U,fe,xe,M,re);((Oe=xe.onVnodeUpdated)||ce)&&Zn(()=>{Oe&&Zr(Oe,M,C,x),ce&&_o(C,x,M,"updated")},ue)},D=(x,C,M,ue,re,ae,be)=>{for(let U=0;U<C.length;U++){const O=x[U],Q=C[U],ce=O.el&&(O.type===ct||!Kl(O,Q)||O.shapeFlag&198)?f(O.el):M;A(O,Q,ce,null,ue,re,ae,be,!0)}},L=(x,C,M,ue,re)=>{if(C!==M){if(C!==Ct)for(const ae in C)!uu(ae)&&!(ae in M)&&i(x,ae,C[ae],null,re,ue);for(const ae in M){if(uu(ae))continue;const be=M[ae],U=C[ae];be!==U&&ae!=="value"&&i(x,ae,U,be,re,ue)}"value"in M&&i(x,"value",C.value,M.value,re)}},q=(x,C,M,ue,re,ae,be,U,O)=>{const Q=C.el=x?x.el:a(""),ce=C.anchor=x?x.anchor:a("");let{patchFlag:fe,dynamicChildren:xe,slotScopeIds:Oe}=C;Oe&&(U=U?U.concat(Oe):Oe),x==null?(r(Q,M,ue),r(ce,M,ue),w(C.children||[],M,ce,re,ae,be,U,O)):fe>0&&fe&64&&xe&&x.dynamicChildren?(D(x.dynamicChildren,xe,M,re,ae,be,U),(C.key!=null||re&&C===re.subTree)&&pm(x,C,!0)):W(x,C,M,ce,re,ae,be,U,O)},R=(x,C,M,ue,re,ae,be,U,O)=>{C.slotScopeIds=U,x==null?C.shapeFlag&512?re.ctx.activate(C,M,ue,be,O):ft(C,M,ue,re,ae,be,O):Ze(x,C,O)},ft=(x,C,M,ue,re,ae,be)=>{const U=x.component=v1(x,ue,re);if(ob(x)&&(U.ctx.renderer=De),y1(U,!1,be),U.asyncDep){if(re&&re.registerDep(U,ne,be),!x.el){const O=U.subTree=nt(Ci);j(null,O,C,M)}}else ne(U,x,C,M,re,ae,be)},Ze=(x,C,M)=>{const ue=C.component=x.component;if(l1(x,C,M))if(ue.asyncDep&&!ue.asyncResolved){F(ue,C,M);return}else ue.next=C,ue.update();else C.el=x.el,ue.vnode=C},ne=(x,C,M,ue,re,ae,be)=>{const U=()=>{if(x.isMounted){let{next:fe,bu:xe,u:Oe,parent:ke,vnode:Be}=x;{const Rt=bb(x);if(Rt){fe&&(fe.el=Be.el,F(x,fe,be)),Rt.asyncDep.then(()=>{x.isUnmounted||U()});return}}let et=fe,on;bo(x,!1),fe?(fe.el=Be.el,F(x,fe,be)):fe=Be,xe&&id(xe),(on=fe.props&&fe.props.onVnodeBeforeUpdate)&&Zr(on,ke,fe,Be),bo(x,!0);const jt=Tf(x),qt=x.subTree;x.subTree=jt,A(qt,jt,f(qt.el),Z(qt),x,re,ae),fe.el=jt.el,et===null&&u1(x,jt.el),Oe&&Zn(Oe,re),(on=fe.props&&fe.props.onVnodeUpdated)&&Zn(()=>Zr(on,ke,fe,Be),re)}else{let fe;const{el:xe,props:Oe}=C,{bm:ke,m:Be,parent:et,root:on,type:jt}=x,qt=mu(C);if(bo(x,!1),ke&&id(ke),!qt&&(fe=Oe&&Oe.onVnodeBeforeMount)&&Zr(fe,et,C),bo(x,!0),xe&&at){const Rt=()=>{x.subTree=Tf(x),at(xe,x.subTree,x,re,null)};qt&&jt.__asyncHydrate?jt.__asyncHydrate(xe,x,Rt):Rt()}else{on.ce&&on.ce._def.shadowRoot!==!1&&on.ce._injectChildStyle(jt);const Rt=x.subTree=Tf(x);A(null,Rt,M,ue,x,re,ae),C.el=Rt.el}if(Be&&Zn(Be,re),!qt&&(fe=Oe&&Oe.onVnodeMounted)){const Rt=C;Zn(()=>Zr(fe,et,Rt),re)}(C.shapeFlag&256||et&&mu(et.vnode)&&et.vnode.shapeFlag&256)&&x.a&&Zn(x.a,re),x.isMounted=!0,C=M=ue=null}};x.scope.on();const O=x.effect=new D_(U);x.scope.off();const Q=x.update=O.run.bind(O),ce=x.job=O.runIfDirty.bind(O);ce.i=x,ce.id=x.uid,O.scheduler=()=>um(ce),bo(x,!0),Q()},F=(x,C,M)=>{C.component=x;const ue=x.vnode.props;x.vnode=C,x.next=null,GA(x,C.props,ue,M),JA(x,C.children,M),Os(),Av(x),Ms()},W=(x,C,M,ue,re,ae,be,U,O=!1)=>{const Q=x&&x.children,ce=x?x.shapeFlag:0,fe=C.children,{patchFlag:xe,shapeFlag:Oe}=C;if(xe>0){if(xe&128){Pe(Q,fe,M,ue,re,ae,be,U,O);return}else if(xe&256){se(Q,fe,M,ue,re,ae,be,U,O);return}}Oe&8?(ce&16&&It(Q,re,ae),fe!==Q&&h(M,fe)):ce&16?Oe&16?Pe(Q,fe,M,ue,re,ae,be,U,O):It(Q,re,ae,!0):(ce&8&&h(M,""),Oe&16&&w(fe,M,ue,re,ae,be,U,O))},se=(x,C,M,ue,re,ae,be,U,O)=>{x=x||Da,C=C||Da;const Q=x.length,ce=C.length,fe=Math.min(Q,ce);let xe;for(xe=0;xe<fe;xe++){const Oe=C[xe]=O?hi(C[xe]):ts(C[xe]);A(x[xe],Oe,M,null,re,ae,be,U,O)}Q>ce?It(x,re,ae,!0,!1,fe):w(C,M,ue,re,ae,be,U,O,fe)},Pe=(x,C,M,ue,re,ae,be,U,O)=>{let Q=0;const ce=C.length;let fe=x.length-1,xe=ce-1;for(;Q<=fe&&Q<=xe;){const Oe=x[Q],ke=C[Q]=O?hi(C[Q]):ts(C[Q]);if(Kl(Oe,ke))A(Oe,ke,M,null,re,ae,be,U,O);else break;Q++}for(;Q<=fe&&Q<=xe;){const Oe=x[fe],ke=C[xe]=O?hi(C[xe]):ts(C[xe]);if(Kl(Oe,ke))A(Oe,ke,M,null,re,ae,be,U,O);else break;fe--,xe--}if(Q>fe){if(Q<=xe){const Oe=xe+1,ke=Oe<ce?C[Oe].el:ue;for(;Q<=xe;)A(null,C[Q]=O?hi(C[Q]):ts(C[Q]),M,ke,re,ae,be,U,O),Q++}}else if(Q>xe)for(;Q<=fe;)J(x[Q],re,ae,!0),Q++;else{const Oe=Q,ke=Q,Be=new Map;for(Q=ke;Q<=xe;Q++){const Dt=C[Q]=O?hi(C[Q]):ts(C[Q]);Dt.key!=null&&Be.set(Dt.key,Q)}let et,on=0;const jt=xe-ke+1;let qt=!1,Rt=0;const kn=new Array(jt);for(Q=0;Q<jt;Q++)kn[Q]=0;for(Q=Oe;Q<=fe;Q++){const Dt=x[Q];if(on>=jt){J(Dt,re,ae,!0);continue}let an;if(Dt.key!=null)an=Be.get(Dt.key);else for(et=ke;et<=xe;et++)if(kn[et-ke]===0&&Kl(Dt,C[et])){an=et;break}an===void 0?J(Dt,re,ae,!0):(kn[an-ke]=Q+1,an>=Rt?Rt=an:qt=!0,A(Dt,C[an],M,null,re,ae,be,U,O),on++)}const ur=qt?e1(kn):Da;for(et=ur.length-1,Q=jt-1;Q>=0;Q--){const Dt=ke+Q,an=C[Dt],ps=Dt+1<ce?C[Dt+1].el:ue;kn[Q]===0?A(null,an,M,ps,re,ae,be,U,O):qt&&(et<0||Q!==ur[et]?te(an,M,ps,2):et--)}}},te=(x,C,M,ue,re=null)=>{const{el:ae,type:be,transition:U,children:O,shapeFlag:Q}=x;if(Q&6){te(x.component.subTree,C,M,ue);return}if(Q&128){x.suspense.move(C,M,ue);return}if(Q&64){be.move(x,C,M,De);return}if(be===ct){r(ae,C,M);for(let fe=0;fe<O.length;fe++)te(O[fe],C,M,ue);r(x.anchor,C,M);return}if(be===ld){$(x,C,M);return}if(ue!==2&&Q&1&&U)if(ue===0)U.beforeEnter(ae),r(ae,C,M),Zn(()=>U.enter(ae),re);else{const{leave:fe,delayLeave:xe,afterLeave:Oe}=U,ke=()=>{x.ctx.isUnmounted?s(ae):r(ae,C,M)},Be=()=>{fe(ae,()=>{ke(),Oe&&Oe()})};xe?xe(ae,ke,Be):Be()}else r(ae,C,M)},J=(x,C,M,ue=!1,re=!1)=>{const{type:ae,props:be,ref:U,children:O,dynamicChildren:Q,shapeFlag:ce,patchFlag:fe,dirs:xe,cacheIndex:Oe}=x;if(fe===-2&&(re=!1),U!=null&&(Os(),pu(U,null,M,x,!0),Ms()),Oe!=null&&(C.renderCache[Oe]=void 0),ce&256){C.ctx.deactivate(x);return}const ke=ce&1&&xe,Be=!mu(x);let et;if(Be&&(et=be&&be.onVnodeBeforeUnmount)&&Zr(et,C,x),ce&6)pt(x.component,M,ue);else{if(ce&128){x.suspense.unmount(M,ue);return}ke&&_o(x,null,C,"beforeUnmount"),ce&64?x.type.remove(x,C,M,De,ue):Q&&!Q.hasOnce&&(ae!==ct||fe>0&&fe&64)?It(Q,C,M,!1,!0):(ae===ct&&fe&384||!re&&ce&16)&&It(O,C,M),ue&&Ee(x)}(Be&&(et=be&&be.onVnodeUnmounted)||ke)&&Zn(()=>{et&&Zr(et,C,x),ke&&_o(x,null,C,"unmounted")},M)},Ee=x=>{const{type:C,el:M,anchor:ue,transition:re}=x;if(C===ct){Ge(M,ue);return}if(C===ld){z(x);return}const ae=()=>{s(M),re&&!re.persisted&&re.afterLeave&&re.afterLeave()};if(x.shapeFlag&1&&re&&!re.persisted){const{leave:be,delayLeave:U}=re,O=()=>be(M,ae);U?U(x.el,ae,O):O()}else ae()},Ge=(x,C)=>{let M;for(;x!==C;)M=g(x),s(x),x=M;s(C)},pt=(x,C,M)=>{const{bum:ue,scope:re,job:ae,subTree:be,um:U,m:O,a:Q,parent:ce,slots:{__:fe}}=x;Mv(O),Mv(Q),ue&&id(ue),ce&&qe(fe)&&fe.forEach(xe=>{ce.renderCache[xe]=void 0}),re.stop(),ae&&(ae.flags|=8,J(be,x,C,M)),U&&Zn(U,C),Zn(()=>{x.isUnmounted=!0},C),C&&C.pendingBranch&&!C.isUnmounted&&x.asyncDep&&!x.asyncResolved&&x.suspenseId===C.pendingId&&(C.deps--,C.deps===0&&C.resolve())},It=(x,C,M,ue=!1,re=!1,ae=0)=>{for(let be=ae;be<x.length;be++)J(x[be],C,M,ue,re)},Z=x=>{if(x.shapeFlag&6)return Z(x.component.subTree);if(x.shapeFlag&128)return x.suspense.next();const C=g(x.anchor||x.el),M=C&&C[tb];return M?g(M):C};let Ae=!1;const we=(x,C,M)=>{x==null?C._vnode&&J(C._vnode,null,null,!0):A(C._vnode||null,x,C,null,null,null,M),C._vnode=x,Ae||(Ae=!0,Av(),X_(),Ae=!1)},De={p:A,um:J,m:te,r:Ee,mt:ft,mc:w,pc:W,pbc:D,n:Z,o:n};let We,at;return e&&([We,at]=e(De)),{render:we,hydrate:We,createApp:zA(we,We)}}function Ef({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function bo({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function ZA(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function pm(n,e,t=!1){const r=n.children,s=e.children;if(qe(r)&&qe(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=hi(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&pm(o,a)),a.type===mh&&(a.el=o.el),a.type===Ci&&!a.el&&(a.el=o.el)}}function e1(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<c?i=a+1:o=a;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function bb(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:bb(e)}function Mv(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const t1=Symbol.for("v-scx"),n1=()=>Ur(t1);function St(n,e,t){return wb(n,e,t)}function wb(n,e,t=Ct){const{immediate:r,deep:s,flush:i,once:o}=t,a=Cn({},t),l=e&&r||!e&&i!=="post";let c;if(ku){if(i==="sync"){const y=n1();c=y.__watcherHandles||(y.__watcherHandles=[])}else if(!l){const y=()=>{};return y.stop=$r,y.resume=$r,y.pause=$r,y}}const h=Gn;a.call=(y,I,A)=>cs(y,h,I,A);let f=!1;i==="post"?a.scheduler=y=>{Zn(y,h&&h.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(y,I)=>{I?y():um(y)}),a.augmentJob=y=>{e&&(y.flags|=4),f&&(y.flags|=2,h&&(y.id=h.uid,y.i=h))};const g=vA(n,e,a);return ku&&(c?c.push(g):l&&g()),g}function r1(n,e,t){const r=this.proxy,s=pn(n)?n.includes(".")?xb(r,n):()=>r[n]:n.bind(r,r);let i;Qe(e)?i=e:(i=e.handler,t=e);const o=ic(this),a=wb(s,i.bind(r),t);return o(),a}function xb(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const s1=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Rr(e)}Modifiers`]||n[`${Ui(e)}Modifiers`];function i1(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||Ct;let s=t;const i=e.startsWith("update:"),o=i&&s1(r,e.slice(7));o&&(o.trim&&(s=t.map(h=>pn(h)?h.trim():h)),o.number&&(s=t.map(Ad)));let a,l=r[a=yf(e)]||r[a=yf(Rr(e))];!l&&i&&(l=r[a=yf(Ui(e))]),l&&cs(l,n,6,s);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,cs(c,n,6,s)}}function Ib(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!Qe(n)){const l=c=>{const h=Ib(c,e,!0);h&&(a=!0,Cn(o,h))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(Mt(n)&&r.set(n,null),null):(qe(i)?i.forEach(l=>o[l]=null):Cn(o,i),Mt(n)&&r.set(n,o),o)}function ph(n,e){return!n||!oh(e)?!1:(e=e.slice(2).replace(/Once$/,""),wt(n,e[0].toLowerCase()+e.slice(1))||wt(n,Ui(e))||wt(n,e))}function Tf(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:c,renderCache:h,props:f,data:g,setupState:y,ctx:I,inheritAttrs:A}=n,P=Cd(n);let j,B;try{if(t.shapeFlag&4){const z=s||r,he=z;j=ts(c.call(he,z,h,f,y,g,I)),B=a}else{const z=e;j=ts(z.length>1?z(f,{attrs:a,slots:o,emit:l}):z(f,null)),B=e.props?a:o1(a)}}catch(z){vu.length=0,hh(z,n,1),j=nt(Ci)}let $=j;if(B&&A!==!1){const z=Object.keys(B),{shapeFlag:he}=$;z.length&&he&7&&(i&&z.some(Xp)&&(B=a1(B,i)),$=Ba($,B,!1,!0))}return t.dirs&&($=Ba($,null,!1,!0),$.dirs=$.dirs?$.dirs.concat(t.dirs):t.dirs),t.transition&&cm($,t.transition),j=$,Cd(P),j}const o1=n=>{let e;for(const t in n)(t==="class"||t==="style"||oh(t))&&((e||(e={}))[t]=n[t]);return e},a1=(n,e)=>{const t={};for(const r in n)(!Xp(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function l1(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?Lv(r,o,c):!!o;if(l&8){const h=e.dynamicProps;for(let f=0;f<h.length;f++){const g=h[f];if(o[g]!==r[g]&&!ph(c,g))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?Lv(r,o,c):!0:!!o;return!1}function Lv(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!ph(t,i))return!0}return!1}function u1({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const Eb=n=>n.__isSuspense;function c1(n,e){e&&e.pendingBranch?qe(n)?e.effects.push(...n):e.effects.push(n):bA(n)}const ct=Symbol.for("v-fgt"),mh=Symbol.for("v-txt"),Ci=Symbol.for("v-cmt"),ld=Symbol.for("v-stc"),vu=[];let yr=null;function N(n=!1){vu.push(yr=n?null:[])}function d1(){vu.pop(),yr=vu[vu.length-1]||null}let Cu=1;function $v(n,e=!1){Cu+=n,n<0&&yr&&e&&(yr.hasOnce=!0)}function Tb(n){return n.dynamicChildren=Cu>0?yr||Da:null,d1(),Cu>0&&yr&&yr.push(n),n}function V(n,e,t,r,s,i){return Tb(d(n,e,t,r,s,i,!0))}function ko(n,e,t,r,s){return Tb(nt(n,e,t,r,s,!0))}function Dd(n){return n?n.__v_isVNode===!0:!1}function Kl(n,e){return n.type===e.type&&n.key===e.key}const Ab=({key:n})=>n??null,ud=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?pn(n)||Hn(n)||Qe(n)?{i:vr,r:n,k:e,f:!!t}:n:null);function d(n,e=null,t=null,r=0,s=null,i=n===ct?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&Ab(e),ref:e&&ud(e),scopeId:eb,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:vr};return a?(mm(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=pn(t)?8:16),Cu>0&&!o&&yr&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&yr.push(l),l}const nt=h1;function h1(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===OA)&&(n=Ci),Dd(n)){const a=Ba(n,e,!0);return t&&mm(a,t),Cu>0&&!i&&yr&&(a.shapeFlag&6?yr[yr.indexOf(n)]=a:yr.push(a)),a.patchFlag=-2,a}if(I1(n)&&(n=n.__vccOpts),e){e=f1(e);let{class:a,style:l}=e;a&&!pn(a)&&(e.class=Ot(a)),Mt(l)&&(lm(l)&&!qe(l)&&(l=Cn({},l)),e.style=gr(l))}const o=pn(n)?1:Eb(n)?128:xA(n)?64:Mt(n)?4:Qe(n)?2:0;return d(n,e,t,r,s,o,i,!0)}function f1(n){return n?lm(n)||pb(n)?Cn({},n):n:null}function Ba(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,c=e?p1(s||{},e):s,h={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&Ab(c),ref:e&&e.ref?t&&i?qe(i)?i.concat(ud(e)):[i,ud(e)]:ud(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==ct?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Ba(n.ssContent),ssFallback:n.ssFallback&&Ba(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&cm(h,l.clone(h)),h}function zt(n=" ",e=0){return nt(mh,null,n,e)}function Ln(n,e){const t=nt(ld,null,n);return t.staticCount=e,t}function _e(n="",e=!1){return e?(N(),ko(Ci,null,n)):nt(Ci,null,n)}function ts(n){return n==null||typeof n=="boolean"?nt(Ci):qe(n)?nt(ct,null,n.slice()):Dd(n)?hi(n):nt(mh,null,String(n))}function hi(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:Ba(n)}function mm(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(qe(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),mm(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!pb(e)?e._ctx=vr:s===3&&vr&&(vr.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else Qe(e)?(e={default:e,_ctx:vr},t=32):(e=String(e),r&64?(t=16,e=[zt(e)]):t=8);n.children=e,n.shapeFlag|=t}function p1(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=Ot([e.class,r.class]));else if(s==="style")e.style=gr([e.style,r.style]);else if(oh(s)){const i=e[s],o=r[s];o&&i!==o&&!(qe(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function Zr(n,e,t,r=null){cs(n,e,7,[t,r])}const m1=db();let g1=0;function v1(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||m1,i={uid:g1++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new zT(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:gb(r,s),emitsOptions:Ib(r,s),emit:null,emitted:null,propsDefaults:Ct,inheritAttrs:r.inheritAttrs,ctx:Ct,data:Ct,props:Ct,attrs:Ct,slots:Ct,refs:Ct,setupState:Ct,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=i1.bind(null,i),n.ce&&n.ce(i),i}let Gn=null,Nd,cp;{const n=uh(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};Nd=e("__VUE_INSTANCE_SETTERS__",t=>Gn=t),cp=e("__VUE_SSR_SETTERS__",t=>ku=t)}const ic=n=>{const e=Gn;return Nd(n),n.scope.on(),()=>{n.scope.off(),Nd(e)}},Fv=()=>{Gn&&Gn.scope.off(),Nd(null)};function Sb(n){return n.vnode.shapeFlag&4}let ku=!1;function y1(n,e=!1,t=!1){e&&cp(e);const{props:r,children:s}=n.vnode,i=Sb(n);KA(n,r,i,e),QA(n,s,t||e);const o=i?_1(n,e):void 0;return e&&cp(!1),o}function _1(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,LA);const{setup:r}=t;if(r){Os();const s=n.setupContext=r.length>1?w1(n):null,i=ic(n),o=sc(r,n,0,[n.props,s]),a=A_(o);if(Ms(),i(),(a||n.sp)&&!mu(n)&&ib(n),a){if(o.then(Fv,Fv),e)return o.then(l=>{Uv(n,l,e)}).catch(l=>{hh(l,n,0)});n.asyncDep=o}else Uv(n,o,e)}else Pb(n,e)}function Uv(n,e,t){Qe(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:Mt(e)&&(n.setupState=Q_(e)),Pb(n,t)}let jv;function Pb(n,e,t){const r=n.type;if(!n.render){if(!e&&jv&&!r.render){const s=r.template||dm(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,c=Cn(Cn({isCustomElement:i,delimiters:a},o),l);r.render=jv(s,c)}}n.render=r.render||$r}{const s=ic(n);Os();try{$A(n)}finally{Ms(),s()}}}const b1={get(n,e){return Kn(n,"get",""),n[e]}};function w1(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,b1),slots:n.slots,emit:n.emit,expose:e}}function gh(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(Q_(cA(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in gu)return gu[t](n)},has(e,t){return t in e||t in gu}})):n.proxy}function x1(n,e=!0){return Qe(n)?n.displayName||n.name:n.name||e&&n.__name}function I1(n){return Qe(n)&&"__vccOpts"in n}const je=(n,e)=>mA(n,e,ku);function Rb(n,e,t){const r=arguments.length;return r===2?Mt(e)&&!qe(e)?Dd(e)?nt(n,null,[e]):nt(n,e):nt(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&Dd(t)&&(t=[t]),nt(n,e,t))}const E1="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let dp;const qv=typeof window<"u"&&window.trustedTypes;if(qv)try{dp=qv.createPolicy("vue",{createHTML:n=>n})}catch{}const Cb=dp?n=>dp.createHTML(n):n=>n,T1="http://www.w3.org/2000/svg",A1="http://www.w3.org/1998/Math/MathML",Es=typeof document<"u"?document:null,Bv=Es&&Es.createElement("template"),S1={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?Es.createElementNS(T1,n):e==="mathml"?Es.createElementNS(A1,n):t?Es.createElement(n,{is:t}):Es.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>Es.createTextNode(n),createComment:n=>Es.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Es.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{Bv.innerHTML=Cb(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=Bv.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},P1=Symbol("_vtc");function R1(n,e,t){const r=n[P1];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const Vd=Symbol("_vod"),kb=Symbol("_vsh"),Af={beforeMount(n,{value:e},{transition:t}){n[Vd]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):Gl(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),Gl(n,!0),r.enter(n)):r.leave(n,()=>{Gl(n,!1)}):Gl(n,e))},beforeUnmount(n,{value:e}){Gl(n,e)}};function Gl(n,e){n.style.display=e?n[Vd]:"none",n[kb]=!e}const C1=Symbol(""),k1=/(^|;)\s*display\s*:/;function D1(n,e,t){const r=n.style,s=pn(t);let i=!1;if(t&&!s){if(e)if(pn(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&cd(r,a,"")}else for(const o in e)t[o]==null&&cd(r,o,"");for(const o in t)o==="display"&&(i=!0),cd(r,o,t[o])}else if(s){if(e!==t){const o=r[C1];o&&(t+=";"+o),r.cssText=t,i=k1.test(t)}}else e&&n.removeAttribute("style");Vd in n&&(n[Vd]=i?r.display:"",n[kb]&&(r.display="none"))}const zv=/\s*!important$/;function cd(n,e,t){if(qe(t))t.forEach(r=>cd(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=N1(n,e);zv.test(t)?n.setProperty(Ui(r),t.replace(zv,""),"important"):n[r]=t}}const Kv=["Webkit","Moz","ms"],Sf={};function N1(n,e){const t=Sf[e];if(t)return t;let r=Rr(e);if(r!=="filter"&&r in n)return Sf[e]=r;r=lh(r);for(let s=0;s<Kv.length;s++){const i=Kv[s]+r;if(i in n)return Sf[e]=i}return e}const Gv="http://www.w3.org/1999/xlink";function Hv(n,e,t,r,s,i=qT(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(Gv,e.slice(6,e.length)):n.setAttributeNS(Gv,e,t):t==null||i&&!R_(t)?n.removeAttribute(e):n.setAttribute(e,i?"":us(t)?String(t):t)}function Wv(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?Cb(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=R_(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function pi(n,e,t,r){n.addEventListener(e,t,r)}function V1(n,e,t,r){n.removeEventListener(e,t,r)}const Qv=Symbol("_vei");function O1(n,e,t,r,s=null){const i=n[Qv]||(n[Qv]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=M1(e);if(r){const c=i[e]=F1(r,s);pi(n,a,c,l)}else o&&(V1(n,a,o,l),i[e]=void 0)}}const Jv=/(?:Once|Passive|Capture)$/;function M1(n){let e;if(Jv.test(n)){e={};let r;for(;r=n.match(Jv);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Ui(n.slice(2)),e]}let Pf=0;const L1=Promise.resolve(),$1=()=>Pf||(L1.then(()=>Pf=0),Pf=Date.now());function F1(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;cs(U1(r,t.value),e,5,[r])};return t.value=n,t.attached=$1(),t}function U1(n,e){if(qe(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const Yv=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,j1=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?R1(n,r,o):e==="style"?D1(n,t,r):oh(e)?Xp(e)||O1(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):q1(n,e,r,o))?(Wv(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Hv(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!pn(r))?Wv(n,Rr(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),Hv(n,e,r,o))};function q1(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&Yv(e)&&Qe(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Yv(e)&&pn(t)?!1:e in n}const za=n=>{const e=n.props["onUpdate:modelValue"]||!1;return qe(e)?t=>id(e,t):e};function B1(n){n.target.composing=!0}function Xv(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Ds=Symbol("_assign"),Vt={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[Ds]=za(s);const i=r||s.props&&s.props.type==="number";pi(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=Ad(a)),n[Ds](a)}),t&&pi(n,"change",()=>{n.value=n.value.trim()}),e||(pi(n,"compositionstart",B1),pi(n,"compositionend",Xv),pi(n,"change",Xv))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[Ds]=za(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?Ad(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},xi={deep:!0,created(n,e,t){n[Ds]=za(t),pi(n,"change",()=>{const r=n._modelValue,s=Du(n),i=n.checked,o=n[Ds];if(qe(r)){const a=tm(r,s),l=a!==-1;if(i&&!l)o(r.concat(s));else if(!i&&l){const c=[...r];c.splice(a,1),o(c)}}else if(cl(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o(Db(n,i))})},mounted:Zv,beforeUpdate(n,e,t){n[Ds]=za(t),Zv(n,e,t)}};function Zv(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(qe(e))s=tm(e,r.props.value)>-1;else if(cl(e))s=e.has(r.props.value);else{if(e===t)return;s=rc(e,Db(n,!0))}n.checked!==s&&(n.checked=s)}const z1={deep:!0,created(n,{value:e,modifiers:{number:t}},r){const s=cl(e);pi(n,"change",()=>{const i=Array.prototype.filter.call(n.options,o=>o.selected).map(o=>t?Ad(Du(o)):Du(o));n[Ds](n.multiple?s?new Set(i):i:i[0]),n._assigning=!0,Bt(()=>{n._assigning=!1})}),n[Ds]=za(r)},mounted(n,{value:e}){ey(n,e)},beforeUpdate(n,e,t){n[Ds]=za(t)},updated(n,{value:e}){n._assigning||ey(n,e)}};function ey(n,e){const t=n.multiple,r=qe(e);if(!(t&&!r&&!cl(e))){for(let s=0,i=n.options.length;s<i;s++){const o=n.options[s],a=Du(o);if(t)if(r){const l=typeof a;l==="string"||l==="number"?o.selected=e.some(c=>String(c)===String(a)):o.selected=tm(e,a)>-1}else o.selected=e.has(a);else if(rc(Du(o),e)){n.selectedIndex!==s&&(n.selectedIndex=s);return}}!t&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function Du(n){return"_value"in n?n._value:n.value}function Db(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const K1=["ctrl","shift","alt","meta"],G1={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>K1.some(t=>n[`${t}Key`]&&!e.includes(t))},gt=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=G1[e[o]];if(a&&a(s,e))return}return n(s,...i)})},H1={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Bn=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=Ui(s.key);if(e.some(o=>o===i||H1[o]===i))return n(s)})},W1=Cn({patchProp:j1},S1);let ty;function Q1(){return ty||(ty=YA(W1))}const J1=(...n)=>{const e=Q1().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=X1(r);if(!s)return;const i=e._component;!Qe(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,Y1(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function Y1(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function X1(n){return pn(n)?document.querySelector(n):n}const Z1={key:2,class:"fixed bottom-4 right-4 z-50 rounded-full bg-green-600 text-white px-4 py-2 shadow-lg"},eS={__name:"App",setup(n){const e=S(null),t=S(!1),r=S(!1),s=S(!1);function i(c){c.preventDefault(),e.value=c,t.value=!0}async function o(){e.value&&(e.value.prompt(),await e.value.userChoice,t.value=!1,e.value=null)}function a(){t.value=!1,e.value=null}function l(){s.value=!0,"serviceWorker"in navigator&&navigator.serviceWorker.postMessage({type:"SKIP_WAITING"}),window.location.reload()}return Un(()=>{window.addEventListener("beforeinstallprompt",i),window.addEventListener("appinstalled",a),"serviceWorker"in navigator&&(navigator.serviceWorker.addEventListener("controllerchange",()=>{s.value||(r.value=!0)}),setInterval(()=>{navigator.serviceWorker.getRegistration().then(c=>{c&&c.update()})},60*60*1e3))}),lb(()=>{window.removeEventListener("beforeinstallprompt",i),window.removeEventListener("appinstalled",a)}),(c,h)=>{const f=VA("router-view");return N(),V(ct,null,[nt(f),t.value?(N(),V("button",{key:0,class:"fixed bottom-4 right-4 z-50 rounded-full bg-sky-600 text-white px-4 py-2 shadow-lg hover:bg-sky-700 active:bg-sky-800",onClick:o}," Installer l’app ")):_e("",!0),r.value&&!s.value?(N(),V("button",{key:1,class:"fixed bottom-4 right-4 z-50 rounded-full bg-green-600 text-white px-4 py-2 shadow-lg hover:bg-green-700 active:bg-green-800",onClick:l}," 🔄 Mettre à jour ")):_e("",!0),s.value?(N(),V("div",Z1," 🔄 Mise à jour... ")):_e("",!0)],64)}}};/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const Aa=typeof document<"u";function Nb(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function tS(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&Nb(n.default)}const _t=Object.assign;function Rf(n,e){const t={};for(const r in e){const s=e[r];t[r]=jr(s)?s.map(n):n(s)}return t}const yu=()=>{},jr=Array.isArray,Vb=/#/g,nS=/&/g,rS=/\//g,sS=/=/g,iS=/\?/g,Ob=/\+/g,oS=/%5B/g,aS=/%5D/g,Mb=/%5E/g,lS=/%60/g,Lb=/%7B/g,uS=/%7C/g,$b=/%7D/g,cS=/%20/g;function gm(n){return encodeURI(""+n).replace(uS,"|").replace(oS,"[").replace(aS,"]")}function dS(n){return gm(n).replace(Lb,"{").replace($b,"}").replace(Mb,"^")}function hp(n){return gm(n).replace(Ob,"%2B").replace(cS,"+").replace(Vb,"%23").replace(nS,"%26").replace(lS,"`").replace(Lb,"{").replace($b,"}").replace(Mb,"^")}function hS(n){return hp(n).replace(sS,"%3D")}function fS(n){return gm(n).replace(Vb,"%23").replace(iS,"%3F")}function pS(n){return n==null?"":fS(n).replace(rS,"%2F")}function Nu(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const mS=/\/$/,gS=n=>n.replace(mS,"");function Cf(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=bS(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:Nu(o)}}function vS(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function ny(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function yS(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&Ka(e.matched[r],t.matched[s])&&Fb(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function Ka(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function Fb(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!_S(n[t],e[t]))return!1;return!0}function _S(n,e){return jr(n)?ry(n,e):jr(e)?ry(e,n):n===e}function ry(n,e){return jr(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function bS(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const ai={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Vu;(function(n){n.pop="pop",n.push="push"})(Vu||(Vu={}));var _u;(function(n){n.back="back",n.forward="forward",n.unknown=""})(_u||(_u={}));function wS(n){if(!n)if(Aa){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),gS(n)}const xS=/^[^#]+#/;function IS(n,e){return n.replace(xS,"#")+e}function ES(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const vh=()=>({left:window.scrollX,top:window.scrollY});function TS(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=ES(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function sy(n,e){return(history.state?history.state.position-e:-1)+n}const fp=new Map;function AS(n,e){fp.set(n,e)}function SS(n){const e=fp.get(n);return fp.delete(n),e}let PS=()=>location.protocol+"//"+location.host;function Ub(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),ny(l,"")}return ny(t,n)+r+s}function RS(n,e,t,r){let s=[],i=[],o=null;const a=({state:g})=>{const y=Ub(n,location),I=t.value,A=e.value;let P=0;if(g){if(t.value=y,e.value=g,o&&o===I){o=null;return}P=A?g.position-A.position:0}else r(y);s.forEach(j=>{j(t.value,I,{delta:P,type:Vu.pop,direction:P?P>0?_u.forward:_u.back:_u.unknown})})};function l(){o=t.value}function c(g){s.push(g);const y=()=>{const I=s.indexOf(g);I>-1&&s.splice(I,1)};return i.push(y),y}function h(){const{history:g}=window;g.state&&g.replaceState(_t({},g.state,{scroll:vh()}),"")}function f(){for(const g of i)g();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",h)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",h,{passive:!0}),{pauseListeners:l,listen:c,destroy:f}}function iy(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?vh():null}}function CS(n){const{history:e,location:t}=window,r={value:Ub(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,c,h){const f=n.indexOf("#"),g=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:PS()+n+l;try{e[h?"replaceState":"pushState"](c,"",g),s.value=c}catch(y){console.error(y),t[h?"replace":"assign"](g)}}function o(l,c){const h=_t({},e.state,iy(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});i(l,h,!0),r.value=l}function a(l,c){const h=_t({},s.value,e.state,{forward:l,scroll:vh()});i(h.current,h,!0);const f=_t({},iy(r.value,l,null),{position:h.position+1},c);i(l,f,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function kS(n){n=wS(n);const e=CS(n),t=RS(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=_t({location:"",base:n,go:r,createHref:IS.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function DS(n){return typeof n=="string"||n&&typeof n=="object"}function jb(n){return typeof n=="string"||typeof n=="symbol"}const qb=Symbol("");var oy;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(oy||(oy={}));function Ga(n,e){return _t(new Error,{type:n,[qb]:!0},e)}function Is(n,e){return n instanceof Error&&qb in n&&(e==null||!!(n.type&e))}const ay="[^/]+?",NS={sensitive:!1,strict:!1,start:!0,end:!0},VS=/[.+*?^${}()[\]/\\]/g;function OS(n,e){const t=_t({},NS,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const h=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let f=0;f<c.length;f++){const g=c[f];let y=40+(t.sensitive?.25:0);if(g.type===0)f||(s+="/"),s+=g.value.replace(VS,"\\$&"),y+=40;else if(g.type===1){const{value:I,repeatable:A,optional:P,regexp:j}=g;i.push({name:I,repeatable:A,optional:P});const B=j||ay;if(B!==ay){y+=10;try{new RegExp(`(${B})`)}catch(z){throw new Error(`Invalid custom RegExp for param "${I}" (${B}): `+z.message)}}let $=A?`((?:${B})(?:/(?:${B}))*)`:`(${B})`;f||($=P&&c.length<2?`(?:/${$})`:"/"+$),P&&($+="?"),s+=$,y+=20,P&&(y+=-8),A&&(y+=-20),B===".*"&&(y+=-50)}h.push(y)}r.push(h)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const h=c.match(o),f={};if(!h)return null;for(let g=1;g<h.length;g++){const y=h[g]||"",I=i[g-1];f[I.name]=y&&I.repeatable?y.split("/"):y}return f}function l(c){let h="",f=!1;for(const g of n){(!f||!h.endsWith("/"))&&(h+="/"),f=!1;for(const y of g)if(y.type===0)h+=y.value;else if(y.type===1){const{value:I,repeatable:A,optional:P}=y,j=I in c?c[I]:"";if(jr(j)&&!A)throw new Error(`Provided param "${I}" is an array but it is not repeatable (* or + modifiers)`);const B=jr(j)?j.join("/"):j;if(!B)if(P)g.length<2&&(h.endsWith("/")?h=h.slice(0,-1):f=!0);else throw new Error(`Missing required param "${I}"`);h+=B}}return h||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function MS(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function Bb(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=MS(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(ly(r))return 1;if(ly(s))return-1}return s.length-r.length}function ly(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const LS={type:0,value:""},$S=/[a-zA-Z0-9_]/;function FS(n){if(!n)return[[]];if(n==="/")return[[LS]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(y){throw new Error(`ERR (${t})/"${c}": ${y}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,c="",h="";function f(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:h,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function g(){c+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(c&&f(),o()):l===":"?(f(),t=1):g();break;case 4:g(),t=r;break;case 1:l==="("?t=2:$S.test(l)?g():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?h[h.length-1]=="\\"?h=h.slice(0,-1)+l:t=3:h+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,h="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),f(),o(),s}function US(n,e,t){const r=OS(FS(n.path),t),s=_t(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function jS(n,e){const t=[],r=new Map;e=hy({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,g,y){const I=!y,A=cy(f);A.aliasOf=y&&y.record;const P=hy(e,f),j=[A];if("alias"in f){const z=typeof f.alias=="string"?[f.alias]:f.alias;for(const he of z)j.push(cy(_t({},A,{components:y?y.record.components:A.components,path:he,aliasOf:y?y.record:A})))}let B,$;for(const z of j){const{path:he}=z;if(g&&he[0]!=="/"){const ve=g.record.path,T=ve[ve.length-1]==="/"?"":"/";z.path=g.record.path+(he&&T+he)}if(B=US(z,g,P),y?y.alias.push(B):($=$||B,$!==B&&$.alias.push(B),I&&f.name&&!dy(B)&&o(f.name)),zb(B)&&l(B),A.children){const ve=A.children;for(let T=0;T<ve.length;T++)i(ve[T],B,y&&y.children[T])}y=y||B}return $?()=>{o($)}:yu}function o(f){if(jb(f)){const g=r.get(f);g&&(r.delete(f),t.splice(t.indexOf(g),1),g.children.forEach(o),g.alias.forEach(o))}else{const g=t.indexOf(f);g>-1&&(t.splice(g,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function l(f){const g=zS(f,t);t.splice(g,0,f),f.record.name&&!dy(f)&&r.set(f.record.name,f)}function c(f,g){let y,I={},A,P;if("name"in f&&f.name){if(y=r.get(f.name),!y)throw Ga(1,{location:f});P=y.record.name,I=_t(uy(g.params,y.keys.filter($=>!$.optional).concat(y.parent?y.parent.keys.filter($=>$.optional):[]).map($=>$.name)),f.params&&uy(f.params,y.keys.map($=>$.name))),A=y.stringify(I)}else if(f.path!=null)A=f.path,y=t.find($=>$.re.test(A)),y&&(I=y.parse(A),P=y.record.name);else{if(y=g.name?r.get(g.name):t.find($=>$.re.test(g.path)),!y)throw Ga(1,{location:f,currentLocation:g});P=y.record.name,I=_t({},g.params,f.params),A=y.stringify(I)}const j=[];let B=y;for(;B;)j.unshift(B.record),B=B.parent;return{name:P,path:A,params:I,matched:j,meta:BS(j)}}n.forEach(f=>i(f));function h(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:o,clearRoutes:h,getRoutes:a,getRecordMatcher:s}}function uy(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function cy(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:qS(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function qS(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function dy(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function BS(n){return n.reduce((e,t)=>_t(e,t.meta),{})}function hy(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function zS(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;Bb(n,e[i])<0?r=i:t=i+1}const s=KS(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function KS(n){let e=n;for(;e=e.parent;)if(zb(e)&&Bb(n,e)===0)return e}function zb({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function GS(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(Ob," "),o=i.indexOf("="),a=Nu(o<0?i:i.slice(0,o)),l=o<0?null:Nu(i.slice(o+1));if(a in e){let c=e[a];jr(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function fy(n){let e="";for(let t in n){const r=n[t];if(t=hS(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(jr(r)?r.map(i=>i&&hp(i)):[r&&hp(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function HS(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=jr(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const WS=Symbol(""),py=Symbol(""),yh=Symbol(""),vm=Symbol(""),pp=Symbol("");function Hl(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function fi(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const c=g=>{g===!1?l(Ga(4,{from:t,to:e})):g instanceof Error?l(g):DS(g)?l(Ga(2,{from:e,to:g})):(o&&r.enterCallbacks[s]===o&&typeof g=="function"&&o.push(g),a())},h=i(()=>n.call(r&&r.instances[s],e,t,c));let f=Promise.resolve(h);n.length<3&&(f=f.then(c)),f.catch(g=>l(g))})}function kf(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(Nb(l)){const h=(l.__vccOpts||l)[e];h&&i.push(fi(h,t,r,o,a,s))}else{let c=l();i.push(()=>c.then(h=>{if(!h)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=tS(h)?h.default:h;o.mods[a]=h,o.components[a]=f;const y=(f.__vccOpts||f)[e];return y&&fi(y,t,r,o,a,s)()}))}}return i}function my(n){const e=Ur(yh),t=Ur(vm),r=je(()=>{const l=is(n.to);return e.resolve(l)}),s=je(()=>{const{matched:l}=r.value,{length:c}=l,h=l[c-1],f=t.matched;if(!h||!f.length)return-1;const g=f.findIndex(Ka.bind(null,h));if(g>-1)return g;const y=gy(l[c-2]);return c>1&&gy(h)===y&&f[f.length-1].path!==y?f.findIndex(Ka.bind(null,l[c-2])):g}),i=je(()=>s.value>-1&&ZS(t.params,r.value.params)),o=je(()=>s.value>-1&&s.value===t.matched.length-1&&Fb(t.params,r.value.params));function a(l={}){if(XS(l)){const c=e[is(n.replace)?"replace":"push"](is(n.to)).catch(yu);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:je(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function QS(n){return n.length===1?n[0]:n}const JS=sb({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:my,setup(n,{slots:e}){const t=dh(my(n)),{options:r}=Ur(yh),s=je(()=>({[vy(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[vy(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&QS(e.default(t));return n.custom?i:Rb("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),YS=JS;function XS(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function ZS(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!jr(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function gy(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const vy=(n,e,t)=>n??e??t,eP=sb({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=Ur(pp),s=je(()=>n.route||r.value),i=Ur(py,0),o=je(()=>{let c=is(i);const{matched:h}=s.value;let f;for(;(f=h[c])&&!f.components;)c++;return c}),a=je(()=>s.value.matched[o.value]);ad(py,je(()=>o.value+1)),ad(WS,a),ad(pp,s);const l=S();return St(()=>[l.value,a.value,n.name],([c,h,f],[g,y,I])=>{h&&(h.instances[f]=c,y&&y!==h&&c&&c===g&&(h.leaveGuards.size||(h.leaveGuards=y.leaveGuards),h.updateGuards.size||(h.updateGuards=y.updateGuards))),c&&h&&(!y||!Ka(h,y)||!g)&&(h.enterCallbacks[f]||[]).forEach(A=>A(c))},{flush:"post"}),()=>{const c=s.value,h=n.name,f=a.value,g=f&&f.components[h];if(!g)return yy(t.default,{Component:g,route:c});const y=f.props[h],I=y?y===!0?c.params:typeof y=="function"?y(c):y:null,P=Rb(g,_t({},I,e,{onVnodeUnmounted:j=>{j.component.isUnmounted&&(f.instances[h]=null)},ref:l}));return yy(t.default,{Component:P,route:c})||P}}});function yy(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const tP=eP;function nP(n){const e=jS(n.routes,n),t=n.parseQuery||GS,r=n.stringifyQuery||fy,s=n.history,i=Hl(),o=Hl(),a=Hl(),l=dA(ai);let c=ai;Aa&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const h=Rf.bind(null,Z=>""+Z),f=Rf.bind(null,pS),g=Rf.bind(null,Nu);function y(Z,Ae){let we,De;return jb(Z)?(we=e.getRecordMatcher(Z),De=Ae):De=Z,e.addRoute(De,we)}function I(Z){const Ae=e.getRecordMatcher(Z);Ae&&e.removeRoute(Ae)}function A(){return e.getRoutes().map(Z=>Z.record)}function P(Z){return!!e.getRecordMatcher(Z)}function j(Z,Ae){if(Ae=_t({},Ae||l.value),typeof Z=="string"){const C=Cf(t,Z,Ae.path),M=e.resolve({path:C.path},Ae),ue=s.createHref(C.fullPath);return _t(C,M,{params:g(M.params),hash:Nu(C.hash),redirectedFrom:void 0,href:ue})}let we;if(Z.path!=null)we=_t({},Z,{path:Cf(t,Z.path,Ae.path).path});else{const C=_t({},Z.params);for(const M in C)C[M]==null&&delete C[M];we=_t({},Z,{params:f(C)}),Ae.params=f(Ae.params)}const De=e.resolve(we,Ae),We=Z.hash||"";De.params=h(g(De.params));const at=vS(r,_t({},Z,{hash:dS(We),path:De.path})),x=s.createHref(at);return _t({fullPath:at,hash:We,query:r===fy?HS(Z.query):Z.query||{}},De,{redirectedFrom:void 0,href:x})}function B(Z){return typeof Z=="string"?Cf(t,Z,l.value.path):_t({},Z)}function $(Z,Ae){if(c!==Z)return Ga(8,{from:Ae,to:Z})}function z(Z){return T(Z)}function he(Z){return z(_t(B(Z),{replace:!0}))}function ve(Z){const Ae=Z.matched[Z.matched.length-1];if(Ae&&Ae.redirect){const{redirect:we}=Ae;let De=typeof we=="function"?we(Z):we;return typeof De=="string"&&(De=De.includes("?")||De.includes("#")?De=B(De):{path:De},De.params={}),_t({query:Z.query,hash:Z.hash,params:De.path!=null?{}:Z.params},De)}}function T(Z,Ae){const we=c=j(Z),De=l.value,We=Z.state,at=Z.force,x=Z.replace===!0,C=ve(we);if(C)return T(_t(B(C),{state:typeof C=="object"?_t({},We,C.state):We,force:at,replace:x}),Ae||we);const M=we;M.redirectedFrom=Ae;let ue;return!at&&yS(r,De,we)&&(ue=Ga(16,{to:M,from:De}),te(De,De,!0,!1)),(ue?Promise.resolve(ue):D(M,De)).catch(re=>Is(re)?Is(re,2)?re:Pe(re):W(re,M,De)).then(re=>{if(re){if(Is(re,2))return T(_t({replace:x},B(re.to),{state:typeof re.to=="object"?_t({},We,re.to.state):We,force:at}),Ae||M)}else re=q(M,De,!0,x,We);return L(M,De,re),re})}function w(Z,Ae){const we=$(Z,Ae);return we?Promise.reject(we):Promise.resolve()}function E(Z){const Ae=Ge.values().next().value;return Ae&&typeof Ae.runWithContext=="function"?Ae.runWithContext(Z):Z()}function D(Z,Ae){let we;const[De,We,at]=rP(Z,Ae);we=kf(De.reverse(),"beforeRouteLeave",Z,Ae);for(const C of De)C.leaveGuards.forEach(M=>{we.push(fi(M,Z,Ae))});const x=w.bind(null,Z,Ae);return we.push(x),It(we).then(()=>{we=[];for(const C of i.list())we.push(fi(C,Z,Ae));return we.push(x),It(we)}).then(()=>{we=kf(We,"beforeRouteUpdate",Z,Ae);for(const C of We)C.updateGuards.forEach(M=>{we.push(fi(M,Z,Ae))});return we.push(x),It(we)}).then(()=>{we=[];for(const C of at)if(C.beforeEnter)if(jr(C.beforeEnter))for(const M of C.beforeEnter)we.push(fi(M,Z,Ae));else we.push(fi(C.beforeEnter,Z,Ae));return we.push(x),It(we)}).then(()=>(Z.matched.forEach(C=>C.enterCallbacks={}),we=kf(at,"beforeRouteEnter",Z,Ae,E),we.push(x),It(we))).then(()=>{we=[];for(const C of o.list())we.push(fi(C,Z,Ae));return we.push(x),It(we)}).catch(C=>Is(C,8)?C:Promise.reject(C))}function L(Z,Ae,we){a.list().forEach(De=>E(()=>De(Z,Ae,we)))}function q(Z,Ae,we,De,We){const at=$(Z,Ae);if(at)return at;const x=Ae===ai,C=Aa?history.state:{};we&&(De||x?s.replace(Z.fullPath,_t({scroll:x&&C&&C.scroll},We)):s.push(Z.fullPath,We)),l.value=Z,te(Z,Ae,we,x),Pe()}let R;function ft(){R||(R=s.listen((Z,Ae,we)=>{if(!pt.listening)return;const De=j(Z),We=ve(De);if(We){T(_t(We,{replace:!0,force:!0}),De).catch(yu);return}c=De;const at=l.value;Aa&&AS(sy(at.fullPath,we.delta),vh()),D(De,at).catch(x=>Is(x,12)?x:Is(x,2)?(T(_t(B(x.to),{force:!0}),De).then(C=>{Is(C,20)&&!we.delta&&we.type===Vu.pop&&s.go(-1,!1)}).catch(yu),Promise.reject()):(we.delta&&s.go(-we.delta,!1),W(x,De,at))).then(x=>{x=x||q(De,at,!1),x&&(we.delta&&!Is(x,8)?s.go(-we.delta,!1):we.type===Vu.pop&&Is(x,20)&&s.go(-1,!1)),L(De,at,x)}).catch(yu)}))}let Ze=Hl(),ne=Hl(),F;function W(Z,Ae,we){Pe(Z);const De=ne.list();return De.length?De.forEach(We=>We(Z,Ae,we)):console.error(Z),Promise.reject(Z)}function se(){return F&&l.value!==ai?Promise.resolve():new Promise((Z,Ae)=>{Ze.add([Z,Ae])})}function Pe(Z){return F||(F=!Z,ft(),Ze.list().forEach(([Ae,we])=>Z?we(Z):Ae()),Ze.reset()),Z}function te(Z,Ae,we,De){const{scrollBehavior:We}=n;if(!Aa||!We)return Promise.resolve();const at=!we&&SS(sy(Z.fullPath,0))||(De||!we)&&history.state&&history.state.scroll||null;return Bt().then(()=>We(Z,Ae,at)).then(x=>x&&TS(x)).catch(x=>W(x,Z,Ae))}const J=Z=>s.go(Z);let Ee;const Ge=new Set,pt={currentRoute:l,listening:!0,addRoute:y,removeRoute:I,clearRoutes:e.clearRoutes,hasRoute:P,getRoutes:A,resolve:j,options:n,push:z,replace:he,go:J,back:()=>J(-1),forward:()=>J(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:ne.add,isReady:se,install(Z){const Ae=this;Z.component("RouterLink",YS),Z.component("RouterView",tP),Z.config.globalProperties.$router=Ae,Object.defineProperty(Z.config.globalProperties,"$route",{enumerable:!0,get:()=>is(l)}),Aa&&!Ee&&l.value===ai&&(Ee=!0,z(s.location).catch(We=>{}));const we={};for(const We in ai)Object.defineProperty(we,We,{get:()=>l.value[We],enumerable:!0});Z.provide(yh,Ae),Z.provide(vm,G_(we)),Z.provide(pp,l);const De=Z.unmount;Ge.add(Z),Z.unmount=function(){Ge.delete(Z),Ge.size<1&&(c=ai,R&&R(),R=null,l.value=ai,Ee=!1,F=!1),De()}}};function It(Z){return Z.reduce((Ae,we)=>Ae.then(()=>E(we)),Promise.resolve())}return pt}function rP(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(c=>Ka(c,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>Ka(c,l))||s.push(l))}return[t,r,s]}function dl(){return Ur(yh)}function hl(n){return Ur(vm)}const sP="modulepreload",iP=function(n){return"/"+n},_y={},tn=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=iP(i),i in _y)return;_y[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const f=s[h];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":sP,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((h,f)=>{c.addEventListener("load",h),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};function oP(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:r,onRegistered:s,onRegisteredSW:i,onRegisterError:o}=n;let a,l;const c=async(f=!0)=>{await l};async function h(){if("serviceWorker"in navigator){const{Workbox:f}=await tn(()=>import("./workbox-window.prod.es5-5ffdab76.js"),[]);a=new f("/service-worker.js",{scope:"/",type:"classic"}),a.addEventListener("activated",g=>{(g.isUpdate||g.isExternal)&&window.location.reload()}),a.addEventListener("installed",g=>{g.isUpdate||r==null||r()}),a.register({immediate:e}).then(g=>{i?i("/service-worker.js",g):s==null||s(g)}).catch(g=>{o==null||o(g)})}}return l=h(),c}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kb=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},aP=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},Gb={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let g=(a&15)<<2|c>>6,y=c&63;l||(y=64,o||(g=64)),r.push(t[h],t[f],t[g],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Kb(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):aP(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||f==null)throw new lP;const g=i<<2|a>>4;if(r.push(g),c!==64){const y=a<<4&240|c>>2;if(r.push(y),f!==64){const I=c<<6&192|f;r.push(I)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class lP extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const uP=function(n){const e=Kb(n);return Gb.encodeByteArray(e,!0)},Od=function(n){return uP(n).replace(/\./g,"")},Hb=function(n){try{return Gb.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cP(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dP=()=>cP().__FIREBASE_DEFAULTS__,hP=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},fP=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Hb(n[1]);return e&&JSON.parse(e)},_h=()=>{try{return dP()||hP()||fP()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Wb=n=>{var e,t;return(t=(e=_h())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},pP=n=>{const e=Wb(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Qb=()=>{var n;return(n=_h())===null||n===void 0?void 0:n.config},Jb=n=>{var e;return(e=_h())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mP{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gP(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[Od(JSON.stringify(t)),Od(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function vP(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(wn())}function yP(){var n;const e=(n=_h())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function _P(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function bP(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function wP(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function xP(){const n=wn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Yb(){return!yP()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ym(){try{return typeof indexedDB=="object"}catch{return!1}}function Xb(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}function IP(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EP="FirebaseError";class fs extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=EP,Object.setPrototypeOf(this,fs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Xo.prototype.create)}}class Xo{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?TP(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new fs(s,a,r)}}function TP(n,e){return n.replace(AP,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const AP=/\{\$([^}]+)}/g;function SP(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function ki(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(by(i)&&by(o)){if(!ki(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function by(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fl(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function nu(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function ru(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function PP(n,e){const t=new RP(n,e);return t.subscribe.bind(t)}class RP{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");CP(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Df),s.error===void 0&&(s.error=Df),s.complete===void 0&&(s.complete=Df);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function CP(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Df(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Le(n){return n&&n._delegate?n._delegate:n}class qr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Io="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kP{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new mP;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(NP(e))try{this.getOrInitializeService({instanceIdentifier:Io})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Io){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Io){return this.instances.has(e)}getOptions(e=Io){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:DP(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Io){return this.component?this.component.multipleInstances?e:Io:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function DP(n){return n===Io?void 0:n}function NP(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VP{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new kP(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var st;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(st||(st={}));const OP={debug:st.DEBUG,verbose:st.VERBOSE,info:st.INFO,warn:st.WARN,error:st.ERROR,silent:st.SILENT},MP=st.INFO,LP={[st.DEBUG]:"log",[st.VERBOSE]:"log",[st.INFO]:"info",[st.WARN]:"warn",[st.ERROR]:"error"},$P=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=LP[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class _m{constructor(e){this.name=e,this._logLevel=MP,this._logHandler=$P,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in st))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?OP[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,st.DEBUG,...e),this._logHandler(this,st.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,st.VERBOSE,...e),this._logHandler(this,st.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,st.INFO,...e),this._logHandler(this,st.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,st.WARN,...e),this._logHandler(this,st.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,st.ERROR,...e),this._logHandler(this,st.ERROR,...e)}}const FP=(n,e)=>e.some(t=>n instanceof t);let wy,xy;function UP(){return wy||(wy=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function jP(){return xy||(xy=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Zb=new WeakMap,mp=new WeakMap,ew=new WeakMap,Nf=new WeakMap,bm=new WeakMap;function qP(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Ns(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Zb.set(t,n)}).catch(()=>{}),bm.set(e,n),e}function BP(n){if(mp.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});mp.set(n,e)}let gp={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return mp.get(n);if(e==="objectStoreNames")return n.objectStoreNames||ew.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ns(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function zP(n){gp=n(gp)}function KP(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Vf(this),e,...t);return ew.set(r,e.sort?e.sort():[e]),Ns(r)}:jP().includes(n)?function(...e){return n.apply(Vf(this),e),Ns(Zb.get(this))}:function(...e){return Ns(n.apply(Vf(this),e))}}function GP(n){return typeof n=="function"?KP(n):(n instanceof IDBTransaction&&BP(n),FP(n,UP())?new Proxy(n,gp):n)}function Ns(n){if(n instanceof IDBRequest)return qP(n);if(Nf.has(n))return Nf.get(n);const e=GP(n);return e!==n&&(Nf.set(n,e),bm.set(e,n)),e}const Vf=n=>bm.get(n);function bh(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=Ns(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Ns(o.result),l.oldVersion,l.newVersion,Ns(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function Of(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),Ns(t).then(()=>{})}const HP=["get","getKey","getAll","getAllKeys","count"],WP=["put","add","delete","clear"],Mf=new Map;function Iy(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Mf.get(e))return Mf.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=WP.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||HP.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return Mf.set(e,i),i}zP(n=>({...n,get:(e,t,r)=>Iy(e,t)||n.get(e,t,r),has:(e,t)=>!!Iy(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QP{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(JP(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function JP(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const vp="@firebase/app",Ey="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ls=new _m("@firebase/app"),YP="@firebase/app-compat",XP="@firebase/analytics-compat",ZP="@firebase/analytics",eR="@firebase/app-check-compat",tR="@firebase/app-check",nR="@firebase/auth",rR="@firebase/auth-compat",sR="@firebase/database",iR="@firebase/data-connect",oR="@firebase/database-compat",aR="@firebase/functions",lR="@firebase/functions-compat",uR="@firebase/installations",cR="@firebase/installations-compat",dR="@firebase/messaging",hR="@firebase/messaging-compat",fR="@firebase/performance",pR="@firebase/performance-compat",mR="@firebase/remote-config",gR="@firebase/remote-config-compat",vR="@firebase/storage",yR="@firebase/storage-compat",_R="@firebase/firestore",bR="@firebase/vertexai-preview",wR="@firebase/firestore-compat",xR="firebase",IR="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Md="[DEFAULT]",ER={[vp]:"fire-core",[YP]:"fire-core-compat",[ZP]:"fire-analytics",[XP]:"fire-analytics-compat",[tR]:"fire-app-check",[eR]:"fire-app-check-compat",[nR]:"fire-auth",[rR]:"fire-auth-compat",[sR]:"fire-rtdb",[iR]:"fire-data-connect",[oR]:"fire-rtdb-compat",[aR]:"fire-fn",[lR]:"fire-fn-compat",[uR]:"fire-iid",[cR]:"fire-iid-compat",[dR]:"fire-fcm",[hR]:"fire-fcm-compat",[fR]:"fire-perf",[pR]:"fire-perf-compat",[mR]:"fire-rc",[gR]:"fire-rc-compat",[vR]:"fire-gcs",[yR]:"fire-gcs-compat",[_R]:"fire-fst",[wR]:"fire-fst-compat",[bR]:"fire-vertex","fire-js":"fire-js",[xR]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ld=new Map,TR=new Map,yp=new Map;function Ty(n,e){try{n.container.addComponent(e)}catch(t){Ls.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function ds(n){const e=n.name;if(yp.has(e))return Ls.debug(`There were multiple attempts to register component ${e}.`),!1;yp.set(e,n);for(const t of Ld.values())Ty(t,n);for(const t of TR.values())Ty(t,n);return!0}function ji(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function AR(n,e,t=Md){ji(n,e).clearInstance(t)}function dn(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SR={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ti=new Xo("app","Firebase",SR);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PR{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new qr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ti.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pl=IR;function tw(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Md,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Ti.create("bad-app-name",{appName:String(s)});if(t||(t=Qb()),!t)throw Ti.create("no-options");const i=Ld.get(s);if(i){if(ki(t,i.options)&&ki(r,i.config))return i;throw Ti.create("duplicate-app",{appName:s})}const o=new VP(s);for(const l of yp.values())o.addComponent(l);const a=new PR(t,r,o);return Ld.set(s,a),a}function wm(n=Md){const e=Ld.get(n);if(!e&&n===Md&&Qb())return tw();if(!e)throw Ti.create("no-app",{appName:n});return e}function Pr(n,e,t){var r;let s=(r=ER[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ls.warn(a.join(" "));return}ds(new qr(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RR="firebase-heartbeat-database",CR=1,Ou="firebase-heartbeat-store";let Lf=null;function nw(){return Lf||(Lf=bh(RR,CR,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Ou)}catch(t){console.warn(t)}}}}).catch(n=>{throw Ti.create("idb-open",{originalErrorMessage:n.message})})),Lf}async function kR(n){try{const t=(await nw()).transaction(Ou),r=await t.objectStore(Ou).get(rw(n));return await t.done,r}catch(e){if(e instanceof fs)Ls.warn(e.message);else{const t=Ti.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Ls.warn(t.message)}}}async function Ay(n,e){try{const r=(await nw()).transaction(Ou,"readwrite");await r.objectStore(Ou).put(e,rw(n)),await r.done}catch(t){if(t instanceof fs)Ls.warn(t.message);else{const r=Ti.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Ls.warn(r.message)}}}function rw(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DR=1024,NR=30*24*60*60*1e3;class VR{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new MR(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Sy();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=NR}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Ls.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Sy(),{heartbeatsToSend:r,unsentEntries:s}=OR(this._heartbeatsCache.heartbeats),i=Od(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Ls.warn(t),""}}}function Sy(){return new Date().toISOString().substring(0,10)}function OR(n,e=DR){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),Py(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Py(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class MR{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ym()?Xb().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await kR(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Ay(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Ay(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Py(n){return Od(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LR(n){ds(new qr("platform-logger",e=>new QP(e),"PRIVATE")),ds(new qr("heartbeat",e=>new VR(e),"PRIVATE")),Pr(vp,Ey,n),Pr(vp,Ey,"esm2017"),Pr("fire-js","")}LR("");var $R="firebase",FR="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Pr($R,FR,"app");var Ry=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Mo,sw;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(T,w){function E(){}E.prototype=w.prototype,T.D=w.prototype,T.prototype=new E,T.prototype.constructor=T,T.C=function(D,L,q){for(var R=Array(arguments.length-2),ft=2;ft<arguments.length;ft++)R[ft-2]=arguments[ft];return w.prototype[L].apply(D,R)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,w,E){E||(E=0);var D=Array(16);if(typeof w=="string")for(var L=0;16>L;++L)D[L]=w.charCodeAt(E++)|w.charCodeAt(E++)<<8|w.charCodeAt(E++)<<16|w.charCodeAt(E++)<<24;else for(L=0;16>L;++L)D[L]=w[E++]|w[E++]<<8|w[E++]<<16|w[E++]<<24;w=T.g[0],E=T.g[1],L=T.g[2];var q=T.g[3],R=w+(q^E&(L^q))+D[0]+3614090360&4294967295;w=E+(R<<7&4294967295|R>>>25),R=q+(L^w&(E^L))+D[1]+3905402710&4294967295,q=w+(R<<12&4294967295|R>>>20),R=L+(E^q&(w^E))+D[2]+606105819&4294967295,L=q+(R<<17&4294967295|R>>>15),R=E+(w^L&(q^w))+D[3]+3250441966&4294967295,E=L+(R<<22&4294967295|R>>>10),R=w+(q^E&(L^q))+D[4]+4118548399&4294967295,w=E+(R<<7&4294967295|R>>>25),R=q+(L^w&(E^L))+D[5]+1200080426&4294967295,q=w+(R<<12&4294967295|R>>>20),R=L+(E^q&(w^E))+D[6]+2821735955&4294967295,L=q+(R<<17&4294967295|R>>>15),R=E+(w^L&(q^w))+D[7]+4249261313&4294967295,E=L+(R<<22&4294967295|R>>>10),R=w+(q^E&(L^q))+D[8]+1770035416&4294967295,w=E+(R<<7&4294967295|R>>>25),R=q+(L^w&(E^L))+D[9]+2336552879&4294967295,q=w+(R<<12&4294967295|R>>>20),R=L+(E^q&(w^E))+D[10]+4294925233&4294967295,L=q+(R<<17&4294967295|R>>>15),R=E+(w^L&(q^w))+D[11]+2304563134&4294967295,E=L+(R<<22&4294967295|R>>>10),R=w+(q^E&(L^q))+D[12]+1804603682&4294967295,w=E+(R<<7&4294967295|R>>>25),R=q+(L^w&(E^L))+D[13]+4254626195&4294967295,q=w+(R<<12&4294967295|R>>>20),R=L+(E^q&(w^E))+D[14]+2792965006&4294967295,L=q+(R<<17&4294967295|R>>>15),R=E+(w^L&(q^w))+D[15]+1236535329&4294967295,E=L+(R<<22&4294967295|R>>>10),R=w+(L^q&(E^L))+D[1]+4129170786&4294967295,w=E+(R<<5&4294967295|R>>>27),R=q+(E^L&(w^E))+D[6]+3225465664&4294967295,q=w+(R<<9&4294967295|R>>>23),R=L+(w^E&(q^w))+D[11]+643717713&4294967295,L=q+(R<<14&4294967295|R>>>18),R=E+(q^w&(L^q))+D[0]+3921069994&4294967295,E=L+(R<<20&4294967295|R>>>12),R=w+(L^q&(E^L))+D[5]+3593408605&4294967295,w=E+(R<<5&4294967295|R>>>27),R=q+(E^L&(w^E))+D[10]+38016083&4294967295,q=w+(R<<9&4294967295|R>>>23),R=L+(w^E&(q^w))+D[15]+3634488961&4294967295,L=q+(R<<14&4294967295|R>>>18),R=E+(q^w&(L^q))+D[4]+3889429448&4294967295,E=L+(R<<20&4294967295|R>>>12),R=w+(L^q&(E^L))+D[9]+568446438&4294967295,w=E+(R<<5&4294967295|R>>>27),R=q+(E^L&(w^E))+D[14]+3275163606&4294967295,q=w+(R<<9&4294967295|R>>>23),R=L+(w^E&(q^w))+D[3]+4107603335&4294967295,L=q+(R<<14&4294967295|R>>>18),R=E+(q^w&(L^q))+D[8]+1163531501&4294967295,E=L+(R<<20&4294967295|R>>>12),R=w+(L^q&(E^L))+D[13]+2850285829&4294967295,w=E+(R<<5&4294967295|R>>>27),R=q+(E^L&(w^E))+D[2]+4243563512&4294967295,q=w+(R<<9&4294967295|R>>>23),R=L+(w^E&(q^w))+D[7]+1735328473&4294967295,L=q+(R<<14&4294967295|R>>>18),R=E+(q^w&(L^q))+D[12]+2368359562&4294967295,E=L+(R<<20&4294967295|R>>>12),R=w+(E^L^q)+D[5]+4294588738&4294967295,w=E+(R<<4&4294967295|R>>>28),R=q+(w^E^L)+D[8]+2272392833&4294967295,q=w+(R<<11&4294967295|R>>>21),R=L+(q^w^E)+D[11]+1839030562&4294967295,L=q+(R<<16&4294967295|R>>>16),R=E+(L^q^w)+D[14]+4259657740&4294967295,E=L+(R<<23&4294967295|R>>>9),R=w+(E^L^q)+D[1]+2763975236&4294967295,w=E+(R<<4&4294967295|R>>>28),R=q+(w^E^L)+D[4]+1272893353&4294967295,q=w+(R<<11&4294967295|R>>>21),R=L+(q^w^E)+D[7]+4139469664&4294967295,L=q+(R<<16&4294967295|R>>>16),R=E+(L^q^w)+D[10]+3200236656&4294967295,E=L+(R<<23&4294967295|R>>>9),R=w+(E^L^q)+D[13]+681279174&4294967295,w=E+(R<<4&4294967295|R>>>28),R=q+(w^E^L)+D[0]+3936430074&4294967295,q=w+(R<<11&4294967295|R>>>21),R=L+(q^w^E)+D[3]+3572445317&4294967295,L=q+(R<<16&4294967295|R>>>16),R=E+(L^q^w)+D[6]+76029189&4294967295,E=L+(R<<23&4294967295|R>>>9),R=w+(E^L^q)+D[9]+3654602809&4294967295,w=E+(R<<4&4294967295|R>>>28),R=q+(w^E^L)+D[12]+3873151461&4294967295,q=w+(R<<11&4294967295|R>>>21),R=L+(q^w^E)+D[15]+530742520&4294967295,L=q+(R<<16&4294967295|R>>>16),R=E+(L^q^w)+D[2]+3299628645&4294967295,E=L+(R<<23&4294967295|R>>>9),R=w+(L^(E|~q))+D[0]+4096336452&4294967295,w=E+(R<<6&4294967295|R>>>26),R=q+(E^(w|~L))+D[7]+1126891415&4294967295,q=w+(R<<10&4294967295|R>>>22),R=L+(w^(q|~E))+D[14]+2878612391&4294967295,L=q+(R<<15&4294967295|R>>>17),R=E+(q^(L|~w))+D[5]+4237533241&4294967295,E=L+(R<<21&4294967295|R>>>11),R=w+(L^(E|~q))+D[12]+1700485571&4294967295,w=E+(R<<6&4294967295|R>>>26),R=q+(E^(w|~L))+D[3]+2399980690&4294967295,q=w+(R<<10&4294967295|R>>>22),R=L+(w^(q|~E))+D[10]+4293915773&4294967295,L=q+(R<<15&4294967295|R>>>17),R=E+(q^(L|~w))+D[1]+2240044497&4294967295,E=L+(R<<21&4294967295|R>>>11),R=w+(L^(E|~q))+D[8]+1873313359&4294967295,w=E+(R<<6&4294967295|R>>>26),R=q+(E^(w|~L))+D[15]+4264355552&4294967295,q=w+(R<<10&4294967295|R>>>22),R=L+(w^(q|~E))+D[6]+2734768916&4294967295,L=q+(R<<15&4294967295|R>>>17),R=E+(q^(L|~w))+D[13]+1309151649&4294967295,E=L+(R<<21&4294967295|R>>>11),R=w+(L^(E|~q))+D[4]+4149444226&4294967295,w=E+(R<<6&4294967295|R>>>26),R=q+(E^(w|~L))+D[11]+3174756917&4294967295,q=w+(R<<10&4294967295|R>>>22),R=L+(w^(q|~E))+D[2]+718787259&4294967295,L=q+(R<<15&4294967295|R>>>17),R=E+(q^(L|~w))+D[9]+3951481745&4294967295,T.g[0]=T.g[0]+w&4294967295,T.g[1]=T.g[1]+(L+(R<<21&4294967295|R>>>11))&4294967295,T.g[2]=T.g[2]+L&4294967295,T.g[3]=T.g[3]+q&4294967295}r.prototype.u=function(T,w){w===void 0&&(w=T.length);for(var E=w-this.blockSize,D=this.B,L=this.h,q=0;q<w;){if(L==0)for(;q<=E;)s(this,T,q),q+=this.blockSize;if(typeof T=="string"){for(;q<w;)if(D[L++]=T.charCodeAt(q++),L==this.blockSize){s(this,D),L=0;break}}else for(;q<w;)if(D[L++]=T[q++],L==this.blockSize){s(this,D),L=0;break}}this.h=L,this.o+=w},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var w=1;w<T.length-8;++w)T[w]=0;var E=8*this.o;for(w=T.length-8;w<T.length;++w)T[w]=E&255,E/=256;for(this.u(T),T=Array(16),w=E=0;4>w;++w)for(var D=0;32>D;D+=8)T[E++]=this.g[w]>>>D&255;return T};function i(T,w){var E=a;return Object.prototype.hasOwnProperty.call(E,T)?E[T]:E[T]=w(T)}function o(T,w){this.h=w;for(var E=[],D=!0,L=T.length-1;0<=L;L--){var q=T[L]|0;D&&q==w||(E[L]=q,D=!1)}this.g=E}var a={};function l(T){return-128<=T&&128>T?i(T,function(w){return new o([w|0],0>w?-1:0)}):new o([T|0],0>T?-1:0)}function c(T){if(isNaN(T)||!isFinite(T))return f;if(0>T)return P(c(-T));for(var w=[],E=1,D=0;T>=E;D++)w[D]=T/E|0,E*=4294967296;return new o(w,0)}function h(T,w){if(T.length==0)throw Error("number format error: empty string");if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(T.charAt(0)=="-")return P(h(T.substring(1),w));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var E=c(Math.pow(w,8)),D=f,L=0;L<T.length;L+=8){var q=Math.min(8,T.length-L),R=parseInt(T.substring(L,L+q),w);8>q?(q=c(Math.pow(w,q)),D=D.j(q).add(c(R))):(D=D.j(E),D=D.add(c(R)))}return D}var f=l(0),g=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(A(this))return-P(this).m();for(var T=0,w=1,E=0;E<this.g.length;E++){var D=this.i(E);T+=(0<=D?D:4294967296+D)*w,w*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(I(this))return"0";if(A(this))return"-"+P(this).toString(T);for(var w=c(Math.pow(T,6)),E=this,D="";;){var L=z(E,w).g;E=j(E,L.j(w));var q=((0<E.g.length?E.g[0]:E.h)>>>0).toString(T);if(E=L,I(E))return q+D;for(;6>q.length;)q="0"+q;D=q+D}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function I(T){if(T.h!=0)return!1;for(var w=0;w<T.g.length;w++)if(T.g[w]!=0)return!1;return!0}function A(T){return T.h==-1}n.l=function(T){return T=j(this,T),A(T)?-1:I(T)?0:1};function P(T){for(var w=T.g.length,E=[],D=0;D<w;D++)E[D]=~T.g[D];return new o(E,~T.h).add(g)}n.abs=function(){return A(this)?P(this):this},n.add=function(T){for(var w=Math.max(this.g.length,T.g.length),E=[],D=0,L=0;L<=w;L++){var q=D+(this.i(L)&65535)+(T.i(L)&65535),R=(q>>>16)+(this.i(L)>>>16)+(T.i(L)>>>16);D=R>>>16,q&=65535,R&=65535,E[L]=R<<16|q}return new o(E,E[E.length-1]&-2147483648?-1:0)};function j(T,w){return T.add(P(w))}n.j=function(T){if(I(this)||I(T))return f;if(A(this))return A(T)?P(this).j(P(T)):P(P(this).j(T));if(A(T))return P(this.j(P(T)));if(0>this.l(y)&&0>T.l(y))return c(this.m()*T.m());for(var w=this.g.length+T.g.length,E=[],D=0;D<2*w;D++)E[D]=0;for(D=0;D<this.g.length;D++)for(var L=0;L<T.g.length;L++){var q=this.i(D)>>>16,R=this.i(D)&65535,ft=T.i(L)>>>16,Ze=T.i(L)&65535;E[2*D+2*L]+=R*Ze,B(E,2*D+2*L),E[2*D+2*L+1]+=q*Ze,B(E,2*D+2*L+1),E[2*D+2*L+1]+=R*ft,B(E,2*D+2*L+1),E[2*D+2*L+2]+=q*ft,B(E,2*D+2*L+2)}for(D=0;D<w;D++)E[D]=E[2*D+1]<<16|E[2*D];for(D=w;D<2*w;D++)E[D]=0;return new o(E,0)};function B(T,w){for(;(T[w]&65535)!=T[w];)T[w+1]+=T[w]>>>16,T[w]&=65535,w++}function $(T,w){this.g=T,this.h=w}function z(T,w){if(I(w))throw Error("division by zero");if(I(T))return new $(f,f);if(A(T))return w=z(P(T),w),new $(P(w.g),P(w.h));if(A(w))return w=z(T,P(w)),new $(P(w.g),w.h);if(30<T.g.length){if(A(T)||A(w))throw Error("slowDivide_ only works with positive integers.");for(var E=g,D=w;0>=D.l(T);)E=he(E),D=he(D);var L=ve(E,1),q=ve(D,1);for(D=ve(D,2),E=ve(E,2);!I(D);){var R=q.add(D);0>=R.l(T)&&(L=L.add(E),q=R),D=ve(D,1),E=ve(E,1)}return w=j(T,L.j(w)),new $(L,w)}for(L=f;0<=T.l(w);){for(E=Math.max(1,Math.floor(T.m()/w.m())),D=Math.ceil(Math.log(E)/Math.LN2),D=48>=D?1:Math.pow(2,D-48),q=c(E),R=q.j(w);A(R)||0<R.l(T);)E-=D,q=c(E),R=q.j(w);I(q)&&(q=g),L=L.add(q),T=j(T,R)}return new $(L,T)}n.A=function(T){return z(this,T).h},n.and=function(T){for(var w=Math.max(this.g.length,T.g.length),E=[],D=0;D<w;D++)E[D]=this.i(D)&T.i(D);return new o(E,this.h&T.h)},n.or=function(T){for(var w=Math.max(this.g.length,T.g.length),E=[],D=0;D<w;D++)E[D]=this.i(D)|T.i(D);return new o(E,this.h|T.h)},n.xor=function(T){for(var w=Math.max(this.g.length,T.g.length),E=[],D=0;D<w;D++)E[D]=this.i(D)^T.i(D);return new o(E,this.h^T.h)};function he(T){for(var w=T.g.length+1,E=[],D=0;D<w;D++)E[D]=T.i(D)<<1|T.i(D-1)>>>31;return new o(E,T.h)}function ve(T,w){var E=w>>5;w%=32;for(var D=T.g.length-E,L=[],q=0;q<D;q++)L[q]=0<w?T.i(q+E)>>>w|T.i(q+E+1)<<32-w:T.i(q+E);return new o(L,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,sw=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=h,Mo=o}).apply(typeof Ry<"u"?Ry:typeof self<"u"?self:typeof window<"u"?window:{});var Qc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var iw,su,ow,dd,_p,aw,lw,uw;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,p,v){return u==Array.prototype||u==Object.prototype||(u[p]=v.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof Qc=="object"&&Qc];for(var p=0;p<u.length;++p){var v=u[p];if(v&&v.Math==Math)return v}throw Error("Cannot find global object")}var r=t(this);function s(u,p){if(p)e:{var v=r;u=u.split(".");for(var b=0;b<u.length-1;b++){var K=u[b];if(!(K in v))break e;v=v[K]}u=u[u.length-1],b=v[u],p=p(b),p!=b&&p!=null&&e(v,u,{configurable:!0,writable:!0,value:p})}}function i(u,p){u instanceof String&&(u+="");var v=0,b=!1,K={next:function(){if(!b&&v<u.length){var Y=v++;return{value:p(Y,u[Y]),done:!1}}return b=!0,{done:!0,value:void 0}}};return K[Symbol.iterator]=function(){return K},K}s("Array.prototype.values",function(u){return u||function(){return i(this,function(p,v){return v})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var p=typeof u;return p=p!="object"?p:u?Array.isArray(u)?"array":p:"null",p=="array"||p=="object"&&typeof u.length=="number"}function c(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function h(u,p,v){return u.call.apply(u.bind,arguments)}function f(u,p,v){if(!u)throw Error();if(2<arguments.length){var b=Array.prototype.slice.call(arguments,2);return function(){var K=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(K,b),u.apply(p,K)}}return function(){return u.apply(p,arguments)}}function g(u,p,v){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,g.apply(null,arguments)}function y(u,p){var v=Array.prototype.slice.call(arguments,1);return function(){var b=v.slice();return b.push.apply(b,arguments),u.apply(this,b)}}function I(u,p){function v(){}v.prototype=p.prototype,u.aa=p.prototype,u.prototype=new v,u.prototype.constructor=u,u.Qb=function(b,K,Y){for(var Te=Array(arguments.length-2),Tt=2;Tt<arguments.length;Tt++)Te[Tt-2]=arguments[Tt];return p.prototype[K].apply(b,Te)}}function A(u){const p=u.length;if(0<p){const v=Array(p);for(let b=0;b<p;b++)v[b]=u[b];return v}return[]}function P(u,p){for(let v=1;v<arguments.length;v++){const b=arguments[v];if(l(b)){const K=u.length||0,Y=b.length||0;u.length=K+Y;for(let Te=0;Te<Y;Te++)u[K+Te]=b[Te]}else u.push(b)}}class j{constructor(p,v){this.i=p,this.j=v,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function B(u){return/^[\s\xa0]*$/.test(u)}function $(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function z(u){return z[" "](u),u}z[" "]=function(){};var he=$().indexOf("Gecko")!=-1&&!($().toLowerCase().indexOf("webkit")!=-1&&$().indexOf("Edge")==-1)&&!($().indexOf("Trident")!=-1||$().indexOf("MSIE")!=-1)&&$().indexOf("Edge")==-1;function ve(u,p,v){for(const b in u)p.call(v,u[b],b,u)}function T(u,p){for(const v in u)p.call(void 0,u[v],v,u)}function w(u){const p={};for(const v in u)p[v]=u[v];return p}const E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function D(u,p){let v,b;for(let K=1;K<arguments.length;K++){b=arguments[K];for(v in b)u[v]=b[v];for(let Y=0;Y<E.length;Y++)v=E[Y],Object.prototype.hasOwnProperty.call(b,v)&&(u[v]=b[v])}}function L(u){var p=1;u=u.split(":");const v=[];for(;0<p&&u.length;)v.push(u.shift()),p--;return u.length&&v.push(u.join(":")),v}function q(u){a.setTimeout(()=>{throw u},0)}function R(){var u=se;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class ft{constructor(){this.h=this.g=null}add(p,v){const b=Ze.get();b.set(p,v),this.h?this.h.next=b:this.g=b,this.h=b}}var Ze=new j(()=>new ne,u=>u.reset());class ne{constructor(){this.next=this.g=this.h=null}set(p,v){this.h=p,this.g=v,this.next=null}reset(){this.next=this.g=this.h=null}}let F,W=!1,se=new ft,Pe=()=>{const u=a.Promise.resolve(void 0);F=()=>{u.then(te)}};var te=()=>{for(var u;u=R();){try{u.h.call(u.g)}catch(v){q(v)}var p=Ze;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}W=!1};function J(){this.s=this.s,this.C=this.C}J.prototype.s=!1,J.prototype.ma=function(){this.s||(this.s=!0,this.N())},J.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ee(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}Ee.prototype.h=function(){this.defaultPrevented=!0};var Ge=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const v=()=>{};a.addEventListener("test",v,p),a.removeEventListener("test",v,p)}catch{}return u}();function pt(u,p){if(Ee.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var v=this.type=u.type,b=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(he){e:{try{z(p.nodeName);var K=!0;break e}catch{}K=!1}K||(p=null)}}else v=="mouseover"?p=u.fromElement:v=="mouseout"&&(p=u.toElement);this.relatedTarget=p,b?(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:It[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&pt.aa.h.call(this)}}I(pt,Ee);var It={2:"touch",3:"pen",4:"mouse"};pt.prototype.h=function(){pt.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var Z="closure_listenable_"+(1e6*Math.random()|0),Ae=0;function we(u,p,v,b,K){this.listener=u,this.proxy=null,this.src=p,this.type=v,this.capture=!!b,this.ha=K,this.key=++Ae,this.da=this.fa=!1}function De(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function We(u){this.src=u,this.g={},this.h=0}We.prototype.add=function(u,p,v,b,K){var Y=u.toString();u=this.g[Y],u||(u=this.g[Y]=[],this.h++);var Te=x(u,p,b,K);return-1<Te?(p=u[Te],v||(p.fa=!1)):(p=new we(p,this.src,Y,!!b,K),p.fa=v,u.push(p)),p};function at(u,p){var v=p.type;if(v in u.g){var b=u.g[v],K=Array.prototype.indexOf.call(b,p,void 0),Y;(Y=0<=K)&&Array.prototype.splice.call(b,K,1),Y&&(De(p),u.g[v].length==0&&(delete u.g[v],u.h--))}}function x(u,p,v,b){for(var K=0;K<u.length;++K){var Y=u[K];if(!Y.da&&Y.listener==p&&Y.capture==!!v&&Y.ha==b)return K}return-1}var C="closure_lm_"+(1e6*Math.random()|0),M={};function ue(u,p,v,b,K){if(b&&b.once)return be(u,p,v,b,K);if(Array.isArray(p)){for(var Y=0;Y<p.length;Y++)ue(u,p[Y],v,b,K);return null}return v=Oe(v),u&&u[Z]?u.K(p,v,c(b)?!!b.capture:!!b,K):re(u,p,v,!1,b,K)}function re(u,p,v,b,K,Y){if(!p)throw Error("Invalid event type");var Te=c(K)?!!K.capture:!!K,Tt=fe(u);if(Tt||(u[C]=Tt=new We(u)),v=Tt.add(p,v,b,Te,Y),v.proxy)return v;if(b=ae(),v.proxy=b,b.src=u,b.listener=v,u.addEventListener)Ge||(K=Te),K===void 0&&(K=!1),u.addEventListener(p.toString(),b,K);else if(u.attachEvent)u.attachEvent(Q(p.toString()),b);else if(u.addListener&&u.removeListener)u.addListener(b);else throw Error("addEventListener and attachEvent are unavailable.");return v}function ae(){function u(v){return p.call(u.src,u.listener,v)}const p=ce;return u}function be(u,p,v,b,K){if(Array.isArray(p)){for(var Y=0;Y<p.length;Y++)be(u,p[Y],v,b,K);return null}return v=Oe(v),u&&u[Z]?u.L(p,v,c(b)?!!b.capture:!!b,K):re(u,p,v,!0,b,K)}function U(u,p,v,b,K){if(Array.isArray(p))for(var Y=0;Y<p.length;Y++)U(u,p[Y],v,b,K);else b=c(b)?!!b.capture:!!b,v=Oe(v),u&&u[Z]?(u=u.i,p=String(p).toString(),p in u.g&&(Y=u.g[p],v=x(Y,v,b,K),-1<v&&(De(Y[v]),Array.prototype.splice.call(Y,v,1),Y.length==0&&(delete u.g[p],u.h--)))):u&&(u=fe(u))&&(p=u.g[p.toString()],u=-1,p&&(u=x(p,v,b,K)),(v=-1<u?p[u]:null)&&O(v))}function O(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[Z])at(p.i,u);else{var v=u.type,b=u.proxy;p.removeEventListener?p.removeEventListener(v,b,u.capture):p.detachEvent?p.detachEvent(Q(v),b):p.addListener&&p.removeListener&&p.removeListener(b),(v=fe(p))?(at(v,u),v.h==0&&(v.src=null,p[C]=null)):De(u)}}}function Q(u){return u in M?M[u]:M[u]="on"+u}function ce(u,p){if(u.da)u=!0;else{p=new pt(p,this);var v=u.listener,b=u.ha||u.src;u.fa&&O(u),u=v.call(b,p)}return u}function fe(u){return u=u[C],u instanceof We?u:null}var xe="__closure_events_fn_"+(1e9*Math.random()>>>0);function Oe(u){return typeof u=="function"?u:(u[xe]||(u[xe]=function(p){return u.handleEvent(p)}),u[xe])}function ke(){J.call(this),this.i=new We(this),this.M=this,this.F=null}I(ke,J),ke.prototype[Z]=!0,ke.prototype.removeEventListener=function(u,p,v,b){U(this,u,p,v,b)};function Be(u,p){var v,b=u.F;if(b)for(v=[];b;b=b.F)v.push(b);if(u=u.M,b=p.type||p,typeof p=="string")p=new Ee(p,u);else if(p instanceof Ee)p.target=p.target||u;else{var K=p;p=new Ee(b,u),D(p,K)}if(K=!0,v)for(var Y=v.length-1;0<=Y;Y--){var Te=p.g=v[Y];K=et(Te,b,!0,p)&&K}if(Te=p.g=u,K=et(Te,b,!0,p)&&K,K=et(Te,b,!1,p)&&K,v)for(Y=0;Y<v.length;Y++)Te=p.g=v[Y],K=et(Te,b,!1,p)&&K}ke.prototype.N=function(){if(ke.aa.N.call(this),this.i){var u=this.i,p;for(p in u.g){for(var v=u.g[p],b=0;b<v.length;b++)De(v[b]);delete u.g[p],u.h--}}this.F=null},ke.prototype.K=function(u,p,v,b){return this.i.add(String(u),p,!1,v,b)},ke.prototype.L=function(u,p,v,b){return this.i.add(String(u),p,!0,v,b)};function et(u,p,v,b){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();for(var K=!0,Y=0;Y<p.length;++Y){var Te=p[Y];if(Te&&!Te.da&&Te.capture==v){var Tt=Te.listener,_n=Te.ha||Te.src;Te.fa&&at(u.i,Te),K=Tt.call(_n,b)!==!1&&K}}return K&&!b.defaultPrevented}function on(u,p,v){if(typeof u=="function")v&&(u=g(u,v));else if(u&&typeof u.handleEvent=="function")u=g(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(u,p||0)}function jt(u){u.g=on(()=>{u.g=null,u.i&&(u.i=!1,jt(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class qt extends J{constructor(p,v){super(),this.m=p,this.l=v,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:jt(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Rt(u){J.call(this),this.h=u,this.g={}}I(Rt,J);var kn=[];function ur(u){ve(u.g,function(p,v){this.g.hasOwnProperty(v)&&O(p)},u),u.g={}}Rt.prototype.N=function(){Rt.aa.N.call(this),ur(this)},Rt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Dt=a.JSON.stringify,an=a.JSON.parse,ps=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function Xt(){}Xt.prototype.h=null;function Pc(u){return u.h||(u.h=u.i())}function Br(){}var yn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ms(){Ee.call(this,"d")}I(ms,Ee);function Wi(){Ee.call(this,"c")}I(Wi,Ee);var br={},Qi=null;function gs(){return Qi=Qi||new ke}br.La="serverreachability";function Ji(u){Ee.call(this,br.La,u)}I(Ji,Ee);function Dr(u){const p=gs();Be(p,new Ji(p))}br.STAT_EVENT="statevent";function ia(u,p){Ee.call(this,br.STAT_EVENT,u),this.stat=p}I(ia,Ee);function mn(u){const p=gs();Be(p,new ia(p,u))}br.Ma="timingevent";function kl(u,p){Ee.call(this,br.Ma,u),this.size=p}I(kl,Ee);function vs(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},p)}function Js(){this.g=!0}Js.prototype.xa=function(){this.g=!1};function of(u,p,v,b,K,Y){u.info(function(){if(u.g)if(Y)for(var Te="",Tt=Y.split("&"),_n=0;_n<Tt.length;_n++){var ut=Tt[_n].split("=");if(1<ut.length){var Tn=ut[0];ut=ut[1];var bn=Tn.split("_");Te=2<=bn.length&&bn[1]=="type"?Te+(Tn+"="+ut+"&"):Te+(Tn+"=redacted&")}}else Te=null;else Te=Y;return"XMLHTTP REQ ("+b+") [attempt "+K+"]: "+p+`
`+v+`
`+Te})}function af(u,p,v,b,K,Y,Te){u.info(function(){return"XMLHTTP RESP ("+b+") [ attempt "+K+"]: "+p+`
`+v+`
`+Y+" "+Te})}function Ys(u,p,v,b){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+uf(u,v)+(b?" "+b:"")})}function lf(u,p){u.info(function(){return"TIMEOUT: "+p})}Js.prototype.info=function(){};function uf(u,p){if(!u.g)return p;if(!p)return null;try{var v=JSON.parse(p);if(v){for(u=0;u<v.length;u++)if(Array.isArray(v[u])){var b=v[u];if(!(2>b.length)){var K=b[1];if(Array.isArray(K)&&!(1>K.length)){var Y=K[0];if(Y!="noop"&&Y!="stop"&&Y!="close")for(var Te=1;Te<K.length;Te++)K[Te]=""}}}}return Dt(v)}catch{return p}}var cr={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},zr={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},wr;function Nr(){}I(Nr,Xt),Nr.prototype.g=function(){return new XMLHttpRequest},Nr.prototype.i=function(){return{}},wr=new Nr;function Dn(u,p,v,b){this.j=u,this.i=p,this.l=v,this.R=b||1,this.U=new Rt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Dl}function Dl(){this.i=null,this.g="",this.h=!1}var Yi={},ys={};function Nl(u,p,v){u.L=1,u.v=to(Ir(p)),u.m=v,u.P=!0,dr(u,null)}function dr(u,p){u.F=Date.now(),Xs(u),u.A=Ir(u.v);var v=u.A,b=u.R;Array.isArray(b)||(b=[String(b)]),Oc(v.i,"t",b),u.C=0,v=u.j.J,u.h=new Dl,u.g=qc(u.j,v?p:null,!u.m),0<u.O&&(u.M=new qt(g(u.Y,u,u.g),u.O)),p=u.U,v=u.g,b=u.ca;var K="readystatechange";Array.isArray(K)||(K&&(kn[0]=K.toString()),K=kn);for(var Y=0;Y<K.length;Y++){var Te=ue(v,K[Y],b||p.handleEvent,!1,p.h||p);if(!Te)break;p.g[Te.key]=Te}p=u.H?w(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),Dr(),of(u.i,u.u,u.A,u.l,u.R,u.m)}Dn.prototype.ca=function(u){u=u.target;const p=this.M;p&&Mr(u)==3?p.j():this.Y(u)},Dn.prototype.Y=function(u){try{if(u==this.g)e:{const bn=Mr(this.g);var p=this.g.Ba();const ii=this.g.Z();if(!(3>bn)&&(bn!=3||this.g&&(this.h.h||this.g.oa()||bs(this.g)))){this.J||bn!=4||p==7||(p==8||0>=ii?Dr(3):Dr(2)),Nn(this);var v=this.g.Z();this.X=v;t:if(Vl(this)){var b=bs(this.g);u="";var K=b.length,Y=Mr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){In(this),Kr(this);var Te="";break t}this.h.i=new a.TextDecoder}for(p=0;p<K;p++)this.h.h=!0,u+=this.h.i.decode(b[p],{stream:!(Y&&p==K-1)});b.length=0,this.h.g+=u,this.C=0,Te=this.h.g}else Te=this.g.oa();if(this.o=v==200,af(this.i,this.u,this.A,this.l,this.R,bn,v),this.o){if(this.T&&!this.K){t:{if(this.g){var Tt,_n=this.g;if((Tt=_n.g?_n.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(Tt)){var ut=Tt;break t}}ut=null}if(v=ut)Ys(this.i,this.l,v,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,oa(this,v);else{this.o=!1,this.s=3,mn(12),In(this),Kr(this);break e}}if(this.P){v=!0;let pr;for(;!this.J&&this.C<Te.length;)if(pr=Rc(this,Te),pr==ys){bn==4&&(this.s=4,mn(14),v=!1),Ys(this.i,this.l,null,"[Incomplete Response]");break}else if(pr==Yi){this.s=4,mn(15),Ys(this.i,this.l,Te,"[Invalid Chunk]"),v=!1;break}else Ys(this.i,this.l,pr,null),oa(this,pr);if(Vl(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),bn!=4||Te.length!=0||this.h.h||(this.s=1,mn(16),v=!1),this.o=this.o&&v,!v)Ys(this.i,this.l,Te,"[Invalid Chunked Response]"),In(this),Kr(this);else if(0<Te.length&&!this.W){this.W=!0;var Tn=this.j;Tn.g==this&&Tn.ba&&!Tn.M&&(Tn.j.info("Great, no buffering proxy detected. Bytes received: "+Te.length),uo(Tn),Tn.M=!0,mn(11))}}else Ys(this.i,this.l,Te,null),oa(this,Te);bn==4&&In(this),this.o&&!this.J&&(bn==4?ws(this.j,this):(this.o=!1,Xs(this)))}else fr(this.g),v==400&&0<Te.indexOf("Unknown SID")?(this.s=3,mn(12)):(this.s=0,mn(13)),In(this),Kr(this)}}}catch{}finally{}};function Vl(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function Rc(u,p){var v=u.C,b=p.indexOf(`
`,v);return b==-1?ys:(v=Number(p.substring(v,b)),isNaN(v)?Yi:(b+=1,b+v>p.length?ys:(p=p.slice(b,b+v),u.C=b+v,p)))}Dn.prototype.cancel=function(){this.J=!0,In(this)};function Xs(u){u.S=Date.now()+u.I,Cc(u,u.I)}function Cc(u,p){if(u.B!=null)throw Error("WatchDog timer not null");u.B=vs(g(u.ba,u),p)}function Nn(u){u.B&&(a.clearTimeout(u.B),u.B=null)}Dn.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(lf(this.i,this.A),this.L!=2&&(Dr(),mn(17)),In(this),this.s=2,Kr(this)):Cc(this,this.S-u)};function Kr(u){u.j.G==0||u.J||ws(u.j,u)}function In(u){Nn(u);var p=u.M;p&&typeof p.ma=="function"&&p.ma(),u.M=null,ur(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function oa(u,p){try{var v=u.j;if(v.G!=0&&(v.g==u||Gr(v.h,u))){if(!u.K&&Gr(v.h,u)&&v.G==3){try{var b=v.Da.g.parse(p)}catch{b=null}if(Array.isArray(b)&&b.length==3){var K=b;if(K[0]==0){e:if(!v.u){if(v.g)if(v.g.F+3e3<u.F)co(v),ha(v);else break e;ma(v),mn(18)}}else v.za=K[1],0<v.za-v.T&&37500>K[2]&&v.F&&v.v==0&&!v.C&&(v.C=vs(g(v.Za,v),6e3));if(1>=Xi(v.h)&&v.ca){try{v.ca()}catch{}v.ca=void 0}}else Tr(v,11)}else if((u.K||v.g==u)&&co(v),!B(p))for(K=v.Da.g.parse(p),p=0;p<K.length;p++){let ut=K[p];if(v.T=ut[0],ut=ut[1],v.G==2)if(ut[0]=="c"){v.K=ut[1],v.ia=ut[2];const Tn=ut[3];Tn!=null&&(v.la=Tn,v.j.info("VER="+v.la));const bn=ut[4];bn!=null&&(v.Aa=bn,v.j.info("SVER="+v.Aa));const ii=ut[5];ii!=null&&typeof ii=="number"&&0<ii&&(b=1.5*ii,v.L=b,v.j.info("backChannelRequestTimeoutMs_="+b)),b=v;const pr=u.g;if(pr){const va=pr.g?pr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(va){var Y=b.h;Y.g||va.indexOf("spdy")==-1&&va.indexOf("quic")==-1&&va.indexOf("h2")==-1||(Y.j=Y.l,Y.g=new Set,Y.h&&(aa(Y,Y.h),Y.h=null))}if(b.D){const ql=pr.g?pr.g.getResponseHeader("X-HTTP-Session-Id"):null;ql&&(b.ya=ql,Et(b.I,b.D,ql))}}v.G=3,v.l&&v.l.ua(),v.ba&&(v.R=Date.now()-u.F,v.j.info("Handshake RTT: "+v.R+"ms")),b=v;var Te=u;if(b.qa=jl(b,b.J?b.ia:null,b.W),Te.K){Zi(b.h,Te);var Tt=Te,_n=b.L;_n&&(Tt.I=_n),Tt.B&&(Nn(Tt),Xs(Tt)),b.g=Te}else Uc(b);0<v.i.length&&lo(v)}else ut[0]!="stop"&&ut[0]!="close"||Tr(v,7);else v.G==3&&(ut[0]=="stop"||ut[0]=="close"?ut[0]=="stop"?Tr(v,7):Ul(v):ut[0]!="noop"&&v.l&&v.l.ta(ut),v.v=0)}}Dr(4)}catch{}}var kc=class{constructor(u,p){this.g=u,this.map=p}};function Zs(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ei(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function Xi(u){return u.h?1:u.g?u.g.size:0}function Gr(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function aa(u,p){u.g?u.g.add(p):u.h=p}function Zi(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}Zs.prototype.cancel=function(){if(this.i=xr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function xr(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const v of u.g.values())p=p.concat(v.D);return p}return A(u.i)}function cf(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var p=[],v=u.length,b=0;b<v;b++)p.push(u[b]);return p}p=[],v=0;for(b in u)p[v++]=u[b];return p}function df(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var p=[];u=u.length;for(var v=0;v<u;v++)p.push(v);return p}p=[],v=0;for(const b in u)p[v++]=b;return p}}}function Dc(u,p){if(u.forEach&&typeof u.forEach=="function")u.forEach(p,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,p,void 0);else for(var v=df(u),b=cf(u),K=b.length,Y=0;Y<K;Y++)p.call(void 0,b[Y],v&&v[Y],u)}var Ol=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Hr(u,p){if(u){u=u.split("&");for(var v=0;v<u.length;v++){var b=u[v].indexOf("="),K=null;if(0<=b){var Y=u[v].substring(0,b);K=u[v].substring(b+1)}else Y=u[v];p(Y,K?decodeURIComponent(K.replace(/\+/g," ")):"")}}}function Vr(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof Vr){this.h=u.h,eo(this,u.j),this.o=u.o,this.g=u.g,ti(this,u.s),this.l=u.l;var p=u.i,v=new Er;v.i=p.i,p.g&&(v.g=new Map(p.g),v.h=p.h),Nc(this,v),this.m=u.m}else u&&(p=String(u).match(Ol))?(this.h=!1,eo(this,p[1]||"",!0),this.o=ni(p[2]||""),this.g=ni(p[3]||"",!0),ti(this,p[4]),this.l=ni(p[5]||"",!0),Nc(this,p[6]||"",!0),this.m=ni(p[7]||"")):(this.h=!1,this.i=new Er(null,this.h))}Vr.prototype.toString=function(){var u=[],p=this.j;p&&u.push(Wr(p,no,!0),":");var v=this.g;return(v||p=="file")&&(u.push("//"),(p=this.o)&&u.push(Wr(p,no,!0),"@"),u.push(encodeURIComponent(String(v)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),v=this.s,v!=null&&u.push(":",String(v))),(v=this.l)&&(this.g&&v.charAt(0)!="/"&&u.push("/"),u.push(Wr(v,v.charAt(0)=="/"?$e:Ml,!0))),(v=this.i.toString())&&u.push("?",v),(v=this.m)&&u.push("#",Wr(v,hr)),u.join("")};function Ir(u){return new Vr(u)}function eo(u,p,v){u.j=v?ni(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function ti(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function Nc(u,p,v){p instanceof Er?(u.i=p,hf(u.i,u.h)):(v||(p=Wr(p,lt)),u.i=new Er(p,u.h))}function Et(u,p,v){u.i.set(p,v)}function to(u){return Et(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function ni(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function Wr(u,p,v){return typeof u=="string"?(u=encodeURI(u).replace(p,la),v&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function la(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var no=/[#\/\?@]/g,Ml=/[#\?:]/g,$e=/[#\?]/g,lt=/[#\?@]/g,hr=/#/g;function Er(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function Qr(u){u.g||(u.g=new Map,u.h=0,u.i&&Hr(u.i,function(p,v){u.add(decodeURIComponent(p.replace(/\+/g," ")),v)}))}n=Er.prototype,n.add=function(u,p){Qr(this),this.i=null,u=Jr(this,u);var v=this.g.get(u);return v||this.g.set(u,v=[]),v.push(p),this.h+=1,this};function Ll(u,p){Qr(u),p=Jr(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function Vc(u,p){return Qr(u),p=Jr(u,p),u.g.has(p)}n.forEach=function(u,p){Qr(this),this.g.forEach(function(v,b){v.forEach(function(K){u.call(p,K,b,this)},this)},this)},n.na=function(){Qr(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),v=[];for(let b=0;b<p.length;b++){const K=u[b];for(let Y=0;Y<K.length;Y++)v.push(p[b])}return v},n.V=function(u){Qr(this);let p=[];if(typeof u=="string")Vc(this,u)&&(p=p.concat(this.g.get(Jr(this,u))));else{u=Array.from(this.g.values());for(let v=0;v<u.length;v++)p=p.concat(u[v])}return p},n.set=function(u,p){return Qr(this),this.i=null,u=Jr(this,u),Vc(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},n.get=function(u,p){return u?(u=this.V(u),0<u.length?String(u[0]):p):p};function Oc(u,p,v){Ll(u,p),0<v.length&&(u.i=null,u.g.set(Jr(u,p),A(v)),u.h+=v.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var v=0;v<p.length;v++){var b=p[v];const Y=encodeURIComponent(String(b)),Te=this.V(b);for(b=0;b<Te.length;b++){var K=Y;Te[b]!==""&&(K+="="+encodeURIComponent(String(Te[b]))),u.push(K)}}return this.i=u.join("&")};function Jr(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function hf(u,p){p&&!u.j&&(Qr(u),u.i=null,u.g.forEach(function(v,b){var K=b.toLowerCase();b!=K&&(Ll(this,b),Oc(this,K,v))},u)),u.j=p}function ro(u,p){const v=new Js;if(a.Image){const b=new Image;b.onload=y(Yn,v,"TestLoadImage: loaded",!0,p,b),b.onerror=y(Yn,v,"TestLoadImage: error",!1,p,b),b.onabort=y(Yn,v,"TestLoadImage: abort",!1,p,b),b.ontimeout=y(Yn,v,"TestLoadImage: timeout",!1,p,b),a.setTimeout(function(){b.ontimeout&&b.ontimeout()},1e4),b.src=u}else p(!1)}function ua(u,p){const v=new Js,b=new AbortController,K=setTimeout(()=>{b.abort(),Yn(v,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:b.signal}).then(Y=>{clearTimeout(K),Y.ok?Yn(v,"TestPingServer: ok",!0,p):Yn(v,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(K),Yn(v,"TestPingServer: error",!1,p)})}function Yn(u,p,v,b,K){try{K&&(K.onload=null,K.onerror=null,K.onabort=null,K.ontimeout=null),b(v)}catch{}}function ri(){this.g=new ps}function so(u,p,v){const b=v||"";try{Dc(u,function(K,Y){let Te=K;c(K)&&(Te=Dt(K)),p.push(b+Y+"="+encodeURIComponent(Te))})}catch(K){throw p.push(b+"type="+encodeURIComponent("_badmap")),K}}function Yr(u){this.l=u.Ub||null,this.j=u.eb||!1}I(Yr,Xt),Yr.prototype.g=function(){return new _s(this.l,this.j)},Yr.prototype.i=function(u){return function(){return u}}({});function _s(u,p){ke.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}I(_s,ke),n=_s.prototype,n.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,oo(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,io(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,oo(this)),this.g&&(this.readyState=3,oo(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Mc(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function Mc(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?io(this):oo(this),this.readyState==3&&Mc(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,io(this))},n.Qa=function(u){this.g&&(this.response=u,io(this))},n.ga=function(){this.g&&io(this)};function io(u){u.readyState=4,u.l=null,u.j=null,u.v=null,oo(u)}n.setRequestHeader=function(u,p){this.u.append(u,p)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var v=p.next();!v.done;)v=v.value,u.push(v[0]+": "+v[1]),v=p.next();return u.join(`\r
`)};function oo(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(_s.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function $l(u){let p="";return ve(u,function(v,b){p+=b,p+=":",p+=v,p+=`\r
`}),p}function ze(u,p,v){e:{for(b in v){var b=!1;break e}b=!0}b||(v=$l(v),typeof u=="string"?v!=null&&encodeURIComponent(String(v)):Et(u,p,v))}function Fe(u){ke.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}I(Fe,ke);var Zt=/^https?$/i,mt=["POST","PUT"];n=Fe.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,p,v,b){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():wr.g(),this.v=this.o?Pc(this.o):Pc(wr),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(Y){Lc(this,Y);return}if(u=v||"",v=new Map(this.headers),b)if(Object.getPrototypeOf(b)===Object.prototype)for(var K in b)v.set(K,b[K]);else if(typeof b.keys=="function"&&typeof b.get=="function")for(const Y of b.keys())v.set(Y,b.get(Y));else throw Error("Unknown input type for opt_headers: "+String(b));b=Array.from(v.keys()).find(Y=>Y.toLowerCase()=="content-type"),K=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(mt,p,void 0))||b||K||v.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Y,Te]of v)this.g.setRequestHeader(Y,Te);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Xr(this),this.u=!0,this.g.send(u),this.u=!1}catch(Y){Lc(this,Y)}};function Lc(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,ca(u),Or(u)}function ca(u){u.A||(u.A=!0,Be(u,"complete"),Be(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,Be(this,"complete"),Be(this,"abort"),Or(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Or(this,!0)),Fe.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Fl(this):this.bb())},n.bb=function(){Fl(this)};function Fl(u){if(u.h&&typeof o<"u"&&(!u.v[1]||Mr(u)!=4||u.Z()!=2)){if(u.u&&Mr(u)==4)on(u.Ea,0,u);else if(Be(u,"readystatechange"),Mr(u)==4){u.h=!1;try{const Te=u.Z();e:switch(Te){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var v;if(!(v=p)){var b;if(b=Te===0){var K=String(u.D).match(Ol)[1]||null;!K&&a.self&&a.self.location&&(K=a.self.location.protocol.slice(0,-1)),b=!Zt.test(K?K.toLowerCase():"")}v=b}if(v)Be(u,"complete"),Be(u,"success");else{u.m=6;try{var Y=2<Mr(u)?u.g.statusText:""}catch{Y=""}u.l=Y+" ["+u.Z()+"]",ca(u)}}finally{Or(u)}}}}function Or(u,p){if(u.g){Xr(u);const v=u.g,b=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||Be(u,"ready");try{v.onreadystatechange=b}catch{}}}function Xr(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function Mr(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<Mr(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),an(p)}};function bs(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function fr(u){const p={};u=(u.g&&2<=Mr(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let b=0;b<u.length;b++){if(B(u[b]))continue;var v=L(u[b]);const K=v[0];if(v=v[1],typeof v!="string")continue;v=v.trim();const Y=p[K]||[];p[K]=Y,Y.push(v)}T(p,function(b){return b.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ao(u,p,v){return v&&v.internalChannelParams&&v.internalChannelParams[u]||p}function da(u){this.Aa=0,this.i=[],this.j=new Js,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ao("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ao("baseRetryDelayMs",5e3,u),this.cb=ao("retryDelaySeedMs",1e4,u),this.Wa=ao("forwardChannelMaxRetries",2,u),this.wa=ao("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new Zs(u&&u.concurrentRequestLimit),this.Da=new ri,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=da.prototype,n.la=8,n.G=1,n.connect=function(u,p,v,b){mn(0),this.W=u,this.H=p||{},v&&b!==void 0&&(this.H.OSID=v,this.H.OAID=b),this.F=this.X,this.I=jl(this,null,this.W),lo(this)};function Ul(u){if($c(u),u.G==3){var p=u.U++,v=Ir(u.I);if(Et(v,"SID",u.K),Et(v,"RID",p),Et(v,"TYPE","terminate"),En(u,v),p=new Dn(u,u.j,p),p.L=2,p.v=to(Ir(v)),v=!1,a.navigator&&a.navigator.sendBeacon)try{v=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!v&&a.Image&&(new Image().src=p.v,v=!0),v||(p.g=qc(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Xs(p)}ho(u)}function ha(u){u.g&&(uo(u),u.g.cancel(),u.g=null)}function $c(u){ha(u),u.u&&(a.clearTimeout(u.u),u.u=null),co(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function lo(u){if(!ei(u.h)&&!u.s){u.s=!0;var p=u.Ga;F||Pe(),W||(F(),W=!0),se.add(p,u),u.B=0}}function fa(u,p){return Xi(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=p.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=vs(g(u.Ga,u,p),ga(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const K=new Dn(this,this.j,u);let Y=this.o;if(this.S&&(Y?(Y=w(Y),D(Y,this.S)):Y=this.S),this.m!==null||this.O||(K.H=Y,Y=null),this.P)e:{for(var p=0,v=0;v<this.i.length;v++){t:{var b=this.i[v];if("__data__"in b.map&&(b=b.map.__data__,typeof b=="string")){b=b.length;break t}b=void 0}if(b===void 0)break;if(p+=b,4096<p){p=v;break e}if(p===4096||v===this.i.length-1){p=v+1;break e}}p=1e3}else p=1e3;p=Fc(this,K,p),v=Ir(this.I),Et(v,"RID",u),Et(v,"CVER",22),this.D&&Et(v,"X-HTTP-Session-Id",this.D),En(this,v),Y&&(this.O?p="headers="+encodeURIComponent(String($l(Y)))+"&"+p:this.m&&ze(v,this.m,Y)),aa(this.h,K),this.Ua&&Et(v,"TYPE","init"),this.P?(Et(v,"$req",p),Et(v,"SID","null"),K.T=!0,Nl(K,v,null)):Nl(K,v,p),this.G=2}}else this.G==3&&(u?pa(this,u):this.i.length==0||ei(this.h)||pa(this))};function pa(u,p){var v;p?v=p.l:v=u.U++;const b=Ir(u.I);Et(b,"SID",u.K),Et(b,"RID",v),Et(b,"AID",u.T),En(u,b),u.m&&u.o&&ze(b,u.m,u.o),v=new Dn(u,u.j,v,u.B+1),u.m===null&&(v.H=u.o),p&&(u.i=p.D.concat(u.i)),p=Fc(u,v,1e3),v.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),aa(u.h,v),Nl(v,b,p)}function En(u,p){u.H&&ve(u.H,function(v,b){Et(p,b,v)}),u.l&&Dc({},function(v,b){Et(p,b,v)})}function Fc(u,p,v){v=Math.min(u.i.length,v);var b=u.l?g(u.l.Na,u.l,u):null;e:{var K=u.i;let Y=-1;for(;;){const Te=["count="+v];Y==-1?0<v?(Y=K[0].g,Te.push("ofs="+Y)):Y=0:Te.push("ofs="+Y);let Tt=!0;for(let _n=0;_n<v;_n++){let ut=K[_n].g;const Tn=K[_n].map;if(ut-=Y,0>ut)Y=Math.max(0,K[_n].g-100),Tt=!1;else try{so(Tn,Te,"req"+ut+"_")}catch{b&&b(Tn)}}if(Tt){b=Te.join("&");break e}}}return u=u.i.splice(0,v),p.D=u,b}function Uc(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;F||Pe(),W||(F(),W=!0),se.add(p,u),u.v=0}}function ma(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=vs(g(u.Fa,u),ga(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,jc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=vs(g(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,mn(10),ha(this),jc(this))};function uo(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function jc(u){u.g=new Dn(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var p=Ir(u.qa);Et(p,"RID","rpc"),Et(p,"SID",u.K),Et(p,"AID",u.T),Et(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&Et(p,"TO",u.ja),Et(p,"TYPE","xmlhttp"),En(u,p),u.m&&u.o&&ze(p,u.m,u.o),u.L&&(u.g.I=u.L);var v=u.g;u=u.ia,v.L=1,v.v=to(Ir(p)),v.m=null,v.P=!0,dr(v,u)}n.Za=function(){this.C!=null&&(this.C=null,ha(this),ma(this),mn(19))};function co(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function ws(u,p){var v=null;if(u.g==p){co(u),uo(u),u.g=null;var b=2}else if(Gr(u.h,p))v=p.D,Zi(u.h,p),b=1;else return;if(u.G!=0){if(p.o)if(b==1){v=p.m?p.m.length:0,p=Date.now()-p.F;var K=u.B;b=gs(),Be(b,new kl(b,v)),lo(u)}else Uc(u);else if(K=p.s,K==3||K==0&&0<p.X||!(b==1&&fa(u,p)||b==2&&ma(u)))switch(v&&0<v.length&&(p=u.h,p.i=p.i.concat(v)),K){case 1:Tr(u,5);break;case 4:Tr(u,10);break;case 3:Tr(u,6);break;default:Tr(u,2)}}}function ga(u,p){let v=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(v*=2),v*p}function Tr(u,p){if(u.j.info("Error code "+p),p==2){var v=g(u.fb,u),b=u.Xa;const K=!b;b=new Vr(b||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||eo(b,"https"),to(b),K?ro(b.toString(),v):ua(b.toString(),v)}else mn(2);u.G=0,u.l&&u.l.sa(p),ho(u),$c(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),mn(2)):(this.j.info("Failed to ping google.com"),mn(1))};function ho(u){if(u.G=0,u.ka=[],u.l){const p=xr(u.h);(p.length!=0||u.i.length!=0)&&(P(u.ka,p),P(u.ka,u.i),u.h.i.length=0,A(u.i),u.i.length=0),u.l.ra()}}function jl(u,p,v){var b=v instanceof Vr?Ir(v):new Vr(v);if(b.g!="")p&&(b.g=p+"."+b.g),ti(b,b.s);else{var K=a.location;b=K.protocol,p=p?p+"."+K.hostname:K.hostname,K=+K.port;var Y=new Vr(null);b&&eo(Y,b),p&&(Y.g=p),K&&ti(Y,K),v&&(Y.l=v),b=Y}return v=u.D,p=u.ya,v&&p&&Et(b,v,p),Et(b,"VER",u.la),En(u,b),b}function qc(u,p,v){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Ca&&!u.pa?new Fe(new Yr({eb:v})):new Fe(u.pa),p.Ha(u.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Bc(){}n=Bc.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function fo(){}fo.prototype.g=function(u,p){return new Vn(u,p)};function Vn(u,p){ke.call(this),this.g=new da(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!B(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!B(p)&&(this.g.D=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new si(this)}I(Vn,ke),Vn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Vn.prototype.close=function(){Ul(this.g)},Vn.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var v={};v.__data__=u,u=v}else this.u&&(v={},v.__data__=Dt(u),u=v);p.i.push(new kc(p.Ya++,u)),p.G==3&&lo(p)},Vn.prototype.N=function(){this.g.l=null,delete this.j,Ul(this.g),delete this.g,Vn.aa.N.call(this)};function po(u){ms.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const v in p){u=v;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}I(po,ms);function mo(){Wi.call(this),this.status=1}I(mo,Wi);function si(u){this.g=u}I(si,Bc),si.prototype.ua=function(){Be(this.g,"a")},si.prototype.ta=function(u){Be(this.g,new po(u))},si.prototype.sa=function(u){Be(this.g,new mo)},si.prototype.ra=function(){Be(this.g,"b")},fo.prototype.createWebChannel=fo.prototype.g,Vn.prototype.send=Vn.prototype.o,Vn.prototype.open=Vn.prototype.m,Vn.prototype.close=Vn.prototype.close,uw=function(){return new fo},lw=function(){return gs()},aw=br,_p={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},cr.NO_ERROR=0,cr.TIMEOUT=8,cr.HTTP_ERROR=6,dd=cr,zr.COMPLETE="complete",ow=zr,Br.EventType=yn,yn.OPEN="a",yn.CLOSE="b",yn.ERROR="c",yn.MESSAGE="d",ke.prototype.listen=ke.prototype.K,su=Br,Fe.prototype.listenOnce=Fe.prototype.L,Fe.prototype.getLastError=Fe.prototype.Ka,Fe.prototype.getLastErrorCode=Fe.prototype.Ba,Fe.prototype.getStatus=Fe.prototype.Z,Fe.prototype.getResponseJson=Fe.prototype.Oa,Fe.prototype.getResponseText=Fe.prototype.oa,Fe.prototype.send=Fe.prototype.ea,Fe.prototype.setWithCredentials=Fe.prototype.Ha,iw=Fe}).apply(typeof Qc<"u"?Qc:typeof self<"u"?self:typeof window<"u"?window:{});const Cy="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Sn.UNAUTHENTICATED=new Sn(null),Sn.GOOGLE_CREDENTIALS=new Sn("google-credentials-uid"),Sn.FIRST_PARTY=new Sn("first-party-uid"),Sn.MOCK_USER=new Sn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ml="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Di=new _m("@firebase/firestore");function Sa(){return Di.logLevel}function qq(n){Di.setLogLevel(n)}function me(n,...e){if(Di.logLevel<=st.DEBUG){const t=e.map(xm);Di.debug(`Firestore (${ml}): ${n}`,...t)}}function cn(n,...e){if(Di.logLevel<=st.ERROR){const t=e.map(xm);Di.error(`Firestore (${ml}): ${n}`,...t)}}function Cr(n,...e){if(Di.logLevel<=st.WARN){const t=e.map(xm);Di.warn(`Firestore (${ml}): ${n}`,...t)}}function xm(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ne(n="Unexpected state"){const e=`FIRESTORE (${ml}) INTERNAL ASSERTION FAILED: `+n;throw cn(e),new Error(e)}function Me(n,e){n||Ne()}function Bq(n,e){n||Ne()}function Se(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ge extends fs{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cw{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class UR{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Sn.UNAUTHENTICATED))}shutdown(){}}class jR{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class qR{constructor(e){this.t=e,this.currentUser=Sn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Me(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new Pn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Pn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{me("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(me("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Pn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(me("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Me(typeof r.accessToken=="string"),new cw(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Me(e===null||typeof e=="string"),new Sn(e)}}class BR{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Sn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class zR{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new BR(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Sn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class dw{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class KR{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Me(this.o===void 0);const r=i=>{i.error!=null&&me("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,me("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{me("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):me("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Me(typeof t.token=="string"),this.R=t.token,new dw(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class zq{getToken(){return Promise.resolve(new dw(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GR(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hw{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=GR(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Ke(n,e){return n<e?-1:n>e?1:0}function Ha(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function fw(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new ge(X.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new ge(X.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new ge(X.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ge(X.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Jt.fromMillis(Date.now())}static fromDate(e){return Jt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Jt(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ke(this.nanoseconds,e.nanoseconds):Ke(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ue{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ue(e)}static min(){return new Ue(new Jt(0,0))}static max(){return new Ue(new Jt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mu{constructor(e,t,r){t===void 0?t=0:t>e.length&&Ne(),r===void 0?r=e.length-t:r>e.length-t&&Ne(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Mu.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Mu?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class it extends Mu{construct(e,t,r){return new it(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new ge(X.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new it(t)}static emptyPath(){return new it([])}}const HR=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Gt extends Mu{construct(e,t,r){return new Gt(e,t,r)}static isValidIdentifier(e){return HR.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Gt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Gt(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new ge(X.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new ge(X.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new ge(X.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new ge(X.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Gt(t)}static emptyPath(){return new Gt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ce{constructor(e){this.path=e}static fromPath(e){return new Ce(it.fromString(e))}static fromName(e){return new Ce(it.fromString(e).popFirst(5))}static empty(){return new Ce(it.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&it.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return it.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ce(new it(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wa{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function bp(n){return n.fields.find(e=>e.kind===2)}function Eo(n){return n.fields.filter(e=>e.kind!==2)}function WR(n,e){let t=Ke(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=QR(n.fields[r],e.fields[r]),t!==0)return t;return Ke(n.fields.length,e.fields.length)}Wa.UNKNOWN_ID=-1;class Lo{constructor(e,t){this.fieldPath=e,this.kind=t}}function QR(n,e){const t=Gt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Ke(n.kind,e.kind)}class Qa{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Qa(0,_r.min())}}function pw(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Ue.fromTimestamp(r===1e9?new Jt(t+1,0):new Jt(t,r));return new _r(s,Ce.empty(),e)}function mw(n){return new _r(n.readTime,n.key,-1)}class _r{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new _r(Ue.min(),Ce.empty(),-1)}static max(){return new _r(Ue.max(),Ce.empty(),-1)}}function Im(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Ce.comparator(n.documentKey,e.documentKey),t!==0?t:Ke(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gw="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class vw{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qi(n){if(n.code!==X.FAILED_PRECONDITION||n.message!==gw)throw n;me("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ne(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new G((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof G?t:G.resolve(t)}catch(t){return G.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):G.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):G.reject(t)}static resolve(e){return new G((t,r)=>{t(e)})}static reject(e){return new G((t,r)=>{r(e)})}static waitFor(e){return new G((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=G.resolve(!1);for(const r of e)t=t.next(s=>s?G.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new G((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(h=>{o[c]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new G((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wh{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Pn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new bu(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=Em(r.target.error);this.V.reject(new bu(e,s))}}static open(e,t,r,s){try{return new wh(t,e.transaction(s,r))}catch(i){throw new bu(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(me("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new YR(t)}}class os{constructor(e,t,r){this.name=e,this.version=t,this.p=r,os.S(wn())===12.2&&cn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return me("SimpleDb","Removing database:",e),So(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!ym())return!1;if(os.v())return!0;const e=wn(),t=os.S(e),r=0<t&&t<10,s=yw(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(me("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new bu(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new ge(X.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new ge(X.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new bu(e,o))},s.onupgradeneeded=i=>{me("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{me("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=wh.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),G.reject(c))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(me("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function yw(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class JR{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return So(this.B.delete())}}class bu extends ge{constructor(e,t){super(X.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Bi(n){return n.name==="IndexedDbTransactionError"}class YR{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(me("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(me("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),So(r)}add(e){return me("SimpleDb","ADD",this.store.name,e,e),So(this.store.add(e))}get(e){return So(this.store.get(e)).next(t=>(t===void 0&&(t=null),me("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return me("SimpleDb","DELETE",this.store.name,e),So(this.store.delete(e))}count(){return me("SimpleDb","COUNT",this.store.name),So(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new G((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new G((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){me("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new G((r,s)=>{t.onerror=i=>{const o=Em(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new G((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new JR(a),c=t(a.primaryKey,a.value,l);if(c instanceof G){const h=c.catch(f=>(l.done(),G.reject(f)));r.push(h)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>G.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function So(n){return new G((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=Em(r.target.error);t(s)}})}let ky=!1;function Em(n){const e=os.S(wn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new ge("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ky||(ky=!0,setTimeout(()=>{throw r},0)),r}}return n}class XR{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){me("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{me("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){Bi(t)?me("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await qi(t)}await this.X(6e4)})}}class ZR{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return G.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return me("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(me("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=mw(i);Im(o,r)>0&&(r=o)}),new _r(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ir{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}ir.oe=-1;function oc(n){return n==null}function Lu(n){return n===0&&1/n==-1/0}function _w(n){return typeof n=="number"&&Number.isInteger(n)&&!Lu(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wn(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Dy(e)),e=eC(n.get(t),e);return Dy(e)}function eC(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function Dy(n){return n+""}function ns(n){const e=n.length;if(Me(e>=2),e===2)return Me(n.charAt(0)===""&&n.charAt(1)===""),it.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&Ne(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:Ne()}i=o+2}return new it(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ny=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hd(n,e){return[n,Wn(e)]}function bw(n,e,t){return[n,Wn(e),t]}const tC={},nC=["prefixPath","collectionGroup","readTime","documentId"],rC=["prefixPath","collectionGroup","documentId"],sC=["collectionGroup","readTime","prefixPath","documentId"],iC=["canonicalId","targetId"],oC=["targetId","path"],aC=["path","targetId"],lC=["collectionId","parent"],uC=["indexId","uid"],cC=["uid","sequenceNumber"],dC=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],hC=["indexId","uid","orderedDocumentKey"],fC=["userId","collectionPath","documentId"],pC=["userId","collectionPath","largestBatchId"],mC=["userId","collectionGroup","largestBatchId"],ww=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],gC=[...ww,"documentOverlays"],xw=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Iw=xw,Tm=[...Iw,"indexConfiguration","indexState","indexEntries"],vC=Tm,yC=[...Tm,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wp extends vw{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function xn(n,e){const t=Se(n);return os.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vy(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function zi(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Ew(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function Tw(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lt{constructor(e,t){this.comparator=e,this.root=t||Mn.EMPTY}insert(e,t){return new Lt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Mn.BLACK,null,null))}remove(e){return new Lt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Mn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Jc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Jc(this.root,e,this.comparator,!1)}getReverseIterator(){return new Jc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Jc(this.root,e,this.comparator,!0)}}class Jc{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Mn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Mn.RED,this.left=s??Mn.EMPTY,this.right=i??Mn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Mn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Mn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Mn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Mn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Mn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ne();const e=this.left.check();if(e!==this.right.check())throw Ne();return e+(this.isRed()?0:1)}}Mn.EMPTY=null,Mn.RED=!0,Mn.BLACK=!1;Mn.EMPTY=new class{constructor(){this.size=0}get key(){throw Ne()}get value(){throw Ne()}get color(){throw Ne()}get left(){throw Ne()}get right(){throw Ne()}copy(e,t,r,s,i){return this}insert(e,t,r){return new Mn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pt{constructor(e){this.comparator=e,this.data=new Lt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Oy(this.data.getIterator())}getIteratorFrom(e){return new Oy(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Pt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Pt(this.comparator);return t.data=e,t}}class Oy{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function wa(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class or{constructor(e){this.fields=e,e.sort(Gt.comparator)}static empty(){return new or([])}unionWith(e){let t=new Pt(Gt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new or(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ha(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aw extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gq(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new Aw("Invalid base64 string: "+i):i}}(e);return new rn(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new rn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ke(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}rn.EMPTY_BYTE_STRING=new rn("");const _C=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function $s(n){if(Me(!!n),typeof n=="string"){let e=0;const t=_C.exec(n);if(Me(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Kt(n.seconds),nanos:Kt(n.nanos)}}function Kt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Fs(n){return typeof n=="string"?rn.fromBase64String(n):rn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xh(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Ih(n){const e=n.mapValue.fields.__previous_value__;return xh(e)?Ih(e):e}function $u(n){const e=$s(n.mapValue.fields.__local_write_time__.timestampValue);return new Jt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bC{constructor(e,t,r,s,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class Uo{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Uo("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Uo&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ii={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},fd={nullValue:"NULL_VALUE"};function Ni(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?xh(n)?4:Sw(n)?9007199254740991:Eh(n)?10:11:Ne()}function hs(n,e){if(n===e)return!0;const t=Ni(n);if(t!==Ni(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return $u(n).isEqual($u(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=$s(s.timestampValue),a=$s(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return Fs(s.bytesValue).isEqual(Fs(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Kt(s.geoPointValue.latitude)===Kt(i.geoPointValue.latitude)&&Kt(s.geoPointValue.longitude)===Kt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Kt(s.integerValue)===Kt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Kt(s.doubleValue),a=Kt(i.doubleValue);return o===a?Lu(o)===Lu(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Ha(n.arrayValue.values||[],e.arrayValue.values||[],hs);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(Vy(o)!==Vy(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!hs(o[l],a[l])))return!1;return!0}(n,e);default:return Ne()}}function Fu(n,e){return(n.values||[]).find(t=>hs(t,e))!==void 0}function Vi(n,e){if(n===e)return 0;const t=Ni(n),r=Ni(e);if(t!==r)return Ke(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ke(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=Kt(i.integerValue||i.doubleValue),l=Kt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return My(n.timestampValue,e.timestampValue);case 4:return My($u(n),$u(e));case 5:return Ke(n.stringValue,e.stringValue);case 6:return function(i,o){const a=Fs(i),l=Fs(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const h=Ke(a[c],l[c]);if(h!==0)return h}return Ke(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Ke(Kt(i.latitude),Kt(o.latitude));return a!==0?a:Ke(Kt(i.longitude),Kt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Ly(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,c,h;const f=i.fields||{},g=o.fields||{},y=(a=f.value)===null||a===void 0?void 0:a.arrayValue,I=(l=g.value)===null||l===void 0?void 0:l.arrayValue,A=Ke(((c=y==null?void 0:y.values)===null||c===void 0?void 0:c.length)||0,((h=I==null?void 0:I.values)===null||h===void 0?void 0:h.length)||0);return A!==0?A:Ly(y,I)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Ii.mapValue&&o===Ii.mapValue)return 0;if(i===Ii.mapValue)return 1;if(o===Ii.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},h=Object.keys(c);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const g=Ke(l[f],h[f]);if(g!==0)return g;const y=Vi(a[l[f]],c[h[f]]);if(y!==0)return y}return Ke(l.length,h.length)}(n.mapValue,e.mapValue);default:throw Ne()}}function My(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ke(n,e);const t=$s(n),r=$s(e),s=Ke(t.seconds,r.seconds);return s!==0?s:Ke(t.nanos,r.nanos)}function Ly(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Vi(t[s],r[s]);if(i)return i}return Ke(t.length,r.length)}function Ja(n){return xp(n)}function xp(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=$s(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Fs(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Ce.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=xp(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${xp(t.fields[o])}`;return s+"}"}(n.mapValue):Ne()}function pd(n){switch(Ni(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ih(n);return e?16+pd(e):16;case 5:return 2*n.stringValue.length;case 6:return Fs(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+pd(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return zi(r.fields,(i,o)=>{s+=i.length+pd(o)}),s}(n.mapValue);default:throw Ne()}}function jo(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ip(n){return!!n&&"integerValue"in n}function Uu(n){return!!n&&"arrayValue"in n}function $y(n){return!!n&&"nullValue"in n}function Fy(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function md(n){return!!n&&"mapValue"in n}function Eh(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function wu(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return zi(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=wu(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=wu(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Sw(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const Pw={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function wC(n){return"nullValue"in n?fd:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?jo(Uo.empty(),Ce.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Eh(n)?Pw:{mapValue:{}}:Ne()}function xC(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?jo(Uo.empty(),Ce.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?Pw:"mapValue"in n?Eh(n)?{mapValue:{}}:Ii:Ne()}function Uy(n,e){const t=Vi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function jy(n,e){const t=Vi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fn{constructor(e){this.value=e}static empty(){return new Fn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!md(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=wu(t)}setAll(e){let t=Gt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=wu(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());md(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return hs(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];md(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){zi(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Fn(wu(this.value))}}function Rw(n){const e=[];return zi(n.fields,(t,r)=>{const s=new Gt([t]);if(md(r)){const i=Rw(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new or(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $t{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new $t(e,0,Ue.min(),Ue.min(),Ue.min(),Fn.empty(),0)}static newFoundDocument(e,t,r,s){return new $t(e,1,t,Ue.min(),r,s,0)}static newNoDocument(e,t){return new $t(e,2,t,Ue.min(),Ue.min(),Fn.empty(),0)}static newUnknownDocument(e,t){return new $t(e,3,t,Ue.min(),Ue.min(),Fn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ue.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Fn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Fn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ue.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof $t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new $t(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(e,t){this.position=e,this.inclusive=t}}function qy(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=Ce.comparator(Ce.fromName(o.referenceValue),t.key):r=Vi(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function By(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!hs(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ju{constructor(e,t="asc"){this.field=e,this.dir=t}}function IC(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cw{}class ot extends Cw{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new EC(e,t,r):t==="array-contains"?new SC(e,r):t==="in"?new Mw(e,r):t==="not-in"?new PC(e,r):t==="array-contains-any"?new RC(e,r):new ot(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new TC(e,r):new AC(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Vi(t,this.value)):t!==null&&Ni(this.value)===Ni(t)&&this.matchesComparison(Vi(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ne()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class At extends Cw{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new At(e,t)}matches(e){return Ya(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Ya(n){return n.op==="and"}function Ep(n){return n.op==="or"}function Am(n){return kw(n)&&Ya(n)}function kw(n){for(const e of n.filters)if(e instanceof At)return!1;return!0}function Tp(n){if(n instanceof ot)return n.field.canonicalString()+n.op.toString()+Ja(n.value);if(Am(n))return n.filters.map(e=>Tp(e)).join(",");{const e=n.filters.map(t=>Tp(t)).join(",");return`${n.op}(${e})`}}function Dw(n,e){return n instanceof ot?function(r,s){return s instanceof ot&&r.op===s.op&&r.field.isEqual(s.field)&&hs(r.value,s.value)}(n,e):n instanceof At?function(r,s){return s instanceof At&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&Dw(o,s.filters[a]),!0):!1}(n,e):void Ne()}function Nw(n,e){const t=n.filters.concat(e);return At.create(t,n.op)}function Vw(n){return n instanceof ot?function(t){return`${t.field.canonicalString()} ${t.op} ${Ja(t.value)}`}(n):n instanceof At?function(t){return t.op.toString()+" {"+t.getFilters().map(Vw).join(" ,")+"}"}(n):"Filter"}class EC extends ot{constructor(e,t,r){super(e,t,r),this.key=Ce.fromName(r.referenceValue)}matches(e){const t=Ce.comparator(e.key,this.key);return this.matchesComparison(t)}}class TC extends ot{constructor(e,t){super(e,"in",t),this.keys=Ow("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class AC extends ot{constructor(e,t){super(e,"not-in",t),this.keys=Ow("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Ow(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Ce.fromName(r.referenceValue))}class SC extends ot{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Uu(t)&&Fu(t.arrayValue,this.value)}}class Mw extends ot{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Fu(this.value.arrayValue,t)}}class PC extends ot{constructor(e,t){super(e,"not-in",t)}matches(e){if(Fu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Fu(this.value.arrayValue,t)}}class RC extends ot{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Uu(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Fu(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CC{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function Ap(n,e=null,t=[],r=[],s=null,i=null,o=null){return new CC(n,e,t,r,s,i,o)}function qo(n){const e=Se(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Tp(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),oc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ja(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ja(r)).join(",")),e.ue=t}return e.ue}function ac(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!IC(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Dw(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!By(n.startAt,e.startAt)&&By(n.endAt,e.endAt)}function $d(n){return Ce.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Fd(n,e){return n.filters.filter(t=>t instanceof ot&&t.field.isEqual(e))}function zy(n,e,t){let r=fd,s=!0;for(const i of Fd(n,e)){let o=fd,a=!0;switch(i.op){case"<":case"<=":o=wC(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=fd}Uy({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Uy({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function Ky(n,e,t){let r=Ii,s=!0;for(const i of Fd(n,e)){let o=Ii,a=!0;switch(i.op){case">=":case">":o=xC(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Ii}jy({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];jy({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zs{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Lw(n,e,t,r,s,i,o,a){return new zs(n,e,t,r,s,i,o,a)}function gl(n){return new zs(n)}function Gy(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Sm(n){return n.collectionGroup!==null}function La(n){const e=Se(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Pt(Gt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new ju(i,r))}),t.has(Gt.keyField().canonicalString())||e.ce.push(new ju(Gt.keyField(),r))}return e.ce}function Qn(n){const e=Se(n);return e.le||(e.le=Fw(e,La(n))),e.le}function $w(n){const e=Se(n);return e.he||(e.he=Fw(e,n.explicitOrderBy)),e.he}function Fw(n,e){if(n.limitType==="F")return Ap(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new ju(s.field,i)});const t=n.endAt?new Oi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Oi(n.startAt.position,n.startAt.inclusive):null;return Ap(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Sp(n,e){const t=n.filters.concat([e]);return new zs(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Ud(n,e,t){return new zs(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function lc(n,e){return ac(Qn(n),Qn(e))&&n.limitType===e.limitType}function Uw(n){return`${qo(Qn(n))}|lt:${n.limitType}`}function Pa(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>Vw(s)).join(", ")}]`),oc(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Ja(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Ja(s)).join(",")),`Target(${r})`}(Qn(n))}; limitType=${n.limitType})`}function uc(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Ce.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of La(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=qy(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,La(r),s)||r.endAt&&!function(o,a,l){const c=qy(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,La(r),s))}(n,e)}function jw(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function qw(n){return(e,t)=>{let r=!1;for(const s of La(n)){const i=kC(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function kC(n,e,t){const r=n.field.isKeyField()?Ce.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?Vi(l,c):Ne()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Ne()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ks{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){zi(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return Tw(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DC=new Lt(Ce.comparator);function ar(){return DC}const Bw=new Lt(Ce.comparator);function iu(...n){let e=Bw;for(const t of n)e=e.insert(t.key,t);return e}function zw(n){let e=Bw;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function rs(){return xu()}function Kw(){return xu()}function xu(){return new Ks(n=>n.toString(),(n,e)=>n.isEqual(e))}const NC=new Lt(Ce.comparator),VC=new Pt(Ce.comparator);function Ye(...n){let e=VC;for(const t of n)e=e.add(t);return e}const OC=new Pt(Ke);function Pm(){return OC}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rm(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Lu(e)?"-0":e}}function Gw(n){return{integerValue:""+n}}function Hw(n,e){return _w(e)?Gw(e):Rm(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Th{constructor(){this._=void 0}}function MC(n,e,t){return n instanceof Xa?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&xh(i)&&(i=Ih(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof Bo?Qw(n,e):n instanceof zo?Jw(n,e):function(s,i){const o=Ww(s,i),a=Hy(o)+Hy(s.Pe);return Ip(o)&&Ip(s.Pe)?Gw(a):Rm(s.serializer,a)}(n,e)}function LC(n,e,t){return n instanceof Bo?Qw(n,e):n instanceof zo?Jw(n,e):t}function Ww(n,e){return n instanceof Za?function(r){return Ip(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Xa extends Th{}class Bo extends Th{constructor(e){super(),this.elements=e}}function Qw(n,e){const t=Yw(e);for(const r of n.elements)t.some(s=>hs(s,r))||t.push(r);return{arrayValue:{values:t}}}class zo extends Th{constructor(e){super(),this.elements=e}}function Jw(n,e){let t=Yw(e);for(const r of n.elements)t=t.filter(s=>!hs(s,r));return{arrayValue:{values:t}}}class Za extends Th{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Hy(n){return Kt(n.integerValue||n.doubleValue)}function Yw(n){return Uu(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cc{constructor(e,t){this.field=e,this.transform=t}}function $C(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof Bo&&s instanceof Bo||r instanceof zo&&s instanceof zo?Ha(r.elements,s.elements,hs):r instanceof Za&&s instanceof Za?hs(r.Pe,s.Pe):r instanceof Xa&&s instanceof Xa}(n.transform,e.transform)}class FC{constructor(e,t){this.version=e,this.transformResults=t}}class Ht{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ht}static exists(e){return new Ht(void 0,e)}static updateTime(e){return new Ht(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function gd(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Ah{}function Xw(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new yl(n.key,Ht.none()):new vl(n.key,n.data,Ht.none());{const t=n.data,r=Fn.empty();let s=new Pt(Gt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Gs(n.key,r,new or(s.toArray()),Ht.none())}}function UC(n,e,t){n instanceof vl?function(s,i,o){const a=s.value.clone(),l=Qy(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Gs?function(s,i,o){if(!gd(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=Qy(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(Zw(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Iu(n,e,t,r){return n instanceof vl?function(i,o,a,l){if(!gd(i.precondition,o))return a;const c=i.value.clone(),h=Jy(i.fieldTransforms,l,o);return c.setAll(h),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof Gs?function(i,o,a,l){if(!gd(i.precondition,o))return a;const c=Jy(i.fieldTransforms,l,o),h=o.data;return h.setAll(Zw(i)),h.setAll(c),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return gd(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function jC(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Ww(r.transform,s||null);i!=null&&(t===null&&(t=Fn.empty()),t.set(r.field,i))}return t||null}function Wy(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Ha(r,s,(i,o)=>$C(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class vl extends Ah{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Gs extends Ah{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Zw(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Qy(n,e,t){const r=new Map;Me(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,LC(o,a,t[s]))}return r}function Jy(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,MC(i,o,e))}return r}class yl extends Ah{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Cm extends Ah{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class km{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&UC(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Iu(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Iu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Kw();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=Xw(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(Ue.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ye())}isEqual(e){return this.batchId===e.batchId&&Ha(this.mutations,e.mutations,(t,r)=>Wy(t,r))&&Ha(this.baseMutations,e.baseMutations,(t,r)=>Wy(t,r))}}class Dm{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Me(e.mutations.length===r.length);let s=function(){return NC}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Dm(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nm{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ex{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qC{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var gn,dt;function tx(n){switch(n){default:return Ne();case X.CANCELLED:case X.UNKNOWN:case X.DEADLINE_EXCEEDED:case X.RESOURCE_EXHAUSTED:case X.INTERNAL:case X.UNAVAILABLE:case X.UNAUTHENTICATED:return!1;case X.INVALID_ARGUMENT:case X.NOT_FOUND:case X.ALREADY_EXISTS:case X.PERMISSION_DENIED:case X.FAILED_PRECONDITION:case X.ABORTED:case X.OUT_OF_RANGE:case X.UNIMPLEMENTED:case X.DATA_LOSS:return!0}}function nx(n){if(n===void 0)return cn("GRPC error has no .code"),X.UNKNOWN;switch(n){case gn.OK:return X.OK;case gn.CANCELLED:return X.CANCELLED;case gn.UNKNOWN:return X.UNKNOWN;case gn.DEADLINE_EXCEEDED:return X.DEADLINE_EXCEEDED;case gn.RESOURCE_EXHAUSTED:return X.RESOURCE_EXHAUSTED;case gn.INTERNAL:return X.INTERNAL;case gn.UNAVAILABLE:return X.UNAVAILABLE;case gn.UNAUTHENTICATED:return X.UNAUTHENTICATED;case gn.INVALID_ARGUMENT:return X.INVALID_ARGUMENT;case gn.NOT_FOUND:return X.NOT_FOUND;case gn.ALREADY_EXISTS:return X.ALREADY_EXISTS;case gn.PERMISSION_DENIED:return X.PERMISSION_DENIED;case gn.FAILED_PRECONDITION:return X.FAILED_PRECONDITION;case gn.ABORTED:return X.ABORTED;case gn.OUT_OF_RANGE:return X.OUT_OF_RANGE;case gn.UNIMPLEMENTED:return X.UNIMPLEMENTED;case gn.DATA_LOSS:return X.DATA_LOSS;default:return Ne()}}(dt=gn||(gn={}))[dt.OK=0]="OK",dt[dt.CANCELLED=1]="CANCELLED",dt[dt.UNKNOWN=2]="UNKNOWN",dt[dt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",dt[dt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",dt[dt.NOT_FOUND=5]="NOT_FOUND",dt[dt.ALREADY_EXISTS=6]="ALREADY_EXISTS",dt[dt.PERMISSION_DENIED=7]="PERMISSION_DENIED",dt[dt.UNAUTHENTICATED=16]="UNAUTHENTICATED",dt[dt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",dt[dt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",dt[dt.ABORTED=10]="ABORTED",dt[dt.OUT_OF_RANGE=11]="OUT_OF_RANGE",dt[dt.UNIMPLEMENTED=12]="UNIMPLEMENTED",dt[dt.INTERNAL=13]="INTERNAL",dt[dt.UNAVAILABLE=14]="UNAVAILABLE",dt[dt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jd=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rx(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BC=new Mo([4294967295,4294967295],0);function Yy(n){const e=rx().encode(n),t=new sw;return t.update(e),new Uint8Array(t.digest())}function Xy(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Mo([t,r],0),new Mo([s,i],0)]}class Vm{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ou(`Invalid padding: ${t}`);if(r<0)throw new ou(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ou(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new ou(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Mo.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(Mo.fromNumber(r)));return s.compare(BC)===1&&(s=new Mo([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=Yy(e),[r,s]=Xy(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Vm(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=Yy(e),[r,s]=Xy(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class ou extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dc{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,hc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new dc(Ue.min(),s,new Lt(Ke),ar(),Ye())}}class hc{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new hc(r,t,Ye(),Ye(),Ye())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vd{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class sx{constructor(e,t){this.targetId=e,this.me=t}}class ix{constructor(e,t,r=rn.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Zy{constructor(){this.fe=0,this.ge=t0(),this.pe=rn.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Ye(),t=Ye(),r=Ye();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:Ne()}}),new hc(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=t0()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Me(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class zC{constructor(e){this.Le=e,this.Be=new Map,this.ke=ar(),this.qe=e0(),this.Qe=new Lt(Ke)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:Ne()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if($d(i))if(r===0){const o=new Ce(i.path);this.Ue(t,o,$t.newNoDocument(o,Ue.min()))}else Me(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}jd==null||jd.et(function(h,f,g,y,I){var A,P,j,B,$,z;const he={localCacheCount:h,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},ve=f.unchangedNames;return ve&&(he.bloomFilter={applied:I===0,hashCount:(A=ve==null?void 0:ve.hashCount)!==null&&A!==void 0?A:0,bitmapLength:(B=(j=(P=ve==null?void 0:ve.bits)===null||P===void 0?void 0:P.bitmap)===null||j===void 0?void 0:j.length)!==null&&B!==void 0?B:0,padding:(z=($=ve==null?void 0:ve.bits)===null||$===void 0?void 0:$.padding)!==null&&z!==void 0?z:0,mightContain:T=>{var w;return(w=y==null?void 0:y.mightContain(T))!==null&&w!==void 0&&w}}),he}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=Fs(r).toUint8Array()}catch(l){if(l instanceof Aw)return Cr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Vm(o,s,i)}catch(l){return Cr(l instanceof ou?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&$d(a.target)){const l=new Ce(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,$t.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=Ye();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Je(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new dc(e,t,this.Qe,this.ke,r);return this.ke=ar(),this.qe=e0(),this.Qe=new Lt(Ke),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Zy,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Pt(Ke),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||me("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Zy),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function e0(){return new Lt(Ce.comparator)}function t0(){return new Lt(Ce.comparator)}const KC=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),GC=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),HC=(()=>({and:"AND",or:"OR"}))();class WC{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Pp(n,e){return n.useProto3Json||oc(e)?e:{value:e}}function el(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ox(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function QC(n,e){return el(n,e.toTimestamp())}function hn(n){return Me(!!n),Ue.fromTimestamp(function(t){const r=$s(t);return new Jt(r.seconds,r.nanos)}(n))}function Om(n,e){return Rp(n,e).canonicalString()}function Rp(n,e){const t=function(s){return new it(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function ax(n){const e=it.fromString(n);return Me(vx(e)),e}function qu(n,e){return Om(n.databaseId,e.path)}function as(n,e){const t=ax(e);if(t.get(1)!==n.databaseId.projectId)throw new ge(X.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new ge(X.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Ce(cx(t))}function lx(n,e){return Om(n.databaseId,e)}function ux(n){const e=ax(n);return e.length===4?it.emptyPath():cx(e)}function Cp(n){return new it(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function cx(n){return Me(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function n0(n,e,t){return{name:qu(n,e),fields:t.value.mapValue.fields}}function dx(n,e,t){const r=as(n,e.name),s=hn(e.updateTime),i=e.createTime?hn(e.createTime):Ue.min(),o=new Fn({mapValue:{fields:e.fields}}),a=$t.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function JC(n,e){return"found"in e?function(r,s){Me(!!s.found),s.found.name,s.found.updateTime;const i=as(r,s.found.name),o=hn(s.found.updateTime),a=s.found.createTime?hn(s.found.createTime):Ue.min(),l=new Fn({mapValue:{fields:s.found.fields}});return $t.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){Me(!!s.missing),Me(!!s.readTime);const i=as(r,s.missing),o=hn(s.readTime);return $t.newNoDocument(i,o)}(n,e):Ne()}function YC(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:Ne()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,h){return c.useProto3Json?(Me(h===void 0||typeof h=="string"),rn.fromBase64String(h||"")):(Me(h===void 0||h instanceof Buffer||h instanceof Uint8Array),rn.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const h=c.code===void 0?X.UNKNOWN:nx(c.code);return new ge(h,c.message||"")}(o);t=new ix(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=as(n,r.document.name),i=hn(r.document.updateTime),o=r.document.createTime?hn(r.document.createTime):Ue.min(),a=new Fn({mapValue:{fields:r.document.fields}}),l=$t.newFoundDocument(s,i,o,a),c=r.targetIds||[],h=r.removedTargetIds||[];t=new vd(c,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=as(n,r.document),i=r.readTime?hn(r.readTime):Ue.min(),o=$t.newNoDocument(s,i),a=r.removedTargetIds||[];t=new vd([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=as(n,r.document),i=r.removedTargetIds||[];t=new vd([],i,s,null)}else{if(!("filter"in e))return Ne();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new qC(s,i),a=r.targetId;t=new sx(a,o)}}return t}function Bu(n,e){let t;if(e instanceof vl)t={update:n0(n,e.key,e.value)};else if(e instanceof yl)t={delete:qu(n,e.key)};else if(e instanceof Gs)t={update:n0(n,e.key,e.data),updateMask:rk(e.fieldMask)};else{if(!(e instanceof Cm))return Ne();t={verify:qu(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof Xa)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Bo)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof zo)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Za)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw Ne()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:QC(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Ne()}(n,e.precondition)),t}function kp(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?Ht.updateTime(hn(i.updateTime)):i.exists!==void 0?Ht.exists(i.exists):Ht.none()}(e.currentDocument):Ht.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Me(a.setToServerValue==="REQUEST_TIME"),l=new Xa;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new Bo(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new zo(h)}else"increment"in a?l=new Za(o,a.increment):Ne();const c=Gt.fromServerFormat(a.fieldPath);return new cc(c,l)}(n,s)):[];if(e.update){e.update.name;const s=as(n,e.update.name),i=new Fn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new or(c.map(h=>Gt.fromServerFormat(h)))}(e.updateMask);return new Gs(s,i,o,t,r)}return new vl(s,i,t,r)}if(e.delete){const s=as(n,e.delete);return new yl(s,t)}if(e.verify){const s=as(n,e.verify);return new Cm(s,t)}return Ne()}function XC(n,e){return n&&n.length>0?(Me(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?hn(s.updateTime):hn(i);return o.isEqual(Ue.min())&&(o=hn(i)),new FC(o,s.transformResults||[])}(t,e))):[]}function hx(n,e){return{documents:[lx(n,e.path)]}}function Sh(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=lx(n,s);const i=function(c){if(c.length!==0)return gx(At.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(h=>function(g){return{field:mi(g.field),direction:ek(g.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Pp(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function fx(n,e,t,r){const{_t:s,parent:i}=Sh(n,e),o={},a=[];let l=0;return t.forEach(c=>{const h=r?c.alias:"aggregate_"+l++;o[h]=c.alias,c.aggregateType==="count"?a.push({alias:h,count:{}}):c.aggregateType==="avg"?a.push({alias:h,avg:{field:mi(c.fieldPath)}}):c.aggregateType==="sum"&&a.push({alias:h,sum:{field:mi(c.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function px(n){let e=ux(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Me(r===1);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const g=mx(f);return g instanceof At&&Am(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(I){return new ju(Ra(I.field),function(P){switch(P){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(I.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,oc(g)?null:g}(t.limit));let l=null;t.startAt&&(l=function(f){const g=!!f.before,y=f.values||[];return new Oi(y,g)}(t.startAt));let c=null;return t.endAt&&(c=function(f){const g=!f.before,y=f.values||[];return new Oi(y,g)}(t.endAt)),Lw(e,s,o,i,a,"F",l,c)}function ZC(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ne()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function mx(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Ra(t.unaryFilter.field);return ot.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Ra(t.unaryFilter.field);return ot.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Ra(t.unaryFilter.field);return ot.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Ra(t.unaryFilter.field);return ot.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Ne()}}(n):n.fieldFilter!==void 0?function(t){return ot.create(Ra(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ne()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return At.create(t.compositeFilter.filters.map(r=>mx(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Ne()}}(t.compositeFilter.op))}(n):Ne()}function ek(n){return KC[n]}function tk(n){return GC[n]}function nk(n){return HC[n]}function mi(n){return{fieldPath:n.canonicalString()}}function Ra(n){return Gt.fromServerFormat(n.fieldPath)}function gx(n){return n instanceof ot?function(t){if(t.op==="=="){if(Fy(t.value))return{unaryFilter:{field:mi(t.field),op:"IS_NAN"}};if($y(t.value))return{unaryFilter:{field:mi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Fy(t.value))return{unaryFilter:{field:mi(t.field),op:"IS_NOT_NAN"}};if($y(t.value))return{unaryFilter:{field:mi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:mi(t.field),op:tk(t.op),value:t.value}}}(n):n instanceof At?function(t){const r=t.getFilters().map(s=>gx(s));return r.length===1?r[0]:{compositeFilter:{op:nk(t.op),filters:r}}}(n):Ne()}function rk(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function vx(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ps{constructor(e,t,r,s,i=Ue.min(),o=Ue.min(),a=rn.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Ps(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ps(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ps(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ps(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yx{constructor(e){this.ct=e}}function sk(n,e){let t;if(e.document)t=dx(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Ce.fromSegments(e.noDocument.path),s=Go(e.noDocument.readTime);t=$t.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Ne();{const r=Ce.fromSegments(e.unknownDocument.path),s=Go(e.unknownDocument.version);t=$t.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Jt(s[0],s[1]);return Ue.fromTimestamp(i)}(e.readTime)),t}function r0(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:qd(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:qu(i,o.key),fields:o.data.value.mapValue.fields,updateTime:el(i,o.version.toTimestamp()),createTime:el(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Ko(e.version)};else{if(!e.isUnknownDocument())return Ne();r.unknownDocument={path:t.path.toArray(),version:Ko(e.version)}}return r}function qd(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Ko(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Go(n){const e=new Jt(n.seconds,n.nanoseconds);return Ue.fromTimestamp(e)}function Po(n,e){const t=(e.baseMutations||[]).map(i=>kp(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>kp(n.ct,i)),s=Jt.fromMillis(e.localWriteTimeMs);return new km(e.batchId,s,t,r)}function au(n){const e=Go(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Go(n.lastLimboFreeSnapshotVersion):Ue.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return Me(i.documents.length===1),Qn(gl(ux(i.documents[0])))}(n.query):function(i){return Qn(px(i))}(n.query),new Ps(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,rn.fromBase64String(n.resumeToken))}function _x(n,e){const t=Ko(e.snapshotVersion),r=Ko(e.lastLimboFreeSnapshotVersion);let s;s=$d(e.target)?hx(n.ct,e.target):Sh(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:qo(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Mm(n){const e=px({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ud(e,e.limit,"L"):e}function $f(n,e){return new Nm(e.largestBatchId,kp(n.ct,e.overlayMutation))}function s0(n,e){const t=e.path.lastSegment();return[n,Wn(e.path.popLast()),t]}function i0(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Ko(r.readTime),documentKey:Wn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ik{getBundleMetadata(e,t){return o0(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:Go(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return o0(e).put(function(s){return{bundleId:s.id,createTime:Ko(hn(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return a0(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Mm(i.bundledQuery),readTime:Go(i.readTime)}}(r)})}saveNamedQuery(e,t){return a0(e).put(function(s){return{name:s.name,readTime:Ko(hn(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function o0(n){return xn(n,"bundles")}function a0(n){return xn(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ph{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new Ph(e,r)}getOverlay(e,t){return Wl(e).get(s0(this.userId,t)).next(r=>r?$f(this.serializer,r):null)}getOverlays(e,t){const r=rs();return G.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Nm(t,o);s.push(this.ht(e,a))}),G.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(Wn(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(Wl(e).j("collectionPathOverlayIndex",a))}),G.waitFor(i)}getOverlaysForCollection(e,t,r){const s=rs(),i=Wn(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Wl(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=$f(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=rs();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Wl(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,h)=>{const f=$f(this.serializer,c);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}ht(e,t){return Wl(e).put(function(s,i,o){const[a,l,c]=s0(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Bu(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function Wl(n){return xn(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ok{Pt(e){return xn(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?rn.fromUint8Array(r):rn.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ro{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Kt(e.integerValue));else if("doubleValue"in e){const r=Kt(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),Lu(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=$s(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Fs(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?Sw(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Eh(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Ne()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(Kt(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),Ce.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}Ro.vt=new Ro;function ak(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function l0(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=ak(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class lk{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=l0(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=l0(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class uk{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class ck{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class Ql{constructor(){this.jt=new lk,this.Ht=new uk(this.jt),this.Jt=new ck(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Co{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Co(this.indexId,this.documentKey,this.arrayValue,r)}}function li(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=u0(n.arrayValue,e.arrayValue),t!==0?t:(t=u0(n.directionalValue,e.directionalValue),t!==0?t:Ce.comparator(n.documentKey,e.documentKey)))}function u0(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c0{constructor(e){this.Xt=new Pt((t,r)=>Gt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Me(e.collectionGroup===this.collectionId),this.nn)return!1;const t=bp(e);if(t!==void 0&&!this.sn(t))return!1;const r=Eo(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new Pt(Gt.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Lo(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Lo(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Lo(r.field,r.dir==="asc"?0:1)));return new Wa(Wa.UNKNOWN_ID,this.collectionId,t,Qa.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bx(n){var e,t;if(Me(n instanceof ot||n instanceof At),n instanceof ot){if(n instanceof Mw){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>ot.create(n.field,"==",i)))||[];return At.create(s,"or")}return n}const r=n.filters.map(s=>bx(s));return At.create(r,n.op)}function dk(n){if(n.getFilters().length===0)return[];const e=Vp(bx(n));return Me(wx(e)),Dp(e)||Np(e)?[e]:e.getFilters()}function Dp(n){return n instanceof ot}function Np(n){return n instanceof At&&Am(n)}function wx(n){return Dp(n)||Np(n)||function(t){if(t instanceof At&&Ep(t)){for(const r of t.getFilters())if(!Dp(r)&&!Np(r))return!1;return!0}return!1}(n)}function Vp(n){if(Me(n instanceof ot||n instanceof At),n instanceof ot)return n;if(n.filters.length===1)return Vp(n.filters[0]);const e=n.filters.map(r=>Vp(r));let t=At.create(e,n.op);return t=Bd(t),wx(t)?t:(Me(t instanceof At),Me(Ya(t)),Me(t.filters.length>1),t.filters.reduce((r,s)=>Lm(r,s)))}function Lm(n,e){let t;return Me(n instanceof ot||n instanceof At),Me(e instanceof ot||e instanceof At),t=n instanceof ot?e instanceof ot?function(s,i){return At.create([s,i],"and")}(n,e):d0(n,e):e instanceof ot?d0(e,n):function(s,i){if(Me(s.filters.length>0&&i.filters.length>0),Ya(s)&&Ya(i))return Nw(s,i.getFilters());const o=Ep(s)?s:i,a=Ep(s)?i:s,l=o.filters.map(c=>Lm(c,a));return At.create(l,"or")}(n,e),Bd(t)}function d0(n,e){if(Ya(e))return Nw(e,n.getFilters());{const t=e.filters.map(r=>Lm(n,r));return At.create(t,"or")}}function Bd(n){if(Me(n instanceof ot||n instanceof At),n instanceof ot)return n;const e=n.getFilters();if(e.length===1)return Bd(e[0]);if(kw(n))return n;const t=e.map(s=>Bd(s)),r=[];return t.forEach(s=>{s instanceof ot?r.push(s):s instanceof At&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:At.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hk{constructor(){this.un=new $m}addToCollectionParentIndex(e,t){return this.un.add(t),G.resolve()}getCollectionParents(e,t){return G.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return G.resolve()}deleteFieldIndex(e,t){return G.resolve()}deleteAllFieldIndexes(e){return G.resolve()}createTargetIndexes(e,t){return G.resolve()}getDocumentsMatchingTarget(e,t){return G.resolve(null)}getIndexType(e,t){return G.resolve(0)}getFieldIndexes(e,t){return G.resolve([])}getNextCollectionGroupToUpdate(e){return G.resolve(null)}getMinOffset(e,t){return G.resolve(_r.min())}getMinOffsetFromCollectionGroup(e,t){return G.resolve(_r.min())}updateCollectionGroup(e,t,r){return G.resolve()}updateIndexEntries(e,t){return G.resolve()}}class $m{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Pt(it.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Pt(it.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yc=new Uint8Array(0);class fk{constructor(e,t){this.databaseId=t,this.cn=new $m,this.ln=new Ks(r=>qo(r),(r,s)=>ac(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:Wn(s)};return h0(e).put(i)}return G.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[fw(t),""],!1,!0);return h0(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(ns(o.parent))}return r})}addFieldIndex(e,t){const r=Jl(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Ia(e);return i.next(a=>{o.put(i0(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=Jl(e),s=Ia(e),i=xa(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Jl(e),r=xa(e),s=Ia(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return G.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new c0(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=xa(e);let s=!0;const i=new Map;return G.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=Ye();const a=[];return G.forEach(i,(l,c)=>{me("IndexedDbIndexManager",`Using index ${function($){return`id=${$.indexId}|cg=${$.collectionGroup}|f=${$.fields.map(z=>`${z.fieldPath}:${z.kind}`).join(",")}`}(l)} to execute ${qo(t)}`);const h=function($,z){const he=bp(z);if(he===void 0)return null;for(const ve of Fd($,he.fieldPath))switch(ve.op){case"array-contains-any":return ve.value.arrayValue.values||[];case"array-contains":return[ve.value]}return null}(c,l),f=function($,z){const he=new Map;for(const ve of Eo(z))for(const T of Fd($,ve.fieldPath))switch(T.op){case"==":case"in":he.set(ve.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return he.set(ve.fieldPath.canonicalString(),T.value),Array.from(he.values())}return null}(c,l),g=function($,z){const he=[];let ve=!0;for(const T of Eo(z)){const w=T.kind===0?zy($,T.fieldPath,$.startAt):Ky($,T.fieldPath,$.startAt);he.push(w.value),ve&&(ve=w.inclusive)}return new Oi(he,ve)}(c,l),y=function($,z){const he=[];let ve=!0;for(const T of Eo(z)){const w=T.kind===0?Ky($,T.fieldPath,$.endAt):zy($,T.fieldPath,$.endAt);he.push(w.value),ve&&(ve=w.inclusive)}return new Oi(he,ve)}(c,l),I=this.In(l,c,g),A=this.In(l,c,y),P=this.Tn(l,c,f),j=this.En(l.indexId,h,I,g.inclusive,A,y.inclusive,P);return G.forEach(j,B=>r.G(B,t.limit).next($=>{$.forEach(z=>{const he=Ce.fromSegments(z.documentKey);o.has(he)||(o=o.add(he),a.push(he))})}))}).next(()=>a)}return G.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=dk(At.create(e.filters,"and")).map(r=>Ap(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),c=l/(t!=null?t.length:1),h=[];for(let f=0;f<l;++f){const g=t?this.dn(t[f/c]):Yc,y=this.An(e,g,r[f%c],s),I=this.Rn(e,g,i[f%c],o),A=a.map(P=>this.An(e,g,P,!0));h.push(...this.createRange(y,I,A))}return h}An(e,t,r,s){const i=new Co(e,Ce.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new Co(e,Ce.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new c0(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return G.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new Pt(Gt.comparator),h=!1;for(const f of l.filters)for(const g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?h=!0:c=c.add(g.field));for(const f of l.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new Ql;for(const s of Eo(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);Ro.vt.It(i,o)}return r.zt()}dn(e){const t=new Ql;return Ro.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new Ql;return Ro.vt.It(jo(this.databaseId,t),r.Yt(function(i){const o=Eo(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new Ql);let i=0;for(const o of Eo(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&Uu(a))s=this.gn(s,o,a);else{const c=l.Yt(o.kind);Ro.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new Ql;l.seed(a.zt()),Ro.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof ot&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=Jl(e),s=Ia(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return G.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(h,f){const g=f?new Qa(f.sequenceNumber,new _r(Go(f.readTime),new Ce(ns(f.documentKey)),f.largestBatchId)):Qa.empty(),y=h.fields.map(([I,A])=>new Lo(Gt.fromServerFormat(I),A));return new Wa(h.indexId,h.collectionGroup,y,g)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Ke(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=Jl(e),i=Ia(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>G.forEach(a,l=>i.put(i0(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return G.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?G.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),G.forEach(a,l=>this.wn(e,s,l).next(c=>{const h=this.Sn(i,l);return c.isEqual(h)?G.resolve():this.bn(e,i,l,c,h)}))))})}Dn(e,t,r,s){return xa(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return xa(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=xa(e);let i=new Pt(li);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new Co(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new Pt(li);const s=this.Vn(t,e);if(s==null)return r;const i=bp(t);if(i!=null){const o=e.data.field(i.fieldPath);if(Uu(o))for(const a of o.arrayValue.values||[])r=r.add(new Co(t.indexId,e.key,this.dn(a),s))}else r=r.add(new Co(t.indexId,e.key,Yc,s));return r}bn(e,t,r,s,i){me("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,c,h,f,g){const y=l.getIterator(),I=c.getIterator();let A=wa(y),P=wa(I);for(;A||P;){let j=!1,B=!1;if(A&&P){const $=h(A,P);$<0?B=!0:$>0&&(j=!0)}else A!=null?B=!0:j=!0;j?(f(P),P=wa(I)):B?(g(A),A=wa(y)):(A=wa(y),P=wa(I))}}(s,i,li,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),G.waitFor(o)}yn(e){let t=1;return Ia(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>li(o,a)).filter((o,a,l)=>!a||li(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=li(o,e),l=li(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Yc,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Yc,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return li(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(f0)}getMinOffset(e,t){return G.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||Ne())).next(f0)}}function h0(n){return xn(n,"collectionParents")}function xa(n){return xn(n,"indexEntries")}function Jl(n){return xn(n,"indexConfiguration")}function Ia(n){return xn(n,"indexState")}function f0(n){Me(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Im(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new _r(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p0={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class zn{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new zn(e,zn.DEFAULT_COLLECTION_PERCENTILE,zn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xx(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(h,f,g)=>(a++,g.delete()));i.push(l.next(()=>{Me(a===1)}));const c=[];for(const h of t.mutations){const f=bw(e,h.key.path,t.batchId);i.push(s.delete(f)),c.push(h.key)}return G.waitFor(i).next(()=>c)}function zd(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Ne();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */zn.DEFAULT_COLLECTION_PERCENTILE=10,zn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,zn.DEFAULT=new zn(41943040,zn.DEFAULT_COLLECTION_PERCENTILE,zn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),zn.DISABLED=new zn(-1,0,0);class Rh{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){Me(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new Rh(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ui(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Ca(e),o=ui(e);return o.add({}).next(a=>{Me(typeof a=="number");const l=new km(a,t,r,s),c=function(y,I,A){const P=A.baseMutations.map(B=>Bu(y.ct,B)),j=A.mutations.map(B=>Bu(y.ct,B));return{userId:I,batchId:A.batchId,localWriteTimeMs:A.localWriteTime.toMillis(),baseMutations:P,mutations:j}}(this.serializer,this.userId,l),h=[];let f=new Pt((g,y)=>Ke(g.canonicalString(),y.canonicalString()));for(const g of s){const y=bw(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),h.push(o.put(c)),h.push(i.put(y,tC))}return f.forEach(g=>{h.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),G.waitFor(h).next(()=>l)})}lookupMutationBatch(e,t){return ui(e).get(t).next(r=>r?(Me(r.userId===this.userId),Po(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?G.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ui(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(Me(a.batchId>=r),i=Po(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return ui(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ui(e).U("userMutationsIndex",t).next(r=>r.map(s=>Po(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=hd(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Ca(e).J({range:s},(o,a,l)=>{const[c,h,f]=o,g=ns(h);if(c===this.userId&&t.path.isEqual(g))return ui(e).get(f).next(y=>{if(!y)throw Ne();Me(y.userId===this.userId),i.push(Po(this.serializer,y))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Pt(Ke);const s=[];return t.forEach(i=>{const o=hd(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Ca(e).J({range:a},(c,h,f)=>{const[g,y,I]=c,A=ns(y);g===this.userId&&i.path.isEqual(A)?r=r.add(I):f.done()});s.push(l)}),G.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=hd(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new Pt(Ke);return Ca(e).J({range:o},(l,c,h)=>{const[f,g,y]=l,I=ns(g);f===this.userId&&r.isPrefixOf(I)?I.length===s&&(a=a.add(y)):h.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(ui(e).get(i).next(o=>{if(o===null)throw Ne();Me(o.userId===this.userId),r.push(Po(this.serializer,o))}))}),G.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return xx(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),G.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return G.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Ca(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=ns(i[1]);s.push(l)}else a.done()}).next(()=>{Me(s.length===0)})})}containsKey(e,t){return Ix(e,this.userId,t)}Nn(e){return Ex(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Ix(n,e,t){const r=hd(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Ca(n).J({range:i,H:!0},(a,l,c)=>{const[h,f,g]=a;h===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function ui(n){return xn(n,"mutations")}function Ca(n){return xn(n,"documentMutations")}function Ex(n){return xn(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Ho(0)}static kn(){return new Ho(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pk{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new Ho(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>Ue.fromTimestamp(new Jt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ea(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Me(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Ea(e).J((o,a)=>{const l=au(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>G.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Ea(e).J((r,s)=>{const i=au(s);t(i)})}qn(e){return m0(e).get("targetGlobalKey").next(t=>(Me(t!==null),t))}Qn(e,t){return m0(e).put("targetGlobalKey",t)}Kn(e,t){return Ea(e).put(_x(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=qo(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Ea(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const c=au(a);ac(t,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=gi(e);return t.forEach(o=>{const a=Wn(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),G.waitFor(s)}removeMatchingKeys(e,t,r){const s=gi(e);return G.forEach(t,i=>{const o=Wn(i.path);return G.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=gi(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=gi(e);let i=Ye();return s.J({range:r,H:!0},(o,a,l)=>{const c=ns(o[1]),h=new Ce(c);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=Wn(t.path),s=IDBKeyRange.bound([r],[fw(r)],!1,!0);let i=0;return gi(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return Ea(e).get(t).next(r=>r?au(r):null)}}function Ea(n){return xn(n,"targets")}function m0(n){return xn(n,"targetGlobal")}function gi(n){return xn(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g0([n,e],[t,r]){const s=Ke(n,t);return s===0?Ke(e,r):s}class mk{constructor(e){this.Un=e,this.buffer=new Pt(g0),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();g0(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Tx{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){me("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Bi(t)?me("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await qi(t)}await this.Hn(3e5)})}}class gk{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return G.resolve(ir.oe);const r=new mk(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(me("LruGarbageCollector","Garbage collection skipped; disabled"),G.resolve(p0)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(me("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),p0):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,c;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(me("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),Sa()<=st.DEBUG&&me("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(c-l)+`ms
Total Duration: ${c-h}ms`),G.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function Ax(n,e){return new gk(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vk{constructor(e,t){this.db=e,this.garbageCollector=Ax(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return Xc(e,r)}removeReference(e,t,r){return Xc(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Xc(e,t)}nr(e,t){return function(s,i){let o=!1;return Ex(s).Y(a=>Ix(s,a,i).next(l=>(l&&(o=!0),G.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,Ue.min()),gi(e).delete(function(f){return[0,Wn(f.path)]}(o))))});s.push(l)}}).next(()=>G.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Xc(e,t)}tr(e,t){const r=gi(e);let s,i=ir.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==ir.oe&&t(new Ce(ns(s)),i),i=c,s=l):i=ir.oe}).next(()=>{i!==ir.oe&&t(new Ce(ns(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Xc(n,e){return gi(n).put(function(r,s){return{targetId:0,path:Wn(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sx{constructor(){this.changes=new Ks(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,$t.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?G.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yk{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return wo(e).put(r)}removeEntry(e,t,r){return wo(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],qd(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=$t.newInvalidDocument(t);return wo(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Yl(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:$t.newInvalidDocument(t)};return wo(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Yl(t))},(s,i)=>{r={document:this.ir(t,i),size:zd(i)}}).next(()=>r)}getEntries(e,t){let r=ar();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=ar(),s=new Lt(Ce.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,zd(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return G.resolve();let s=new Pt(_0);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(Yl(s.first()),Yl(s.last())),o=s.getIterator();let a=o.getNext();return wo(e).J({index:"documentKeyIndex",range:i},(l,c,h)=>{const f=Ce.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&_0(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?h.$(Yl(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),qd(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return wo(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let h=ar();for(const f of c){const g=this.ir(Ce.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&(uc(t,g)||s.has(g.key))&&(h=h.insert(g.key,g))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=ar();const o=y0(t,r),a=y0(t,_r.max());return wo(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,h)=>{const f=this.ir(Ce.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new _k(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return v0(e).get("remoteDocumentGlobalKey").next(t=>(Me(!!t),t))}rr(e,t){return v0(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=sk(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Ue.min())))return r}return $t.newInvalidDocument(e)}}function Px(n){return new yk(n)}class _k extends Sx{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Ks(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new Pt((i,o)=>Ke(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=r0(this.cr.serializer,o);s=s.add(i.path.popLast());const c=zd(l);r+=c-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=r0(this.cr.serializer,o.convertToNoDocument(Ue.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),G.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function v0(n){return xn(n,"remoteDocumentGlobal")}function wo(n){return xn(n,"remoteDocumentsV14")}function Yl(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function y0(n,e){const t=e.documentKey.path.toArray();return[n,qd(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function _0(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Ke(t[i],r[i]),s)return s;return s=Ke(t.length,r.length),s||(s=Ke(t[t.length-2],r[r.length-2]),s||Ke(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bk{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rx{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Iu(r.mutation,s,or.empty(),Jt.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Ye()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Ye()){const s=rs();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=iu();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=rs();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Ye()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=ar();const o=xu(),a=function(){return xu()}();return t.forEach((l,c)=>{const h=r.get(c.key);s.has(c.key)&&(h===void 0||h.mutation instanceof Gs)?i=i.insert(c.key,c):h!==void 0?(o.set(c.key,h.mutation.getFieldMask()),Iu(h.mutation,c,h.mutation.getFieldMask(),Jt.now())):o.set(c.key,or.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,h)=>o.set(c,h)),t.forEach((c,h)=>{var f;return a.set(c,new bk(h,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=xu();let s=new Lt((o,a)=>o-a),i=Ye();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let h=r.get(l)||or.empty();h=a.applyToLocalView(c,h),r.set(l,h);const f=(s.get(a.batchId)||Ye()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,h=l.value,f=Kw();h.forEach(g=>{if(!i.has(g)){const y=Xw(t.get(g),r.get(g));y!==null&&f.set(g,y),i=i.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return G.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return Ce.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Sm(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):G.resolve(rs());let a=-1,l=i;return o.next(c=>G.forEach(c,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?G.resolve():this.remoteDocumentCache.getEntry(e,h).next(g=>{l=l.insert(h,g)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,Ye())).next(h=>({batchId:a,changes:zw(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ce(t)).next(r=>{let s=iu();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=iu();return this.indexManager.getCollectionParents(e,i).next(a=>G.forEach(a,l=>{const c=function(f,g){return new zs(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(h=>{h.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const h=c.getKey();o.get(h)===null&&(o=o.insert(h,$t.newInvalidDocument(h)))});let a=iu();return o.forEach((l,c)=>{const h=i.get(l);h!==void 0&&Iu(h.mutation,c,or.empty(),Jt.now()),uc(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return G.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:hn(s.createTime)}}(t)),G.resolve()}getNamedQuery(e,t){return G.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:Mm(s.bundledQuery),readTime:hn(s.readTime)}}(t)),G.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xk{constructor(){this.overlays=new Lt(Ce.comparator),this.Ir=new Map}getOverlay(e,t){return G.resolve(this.overlays.get(t))}getOverlays(e,t){const r=rs();return G.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),G.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),G.resolve()}getOverlaysForCollection(e,t,r){const s=rs(),i=t.length+1,o=new Ce(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return G.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Lt((c,h)=>c-h);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let h=i.get(c.largestBatchId);h===null&&(h=rs(),i=i.insert(c.largestBatchId,h)),h.set(c.getKey(),c)}}const a=rs(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,h)=>a.set(c,h)),!(a.size()>=s)););return G.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Nm(t,r));let i=this.Ir.get(t);i===void 0&&(i=Ye(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ik{constructor(){this.sessionToken=rn.EMPTY_BYTE_STRING}getSessionToken(e){return G.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,G.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fm{constructor(){this.Tr=new Pt(An.Er),this.dr=new Pt(An.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new An(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new An(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new Ce(new it([])),r=new An(t,e),s=new An(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Ce(new it([])),r=new An(t,e),s=new An(t,e+1);let i=Ye();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new An(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class An{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Ce.comparator(e.key,t.key)||Ke(e.wr,t.wr)}static Ar(e,t){return Ke(e.wr,t.wr)||Ce.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ek{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Pt(An.Er)}checkEmpty(e){return G.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new km(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new An(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return G.resolve(o)}lookupMutationBatch(e,t){return G.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return G.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return G.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return G.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new An(t,0),s=new An(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),G.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Pt(Ke);return t.forEach(s=>{const i=new An(s,0),o=new An(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),G.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;Ce.isDocumentKey(i)||(i=i.child(""));const o=new An(new Ce(i),0);let a=new Pt(Ke);return this.br.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.wr)),!0)},o),G.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Me(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return G.forEach(t.mutations,s=>{const i=new An(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new An(t,0),s=this.br.firstAfterOrEqual(r);return G.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,G.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tk{constructor(e){this.Mr=e,this.docs=function(){return new Lt(Ce.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return G.resolve(r?r.document.mutableCopy():$t.newInvalidDocument(t))}getEntries(e,t){let r=ar();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():$t.newInvalidDocument(s))}),G.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=ar();const o=t.path,a=new Ce(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:h}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Im(mw(h),r)<=0||(s.has(h.key)||uc(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return G.resolve(i)}getAllFromCollectionGroup(e,t,r,s){Ne()}Or(e,t){return G.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Ak(this)}getSize(e){return G.resolve(this.size)}}class Ak extends Sx{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),G.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sk{constructor(e){this.persistence=e,this.Nr=new Ks(t=>qo(t),ac),this.lastRemoteSnapshotVersion=Ue.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Fm,this.targetCount=0,this.kr=Ho.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),G.resolve()}getLastRemoteSnapshotVersion(e){return G.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return G.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),G.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),G.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Ho(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,G.resolve()}updateTargetData(e,t){return this.Kn(t),G.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,G.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),G.waitFor(i).next(()=>s)}getTargetCount(e){return G.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return G.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),G.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),G.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),G.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return G.resolve(r)}containsKey(e,t){return G.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Um{constructor(e,t){this.qr={},this.overlays={},this.Qr=new ir(0),this.Kr=!1,this.Kr=!0,this.$r=new Ik,this.referenceDelegate=e(this),this.Ur=new Sk(this),this.indexManager=new hk,this.remoteDocumentCache=function(s){return new Tk(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new yx(t),this.Gr=new wk(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new xk,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new Ek(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){me("MemoryPersistence","Starting transaction:",e);const s=new Pk(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return G.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class Pk extends vw{constructor(e){super(),this.currentSequenceNumber=e}}class Ch{constructor(e){this.persistence=e,this.Jr=new Fm,this.Yr=null}static Zr(e){return new Ch(e)}get Xr(){if(this.Yr)return this.Yr;throw Ne()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),G.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),G.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),G.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return G.forEach(this.Xr,r=>{const s=Ce.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,Ue.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return G.or([()=>G.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class Kd{constructor(e,t){this.persistence=e,this.ti=new Ks(r=>Wn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=Ax(this,t)}static Zr(e,t){return new Kd(e,t)}zr(){}jr(e){return G.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return G.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?G.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,Ue.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),G.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),G.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),G.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),G.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=pd(e.data.value)),t}nr(e,t,r){return G.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return G.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rk{constructor(e){this.serializer=e}O(e,t,r,s){const i=new wh("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Ny,{unique:!0}),l.createObjectStore("documentMutations")}(e),b0(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=G.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),b0(e)),o=o.next(()=>function(l){const c=l.store("targetGlobal"),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Ue.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store("mutations").U().next(h=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Ny,{unique:!0});const f=c.store("mutations"),g=h.map(y=>f.put(y));return G.waitFor(g)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore("documentOverlays",{keyPath:fC});c.createIndex("collectionPathOverlayIndex",pC,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",mC,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore("remoteDocumentsV14",{keyPath:nC});c.createIndex("documentKeyIndex",rC),c.createIndex("collectionGroupIndex",sC)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:uC}).createIndex("sequenceNumberIndex",cC,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:dC}).createIndex("documentKeyIndex",hC,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=zd(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>G.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>G.forEach(a,l=>{Me(l.userId===i.userId);const c=Po(this.serializer,l);return xx(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new it(o),c=function(f){return[0,Wn(f)]}(l);i.push(t.get(c).next(h=>h?G.resolve():(f=>t.put({targetId:0,path:Wn(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>G.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:lC});const r=t.store("collectionParents"),s=new $m,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Wn(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new it(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],c)=>{const h=ns(a);return i(h.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=au(s),o=_x(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new Ce(it.fromString(f.document.name).popFirst(5)):f.noDocument?Ce.fromSegments(f.noDocument.path):f.unknownDocument?Ce.fromSegments(f.unknownDocument.path):Ne()}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>G.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=Px(this.serializer),i=new Um(Ch.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var c;let h=(c=a.get(l.userId))!==null&&c!==void 0?c:Ye();Po(this.serializer,l).keys().forEach(f=>h=h.add(f)),a.set(l.userId,h)}),G.forEach(a,(l,c)=>{const h=new Sn(c),f=Ph.lt(this.serializer,h),g=i.getIndexManager(h),y=Rh.lt(h,this.serializer,g,i.referenceDelegate);return new Rx(s,y,f,g).recalculateAndSaveOverlaysForDocumentKeys(new wp(t,ir.oe),l).next()})})}}function b0(n){n.createObjectStore("targetDocuments",{keyPath:oC}).createIndex("documentTargetsIndex",aC,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",iC,{unique:!0}),n.createObjectStore("targetGlobal")}const Ff="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class jm{constructor(e,t,r,s,i,o,a,l,c,h,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=h,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=g=>Promise.resolve(),!jm.D())throw new ge(X.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new vk(this,s),this.Ai=t+"main",this.serializer=new yx(l),this.Ri=new os(this.Ai,this.hi,new Rk(this.serializer)),this.$r=new ok,this.Ur=new pk(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Px(this.serializer),this.Gr=new ik,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,h===!1&&cn("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new ge(X.FAILED_PRECONDITION,Ff);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new ir(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Zc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Bi(e))return me("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return me("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Xl(e).get("owner").next(t=>G.resolve(this.vi(t)))}Ci(e){return Zc(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=xn(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return G.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?G.resolve(!0):Xl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new ge(X.FAILED_PRECONDITION,Ff);return!1}}return!(!this.networkEnabled||!this.inForeground)||Zc(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&me("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new wp(e,ir.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Zc(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Rh.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new fk(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Ph.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){me("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?yC:l===16?vC:l===15?Tm:l===14?Iw:l===13?xw:l===12?gC:l===11?ww:void Ne()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new wp(a,this.Qr?this.Qr.next():ir.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw cn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new ge(X.FAILED_PRECONDITION,gw);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return Xl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new ge(X.FAILED_PRECONDITION,Ff)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Xl(e).put("owner",t)}static D(){return os.D()}bi(e){const t=Xl(e);return t.get("owner").next(r=>this.vi(r)?(me("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):G.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(cn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;Yb()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return me("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return cn("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){cn("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Xl(n){return xn(n,"owner")}function Zc(n){return xn(n,"clientMetadata")}function qm(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bm{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=Ye(),s=Ye();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Bm(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ck{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cx{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Yb()?8:yw(wn())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new Ck;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(Sa()<=st.DEBUG&&me("QueryEngine","SDK will not create cache indexes for query:",Pa(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),G.resolve()):(Sa()<=st.DEBUG&&me("QueryEngine","Query:",Pa(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Sa()<=st.DEBUG&&me("QueryEngine","The SDK decides to create cache indexes for query:",Pa(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Qn(t))):G.resolve())}Yi(e,t){if(Gy(t))return G.resolve(null);let r=Qn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=Ud(t,null,"F"),r=Qn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Ye(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ts(t,a);return this.ns(t,c,o,l.readTime)?this.Yi(e,Ud(t,null,"F")):this.rs(e,c,t,l)}))})))}Zi(e,t,r,s){return Gy(t)||s.isEqual(Ue.min())?G.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?G.resolve(null):(Sa()<=st.DEBUG&&me("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Pa(t)),this.rs(e,o,t,pw(s,-1)).next(a=>a))})}ts(e,t){let r=new Pt(qw(e));return t.forEach((s,i)=>{uc(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return Sa()<=st.DEBUG&&me("QueryEngine","Using full collection scan to execute query:",Pa(t)),this.Ji.getDocumentsMatchingQuery(e,t,_r.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kk{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Lt(Ke),this._s=new Ks(i=>qo(i),ac),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Rx(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function kx(n,e,t,r){return new kk(n,e,t,r)}async function Dx(n,e){const t=Se(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=Ye();for(const c of s){o.push(c.batchId);for(const h of c.mutations)l=l.add(h.key)}for(const c of i){a.push(c.batchId);for(const h of c.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function Dk(n,e){const t=Se(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,h){const f=c.batch,g=f.keys();let y=G.resolve();return g.forEach(I=>{y=y.next(()=>h.getEntry(l,I)).next(A=>{const P=c.docVersions.get(I);Me(P!==null),A.version.compareTo(P)<0&&(f.applyToRemoteDocument(A,c),A.isValidDocument()&&(A.setReadTime(c.commitVersion),h.addEntry(A)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=Ye();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function Nx(n){const e=Se(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function Nk(n,e){const t=Se(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((h,f)=>{const g=s.get(f);if(!g)return;a.push(t.Ur.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,h.addedDocuments,f)));let y=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(rn.EMPTY_BYTE_STRING,Ue.min()).withLastLimboFreeSnapshotVersion(Ue.min()):h.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(h.resumeToken,r)),s=s.insert(f,y),function(A,P,j){return A.resumeToken.approximateByteSize()===0||P.snapshotVersion.toMicroseconds()-A.snapshotVersion.toMicroseconds()>=3e8?!0:j.addedDocuments.size+j.modifiedDocuments.size+j.removedDocuments.size>0}(g,y,h)&&a.push(t.Ur.updateTargetData(i,y))});let l=ar(),c=Ye();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(Vx(i,o,e.documentUpdates).next(h=>{l=h.Ps,c=h.Is})),!r.isEqual(Ue.min())){const h=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return G.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.os=s,i))}function Vx(n,e,t){let r=Ye(),s=Ye();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=ar();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(Ue.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):me("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function Vk(n,e){const t=Se(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function tl(n,e){const t=Se(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,G.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new Ps(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function nl(n,e,t){const r=Se(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Bi(o))throw o;me("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Gd(n,e,t){const r=Se(n);let s=Ue.min(),i=Ye();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,h){const f=Se(l),g=f._s.get(h);return g!==void 0?G.resolve(f.os.get(g)):f.Ur.getTargetData(c,h)}(r,o,Qn(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:Ue.min(),t?i:Ye())).next(a=>(Lx(r,jw(e),a),{documents:a,Ts:i})))}function Ox(n,e){const t=Se(n),r=Se(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function Mx(n,e){const t=Se(n),r=t.us.get(e)||Ue.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,pw(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(Lx(t,e,s),s))}function Lx(n,e,t){let r=n.us.get(e)||Ue.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function Ok(n,e,t,r){const s=Se(n);let i=Ye(),o=ar();for(const c of t){const h=e.Es(c.metadata.name);c.document&&(i=i.add(h));const f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(h,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await tl(s,function(h){return Qn(gl(it.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>Vx(c,a,o).next(h=>(a.apply(c),h)).next(h=>s.Ur.removeMatchingKeysForTargetId(c,l.targetId).next(()=>s.Ur.addMatchingKeys(c,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,h.Ps,h.Is)).next(()=>h.Ps)))}async function Mk(n,e,t=Ye()){const r=await tl(n,Qn(Mm(e.bundledQuery))),s=Se(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=hn(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(rn.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function w0(n,e){return`firestore_clients_${n}_${e}`}function x0(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Uf(n,e){return`firestore_targets_${n}_${e}`}class Hd{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new ge(s.error.code,s.error.message))),o?new Hd(e,t,s.state,i):(cn("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Eu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new ge(r.error.code,r.error.message))),i?new Eu(e,r.state,s):(cn("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Wd{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Pm();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=_w(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Wd(e,i):(cn("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class zm{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new zm(t.clientId,t.onlineState):(cn("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Op{constructor(){this.activeTargetIds=Pm()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class jf{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Lt(Ke),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=w0(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Op),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(w0(this.persistenceKey,r));if(s){const i=Wd.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Uf(this.persistenceKey,e));if(s){const i=Eu.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Uf(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return me("SharedClientState","READ",e,t),t}setItem(e,t){me("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){me("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(me("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void cn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=ir.oe;if(i!=null)try{const a=JSON.parse(i);Me(typeof a=="number"),o=a}catch(a){cn("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==ir.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new Hd(this.currentUser,e,t,r),i=x0(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=x0(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=Uf(this.persistenceKey,e),i=new Eu(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return Wd.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return Hd.Rs(new Sn(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return Eu.Rs(s,t)}Ls(e){return zm.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);me("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Pm();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class $x{constructor(){this.so=new Op,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Op,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lk{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I0{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){me("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){me("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ed=null;function qf(){return ed===null?ed=function(){return 268435456+Math.round(2147483648*Math.random())}():ed++,"0x"+ed.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $k={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fk{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qn="WebChannelConnection";class Uk extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=qf(),l=this.xo(t,r.toUriEncodedString());me("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,l,c,s).then(h=>(me("RestConnection",`Received RPC '${t}' ${a}: `,h),h),h=>{throw Cr("RestConnection",`RPC '${t}' ${a} failed with error: `,h,"url: ",l,"request:",s),h})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ml}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=$k[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=qf();return new Promise((o,a)=>{const l=new iw;l.setWithCredentials(!0),l.listenOnce(ow.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case dd.NO_ERROR:const h=l.getResponseJson();me(qn,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(h)),o(h);break;case dd.TIMEOUT:me(qn,`RPC '${e}' ${i} timed out`),a(new ge(X.DEADLINE_EXCEEDED,"Request time out"));break;case dd.HTTP_ERROR:const f=l.getStatus();if(me(qn,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let g=l.getResponseJson();Array.isArray(g)&&(g=g[0]);const y=g==null?void 0:g.error;if(y&&y.status&&y.message){const I=function(P){const j=P.toLowerCase().replace(/_/g,"-");return Object.values(X).indexOf(j)>=0?j:X.UNKNOWN}(y.status);a(new ge(I,y.message))}else a(new ge(X.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new ge(X.UNAVAILABLE,"Connection failed."));break;default:Ne()}}finally{me(qn,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);me(qn,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=qf(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=uw(),a=lw(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const h=i.join("");me(qn,`Creating RPC '${e}' stream ${s}: ${h}`,l);const f=o.createWebChannel(h,l);let g=!1,y=!1;const I=new Fk({Io:P=>{y?me(qn,`Not sending because RPC '${e}' stream ${s} is closed:`,P):(g||(me(qn,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),me(qn,`RPC '${e}' stream ${s} sending:`,P),f.send(P))},To:()=>f.close()}),A=(P,j,B)=>{P.listen(j,$=>{try{B($)}catch(z){setTimeout(()=>{throw z},0)}})};return A(f,su.EventType.OPEN,()=>{y||(me(qn,`RPC '${e}' stream ${s} transport opened.`),I.yo())}),A(f,su.EventType.CLOSE,()=>{y||(y=!0,me(qn,`RPC '${e}' stream ${s} transport closed`),I.So())}),A(f,su.EventType.ERROR,P=>{y||(y=!0,Cr(qn,`RPC '${e}' stream ${s} transport errored:`,P),I.So(new ge(X.UNAVAILABLE,"The operation could not be completed")))}),A(f,su.EventType.MESSAGE,P=>{var j;if(!y){const B=P.data[0];Me(!!B);const $=B,z=$.error||((j=$[0])===null||j===void 0?void 0:j.error);if(z){me(qn,`RPC '${e}' stream ${s} received error:`,z);const he=z.status;let ve=function(E){const D=gn[E];if(D!==void 0)return nx(D)}(he),T=z.message;ve===void 0&&(ve=X.INTERNAL,T="Unknown error status: "+he+" with message "+z.message),y=!0,I.So(new ge(ve,T)),f.close()}else me(qn,`RPC '${e}' stream ${s} received:`,B),I.bo(B)}}),A(a,aw.STAT_EVENT,P=>{P.stat===_p.PROXY?me(qn,`RPC '${e}' stream ${s} detected buffering proxy`):P.stat===_p.NOPROXY&&me(qn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{I.wo()},0),I}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fx(){return typeof window<"u"?window:null}function yd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fc(n){return new WC(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Km{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&me("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ux{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Km(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===X.RESOURCE_EXHAUSTED?(cn(t.toString()),cn("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===X.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new ge(X.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return me("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(me("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class jk extends Ux{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=YC(this.serializer,e),r=function(i){if(!("targetChange"in i))return Ue.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Ue.min():o.readTime?hn(o.readTime):Ue.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=Cp(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=$d(l)?{documents:hx(i,l)}:{query:Sh(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=ox(i,o.resumeToken);const c=Pp(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(Ue.min())>0){a.readTime=el(i,o.snapshotVersion.toTimestamp());const c=Pp(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=ZC(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=Cp(this.serializer),t.removeTarget=e,this.a_(t)}}class qk extends Ux{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Me(!!e.streamToken),this.lastStreamToken=e.streamToken,Me(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Me(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=XC(e.writeResults,e.commitTime),r=hn(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=Cp(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Bu(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bk extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new ge(X.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,Rp(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===X.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new ge(X.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,Rp(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===X.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new ge(X.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class zk{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(cn(t),this.D_=!1):me("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kk{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{Ki(this)&&(me("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=Se(l);c.L_.add(4),await _l(c),c.q_.set("Unknown"),c.L_.delete(4),await pc(c)}(this))})}),this.q_=new zk(r,s)}}async function pc(n){if(Ki(n))for(const e of n.B_)await e(!0)}async function _l(n){for(const e of n.B_)await e(!1)}function kh(n,e){const t=Se(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Wm(t)?Hm(t):wl(t).r_()&&Gm(t,e))}function rl(n,e){const t=Se(n),r=wl(t);t.N_.delete(e),r.r_()&&jx(t,e),t.N_.size===0&&(r.r_()?r.o_():Ki(t)&&t.q_.set("Unknown"))}function Gm(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ue.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}wl(n).A_(e)}function jx(n,e){n.Q_.xe(e),wl(n).R_(e)}function Hm(n){n.Q_=new zC({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),wl(n).start(),n.q_.v_()}function Wm(n){return Ki(n)&&!wl(n).n_()&&n.N_.size>0}function Ki(n){return Se(n).L_.size===0}function qx(n){n.Q_=void 0}async function Gk(n){n.q_.set("Online")}async function Hk(n){n.N_.forEach((e,t)=>{Gm(n,e)})}async function Wk(n,e){qx(n),Wm(n)?(n.q_.M_(e),Hm(n)):n.q_.set("Unknown")}async function Qk(n,e,t){if(n.q_.set("Online"),e instanceof ix&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){me("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Qd(n,r)}else if(e instanceof vd?n.Q_.Ke(e):e instanceof sx?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Ue.min()))try{const r=await Nx(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.N_.get(c);h&&i.N_.set(c,h.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const h=i.N_.get(l);if(!h)return;i.N_.set(l,h.withResumeToken(rn.EMPTY_BYTE_STRING,h.snapshotVersion)),jx(i,l);const f=new Ps(h.target,l,c,h.sequenceNumber);Gm(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){me("RemoteStore","Failed to raise snapshot:",r),await Qd(n,r)}}async function Qd(n,e,t){if(!Bi(e))throw e;n.L_.add(1),await _l(n),n.q_.set("Offline"),t||(t=()=>Nx(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{me("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await pc(n)})}function Bx(n,e){return e().catch(t=>Qd(n,t,e))}async function bl(n){const e=Se(n),t=Mi(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;Jk(e);)try{const s=await Vk(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,Yk(e,s)}catch(s){await Qd(e,s)}zx(e)&&Kx(e)}function Jk(n){return Ki(n)&&n.O_.length<10}function Yk(n,e){n.O_.push(e);const t=Mi(n);t.r_()&&t.V_&&t.m_(e.mutations)}function zx(n){return Ki(n)&&!Mi(n).n_()&&n.O_.length>0}function Kx(n){Mi(n).start()}async function Xk(n){Mi(n).p_()}async function Zk(n){const e=Mi(n);for(const t of n.O_)e.m_(t.mutations)}async function e2(n,e,t){const r=n.O_.shift(),s=Dm.from(r,e,t);await Bx(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await bl(n)}async function t2(n,e){e&&Mi(n).V_&&await async function(r,s){if(function(o){return tx(o)&&o!==X.ABORTED}(s.code)){const i=r.O_.shift();Mi(r).s_(),await Bx(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await bl(r)}}(n,e),zx(n)&&Kx(n)}async function E0(n,e){const t=Se(n);t.asyncQueue.verifyOperationInProgress(),me("RemoteStore","RemoteStore received new credentials");const r=Ki(t);t.L_.add(3),await _l(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await pc(t)}async function Mp(n,e){const t=Se(n);e?(t.L_.delete(2),await pc(t)):e||(t.L_.add(2),await _l(t),t.q_.set("Unknown"))}function wl(n){return n.K_||(n.K_=function(t,r,s){const i=Se(t);return i.w_(),new jk(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:Gk.bind(null,n),Ro:Hk.bind(null,n),mo:Wk.bind(null,n),d_:Qk.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Wm(n)?Hm(n):n.q_.set("Unknown")):(await n.K_.stop(),qx(n))})),n.K_}function Mi(n){return n.U_||(n.U_=function(t,r,s){const i=Se(t);return i.w_(),new qk(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Xk.bind(null,n),mo:t2.bind(null,n),f_:Zk.bind(null,n),g_:e2.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await bl(n)):(await n.U_.stop(),n.O_.length>0&&(me("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Pn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Qm(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ge(X.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function xl(n,e){if(cn("AsyncQueue",`${e}: ${n}`),Bi(n))return new ge(X.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $a{constructor(e){this.comparator=e?(t,r)=>e(t,r)||Ce.comparator(t.key,r.key):(t,r)=>Ce.comparator(t.key,r.key),this.keyedMap=iu(),this.sortedSet=new Lt(this.comparator)}static emptySet(e){return new $a(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof $a)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new $a;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T0{constructor(){this.W_=new Lt(Ce.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Ne():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class sl{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new sl(e,t,$a.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&lc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n2{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class r2{constructor(){this.queries=A0(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=Se(t),i=s.queries;s.queries=A0(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new ge(X.ABORTED,"Firestore shutting down"))}}function A0(){return new Ks(n=>Uw(n),lc)}async function Jm(n,e){const t=Se(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new n2,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=xl(o,`Initialization of query '${Pa(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Xm(t)}async function Ym(n,e){const t=Se(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function s2(n,e){const t=Se(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&Xm(t)}function i2(n,e,t){const r=Se(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function Xm(n){n.Y_.forEach(e=>{e.next()})}var Lp,S0;(S0=Lp||(Lp={})).ea="default",S0.Cache="cache";class Zm{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new sl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=sl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Lp.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o2{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P0{constructor(e){this.serializer=e}Es(e){return as(this.serializer,e)}ds(e){return e.metadata.exists?dx(this.serializer,e.document,!1):$t.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return hn(e)}}class a2{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Gx(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=it.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new P0(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||Ye()).add(i);t.set(o,a)}}return t}async complete(){const e=await Ok(this.localStore,new P0(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await Mk(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function Gx(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hx{constructor(e){this.key=e}}class Wx{constructor(e){this.key=e}}class Qx{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Ye(),this.mutatedKeys=Ye(),this.Aa=qw(e),this.Ra=new $a(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new T0,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const g=s.get(h),y=uc(this.query,f)?f:null,I=!!g&&this.mutatedKeys.has(g.key),A=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let P=!1;g&&y?g.data.isEqual(y.data)?I!==A&&(r.track({type:3,doc:y}),P=!0):this.ga(g,y)||(r.track({type:2,doc:y}),P=!0,(l&&this.Aa(y,l)>0||c&&this.Aa(y,c)<0)&&(a=!0)):!g&&y?(r.track({type:0,doc:y}),P=!0):g&&!y&&(r.track({type:1,doc:g}),P=!0,(l||c)&&(a=!0)),P&&(y?(o=o.add(y),i=A?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((h,f)=>function(y,I){const A=P=>{switch(P){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ne()}};return A(y)-A(I)}(h.type,f.type)||this.Aa(h.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,c=l!==this.Ea;return this.Ea=l,o.length!==0||c?{snapshot:new sl(this.query,e.Ra,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new T0,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Ye(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new Wx(r))}),this.da.forEach(r=>{e.has(r)||t.push(new Hx(r))}),t}ba(e){this.Ta=e.Ts,this.da=Ye();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return sl.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class l2{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class u2{constructor(e){this.key=e,this.va=!1}}class c2{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Ks(a=>Uw(a),lc),this.Ma=new Map,this.xa=new Set,this.Oa=new Lt(Ce.comparator),this.Na=new Map,this.La=new Fm,this.Ba={},this.ka=new Map,this.qa=Ho.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function d2(n,e,t=!0){const r=Dh(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await Jx(r,e,t,!0),s}async function h2(n,e){const t=Dh(n);await Jx(t,e,!0,!1)}async function Jx(n,e,t,r){const s=await tl(n.localStore,Qn(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await eg(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&kh(n.remoteStore,s),a}async function eg(n,e,t,r,s){n.Ka=(f,g,y)=>async function(A,P,j,B){let $=P.view.ma(j);$.ns&&($=await Gd(A.localStore,P.query,!1).then(({documents:T})=>P.view.ma(T,$)));const z=B&&B.targetChanges.get(P.targetId),he=B&&B.targetMismatches.get(P.targetId)!=null,ve=P.view.applyChanges($,A.isPrimaryClient,z,he);return $p(A,P.targetId,ve.wa),ve.snapshot}(n,f,g,y);const i=await Gd(n.localStore,e,!0),o=new Qx(e,i.Ts),a=o.ma(i.documents),l=hc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);$p(n,t,c.wa);const h=new l2(e,t,o);return n.Fa.set(e,h),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function f2(n,e,t){const r=Se(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!lc(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await nl(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&rl(r.remoteStore,s.targetId),il(r,s.targetId)}).catch(qi)):(il(r,s.targetId),await nl(r.localStore,s.targetId,!0))}async function p2(n,e){const t=Se(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),rl(t.remoteStore,r.targetId))}async function m2(n,e,t){const r=sg(n);try{const s=await function(o,a){const l=Se(o),c=Jt.now(),h=a.reduce((y,I)=>y.add(I.key),Ye());let f,g;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let I=ar(),A=Ye();return l.cs.getEntries(y,h).next(P=>{I=P,I.forEach((j,B)=>{B.isValidDocument()||(A=A.add(j))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,I)).next(P=>{f=P;const j=[];for(const B of a){const $=jC(B,f.get(B.key).overlayedDocument);$!=null&&j.push(new Gs(B.key,$,Rw($.value.mapValue),Ht.exists(!0)))}return l.mutationQueue.addMutationBatch(y,c,j,a)}).next(P=>{g=P;const j=P.applyToLocalDocumentSet(f,A);return l.documentOverlayCache.saveOverlays(y,P.batchId,j)})}).then(()=>({batchId:g.batchId,changes:zw(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Ba[o.currentUser.toKey()];c||(c=new Lt(Ke)),c=c.insert(a,l),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await Hs(r,s.changes),await bl(r.remoteStore)}catch(s){const i=xl(s,"Failed to persist write");t.reject(i)}}async function Yx(n,e){const t=Se(n);try{const r=await Nk(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(Me(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Me(o.va):s.removedDocuments.size>0&&(Me(o.va),o.va=!1))}),await Hs(t,r,e)}catch(r){await qi(r)}}function R0(n,e,t){const r=Se(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=Se(o);l.onlineState=a;let c=!1;l.queries.forEach((h,f)=>{for(const g of f.j_)g.Z_(a)&&(c=!0)}),c&&Xm(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function g2(n,e,t){const r=Se(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Lt(Ce.comparator);o=o.insert(i,$t.newNoDocument(i,Ue.min()));const a=Ye().add(i),l=new dc(Ue.min(),new Map,new Lt(Ke),o,a);await Yx(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),rg(r)}else await nl(r.localStore,e,!1).then(()=>il(r,e,t)).catch(qi)}async function v2(n,e){const t=Se(n),r=e.batch.batchId;try{const s=await Dk(t.localStore,e);ng(t,r,null),tg(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Hs(t,s)}catch(s){await qi(s)}}async function y2(n,e,t){const r=Se(n);try{const s=await function(o,a){const l=Se(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let h;return l.mutationQueue.lookupMutationBatch(c,a).next(f=>(Me(f!==null),h=f.keys(),l.mutationQueue.removeMutationBatch(c,f))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,h,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,h)).next(()=>l.localDocuments.getDocuments(c,h))})}(r.localStore,e);ng(r,e,t),tg(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Hs(r,s)}catch(s){await qi(s)}}async function _2(n,e){const t=Se(n);Ki(t.remoteStore)||me("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=Se(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=xl(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function tg(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function ng(n,e,t){const r=Se(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function il(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||Xx(n,r)})}function Xx(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(rl(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),rg(n))}function $p(n,e,t){for(const r of t)r instanceof Hx?(n.La.addReference(r.key,e),b2(n,r)):r instanceof Wx?(me("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||Xx(n,r.key)):Ne()}function b2(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(me("SyncEngine","New document in limbo: "+t),n.xa.add(r),rg(n))}function rg(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new Ce(it.fromString(e)),r=n.qa.next();n.Na.set(r,new u2(t)),n.Oa=n.Oa.insert(t,r),kh(n.remoteStore,new Ps(Qn(gl(t.path)),r,"TargetPurposeLimboResolution",ir.oe))}}async function Hs(n,e,t){const r=Se(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(c=>{var h;if((c||t)&&r.isPrimaryClient){const f=c?!c.fromCache:(h=t==null?void 0:t.targetChanges.get(l.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(c){s.push(c);const f=Bm.Wi(l.targetId,c);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,c){const h=Se(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>G.forEach(c,g=>G.forEach(g.$i,y=>h.persistence.referenceDelegate.addReference(f,g.targetId,y)).next(()=>G.forEach(g.Ui,y=>h.persistence.referenceDelegate.removeReference(f,g.targetId,y)))))}catch(f){if(!Bi(f))throw f;me("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const g=f.targetId;if(!f.fromCache){const y=h.os.get(g),I=y.snapshotVersion,A=y.withLastLimboFreeSnapshotVersion(I);h.os=h.os.insert(g,A)}}}(r.localStore,i))}async function w2(n,e){const t=Se(n);if(!t.currentUser.isEqual(e)){me("SyncEngine","User change. New user:",e.toKey());const r=await Dx(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new ge(X.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Hs(t,r.hs)}}function x2(n,e){const t=Se(n),r=t.Na.get(e);if(r&&r.va)return Ye().add(r.key);{let s=Ye();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function I2(n,e){const t=Se(n),r=await Gd(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&$p(t,e.targetId,s.wa),s}async function E2(n,e){const t=Se(n);return Mx(t.localStore,e).then(r=>Hs(t,r))}async function T2(n,e,t,r){const s=Se(n),i=await function(a,l){const c=Se(a),h=Se(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.Mn(f,l).next(g=>g?c.localDocuments.getDocuments(f,g):G.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await bl(s.remoteStore):t==="acknowledged"||t==="rejected"?(ng(s,e,r||null),tg(s,e),function(a,l){Se(Se(a).mutationQueue).On(l)}(s.localStore,e)):Ne(),await Hs(s,i)):me("SyncEngine","Cannot apply mutation batch with id: "+e)}async function A2(n,e){const t=Se(n);if(Dh(t),sg(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await C0(t,r.toArray());t.Qa=!0,await Mp(t.remoteStore,!0);for(const i of s)kh(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(il(t,o),nl(t.localStore,o,!0))),rl(t.remoteStore,o)}),await s,await C0(t,r),function(o){const a=Se(o);a.Na.forEach((l,c)=>{rl(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new Lt(Ce.comparator)}(t),t.Qa=!1,await Mp(t.remoteStore,!1)}}async function C0(n,e,t){const r=Se(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await tl(r.localStore,Qn(l[0]));for(const c of l){const h=r.Fa.get(c),f=await I2(r,h);f.snapshot&&i.push(f.snapshot)}}else{const c=await Ox(r.localStore,o);a=await tl(r.localStore,c),await eg(r,Zx(c),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function Zx(n){return Lw(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function S2(n){return function(t){return Se(Se(t).persistence).Qi()}(Se(n).localStore)}async function P2(n,e,t,r){const s=Se(n);if(s.Qa)return void me("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await Mx(s.localStore,jw(i[0])),a=dc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",rn.EMPTY_BYTE_STRING);await Hs(s,o,a);break}case"rejected":await nl(s.localStore,e,!0),il(s,e,r);break;default:Ne()}}async function R2(n,e,t){const r=Dh(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){me("SyncEngine","Adding an already active target "+s);continue}const i=await Ox(r.localStore,s),o=await tl(r.localStore,i);await eg(r,Zx(i),o.targetId,!1,o.resumeToken),kh(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await nl(r.localStore,s,!1).then(()=>{rl(r.remoteStore,s),il(r,s)}).catch(qi)}}function Dh(n){const e=Se(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Yx.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=x2.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=g2.bind(null,e),e.Ca.d_=s2.bind(null,e.eventManager),e.Ca.$a=i2.bind(null,e.eventManager),e}function sg(n){const e=Se(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=v2.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=y2.bind(null,e),e}function C2(n,e,t){const r=Se(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(y,I){const A=Se(y),P=hn(I.createTime);return A.persistence.runTransaction("hasNewerBundle","readonly",j=>A.Gr.getBundleMetadata(j,I.id)).then(j=>!!j&&j.createTime.compareTo(P)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(Gx(l));const c=new a2(l,i.localStore,o.serializer);let h=await o.Ua();for(;h;){const g=await c.la(h);g&&a._updateProgress(g),h=await o.Ua()}const f=await c.complete();return await Hs(i,f.Ia,void 0),await function(y,I){const A=Se(y);return A.persistence.runTransaction("Save bundle","readwrite",P=>A.Gr.saveBundleMetadata(P,I))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(l){return Cr("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class Li{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=fc(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return kx(this.persistence,new Cx,e.initialUser,this.serializer)}Ga(e){return new Um(Ch.Zr,this.serializer)}Wa(e){return new $x}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Li.provider={build:()=>new Li};class k2 extends Li{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){Me(this.persistence.referenceDelegate instanceof Kd);const r=this.persistence.referenceDelegate.garbageCollector;return new Tx(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?zn.withCacheSize(this.cacheSizeBytes):zn.DEFAULT;return new Um(r=>Kd.Zr(r,t),this.serializer)}}class ig extends Li{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await sg(this.Ja.syncEngine),await bl(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return kx(this.persistence,new Cx,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new Tx(r,e.asyncQueue,t)}Ha(e,t){const r=new ZR(t,this.persistence);return new XR(e.asyncQueue,r)}Ga(e){const t=qm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?zn.withCacheSize(this.cacheSizeBytes):zn.DEFAULT;return new jm(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Fx(),yd(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new $x}}class eI extends ig{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof jf&&(this.sharedClientState.syncEngine={no:T2.bind(null,t),ro:P2.bind(null,t),io:R2.bind(null,t),Qi:S2.bind(null,t),eo:E2.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await A2(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=Fx();if(!jf.D(t))throw new ge(X.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=qm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new jf(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class $i{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>R0(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=w2.bind(null,this.syncEngine),await Mp(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new r2}()}createDatastore(e){const t=fc(e.databaseInfo.databaseId),r=function(i){return new Uk(i)}(e.databaseInfo);return function(i,o,a,l){return new Bk(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new Kk(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>R0(this.syncEngine,t,0),function(){return I0.D()?new I0:new Lk}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,h){const f=new c2(s,i,o,a,l,c);return h&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=Se(s);me("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await _l(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}$i.provider={build:()=>new $i};function k0(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):cn("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D2{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new Pn,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new o2(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N2{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new ge(X.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=Se(s),a={documents:i.map(f=>qu(o.serializer,f))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,it.emptyPath(),a,i.length),c=new Map;l.forEach(f=>{const g=JC(o.serializer,f);c.set(g.key.toString(),g)});const h=[];return i.forEach(f=>{const g=c.get(f.toString());Me(!!g),h.push(g)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new yl(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=Ce.fromPath(r);this.mutations.push(new Cm(s,this.precondition(s)))}),await async function(r,s){const i=Se(r),o={writes:s.map(a=>Bu(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,it.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Ne();t=Ue.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new ge(X.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Ue.min())?Ht.exists(!1):Ht.updateTime(t):Ht.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Ue.min()))throw new ge(X.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ht.updateTime(t)}return Ht.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V2{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new Km(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new N2(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!oc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!tx(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O2{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Sn.UNAUTHENTICATED,this.clientId=hw.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{me("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(me("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Pn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=xl(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Bf(n,e){n.asyncQueue.verifyOperationInProgress(),me("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await Dx(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function D0(n,e){n.asyncQueue.verifyOperationInProgress();const t=await og(n);me("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>E0(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>E0(e.remoteStore,s)),n._onlineComponents=e}async function og(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){me("FirestoreClient","Using user provided OfflineComponentProvider");try{await Bf(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===X.FAILED_PRECONDITION||s.code===X.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Cr("Error using user provided cache. Falling back to memory cache: "+t),await Bf(n,new Li)}}else me("FirestoreClient","Using default OfflineComponentProvider"),await Bf(n,new Li);return n._offlineComponents}async function Vh(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(me("FirestoreClient","Using user provided OnlineComponentProvider"),await D0(n,n._uninitializedComponentsProvider._online)):(me("FirestoreClient","Using default OnlineComponentProvider"),await D0(n,new $i))),n._onlineComponents}function tI(n){return og(n).then(e=>e.persistence)}function Il(n){return og(n).then(e=>e.localStore)}function nI(n){return Vh(n).then(e=>e.remoteStore)}function ag(n){return Vh(n).then(e=>e.syncEngine)}function rI(n){return Vh(n).then(e=>e.datastore)}async function ol(n){const e=await Vh(n),t=e.eventManager;return t.onListen=d2.bind(null,e.syncEngine),t.onUnlisten=f2.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=h2.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=p2.bind(null,e.syncEngine),t}function M2(n){return n.asyncQueue.enqueue(async()=>{const e=await tI(n),t=await nI(n);return e.setNetworkEnabled(!0),function(s){const i=Se(s);return i.L_.delete(0),pc(i)}(t)})}function L2(n){return n.asyncQueue.enqueue(async()=>{const e=await tI(n),t=await nI(n);return e.setNetworkEnabled(!1),async function(s){const i=Se(s);i.L_.add(0),await _l(i),i.q_.set("Offline")}(t)})}function $2(n,e){const t=new Pn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(c,h){const f=Se(c);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new ge(X.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=xl(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await Il(n),e,t)),t.promise}function sI(n,e,t={}){const r=new Pn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const h=new Nh({next:g=>{h.Za(),o.enqueueAndForget(()=>Ym(i,f));const y=g.docs.has(a);!y&&g.fromCache?c.reject(new ge(X.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&g.fromCache&&l&&l.source==="server"?c.reject(new ge(X.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new Zm(gl(a.path),h,{includeMetadataChanges:!0,_a:!0});return Jm(i,f)}(await ol(n),n.asyncQueue,e,t,r)),r.promise}function F2(n,e){const t=new Pn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await Gd(s,i,!0),l=new Qx(i,a.Ts),c=l.ma(a.documents),h=l.applyChanges(c,!1);o.resolve(h.snapshot)}catch(a){const l=xl(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await Il(n),e,t)),t.promise}function iI(n,e,t={}){const r=new Pn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const h=new Nh({next:g=>{h.Za(),o.enqueueAndForget(()=>Ym(i,f)),g.fromCache&&l.source==="server"?c.reject(new ge(X.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new Zm(a,h,{includeMetadataChanges:!0,_a:!0});return Jm(i,f)}(await ol(n),n.asyncQueue,e,t,r)),r.promise}function U2(n,e,t){const r=new Pn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await rI(n);r.resolve(async function(o,a,l){var c;const h=Se(o),{request:f,ut:g,parent:y}=fx(h.serializer,$w(a),l);h.connection.Fo||delete f.parent;const I=(await h.Lo("RunAggregationQuery",h.serializer.databaseId,y,f,1)).filter(P=>!!P.result);Me(I.length===1);const A=(c=I[0].result)===null||c===void 0?void 0:c.aggregateFields;return Object.keys(A).reduce((P,j)=>(P[g[j]]=A[j],P),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function j2(n,e){const t=new Nh(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){Se(s).Y_.add(i),i.next()}(await ol(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){Se(s).Y_.delete(i)}(await ol(n),t))}}function q2(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?rx().encode(o):o,function(h,f){return new D2(h,f)}(function(h,f){if(h instanceof Uint8Array)return k0(h,f);if(h instanceof ArrayBuffer)return k0(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,fc(e));n.asyncQueue.enqueueAndForget(async()=>{C2(await ag(n),s,r)})}function B2(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=Se(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await Il(n),e))}function z2(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=Se(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(c=>function(f,g,y,I,A){f=[...f],g=[...g],f.sort(y),g.sort(y);const P=f.length,j=g.length;let B=0,$=0;for(;B<j&&$<P;){const z=y(f[$],g[B]);z<0?A(f[$++]):z>0?I(g[B++]):(B++,$++)}for(;B<j;)I(g[B++]);for(;$<P;)A(f[$++])}(c,s,WR,h=>{a.push(o.addFieldIndex(l,h))},h=>{a.push(o.deleteFieldIndex(l,h))})).next(()=>G.waitFor(a)))}(await Il(n),e))}function K2(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){Se(r).ss.zi=s}(await Il(n),e))}function G2(n){return n.asyncQueue.enqueue(async()=>function(t){const r=Se(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Il(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oI(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N0=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lg(n,e,t){if(!t)throw new ge(X.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function H2(n,e,t,r){if(e===!0&&r===!0)throw new ge(X.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function V0(n){if(!Ce.isDocumentKey(n))throw new ge(X.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function O0(n){if(Ce.isDocumentKey(n))throw new ge(X.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Oh(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Ne()}function rt(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new ge(X.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Oh(n);throw new ge(X.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function aI(n,e){if(e<=0)throw new ge(X.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M0{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new ge(X.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ge(X.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}H2("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=oI((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new ge(X.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new ge(X.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new ge(X.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class mc{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new M0({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ge(X.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ge(X.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new M0(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new UR;switch(r.type){case"firstParty":return new zR(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new ge(X.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=N0.get(t);r&&(me("ComponentProvider","Removing Datastore"),N0.delete(t),r.terminate())}(this),Promise.resolve()}}function W2(n,e,t,r={}){var s;const i=(n=rt(n,mc))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Cr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=Sn.MOCK_USER;else{a=gP(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new ge(X.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Sn(c)}n._authCredentials=new jR(new cw(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new jn(this.firestore,e,this._query)}}class fn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ls(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new fn(this.firestore,e,this._key)}}class ls extends jn{constructor(e,t,r){super(e,t,gl(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new fn(this.firestore,null,new Ce(e))}withConverter(e){return new ls(this.firestore,e,this._path)}}function Je(n,e,...t){if(n=Le(n),lg("collection","path",e),n instanceof mc){const r=it.fromString(e,...t);return O0(r),new ls(n,null,r)}{if(!(n instanceof fn||n instanceof ls))throw new ge(X.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(it.fromString(e,...t));return O0(r),new ls(n.firestore,null,r)}}function Qq(n,e){if(n=rt(n,mc),lg("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new ge(X.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new jn(n,null,function(r){return new zs(it.emptyPath(),r)}(e))}function Re(n,e,...t){if(n=Le(n),arguments.length===1&&(e=hw.newId()),lg("doc","path",e),n instanceof mc){const r=it.fromString(e,...t);return V0(r),new fn(n,null,new Ce(r))}{if(!(n instanceof fn||n instanceof ls))throw new ge(X.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(it.fromString(e,...t));return V0(r),new fn(n.firestore,n instanceof ls?n.converter:null,new Ce(r))}}function Jq(n,e){return n=Le(n),e=Le(e),(n instanceof fn||n instanceof ls)&&(e instanceof fn||e instanceof ls)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function lI(n,e){return n=Le(n),e=Le(e),n instanceof jn&&e instanceof jn&&n.firestore===e.firestore&&lc(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L0{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Km(this,"async_queue_retry"),this.Vu=()=>{const r=yd();r&&me("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=yd();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=yd();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new Pn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Bi(e))throw e;me("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw cn("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Qm.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&Ne()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function Fp(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class Q2{constructor(){this._progressObserver={},this._taskCompletionResolver=new Pn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yq=-1;class kt extends mc{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new L0,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new L0(e),this._firestoreClient=void 0,await e}}}function Xq(n,e,t){t||(t="(default)");const r=ji(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(ki(i,e))return s;throw new ge(X.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new ge(X.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ge(X.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function J2(n,e){const t=typeof n=="object"?n:wm(),r=typeof n=="string"?n:e||"(default)",s=ji(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=pP("firestore");i&&W2(s,...i)}return s}function Yt(n){if(n._terminated)throw new ge(X.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||uI(n),n._firestoreClient}function uI(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,c,h){return new bC(a,l,c,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,oI(h.experimentalLongPollingOptions),h.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new O2(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function Y2(n,e){Cr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return cI(n,$i.provider,{build:r=>new ig(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function Zq(n){Cr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();cI(n,$i.provider,{build:t=>new eI(t,e.cacheSizeBytes)})}function cI(n,e,t){if((n=rt(n,kt))._firestoreClient||n._terminated)throw new ge(X.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new ge(X.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},uI(n)}function eB(n){if(n._initialized&&!n._terminated)throw new ge(X.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Pn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!os.D())return Promise.resolve();const s=r+"main";await os.delete(s)}(qm(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function tB(n){return function(t){const r=new Pn;return t.asyncQueue.enqueueAndForget(async()=>_2(await ag(t),r)),r.promise}(Yt(n=rt(n,kt)))}function nB(n){return M2(Yt(n=rt(n,kt)))}function rB(n){return L2(Yt(n=rt(n,kt)))}function sB(n){return AR(n.app,"firestore",n._databaseId.database),n._delete()}function iB(n,e){const t=Yt(n=rt(n,kt)),r=new Q2;return q2(t,n._databaseId,e,r),r}function oB(n,e){return B2(Yt(n=rt(n,kt)),e).then(t=>t?new jn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zu{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class X2{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wo{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Wo(rn.fromBase64String(e))}catch(t){throw new ge(X.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Wo(rn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zo{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new ge(X.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Gt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function aB(){return new Zo("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ea{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ug{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ge(X.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ge(X.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ke(this._lat,e._lat)||Ke(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mh{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z2=/^__.*__$/;class eD{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Gs(e,this.data,this.fieldMask,t,this.fieldTransforms):new vl(e,this.data,t,this.fieldTransforms)}}class dI{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Gs(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function hI(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ne()}}class Lh{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Lh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Jd(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(hI(this.Cu)&&Z2.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class tD{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||fc(e)}Qu(e,t,r,s=!1){return new Lh({Cu:e,methodName:t,qu:r,path:Gt.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ta(n){const e=n._freezeSettings(),t=fc(n._databaseId);return new tD(n._databaseId,!!e.ignoreUndefinedProperties,t)}function $h(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);gg("Data must be an object, but it was:",o,r);const a=mI(r,o);let l,c;if(i.merge)l=new or(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const g=Ku(e,f,t);if(!o.contains(g))throw new ge(X.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);vI(h,g)||h.push(g)}l=new or(h),c=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,c=o.fieldTransforms;return new eD(new Fn(a),l,c)}class gc extends ea{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof gc}}function fI(n,e,t){return new Lh({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class cg extends ea{_toFieldTransform(e){return new cc(e.path,new Xa)}isEqual(e){return e instanceof cg}}class dg extends ea{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=fI(this,e,!0),r=this.Ku.map(i=>na(i,t)),s=new Bo(r);return new cc(e.path,s)}isEqual(e){return e instanceof dg&&ki(this.Ku,e.Ku)}}class hg extends ea{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=fI(this,e,!0),r=this.Ku.map(i=>na(i,t)),s=new zo(r);return new cc(e.path,s)}isEqual(e){return e instanceof hg&&ki(this.Ku,e.Ku)}}class fg extends ea{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new Za(e.serializer,Hw(e.serializer,this.$u));return new cc(e.path,t)}isEqual(e){return e instanceof fg&&this.$u===e.$u}}function pg(n,e,t,r){const s=n.Qu(1,e,t);gg("Data must be an object, but it was:",s,r);const i=[],o=Fn.empty();zi(r,(l,c)=>{const h=Fh(e,l,t);c=Le(c);const f=s.Nu(h);if(c instanceof gc)i.push(h);else{const g=na(c,f);g!=null&&(i.push(h),o.set(h,g))}});const a=new or(i);return new dI(o,a,s.fieldTransforms)}function mg(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[Ku(e,r,t)],l=[s];if(i.length%2!=0)throw new ge(X.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)a.push(Ku(e,i[g])),l.push(i[g+1]);const c=[],h=Fn.empty();for(let g=a.length-1;g>=0;--g)if(!vI(c,a[g])){const y=a[g];let I=l[g];I=Le(I);const A=o.Nu(y);if(I instanceof gc)c.push(y);else{const P=na(I,A);P!=null&&(c.push(y),h.set(y,P))}}const f=new or(c);return new dI(h,f,o.fieldTransforms)}function pI(n,e,t,r=!1){return na(t,n.Qu(r?4:3,e))}function na(n,e){if(gI(n=Le(n)))return gg("Unsupported field value:",e,n),mI(n,e);if(n instanceof ea)return function(r,s){if(!hI(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=na(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Le(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Hw(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Jt.fromDate(r);return{timestampValue:el(s.serializer,i)}}if(r instanceof Jt){const i=new Jt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:el(s.serializer,i)}}if(r instanceof ug)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Wo)return{bytesValue:ox(s.serializer,r._byteString)};if(r instanceof fn){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Om(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Mh)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return Rm(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${Oh(r)}`)}(n,e)}function mI(n,e){const t={};return Tw(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):zi(n,(r,s)=>{const i=na(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function gI(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Jt||n instanceof ug||n instanceof Wo||n instanceof fn||n instanceof ea||n instanceof Mh)}function gg(n,e,t){if(!gI(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=Oh(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function Ku(n,e,t){if((e=Le(e))instanceof Zo)return e._internalPath;if(typeof e=="string")return Fh(n,e);throw Jd("Field path arguments must be of type string or ",n,!1,void 0,t)}const nD=new RegExp("[~\\*/\\[\\]]");function Fh(n,e,t){if(e.search(nD)>=0)throw Jd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Zo(...e.split("."))._internalPath}catch{throw Jd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Jd(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new ge(X.INVALID_ARGUMENT,a+n+l)}function vI(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gu{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new fn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new rD(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Uh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class rD extends Gu{data(){return super.data()}}function Uh(n,e){return typeof e=="string"?Fh(n,e):e instanceof Zo?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new ge(X.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class vg{}class vc extends vg{}function Hu(n,e,...t){let r=[];e instanceof vg&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof El).length,a=i.filter(l=>l instanceof yc).length;if(o>1||o>0&&a>0)throw new ge(X.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class yc extends vc{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new yc(e,t,r)}_apply(e){const t=this._parse(e);return bI(e._query,t),new jn(e.firestore,e.converter,Sp(e._query,t))}_parse(e){const t=ta(e.firestore);return function(i,o,a,l,c,h,f){let g;if(c.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new ge(X.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){F0(f,h);const y=[];for(const I of f)y.push($0(l,i,I));g={arrayValue:{values:y}}}else g=$0(l,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||F0(f,h),g=pI(a,o,f,h==="in"||h==="not-in");return ot.create(c,h,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Yd(n,e,t){const r=e,s=Uh("where",n);return yc._create(s,r,t)}class El extends vg{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new El(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:At.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)bI(o,l),o=Sp(o,l)}(e._query,t),new jn(e.firestore,e.converter,Sp(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function lB(...n){return n.forEach(e=>wI("or",e)),El._create("or",n)}function uB(...n){return n.forEach(e=>wI("and",e)),El._create("and",n)}class yg extends vc{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new yg(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new ge(X.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new ge(X.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ju(i,o)}(e._query,this._field,this._direction);return new jn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new zs(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function sD(n,e="asc"){const t=e,r=Uh("orderBy",n);return yg._create(r,t)}class jh extends vc{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new jh(e,t,r)}_apply(e){return new jn(e.firestore,e.converter,Ud(e._query,this._limit,this._limitType))}}function cB(n){return aI("limit",n),jh._create("limit",n,"F")}function dB(n){return aI("limitToLast",n),jh._create("limitToLast",n,"L")}class qh extends vc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new qh(e,t,r)}_apply(e){const t=_I(e,this.type,this._docOrFields,this._inclusive);return new jn(e.firestore,e.converter,function(s,i){return new zs(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function hB(...n){return qh._create("startAt",n,!0)}function fB(...n){return qh._create("startAfter",n,!1)}class Bh extends vc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Bh(e,t,r)}_apply(e){const t=_I(e,this.type,this._docOrFields,this._inclusive);return new jn(e.firestore,e.converter,function(s,i){return new zs(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function pB(...n){return Bh._create("endBefore",n,!1)}function mB(...n){return Bh._create("endAt",n,!0)}function _I(n,e,t,r){if(t[0]=Le(t[0]),t[0]instanceof Gu)return function(i,o,a,l,c){if(!l)throw new ge(X.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of La(i))if(f.field.isKeyField())h.push(jo(o,l.key));else{const g=l.data.field(f.field);if(xh(g))throw new ge(X.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){const y=f.field.canonicalString();throw new ge(X.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}h.push(g)}return new Oi(h,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=ta(n.firestore);return function(o,a,l,c,h,f){const g=o.explicitOrderBy;if(h.length>g.length)throw new ge(X.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let I=0;I<h.length;I++){const A=h[I];if(g[I].field.isKeyField()){if(typeof A!="string")throw new ge(X.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof A}`);if(!Sm(o)&&A.indexOf("/")!==-1)throw new ge(X.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${A}' contains a slash.`);const P=o.path.child(it.fromString(A));if(!Ce.isDocumentKey(P))throw new ge(X.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${P}' is not because it contains an odd number of segments.`);const j=new Ce(P);y.push(jo(a,j))}else{const P=pI(l,c,A);y.push(P)}}return new Oi(y,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function $0(n,e,t){if(typeof(t=Le(t))=="string"){if(t==="")throw new ge(X.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Sm(e)&&t.indexOf("/")!==-1)throw new ge(X.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(it.fromString(t));if(!Ce.isDocumentKey(r))throw new ge(X.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return jo(n,new Ce(r))}if(t instanceof fn)return jo(n,t._key);throw new ge(X.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Oh(t)}.`)}function F0(n,e){if(!Array.isArray(n)||n.length===0)throw new ge(X.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function bI(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new ge(X.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ge(X.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function wI(n,e){if(!(e instanceof yc||e instanceof El))throw new ge(X.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class xI{convertValue(e,t="none"){switch(Ni(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Kt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Fs(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ne()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return zi(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>Kt(o.doubleValue));return new Mh(i)}convertGeoPoint(e){return new ug(Kt(e.latitude),Kt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Ih(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp($u(e));default:return null}}convertTimestamp(e){const t=$s(e);return new Jt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=it.fromString(e);Me(vx(r));const s=new Uo(r.get(1),r.get(3)),i=new Ce(r.popFirst(5));return s.isEqual(t)||cn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zh(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class iD extends xI{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wo(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new fn(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gB(n){return new zu("sum",Ku("sum",n))}function vB(n){return new zu("avg",Ku("average",n))}function oD(){return new zu("count")}function yB(n,e){var t,r;return n instanceof zu&&e instanceof zu&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function _B(n,e){return lI(n.query,e.query)&&ki(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Do{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class al extends Gu{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new _d(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Uh("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class _d extends al{data(e={}){return super.data(e)}}class ll{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Do(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new _d(this._firestore,this._userDataWriter,r.key,r,new Do(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ge(X.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new _d(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Do(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new _d(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Do(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,h=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:aD(a.type),doc:l,oldIndex:c,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function aD(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ne()}}function bB(n,e){return n instanceof al&&e instanceof al?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof ll&&e instanceof ll&&n._firestore===e._firestore&&lI(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wt(n){n=rt(n,fn);const e=rt(n.firestore,kt);return sI(Yt(e),n._key).then(t=>_g(e,n,t))}class Gi extends xI{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wo(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new fn(this.firestore,null,t)}}function wB(n){n=rt(n,fn);const e=rt(n.firestore,kt),t=Yt(e),r=new Gi(e);return $2(t,n._key).then(s=>new al(e,r,n._key,s,new Do(s!==null&&s.hasLocalMutations,!0),n.converter))}function xB(n){n=rt(n,fn);const e=rt(n.firestore,kt);return sI(Yt(e),n._key,{source:"server"}).then(t=>_g(e,n,t))}function xt(n){n=rt(n,jn);const e=rt(n.firestore,kt),t=Yt(e),r=new Gi(e);return yI(n._query),iI(t,n._query).then(s=>new ll(e,r,n,s))}function IB(n){n=rt(n,jn);const e=rt(n.firestore,kt),t=Yt(e),r=new Gi(e);return F2(t,n._query).then(s=>new ll(e,r,n,s))}function EB(n){n=rt(n,jn);const e=rt(n.firestore,kt),t=Yt(e),r=new Gi(e);return iI(t,n._query,{source:"server"}).then(s=>new ll(e,r,n,s))}function nn(n,e,t){n=rt(n,fn);const r=rt(n.firestore,kt),s=zh(n.converter,e,t);return _c(r,[$h(ta(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Ht.none())])}function Tl(n,e,t,...r){n=rt(n,fn);const s=rt(n.firestore,kt),i=ta(s);let o;return o=typeof(e=Le(e))=="string"||e instanceof Zo?mg(i,"updateDoc",n._key,e,t,r):pg(i,"updateDoc",n._key,e),_c(s,[o.toMutation(n._key,Ht.exists(!0))])}function ul(n){return _c(rt(n.firestore,kt),[new yl(n._key,Ht.none())])}function Al(n,e){const t=rt(n.firestore,kt),r=Re(n),s=zh(n.converter,e);return _c(t,[$h(ta(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Ht.exists(!1))]).then(()=>r)}function TB(n,...e){var t,r,s;n=Le(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Fp(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Fp(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,c,h;if(n instanceof fn)c=rt(n.firestore,kt),h=gl(n._key.path),l={next:f=>{e[o]&&e[o](_g(c,n,f))},error:e[o+1],complete:e[o+2]};else{const f=rt(n,jn);c=rt(f.firestore,kt),h=f._query;const g=new Gi(c);l={next:y=>{e[o]&&e[o](new ll(c,g,f,y))},error:e[o+1],complete:e[o+2]},yI(n._query)}return function(g,y,I,A){const P=new Nh(A),j=new Zm(y,P,I);return g.asyncQueue.enqueueAndForget(async()=>Jm(await ol(g),j)),()=>{P.Za(),g.asyncQueue.enqueueAndForget(async()=>Ym(await ol(g),j))}}(Yt(c),h,a,l)}function AB(n,e){return j2(Yt(n=rt(n,kt)),Fp(e)?e:{next:e})}function _c(n,e){return function(r,s){const i=new Pn;return r.asyncQueue.enqueueAndForget(async()=>m2(await ag(r),s,i)),i.promise}(Yt(n),e)}function _g(n,e,t){const r=t.docs.get(e._key),s=new Gi(n);return new al(n,s,e._key,r,new Do(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SB(n){return lD(n,{count:oD()})}function lD(n,e){const t=rt(n.firestore,kt),r=Yt(t),s=Ew(e,(i,o)=>new ex(o,i.aggregateType,i._internalFieldPath));return U2(r,n._query,s).then(i=>function(a,l,c){const h=new Gi(a);return new X2(l,h,c)}(t,n,i))}class uD{constructor(e){this.kind="memory",this._onlineComponentProvider=$i.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=Li.provider}toJSON(){return{kind:this.kind}}}class cD{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=mD(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class dD{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Li.provider}toJSON(){return{kind:this.kind}}}class hD{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new k2(e)}}toJSON(){return{kind:this.kind}}}function PB(){return new dD}function RB(n){return new hD(n==null?void 0:n.cacheSizeBytes)}function CB(n){return new uD(n)}function kB(n){return new cD(n)}class fD{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=$i.provider,this._offlineComponentProvider={build:t=>new ig(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class pD{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=$i.provider,this._offlineComponentProvider={build:t=>new eI(t,e==null?void 0:e.cacheSizeBytes)}}}function mD(n){return new fD(n==null?void 0:n.forceOwnership)}function DB(){return new pD}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gD={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vD{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ta(e)}set(e,t,r){this._verifyNotCommitted();const s=vi(e,this._firestore),i=zh(s.converter,t,r),o=$h(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,Ht.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=vi(e,this._firestore);let o;return o=typeof(t=Le(t))=="string"||t instanceof Zo?mg(this._dataReader,"WriteBatch.update",i._key,t,r,s):pg(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Ht.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=vi(e,this._firestore);return this._mutations=this._mutations.concat(new yl(t._key,Ht.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new ge(X.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function vi(n,e){if((n=Le(n)).firestore!==e)throw new ge(X.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yD extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=ta(t)}get(t){const r=vi(t,this._firestore),s=new iD(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return Ne();const o=i[0];if(o.isFoundDocument())return new Gu(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new Gu(this._firestore,s,r._key,null,r.converter);throw Ne()})}set(t,r,s){const i=vi(t,this._firestore),o=zh(i.converter,r,s),a=$h(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=vi(t,this._firestore);let a;return a=typeof(r=Le(r))=="string"||r instanceof Zo?mg(this._dataReader,"Transaction.update",o._key,r,s,i):pg(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=vi(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=vi(e,this._firestore),r=new Gi(this._firestore);return super.get(e).then(s=>new al(this._firestore,r,t._key,s._document,new Do(!1,!1),t.converter))}}function VB(n,e,t){n=rt(n,kt);const r=Object.assign(Object.assign({},gD),t);return function(i){if(i.maxAttempts<1)throw new ge(X.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new Pn;return i.asyncQueue.enqueueAndForget(async()=>{const c=await rI(i);new V2(i.asyncQueue,c,a,o,l).au()}),l.promise}(Yt(n),s=>e(new yD(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OB(){return new gc("deleteField")}function Hi(){return new cg("serverTimestamp")}function _D(...n){return new dg("arrayUnion",n)}function MB(...n){return new hg("arrayRemove",n)}function LB(n){return new fg("increment",n)}function $B(n){return new Mh(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bg(n){return Yt(n=rt(n,kt)),new vD(n,e=>_c(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FB(n,e){const t=Yt(n=rt(n,kt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Cr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(c){try{return JSON.parse(c)}catch(h){throw new ge(X.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const c=U0(l,"collectionGroup"),h=[];if(Array.isArray(l.fields))for(const f of l.fields){const g=Fh("setIndexConfiguration",U0(f,"fieldPath"));f.arrayConfig==="CONTAINS"?h.push(new Lo(g,2)):f.order==="ASCENDING"?h.push(new Lo(g,0)):f.order==="DESCENDING"&&h.push(new Lo(g,1))}a.push(new Wa(Wa.UNKNOWN_ID,c,h,Qa.empty()))}return a}(e);return z2(t,r)}function U0(n,e){if(typeof n[e]!="string")throw new ge(X.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bD{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function UB(n){var e;n=rt(n,kt);const t=j0.get(n);if(t)return t;if(((e=Yt(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new bD(n);return j0.set(n,r),r}function jB(n){II(n,!0)}function qB(n){II(n,!1)}function BB(n){G2(Yt(n._firestore)).then(e=>me("deleting all persistent cache indexes succeeded")).catch(e=>Cr("deleting all persistent cache indexes failed",e))}function II(n,e){K2(Yt(n._firestore),e).then(t=>me(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>Cr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const j0=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zB(n){var e;const t=(e=Yt(rt(n.firestore,kt))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:Sh(t,Qn(n._query))._t}function KB(n,e){var t;const r=Ew(e,(i,o)=>new ex(o,i.aggregateType,i._internalFieldPath)),s=(t=Yt(rt(n.firestore,kt))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:fx(s,$w(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GB{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return wg.instance.onExistenceFilterMismatch(e)}}class wg{constructor(){this.Uu=new Map}static get instance(){return td||(td=new wg,function(t){if(jd)throw new Error("a TestingHooksSpi instance is already set");jd=t}(td)),td}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let td=null;(function(e,t=!0){(function(s){ml=s})(pl),ds(new qr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new kt(new qR(r.getProvider("auth-internal")),new KR(r.getProvider("app-check-internal")),function(c,h){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new ge(X.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Uo(c.options.projectId,h)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Pr(Cy,"4.7.3",e),Pr(Cy,"4.7.3","esm2017")})();function xg(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HB={PHONE:"phone",TOTP:"totp"},WB={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},QB={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},JB={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},YB={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wD(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function EI(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const XB=wD,xD=EI,TI=new Xo("auth","Firebase",EI()),ZB={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xd=new _m("@firebase/auth");function ID(n,...e){Xd.logLevel<=st.WARN&&Xd.warn(`Auth (${pl}): ${n}`,...e)}function bd(n,...e){Xd.logLevel<=st.ERROR&&Xd.error(`Auth (${pl}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lr(n,...e){throw Eg(n,...e)}function tr(n,...e){return Eg(n,...e)}function Ig(n,e,t){const r=Object.assign(Object.assign({},xD()),{[e]:t});return new Xo("auth","Firebase",r).create(e,{appName:n.name})}function Rn(n){return Ig(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Sl(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&lr(n,"argument-error"),Ig(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Eg(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return TI.create(n,...e)}function Ie(n,e,...t){if(!n)throw Eg(e,...t)}function ss(n){const e="INTERNAL ASSERTION FAILED: "+n;throw bd(e),new Error(e)}function Us(n,e){n||ss(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wu(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Tg(){return q0()==="http:"||q0()==="https:"}function q0(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ED(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Tg()||bP()||"connection"in navigator)?navigator.onLine:!0}function TD(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bc{constructor(e,t){this.shortDelay=e,this.longDelay=t,Us(t>e,"Short delay should be less than long delay!"),this.isMobile=vP()||wP()}get(){return ED()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ag(n,e){Us(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AI{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ss("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ss("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ss("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AD={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SD=new bc(3e4,6e4);function Ft(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Ut(n,e,t,r,s={}){return SI(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=fl(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},i);return _P()||(c.referrerPolicy="no-referrer"),AI.fetch()(PI(n,n.config.apiHost,t,a),c)})}async function SI(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},AD),e);try{const s=new RD(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw lu(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw lu(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw lu(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw lu(n,"user-disabled",o);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw Ig(n,h,c);lr(n,h)}}catch(s){if(s instanceof fs)throw s;lr(n,"network-request-failed",{message:String(s)})}}async function Ws(n,e,t,r,s={}){const i=await Ut(n,e,t,r,s);return"mfaPendingCredential"in i&&lr(n,"multi-factor-auth-required",{_serverResponse:i}),i}function PI(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?Ag(n.config,s):`${n.config.apiScheme}://${s}`}function PD(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class RD{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(tr(this.auth,"network-request-failed")),SD.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function lu(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=tr(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B0(n){return n!==void 0&&n.getResponse!==void 0}function z0(n){return n!==void 0&&n.enterprise!==void 0}class RI{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return PD(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CD(n){return(await Ut(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function CI(n,e){return Ut(n,"GET","/v2/recaptchaConfig",Ft(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kD(n,e){return Ut(n,"POST","/v1/accounts:delete",e)}async function DD(n,e){return Ut(n,"POST","/v1/accounts:update",e)}async function kI(n,e){return Ut(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tu(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e9(n,e=!1){return Le(n).getIdToken(e)}async function ND(n,e=!1){const t=Le(n),r=await t.getIdToken(e),s=Kh(r);Ie(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Tu(zf(s.auth_time)),issuedAtTime:Tu(zf(s.iat)),expirationTime:Tu(zf(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function zf(n){return Number(n)*1e3}function Kh(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return bd("JWT malformed, contained fewer than 3 sections"),null;try{const s=Hb(t);return s?JSON.parse(s):(bd("Failed to decode base64 JWT payload"),null)}catch(s){return bd("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function K0(n){const e=Kh(n);return Ie(e,"internal-error"),Ie(typeof e.exp<"u","internal-error"),Ie(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function js(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof fs&&VD(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function VD({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OD{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Up{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Tu(this.lastLoginAt),this.creationTime=Tu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qu(n){var e;const t=n.auth,r=await n.getIdToken(),s=await js(n,kI(t,{idToken:r}));Ie(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?DI(i.providerUserInfo):[],a=LD(n.providerData,o),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),h=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Up(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,f)}async function MD(n){const e=Le(n);await Qu(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function LD(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function DI(n){return n.map(e=>{var{providerId:t}=e,r=xg(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $D(n,e){const t=await SI(n,{},async()=>{const r=fl({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=PI(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",AI.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function FD(n,e){return Ut(n,"POST","/v2/accounts:revokeToken",Ft(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fa{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ie(e.idToken,"internal-error"),Ie(typeof e.idToken<"u","internal-error"),Ie(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):K0(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ie(e.length!==0,"internal-error");const t=K0(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Ie(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await $D(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new Fa;return r&&(Ie(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(Ie(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(Ie(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Fa,this.toJSON())}_performRefresh(){return ss("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ci(n,e){Ie(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Rs{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=xg(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new OD(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Up(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await js(this,this.stsTokenManager.getToken(this.auth,e));return Ie(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return ND(this,e)}reload(){return MD(this)}_assign(e){this!==e&&(Ie(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Rs(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Ie(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Qu(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(dn(this.auth.app))return Promise.reject(Rn(this.auth));const e=await this.getIdToken();return await js(this,kD(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,c,h;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,g=(s=t.email)!==null&&s!==void 0?s:void 0,y=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,I=(o=t.photoURL)!==null&&o!==void 0?o:void 0,A=(a=t.tenantId)!==null&&a!==void 0?a:void 0,P=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,j=(c=t.createdAt)!==null&&c!==void 0?c:void 0,B=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:$,emailVerified:z,isAnonymous:he,providerData:ve,stsTokenManager:T}=t;Ie($&&T,e,"internal-error");const w=Fa.fromJSON(this.name,T);Ie(typeof $=="string",e,"internal-error"),ci(f,e.name),ci(g,e.name),Ie(typeof z=="boolean",e,"internal-error"),Ie(typeof he=="boolean",e,"internal-error"),ci(y,e.name),ci(I,e.name),ci(A,e.name),ci(P,e.name),ci(j,e.name),ci(B,e.name);const E=new Rs({uid:$,auth:e,email:g,emailVerified:z,displayName:f,isAnonymous:he,photoURL:I,phoneNumber:y,tenantId:A,stsTokenManager:w,createdAt:j,lastLoginAt:B});return ve&&Array.isArray(ve)&&(E.providerData=ve.map(D=>Object.assign({},D))),P&&(E._redirectEventId=P),E}static async _fromIdTokenResponse(e,t,r=!1){const s=new Fa;s.updateFromServerResponse(t);const i=new Rs({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Qu(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];Ie(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?DI(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new Fa;a.updateFromIdToken(r);const l=new Rs({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Up(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G0=new Map;function Cs(n){Us(n instanceof Function,"Expected a class definition");let e=G0.get(n);return e?(Us(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,G0.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NI{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}NI.type="NONE";const H0=NI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wd(n,e,t){return`firebase:${n}:${e}:${t}`}class Ua{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=wd(this.userKey,s.apiKey,i),this.fullPersistenceKey=wd("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Rs._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Ua(Cs(H0),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||Cs(H0);const o=wd(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const h=await c._get(o);if(h){const f=Rs._fromJSON(e,h);c!==i&&(a=f),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Ua(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new Ua(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W0(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(LI(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(VI(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(FI(e))return"Blackberry";if(UI(e))return"Webos";if(OI(e))return"Safari";if((e.includes("chrome/")||MI(e))&&!e.includes("edge/"))return"Chrome";if($I(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function VI(n=wn()){return/firefox\//i.test(n)}function OI(n=wn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function MI(n=wn()){return/crios\//i.test(n)}function LI(n=wn()){return/iemobile/i.test(n)}function $I(n=wn()){return/android/i.test(n)}function FI(n=wn()){return/blackberry/i.test(n)}function UI(n=wn()){return/webos/i.test(n)}function Sg(n=wn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function UD(n=wn()){var e;return Sg(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function jD(){return xP()&&document.documentMode===10}function jI(n=wn()){return Sg(n)||$I(n)||UI(n)||FI(n)||/windows phone/i.test(n)||LI(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qI(n,e=[]){let t;switch(n){case"Browser":t=W0(wn());break;case"Worker":t=`${W0(wn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${pl}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qD{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BD(n,e={}){return Ut(n,"GET","/v2/passwordPolicy",Ft(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zD=6;class KD{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:zD,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GD{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Q0(this),this.idTokenSubscription=new Q0(this),this.beforeStateQueue=new qD(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=TI,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Cs(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await Ua.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await kI(this,{idToken:e}),r=await Rs._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(dn(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return Ie(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Qu(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=TD()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(dn(this.app))return Promise.reject(Rn(this));const t=e?Le(e):null;return t&&Ie(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ie(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return dn(this.app)?Promise.reject(Rn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return dn(this.app)?Promise.reject(Rn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Cs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await BD(this),t=new KD(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Xo("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await FD(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Cs(e)||this._popupRedirectResolver;Ie(t,this,"argument-error"),this.redirectPersistenceManager=await Ua.create(this,[Cs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ie(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ie(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=qI(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&ID(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function sn(n){return Le(n)}class Q0{constructor(e){this.auth=e,this.observer=null,this.addObserver=PP(t=>this.observer=t)}get next(){return Ie(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function HD(n){wc=n}function Pg(n){return wc.loadJS(n)}function WD(){return wc.recaptchaV2Script}function QD(){return wc.recaptchaEnterpriseScript}function JD(){return wc.gapiScript}function BI(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const YD="recaptcha-enterprise",XD="NO_RECAPTCHA";class zI{constructor(e){this.type=YD,this.auth=sn(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{CI(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new RI(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;z0(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(XD)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&z0(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=QD();l.length!==0&&(l+=a),Pg(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function J0(n,e,t,r=!1){const s=new zI(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Ju(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await J0(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await J0(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function ZD(n){const e=sn(n),t=await CI(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new RI(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new zI(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eN(n,e){const t=ji(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(ki(i,e??{}))return s;lr(s,"already-initialized")}return t.initialize({options:e})}function tN(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Cs);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function nN(n,e,t){const r=sn(n);Ie(r._canInitEmulator,r,"emulator-config-failed"),Ie(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=KI(e),{host:o,port:a}=rN(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||sN()}function KI(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function rN(n){const e=KI(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Y0(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:Y0(o)}}}function Y0(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function sN(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ss("not implemented")}_getIdTokenResponse(e){return ss("not implemented")}_linkToIdToken(e,t){return ss("not implemented")}_getReauthenticationResolver(e){return ss("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GI(n,e){return Ut(n,"POST","/v1/accounts:resetPassword",Ft(n,e))}async function iN(n,e){return Ut(n,"POST","/v1/accounts:update",e)}async function oN(n,e){return Ut(n,"POST","/v1/accounts:signUp",e)}async function aN(n,e){return Ut(n,"POST","/v1/accounts:update",Ft(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lN(n,e){return Ws(n,"POST","/v1/accounts:signInWithPassword",Ft(n,e))}async function Gh(n,e){return Ut(n,"POST","/v1/accounts:sendOobCode",Ft(n,e))}async function uN(n,e){return Gh(n,e)}async function cN(n,e){return Gh(n,e)}async function dN(n,e){return Gh(n,e)}async function hN(n,e){return Gh(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fN(n,e){return Ws(n,"POST","/v1/accounts:signInWithEmailLink",Ft(n,e))}async function pN(n,e){return Ws(n,"POST","/v1/accounts:signInWithEmailLink",Ft(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yu extends xc{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Yu(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Yu(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ju(e,t,"signInWithPassword",lN);case"emailLink":return fN(e,{email:this._email,oobCode:this._password});default:lr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ju(e,r,"signUpPassword",oN);case"emailLink":return pN(e,{idToken:t,email:this._email,oobCode:this._password});default:lr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vs(n,e){return Ws(n,"POST","/v1/accounts:signInWithIdp",Ft(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mN="http://localhost";class qs extends xc{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new qs(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):lr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=xg(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new qs(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Vs(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Vs(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Vs(e,t)}buildRequest(){const e={requestUri:mN,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=fl(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gN(n,e){return Ut(n,"POST","/v1/accounts:sendVerificationCode",Ft(n,e))}async function vN(n,e){return Ws(n,"POST","/v1/accounts:signInWithPhoneNumber",Ft(n,e))}async function yN(n,e){const t=await Ws(n,"POST","/v1/accounts:signInWithPhoneNumber",Ft(n,e));if(t.temporaryProof)throw lu(n,"account-exists-with-different-credential",t);return t}const _N={USER_NOT_FOUND:"user-not-found"};async function bN(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return Ws(n,"POST","/v1/accounts:signInWithPhoneNumber",Ft(n,t),_N)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o extends xc{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new $o({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new $o({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return vN(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return yN(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return bN(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new $o({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wN(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function xN(n){const e=nu(ru(n)).link,t=e?nu(ru(e)).deep_link_id:null,r=nu(ru(n)).deep_link_id;return(r?nu(ru(r)).link:null)||r||t||e||n}class Ic{constructor(e){var t,r,s,i,o,a;const l=nu(ru(e)),c=(t=l.apiKey)!==null&&t!==void 0?t:null,h=(r=l.oobCode)!==null&&r!==void 0?r:null,f=wN((s=l.mode)!==null&&s!==void 0?s:null);Ie(c&&h&&f,"argument-error"),this.apiKey=c,this.operation=f,this.code=h,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=xN(e);try{return new Ic(t)}catch{return null}}}function t9(n){return Ic.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ra{constructor(){this.providerId=ra.PROVIDER_ID}static credential(e,t){return Yu._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Ic.parseLink(t);return Ie(r,"argument-error"),Yu._fromEmailAndCode(e,r.code,r.tenantId)}}ra.PROVIDER_ID="password";ra.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ra.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qs{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pl extends Qs{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class xd extends Pl{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return Ie("providerId"in t&&"signInMethod"in t,"argument-error"),qs._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return Ie(e.idToken||e.accessToken,"argument-error"),qs._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return xd.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return xd.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new xd(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yi extends Pl{constructor(){super("facebook.com")}static credential(e){return qs._fromParams({providerId:yi.PROVIDER_ID,signInMethod:yi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return yi.credentialFromTaggedObject(e)}static credentialFromError(e){return yi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return yi.credential(e.oauthAccessToken)}catch{return null}}}yi.FACEBOOK_SIGN_IN_METHOD="facebook.com";yi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _i extends Pl{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return qs._fromParams({providerId:_i.PROVIDER_ID,signInMethod:_i.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return _i.credentialFromTaggedObject(e)}static credentialFromError(e){return _i.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return _i.credential(t,r)}catch{return null}}}_i.GOOGLE_SIGN_IN_METHOD="google.com";_i.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bi extends Pl{constructor(){super("github.com")}static credential(e){return qs._fromParams({providerId:bi.PROVIDER_ID,signInMethod:bi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return bi.credentialFromTaggedObject(e)}static credentialFromError(e){return bi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return bi.credential(e.oauthAccessToken)}catch{return null}}}bi.GITHUB_SIGN_IN_METHOD="github.com";bi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IN="http://localhost";class Xu extends xc{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Vs(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Vs(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Vs(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new Xu(r,i)}static _create(e,t){return new Xu(e,t)}buildRequest(){return{requestUri:IN,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EN="saml.";class jp extends Qs{constructor(e){Ie(e.startsWith(EN),"argument-error"),super(e)}static credentialFromResult(e){return jp.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return jp.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Xu.fromJSON(e);return Ie(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Xu._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wi extends Pl{constructor(){super("twitter.com")}static credential(e,t){return qs._fromParams({providerId:wi.PROVIDER_ID,signInMethod:wi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return wi.credentialFromTaggedObject(e)}static credentialFromError(e){return wi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return wi.credential(t,r)}catch{return null}}}wi.TWITTER_SIGN_IN_METHOD="twitter.com";wi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HI(n,e){return Ws(n,"POST","/v1/accounts:signUp",Ft(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Rs._fromIdTokenResponse(e,r,s),o=X0(r);return new kr({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=X0(r);return new kr({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function X0(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TN(n){var e;if(dn(n.app))return Promise.reject(Rn(n));const t=sn(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new kr({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await HI(t,{returnSecureToken:!0}),s=await kr._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zd extends fs{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Zd.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Zd(e,t,r,s)}}function WI(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Zd._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QI(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function n9(n,e){const t=Le(n);await Hh(!0,t,e);const{providerUserInfo:r}=await DD(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=QI(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Rg(n,e,t=!1){const r=await js(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return kr._forOperation(n,"link",r)}async function Hh(n,e,t){await Qu(e);const r=QI(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";Ie(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JI(n,e,t=!1){const{auth:r}=n;if(dn(r.app))return Promise.reject(Rn(r));const s="reauthenticate";try{const i=await js(n,WI(r,s,e,n),t);Ie(i.idToken,r,"internal-error");const o=Kh(i.idToken);Ie(o,r,"internal-error");const{sub:a}=o;return Ie(n.uid===a,r,"user-mismatch"),kr._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&lr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YI(n,e,t=!1){if(dn(n.app))return Promise.reject(Rn(n));const r="signIn",s=await WI(n,r,e),i=await kr._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function Cg(n,e){return YI(sn(n),e)}async function AN(n,e){const t=Le(n);return await Hh(!1,t,e.providerId),Rg(t,e)}async function SN(n,e){return JI(Le(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PN(n,e){return Ws(n,"POST","/v1/accounts:signInWithCustomToken",Ft(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function r9(n,e){if(dn(n.app))return Promise.reject(Rn(n));const t=sn(n),r=await PN(t,{token:e,returnSecureToken:!0}),s=await kr._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ec{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?kg._fromServerResponse(e,t):"totpInfo"in t?Dg._fromServerResponse(e,t):lr(e,"internal-error")}}class kg extends Ec{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new kg(t)}}class Dg extends Ec{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Dg(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wh(n,e,t){var r;Ie(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),Ie(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(Ie(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(Ie(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ng(n){const e=sn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function RN(n,e,t){const r=sn(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Wh(r,s,t),await Ju(r,s,"getOobCode",cN)}async function CN(n,e,t){await GI(Le(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Ng(n),r})}async function s9(n,e){await aN(Le(n),{oobCode:e})}async function kN(n,e){const t=Le(n),r=await GI(t,{oobCode:e}),s=r.requestType;switch(Ie(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":Ie(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":Ie(r.mfaInfo,t,"internal-error");default:Ie(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Ec._fromServerResponse(sn(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function i9(n,e){const{data:t}=await kN(Le(n),e);return t.email}async function DN(n,e,t){if(dn(n.app))return Promise.reject(Rn(n));const r=sn(n),o=await Ju(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",HI).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Ng(n),l}),a=await kr._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function NN(n,e,t){return dn(n.app)?Promise.reject(Rn(n)):Cg(Le(n),ra.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Ng(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function o9(n,e,t){const r=sn(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){Ie(a.handleCodeInApp,r,"argument-error"),a&&Wh(r,o,a)}i(s,t),await Ju(r,s,"getOobCode",dN)}function a9(n,e){const t=Ic.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function l9(n,e,t){if(dn(n.app))return Promise.reject(Rn(n));const r=Le(n),s=ra.credentialWithLink(e,t||Wu());return Ie(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Cg(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VN(n,e){return Ut(n,"POST","/v1/accounts:createAuthUri",Ft(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function u9(n,e){const t=Tg()?Wu():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await VN(Le(n),r);return s||[]}async function c9(n,e){const t=Le(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Wh(t.auth,s,e);const{email:i}=await uN(t.auth,s);i!==n.email&&await n.reload()}async function d9(n,e,t){const r=Le(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Wh(r.auth,i,t);const{email:o}=await hN(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ON(n,e){return Ut(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function h9(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=Le(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await js(r,ON(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function MN(n,e){const t=Le(n);return dn(t.auth.app)?Promise.reject(Rn(t.auth)):XI(t,e,null)}function LN(n,e){return XI(Le(n),null,e)}async function XI(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await js(n,iN(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $N(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=Kh(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new ja(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new FN(i,s);case"github.com":return new UN(i,s);case"google.com":return new jN(i,s);case"twitter.com":return new qN(i,s,n.screenName||null);case"custom":case"anonymous":return new ja(i,null);default:return new ja(i,r,s)}}class ja{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class ZI extends ja{constructor(e,t,r,s){super(e,t,r),this.username=s}}class FN extends ja{constructor(e,t){super(e,"facebook.com",t)}}class UN extends ZI{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class jN extends ja{constructor(e,t){super(e,"google.com",t)}}class qN extends ZI{constructor(e,t,r){super(e,"twitter.com",t,r)}}function f9(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:$N(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BN(n,e){return Le(n).setPersistence(e)}function p9(n){return ZD(n)}async function m9(n,e){return sn(n).validatePassword(e)}function zN(n,e,t,r){return Le(n).onIdTokenChanged(e,t,r)}function KN(n,e,t){return Le(n).beforeAuthStateChanged(e,t)}function GN(n,e,t,r){return Le(n).onAuthStateChanged(e,t,r)}function g9(n){Le(n).useDeviceLanguage()}function v9(n,e){return Le(n).updateCurrentUser(e)}function HN(n){return Le(n).signOut()}function y9(n,e){return sn(n).revokeAccessToken(e)}async function _9(n){return Le(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class No{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new No("enroll",e,t)}static _fromMfaPendingCredential(e){return new No("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return No._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return No._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vg{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=sn(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Ec._fromServerResponse(r,a));Ie(s.mfaPendingCredential,r,"internal-error");const o=No._fromMfaPendingCredential(s.mfaPendingCredential);return new Vg(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const c=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const h=await kr._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return Ie(t.user,r,"internal-error"),kr._forOperation(t.user,t.operationType,c);default:lr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function b9(n,e){var t;const r=Le(n),s=e;return Ie(e.customData.operationType,r,"argument-error"),Ie((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),Vg._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WN(n,e){return Ut(n,"POST","/v2/accounts/mfaEnrollment:start",Ft(n,e))}function QN(n,e){return Ut(n,"POST","/v2/accounts/mfaEnrollment:finalize",Ft(n,e))}function JN(n,e){return Ut(n,"POST","/v2/accounts/mfaEnrollment:start",Ft(n,e))}function YN(n,e){return Ut(n,"POST","/v2/accounts/mfaEnrollment:finalize",Ft(n,e))}function XN(n,e){return Ut(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Ft(n,e))}class Og{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Ec._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new Og(e)}async getSession(){return No._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await js(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await js(this.user,XN(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const Kf=new WeakMap;function w9(n){const e=Le(n);return Kf.has(e)||Kf.set(e,Og._fromUser(e)),Kf.get(e)}const eh="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eE{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(eh,"1"),this.storage.removeItem(eh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZN=1e3,eV=10;class tE extends eE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=jI(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);jD()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,eV):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},ZN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}tE.type="LOCAL";const nE=tE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rE extends eE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}rE.type="SESSION";const sE=rE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tV(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Qh(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await tV(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Qh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jh(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nV{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=Jh("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const g=f;if(g.data.eventId===c)switch(g.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(g.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vn(){return window}function rV(n){vn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mg(){return typeof vn().WorkerGlobalScope<"u"&&typeof vn().importScripts=="function"}async function sV(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function iV(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function oV(){return Mg()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iE="firebaseLocalStorageDb",aV=1,th="firebaseLocalStorage",oE="fbase_key";class Tc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Yh(n,e){return n.transaction([th],e?"readwrite":"readonly").objectStore(th)}function lV(){const n=indexedDB.deleteDatabase(iE);return new Tc(n).toPromise()}function qp(){const n=indexedDB.open(iE,aV);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(th,{keyPath:oE})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(th)?e(r):(r.close(),await lV(),e(await qp()))})})}async function Z0(n,e,t){const r=Yh(n,!0).put({[oE]:e,value:t});return new Tc(r).toPromise()}async function uV(n,e){const t=Yh(n,!1).get(e),r=await new Tc(t).toPromise();return r===void 0?null:r.value}function e_(n,e){const t=Yh(n,!0).delete(e);return new Tc(t).toPromise()}const cV=800,dV=3;class aE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await qp(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>dV)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Mg()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Qh._getInstance(oV()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await sV(),!this.activeServiceWorker)return;this.sender=new nV(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||iV()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await qp();return await Z0(e,eh,"1"),await e_(e,eh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Z0(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>uV(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>e_(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Yh(s,!1).getAll();return new Tc(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),cV)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}aE.type="LOCAL";const hV=aE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fV(n,e){return Ut(n,"POST","/v2/accounts/mfaSignIn:start",Ft(n,e))}function pV(n,e){return Ut(n,"POST","/v2/accounts/mfaSignIn:finalize",Ft(n,e))}function mV(n,e){return Ut(n,"POST","/v2/accounts/mfaSignIn:finalize",Ft(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gV=500,vV=6e4,nd=1e12;class yV{constructor(e){this.auth=e,this.counter=nd,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new _V(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||nd;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||nd;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||nd;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class _V{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;Ie(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=bV(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},vV)},gV))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function bV(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gf=BI("rcb"),wV=new bc(3e4,6e4);class xV{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=vn().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return Ie(IV(t),e,"argument-error"),this.shouldResolveImmediately(t)&&B0(vn().grecaptcha)?Promise.resolve(vn().grecaptcha):new Promise((r,s)=>{const i=vn().setTimeout(()=>{s(tr(e,"network-request-failed"))},wV.get());vn()[Gf]=()=>{vn().clearTimeout(i),delete vn()[Gf];const a=vn().grecaptcha;if(!a||!B0(a)){s(tr(e,"internal-error"));return}const l=a.render;a.render=(c,h)=>{const f=l(c,h);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${WD()}?${fl({onload:Gf,render:"explicit",hl:t})}`;Pg(o).catch(()=>{clearTimeout(i),s(tr(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=vn().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function IV(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class EV{async load(e){return new yV(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lE="recaptcha",TV={theme:"light",type:"image"};class x9{constructor(e,t,r=Object.assign({},TV)){this.parameters=r,this.type=lE,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=sn(e),this.isInvisible=this.parameters.size==="invisible",Ie(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;Ie(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new EV:new xV,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){Ie(!this.parameters.sitekey,this.auth,"argument-error"),Ie(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Ie(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=vn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){Ie(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Ie(Tg()&&!Mg(),this.auth,"internal-error"),await AV(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await CD(this.auth);Ie(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Ie(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function AV(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lg{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=$o._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function I9(n,e,t){if(dn(n.app))return Promise.reject(Rn(n));const r=sn(n),s=await Xh(r,e,Le(t));return new Lg(s,i=>Cg(r,i))}async function E9(n,e,t){const r=Le(n);await Hh(!1,r,"phone");const s=await Xh(r.auth,e,Le(t));return new Lg(s,i=>AN(r,i))}async function T9(n,e,t){const r=Le(n);if(dn(r.auth.app))return Promise.reject(Rn(r.auth));const s=await Xh(r.auth,e,Le(t));return new Lg(s,i=>SN(r,i))}async function Xh(n,e,t){var r;const s=await t.verify();try{Ie(typeof s=="string",n,"argument-error"),Ie(t.type===lE,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return Ie(o.type==="enroll",n,"internal-error"),(await WN(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{Ie(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return Ie(a,n,"missing-multi-factor-info"),(await fV(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await gN(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function A9(n,e){const t=Le(n);if(dn(t.auth.app))return Promise.reject(Rn(t.auth));await Rg(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qa{constructor(e){this.providerId=qa.PROVIDER_ID,this.auth=sn(e)}verifyPhoneNumber(e,t){return Xh(this.auth,e,Le(t))}static credential(e,t){return $o._fromVerification(e,t)}static credentialFromResult(e){const t=e;return qa.credentialFromTaggedObject(t)}static credentialFromError(e){return qa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?$o._fromTokenResponse(t,r):null}}qa.PROVIDER_ID="phone";qa.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sa(n,e){return e?Cs(e):(Ie(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $g extends xc{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Vs(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Vs(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Vs(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function SV(n){return YI(n.auth,new $g(n),n.bypassAuthState)}function PV(n){const{auth:e,user:t}=n;return Ie(t,e,"internal-error"),JI(t,new $g(n),n.bypassAuthState)}async function RV(n){const{auth:e,user:t}=n;return Ie(t,e,"internal-error"),Rg(t,new $g(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uE{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return SV;case"linkViaPopup":case"linkViaRedirect":return RV;case"reauthViaPopup":case"reauthViaRedirect":return PV;default:lr(this.auth,"internal-error")}}resolve(e){Us(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Us(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CV=new bc(2e3,1e4);async function S9(n,e,t){if(dn(n.app))return Promise.reject(tr(n,"operation-not-supported-in-this-environment"));const r=sn(n);Sl(n,e,Qs);const s=sa(r,t);return new ks(r,"signInViaPopup",e,s).executeNotNull()}async function P9(n,e,t){const r=Le(n);if(dn(r.auth.app))return Promise.reject(tr(r.auth,"operation-not-supported-in-this-environment"));Sl(r.auth,e,Qs);const s=sa(r.auth,t);return new ks(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function R9(n,e,t){const r=Le(n);Sl(r.auth,e,Qs);const s=sa(r.auth,t);return new ks(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class ks extends uE{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,ks.currentPopupAction&&ks.currentPopupAction.cancel(),ks.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ie(e,this.auth,"internal-error"),e}async onExecution(){Us(this.filter.length===1,"Popup operations only handle one event");const e=Jh();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(tr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(tr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ks.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(tr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,CV.get())};e()}}ks.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kV="pendingRedirect",Id=new Map;class DV extends uE{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Id.get(this.auth._key());if(!e){try{const r=await NV(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Id.set(this.auth._key(),e)}return this.bypassAuthState||Id.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function NV(n,e){const t=dE(e),r=cE(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function Fg(n,e){return cE(n)._set(dE(e),"true")}function VV(n,e){Id.set(n._key(),e)}function cE(n){return Cs(n._redirectPersistence)}function dE(n){return wd(kV,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C9(n,e,t){return OV(n,e,t)}async function OV(n,e,t){if(dn(n.app))return Promise.reject(Rn(n));const r=sn(n);Sl(n,e,Qs),await r._initializationPromise;const s=sa(r,t);return await Fg(s,r),s._openRedirect(r,e,"signInViaRedirect")}function k9(n,e,t){return MV(n,e,t)}async function MV(n,e,t){const r=Le(n);if(Sl(r.auth,e,Qs),dn(r.auth.app))return Promise.reject(Rn(r.auth));await r.auth._initializationPromise;const s=sa(r.auth,t);await Fg(s,r.auth);const i=await fE(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function D9(n,e,t){return LV(n,e,t)}async function LV(n,e,t){const r=Le(n);Sl(r.auth,e,Qs),await r.auth._initializationPromise;const s=sa(r.auth,t);await Hh(!1,r,e.providerId),await Fg(s,r.auth);const i=await fE(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function N9(n,e){return await sn(n)._initializationPromise,hE(n,e,!1)}async function hE(n,e,t=!1){if(dn(n.app))return Promise.reject(Rn(n));const r=sn(n),s=sa(r,e),o=await new DV(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function fE(n){const e=Jh(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $V=10*60*1e3;class FV{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!UV(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!pE(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(tr(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=$V&&this.cachedEventUids.clear(),this.cachedEventUids.has(t_(e))}saveEventToCache(e){this.cachedEventUids.add(t_(e)),this.lastProcessedEventTime=Date.now()}}function t_(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function pE({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function UV(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return pE(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jV(n,e={}){return Ut(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qV=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,BV=/^https?/;async function zV(n){if(n.config.emulator)return;const{authorizedDomains:e}=await jV(n);for(const t of e)try{if(KV(t))return}catch{}lr(n,"unauthorized-domain")}function KV(n){const e=Wu(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!BV.test(t))return!1;if(qV.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GV=new bc(3e4,6e4);function n_(){const n=vn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function HV(n){return new Promise((e,t)=>{var r,s,i;function o(){n_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{n_(),t(tr(n,"network-request-failed"))},timeout:GV.get()})}if(!((s=(r=vn().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=vn().gapi)===null||i===void 0)&&i.load)o();else{const a=BI("iframefcb");return vn()[a]=()=>{gapi.load?o():t(tr(n,"network-request-failed"))},Pg(`${JD()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw Ed=null,e})}let Ed=null;function WV(n){return Ed=Ed||HV(n),Ed}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QV=new bc(5e3,15e3),JV="__/auth/iframe",YV="emulator/auth/iframe",XV={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ZV=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function eO(n){const e=n.config;Ie(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Ag(e,YV):`https://${n.config.authDomain}/${JV}`,r={apiKey:e.apiKey,appName:n.name,v:pl},s=ZV.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${fl(r).slice(1)}`}async function tO(n){const e=await WV(n),t=vn().gapi;return Ie(t,n,"internal-error"),e.open({where:document.body,url:eO(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:XV,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=tr(n,"network-request-failed"),a=vn().setTimeout(()=>{i(o)},QV.get());function l(){vn().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nO={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},rO=500,sO=600,iO="_blank",oO="http://localhost";class r_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function aO(n,e,t,r=rO,s=sO){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},nO),{width:r.toString(),height:s.toString(),top:i,left:o}),c=wn().toLowerCase();t&&(a=MI(c)?iO:t),VI(c)&&(e=e||oO,l.scrollbars="yes");const h=Object.entries(l).reduce((g,[y,I])=>`${g}${y}=${I},`,"");if(UD(c)&&a!=="_self")return lO(e||"",a),new r_(null);const f=window.open(e||"",a,h);Ie(f,n,"popup-blocked");try{f.focus()}catch{}return new r_(f)}function lO(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uO="__/auth/handler",cO="emulator/auth/handler",dO=encodeURIComponent("fac");async function s_(n,e,t,r,s,i){Ie(n.config.authDomain,n,"auth-domain-config-required"),Ie(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:pl,eventId:s};if(e instanceof Qs){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",SP(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))o[h]=f}if(e instanceof Pl){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),c=l?`#${dO}=${encodeURIComponent(l)}`:"";return`${hO(n)}?${fl(a).slice(1)}${c}`}function hO({config:n}){return n.emulator?Ag(n,cO):`https://${n.authDomain}/${uO}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hf="webStorageSupport";class fO{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=sE,this._completeRedirectFn=hE,this._overrideRedirectResult=VV}async _openPopup(e,t,r,s){var i;Us((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await s_(e,t,r,Wu(),s);return aO(e,o,Jh())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await s_(e,t,r,Wu(),s);return rV(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Us(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await tO(e),r=new FV(e);return t.register("authEvent",s=>(Ie(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Hf,{type:Hf},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[Hf];o!==void 0&&t(!!o),lr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=zV(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return jI()||OI()||Sg()}}const pO=fO;class mE{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return ss("unexpected MultiFactorSessionType")}}}class Ug extends mE{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Ug(e)}_finalizeEnroll(e,t,r){return QN(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return pV(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class mO{constructor(){}static assertion(e){return Ug._fromCredential(e)}}mO.FACTOR_ID="phone";class gO{static assertionForEnrollment(e,t){return Zu._fromSecret(e,t)}static assertionForSignIn(e,t){return Zu._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;Ie(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await JN(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return jg._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}gO.FACTOR_ID="totp";class Zu extends mE{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new Zu(t,void 0,e)}static _fromEnrollmentId(e,t){return new Zu(t,e)}async _finalizeEnroll(e,t,r){return Ie(typeof this.secret<"u",e,"argument-error"),YN(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){Ie(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return mV(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class jg{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new jg(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(rd(e)||rd(t))&&(s=!0),s&&(rd(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),rd(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function rd(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var i_="@firebase/auth",o_="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vO{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ie(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yO(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function _O(n){ds(new qr("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;Ie(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:qI(n)},c=new GD(r,s,i,l);return tN(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),ds(new qr("auth-internal",e=>{const t=sn(e.getProvider("auth").getImmediate());return(r=>new vO(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Pr(i_,o_,yO(n)),Pr(i_,o_,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bO=5*60,wO=Jb("authIdTokenMaxAge")||bO;let a_=null;const xO=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>wO)return;const s=t==null?void 0:t.token;a_!==s&&(a_=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function IO(n=wm()){const e=ji(n,"auth");if(e.isInitialized())return e.getImmediate();const t=eN(n,{popupRedirectResolver:pO,persistence:[hV,nE,sE]}),r=Jb("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=xO(i.toString());KN(t,o,()=>o(t.currentUser)),zN(t,a=>o(a))}}const s=Wb("auth");return s&&nN(t,`http://${s}`),t}function EO(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}HD({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=tr("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",EO().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});_O("Browser");const TO={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},Zh=tw(TO),de=J2(Zh),ht=IO(Zh);try{Y2(de)}catch{}try{BN(ht,nE)}catch{}GN(ht,n=>{n||TN(ht)});async function AO(n,e){try{return(await DN(ht,n,e)).user}catch(t){throw t}}async function gE(n,e){try{return(await NN(ht,n,e)).user}catch(t){throw t}}async function vE(n){try{await RN(ht,n)}catch(e){throw e}}async function SO(n){try{const e=ht.currentUser;if(e)await LN(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const Ai=Object.freeze(Object.defineProperty({__proto__:null,app:Zh,auth:ht,createPlayerAccount:AO,db:de,resetPlayerPassword:vE,signInPlayer:gE,updatePlayerPassword:SO},Symbol.toStringTag,{value:"Module"})),Rl="seasons";async function PO(n,e,t){return await Al(Je(de,Rl),{name:n,slug:e,pinCode:t,createdAt:Hi()})}async function RO(n){return await ul(Re(de,Rl,n))}async function Td(){const n=Hu(Je(de,Rl),sD("createdAt","desc"));return(await xt(n)).docs.map(t=>({id:t.id,...t.data()}))}async function nh(n,e){const t=await Wt(Re(de,Rl,n));return t.exists()?t.data().pinCode===e:!1}async function Bp(n){const e=await Wt(Re(de,Rl,n));return e.exists()?e.data().pinCode:null}async function Zl(n,e){const t=Re(de,Rl,n);await Tl(t,{sortOrder:e})}const CO=["pin","pinCode","password","motdepasse","mdp","token","oobCode","apiKey","apikey","key","secret","authorization","auth","bearer"];function kO(){var t,r,s,i;const n=((r=(t=import.meta)==null?void 0:t.env)==null?void 0:r.MODE)==="development"?"debug":"warn";return((i=(s=import.meta)==null?void 0:s.env)==null?void 0:i.VITE_LOG_LEVEL)||n}function yE(n){switch(n){case"debug":return 10;case"info":return 20;case"warn":return 30;case"error":return 40;case"silent":return 100;default:return 30}}function DO(n){return typeof n!="string"?n:n.length<=2?"••":n.length>=8?`${n.slice(0,2)}••••${n.slice(-2)}`:"••••"}function _E(n){if(!n)return!1;const e=String(n).toLowerCase();return CO.some(t=>e.includes(t.toLowerCase()))}function zp(n){if(n==null)return n;if(typeof n=="string"){if(n.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){const[r,s]=n.split("@"),i=r.length<=2?"••":`${r.slice(0,2)}••`,o=s.split("."),a=o[0].length<=2?"••":`${o[0].slice(0,2)}••`;return`${i}@${a}.${o.slice(1).join(".")}`}return n.length>=12&&!/\s/.test(n)?DO(n):n}if(typeof n=="number"){const e=String(n);return/^\d{4,6}$/.test(e)?"••••":n}if(Array.isArray(n))return n.map(e=>zp(e));if(typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=_E(t)?"••••":zp(r);return e}return n}function NO(n){const e=[];for(let t=0;t<n.length;t+=1){const r=n[t],s=t>0?n[t-1]:null;if(typeof s=="string"&&_E(s)&&(typeof r=="string"||typeof r=="number")){e.push("••••");continue}e.push(zp(r))}return e}const VO=yE(kO());function sd(n,e){const t=yE(n);return(...r)=>{if(t<VO)return;const s=NO(r);console[e](...s)}}const oe={debug:sd("debug","log"),info:sd("info","info"),warn:sd("warn","warn"),error:sd("error","error")},qg="lastVisitedSeason",bE="lastVisitedSeasonTimestamp";async function OO(n){if(n)try{const e=ht.currentUser,t=e==null?void 0:e.email;try{localStorage.setItem(qg,n),localStorage.setItem(bE,Date.now().toString())}catch(r){oe.warn("Erreur lors de la sauvegarde localStorage",r)}if(t)try{const r=Re(de,"userPreferences",t);await nn(r,{lastVisitedSeason:n,lastVisitedSeasonTimestamp:Date.now()},{merge:!0}),oe.debug("Préférence de saison sauvegardée dans Firebase",{seasonSlug:n,userEmail:t})}catch(r){oe.warn("Erreur lors de la sauvegarde Firebase",r)}}catch(e){oe.error("Erreur lors de la mémorisation de la saison",e)}}async function wE(){try{const n=ht.currentUser,e=n==null?void 0:n.email;if(e)try{const t=Re(de,"userPreferences",e),r=await Wt(t);if(r.exists()){const s=r.data();if(s.lastVisitedSeason)return oe.debug("Préférence de saison récupérée depuis Firebase",{seasonSlug:s.lastVisitedSeason}),s.lastVisitedSeason}}catch(t){oe.warn("Erreur lors de la récupération Firebase",t)}try{const t=localStorage.getItem(qg);if(t)return oe.debug("Préférence de saison récupérée depuis localStorage",{seasonSlug:t}),t}catch(t){oe.warn("Erreur lors de la lecture localStorage",t)}return null}catch(n){return oe.error("Erreur lors de la récupération de la dernière saison",n),null}}async function MO(n=null){var e;try{const t=n||((e=ht.currentUser)==null?void 0:e.email);try{localStorage.removeItem(qg),localStorage.removeItem(bE)}catch(r){oe.warn("Erreur lors du nettoyage localStorage",r)}if(t)try{const r=Re(de,"userPreferences",t);await nn(r,{lastVisitedSeason:null,lastVisitedSeasonTimestamp:null},{merge:!0}),oe.debug("Préférence de saison nettoyée dans Firebase",{userEmail:t})}catch(r){oe.warn("Erreur lors du nettoyage Firebase",r)}}catch(t){oe.error("Erreur lors du nettoyage des préférences",t)}}function LO(n,e){return!n||!e||!Array.isArray(e)?!1:e.some(t=>t.slug===n)}const $O={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center"},FO={class:"text-center"},UO={class:"text-white text-lg"},jO={__name:"SeasonResolver",setup(n){const e=dl(),t=S("Chargement...");return Un(async()=>{try{t.value="Vérification de votre session...",await new Promise(o=>{const a=ht.onAuthStateChanged(l=>{a(),o(l)})});const r=ht.currentUser,s=r==null?void 0:r.email;if(!s){oe.info("Utilisateur non connecté, redirection vers /seasons"),e.replace("/seasons");return}t.value="Récupération de vos préférences...";const i=await wE();if(!i){oe.info("Aucune saison mémorisée, redirection vers /seasons"),e.replace("/seasons");return}t.value="Vérification de la saison...";try{const o=await Td();if(!LO(i,o)){oe.info("Saison mémorisée n'existe plus, redirection vers /seasons"),await MO(s),e.replace("/seasons");return}}catch(o){oe.error("Erreur lors de la vérification des saisons",o),e.replace("/seasons");return}oe.info("Redirection vers la saison mémorisée",{seasonSlug:i}),e.replace(`/season/${i}`)}catch(r){oe.error("Erreur lors de la résolution de la saison",r),e.replace("/seasons")}}),(r,s)=>(N(),V("div",$O,[d("div",FO,[s[0]||(s[0]=d("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"},null,-1)),d("p",UO,le(t.value),1)])]))}},l_="/logos/hatcast-logo-mobile.png",qO="/logos/hatcast-logo-desktop.png",BO="/logos/hatcast-mask.png",Wf=7*24*60*60*1e3,eu="impro_selector_pin_session";class zO{constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(eu);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<Wf){try{t.timestamp=Date.now(),localStorage.setItem(eu,JSON.stringify(t))}catch{}return t}else this.clearSession()}}catch{console.error("Erreur lors du chargement de la session PIN")}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(eu,JSON.stringify(r)),this.sessionData=r}catch{console.error("Erreur lors de la sauvegarde de la session PIN")}}isPinCached(e){if(!this.sessionData)return!1;const t=this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<Wf;if(t)try{this.sessionData.timestamp=Date.now(),localStorage.setItem(eu,JSON.stringify(this.sessionData))}catch{}return t}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(eu),this.sessionData=null}catch{console.error("Erreur lors de la suppression de la session PIN")}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=Wf-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const On=new zO,KO={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},GO={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},HO={class:"text-center mb-6"},WO={class:"text-gray-300"},QO={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},JO={class:"text-sm text-green-400"},YO={class:"mb-6"},XO={class:"mb-4"},ZO={key:0,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},eM={class:"flex justify-end space-x-3"},tM=["disabled"],xE={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S(""),o=S(null);St(()=>t.show,h=>{h&&(s.value="",i.value="",Bt(()=>{var f;(f=o.value)==null||f.focus()}))});function a(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function l(){s.value.length===4&&r("submit",s.value)}function c(){r("cancel")}return(h,f)=>n.show?(N(),V("div",KO,[d("div",GO,[d("div",HO,[f[1]||(f[1]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔒")],-1)),f[2]||(f[2]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),d("p",WO,le(n.message),1),n.sessionInfo?(N(),V("div",QO,[d("p",JO," Session active : "+le(n.sessionInfo.timeRemaining)+" min restantes ",1)])):_e("",!0)]),d("div",YO,[d("div",XO,[f[3]||(f[3]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),tt(d("input",{"onUpdate:modelValue":f[0]||(f[0]=g=>s.value=g),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:a,onKeydown:[Bn(l,["enter"]),Bn(c,["escape"])],ref_key:"pinInput",ref:o},null,544),[[Vt,s.value]])]),f[4]||(f[4]=d("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))]),i.value||t.error?(N(),V("div",ZO,le(i.value||t.error),1)):_e("",!0),d("div",eM,[d("button",{onClick:c,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:l,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,tM)])])])):_e("",!0)}},u_="impro_selector_trusted_players",c_=180*24*60*60*1e3;class nM{constructor(){this.trustedMap=this.load()}load(){try{const e=localStorage.getItem(u_);if(!e)return{};const t=JSON.parse(e);return typeof t=="object"&&t!==null?t:{}}catch{return{}}}persist(){try{localStorage.setItem(u_,JSON.stringify(this.trustedMap))}catch{}}isPasswordCached(e){if(!e)return!1;const t=this.trustedMap[e];if(!t)return!1;const r=Date.now(),s=r-t<c_;return s?(this.trustedMap[e]=r,this.persist()):(delete this.trustedMap[e],this.persist()),s}getCachedPassword(e){return null}saveSession(e,t){e&&(this.trustedMap[e]=Date.now(),this.persist())}clearSession(e){e&&(delete this.trustedMap[e],this.persist())}clearExpiredSessions(){const e=Date.now();let t=!1;for(const[r,s]of Object.entries(this.trustedMap))e-s>c_&&(delete this.trustedMap[r],t=!0);t&&this.persist()}clearAllSessions(){this.trustedMap={},this.persist()}}const Fi=new nM,rM={class:"mt-4"},sM={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-2"},IE={__name:"AccountBenefitsHint",setup(n){const e=S(!1);return(t,r)=>(N(),V("div",rM,[d("button",{onClick:r[0]||(r[0]=s=>e.value=!e.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[r[1]||(r[1]=d("h3",{class:"text-sm font-semibold text-blue-300"},"💡 A quoi sert un compte ?",-1)),d("span",{class:Ot(["text-blue-300 transition-transform duration-200",{"rotate-180":e.value}])},"▼",2)]),e.value?(N(),V("div",sM,r[2]||(r[2]=[d("div",{class:"text-gray-300"},"Ça fonctionne très bien sans compte. Mais si vous en créez un, vous aurez quelques trucs sympas en plus :",-1),d("div",null,[zt("• "),d("span",{class:"text-blue-300"},"Protégez vos saisies :"),zt(" vous êtes sûr que personne n'a changé vos dispos car vous êtes le seul à pouvoir les modifier")],-1),d("div",null,[zt("• "),d("span",{class:"text-blue-300"},"Notifications :"),zt(" nouveaux spectacles, disponibilités et sélections dans votre boite mail")],-1),d("div",null,[zt("• "),d("span",{class:"text-blue-300"},"Saisie simplifiée :"),zt(" votre joueur reste toujours en haut de la liste")],-1)]))):_e("",!0)]))}},iM={class:"space-y-4"},oM={class:"flex items-center justify-between"},aM={class:"flex items-center gap-2 text-gray-300 text-sm"},lM={key:0,class:"p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},uM={key:1,class:"p-3 bg-green-500/20 border border-green-500/30 rounded-lg text-green-300 text-sm"},cM={class:"flex justify-center gap-3 mt-2"},dM=["disabled"],hM={key:0,class:"animate-spin"},fM={key:1},EE={__name:"AccountLoginModal",props:{show:{type:Boolean,default:!1}},emits:["close","success"],setup(n,{emit:e}){const t=e,r=S(""),s=S(""),i=S(!1),o=S(""),a=S(""),l=S(!0),c=je(()=>!!r.value&&r.value.includes("@")&&!!s.value);async function h(){if(c.value){i.value=!0,o.value="",a.value="";try{if(await gE(r.value.trim(),s.value),l.value)try{Fi.saveSession(r.value.trim())}catch{}t("success")}catch{o.value="Email ou mot de passe incorrect"}finally{i.value=!1}}}async function f(){if(!r.value||!r.value.includes("@")){o.value="Saisissez votre email pour recevoir un lien de réinitialisation",setTimeout(()=>{o.value=""},2500);return}i.value=!0,o.value="",a.value="";try{await vE(r.value.trim()),a.value="Email de réinitialisation envoyé"}catch{o.value="Impossible d'envoyer l'email de réinitialisation"}finally{i.value=!1}}return(g,y)=>n.show?(N(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[170] p-4",onClick:y[6]||(y[6]=I=>g.$emit("close"))},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:y[5]||(y[5]=gt(()=>{},["stop"]))},[d("button",{onClick:y[0]||(y[0]=I=>g.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),y[10]||(y[10]=Ln('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Mon compte</h2><p class="text-sm text-gray-300">Connectez-vous pour gérer votre compte et vos préférences</p></div>',1)),d("div",iM,[nt(IE),d("div",null,[y[7]||(y[7]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Email",-1)),tt(d("input",{"onUpdate:modelValue":y[1]||(y[1]=I=>r.value=I),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Vt,r.value]])]),d("div",null,[y[8]||(y[8]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),tt(d("input",{"onUpdate:modelValue":y[2]||(y[2]=I=>s.value=I),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe"},null,512),[[Vt,s.value]])]),d("div",oM,[d("label",aM,[tt(d("input",{type:"checkbox","onUpdate:modelValue":y[3]||(y[3]=I=>l.value=I),class:"w-4 h-4"},null,512),[[xi,l.value]]),y[9]||(y[9]=d("span",null,"Rester connecté sur cet appareil",-1))]),d("button",{onClick:f,class:"text-sm text-blue-400 hover:text-blue-300 underline"},"Mot de passe oublié ?")]),o.value?(N(),V("div",lM,le(o.value),1)):_e("",!0),a.value?(N(),V("div",uM,le(a.value),1)):_e("",!0),d("div",cM,[d("button",{onClick:h,disabled:!c.value||i.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(N(),V("span",hM,"⏳")):(N(),V("span",fM,"Se connecter"))],8,dM),d("button",{onClick:y[4]||(y[4]=I=>g.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])])):_e("",!0)}},ef="magicLinks";function tf({seasonId:n,playerId:e,eventId:t,action:r}){return`${n}__${e}__${t}__${r}`}function Bg(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function Kp({seasonId:n,playerId:e,eventId:t,action:r}){const s=tf({seasonId:n,playerId:e,eventId:t,action:r}),i=Bg(40),o=Re(de,ef,s),a=Date.now()+1e3*60*60*24*7;await nn(o,{seasonId:n,playerId:e,eventId:t,token:i,action:r,expiresAt:a});const c=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(i)}&a=${encodeURIComponent(r)}`;return{id:s,token:i,url:c}}async function TE({seasonId:n,playerId:e,email:t}){const r="protection",s="verify_email",i=tf({seasonId:n,playerId:e,eventId:r,action:s}),o=Bg(40),a=Re(de,ef,i),l=Date.now()+1e3*60*60*24*7;await nn(a,{seasonId:n,playerId:e,eventId:r,token:o,action:s,email:t,expiresAt:l});const h=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(s)}`;return{id:i,token:o,url:h}}async function AE({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=tf({seasonId:n,playerId:e,eventId:t,action:s}),o=Re(de,ef,i),a=await Wt(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function Gp({seasonId:n,playerId:e,eventId:t,action:r}){const s=tf({seasonId:n,playerId:e,eventId:t,action:r}),i=Re(de,ef,s);await ul(i)}const zg="accountMagicLinks";function nf(n){return`account__${n}`}async function SE({currentEmail:n,newEmail:e}){const t=Bg(40),r=nf(t),s=Re(de,zg,r),i=Date.now()+1e3*60*60*24*7;await nn(s,{token:t,currentEmail:n,newEmail:e,action:"account_email_update",expiresAt:i});const a=`${window.location.origin+"/"}magic?a=account_email_update&t=${encodeURIComponent(t)}`;return{id:r,token:t,url:a}}async function PE({token:n}){const e=nf(n),t=Re(de,zg,e),r=await Wt(t);if(!r.exists())return{valid:!1,reason:"not_found"};const s=r.data();return s.token!==n?{valid:!1,reason:"token_mismatch"}:typeof s.expiresAt=="number"&&Date.now()>s.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:s}}async function RE({token:n}){const e=nf(n),t=Re(de,zg,e);await ul(t)}const pM=Object.freeze(Object.defineProperty({__proto__:null,buildAccountId:nf,consumeAccountEmailUpdateLink:RE,consumeMagicLink:Gp,createAccountEmailUpdateLink:SE,createEmailVerificationLink:TE,createMagicLink:Kp,verifyAccountEmailUpdateLink:PE,verifyMagicLink:AE},Symbol.toStringTag,{value:"Module"}));function Kg(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}function CE(n){return`seasonPreferredPlayer:${n||"global"}`}function Hp(n,e){try{const t=CE(n),r=localStorage.getItem(t);if(!r){localStorage.setItem(t,JSON.stringify([e]));return}if(r.startsWith("[")){const s=JSON.parse(r);s.includes(e)||(s.push(e),localStorage.setItem(t,JSON.stringify(s)))}else r!==e&&localStorage.setItem(t,JSON.stringify([r,e]))}catch{}}function mM(n,e){try{const t=CE(n),r=localStorage.getItem(t);if(!r)return;if(r.startsWith("[")){const s=JSON.parse(r).filter(i=>i!==e);s.length===0?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(s))}else r===e&&localStorage.removeItem(t)}catch{}}async function kE(n,e,t,r=null){try{oe.info("Début protectPlayer",{playerId:n,seasonId:r});const s=await Cl(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:l}=await tn(()=>import("./index.esm-68cf9100.js"),[]),{db:c}=await tn(()=>Promise.resolve().then(()=>Ai),void 0),h=r?i(c,"seasons",r,"playerProtection"):i(c,"playerProtection"),f=o(h,a("email","==",e)),g=await l(f);if(!g.empty&&g.docs.find($=>$.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");oe.debug("Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:y}=await tn(()=>import("./index.esm-25419a2a.js"),[]),{auth:I}=await tn(()=>Promise.resolve().then(()=>Ai),void 0),A=await y(I,e,t);oe.info("Compte Firebase Auth créé",{uid:A.user.uid});const P=Kg(t),j=r?Re(c,"seasons",r,"playerProtection",n):Re(c,"playerProtection",n);return await nn(j,{playerId:n,email:e,passwordHash:P,firebaseUid:A.user.uid,isProtected:!0,createdAt:new Date}),oe.info("Protection sauvegardée dans Firestore"),r&&Hp(r,n),{success:!0}}catch(s){throw oe.error("Erreur lors de la protection du joueur",s),s}}async function DE({playerId:n,email:e,seasonId:t=null}){const r=t?Re(de,"seasons",t,"playerProtection",n):Re(de,"playerProtection",n);(await Wt(r)).exists()?await Tl(r,{email:e,updatedAt:new Date}):await nn(r,{playerId:n,email:e,isProtected:!1,createdAt:new Date});const{url:i}=await TE({seasonId:t,playerId:n,email:e});return{success:!0,url:i}}async function NE({playerId:n,seasonId:e=null}){const t=e?Re(de,"seasons",e,"playerProtection",n):Re(de,"playerProtection",n);if(!(await Wt(t)).exists())throw new Error("Protection introuvable");return await Tl(t,{emailVerifiedAt:new Date}),{success:!0}}async function VE({playerId:n,seasonId:e=null}){const t=e?Re(de,"seasons",e,"playerProtection",n):Re(de,"playerProtection",n);return await Tl(t,{emailVerifiedAt:null}),{success:!0}}async function OE(n,e=null){try{const t=e?Re(de,"seasons",e,"playerProtection",n):Re(de,"playerProtection",n);return await nn(t,{playerId:n,email:"",isProtected:!1,emailVerifiedAt:null,updatedAt:new Date}),e&&mM(e,n),{success:!0,email:""}}catch(t){throw oe.error("Erreur lors de la suppression de la protection",t),t}}async function Si(n,e=null){try{const t=e?Re(de,"seasons",e,"playerProtection",n):Re(de,"playerProtection",n),r=await Wt(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return oe.error("Erreur lors de la vérification de protection",t),!1}}async function Cl(n,e=null){try{const t=e?Re(de,"seasons",e,"playerProtection",n):Re(de,"playerProtection",n),r=await Wt(t);return r.exists()?r.data():null}catch(t){return oe.error("Erreur lors de la récupération des données de protection",t),null}}async function ME(n,e=null){try{const t=await Cl(n,e);return(t==null?void 0:t.email)||""}catch(t){return oe.error("Erreur lors de la récupération de l'email",t),""}}async function Wp(n=null){try{const e=n?Je(de,"seasons",n,"playerProtection"):Je(de,"playerProtection");return(await xt(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return oe.error("Erreur lors du chargement des protections",e),[]}}async function Gg(n){try{const e=[],t=Hu(Je(de,"playerProtection"),Yd("email","==",n));(await xt(t)).forEach(i=>{const o=i.data();o!=null&&o.isProtected&&e.push({seasonId:null,playerId:i.id,...o})});const s=await xt(Je(de,"seasons"));for(const i of s.docs){const o=i.id,a=Hu(Je(de,"seasons",o,"playerProtection"),Yd("email","==",n));(await xt(a)).forEach(c=>{var f;const h=c.data();h!=null&&h.isProtected&&e.push({seasonId:o,seasonName:(f=i.data())==null?void 0:f.name,playerId:c.id,...h})})}return e}catch(e){return oe.error("Erreur listAssociationsForEmail",e),[]}}async function LE(n,e,t=null){try{const r=await Cl(n,t);if(!r||!r.isProtected)return!1;if(r.email){oe.debug("Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await tn(()=>import("./index.esm-25419a2a.js"),[]),{auth:i}=await tn(()=>Promise.resolve().then(()=>Ai),void 0);return await s(i,r.email,e),oe.debug("Mot de passe Firebase Auth valide"),Fi.saveSession(n),t&&Hp(t,n),!0}catch(s){return oe.debug("Mot de passe Firebase Auth invalide",{code:s.code}),!1}}else{oe.debug("Vérification avec hash local");const s=Kg(e),i=r.passwordHash===s;return i&&(Fi.saveSession(n),t&&Hp(t,n)),i}}catch(r){return oe.error("Erreur lors de la vérification du mot de passe",r),!1}}async function $E({playerId:n,seasonId:e=null}){const t=e?Re(de,"seasons",e,"playerProtection",n):Re(de,"playerProtection",n),r=await Wt(t);if(!r.exists())throw new Error("Protection introuvable");const s=r.data();if(s!=null&&s.email)return await Tl(t,{isProtected:!0,updatedAt:new Date}),{success:!0};throw new Error("Email non défini pour cette protection")}function Fo(n){return Fi.isPasswordCached(n)}function gM(n){return null}async function FE(n,e=null){try{oe.info("Début sendPasswordResetEmail",{playerId:n,seasonId:e});const t=await Cl(n,e);if(oe.debug("Protection data disponible"),!t||!t.isProtected)throw new Error("Joueur non protégé");if(oe.debug("Email à utiliser (masqué)"),t.firebaseUid){oe.debug("Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await tn(()=>import("./index.esm-25419a2a.js"),[]),{auth:s}=await tn(()=>Promise.resolve().then(()=>Ai),void 0);oe.debug("Tentative d'envoi d'email"),await r(s,t.email),oe.info("Email envoyé avec succès via Firebase Auth")}else{oe.debug("Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await tn(()=>import("./index.esm-25419a2a.js"),[]),{auth:i}=await tn(()=>Promise.resolve().then(()=>Ai),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);oe.info("Compte temporaire créé",{uid:a.user.uid}),await s(i,t.email),oe.info("Email envoyé avec succès");const{updateDoc:l}=await tn(()=>import("./index.esm-68cf9100.js"),[]),{db:c}=await tn(()=>Promise.resolve().then(()=>Ai),void 0),h=e?Re(c,"seasons",e,"playerProtection",n):Re(c,"playerProtection",n);await l(h,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")oe.debug("Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),oe.info("Email envoyé avec succès");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw oe.error("Erreur lors de l'envoi de l'email de réinitialisation",{error:t}),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}async function vM(n,e,t=null){try{const r=Kg(e),s=t?Re(de,"seasons",t,"playerProtection",n):Re(de,"playerProtection",n);return await Tl(s,{passwordHash:r,updatedAt:new Date}),{success:!0}}catch(r){throw oe.error("Erreur lors de la mise à jour du mot de passe",r),r}}async function yM(n){return new Promise((e,t)=>{oe.debug("Demande de mot de passe pour disponibilité"),t(new Error("Gestion de mot de passe à implémenter côté composant"))})}const Ac=Object.freeze(Object.defineProperty({__proto__:null,clearEmailVerificationForProtection:VE,finalizeProtectionAfterVerification:$E,getCachedPlayerPassword:gM,getPlayerEmail:ME,getPlayerProtectionData:Cl,isPlayerPasswordCached:Fo,isPlayerProtected:Si,listAssociationsForEmail:Gg,listProtectedPlayers:Wp,markEmailVerifiedForProtection:NE,protectPlayer:kE,requirePlayerPasswordForAvailability:yM,sendPasswordResetEmail:FE,startEmailVerificationForProtection:DE,unprotectPlayer:OE,updatePlayerPasswordInFirestore:vM,verifyPlayerPassword:LE},Symbol.toStringTag,{value:"Module"}));async function Sc({toEmail:n,title:e,body:t,data:r={},reason:s="generic"}){if(!n)return{success:!1,error:"missing_toEmail"};const i={to:n,title:e,body:t,data:r,reason:s,createdAt:Hi()};return await Al(Je(de,"pushQueue"),i),{success:!0}}async function _M({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,eventUrl:o=void 0,reason:a="new_event",fromEmail:l=void 0}){try{const g=Re(de,"userPreferences",n),y=await Wt(g);if(y.exists()){const I=y.data();if((I==null?void 0:I.notifyAvailability)===!1)return{success:!0,skipped:!0}}}catch{}const c=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p><strong>Nouvel événement programmé!</strong></p>
      <p style="margin: 12px 0 2px 0; font-weight: 600;">${t}</p>
      <p style="margin: 0 0 16px 0; color:#374151;">${r}</p>
      <p>Nous avons besoin de savoir si tu es disponible.</p>
      <p style="margin-top: 12px;">
        <a href="${s}" style="display:inline-block;padding:10px 12px;margin-right:8px;border:2px solid #16a34a;color:#16a34a;border-radius:8px;text-decoration:none;">✅ Dispo</a>
        <a href="${i}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Pas dispo</a>
      </p>
      <p style="margin-top: 16px;">Merci!!</p>
    </div>
  `,h=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,f={to:n,message:{subject:h,html:c},createdAt:Hi(),meta:{reason:a,eventTitle:t,eventDate:r,playerName:e}};l&&(f.from=l,f.replyTo=l),await Al(Je(de,"mail"),f);try{const g=Re(de,"userPreferences",n),y=await Wt(g),I=y.exists()?y.data():{};if((I==null?void 0:I.notifyAvailabilityPush)!==!1){const A=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,P=`${e}, t'es dispo ?`;await Sc({toEmail:n,title:A,body:P,data:{url:o||window.location.origin,yesUrl:s,noUrl:i,reason:a},reason:a==="reminder"?"availability_reminder":"availability_request"})}}catch{}return{success:!0}}async function UE({toEmail:n,verifyUrl:e,purpose:t="player_protection",displayName:r="utilisateur",fromEmail:s=void 0}){const i=t==="account_email_update",o=i?"Vérification de votre nouvelle adresse email":"Vérification de votre email",a=`Bonjour ${r},`,l=i?"Pour sécuriser votre compte, merci de confirmer que vous avez accès à cette nouvelle adresse email.":"Pour sécuriser votre joueur, merci de confirmer que vous avez accès à cette adresse email.",c=i?"Confirmer mon adresse email":"Vérifier mon email",h=i?"Confirmez votre nouvelle adresse email":"Confirmez votre email pour activer la protection",f=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>${o}</h2>
      <p>${a}</p>
      <p>${l}</p>
      <p>
        <a href="${e}" style="display:inline-block;padding:10px 16px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;">${c}</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Ce lien expirera dans 7 jours.</p>
    </div>
  `,g={to:n,message:{subject:h,html:f},createdAt:Hi(),meta:{reason:t,displayName:r}};s&&(g.from=s,g.replyTo=s),await Al(Je(de,"mail"),g)}async function bM({toEmail:n,playerName:e,verifyUrl:t,fromEmail:r=void 0}){return UE({toEmail:n,verifyUrl:t,purpose:"player_protection",displayName:e,fromEmail:r})}async function wM({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,html:i=void 0,subject:o=void 0,fromEmail:a=void 0}){try{const f=Re(de,"userPreferences",n),g=await Wt(f);if(g.exists()){const y=g.data();if((y==null?void 0:y.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}oe.debug("queueSelectionEmail",{forPlayer:e,hasCustomHtml:!!i,hasCustomSubject:!!o});const l=i||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>Bonjour ${e},</p>
      <p>Félicitations ! Tu as été sélectionné(e) pour <strong>${t}</strong> (${r}).</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Tu recevras bientôt plus d'informations sur l'organisation.</p>
    </div>
  `,c=o||`🎭 Sélection confirmée · ${t}`;oe.debug("queueSelectionEmail html/subject ready");const h={to:n,message:{subject:c,html:l},createdAt:Hi(),meta:{reason:"selection",eventTitle:t,eventDate:r,playerName:e}};a&&(h.from=a,h.replyTo=a),oe.debug("queueSelectionEmail firestore payload ready");try{await Al(Je(de,"mail"),h);try{const f=Re(de,"userPreferences",n),g=await Wt(f),y=g.exists()?g.data():{};(y==null?void 0:y.notifySelectionPush)!==!1&&await Sc({toEmail:n,title:"🎭 Sélection confirmée",body:`${e}, tu as été sélectionné(e) pour ${t} (${r}) 🎉`,data:{url:s||window.location.origin},reason:"selection"})}catch{}return oe.info("Email ajouté à la queue Firestore",{playerName:e}),{success:!0}}catch(f){throw oe.error("Erreur lors de l'ajout à Firestore",{playerName:e,error:f}),f}}async function xM({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,newSelectedPlayers:i=[],html:o=void 0,subject:a=void 0,fromEmail:l=void 0}){try{const y=Re(de,"userPreferences",n),I=await Wt(y);if(I.exists()){const A=I.data();if((A==null?void 0:A.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}const c=Array.isArray(i)?i.join(", "):"",h=o||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>🎭 Sélection mise à jour</h2>
      <p>Bonjour ${e},</p>
      <p>La sélection pour <strong>${t}</strong> (${r}) a été mise à jour et tu n'en fais plus partie 😔.</p>
      ${c?`<p>Nouvelle sélection: <strong>${c}</strong>.</p>`:""}
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#6b7280;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: mise à jour de sélection (relance auto ou ajustement manuel).</p>
    </div>
  `,f=a||`🎭 Tu n'es plus dans la sélection · ${t}`,g={to:n,message:{subject:f,html:h},createdAt:Hi(),meta:{reason:"deselection",eventTitle:t,eventDate:r,playerName:e,newSelectedPlayers:i}};l&&(g.from=l,g.replyTo=l),await Al(Je(de,"mail"),g);try{const y=Re(de,"userPreferences",n),I=await Wt(y),A=I.exists()?I.data():{};(A==null?void 0:A.notifySelectionPush)!==!1&&await Sc({toEmail:n,title:"🎭 Sélection mise à jour",body:`${e}, tu n'es plus sélectionné(e) pour ${t} (${r}) 😔`,data:{url:s||window.location.origin,noUrl:s&&s.includes("/event/")?s.replace("/event/","/magic?auto=no&event="):void 0},reason:"deselection"})}catch{}return{success:!0}}async function IM({eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,players:i}){if(oe.info("sendSelectionEmailsForEvent",{eventId:n,seasonId:r,seasonSlug:s,playersCount:i==null?void 0:i.length,selectedCount:t==null?void 0:t.length}),!e||!t||t.length===0)throw new Error("Données manquantes pour l'envoi des emails de sélection");const{getPlayerEmail:o}=await tn(()=>Promise.resolve().then(()=>Ac),void 0),{createMagicLink:a}=await tn(()=>Promise.resolve().then(()=>pM),void 0),l=`${window.location.origin}/season/${s}/event/${n}`;t.join(", ");const c=`🎭 Sélection confirmée · ${e.title}`,h=[];for(const f of t){oe.debug("Traitement du joueur",{playerName:f});try{const g=i==null?void 0:i.find(B=>B.name===f);if(!g){oe.warn("Joueur non trouvé",{playerName:f});continue}oe.debug("Joueur trouvé");const y=await o(g.id,r);if(!y){oe.warn("Pas d'email pour le joueur",{playerName:f});continue}oe.debug("Email trouvé pour joueur");const A=`${(await a({seasonId:r,playerId:g.id,eventId:n,action:"no"})).url}&slug=${encodeURIComponent(s)}`,P=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu as été sélectionné(e) pour <strong>${e.title}</strong> (${rh(e.date)}).</p>
          <p>Un imprévu ?</p>
          <p>
            <a href="${A}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;margin-right:8px;">❌ Plus dispo</a>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
          </p>
        </div>
      `;oe.debug("HTML généré pour joueur");const j=wM({toEmail:y,playerName:f,eventTitle:e.title,eventDate:rh(e.date),eventUrl:l,html:P,subject:c});h.push(j),oe.info("Email ajouté à la queue",{playerName:f})}catch(g){oe.error("Erreur lors de l'envoi de l'email de sélection",{playerName:f,error:g})}}return oe.info("Nombre total d'emails à envoyer",{count:h.length}),await Promise.all(h),oe.info("Tous les emails ont été envoyés avec succès"),{success:!0,count:h.length}}async function EM({eventId:n,eventData:e,removedPlayers:t,newSelectedPlayers:r,seasonId:s,seasonSlug:i,players:o}){if(oe.info("sendDeselectionEmailsForEvent",{eventId:n,seasonId:s,removedCount:t==null?void 0:t.length}),!e||!t||t.length===0)return{success:!0,count:0};const{getPlayerEmail:a}=await tn(()=>Promise.resolve().then(()=>Ac),void 0),l=`${window.location.origin}/season/${i}/event/${n}`,c=[],h=Array.isArray(r)?r.join(", "):"";for(const f of t)try{const g=o==null?void 0:o.find(A=>A.name===f);if(!g){oe.warn("Joueur retiré non trouvé",{playerName:f});continue}const y=await a(g.id,s);if(!y){oe.warn("Pas d'email pour le joueur retiré",{playerName:f});continue}const I=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2>🎭 Sélection mise à jour</h2>
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu n'es plus sélectionné(e) pour <strong>${e.title}</strong> (${rh(e.date)}) 😔.</p>
          ${h?`<p>Nouvelle sélection: <strong>${h}</strong>.</p>`:""}
          <p>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #6b7280;color:#6b7280;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
          </p>
        </div>
      `;c.push(xM({toEmail:y,playerName:f,eventTitle:e.title,eventDate:rh(e.date),eventUrl:l,newSelectedPlayers:r,html:I}))}catch(g){oe.error("Erreur lors de l'envoi de l'email de désélection",{playerName:f,error:g})}return await Promise.all(c),oe.info("Emails de désélection envoyés",{count:c.length}),{success:!0,count:c.length}}function rh(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}const jE="@firebase/installations",Hg="0.6.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qE=1e4,BE=`w:${Hg}`,zE="FIS_v2",TM="https://firebaseinstallations.googleapis.com/v1",AM=60*60*1e3,SM="installations",PM="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RM={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Qo=new Xo(SM,PM,RM);function KE(n){return n instanceof fs&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GE({projectId:n}){return`${TM}/projects/${n}/installations`}function HE(n){return{token:n.token,requestStatus:2,expiresIn:kM(n.expiresIn),creationTime:Date.now()}}async function WE(n,e){const r=(await e.json()).error;return Qo.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function QE({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function CM(n,{refreshToken:e}){const t=QE(n);return t.append("Authorization",DM(e)),t}async function JE(n){const e=await n();return e.status>=500&&e.status<600?n():e}function kM(n){return Number(n.replace("s","000"))}function DM(n){return`${zE} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NM({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=GE(n),s=QE(n),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={fid:t,authVersion:zE,appId:n.appId,sdkVersion:BE},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await JE(()=>fetch(r,a));if(l.ok){const c=await l.json();return{fid:c.fid||t,registrationStatus:2,refreshToken:c.refreshToken,authToken:HE(c.authToken)}}else throw await WE("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YE(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VM(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OM=/^[cdef][\w-]{21}$/,Qp="";function MM(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=LM(n);return OM.test(t)?t:Qp}catch{return Qp}}function LM(n){return VM(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rf(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XE=new Map;function ZE(n,e){const t=rf(n);eT(t,e),$M(t,e)}function eT(n,e){const t=XE.get(n);if(t)for(const r of t)r(e)}function $M(n,e){const t=FM();t&&t.postMessage({key:n,fid:e}),UM()}let Vo=null;function FM(){return!Vo&&"BroadcastChannel"in self&&(Vo=new BroadcastChannel("[Firebase] FID Change"),Vo.onmessage=n=>{eT(n.data.key,n.data.fid)}),Vo}function UM(){XE.size===0&&Vo&&(Vo.close(),Vo=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jM="firebase-installations-database",qM=1,Jo="firebase-installations-store";let Qf=null;function Wg(){return Qf||(Qf=bh(jM,qM,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Jo)}}})),Qf}async function sh(n,e){const t=rf(n),s=(await Wg()).transaction(Jo,"readwrite"),i=s.objectStore(Jo),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&ZE(n,e.fid),e}async function tT(n){const e=rf(n),r=(await Wg()).transaction(Jo,"readwrite");await r.objectStore(Jo).delete(e),await r.done}async function sf(n,e){const t=rf(n),s=(await Wg()).transaction(Jo,"readwrite"),i=s.objectStore(Jo),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&ZE(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qg(n){let e;const t=await sf(n.appConfig,r=>{const s=BM(r),i=zM(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===Qp?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function BM(n){const e=n||{fid:MM(),registrationStatus:0};return nT(e)}function zM(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Qo.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=KM(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:GM(n)}:{installationEntry:e}}async function KM(n,e){try{const t=await NM(n,e);return sh(n.appConfig,t)}catch(t){throw KE(t)&&t.customData.serverCode===409?await tT(n.appConfig):await sh(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function GM(n){let e=await d_(n.appConfig);for(;e.registrationStatus===1;)await YE(100),e=await d_(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await Qg(n);return r||t}return e}function d_(n){return sf(n,e=>{if(!e)throw Qo.create("installation-not-found");return nT(e)})}function nT(n){return HM(n)?{fid:n.fid,registrationStatus:0}:n}function HM(n){return n.registrationStatus===1&&n.registrationTime+qE<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WM({appConfig:n,heartbeatServiceProvider:e},t){const r=QM(n,t),s=CM(n,t),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={installation:{sdkVersion:BE,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await JE(()=>fetch(r,a));if(l.ok){const c=await l.json();return HE(c)}else throw await WE("Generate Auth Token",l)}function QM(n,{fid:e}){return`${GE(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jg(n,e=!1){let t;const r=await sf(n.appConfig,i=>{if(!rT(i))throw Qo.create("not-registered");const o=i.authToken;if(!e&&XM(o))return i;if(o.requestStatus===1)return t=JM(n,e),i;{if(!navigator.onLine)throw Qo.create("app-offline");const a=eL(i);return t=YM(n,a),a}});return t?await t:r.authToken}async function JM(n,e){let t=await h_(n.appConfig);for(;t.authToken.requestStatus===1;)await YE(100),t=await h_(n.appConfig);const r=t.authToken;return r.requestStatus===0?Jg(n,e):r}function h_(n){return sf(n,e=>{if(!rT(e))throw Qo.create("not-registered");const t=e.authToken;return tL(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function YM(n,e){try{const t=await WM(n,e),r=Object.assign(Object.assign({},e),{authToken:t});return await sh(n.appConfig,r),t}catch(t){if(KE(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await tT(n.appConfig);else{const r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await sh(n.appConfig,r)}throw t}}function rT(n){return n!==void 0&&n.registrationStatus===2}function XM(n){return n.requestStatus===2&&!ZM(n)}function ZM(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+AM}function eL(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function tL(n){return n.requestStatus===1&&n.requestTime+qE<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nL(n){const e=n,{installationEntry:t,registrationPromise:r}=await Qg(e);return r?r.catch(console.error):Jg(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rL(n,e=!1){const t=n;return await sL(t),(await Jg(t,e)).token}async function sL(n){const{registrationPromise:e}=await Qg(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iL(n){if(!n||!n.options)throw Jf("App Configuration");if(!n.name)throw Jf("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Jf(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Jf(n){return Qo.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sT="installations",oL="installations-internal",aL=n=>{const e=n.getProvider("app").getImmediate(),t=iL(e),r=ji(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},lL=n=>{const e=n.getProvider("app").getImmediate(),t=ji(e,sT).getImmediate();return{getId:()=>nL(t),getToken:s=>rL(t,s)}};function uL(){ds(new qr(sT,aL,"PUBLIC")),ds(new qr(oL,lL,"PRIVATE"))}uL();Pr(jE,Hg);Pr(jE,Hg,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cL="/firebase-messaging-sw.js",dL="/firebase-cloud-messaging-push-scope",iT="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",hL="https://fcmregistrations.googleapis.com/v1",oT="google.c.a.c_id",fL="google.c.a.c_l",pL="google.c.a.ts",mL="google.c.a.e";var f_;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(f_||(f_={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var ec;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(ec||(ec={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ts(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function gL(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),s=new Uint8Array(r.length);for(let i=0;i<r.length;++i)s[i]=r.charCodeAt(i);return s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yf="fcm_token_details_db",vL=5,p_="fcm_token_object_Store";async function yL(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(i=>i.name).includes(Yf))return null;let e=null;return(await bh(Yf,vL,{upgrade:async(r,s,i,o)=>{var a;if(s<2||!r.objectStoreNames.contains(p_))return;const l=o.objectStore(p_),c=await l.index("fcmSenderId").get(n);if(await l.clear(),!!c){if(s===2){const h=c;if(!h.auth||!h.p256dh||!h.endpoint)return;e={token:h.fcmToken,createTime:(a=h.createTime)!==null&&a!==void 0?a:Date.now(),subscriptionOptions:{auth:h.auth,p256dh:h.p256dh,endpoint:h.endpoint,swScope:h.swScope,vapidKey:typeof h.vapidKey=="string"?h.vapidKey:Ts(h.vapidKey)}}}else if(s===3){const h=c;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:Ts(h.auth),p256dh:Ts(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:Ts(h.vapidKey)}}}else if(s===4){const h=c;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:Ts(h.auth),p256dh:Ts(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:Ts(h.vapidKey)}}}}}})).close(),await Of(Yf),await Of("fcm_vapid_details_db"),await Of("undefined"),_L(e)?e:null}function _L(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bL="firebase-messaging-database",wL=1,tc="firebase-messaging-store";let Xf=null;function aT(){return Xf||(Xf=bh(bL,wL,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(tc)}}})),Xf}async function xL(n){const e=lT(n),r=await(await aT()).transaction(tc).objectStore(tc).get(e);if(r)return r;{const s=await yL(n.appConfig.senderId);if(s)return await Yg(n,s),s}}async function Yg(n,e){const t=lT(n),s=(await aT()).transaction(tc,"readwrite");return await s.objectStore(tc).put(e,t),await s.done,e}function lT({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IL={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},nr=new Xo("messaging","Messaging",IL);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EL(n,e){const t=await Zg(n),r=uT(e),s={method:"POST",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(Xg(n.appConfig),s)).json()}catch(o){throw nr.create("token-subscribe-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw nr.create("token-subscribe-failed",{errorInfo:o})}if(!i.token)throw nr.create("token-subscribe-no-token");return i.token}async function TL(n,e){const t=await Zg(n),r=uT(e.subscriptionOptions),s={method:"PATCH",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(`${Xg(n.appConfig)}/${e.token}`,s)).json()}catch(o){throw nr.create("token-update-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw nr.create("token-update-failed",{errorInfo:o})}if(!i.token)throw nr.create("token-update-no-token");return i.token}async function AL(n,e){const r={method:"DELETE",headers:await Zg(n)};try{const i=await(await fetch(`${Xg(n.appConfig)}/${e}`,r)).json();if(i.error){const o=i.error.message;throw nr.create("token-unsubscribe-failed",{errorInfo:o})}}catch(s){throw nr.create("token-unsubscribe-failed",{errorInfo:s==null?void 0:s.toString()})}}function Xg({projectId:n}){return`${hL}/projects/${n}/registrations`}async function Zg({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function uT({p256dh:n,auth:e,endpoint:t,vapidKey:r}){const s={web:{endpoint:t,auth:e,p256dh:n}};return r!==iT&&(s.web.applicationPubKey=r),s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SL=7*24*60*60*1e3;async function PL(n){const e=await CL(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:Ts(e.getKey("auth")),p256dh:Ts(e.getKey("p256dh"))},r=await xL(n.firebaseDependencies);if(r){if(kL(r.subscriptionOptions,t))return Date.now()>=r.createTime+SL?RL(n,{token:r.token,createTime:Date.now(),subscriptionOptions:t}):r.token;try{await AL(n.firebaseDependencies,r.token)}catch(s){console.warn(s)}return m_(n.firebaseDependencies,t)}else return m_(n.firebaseDependencies,t)}async function RL(n,e){try{const t=await TL(n.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:t,createTime:Date.now()});return await Yg(n.firebaseDependencies,r),t}catch(t){throw t}}async function m_(n,e){const r={token:await EL(n,e),createTime:Date.now(),subscriptionOptions:e};return await Yg(n,r),r.token}async function CL(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:gL(e)})}function kL(n,e){const t=e.vapidKey===n.vapidKey,r=e.endpoint===n.endpoint,s=e.auth===n.auth,i=e.p256dh===n.p256dh;return t&&r&&s&&i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g_(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return DL(e,n),NL(e,n),VL(e,n),e}function DL(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const r=e.notification.body;r&&(n.notification.body=r);const s=e.notification.image;s&&(n.notification.image=s);const i=e.notification.icon;i&&(n.notification.icon=i)}function NL(n,e){e.data&&(n.data=e.data)}function VL(n,e){var t,r,s,i,o;if(!e.fcmOptions&&!(!((t=e.notification)===null||t===void 0)&&t.click_action))return;n.fcmOptions={};const a=(s=(r=e.fcmOptions)===null||r===void 0?void 0:r.link)!==null&&s!==void 0?s:(i=e.notification)===null||i===void 0?void 0:i.click_action;a&&(n.fcmOptions.link=a);const l=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;l&&(n.fcmOptions.analyticsLabel=l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OL(n){return typeof n=="object"&&!!n&&oT in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ML("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function ML(n,e){const t=[];for(let r=0;r<n.length;r++)t.push(n.charAt(r)),r<e.length&&t.push(e.charAt(r));return t.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LL(n){if(!n||!n.options)throw Zf("App Configuration Object");if(!n.name)throw Zf("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const r of e)if(!t[r])throw Zf(r);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function Zf(n){return nr.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $L{constructor(e,t,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const s=LL(e);this.firebaseDependencies={app:e,appConfig:s,installations:t,analyticsProvider:r}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FL(n){try{n.swRegistration=await navigator.serviceWorker.register(cL,{scope:dL}),n.swRegistration.update().catch(()=>{})}catch(e){throw nr.create("failed-service-worker-registration",{browserErrorMessage:e==null?void 0:e.message})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UL(n,e){if(!e&&!n.swRegistration&&await FL(n),!(!e&&n.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw nr.create("invalid-sw-registration");n.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jL(n,e){e?n.vapidKey=e:n.vapidKey||(n.vapidKey=iT)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cT(n,e){if(!navigator)throw nr.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw nr.create("permission-blocked");return await jL(n,e==null?void 0:e.vapidKey),await UL(n,e==null?void 0:e.serviceWorkerRegistration),PL(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qL(n,e,t){const r=BL(e);(await n.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:t[oT],message_name:t[fL],message_time:t[pL],message_device_time:Math.floor(Date.now()/1e3)})}function BL(n){switch(n){case ec.NOTIFICATION_CLICKED:return"notification_open";case ec.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zL(n,e){const t=e.data;if(!t.isFirebaseMessaging)return;n.onMessageHandler&&t.messageType===ec.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(g_(t)):n.onMessageHandler.next(g_(t)));const r=t.data;OL(r)&&r[mL]==="1"&&await qL(n,t.messageType,r)}const v_="@firebase/messaging",y_="0.12.12";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KL=n=>{const e=new $L(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>zL(e,t)),e},GL=n=>{const e=n.getProvider("messaging").getImmediate();return{getToken:r=>cT(e,r)}};function HL(){ds(new qr("messaging",KL,"PUBLIC")),ds(new qr("messaging-internal",GL,"PRIVATE")),Pr(v_,y_),Pr(v_,y_,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dT(){try{await Xb()}catch{return!1}return typeof window<"u"&&ym()&&IP()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WL(n=wm()){return dT().then(e=>{if(!e)throw nr.create("unsupported-browser")},e=>{throw nr.create("indexed-db-unsupported")}),ji(Le(n),"messaging").getImmediate()}async function QL(n,e){return n=Le(n),cT(n,e)}HL();const __="BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8";async function hT(){try{return await dT()}catch{return!1}}async function JL(){if(typeof navigator>"u"||!navigator.serviceWorker)return null;const n=await navigator.serviceWorker.ready;if(n!=null&&n.active&&n.active.state==="activated")return n;const e=(n==null?void 0:n.installing)||(n==null?void 0:n.waiting);return!e||e.state==="activated"||await new Promise(t=>{const r=()=>{e.state==="activated"&&(e.removeEventListener("statechange",r),t())};e.addEventListener("statechange",r)}),n}async function YL(n){var i;if(!await hT()||await Notification.requestPermission()!=="granted")return null;const t=WL(Zh);let r=n||await JL();const s=await QL(t,r?{vapidKey:__,serviceWorkerRegistration:r}:{vapidKey:__});try{const o=((i=ht==null?void 0:ht.currentUser)==null?void 0:i.email)||"anonymous";o&&s&&await nn(Re(de,"userPushTokens",o),{tokens:_D(s),lastToken:s,email:o,updatedAt:Hi(),userAgent:navigator.userAgent},{merge:!0})}catch{}return s}const XL={class:"flex justify-center gap-2 mb-4"},ZL={class:"space-y-3"},e4={key:0},t4={key:0,class:"text-sm text-gray-400"},n4={key:1,class:"space-y-2"},r4={class:"flex items-center justify-between gap-3"},s4={class:"truncate"},i4={class:"text-white font-semibold"},o4={class:"text-gray-400 text-xs"},a4=["onClick"],l4={key:1,class:"text-sm text-gray-300 space-y-3"},u4={class:"p-3 rounded-lg border border-white/10 bg-white/5 space-y-3"},c4={class:"flex items-center justify-between"},d4={class:"flex items-center gap-2"},h4={class:"flex items-center justify-between"},f4={class:"flex items-center gap-2"},p4={class:"p-3 rounded-lg border border-white/10 bg-white/5 space-y-3"},m4={class:"flex items-center justify-between"},g4={class:"flex items-center gap-2"},v4={class:"flex items-center justify-between"},y4={class:"flex items-center gap-2"},_4={class:"flex items-center justify-between pt-2 border-t border-white/10"},b4=["disabled"],w4={key:1,class:"inline-flex items-center text-xs text-gray-300"},x4={class:"flex items-center justify-between pt-2"},I4=["disabled"],E4={key:0,class:"text-xs text-green-300"},T4={key:1,class:"text-xs text-red-300"},A4={key:2,class:"text-[10px] text-gray-400 break-all"},S4={class:"text-[10px] text-gray-500"},P4={class:"text-right"},R4=["disabled"],C4={key:0,class:"text-xs text-red-300"},k4={key:1,class:"text-xs text-green-300"},D4={key:2,class:"flex flex-col gap-3"},N4={class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},V4={class:"flex items-center gap-2"},O4=["disabled"],M4={key:0,class:"mt-2 text-xs text-red-300"},L4={key:1,class:"mt-2 text-xs text-green-300"},fT={__name:"AccountMenu",props:{show:{type:Boolean,default:!1},seasonId:{type:String,default:null}},emits:["close","manage-player","change-password","logout-device","delete-account"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S([]),o=S("players");function a(ne){return["px-4 py-2 rounded-full text-sm transition-colors",o.value===ne?"bg-gradient-to-r from-pink-500 to-purple-600 text-white shadow-lg":"bg-white/5 text-gray-300 hover:bg-white/10 border border-white/10"]}function l(ne){return`${ne.seasonId||"global"}__${ne.playerId}`}async function c(){var ne;try{s.value=((ne=ht==null?void 0:ht.currentUser)==null?void 0:ne.email)||""}catch{}try{const F=s.value?await Gg(s.value):[],W=[];for(const se of F){let Pe=se.playerId;try{if(se.seasonId){const te=Re(de,"seasons",se.seasonId,"players",se.playerId),J=await Wt(te);J.exists()&&(Pe=J.data().name||Pe)}}catch{}W.push({...se,playerName:Pe})}i.value=W}catch{i.value=[]}}function h(){r("close")}St(()=>t.show,ne=>{ne&&(c(),q())}),Un(()=>{t.show&&(c(),q())});const f=S(""),g=S(!1),y=S(""),I=S(""),A=S(!1);St(s,ne=>{f.value=ne||""}),St(f,ne=>{A.value=!!ne&&ne.includes("@")&&ne!==s.value});async function P(){if(A.value){g.value=!0,y.value="",I.value="";try{const ne=await SE({currentEmail:s.value,newEmail:f.value.trim()});await UE({toEmail:f.value.trim(),verifyUrl:ne.url,purpose:"account_email_update",displayName:"utilisateur"}),I.value=`Un email de vérification a été envoyé à ${f.value.trim()}. Cliquez sur le lien pour confirmer le changement.`}catch(ne){y.value=(ne==null?void 0:ne.code)==="auth/requires-recent-login"?"Veuillez vous reconnecter pour modifier votre email":"Impossible de mettre à jour l'email"}finally{g.value=!1}}}const j=S({notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}),B=S(!1),$=S(""),z=S(""),he=S(!1),ve=S(""),T=S(""),w=S(!1),E=S(localStorage.getItem("fcmToken")||""),D=S(!1),L=function(F){try{return F?F.length>20?F.slice(0,8)+"…"+F.slice(-6):F:""}catch{return""}}("BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8");async function q(){try{if(!s.value)return;const ne=Re(de,"userPreferences",s.value),F=await Wt(ne);if(F.exists()){const W=F.data()||{};j.value.notifyAvailability=W.notifyAvailability!==!1,j.value.notifySelection=W.notifySelection!==!1,j.value.notifySelectionPush=W.notifySelectionPush!==!1,j.value.notifyAvailabilityPush=W.notifyAvailabilityPush!==!1}else j.value={notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}}catch{}}async function R(){if(s.value){he.value=!0,T.value="",ve.value="";try{await Sc({toEmail:s.value,title:"Test Impro Selector",body:"Ceci est un test de notification",data:{url:"/"},reason:"manual_test"}),ve.value="OK"}catch{T.value="Échec de l'envoi du test"}finally{he.value=!1}}}async function ft(){try{if(w.value=!0,!await hT()){T.value="Push non supporté sur cet appareil";return}const F=window.__swReg,W=await YL(F);if(W){E.value=W;try{localStorage.setItem("fcmToken",W)}catch{}D.value=!0}}catch(ne){const F=typeof Notification<"u"?Notification.permission:"unknown",W=ne&&(ne.message||ne.code)?` (${ne.message||ne.code})`:"";T.value=`Activation impossible – permission: ${F}${W}`}finally{w.value=!1}}Un(()=>{try{D.value=typeof Notification<"u"&&Notification.permission==="granted"&&!!localStorage.getItem("fcmToken")}catch{D.value=!1}});async function Ze(){if(s.value){B.value=!0,$.value="",z.value="";try{const ne=Re(de,"userPreferences",s.value);await nn(ne,{...j.value},{merge:!0}),z.value="Préférences sauvegardées"}catch{$.value="Impossible de sauvegarder vos préférences"}finally{B.value=!1}}}return(ne,F)=>n.show?(N(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:h},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:F[11]||(F[11]=gt(()=>{},["stop"]))},[d("button",{onClick:h,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),F[25]||(F[25]=Ln('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Mon compte</h2><p class="text-sm text-gray-300">Gérez votre compte et vos préférences</p></div>',1)),d("div",XL,[d("button",{onClick:F[0]||(F[0]=W=>o.value="manage"),class:Ot(a("manage"))},"Gérer",2),d("button",{onClick:F[1]||(F[1]=W=>o.value="notifications"),class:Ot(a("notifications"))},"Notifications",2),d("button",{onClick:F[2]||(F[2]=W=>o.value="players"),class:Ot(a("players"))},"Joueurs",2)]),d("div",ZL,[o.value==="players"?(N(),V("div",e4,[F[12]||(F[12]=d("h3",{class:"text-white font-semibold mb-2"},"Mes joueurs associés",-1)),i.value.length===0?(N(),V("div",t4,"Aucun joueur associé pour le moment.")):(N(),V("ul",n4,[(N(!0),V(ct,null,Ar(i.value,W=>(N(),V("li",{key:l(W),class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},[d("div",r4,[d("div",s4,[d("div",i4,le(W.seasonName||W.seasonId||"—"),1),d("div",o4,"Joueur : "+le(W.playerName||"—"),1)]),d("button",{onClick:se=>ne.$emit("manage-player",W),class:"px-3 py-2 rounded-lg bg-gray-700 text-white hover:bg-gray-600 text-xs"},"Gérer",8,a4)])]))),128))]))])):o.value==="notifications"?(N(),V("div",l4,[d("div",u4,[F[15]||(F[15]=d("div",{class:"text-white font-semibold text-sm mb-1"},"Emails",-1)),d("div",c4,[d("label",d4,[tt(d("input",{type:"checkbox","onUpdate:modelValue":F[3]||(F[3]=W=>j.value.notifyAvailability=W),class:"w-4 h-4"},null,512),[[xi,j.value.notifyAvailability]]),F[13]||(F[13]=d("span",null,"M'envoyer un email lorsqu'un événement a besoin de joueurs",-1))])]),d("div",h4,[d("label",f4,[tt(d("input",{type:"checkbox","onUpdate:modelValue":F[4]||(F[4]=W=>j.value.notifySelection=W),class:"w-4 h-4"},null,512),[[xi,j.value.notifySelection]]),F[14]||(F[14]=d("span",null,"M'envoyer un email lorsque je suis concerné par une sélection",-1))])])]),d("div",p4,[F[21]||(F[21]=d("div",{class:"text-white font-semibold text-sm mb-1"},"Push (expérimental)",-1)),F[22]||(F[22]=d("div",{class:"text-xs text-emerald-200 mb-1"},"Fonctionnalité en test: activable uniquement ici.",-1)),d("div",m4,[d("label",g4,[tt(d("input",{type:"checkbox","onUpdate:modelValue":F[5]||(F[5]=W=>j.value.notifySelectionPush=W),class:"w-4 h-4"},null,512),[[xi,j.value.notifySelectionPush]]),F[16]||(F[16]=d("span",null,"Me notifier lorsque je suis concerné par une sélection",-1))])]),d("div",v4,[d("label",y4,[tt(d("input",{type:"checkbox","onUpdate:modelValue":F[6]||(F[6]=W=>j.value.notifyAvailabilityPush=W),class:"w-4 h-4"},null,512),[[xi,j.value.notifyAvailabilityPush]]),F[17]||(F[17]=d("span",null,"Me notifier lorsqu'un événement a besoin de joueurs",-1))])]),d("div",_4,[F[19]||(F[19]=d("div",{class:"text-xs text-gray-400"},"Notifications sur cet appareil",-1)),D.value?(N(),V("span",w4,F[18]||(F[18]=[d("span",{class:"mr-1 text-emerald-400"},"✓",-1),zt(" Actif ")]))):(N(),V("button",{key:0,onClick:ft,disabled:w.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},le(w.value?"...":"Activer"),9,b4))]),d("div",x4,[F[20]||(F[20]=d("div",{class:"text-xs text-gray-400"},"Test de notification push",-1)),d("button",{onClick:R,disabled:he.value||!s.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},le(he.value?"Envoi…":"Envoyer un test"),9,I4)]),ve.value?(N(),V("div",E4,"Notification test envoyée (vérifiez votre appareil)")):_e("",!0),T.value?(N(),V("div",T4,le(T.value),1)):_e("",!0),E.value?(N(),V("div",A4,"FCM token: "+le(E.value),1)):_e("",!0),d("div",S4,"VAPID: "+le(is(L)||"indisponible"),1)]),d("div",P4,[d("button",{onClick:Ze,disabled:B.value,class:"px-4 py-2 rounded-lg bg-emerald-600 text-white hover:bg-emerald-500 disabled:opacity-50"},le(B.value?"⏳":"Sauvegarder"),9,R4)]),$.value?(N(),V("div",C4,le($.value),1)):_e("",!0),z.value?(N(),V("div",k4,le(z.value),1)):_e("",!0)])):(N(),V("div",D4,[d("div",N4,[F[23]||(F[23]=d("label",{class:"block text-xs text-gray-400 mb-2"},"Email",-1)),d("div",V4,[tt(d("input",{"onUpdate:modelValue":F[7]||(F[7]=W=>f.value=W),type:"email",class:"flex-1 p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"nouvel@email.com"},null,512),[[Vt,f.value]]),d("button",{onClick:P,disabled:!A.value||g.value,class:"px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"},le(g.value?"⏳":"Mettre à jour"),9,O4)]),y.value?(N(),V("div",M4,le(y.value),1)):_e("",!0),I.value?(N(),V("div",L4,le(I.value),1)):_e("",!0)]),F[24]||(F[24]=d("div",{class:"text-sm text-gray-400"},"Vous pouvez changer votre mot de passe pour sécuriser vos opérations sensibles.",-1)),d("button",{onClick:F[8]||(F[8]=W=>ne.$emit("change-password")),class:"w-full px-4 py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500"},"Changer de mot de passe"),d("button",{onClick:F[9]||(F[9]=W=>ne.$emit("logout-device")),class:"w-full px-4 py-3 rounded-lg bg-gray-700 text-white hover:bg-gray-600"},"Déconnexion de cet appareil"),d("button",{onClick:F[10]||(F[10]=W=>ne.$emit("delete-account")),class:"w-full px-4 py-3 rounded-lg bg-red-600 text-white hover:bg-red-500"},"Supprimer mon compte")]))]),d("div",{class:"mt-6 text-center"},[d("button",{onClick:h,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):_e("",!0)}};let Jn="mock",Pi=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],Yo=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function ev(n){Jn=n}async function $4(){if(Jn!=="firebase"||!(await xt(Je(de,"seasons"))).empty)return;const e=Re(Je(de,"seasons"));await nn(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:Hi()});const t=await xt(Je(de,"players"));for(const o of t.docs)await nn(Re(e,"players",o.id),o.data());const r=await xt(Je(de,"events"));for(const o of r.docs)await nn(Re(e,"events",o.id),o.data());const s=await xt(Je(de,"availability"));for(const o of s.docs)await nn(Re(e,"availability",o.id),o.data());const i=await xt(Je(de,"selections"));for(const o of i.docs)await nn(Re(e,"selections",o.id),o.data())}async function pT(){Jn==="firebase"&&await $4()}async function ih(n=null){return(Jn==="firebase"?n?(await xt(Je(de,"seasons",n,"events"))).docs.map(t=>({id:t.id,...t.data()})):(await xt(Je(de,"events"))).docs.map(t=>({id:t.id,...t.data()})):Yo).sort((t,r)=>{const s=c=>{if(!c)return null;if(c instanceof Date)return c;if(typeof(c==null?void 0:c.toDate)=="function")return c.toDate();const h=new Date(c);return isNaN(h.getTime())?null:h},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,l=o?o.getTime():Number.POSITIVE_INFINITY;return a!==l?a-l:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function Au(n=null){return(Jn==="firebase"?n?(await xt(Je(de,"seasons",n,"players"))).docs.map(t=>({id:t.id,...t.data()})):(await xt(Je(de,"players"))).docs.map(t=>({id:t.id,...t.data()})):Pi).sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function mT(n,e=null){if(Jn==="firebase"){const t=Re(e?Je(de,"seasons",e,"players"):Je(de,"players"));return await nn(t,{name:n}),t.id}else{const t=`p${Pi.length+1}`;return Pi.push({id:t,name:n}),t}}async function F4(n,e=null){if(Jn==="firebase"){const t=e?Re(de,"seasons",e,"players",n):Re(de,"players",n);await ul(t);const r=e?await xt(Je(de,"seasons",e,"availability")):await xt(Je(de,"availability")),s=bg(de);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else Pi=Pi.filter(t=>t.id!==n)}async function U4(n,e,t=null){if(Jn==="firebase"){const r=t?Re(de,"seasons",t,"players",n):Re(de,"players",n),s=await Wt(r),i=s.exists()&&s.data().name||null;if(await nn(r,{name:e},{merge:!0}),i&&i!==e){const o=bg(de);try{const a=t?Re(de,"seasons",t,"availability",i):Re(de,"availability",i),l=await Wt(a);if(l.exists()){const c=l.data()||{},h=t?Re(de,"seasons",t,"availability",e):Re(de,"availability",e);o.set(h,c,{merge:!0}),o.delete(a)}}catch{}try{const a=t?Je(de,"seasons",t,"selections"):Je(de,"selections");(await xt(a)).forEach(c=>{var f;const h=Array.isArray((f=c.data())==null?void 0:f.players)?c.data().players:[];if(h.includes(i)){const g=h.map(y=>y===i?e:y);o.update(c.ref,{players:g})}})}catch{}await o.commit()}}else{const r=Pi.findIndex(s=>s.id===n);r!==-1&&(Pi[r]={...Pi[r],name:e})}}async function To(n,e,t=null){if(Jn==="firebase"){const r=t?await xt(Je(de,"seasons",t,"availability")):await xt(Je(de,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function Ao(n=null){if(Jn==="firebase"){const e=n?await xt(Je(de,"seasons",n,"selections")):await xt(Je(de,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function b_(n,e,t=null){if(Jn==="firebase"){const r=t?Re(de,"seasons",t,"availability",n):Re(de,"availability",n);await nn(r,e)}}async function j4({seasonId:n,playerName:e,eventId:t,value:r}){if(Jn!=="firebase")return;const s=n?Re(de,"seasons",n,"availability",e):Re(de,"availability",e),i=await Wt(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await nn(s,a)}async function Jp(n,e,t=null){if(Jn==="firebase"){const r=t?Re(de,"seasons",t,"selections",n):Re(de,"selections",n);await nn(r,{players:e})}}async function q4(n,e=null){if(oe.info("Suppression de l'événement",{eventId:n}),Jn==="firebase")try{oe.debug("Suppression de l'événement dans Firestore");const t=e?Re(de,"seasons",e,"events",n):Re(de,"events",n);await ul(t),oe.debug("Suppression de la sélection associée");const r=e?Re(de,"seasons",e,"selections",n):Re(de,"selections",n);await ul(r),oe.debug("Suppression des disponibilités");const s=e?await xt(Je(de,"seasons",e,"availability")):await xt(Je(de,"availability")),i=bg(de);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){oe.debug("Mise à jour de la disponibilité pour un joueur");const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),oe.info("Opérations de suppression terminées avec succès")}catch(t){throw oe.error("Erreur lors de la suppression",t),t}else Yo=Yo.filter(t=>t.id!==n)}async function B4(n,e=null){if(Jn==="firebase"){const t=Re(e?Je(de,"seasons",e,"events"):Je(de,"events"));return await nn(t,n),t.id}else{const t=`event${Yo.length+1}`;return Yo.push({id:t,...n}),t}}async function w_(n,e,t=null){if(Jn==="firebase"){const r=t?Re(de,"seasons",t,"events",n):Re(de,"events",n);await nn(r,e,{merge:!0})}else{const r=Yo.findIndex(s=>s.id===n);r!==-1&&(Yo[r]={id:n,...e})}}const z4={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},K4={class:"container mx-auto px-4 py-4"},G4={class:"flex items-center justify-between"},H4={class:"flex items-center"},W4={class:"hero-section relative overflow-hidden pt-24"},Q4={class:"hero-content py-16 md:py-24 px-4 relative z-10"},J4={class:"container mx-auto"},Y4={class:"grid grid-cols-1 lg:grid-cols-2 gap-16 lg:gap-24 items-center"},X4={class:"text-center lg:text-left order-1 lg:order-2"},Z4={class:"hero-cta mb-10"},e3={class:"flex flex-col sm:flex-row gap-4 items-center justify-center"},t3={class:"seasons-section py-16"},n3={class:"container mx-auto px-4"},r3=["aria-busy"],s3={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center animate-pulse"},i3={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center"},o3=["onClick"],a3={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},l3={class:"flex justify-center gap-6 text-sm"},u3={class:"text-center"},c3={class:"text-white font-semibold"},d3={class:"text-center"},h3={class:"text-white font-semibold"},f3={class:"absolute top-4 right-4"},p3=["onClick","aria-expanded"],m3={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},g3=["onClick"],v3=["onClick"],y3=["onClick"],_3=["onClick"],b3={class:"text-center mt-12"},w3={key:2,class:"text-center py-16"},x3={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},I3={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},E3={class:"mb-6"},T3={class:"mb-6"},A3={class:"mb-6"},S3={class:"flex justify-end space-x-3"},P3=["disabled"],R3={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},C3={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},k3={class:"text-center mb-6"},D3={class:"text-gray-300"},N3={__name:"Seasons",setup(n){const e=S([]),t=S(!0),r=dl(),s=S(null),i=S(!1),o=S(!1),a=S(""),l=S(""),c=S(""),h=S(null),f=S(!1),g=S(null),y=S(""),I=S(null),A=S(!1),P=S(!1),j=S(!1);Un(async()=>{var O;try{if(ev("firebase"),await pT(),e.value=await Td(),oe.info("Saisons chargées",{count:((O=e.value)==null?void 0:O.length)||0}),e.value.length>0){const Q=await Promise.all(e.value.map(async ce=>{try{const[fe,xe]=await Promise.all([ih(ce.id),Au(ce.id)]);return oe.debug(`Saison ${ce.name}: ${(fe==null?void 0:fe.length)||0} événements, ${(xe==null?void 0:xe.length)||0} joueurs`),{...ce,events:fe||[],players:xe||[]}}catch(fe){return oe.warn(`Erreur lors du chargement des données pour la saison ${ce.id}`,fe),{...ce,events:[],players:[]}}}));e.value=Q,oe.info("Données des saisons chargées",{count:e.value.length})}w().catch(Q=>oe.error("Migration sortOrder échouée",Q))}finally{t.value=!1}const U=()=>{j.value=window.scrollY>10};return window.addEventListener("scroll",U,{passive:!0}),()=>{window.removeEventListener("scroll",U)}});const B=je(()=>[...e.value].sort((U,O)=>{var Oe,ke;const Q=typeof U.sortOrder=="number"?U.sortOrder:Number.MAX_SAFE_INTEGER,ce=typeof O.sortOrder=="number"?O.sortOrder:Number.MAX_SAFE_INTEGER;if(Q!==ce)return Q-ce;const fe=(Oe=U.createdAt)!=null&&Oe.toMillis?U.createdAt.toMillis():0,xe=(ke=O.createdAt)!=null&&ke.toMillis?O.createdAt.toMillis():0;return fe!==xe?xe-fe:(U.name||"").localeCompare(O.name||"")}));function $(U){r.push(`/season/${U}`)}function z(U){s.value=s.value===U?null:U}function he(){s.value=null}function ve(){const U=document.querySelector(".help-section");U&&U.scrollIntoView({behavior:"smooth"})}function T(){const U=document.querySelector(".seasons-section");U&&U.scrollIntoView({behavior:"smooth"})}async function w(){if(!e.value.length)return;const U=e.value.map(Q=>typeof Q.sortOrder=="number"?Q.sortOrder:null).filter(Q=>Q!==null);let O=U.length?Math.max(...U):0;for(const Q of e.value)if(typeof Q.sortOrder!="number"){O+=1;try{await Zl(Q.id,O),Q.sortOrder=O}catch(ce){oe.error("Erreur migration sortOrder",{seasonName:Q==null?void 0:Q.name,error:ce})}}}async function E(U){try{if(!(U!=null&&U.id)){alert("Saison introuvable");return}const[O,Q]=await Promise.all([ih(U.id),Au(U.id)]),[ce,fe]=await Promise.all([To(Q,O,U.id),Ao(U.id)]),xe=["Joueur",...O.map(Rt=>L(Rt))],Oe=[];for(const Rt of Q){const kn=(Rt==null?void 0:Rt.name)||"",ur=(ce==null?void 0:ce[kn])||{},Dt=[kn,...O.map(an=>ne(ur[an.id],fe==null?void 0:fe[an.id],kn))];Oe.push(Dt)}const ke=R([xe,...Oe]),Be=new Blob(["\uFEFF"+ke],{type:"text/csv;charset=utf-8;"}),et=(U==null?void 0:U.name)||(U==null?void 0:U.slug)||"saison",on=`${Ze(et)}-disponibilites.csv`,jt=URL.createObjectURL(Be),qt=document.createElement("a");qt.href=jt,qt.download=on,document.body.appendChild(qt),qt.click(),document.body.removeChild(qt),URL.revokeObjectURL(jt),oe.info("Export CSV saison",{seasonId:U.id,events:O.length,players:Q.length})}catch(O){oe.error("Erreur export CSV",O),alert("Erreur lors de l'export CSV. Veuillez réessayer.")}}function D(U){if(!U)return null;if(U instanceof Date)return U;if(typeof(U==null?void 0:U.toDate)=="function")return U.toDate();if(typeof U=="string"||typeof U=="number"){const O=new Date(U);return isNaN(O.getTime())?null:O}return null}function L(U){const O=D(U==null?void 0:U.date),Q=O?`${O.getFullYear()}-${String(O.getMonth()+1).padStart(2,"0")}-${String(O.getDate()).padStart(2,"0")}`:"",ce=(U==null?void 0:U.title)||"Sans titre";return`${Q} · ${ce}`.trim()}function q(U){return U===!0||U==="oui"?"disponible":U===!1||U==="non"?"non disponible":""}function R(U){return U.map(O=>O.map(ft).join(",")).join(`
`)}function ft(U){const O=String(U??"");return/[",\n\r]/.test(O)?'"'+O.replace(/"/g,'""')+'"':O}function Ze(U){return String(U||"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9\-_. ]+/g,"-").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$|^\.+|\.+$/g,"")||"fichier"}function ne(U,O,Q){return Array.isArray(O)&&O.includes(Q)?U===!1||U==="non"?"non disponible":"sélectionné":q(U)}async function F(U){if(he(),U<=0)return;const O=[...B.value],Q=O[U],ce=O[U-1],fe=Q.sortOrder;Q.sortOrder=ce.sortOrder,ce.sortOrder=fe;try{await Promise.all([Zl(Q.id,Q.sortOrder),Zl(ce.id,ce.sortOrder)])}catch(xe){oe.error("Erreur lors du déplacement vers le haut",xe)}}async function W(U){he();const O=[...B.value];if(U>=O.length-1)return;const Q=O[U],ce=O[U+1],fe=Q.sortOrder;Q.sortOrder=ce.sortOrder,ce.sortOrder=fe;try{await Promise.all([Zl(Q.id,Q.sortOrder),Zl(ce.id,ce.sortOrder)])}catch(xe){oe.error("Erreur lors du déplacement vers le bas",xe)}}function se(){a.value&&(l.value=a.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function Pe(){c.value=c.value.replace(/[^0-9]/g,""),c.value.length>4&&(c.value=c.value.slice(0,4))}async function te(){if(!a.value.trim()||!l.value.trim()||!c.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(c.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await PO(a.value.trim(),l.value.trim(),c.value.trim()),e.value=await Td(),await w(),J()}catch(U){oe.error("Erreur lors de la création de la saison",U),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function J(){i.value=!1,a.value="",l.value="",c.value=""}function Ee(U){h.value=U,o.value=!0}async function Ge(){o.value=!1,await Z({type:"deleteSeason",data:{seasonId:h.value.id,seasonName:h.value.name}})}function pt(){o.value=!1,h.value=null}function It(){return g.value?{deleteSeason:"Suppression de saison - Code PIN requis"}[g.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function Z(U){if(On.isPinCached(h.value.id)){const O=On.getCachedPin(h.value.id);if(oe.debug("PIN en cache trouvé, utilisation automatique"),await nh(h.value.id,O)){await We(U);return}else On.clearSession()}g.value=U,f.value=!0}async function Ae(U){var O,Q,ce,fe;oe.debug("PIN soumis pour l'opération",{operationType:(O=g.value)==null?void 0:O.type});try{const xe=((ce=(Q=g.value)==null?void 0:Q.data)==null?void 0:ce.seasonId)||((fe=h.value)==null?void 0:fe.id),Oe=await nh(xe,U);if(oe.debug("PIN validé",{valid:Oe}),Oe){On.saveSession(xe,U),oe.debug("PIN correct, fermeture de la modal et exécution de l'opération"),f.value=!1;const ke=g.value;g.value=null,oe.debug("Appel de executePendingOperation",{operationType:ke==null?void 0:ke.type}),await We(ke)}else y.value="Code PIN incorrect",setTimeout(()=>{y.value=""},3e3)}catch(xe){oe.error("Erreur lors de la vérification du PIN",xe),y.value="Erreur lors de la vérification du code PIN"}}function we(){f.value=!1,g.value=null,y.value=""}function De(){return h.value&&On.isPinCached(h.value.id)?{timeRemaining:On.getTimeRemaining(),isExpiringSoon:On.isExpiringSoon()}:null}async function We(U){var ce;if(oe.debug("executePendingOperation appelé",{hasOperation:!!U}),!U){oe.warn("Aucune opération à exécuter");return}const{type:O,data:Q}=U;oe.info("Exécution de l'opération",{type:O});try{switch(O){case"deleteSeason":oe.info("Suppression de la saison",{seasonId:Q.seasonId}),await RO(Q.seasonId),oe.info("Saison supprimée, rechargement de la liste"),e.value=await Td(),oe.info("Liste des saisons rechargée",{count:((ce=e.value)==null?void 0:ce.length)||0});break;default:oe.warn("Type d'opération non reconnu",{type:O})}}catch(fe){oe.error("Erreur lors de l'exécution de l'opération",fe),alert("Erreur lors de l'opération. Veuillez réessayer.")}}function at(U){I.value=U,oe.debug("État de connexion changé",{isLoggedIn:!!U,email:(U==null?void 0:U.email)||"non connecté"})}function x(){A.value=!0}function C(){A.value=!1}function M(){A.value=!1,be()}function ue(){P.value=!0}function re(){P.value=!1}async function ae(){try{await ht.signOut(),P.value=!1,I.value=null,oe.info("Utilisateur déconnecté avec succès")}catch(U){oe.error("Erreur lors de la déconnexion",U),alert("Erreur lors de la déconnexion. Veuillez réessayer.")}}async function be(){try{const U=await wE();if(U){r.push(`/season/${U}`);return}}catch(U){oe.warn("Impossible de récupérer la saison préférée",U)}T()}return Un(()=>{I.value=ht.currentUser;const U=ht.onAuthStateChanged(at);return()=>{U()}}),(U,O)=>{var Q;return N(),V("div",z4,[d("header",{class:Ot(["fixed top-0 left-0 right-0 z-50 transition-all duration-300",j.value?"bg-white/95 backdrop-blur-md border-b border-gray-200/50 shadow-lg":"bg-gray-900/20 backdrop-blur-sm"])},[d("nav",K4,[d("div",G4,[O[8]||(O[8]=Ln('<div class="flex items-center"><a href="/" class="flex items-center"><div class="relative w-48 h-12 md:w-56 md:h-14"><img src="'+l_+'" alt="Logo HatCast - Retour à l&#39;accueil" class="w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 md:hidden"><img src="'+qO+'" alt="Logo HatCast - Retour à l&#39;accueil" class="w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 hidden md:block"></div></a></div>',1)),d("div",H4,[I.value?(N(),V("button",{key:1,onClick:ue,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Mon compte","aria-label":"Mon compte"},O[7]||(O[7]=[d("span",{class:"text-2xl"},"👤",-1)]))):(N(),V("button",{key:0,onClick:x,class:Ot(["px-4 py-2 rounded-lg transition-all duration-300 border transition-colors",j.value?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700":"bg-white/10 hover:bg-white/20 text-white border-white/20 hover:border-white/40"])}," Connexion ",2))])])])],2),d("section",W4,[d("div",Q4,[d("div",J4,[d("div",Y4,[O[12]||(O[12]=Ln('<div class="text-center order-2 lg:order-1"><div class="hero-content-wrapper"><div class="hero-illustration relative hidden lg:block"><div class="relative mx-auto lg:mx-0 w-full max-w-lg"><div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-4 shadow-2xl border border-white/10 relative overflow-hidden"><div class="absolute inset-0 bg-gradient-to-br from-pink-500/10 via-purple-500/10 to-cyan-500/10 rounded-3xl blur-xl"></div><div class="relative z-10"><div class="flex items-center gap-3 mb-4"><div class="flex gap-2"><div class="w-3 h-3 bg-red-500 rounded-full"></div><div class="w-3 h-3 bg-yellow-500 rounded-full"></div><div class="w-3 h-3 bg-green-500 rounded-full"></div></div><div class="text-gray-400 text-sm">HatCast - Grille des disponibilités</div></div></div><div class="bg-gray-700 rounded-2xl p-4 min-h-[300px]"><div class="grid grid-cols-4 gap-2 mb-4"><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">15 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">22 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">29 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">5 Fév</div></div><div class="space-y-2"><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Marie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-gray-500/20 border border-gray-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Pierre</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Sophie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div></div></div></div></div><div class="absolute -top-4 -right-4 w-20 h-20 bg-gradient-to-r from-pink-400 to-purple-500 rounded-2xl shadow-xl transform rotate-12 z-30"></div><div class="absolute -bottom-4 -left-4 w-16 h-16 bg-gradient-to-r from-cyan-400 to-blue-500 rounded-2xl shadow-xl transform -rotate-12 z-30 flex items-center justify-center"><img src="'+BO+'" alt="Masque HatCast" class="w-10 h-10 object-contain transform rotate-12"></div></div></div></div>',1)),d("div",X4,[O[11]||(O[11]=Ln('<div class="hero-title mb-8"><h1 class="text-4xl md:text-6xl font-bold text-white mb-6 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent leading-tight"> Faites vos équipes d&#39;impro…<br>en un clin d&#39;œil </h1></div><div class="hero-subtitle mb-10"><p class="text-xl md:text-2xl text-gray-300 leading-relaxed max-w-2xl"> Plus de casse-tête pour savoir qui joue quand. Chacun indique ses dispos, <strong class="text-white">HatCast compose l&#39;équipe pour vous</strong>, équitablement et sans tension. </p></div>',2)),d("div",Z4,[d("div",e3,[d("button",{onClick:O[0]||(O[0]=ce=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-5 px-10 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105 text-lg md:text-xl"}," 🚀 Démarrez "),d("button",{onClick:ve,class:"inline-flex items-center gap-2 text-cyan-300 hover:text-cyan-200 font-medium py-3 px-6 rounded-lg hover:bg-cyan-500/10 transition-all duration-300 border border-cyan-500/30 hover:border-cyan-400/50"},O[9]||(O[9]=[d("span",null,"ℹ️",-1),zt(" En savoir plus ")]))])]),d("div",{class:"hero-hint text-center"},[d("button",{onClick:T,class:"inline-flex items-center gap-2 text-gray-400 hover:text-cyan-300 transition-all duration-300 text-sm cursor-pointer group"},O[10]||(O[10]=[d("span",{class:"group-hover:animate-bounce"},"↓",-1),d("span",null,"Vos saisons ci-dessous",-1),d("span",{class:"group-hover:animate-bounce"},"↓",-1)]))])])])])]),O[13]||(O[13]=d("div",{class:"hero-background absolute inset-0 z-0"},[d("div",{class:"absolute top-20 left-10 w-32 h-32 bg-pink-500/10 rounded-full blur-3xl"}),d("div",{class:"absolute bottom-20 right-10 w-40 h-40 bg-purple-500/10 rounded-full blur-3xl"}),d("div",{class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-cyan-500/5 rounded-full blur-3xl"})],-1))]),d("section",t3,[d("div",n3,[O[26]||(O[26]=d("div",{class:"text-center mb-12"},[d("h2",{class:"text-3xl md:text-4xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"}," Saisons en cours "),d("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto"}," Sélectionnez une saison pour gérer les disponibilités et équipes. ")],-1)),d("div",{class:"pb-16","aria-busy":t.value},[t.value?(N(),V("div",s3,[(N(),V(ct,null,Ar(8,ce=>d("div",{key:"skeleton-"+ce,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8 w-full max-w-sm"},O[14]||(O[14]=[d("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),d("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),d("div",{class:"h-px bg-white/10 mb-4"},null,-1),d("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(N(),V("div",i3,[(N(!0),V(ct,null,Ar(B.value,(ce,fe)=>{var xe,Oe;return N(),V("div",{key:ce.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20 w-full max-w-sm"},[d("div",{onClick:ke=>$(ce.slug),class:"text-center cursor-pointer"},[O[17]||(O[17]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg"},[d("span",{class:"text-2xl"},"🎭")],-1)),d("h2",a3,le(ce.name),1),O[18]||(O[18]=d("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),d("div",l3,[d("div",u3,[d("div",c3,le(((xe=ce.events)==null?void 0:xe.length)||0),1),O[15]||(O[15]=d("div",{class:"text-gray-400 text-xs"},"Événements",-1))]),d("div",d3,[d("div",h3,le(((Oe=ce.players)==null?void 0:Oe.length)||0),1),O[16]||(O[16]=d("div",{class:"text-gray-400 text-xs"},"Joueurs",-1))])])],8,o3),d("div",f3,[d("div",{class:"relative",onClick:O[1]||(O[1]=gt(()=>{},["stop"]))},[d("button",{onClick:ke=>z(fe),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===fe,"aria-haspopup":"true",title:"Options"},O[19]||(O[19]=[d("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,p3),s.value===fe?(N(),V("div",m3,[d("button",{onClick:ke=>{E(ce),he()},class:"w-full text-left px-4 py-2 text-sm text-emerald-300 hover:bg-white/10",role:"menuitem"}," Exporter CSV ",8,g3),O[20]||(O[20]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:ke=>F(fe),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Monter ",8,v3),d("button",{onClick:ke=>W(fe),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Descendre ",8,y3),O[21]||(O[21]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:ke=>Ee(ce),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10",role:"menuitem"}," Supprimer ",8,_3)])):_e("",!0)])])])}),128))])):_e("",!0),d("div",b3,[d("button",{onClick:O[2]||(O[2]=ce=>i.value=!0),class:"inline-flex items-center gap-3 bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-semibold py-4 px-8 rounded-xl text-lg hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-pink-500/25"},O[22]||(O[22]=[d("span",null,"➕",-1),zt(" Nouvelle saison ")]))]),!t.value&&e.value.length===0?(N(),V("div",w3,[O[23]||(O[23]=d("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[d("span",{class:"text-4xl"},"🎪")],-1)),O[24]||(O[24]=d("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),O[25]||(O[25]=d("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),d("button",{onClick:O[3]||(O[3]=ce=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):_e("",!0)],8,r3)])]),i.value?(N(),V("div",x3,[d("div",I3,[O[31]||(O[31]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),d("div",E3,[O[27]||(O[27]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),tt(d("input",{"onUpdate:modelValue":O[4]||(O[4]=ce=>a.value=ce),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:se},null,544),[[Vt,a.value]])]),d("div",T3,[O[28]||(O[28]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),tt(d("input",{"onUpdate:modelValue":O[5]||(O[5]=ce=>l.value=ce),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[Vt,l.value]])]),d("div",A3,[O[29]||(O[29]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),tt(d("input",{"onUpdate:modelValue":O[6]||(O[6]=ce=>c.value=ce),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:Pe},null,544),[[Vt,c.value]]),O[30]||(O[30]=d("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),d("div",S3,[d("button",{onClick:J,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:te,disabled:!a.value.trim()||!l.value.trim()||!c.value.trim()||c.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,P3)])])])):_e("",!0),o.value?(N(),V("div",R3,[d("div",C3,[d("div",k3,[O[32]||(O[32]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"⚠️")],-1)),O[33]||(O[33]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),d("p",D3,'Êtes-vous sûr de vouloir supprimer la saison "'+le((Q=h.value)==null?void 0:Q.name)+'" ?',1)]),O[34]||(O[34]=d("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:pt,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:Ge,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):_e("",!0),nt(xE,{show:f.value,message:It(),error:y.value,"session-info":De(),onSubmit:Ae,onCancel:we},null,8,["show","message","error","session-info"]),O[35]||(O[35]=Ln('<section class="help-section py-20 bg-gradient-to-br from-gray-900/50 to-gray-800/50 border-t border-white/10"><div class="container mx-auto px-4"><div class="max-w-6xl mx-auto"><div class="text-center mb-16"><h2 class="text-4xl md:text-5xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"> Qu&#39;est-ce que HatCast ? </h2><p class="text-xl text-purple-300 max-w-3xl mx-auto"> L&#39;appli pour sélectionner vos joueurs d&#39;impro simplement, équitablement et sans prise de tête </p></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16"><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-pink-500/20 to-purple-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-pink-500/30"><span class="text-4xl">🎭</span></div><h3 class="text-xl font-bold text-white mb-3">Gestion des saisons</h3><p class="text-gray-300 text-sm leading-relaxed"> Déclarez tous vos spectacles et indiquez combien de joueurs vous aurez besoin. Organisez votre saison d&#39;impro de A à Z. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-purple-500/20 to-cyan-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-purple-500/30"><span class="text-4xl">📅</span></div><h3 class="text-xl font-bold text-white mb-3">Sondage de disponibilités</h3><p class="text-gray-300 text-sm leading-relaxed"> Créez des sondages pour vos événements. Chaque joueur indique ses disponibilités et HatCast optimise la composition des équipes. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-cyan-500/20 to-pink-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-cyan-500/30"><span class="text-4xl">🎲</span></div><h3 class="text-xl font-bold text-white mb-3">Sélection auto ou manuelle</h3><p class="text-gray-300 text-sm leading-relaxed"> Laissez le hasard pondéré décider ou reprenez la main à tout moment. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-green-500/20 to-blue-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-green-500/30"><span class="text-4xl">📱</span></div><h3 class="text-xl font-bold text-white mb-3">Pensé pour le mobile</h3><p class="text-gray-300 text-sm leading-relaxed"> Utilisez HatCast facilement sur smartphone ou tablette, où que vous soyez. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-blue-500/20 to-indigo-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-blue-500/30"><span class="text-4xl">🔐</span></div><h3 class="text-xl font-bold text-white mb-3">Comptes facultatifs</h3><p class="text-gray-300 text-sm leading-relaxed"> Créez un compte pour recevoir des rappels et sécuriser vos infos. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-emerald-500/20 to-teal-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-emerald-500/30"><span class="text-4xl">🔔</span></div><h3 class="text-xl font-bold text-white mb-3">Notifications intelligentes</h3><p class="text-gray-300 text-sm leading-relaxed"> Recevez des alertes par email et push pour les événements et sélections. Restez informé sans être submergé. </p></div></div></div></div></section><footer class="border-t border-white/10 bg-gradient-to-br from-gray-900/50 to-gray-800/50"><div class="container mx-auto px-4 py-12"><div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8"><div class="col-span-1 md:col-span-2"><div class="flex items-center gap-3 mb-4"><div class="relative w-32 h-8"><img src="'+l_+'" alt="Logo HatCast" class="w-full h-full opacity-80"></div></div><p class="text-gray-400 text-sm leading-relaxed max-w-md"> L&#39;appli pour sélectionner vos joueurs d&#39;impro simplement, équitablement et sans prise de tête. </p></div><div><h4 class="text-white font-semibold mb-4 text-sm uppercase tracking-wider">Contact</h4><div class="space-y-2"><a href="mailto:contact@hatcast.app" class="block text-gray-400 hover:text-blue-300 transition-colors text-sm"> 📧 contact@hatcast.app </a><p class="text-gray-500 text-xs">Retours et suggestions bienvenus</p></div></div><div><h4 class="text-white font-semibold mb-4 text-sm uppercase tracking-wider">Ressources</h4><div class="space-y-2"><a href="#" class="block text-gray-400 hover:text-blue-300 transition-colors text-sm"> 📚 Guide utilisateur </a><a href="https://github.com/plamarque/hatcast" target="_blank" rel="noopener noreferrer" class="block text-gray-400 hover:text-blue-300 transition-colors text-sm"> 🔗 Code source </a><p class="text-gray-500 text-xs">Documentation en cours</p></div></div></div><div class="border-t border-white/10 mb-6"></div><div class="flex flex-col sm:flex-row items-center justify-between text-xs text-gray-500"><div class="flex items-center gap-4 mb-4 sm:mb-0"><span>© Patrice Lamarque 2025</span><span class="hidden sm:inline">•</span><span>Licence MIT</span></div><div class="flex items-center gap-4"><span class="text-gray-600">En cours de développement</span><a href="https://github.com/plamarque/hatcast" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-blue-300 transition-colors underline decoration-gray-600 hover:decoration-blue-300"> GitHub </a></div></div></div></footer>',2)),nt(EE,{show:A.value,onClose:C,onSuccess:M},null,8,["show"]),nt(fT,{show:P.value,onClose:re,onLogoutDevice:ae},null,8,["show"])])}}};function V3({reason:n,recipientName:e,eventTitle:t,eventDate:r,urls:s={},prefs:i={},extra:o={}}){const a={email:null,push:null};if(n==="availability_request"||n==="availability_reminder"){const l=(i==null?void 0:i.notifyAvailability)!==!1,c=(i==null?void 0:i.notifyAvailabilityPush)!==!1;a.email={enabled:l,subject:n==="availability_reminder"?`Rappel disponibilité · ${t} (${r})`:`Disponibilité demandée · ${t} (${r})`},a.push={enabled:c,title:n==="availability_reminder"?"⏰ Rappel disponibilité":"🗓️ Disponibilité demandée",body:`${e}, ${t} (${r})`,data:{url:s.eventUrl,yesUrl:s.yesUrl,noUrl:s.noUrl,reason:n}}}if(n==="selection"){const l=(i==null?void 0:i.notifySelection)!==!1,c=(i==null?void 0:i.notifySelectionPush)!==!1;a.email={enabled:l,subject:`🎭 Sélection confirmée · ${t}`},a.push={enabled:c,title:"🎭 Sélection confirmée",body:`${e}, tu as été sélectionné(e) pour ${t} (${r}) 🎉`,data:{url:s.eventUrl}}}return a}async function O3({reason:n,recipientEmail:e,recipientName:t,eventTitle:r,eventDate:s,urls:i={},extra:o={}}){if(!e)return{success:!1,skipped:!0,reason:"missing_email"};const a=await Wt(Re(de,"userPreferences",e)).catch(()=>null),l=a!=null&&a.exists()?a.data():{},c=V3({reason:n,recipientName:t,eventTitle:r,eventDate:s,urls:i,prefs:l,extra:o}),h=[];return c.email&&c.email.enabled&&(n==="availability_request"||n==="availability_reminder"?await _M({toEmail:e,playerName:t,eventTitle:r,eventDate:s,yesUrl:i.yesUrl,noUrl:i.noUrl,eventUrl:i.eventUrl,reason:n==="availability_reminder"?"reminder":"new_event"}).then(()=>h.push({channel:"email",success:!0})).catch(g=>{oe.error("notifyRecipientAcrossChannels email error",g),h.push({channel:"email",success:!1})}):n==="selection"&&h.push({channel:"email",success:!0,skipped:!0,note:"batch_handled_elsewhere"})),c.push&&c.push.enabled&&await Sc({toEmail:e,title:c.push.title,body:c.push.body,data:c.push.data||{},reason:n}).then(()=>h.push({channel:"push",success:!0})).catch(g=>{oe.error("notifyRecipientAcrossChannels push error",g),h.push({channel:"push",success:!1})}),{success:h.some(g=>g.success),results:h}}async function x_({eventId:n,eventData:e,players:t,seasonId:r,seasonSlug:s,createMagicLink:i,reminder:o=!1,getAvailabilityForEvent:a=null}){const l=[],c=`${window.location.origin}/season/${s}/event/${n}`;for(const h of t)try{if(o&&typeof a=="function"){const y=await Promise.resolve(a(h.name,n));if(y===!0||y===!1)continue}const f={};if(typeof i=="function"){const y=await i({seasonId:r,playerId:h.id,eventId:n,action:"yes"}),I=await i({seasonId:r,playerId:h.id,eventId:n,action:"no"});f.yesUrl=`${y.url}&slug=${encodeURIComponent(s)}`,f.noUrl=`${I.url}&slug=${encodeURIComponent(s)}`}f.eventUrl=c,(await O3({reason:o?"availability_reminder":"availability_request",recipientEmail:h.email,recipientName:h.name,eventTitle:e.title,eventDate:M3(e.date),urls:f})).success||l.push(h.id)}catch{l.push(h.id)}return{success:!0,failures:l}}async function I_(n){return IM(n)}function M3(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function L3(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Impro Selector//Calendar Event//FR","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${n.id}@hatcast.app`,`DTSTAMP:${new Date().toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTSTART:${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTEND:${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`SUMMARY:${n.title}`,`DESCRIPTION:${n.description||""}${e?`\\n\\nSaison : ${e}`:""}`,"STATUS:CONFIRMED","SEQUENCE:0","BEGIN:VALARM","TRIGGER:-PT1H","ACTION:DISPLAY",`DESCRIPTION:Rappel : ${n.title}`,"END:VALARM","END:VEVENT","END:VCALENDAR"].join(`\r
`)}function $3(n,e=""){const t=L3(n,e),r=new Blob([t],{type:"text/calendar;charset=utf-8"}),s=URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=`${n.title.replace(/[^a-z0-9]/gi,"_")}_${n.date}.ics`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)}function F3(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://calendar.google.com/calendar/render?${new URLSearchParams({action:"TEMPLATE",text:n.title,dates:`${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z/${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,details:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"Impro Selector",sf:"true",output:"xml"}).toString()}`}function U3(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://outlook.live.com/calendar/0/deeplink/compose?${new URLSearchParams({subject:n.title,startdt:r.toISOString(),enddt:s.toISOString(),body:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"Impro Selector",allday:"false"}).toString()}`}function j3(n,e=""){const t=F3(n,e);window.open(t,"_blank")}function q3(n,e=""){const t=U3(n,e);window.open(t,"_blank")}function B3(n,e,t=""){switch(n){case"ics":$3(e,t);break;case"google":j3(e,t);break;case"outlook":q3(e,t);break;default:console.warn("Type de calendrier non supporté:",n)}}const z3="/icons/manifest-icon-192.maskable.png",K3={class:"relative p-5 pb-4 border-b border-white/10"},G3={class:"text-xl md:text-2xl font-bold text-white pr-10 flex items-center gap-2"},H3={key:0,class:"text-sm text-purple-300 mt-1"},W3={class:"px-4 md:px-6 py-4 md:py-6 space-y-6 overflow-y-auto"},Q3={class:"space-y-4"},J3={class:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2"},Y3={key:0,class:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-3"},X3={class:"bg-gray-800 border border-gray-600 rounded-lg p-3"},Z3={key:0,class:"space-y-2"},e$={class:"flex flex-wrap gap-2"},t$=["onClick","title"],n$={key:1,class:"text-amber-400 text-sm"},r$={class:"inline-flex bg-gray-800 rounded-lg overflow-hidden border border-gray-700 mb-3"},s$={class:"text-sm text-gray-300"},i$={class:"text-sm text-gray-300"},o$={class:"text-sm text-gray-300"},a$=["innerHTML"],l$=["value"],u$={class:"mt-3"},c$={class:"text-lg font-semibold leading-snug"},d$={class:"mt-2 text-base whitespace-pre-line text-white/90"},h$={class:"mt-4 flex items-center gap-4 text-base"},f$={key:1,class:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-gray-100 text-gray-900 border border-white/20"},p$={class:"bg-yellow-500/10 border border-yellow-500/30 text-yellow-200 rounded-md p-3 text-sm mb-2"},m$=["value"],g$={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},v$={class:"flex items-center gap-2 w-full"},y$=["disabled"],_$={key:0},b$={class:"hidden sm:inline"},w$={key:1,class:"inline-flex items-center gap-2"},x$=["title"],I$={key:0},E$={key:1},gT={__name:"EventAnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},mode:{type:String,default:"event",validator:n=>["event","selection"].includes(n)},selectedPlayers:{type:Array,default:()=>[]},sending:{type:Boolean,default:!1},availabilityByPlayer:{type:Object,default:()=>({})}},emits:["close","notifications-sent","send-notifications"],setup(n,{emit:e}){const t=n,r=e;S("notify");const s=S(!1),i=S("Copier le message"),o=S(!1),a=je(()=>t.sending||o.value),l=S(!1),c=S("email"),h=je(()=>!t.event||!t.seasonSlug?"":`${window.location.origin}/season/${t.seasonSlug}/event/${t.event.id}`),f=je(()=>{if(!t.event)return"";if(c.value==="push"){const F=P.value,W=j.value;if(t.mode==="event"){const se=`

Lien direct: ${h.value}`;return`${F}
${W}
✅ Dispo
❌ Pas dispo${se}`}return`${F}
${W}
Ouvrir`}const ne=`

Lien direct: ${h.value}`;return`Objet: ${g.value}

${A.value}${ne}`}),g=je(()=>{var F,W,se;const ne=q((F=t.event)==null?void 0:F.date);return t.mode==="event"?`${(W=t.event)==null?void 0:W.title} (${ne})`:`🎭 Sélectionné pour ${(se=t.event)==null?void 0:se.title}`}),y=je(()=>"contact@hatcast.app"),I=je(()=>{var W,se,Pe,te,J,Ee,Ge;const ne=((W=z.value)==null?void 0:W.id)==="ALL"?"<joueur>":((se=z.value)==null?void 0:se.name)||"[Nom du joueur]",F=q((Pe=t.event)==null?void 0:Pe.date);return z.value&&z.value.id&&z.value.id!=="ALL"&&!((te=ve.value.find(pt=>pt.id===z.value.id))!=null&&te.hasContact)?`
      <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
        <p><strong>${ne}</strong> n'a pas configuré d'email. Utilise la fonction « Copier le message » et envoie-lui ces informations par un autre canal.</p>
        <p style="margin-top: 8px; font-weight: 600;">${(J=t.event)==null?void 0:J.title}</p>
        <p style="color:#374151;">${F}</p>
        <p style="margin-top: 8px;">Lien direct : ${h.value}</p>
      </div>
    `:t.mode==="event"?`
      <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
        <p><strong>${ne}</strong>, un nouvel événement est prévu.</p>
        <p style="margin: 12px 0 2px 0; font-weight: 600;">${(Ee=t.event)==null?void 0:Ee.title}</p>
        <p style="margin: 0 0 16px 0; color:#374151;">${F}</p>
        <p>Nous avons besoin de savoir si tu es disponible.</p>
        <p style="margin-top: 12px;">
          <a href="#yes" style="display:inline-block;padding:10px 12px;margin-right:8px;border:2px solid #16a34a;color:#16a34a;border-radius:8px;text-decoration:none;">✅ Dispo</a>
          <a href="#no" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Pas dispo</a>
        </p>
        <p style="margin-top: 16px;">Merci!!</p>
      </div>
    `:`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p><strong>${ne}</strong>, tu as été sélectionné pour <strong>${(Ge=t.event)==null?void 0:Ge.title}</strong> le <strong>${F}</strong>!</p>
      <p style="margin-top: 16px; font-weight: 600;">Actions rapides :</p>
      <p style="margin-top: 8px;">
        <a href="#no" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Pas dispo</a>
      </p>
    </div>
  `}),A=je(()=>I.value.replace(/<\/?div[^>]*>/g,`
`).replace(/<\/?p[^>]*>/g,`
`).replace(/<br\s*\/?>(\n)?/g,`
`).replace(/<[^>]+>/g,"").replace(/\n{3,}/g,`

`).trim()),P=je(()=>{var ne,F;return t.mode==="event"?`${(ne=t.event)==null?void 0:ne.title} (${q((F=t.event)==null?void 0:F.date)})`:"🎭 Sélectionné pour"}),j=je(()=>{var Pe,te,J,Ee,Ge,pt;const ne=q((Pe=t.event)==null?void 0:Pe.date),F=((te=z.value)==null?void 0:te.id)==="ALL"?"<joueur>":((J=z.value)==null?void 0:J.name)||"[Nom du joueur]",W=z.value&&z.value.id&&z.value.id!=="ALL",se=W?!!((Ee=ve.value.find(It=>It.id===z.value.id))!=null&&Ee.hasContact):!0;return W&&!se?`${F} n'a pas installé l'appli. Envoie-lui ce message manuellement.
${(Ge=t.event)==null?void 0:Ge.title} (${ne})
Lien: ${h.value}`:t.mode==="event"?`${F}, t'es dispo ?`:`${F}, tu as été sélectionné pour ${(pt=t.event)==null?void 0:pt.title} le ${ne}!

[ Afficher les Détails]

Un imprévu ?
❌ Pas dispo`}),B=S([]),$=S([]),z=S(null),he=S([]),ve=je(()=>{const ne=$.value.map(W=>({...W,hasContact:W.id!=="ALL",missingReason:""})),F=he.value.map(W=>({...W,hasContact:!1,missingReason:"Aucun canal actif"}));return[{id:"ALL",name:"Tous",hasContact:!0},...ne.filter(W=>W.id!=="ALL"),...F]}),T=je(()=>{if(!z.value||z.value.id==="ALL")return!0;const ne=ve.value.find(F=>(F.id||F.name)===(z.value.id||z.value.name));return!!(ne!=null&&ne.hasContact)}),w=je(()=>{var W,se,Pe,te,J;const ne=((W=z.value)==null?void 0:W.id)==="ALL"?"<joueur>":((se=z.value)==null?void 0:se.name)||"[Nom du joueur]",F=q((Pe=t.event)==null?void 0:Pe.date);return t.mode==="selection"?`Bonjour ${ne},
Tu as été sélectionné(e) pour ${(te=t.event)==null?void 0:te.title} (${F})
Un imprévu ? ${E.value}
Détails : ${h.value}`:`Bonjour ${ne},
${(J=t.event)==null?void 0:J.title} (${F})
Peux-tu indiquer ta disponibilité ?
Lien : ${h.value}`}),E=je(()=>{var ne,F;try{const W=(ne=z.value)!=null&&ne.id&&z.value.id!=="ALL"?t.players.find(se=>se.id===z.value.id):null;return!W||!((F=t.event)!=null&&F.id)||!t.seasonId?"[lien désistement]":`${window.location.origin}/magic?auto=no&season=${encodeURIComponent(t.seasonId)}&player=${encodeURIComponent(W.id)}&event=${encodeURIComponent(t.event.id)}&slug=${encodeURIComponent(t.seasonSlug||"")}`}catch{return"[lien désistement]"}});async function D(){if(!t.seasonId)return;let ne=[];t.mode==="selection"?ne=t.players.filter(Pe=>t.selectedPlayers.includes(Pe.name)):ne=t.players.filter(Pe=>{var J;return typeof((J=t.availabilityByPlayer)==null?void 0:J[Pe.name])>"u"});const F=[];for(const Pe of ne)try{const{getPlayerEmail:te}=await tn(()=>Promise.resolve().then(()=>Ac),void 0),J=await te(Pe.id,t.seasonId);J&&F.push({...Pe,email:J})}catch(te){console.warn(`Impossible de charger l'email pour ${Pe.name}:`,te)}B.value=F;const W={id:"ALL",name:"Tous"};$.value=[W,...F];const se=ne.filter(Pe=>!F.find(te=>te.id===Pe.id)).map(Pe=>({id:Pe.id,name:Pe.name}));he.value=se,z.value||(z.value=W)}function L(){r("close")}function q(ne){var W;return ne?(typeof ne=="string"?new Date(ne):((W=ne.toDate)==null?void 0:W.call(ne))||ne).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function R(){const ne=f.value;navigator.clipboard.writeText(ne).then(()=>{s.value=!0,i.value="Copié !",setTimeout(()=>{s.value=!1,i.value="Copier le message"},2e3)}).catch(F=>{console.warn("Erreur lors de la copie du texte"),alert("Impossible de copier le message.")})}function ft(ne){z.value=ne}async function Ze(){if(!(!t.event||$.value.length===0)){o.value=!0;try{const ne=z.value&&z.value.id!=="ALL"?"single":"all",F=ne==="single"?{id:z.value.id,name:z.value.name,email:z.value.email}:null;t.mode==="selection"?r("send-notifications",{eventId:t.event.id,eventData:t.event,reason:"selection",selectedPlayers:t.selectedPlayers,scope:ne,recipient:F}):r("send-notifications",{eventId:t.event.id,eventData:t.event,reason:"manual",scope:ne,recipient:F})}catch{console.error("Erreur lors de l'envoi des notifications"),alert("Erreur lors de l'envoi des notifications. Veuillez réessayer.")}}}return Un(()=>{t.show&&D()}),St(()=>t.show,ne=>{ne&&D()}),St(()=>t.selectedPlayers,()=>{t.show&&t.mode==="selection"&&D()}),St(()=>t.availabilityByPlayer,()=>{t.show&&t.mode==="event"&&D()},{deep:!0}),St(()=>t.sending,ne=>{ne||(o.value=!1)}),(ne,F)=>{var W,se,Pe,te,J;return n.show?(N(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:L},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] flex flex-col",onClick:F[3]||(F[3]=gt(()=>{},["stop"]))},[d("div",K3,[d("button",{onClick:L,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("h2",G3,[d("span",null,le(n.mode==="selection"?"📣":"📢"),1),d("span",null,le(n.mode==="selection"?"Annoncer la sélection":"Annoncer l'événement"),1)]),n.event?(N(),V("p",H3,le(n.event.title)+" — "+le(q(n.event.date)),1)):_e("",!0)]),d("div",W3,[d("div",Q3,[d("div",null,[d("label",J3,[F[4]||(F[4]=zt(" Personnes à Prévenir ")),d("button",{onClick:F[0]||(F[0]=Ee=>l.value=!l.value),class:"text-blue-400 hover:text-blue-300 text-lg cursor-help",title:"Cliquer pour plus d'information"}," ? ")]),l.value?(N(),V("div",Y3,F[5]||(F[5]=[d("p",{class:"text-blue-200 text-sm"},[zt(" Cette liste montre tous les joueurs ciblés: "),d("span",{class:"text-purple-300"},"« Tous »"),zt(", "),d("span",{class:"text-gray-200"},"ceux notifiables (email/push actifs)"),zt(" et "),d("span",{class:"text-yellow-300"},"ceux en jaune sans canal actif"),zt(". Les joueurs en jaune ne peuvent pas être notifiés automatiquement. Utilise « Copier le message » pour leur écrire via un autre moyen (l'URL de l'événement est incluse). ")],-1)]))):_e("",!0),d("div",X3,[ve.value.length>0?(N(),V("div",Z3,[d("div",e$,[(N(!0),V(ct,null,Ar(ve.value,Ee=>(N(),V("button",{key:Ee.id||Ee.name,type:"button",onClick:Ge=>ft(Ee),class:Ot(["px-3 py-1 rounded text-sm border transition-colors",z.value&&z.value.id===Ee.id?"bg-purple-600 border-purple-500 text-white":Ee.hasContact?"bg-gray-700 border-gray-600 text-white hover:bg-gray-600":"bg-yellow-900/20 border-yellow-600/40 text-yellow-200 hover:bg-yellow-900/30 opacity-75 cursor-not-allowed"]),title:Ee.hasContact?"Prévisualiser pour "+Ee.name:Ee.missingReason||"Aucun canal actif"},le(Ee.name),11,t$))),128))])])):(N(),V("div",n$," ⚠️ Aucun destinataire disponible. "))])]),d("div",null,[F[13]||(F[13]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Aperçu du message :",-1)),d("div",r$,[d("button",{class:Ot(["px-3 py-1.5 text-sm transition-colors",c.value==="email"?"bg-purple-600 text-white":"text-gray-300 hover:bg-gray-700"]),onClick:F[1]||(F[1]=Ee=>c.value="email"),title:"Prévisualiser l'email"},"📧",2),d("button",{class:Ot(["px-3 py-1.5 text-sm transition-colors",c.value==="push"?"bg-purple-600 text-white":"text-gray-300 hover:bg-gray-700"]),onClick:F[2]||(F[2]=Ee=>c.value="push"),title:"Prévisualiser la notification push"},"🔔",2)]),c.value==="email"?(N(),V("div",{key:0,class:Ot(T.value||((W=z.value)==null?void 0:W.id)==="ALL"?"bg-gray-800 border border-gray-600 rounded-lg p-4 text-white space-y-3":"space-y-3")},[T.value||((se=z.value)==null?void 0:se.id)==="ALL"?(N(),V(ct,{key:0},[d("div",s$,[F[6]||(F[6]=d("span",{class:"font-semibold"},"De:",-1)),zt(" "+le(y.value),1)]),d("div",i$,[F[7]||(F[7]=d("span",{class:"font-semibold"},"À:",-1)),zt(" "+le(((Pe=z.value)==null?void 0:Pe.id)==="ALL"?"<joueur>":((te=z.value)==null?void 0:te.name)||"[Nom du joueur]"),1)]),d("div",o$,[F[8]||(F[8]=d("span",{class:"font-semibold"},"Objet:",-1)),zt(" "+le(g.value),1)]),d("div",{class:"bg-white text-black rounded-md p-4",innerHTML:I.value},null,8,a$)],64)):(N(),V(ct,{key:1},[F[9]||(F[9]=d("div",{class:"bg-yellow-500/10 border border-yellow-500/30 text-yellow-200 rounded-md p-3 text-sm"}," Ce joueur n'a pas configuré d'email. Utilise la fonction « Copier le message » et envoie-lui ces informations par un autre canal. ",-1)),d("textarea",{class:"w-full mt-2 p-3 bg-gray-900 border border-gray-700 rounded-md text-white text-sm",value:w.value,rows:"5",readonly:""},null,8,l$)],64))],2)):(N(),V("div",{key:1,class:Ot(z.value&&z.value.id!=="ALL"&&!T.value?"text-white":"bg-gray-900 border border-gray-700 rounded-xl p-4 text-white")},[z.value&&z.value.id!=="ALL"&&!T.value?(N(),V(ct,{key:1},[d("div",p$,le((J=z.value)==null?void 0:J.name)+" n'a pas installé l'appli. Envoie-lui ce message manuellement. ",1),d("textarea",{class:"w-full p-3 bg-gray-800 border border-gray-700 rounded-md text-white text-sm",value:w.value,rows:"5",readonly:""},null,8,m$)],64)):(N(),V(ct,{key:0},[F[12]||(F[12]=Ln('<div class="flex items-center justify-between text-xs text-white/70"><div class="flex items-center gap-2 min-w-0"><div class="w-6 h-6 rounded-full bg-white/10 flex items-center justify-center">🔔</div><div class="truncate">Impropick</div><span class="opacity-60">•</span><span>il y a 1 min</span></div><img src="'+z3+'" alt="App icon" class="w-10 h-10 rounded-full shadow"></div>',1)),d("div",u$,[d("div",c$,le(P.value),1),d("div",d$,le(j.value),1)]),d("div",h$,[t.mode==="event"?(N(),V(ct,{key:0},[F[10]||(F[10]=d("span",{class:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-green-600/20 text-green-300 border border-green-600/40"},"✅ Dispo",-1)),F[11]||(F[11]=d("span",{class:"text-red-600/20 text-red-300 border border-red-600/40"},"❌ Pas dispo",-1))],64)):(N(),V("span",f$,"Ouvrir"))])],64))],2))])])]),d("div",g$,[d("div",v$,[d("button",{onClick:Ze,disabled:$.value.length===0||a.value||z.value&&z.value.id!=="ALL"&&!T.value,class:"h-12 px-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600 flex-1"},[a.value?(N(),V("span",w$,F[17]||(F[17]=[d("svg",{class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[d("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),d("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),zt(" Envoi en cours... ")]))):(N(),V("span",_$,[z.value&&z.value.id!=="ALL"?(N(),V("span",{key:0,class:Ot(T.value?"":"opacity-60")},[d("span",b$,"🔔 Notifier "+le(z.value.name),1),F[14]||(F[14]=d("span",{class:"sm:hidden"},"🔔 Notifier",-1))],2)):(N(),V(ct,{key:1},[F[15]||(F[15]=d("span",{class:"hidden sm:inline"},"🔔 Envoyer les notifications",-1)),F[16]||(F[16]=d("span",{class:"sm:hidden"},"🔔 Envoyer",-1))],64))]))],8,y$),d("button",{onClick:R,class:"h-12 px-6 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300",title:i.value},[s.value?(N(),V("span",E$,"✅ Copié")):(N(),V("span",I$,F[18]||(F[18]=[d("span",{class:"hidden sm:inline"},"📋 Copier le message",-1),d("span",{class:"sm:hidden"},"📋 Copier",-1)])))],8,x$)]),d("button",{onClick:L,class:"h-12 px-4 bg-gray-700 text-white rounded-lg"}," Fermer ")])])])):_e("",!0)}}},T$={class:"relative p-6 pb-4 border-b border-white/10"},A$={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},S$={__name:"AppHelpModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(N(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[95] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=gt(()=>{},["stop"]))},[d("div",T$,[d("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=d("div",{class:"flex items-center gap-3"},[d("div",{class:"w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-2xl"},"❓"),d("div",null,[d("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Kezako ?"),d("p",{class:"text-sm text-purple-300"},"L'appli pour sélectionner les joueurs d'impro de manière simple et apaisée")])],-1))]),s[5]||(s[5]=Ln('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">C&#39;est quoi ?</h3><p> Tu joues quand ? est une appli conçue pour faciliter <span class="text-white">la sélection des joueurs d&#39;impro</span> pour les spectacles. L&#39;idée est née au sein de <span class="text-purple-300">La Malice</span> pour <span class="text-white">dépersonnaliser une tâche délicate</span> qui créait des tensions depuis des années. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">Comment ça marche</h3><p> L&#39;asso déclare ses dates et le nombre de personnes nécessaires. Les joueurs indiquent leurs disponibilités. L&#39;appli propose des sélections. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Sélection auto ou manuelle</h3><p> Le <span class="text-white">mode sélection auto</span> s&#39;appuie sur le hasard (pondéré) pour simplifier la vie. Vous pouvez aussi repasser en mode <span class="text-white">manuel</span> si besoin. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Pensée mobile • Libre d&#39;utilisation</h3><p> L&#39;appli est <span class="text-white">pensée pour le mobile</span> et peut être utilisée librement par La Malice ou <span class="text-white">toute autre troupe</span>. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Comptes (facultatif)</h3><p> Les joueurs qui le souhaitent peuvent créer un compte via leur email pour <span class="text-white">recevoir des notifications</span>, <span class="text-white">protéger leurs saisies</span> et bénéficier d&#39;un meilleur confort d&#39;utilisation. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2 text-sm"><h3 class="text-white font-semibold">Statut &amp; licence</h3><p> Application <span class="text-white">en cours de développement</span>, <span class="text-white">sans garanties</span> à ce stade. Licence libre <span class="text-white">MIT</span>. </p><p>Contact &amp; retours : <a href="mailto:contact@hatcast.app" class="text-blue-300 underline">contact@hatcast.app</a></p></div></div>',1)),d("div",A$,[d("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):_e("",!0)}},P$={class:"text-center mb-6"},R$={class:"text-lg text-gray-300"},C$={class:"mb-6"},k$={class:"space-y-4"},D$={class:"flex items-center gap-2 text-gray-300 text-sm"},N$=["disabled"],V$={key:0,class:"animate-spin"},O$={key:1},M$={class:"mb-6 text-center"},L$={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},$$={class:"text-red-300 text-sm"},F$={class:"text-center mb-6"},U$={class:"text-lg text-gray-300"},j$={class:"mb-6"},q$=["disabled"],B$={key:0,class:"animate-spin"},z$={key:1},K$={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},G$={class:"text-red-300 text-sm"},H$={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},W$={class:"text-green-300 text-sm"},Q$={class:"flex justify-center"},tv={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S(!1),o=S(""),a=S(!1),l=S(""),c=S(""),h=S(null),f=S(!0);async function g(){if(s.value){i.value=!0,o.value="";try{const A=await Bp(t.seasonId);if(s.value===A){if(f.value)try{Fi.saveSession(t.player.id)}catch{}r("verified",{type:"season_pin"}),I();return}if(await LE(t.player.id,s.value,t.seasonId)){if(f.value)try{Fi.saveSession(t.player.id)}catch{}r("verified",{type:"player_password"}),I()}else o.value="Mot de passe incorrect. Veuillez réessayer."}catch(A){oe.error("Erreur lors de la vérification",A),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function y(){i.value=!0,l.value="",c.value="";try{const A=await FE(t.player.id,t.seasonId);c.value=A.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(A){oe.error("Erreur lors de l'envoi de l'email",A),l.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function I(){r("close"),s.value="",o.value="",a.value=!1,l.value="",c.value=""}return St(()=>t.show,A=>{A&&Bt(()=>{h.value&&h.value.focus()})}),(A,P)=>{var j,B;return N(),V(ct,null,[n.show?(N(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:I},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:P[3]||(P[3]=gt(()=>{},["stop"]))},[d("div",P$,[P[7]||(P[7]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔐")],-1)),P[8]||(P[8]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Vérification requise",-1)),d("p",R$,le((j=n.player)==null?void 0:j.name),1),P[9]||(P[9]=d("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protégé par mot de passe",-1))]),d("div",C$,[d("div",k$,[d("div",null,[P[10]||(P[10]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),tt(d("input",{"onUpdate:modelValue":P[0]||(P[0]=$=>s.value=$),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:Bn(g,["enter"]),ref_key:"passwordInput",ref:h},null,544),[[Vt,s.value]])]),d("div",D$,[tt(d("input",{id:"staySignedIn",type:"checkbox","onUpdate:modelValue":P[1]||(P[1]=$=>f.value=$),class:"w-4 h-4"},null,512),[[xi,f.value]]),P[11]||(P[11]=d("label",{for:"staySignedIn"},"Rester connecté sur cet appareil",-1))])]),d("button",{onClick:g,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(N(),V("span",V$,"⏳")):(N(),V("span",O$,"🔓")),d("span",null,le(i.value?"Vérification...":"Vérifier"),1)],8,N$)]),d("div",M$,[d("button",{onClick:P[2]||(P[2]=$=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(N(),V("div",L$,[d("div",$$,le(o.value),1)])):_e("",!0),d("div",{class:"flex justify-center"},[d("button",{onClick:I,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):_e("",!0),a.value?(N(),V("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:P[6]||(P[6]=$=>a.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:P[5]||(P[5]=gt(()=>{},["stop"]))},[d("div",F$,[P[12]||(P[12]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"📧")],-1)),P[13]||(P[13]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oublié",-1)),d("p",U$,le((B=n.player)==null?void 0:B.name),1)]),d("div",j$,[P[14]||(P[14]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),d("button",{onClick:y,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(N(),V("span",B$,"⏳")):(N(),V("span",z$,"📧")),d("span",null,le(i.value?"Envoi...":"Envoyer l'email"),1)],8,q$)]),l.value?(N(),V("div",K$,[d("div",G$,le(l.value),1)])):_e("",!0),c.value?(N(),V("div",H$,[d("div",W$,le(c.value),1)])):_e("",!0),d("div",Q$,[d("button",{onClick:P[4]||(P[4]=$=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):_e("",!0)],64)}}},J$={class:"text-center mb-6"},Y$={class:"text-sm text-gray-300"},X$={key:0,class:"space-y-4"},Z$={key:0,class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},eF={key:1,class:"space-y-4"},tF=["disabled"],nF={key:0,class:"animate-spin"},rF={key:1},sF={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},iF={class:"mt-6 flex justify-center gap-3"},oF=["disabled"],aF={key:0,class:"animate-spin"},lF={key:1},vT={__name:"AccountClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=e,s=S(1),i=S(""),o=S(""),a=S(""),l=S(!1),c=S(""),h=S(!1),f=hl(),g=je(()=>i.value&&i.value.includes("@")),y=je(()=>o.value&&a.value&&o.value===a.value&&o.value.length>=6);async function I(){var B,$,z;if(!(!g.value||!((B=t.player)!=null&&B.id))){l.value=!0,c.value="";try{const he=await DE({playerId:t.player.id,email:i.value.trim(),seasonId:t.seasonId}),ve=($=f.params)==null?void 0:$.slug,T=`${he.url}${ve?`&slug=${encodeURIComponent(ve)}`:""}&player=${encodeURIComponent(t.player.id)}&open=protection`;await bM({toEmail:i.value,playerName:((z=t.player)==null?void 0:z.name)||"joueur",verifyUrl:T}),h.value=!0}catch{c.value="Impossible d'envoyer l'email de vérification"}finally{l.value=!1}}}async function A(){try{await VE({playerId:t.player.id,seasonId:t.seasonId})}catch{}s.value=1,h.value=!1,i.value="",o.value="",a.value=""}async function P(){var B;try{const $=await Cl((B=t.player)==null?void 0:B.id,t.seasonId);$!=null&&$.email&&($!=null&&$.emailVerifiedAt)?s.value=2:s.value=1}catch{s.value=1}}Un(()=>{P()}),St(()=>t.show,B=>{B&&P()});async function j(){if(y.value){l.value=!0,c.value="";try{await kE(t.player.id,i.value.trim(),o.value,t.seasonId),r("success")}catch(B){c.value=(B==null?void 0:B.message)||"Erreur lors de l'association"}finally{l.value=!1}}}return(B,$)=>{var z;return n.show?(N(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:$[6]||($[6]=he=>B.$emit("close"))},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:$[5]||($[5]=gt(()=>{},["stop"]))},[d("button",{onClick:$[0]||($[0]=he=>B.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),d("div",J$,[$[7]||($[7]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"👤")],-1)),$[8]||($[8]=d("h2",{class:"text-2xl font-bold text-white mb-1"},"Associer un compte",-1)),d("p",Y$,"Pour sécuriser les saisies de "+le((z=n.player)==null?void 0:z.name),1),nt(IE)]),s.value===1?(N(),V("div",X$,[d("div",null,[$[9]||($[9]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),tt(d("input",{"onUpdate:modelValue":$[1]||($[1]=he=>i.value=he),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Vt,i.value]])]),h.value?(N(),V("div",Z$,[$[10]||($[10]=d("span",null,"✅",-1)),d("span",null,"Un email a été envoyé à "+le(i.value)+". Cliquez sur le lien contenu dans l'email pour continuer.",1)])):_e("",!0)])):s.value===2?(N(),V("div",eF,[d("div",{class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},[$[11]||($[11]=d("span",null,"✅",-1)),$[12]||($[12]=d("span",null,"Adresse email vérifiée",-1)),d("button",{type:"button",onClick:A,title:"Changer d'adresse email",class:"ml-auto px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-colors"},"✏️")]),d("div",null,[$[13]||($[13]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),tt(d("input",{"onUpdate:modelValue":$[2]||($[2]=he=>o.value=he),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé (min. 6 caractères)"},null,512),[[Vt,o.value]])]),d("div",null,[$[14]||($[14]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),tt(d("input",{"onUpdate:modelValue":$[3]||($[3]=he=>a.value=he),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[Vt,a.value]])]),d("button",{onClick:j,disabled:!y.value||l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(N(),V("span",nF,"⏳")):(N(),V("span",rF,"🔒")),d("span",null,le(l.value?"Association...":"Associer ce joueur"),1)],8,tF)])):_e("",!0),c.value?(N(),V("div",sF,le(c.value),1)):_e("",!0),d("div",iF,[s.value===1?(N(),V("button",{key:0,onClick:I,disabled:!g.value||l.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(N(),V("span",aF,"⏳")):(N(),V("span",lF,"✉️")),d("span",null,le(l.value?"Envoi...":"Envoyer le lien de vérification"),1)],8,oF)):_e("",!0),d("button",{onClick:$[4]||($[4]=he=>B.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])):_e("",!0)}}},uF={class:"text-center mb-6"},cF={class:"text-2xl font-bold text-white mb-2"},dF={class:"text-lg text-gray-300"},hF={class:"mb-6"},fF={class:"flex items-center space-x-3"},pF={class:"text-2xl"},mF={class:"font-semibold text-white"},gF={class:"text-sm text-gray-300"},vF={key:0,class:"mb-6"},yF={key:1,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},_F={class:"text-red-300 text-sm"},bF={key:2,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},wF={class:"text-green-300 text-sm"},xF={class:"flex justify-center gap-3"},IF=["disabled"],EF={__name:"PlayerClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null},onboarding:{type:Boolean,default:!1}},emits:["close","update","onboarding-finished"],setup(n,{emit:e}){const t=n,r=e,s=S(!1),i=S(!1),o=S(!1),a=S(""),l=S(""),c=S(!1);hl();const h=S(!1);je(()=>!1),je(()=>!1);function f(){l.value="Compte créé et joueur associé !",s.value=!0,c.value=!1,r("update")}async function g(){var j;if((j=t.player)!=null&&j.id){s.value=await Si(t.player.id,t.seasonId);try{const{isPlayerPasswordCached:B}=await tn(()=>Promise.resolve().then(()=>Ac),void 0);i.value=B(t.player.id)}catch{i.value=!1}}}function y(){var j;a.value="";try{if((j=t.player)!=null&&j.id&&Fo(t.player.id)){I();return}}catch{}h.value=!0}async function I(){o.value=!0,a.value="",l.value="";try{const j=await OE(t.player.id,t.seasonId);l.value="Joueur déverrouillé!",s.value=!1,j.email&&(email.value=j.email),r("update")}catch(j){logger.error("Erreur lors de la désactivation de la protection",j),a.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{o.value=!1}}function A(){h.value=!1,I()}function P(){r("close")}return St(()=>t.player,()=>{t.show&&t.player&&g()},{immediate:!0}),St(()=>t.show,j=>{j&&t.player&&(a.value="",l.value="",h.value=!1,g(),t.onboarding&&Bt(()=>{}))}),(j,B)=>{var $;return N(),V(ct,null,[n.show?(N(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:P},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:B[1]||(B[1]=gt(()=>{},["stop"]))},[d("button",{onClick:P,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),d("div",uF,[B[4]||(B[4]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔒")],-1)),d("h2",cF,le(s.value?"Déverrouiller ce joueur":"Verrouiller ce joueur"),1),d("p",dF,le(($=n.player)==null?void 0:$.name),1)]),d("div",hF,[d("div",{class:Ot(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[d("div",fF,[d("span",pF,le(s.value?"🔒":"🔓"),1),d("div",null,[d("div",mF,le(s.value?i.value?"Joueur associé à votre compte":"Ce joueur est associé à un compte utilisateur":"Joueur sans compte"),1),d("div",gF,le(s.value?i.value?"Seul vous pouvez modifier":"Seul le titulaire peut modifier les disponibilités":"Tout le monde peut modifier les disponibilités"),1)])])],2)]),s.value?_e("",!0):(N(),V("div",vF,B[5]||(B[5]=[d("div",{class:"text-sm text-gray-300"},"Vous pouvez protéger vos saisies de disponibilités avec un compte utilisateur.",-1)]))),a.value?(N(),V("div",yF,[d("div",_F,le(a.value),1)])):_e("",!0),l.value?(N(),V("div",bF,[d("div",wF,le(l.value),1)])):_e("",!0),d("div",xF,[s.value?(N(),V("button",{key:1,onClick:y,disabled:o.value,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," 🔓 Dissocier ",8,IF)):(N(),V("button",{key:0,onClick:B[0]||(B[0]=z=>c.value=!0),class:"px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300"}," Associer un compte ")),d("button",{onClick:P,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):_e("",!0),nt(vT,{show:c.value,player:n.player,"season-id":n.seasonId,onClose:B[2]||(B[2]=z=>c.value=!1),onSuccess:f},null,8,["show","player","season-id"]),nt(tv,{show:h.value,player:n.player,seasonId:n.seasonId,onClose:B[3]||(B[3]=z=>h.value=!1),onVerified:A},null,8,["show","player","seasonId"])],64)}}};const TF=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},AF={class:"relative p-4 md:p-6 border-b border-white/10"},SF={class:"flex items-start gap-4 md:gap-6"},PF={class:"flex-1 min-w-0"},RF={class:"flex items-center gap-3 mb-2"},CF={class:"text-xl md:text-2xl font-bold text-white leading-tight"},kF={class:"flex items-center gap-2"},DF={key:0,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border border-yellow-500/30 rounded-full"},NF={key:1,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30 rounded-full"},VF={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},OF={class:"grid grid-cols-3 gap-3 md:gap-4"},MF={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},LF={class:"text-xl md:text-2xl font-bold text-white"},$F={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},FF={class:"text-xl md:text-2xl font-bold text-white"},UF={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30 text-center"},jF={class:"text-xl md:text-2xl font-bold text-white"},qF={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},BF={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},zF={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},KF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},GF={class:"mb-6"},HF={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null},onboardingStep:{type:Number,default:0},onboardingPlayerId:{type:[String,null],default:null},isProtected:{type:Boolean,default:!1},isPreferred:{type:Boolean,default:!1}},emits:["close","update","delete","refresh","advance-onboarding"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=S(!1),o=S(""),a=S(null),l=S(!1),c=S(!1),h=S(null);S(!1);const f=S(!1),g=S(!1),y=S(null),I=S(null),A=S({position:"fixed",top:"0px",left:"0px"}),P=S(null),j=S({position:"fixed",top:"0px",left:"0px"}),B=S(!1),$=S(!1);function z(){s("close"),f.value=!1,g.value=!1,A.value={position:"fixed",top:"0px",left:"0px"},j.value={position:"fixed",top:"0px",left:"0px"}}function he(){var W;o.value=((W=r.player)==null?void 0:W.name)||"",i.value=!0,Bt(()=>{a.value&&a.value.focus()})}function ve(){i.value=!1,o.value=""}async function T(){var se,Pe;if(!o.value.trim())return;if(await Si((se=r.player)==null?void 0:se.id,r.seasonId)){Fo((Pe=r.player)==null?void 0:Pe.id)?w():(h.value="update",c.value=!0);return}w()}function w(){var W;s("update",{playerId:(W=r.player)==null?void 0:W.id,newName:o.value.trim()}),i.value=!1,o.value=""}async function E(){var se,Pe;if(await Si((se=r.player)==null?void 0:se.id,r.seasonId)){Fo((Pe=r.player)==null?void 0:Pe.id)?D():(h.value="delete",c.value=!0);return}D()}function D(){var W;s("delete",(W=r.player)==null?void 0:W.id)}function L(){s("refresh")}function q(W){h.value==="update"?w():h.value==="delete"&&D(),h.value=null}function R(){try{const W=y.value;if(!W)return;const se=W.getBoundingClientRect(),Pe=8;if(window.innerWidth>768){const te=Math.max(Pe,Math.round(se.top-Pe)),J=Math.max(Pe,Math.round(se.left));A.value={position:"fixed",top:`${te}px`,left:`${J}px`,zIndex:400}}else{const te=Math.min(window.innerHeight-Pe,Math.round(se.bottom+Pe)),J=Math.max(Pe,Math.round(se.left));A.value={position:"fixed",top:`${te}px`,left:`${J}px`,zIndex:400}}}catch{}}function ft(){try{const te=Math.max(8,window.innerHeight-8-48-120),J=Math.max(8,Math.round(window.innerWidth-200-8));j.value={position:"fixed",top:`${te}px`,left:`${J}px`,zIndex:400}}catch{}}function Ze(){f.value=!f.value,f.value&&Bt(()=>R())}function ne(){g.value=!g.value,g.value&&Bt(()=>ft())}St(()=>r.show,W=>{var se;W||(i.value=!1,o.value="",h.value=null,l.value=!1,f.value=!1,g.value=!1),W&&((se=r.player)!=null&&se.id)&&(Si(r.player.id,r.seasonId).then(Pe=>{B.value=!!Pe}),tn(()=>Promise.resolve().then(()=>Ac),void 0).then(Pe=>{try{$.value=!!Pe.isPlayerPasswordCached(r.player.id)}catch{$.value=!1}}))}),Un(()=>{document.addEventListener("click",W=>{if(f.value){const se=y.value,Pe=I.value,te=se&&se.contains(W.target),J=Pe&&Pe.contains(W.target);!te&&!J&&(f.value=!1)}if(g.value){const se=P.value;se&&se.contains(W.target)||(g.value=!1)}}),document.addEventListener("keydown",W=>{W.key==="Escape"&&(f.value&&(f.value=!1),g.value&&(g.value=!1))}),window.addEventListener("resize",()=>{f.value&&R(),g.value&&ft()}),window.addEventListener("scroll",()=>{f.value&&R(),g.value&&ft()},{passive:!0})}),e({openProtection(){l.value=!0}});const F=S({position:null});return St(()=>r.show,W=>{W&&r.onboardingStep===4?Bt(()=>{const se=document.querySelectorAll("button");let Pe=null;if(se.forEach(te=>{!Pe&&te.textContent&&te.textContent.includes("Protection")&&(Pe=te)}),Pe){const te=Pe.getBoundingClientRect();F.value.position={x:Math.round(te.right+8),y:Math.round(te.top+window.scrollY-4)}}}):W||(F.value.position=null)}),(W,se)=>{var Pe;return N(),V(ct,null,[n.show?(N(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:z},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-xl max-h-[92vh] flex flex-col",onClick:se[6]||(se[6]=gt(()=>{},["stop"]))},[d("div",AF,[d("button",{onClick:z,class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",SF,[se[15]||(se[15]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"👤")],-1)),d("div",PF,[d("div",RF,[d("h2",CF,le((Pe=n.player)==null?void 0:Pe.name),1),d("div",kF,[n.isProtected?(N(),V("div",DF,se[13]||(se[13]=[d("span",{class:"text-yellow-400 text-sm"},"🔒",-1),d("span",{class:"text-yellow-300 text-xs font-medium"},"Protégé",-1)]))):_e("",!0),n.isPreferred?(N(),V("div",NF,se[14]||(se[14]=[d("span",{class:"text-purple-400 text-sm"},"⭐",-1),d("span",{class:"text-purple-300 text-xs font-medium"},"Favori",-1)]))):_e("",!0)])])])])]),d("div",VF,[d("div",null,[d("div",OF,[d("div",MF,[d("div",LF,le(r.stats.availability),1),se[16]||(se[16]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibilités",-1))]),d("div",$F,[d("div",FF,le(r.stats.selection),1),se[17]||(se[17]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélections",-1))]),d("div",UF,[d("div",jF,le(r.stats.ratio),1),se[18]||(se[18]=d("div",{class:"text-xs md:text-sm text-gray-300"},"% de sélection",-1))])])]),d("div",qF,[d("button",{onClick:se[0]||(se[0]=te=>l.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},[d("span",null,le(B.value?"🔓":"🔒"),1),d("span",null,le(B.value?"Déverrouiller":"Verrouiller"),1)]),d("div",{class:"relative",ref_key:"playerMoreActionsRef",ref:y},[d("button",{onClick:se[1]||(se[1]=te=>Ze()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},se[19]||(se[19]=[d("span",null,"⋯",-1),d("span",null,"Plus",-1)]))],512),d("button",{onClick:z,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer "),(N(),ko(fu,{to:"body"},[f.value?(N(),V("div",{key:0,ref_key:"playerMoreActionsDropdownRef",ref:I,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:gr(A.value)},[d("button",{onClick:se[2]||(se[2]=te=>{he(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},se[20]||(se[20]=[d("span",null,"✏️",-1),d("span",null,"Renommer",-1)])),d("button",{onClick:se[3]||(se[3]=te=>{E(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},se[21]||(se[21]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):_e("",!0)]))])]),d("div",BF,[d("button",{onClick:se[4]||(se[4]=te=>l.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"},le(B.value?"🔓 Déverrouiller":"🔒 Verrouiller"),1),d("button",{onClick:se[5]||(se[5]=te=>ne()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ "),d("button",{onClick:z,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer ")])])])):_e("",!0),(N(),ko(fu,{to:"body"},[g.value?(N(),V("div",{key:0,ref_key:"playerMoreActionsMobileDropdownRef",ref:P,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:gr(j.value)},[d("button",{onClick:se[7]||(se[7]=te=>{he(),g.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},se[22]||(se[22]=[d("span",null,"✏️",-1),d("span",null,"Renommer",-1)])),d("button",{onClick:se[8]||(se[8]=te=>{E(),g.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},se[23]||(se[23]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):_e("",!0)])),i.value?(N(),V("div",zF,[d("div",KF,[se[25]||(se[25]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Renommer le joueur",-1)),d("div",GF,[se[24]||(se[24]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),tt(d("input",{"onUpdate:modelValue":se[9]||(se[9]=te=>o.value=te),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Bn(ve,["esc"]),Bn(T,["enter"])],ref_key:"editNameInput",ref:a},null,544),[[Vt,o.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:ve,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:T,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):_e("",!0),nt(EF,{show:l.value,player:n.player,seasonId:n.seasonId,onboarding:n.onboardingStep===4,onClose:se[10]||(se[10]=te=>l.value=!1),onUpdate:L,onOnboardingFinished:se[11]||(se[11]=te=>W.$emit("advance-onboarding",5))},null,8,["show","player","seasonId","onboarding"]),nt(tv,{show:c.value,player:n.player,seasonId:n.seasonId,onClose:se[12]||(se[12]=te=>c.value=!1),onVerified:q},null,8,["show","player","seasonId"])],64)}}},WF=TF(HF,[["__scopeId","data-v-8237d7ee"]]),QF={class:"relative p-6 pb-4 border-b border-white/10"},JF={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},YF={__name:"HowItWorksModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(N(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=gt(()=>{},["stop"]))},[d("div",QF,[d("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=d("div",{class:"flex items-center gap-3"},[d("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-2xl"},"❓"),d("div",null,[d("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Comment fonctionne la sélection automatique ?"),d("p",{class:"text-sm text-blue-300"},"Tirage au sort pondéré pour favoriser l'équité")])],-1))]),s[5]||(s[5]=Ln('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">En bref</h3><p>On tire au sort uniquement parmi les joueurs <span class="text-green-300">disponibles</span>. Ceux qui ont <span class="text-purple-300">moins joué</span> ont plus de chances d&#39;être tirés. À long terme, tout le monde joue à peu près autant.</p></div><div class="space-y-3"><h3 class="text-white font-semibold">Détails du tirage</h3><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><span class="text-white">Qui participe ?</span> Tous les joueurs marqués « ✅ Disponible » pour l’événement.</li><li><span class="text-white">Un coup de pouce aux moins joués</span> : si vous avez moins joué récemment, le tirage vous favorise un peu plus.</li><li><span class="text-white">Comment se fait le tirage ?</span> On tire un nom au hasard en tenant compte de cet avantage, on le met de côté, puis on recommence jusqu’à avoir assez de joueurs.</li><li><span class="text-white">Si on relance</span> : on garde les joueurs encore disponibles et on complète seulement les places manquantes.</li><li><span class="text-white">Indisponibles</span> : ils ne sont jamais tirés au sort.</li></ol></div><div class="space-y-2"><h3 class="text-white font-semibold">Estimation des chances</h3><p>L’application peut afficher un pourcentage indicatif pour aider à comprendre : si Alice a moins joué que Bob, elle aura un pourcentage plus élevé. C’est une indication, pas une promesse : deux tirages peuvent donner des résultats différents.</p></div><div class="space-y-2"><h3 class="text-white font-semibold">Pourquoi c’est juste</h3><ul class="list-disc list-inside space-y-1 text-gray-300"><li>Ceux qui ont moins joué ont automatiquement plus de chances.</li><li>Après une sélection, vos chances diminuent un peu pour laisser la place aux autres.</li><li>Sur la durée, les sélections s’<span class="text-green-300">équilibrent naturellement</span>.</li></ul></div><div class="space-y-2"><h3 class="text-white font-semibold">Exemples rapides</h3><p> • Alice n’a encore jamais été sélectionnée, Bob a été sélectionné une fois, Charlie plusieurs fois. Pour 1 place, on aura environ : Alice 57 %, Bob 29 %, Charlie 14 %.<br> • S’il y a 2 places, les chances de chacun augmentent, mais l’ordre reste aléatoire : un tirage peut donner Alice + Bob, un autre Alice + Charlie. </p></div><div class="text-xs text-gray-400"> Remarque : l’algorithme favorise l’équité à long terme, mais <span class="text-gray-300">n’assure pas</span> une rotation parfaite à chaque événement. </div></div>',1)),d("div",JF,[d("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):_e("",!0)}},XF={class:"relative p-4 md:p-6 border-b border-white/10"},ZF={class:"flex items-start gap-4 md:gap-6"},e6={class:"flex-1 min-w-0"},t6={class:"text-xl md:text-2xl font-bold text-white leading-tight mb-2"},n6={class:"flex items-center gap-3"},r6={class:"text-base md:text-lg text-purple-300"},s6={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},i6={class:"text-blue-200"},o6={key:0,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm flex items-center gap-1",title:"Prêt pour la sélection"},a6={key:1,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded text-sm flex items-center gap-1",title:"Sélection complète"},l6={key:2,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded text-sm flex items-center gap-1",title:"Sélection incomplète"},u6={key:3,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded text-sm flex items-center gap-1",title:"Pas assez de joueurs disponibles"},c6={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},d6={class:"grid grid-cols-3 gap-3 md:gap-4 mb-4"},h6={class:"bg-gradient-to-r from-yellow-500/20 to-orange-500/20 p-3 md:p-4 rounded-lg border border-yellow-500/30 text-center"},f6={class:"text-xl md:text-2xl font-bold text-yellow-300"},p6={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},m6={class:"text-xl md:text-2xl font-bold text-white"},g6={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},v6={class:"text-xl md:text-2xl font-bold text-white"},y6={class:"mb-3"},_6={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},b6={key:0,class:"flex items-center justify-between gap-2"},w6=["title"],x6={key:0,class:"text-purple-400 mr-2"},I6={key:1,class:"text-green-400 mr-2"},E6={key:2,class:"text-red-400 mr-2"},T6={key:3,class:"text-gray-400 mr-2"},A6=["onClick"],S6={key:1,class:"flex items-center justify-center"},P6=["onChange"],R6=["value"],C6=["onClick"],k6={key:0,class:"mb-3"},D6={key:1,class:"mb-3"},N6={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},V6={class:"flex-1"},O6={class:"text-blue-300 text-sm font-medium"},M6={class:"sticky bottom-0 w-full p-3 bg-gray-900/80 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},L6=["disabled","title"],$6=["disabled"],F6={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]}},emits:["close","selection","perfect","send-notifications","updateSelection"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=S(!1),o=S("Copier le message"),a=S(!1),l=S(!1),c=S(""),h=S(!1),f=S(!1),g=je(()=>{var te;return((te=r.event)==null?void 0:te.playerCount)||6}),y=S([]),I=S(null),A=je(()=>(r.players||[]).map(te=>te.name).filter(te=>{var J;return((J=r.playerAvailability)==null?void 0:J[te])===!0}).sort((te,J)=>te.localeCompare(J,"fr",{sensitivity:"base"})));function P(te){const J=new Set(y.value.filter(Boolean)),Ee=y.value[te];return Ee&&J.delete(Ee),A.value.filter(Ge=>!J.has(Ge))}function j(te){I.value=te}function B(){I.value=null}async function $(te,J){var Ge;const Ee=((Ge=te==null?void 0:te.target)==null?void 0:Ge.value)||"";Ee&&(y.value[J]=Ee,await L()),I.value=null}async function z(te){y.value[te]=null,await L()}je(()=>(P(-1).length<g.value,""));const he=je(()=>r.currentSelection&&r.currentSelection.length>0);function ve(){var Ge;const te=r.currentSelection||[],J=((Ge=r.event)==null?void 0:Ge.playerCount)||6,Ee=r.availableCount||0;if(te.length>0){const pt=te.some(Z=>!Ze(Z)),It=Ee<J;if(pt||It)return{type:"incomplete",hasUnavailablePlayers:pt,hasInsufficientPlayers:It,unavailablePlayers:te.filter(Z=>!Ze(Z)),availableCount:Ee,requiredCount:J}}return Ee<J?{type:"insufficient",availableCount:Ee,requiredCount:J}:te.length===0?{type:"ready",availableCount:Ee,requiredCount:J}:{type:"complete",availableCount:Ee,requiredCount:J}}const T=je(()=>{var Ge;if(!he.value)return!1;const te=r.currentSelection.some(pt=>!Ze(pt)),J=((Ge=r.event)==null?void 0:Ge.playerCount)||6,Ee=r.availableCount<J;return te||Ee});je(()=>{var Ee;if(!T.value)return"";const te=r.currentSelection.filter(Ge=>!Ze(Ge)),J=((Ee=r.event)==null?void 0:Ee.playerCount)||6;return te.length>0?te.length===1?`${te[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${te.length} joueurs ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<J?`Seulement ${r.availableCount} joueurs disponibles pour ${J} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de joueurs à sélectionner.`:"Sélection incomplète"}),je(()=>{if(!r.event||!he.value)return"";const te=w(r.event.date),J=r.currentSelection.join(", ");return`Sélection pour ${r.event.title} du ${te} : ${J}`}),St(()=>r.show,te=>{if(te){i.value=!1,o.value="Copier le message",l.value=!1,c.value="",h.value=!1,a.value=!1;const J=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],Ee=g.value;y.value=Array.from({length:Ee},(Ge,pt)=>J[pt]||null),I.value=null}}),St([g,()=>r.currentSelection,()=>{var te;return(te=r.event)==null?void 0:te.id}],()=>{if(!r.show)return;const te=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],J=g.value,Ee=Array.from({length:J},(Ge,pt)=>te[pt]||y.value[pt]||null);y.value=Ee.slice(0,J)});function w(te){var Ee;return te?(typeof te=="string"?new Date(te):((Ee=te.toDate)==null?void 0:Ee.call(te))||te).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function E(){s("selection")}function D(){s("perfect")}async function L(){var te;if(!(!((te=r.event)!=null&&te.id)||!r.seasonId))try{const J=y.value.filter(Boolean);await Jp(r.event.id,J,r.seasonId),console.debug("Sélection sauvegardée automatiquement")}catch(J){console.error("Erreur lors de la sauvegarde automatique:",J)}}function q(){s("close")}function R(){a.value=!0}function ft(){f.value=!0}function Ze(te){return r.playerAvailability[te]===!0}function ne(te){return r.playerAvailability[te]===!1}function F(te){return r.currentSelection.includes(te)&&Ze(te)}function W(te=!1,J=!1){if(h.value=te,te){const Ee=w(r.event.date),Ge=r.currentSelection.join(", ");J?c.value=`Sélection mise à jour pour ${r.event.title} du ${Ee} : ${Ge}. Pensez à prévenir les joueurs via le bouton "Annoncer" !`:c.value=`Nouvelle sélection pour ${r.event.title} du ${Ee} : ${Ge}. Pensez à prévenir les joueurs via le bouton "Annoncer" !`}else c.value="Sélection effectuée avec succès !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function se(){l.value=!1}e({showSuccess:W});function Pe(te){s("send-notifications",te)}return(te,J)=>{var Ee,Ge,pt,It;return N(),V(ct,null,[n.show?(N(),V("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:q},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:J[1]||(J[1]=gt(()=>{},["stop"]))},[d("div",XF,[d("button",{onClick:q,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",ZF,[J[9]||(J[9]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),d("div",e6,[d("h2",t6,"Sélection pour "+le((Ee=n.event)==null?void 0:Ee.title),1),d("div",n6,[d("p",r6,le(w((Ge=n.event)==null?void 0:Ge.date)),1),d("div",s6,[J[4]||(J[4]=d("span",{class:"text-blue-300"},"👥",-1)),d("span",i6,le(((pt=n.event)==null?void 0:pt.playerCount)||6)+" joueurs",1)]),ve().type==="ready"?(N(),V("div",o6,J[5]||(J[5]=[d("span",{class:"text-blue-300 text-xs"},"🆕",-1),d("span",{class:"text-blue-200 text-xs"},"Nouveau",-1)]))):ve().type==="complete"?(N(),V("div",a6,J[6]||(J[6]=[d("span",{class:"text-green-300 text-xs"},"✅",-1),d("span",{class:"text-green-200 text-xs"},"Complet",-1)]))):ve().type==="incomplete"?(N(),V("div",l6,J[7]||(J[7]=[d("span",{class:"text-orange-300 text-xs"},"⚠️",-1),d("span",{class:"text-orange-200 text-xs"},"À finaliser",-1)]))):ve().type==="insufficient"?(N(),V("div",u6,J[8]||(J[8]=[d("span",{class:"text-red-300 text-xs"},"❌",-1),d("span",{class:"text-red-200 text-xs"},"Manque",-1)]))):_e("",!0)])])])]),d("div",c6,[d("div",d6,[d("div",h6,[d("div",f6,le(Math.max((((It=n.event)==null?void 0:It.playerCount)||6)-n.selectedCount,0)),1),J[10]||(J[10]=d("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))]),d("div",p6,[d("div",m6,le(n.availableCount),1),J[11]||(J[11]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),d("div",g6,[d("div",v6,le(n.selectedCount),1),J[12]||(J[12]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))])]),d("div",y6,[d("div",{class:"flex items-center gap-2 mb-2"},[J[14]||(J[14]=d("h3",{class:"text-base md:text-lg font-semibold text-white"},"Joueurs sélectionnés",-1)),d("button",{onClick:ft,class:"text-blue-300 hover:text-blue-200 p-1 rounded-full hover:bg-blue-500/10 transition-colors",title:"Comment fonctionne la sélection automatique ?"},J[13]||(J[13]=[d("span",{class:"text-sm"},"❓",-1)]))]),d("div",_6,[(N(!0),V(ct,null,Ar(y.value,(Z,Ae)=>(N(),V("div",{key:"sel-slot-"+Ae,class:Ot(["relative p-3 rounded-lg border text-center transition-colors",Z?["bg-gradient-to-r",ne(Z)?"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":Ze(Z)?"from-green-500/20 to-emerald-500/20 border-green-500/30":"from-red-500/20 to-red-600/20 border-red-500/30"]:"border-dashed border-white/20 hover:border-white/40 bg-white/5"])},[Z?(N(),V("div",b6,[d("div",{class:"flex-1 text-white font-medium truncate",title:Z},[F(Z)?(N(),V("span",x6,"🎭")):Ze(Z)?(N(),V("span",I6,"✅")):ne(Z)?(N(),V("span",E6,"❌")):(N(),V("span",T6,"–")),zt(" "+le(Z),1)],8,w6),d("button",{onClick:we=>z(Ae),class:"text-white/80 hover:text-white rounded-full hover:bg-white/10 px-2 py-1",title:"Retirer ce joueur"}," × ",8,A6)])):(N(),V("div",S6,[I.value===Ae?(N(),V("select",{key:0,class:"w-full bg-gray-800 text-white rounded-md p-2 border border-white/20 focus:outline-none",onChange:we=>$(we,Ae),onBlur:J[0]||(J[0]=we=>B())},[J[15]||(J[15]=d("option",{value:""},"— Choisir —",-1)),(N(!0),V(ct,null,Ar(P(Ae),we=>(N(),V("option",{key:we,value:we},le(we),9,R6))),128))],40,P6)):(N(),V("button",{key:1,onClick:we=>j(Ae),class:"flex items-center gap-2 text-white/80 hover:text-white px-2 py-1 rounded-md hover:bg-white/10",title:"Ajouter un joueur"},J[16]||(J[16]=[d("span",{class:"text-lg"},"＋",-1),d("span",{class:"text-sm"},"Ajouter",-1)]),8,C6))]))],2))),128))])]),he.value?(N(),V("div",k6,J[17]||(J[17]=[d("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[d("div",{class:"text-yellow-400"},"⚠️"),d("div",{class:"text-yellow-200 text-sm"},"Pensez à prévenir les gens de vos changements !")],-1)]))):_e("",!0),l.value?(N(),V("div",D6,[d("div",N6,[J[19]||(J[19]=d("div",{class:"text-blue-400 text-xl"},"✨",-1)),d("div",V6,[d("p",O6,le(c.value),1)]),d("button",{onClick:se,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},J[18]||(J[18]=[d("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):_e("",!0)]),d("div",M6,[d("button",{onClick:E,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":he.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},J[20]||(J[20]=[zt(" ✨ "),d("span",{class:"hidden sm:inline"},"Sélection Auto",-1),d("span",{class:"sm:hidden"},"Auto",-1)]),8,L6),d("button",{onClick:R,disabled:!he.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},J[21]||(J[21]=[zt(" 📣 "),d("span",{class:"hidden sm:inline"},"Annoncer",-1),d("span",{class:"sm:hidden"},"Annoncer",-1)]),8,$6),d("button",{onClick:D,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 whitespace-nowrap"},J[22]||(J[22]=[d("span",{class:"hidden sm:inline"},"Fermer",-1),d("span",{class:"sm:hidden"},"Fermer",-1)]))])])])):_e("",!0),nt(gT,{show:a.value,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,mode:"selection","selected-players":n.currentSelection,onClose:J[2]||(J[2]=Z=>a.value=!1),onSendNotifications:Pe},null,8,["show","event","season-id","season-slug","players","selected-players"]),nt(YF,{show:f.value,onClose:J[3]||(J[3]=Z=>f.value=!1)},null,8,["show"])],64)}}},U6={class:"flex items-center justify-center"},j6=["title"],q6={key:0,class:"text-center"},B6={key:1,class:"text-center"},z6={key:2,class:"text-center"},K6={key:3,class:"text-center text-gray-400"},E_={__name:"AvailabilityCell",props:{playerName:{type:String,required:!0},compact:{type:Boolean,default:!1},eventId:{type:String,required:!0},isAvailable:{type:Boolean,default:null},isSelected:{type:Boolean,default:!1},chancePercent:{type:Number,default:null},showSelectedChance:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["toggle"],setup(n,{emit:e}){const t=n,r=e,s=S(!1),i=je(()=>!(t.chancePercent==null||t.isAvailable!==!0||t.isSelected&&!t.showSelectedChance)),o=je(()=>t.disabled?"Événement archivé — désarchivez pour modifier":t.isSelected&&t.isAvailable===!0?i.value?`${t.playerName} est sélectionné pour cet événement • avait ~${t.chancePercent}% de chances`:`${t.playerName} est sélectionné pour cet événement`:t.isAvailable===!0?t.chancePercent!=null?`${t.playerName} est disponible • ~${t.chancePercent}% de chances d'être sélectionné`:`${t.playerName} est disponible`:t.isAvailable===!1?`${t.playerName} n'est pas disponible`:`Cliquer pour indiquer la disponibilité de ${t.playerName}`);function a(){t.disabled||r("toggle",t.playerName,t.eventId)}return(l,c)=>(N(),V("div",{class:Ot(["flex items-center justify-center transition-all duration-200 rounded font-medium text-white mx-0.5 my-0.25",[n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer hover:scale-105",n.compact?"min-h-0 p-1 md:p-2 text-xs":"min-h-20 p-2 md:p-3 text-sm",n.isSelected&&n.isAvailable===!0?"bg-gradient-to-br from-purple-500/60 to-pink-500/60":"",!n.isSelected&&n.isAvailable===!0?"bg-green-500/60":"",n.isAvailable===!1?"bg-red-500/60":"",n.isAvailable===null||n.isAvailable===void 0?"bg-gray-500/40":""]]),onClick:a,onMouseenter:c[0]||(c[0]=h=>s.value=!0),onMouseleave:c[1]||(c[1]=h=>s.value=!1)},[d("div",U6,[i.value&&s.value?(N(),V("span",{key:0,class:"text-[11px] md:text-xs px-2 py-0.5 rounded-full bg-emerald-500/15 border border-emerald-400/40 text-emerald-200",title:o.value},le(n.chancePercent)+"% ",9,j6)):(N(),V(ct,{key:1},[n.isSelected&&n.isAvailable===!0?(N(),V("span",q6," Joue ")):n.isAvailable===!0?(N(),V("span",B6," Disponible ")):n.isAvailable===!1?(N(),V("span",z6," Pas disponible ")):(N(),V("span",K6," – "))],64))])],34))}},G6={key:0,class:"fixed inset-0 z-[130] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},H6={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},W6={class:"text-2xl md:text-3xl font-bold text-white mb-3"},Q6={class:"text-gray-300 mb-6"},J6={class:"flex flex-col items-stretch justify-center gap-3"},Y6=["value"],X6={__name:"CreatorOnboardingModal",props:{seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},onboardingDone:{type:Boolean,default:!1}},emits:["create-event","add-player","copy-link","dismissed"],setup(n,{emit:e}){const t=n,r=e,s=window.location.origin,i=je(()=>`${s}/season/${t.seasonSlug}`),o=S(!1);try{t.seasonId&&(o.value=!!localStorage.getItem(`dismissCreatorOnboarding:${t.seasonId}`))}catch{}const a=je(()=>t.onboardingDone?0:t.eventsCount===0&&t.playersCount===0?1:t.eventsCount>0&&t.playersCount===0?2:t.eventsCount>0&&t.playersCount>0&&!o.value?3:0),l=je(()=>a.value>0),c=S(l.value);St(a,P=>{c.value=P>0});const h=je(()=>{switch(a.value){case 1:return"Commençons par créer votre premier événement";case 2:return"Super ! Ajoutez votre premier joueur";case 3:return"Vous y êtes presque! Maintenant, invitez vos joueurs.";default:return""}}),f=je(()=>{switch(a.value){case 1:return"Un titre, une date... et c’est parti.";case 2:return"Ajoutez au moins un joueur pour commencer à saisir des disponibilités.";case 3:return"Laissez vos membres s’inscrire eux-même et indiquer leurs disponibilités en leur envoyant le lien direct.";default:return""}});function g(){c.value=!1,r("create-event")}function y(){c.value=!1,r("add-player")}function I(){var P;try{(P=navigator.clipboard)==null||P.writeText(i.value)}catch{}r("copy-link")}async function A(){try{if(t.seasonId){const{db:P}=await tn(()=>Promise.resolve().then(()=>Ai),void 0),{doc:j,updateDoc:B}=await tn(()=>import("./index.esm-68cf9100.js"),[]);await B(j(P,"seasons",t.seasonId),{onboardingCreatorDone:!0})}else localStorage.setItem("dismissCreatorOnboarding","1")}catch{}o.value=!0,c.value=!1,r("dismissed")}return(P,j)=>l.value&&c.value?(N(),V("div",G6,[d("div",H6,[j[1]||(j[1]=d("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[d("span",{class:"text-3xl"},"🎬")],-1)),d("h2",W6,le(h.value),1),d("p",Q6,le(f.value),1),d("div",J6,[a.value===1?(N(),V("button",{key:0,onClick:g,class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all"}," ✨ Créer un événement ")):a.value===2?(N(),V("button",{key:1,onClick:y,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"}," 👤 Ajouter un joueur ")):a.value===3?(N(),V(ct,{key:2},[d("input",{value:i.value,type:"text",readonly:"",class:"w-full px-3 py-2 bg-gray-800 border border-white/20 rounded-lg text-white text-sm select-all",onFocus:j[0]||(j[0]=B=>B.target.select())},null,40,Y6),d("div",{class:"flex gap-3 justify-center"},[d("button",{onClick:I,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"}," 🔗 Copier le lien "),d("button",{onClick:A,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"}," J’ai compris ")])],64)):_e("",!0)])])])):_e("",!0)}};const Z6={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},e5={ref:"pageHeaderRef",class:"sticky top-0 z-[60] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},t5={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},n5={class:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2"},r5={class:"hidden md:flex items-center gap-2"},s5={class:"w-full px-0 md:px-0 pb-0 pt-[72px] md:pt-[80px] -mt-[72px] md:-mt-[80px] bg-gray-900"},i5={class:"flex items-stretch relative"},o5={key:0,class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},a5={class:"flex-1 overflow-hidden"},l5=["data-event-id"],u5=["title","onClick"],c5={class:"flex flex-col items-center flex-1 justify-center"},d5={class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2 group-hover:text-purple-300 transition-colors duration-200"},h5={key:0,class:"mt-1 text-xs text-gray-400"},f5={class:"relative"},p5=["onClick","title"],m5={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},g5={class:"p-2"},v5=["onClick"],y5=["onClick"],_5=["onClick"],b5={class:"flex flex-col items-center mt-2"},w5={key:0,class:"px-2 py-1 bg-gray-500/20 border border-gray-400/30 rounded-md mx-auto flex items-center justify-center",title:"Événement archivé"},x5=["title","onClick"],I5=["title","onClick"],E5=["title","onClick"],T5=["title","onClick"],A5=["title","aria-label"],S5={class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},P5={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3l18 18"},R5={key:0,class:"pointer-events-none"},C5={class:"flex items-center justify-between"},k5={key:1,class:"pointer-events-none"},D5={id:"coachmark-avail",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-pink-500/40 rounded-xl shadow-2xl p-3 text-white relative"},N5={class:"flex items-center justify-between"},V5={key:2,class:"pointer-events-none"},O5={id:"coachmark-name",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-yellow-500/40 rounded-xl shadow-2xl p-3 text-white relative"},M5={class:"flex items-center justify-between"},L5={class:"table-auto border-separate border-spacing-0 table-fixed w-auto min-w-max"},$5=["data-player-id"],F5={class:"px-0 py-4 md:py-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900 left-col-td"},U5={class:"px-4 md:px-5 font-bold text-xl md:text-2xl flex items-center w-full min-w-0"},j5={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Mon joueur"},q5={key:1,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protégé par mot de passe"},B5=["onClick","title"],z5={class:"group-hover:text-purple-300 transition-colors duration-200"},K5=["data-event-id"],G5={class:"border-t border-white/10"},H5={class:"px-0 py-4 md:py-5 sticky left-0 z-40 bg-gray-900 left-col-td"},W5={class:"px-4 md:px-5 flex items-center"},Q5=["data-event-id"],J5={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},Y5={class:"text-center"},X5={class:"text-white text-lg"},Z5={class:"mt-3 w-64 h-2 bg-white/10 rounded-full overflow-hidden"},eU={class:"text-white/60 text-xs mt-2"},tU={key:3,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-[200]"},nU={class:"flex items-center space-x-2"},rU={key:4,class:"fixed bottom-4 left-4 bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl shadow-2xl border border-red-400/30 backdrop-blur-sm z-[200]"},sU={class:"flex items-center space-x-2"},iU={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},oU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},aU={class:"mb-6"},lU={class:"mb-6"},uU={class:"mb-6"},cU={class:"mb-6 flex items-center gap-3"},dU={class:"mb-6"},hU={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},fU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},pU={class:"mb-6"},mU={class:"flex justify-end space-x-3"},gU={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},vU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},yU={class:"flex justify-end space-x-3"},_U={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},bU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},wU={class:"flex justify-end space-x-3"},xU={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},IU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},EU={class:"text-center mb-6"},TU={class:"text-gray-300"},AU={key:0},SU={key:1},PU={class:"relative p-4 md:p-6 border-b border-white/10"},RU={class:"flex items-start gap-4 md:gap-6"},CU={class:"flex-1 min-w-0"},kU={class:"flex items-center gap-3 mb-2"},DU={class:"text-xl md:text-2xl font-bold text-white leading-tight"},NU={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},VU={class:"text-blue-200"},OU={class:"flex items-center gap-3 mb-3"},MU={class:"text-base md:text-lg text-purple-300"},LU={class:"relative"},$U={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},FU={class:"p-2"},UU={key:0,class:"text-sm text-gray-300 bg-gray-800/30 p-3 rounded-lg border border-gray-600/30"},jU={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},qU={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},BU={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},zU={class:"text-xl md:text-2xl font-bold text-white"},KU={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},GU={class:"text-xl md:text-2xl font-bold text-white"},HU={class:"p-3 md:p-4 rounded-lg border border-yellow-500/30 bg-yellow-500/10 text-center"},WU={class:"text-xl md:text-2xl font-bold text-yellow-300"},QU={key:0,class:"mb-4 md:mb-6"},JU={class:"mb-3 flex items-center"},YU=["title"],XU={class:"truncate"},ZU={class:"space-y-0.5"},ej={class:"flex items-center min-w-0 gap-1.5"},tj={key:0,class:"text-yellow-400 mr-1 text-xs",title:"Mon joueur"},nj={key:1,class:"text-yellow-400 mr-1 text-xs",title:"Joueur protégé par mot de passe"},rj=["title"],sj={class:"flex-0 p-0"},ij={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},oj=["disabled","title"],aj=["title"],lj={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},uj=["disabled","title"],cj={key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},dj={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},hj={class:"mb-6"},fj={class:"mb-6"},pj={class:"mb-6"},mj={class:"mb-6 flex items-center gap-3"},gj={class:"mb-6"},vj={key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},yj={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},_j={class:"mb-6"},bj={class:"space-y-4"},wj=["disabled"],xj={key:0,class:"animate-spin"},Ij={key:1},Ej={class:"mb-6 text-center"},Tj={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Aj={class:"text-red-300 text-sm"},Sj={key:13,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},Pj={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},Rj={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},Cj={class:"space-y-4"},kj={class:"mt-2 text-center"},Dj={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Nj={class:"text-red-300 text-sm"},Vj={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},Oj=["disabled"],Mj={key:0,class:"animate-spin"},Lj={key:1},$j={class:"mb-6"},Fj=["disabled"],Uj={key:0,class:"animate-spin"},jj={key:1},qj={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Bj={class:"text-red-300 text-sm"},zj={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},Kj={class:"text-green-300 text-sm"},Gj={class:"flex justify-center"},Hj={class:"mb-6"},Wj=["disabled"],Qj={key:0,class:"animate-spin"},Jj={key:1},Yj={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Xj={class:"text-red-300 text-sm"},Zj={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},eq={class:"text-green-300 text-sm"},tq={class:"flex justify-center"},nq={key:16,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},rq={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl max-w-md"},sq={class:"flex gap-3"},T_={__name:"GridBoard",props:{slug:{type:String,required:!0},eventId:{type:String,required:!1}},setup(n){const e=n,t=dl(),r=hl(),s=e.slug,i=S(""),o=S(""),a=S({}),l=S(!1),c=S(null),h=S(null),f=S(""),g=S(""),y=S(6),I=S(!1),A=S(""),P=S(null),j=S(null),B=S(null),$=S({position:null,side:null}),z=S({position:null}),he=S({position:null}),ve=S(!1),T=S(null),w=S(!1),E=S(null),D=S(null),L=S(!1),q=S(null),R=S(""),ft=S(!1),Ze=S(null),ne=S(""),F=S(""),W=S(!1),se=S(null),Pe=S(!1),te=S(null),J=S(""),Ee=S(""),Ge=S(!1),pt=S(null),It=S(!1),Z=S(!1),Ae=S(""),we=S(""),De=S(!1),We=S(!1),at=S(""),x=S(""),C=S(!1),M=S(null),ue=S(""),re=S(!1),ae=S(!1),be=S(!1),U=S(null),O=S(null),Q=S({position:"fixed",top:"0px",left:"0px"}),ce=S(null),fe=S({position:"fixed",top:"0px",left:"0px"}),xe=S(null),Oe=S(!1);function ke(){try{const _=U.value;if(!_)return;const m=_.getBoundingClientRect(),k=8;if(window.innerWidth>768){const ee=Math.max(k,Math.round(m.top-k)),ie=Math.max(k,Math.round(m.left));Q.value={position:"fixed",top:`${ee}px`,left:`${ie}px`,zIndex:400}}else{const ee=Math.min(window.innerHeight-k,Math.round(m.bottom+k)),ie=Math.max(k,Math.round(m.left));Q.value={position:"fixed",top:`${ee}px`,left:`${ie}px`,zIndex:400}}}catch{}}function Be(){try{const ee=Math.max(8,window.innerHeight-8-48-200),ie=Math.max(8,Math.round(window.innerWidth-200-8));fe.value={position:"fixed",top:`${ee}px`,left:`${ie}px`,zIndex:400}}catch{}}function et(){be.value=!be.value,be.value&&Bt(()=>ke())}function on(){ae.value=!ae.value,ae.value&&Bt(()=>Be())}function jt(_){xe.value===_?xe.value=null:xe.value=_}function qt(){xe.value=null}function Rt(){Oe.value=!Oe.value}function kn(){Oe.value=!1}const ur=S(!1),Dt=S(null),an=S(null),ps=S(null),Xt=S(0);function Pc(){var _;try{if(!o.value||!a.value||a.value.onboardingCreatorDone!==!0||ze.value.length===0)return;const m=localStorage.getItem(`playerTourCompleted:${o.value}`);try{const ee=((_=ht==null?void 0:ht.currentUser)==null?void 0:_.email)||"";ee&&Gg(ee).then(async ie=>{const ye=ie.filter(pe=>pe.seasonId===o.value);if(ye.length>0){const pe=`seasonPreferredPlayer:${o.value}`,Ve=localStorage.getItem(pe);let He=[];if(Ve)if(Ve.startsWith("["))try{He=JSON.parse(Ve)||[]}catch{}else He=[Ve];const Xe=new Set(He);ye.forEach(Qt=>Xe.add(Qt.playerId));const vt=Array.from(Xe);localStorage.setItem(pe,JSON.stringify(vt))}}).catch(()=>{})}catch{}const k=localStorage.getItem(`startPlayerTour:${o.value}`);!m&&k&&(Xt.value=1,localStorage.removeItem(`startPlayerTour:${o.value}`),Bt(()=>{const ee=document.querySelector('button[data-onboarding="add-player"]');if(ee){ee.scrollIntoView({behavior:"smooth",block:"end"});const ie=ee.getBoundingClientRect(),ye=document.getElementById("coachmark-add"),pe=280,Ve=100,He=(ye==null?void 0:ye.offsetWidth)||pe,Xe=(ye==null?void 0:ye.offsetHeight)||Ve,vt=Math.round(ie.right+12);if(vt+He<=window.innerWidth-12){const ln=ie.top+ie.height/2-Xe/2,un=-14,yt=12,mr=window.innerHeight-Xe-12,Lr=Math.max(yt,Math.min(Math.round(ln+un),mr));$.value={position:{x:vt,y:Lr},side:"right"}}else{const ln=Math.round(ie.left+ie.width/2-He/2),un=Math.round(ie.top-Xe-8),yt=8,mr=window.innerWidth-He-8;$.value={position:{x:Math.max(yt,Math.min(ln,mr)),y:un},side:null}}}}))}catch{}}const Br=S(!1),yn=S(null),ms=S(null),Wi=S(!1),br=S(null),Qi=S(!1),gs=S(null),Ji=S(!1),Dr=S(!1),ia=S(!1),mn=S(!1),kl=S(null);function vs(){Dr.value=!1}function Js(){try{const _=ht==null?void 0:ht.currentUser;if(!_||_.isAnonymous){let m=null;if(Xr.value&&Xr.value.size>0){const k=Xr.value.values().next().value;m=Fe.value.find(ee=>ee.id===k)||null}m||(m=Fe.value[0]||null),mn.value=!0,m&&(kl.value=m);return}}catch{}Dr.value=!0}async function of(){var _;try{const m=(_=ht==null?void 0:ht.currentUser)==null?void 0:_.email;if(!m)return;const{resetPlayerPassword:k}=await tn(()=>Promise.resolve().then(()=>Ai),void 0);await k(m),$e.value=!0,lt.value="Email de réinitialisation envoyé.",setTimeout(()=>{$e.value=!1},3e3)}catch{hr.value=!0,Er.value="Impossible d'envoyer l'email de réinitialisation.",setTimeout(()=>{hr.value=!1},3e3)}}async function af(){try{await HN(ht),vs(),$e.value=!0,lt.value="Déconnecté de cet appareil.",setTimeout(()=>{$e.value=!1},2500)}catch{hr.value=!0,Er.value="Déconnexion impossible.",setTimeout(()=>{hr.value=!1},3e3)}}async function Ys(){alert("Suppression de compte: contactez l'organisateur pour dissocier vos joueurs. Fonction complète à venir.")}async function lf(_){var m;vs();try{if(_.seasonId&&_.seasonId!==o.value){const k=Re(de,"seasons",_.seasonId),ie=(await xt(Je(de,"seasons"))).docs.find(pe=>pe.id===_.seasonId),ye=(m=ie==null?void 0:ie.data())==null?void 0:m.slug;if(ye){t.push(`/season/${ye}?player=${encodeURIComponent(_.playerId)}&open=protection`);return}}else{const k=Fe.value.find(ee=>ee.id===_.playerId);if(k){pf(k);return}t.push(`?player=${encodeURIComponent(_.playerId)}&open=protection`)}}catch{}}Un(()=>{try{o.value&&localStorage.getItem(`dismissCreatorOnboarding:${o.value}`)&&(onboardingDismissedShare.value=!0)}catch{}document.addEventListener("click",_=>{if(be.value){const m=U.value,k=O.value,ee=m&&m.contains(_.target),ie=k&&k.contains(_.target);!ee&&!ie&&(be.value=!1)}if(ae.value){const m=ce.value;m&&m.contains(_.target)||(ae.value=!1)}}),document.addEventListener("keydown",_=>{_.key==="Escape"&&(be.value&&(be.value=!1),ae.value&&(ae.value=!1))}),window.addEventListener("resize",()=>{be.value&&ke(),ae.value&&Be()}),window.addEventListener("scroll",()=>{be.value&&ke(),ae.value&&Be()},{passive:!0})});function uf(){Bt(()=>{oa()})}const cr=S(new Set),zr=S(!0),wr=S(0),Nr=S("Préparation de la grille"),Dn=S(e.eventId||null),Dl=S(!1),Yi=S(null);St(()=>e.eventId,_=>{if(_)if(Dn.value=_,ze.value.length>0)cv(_);else{const m=St(ze,k=>{k.length>0&&(cv(_),m())},{immediate:!0})}});const ys=je(()=>Fe.value.map(_=>({..._,isProtected:cr.value.has(_.id),email:null}))),Nl=je(()=>Dn.value?fr.value.findIndex(_=>_.id===Dn.value):-1);je(()=>{if(!Dn.value||Nl.value===-1)return!1;if(window.innerWidth<=768){const _=document.querySelector(`[data-event-id="${Dn.value}"]`);if(_){const m=_.getBoundingClientRect();return m.left>=0&&m.right<=window.innerWidth}}return!0});const dr=S(null),Vl=S(!1),Rc=S(!1),Xs=S(0),Cc=S(null),Nn=S(null),Kr=S(null);function In(){const _=dr.value;if(!_)return;const{scrollLeft:m,scrollWidth:k,clientWidth:ee}=_;Vl.value=m>2,Rc.value=m<k-ee-2}function oa(){var _;try{In(),Xs.value=((_=dr.value)==null?void 0:_.scrollLeft)||0}catch{}}function kc(_){const m=dr.value;if(!m)return;let k=0;const ee=m.querySelector("tbody tr td[data-event-id]");if(ee)k=ee.getBoundingClientRect().width;else if(Nn!=null&&Nn.value){const ye=Nn.value.querySelector(".col-event");ye&&(k=ye.getBoundingClientRect().width)}(!k||!isFinite(k))&&(k=m.clientWidth*.6);const ie=m.scrollLeft+_*k;m.scrollTo({left:ie,behavior:"smooth"})}const Zs=S(null);S(0);const ei=S(!1),Xi=S(!1),Gr=S(0);function aa(_,m){m&&typeof m.preventDefault=="function"&&m.preventDefault(),xr(),kc(_)}function Zi(_,m){if(m&&typeof m.preventDefault=="function"&&m.preventDefault(),ei.value)return;ei.value=!0,Gr.value=_,Xi.value=!1;const k=dr.value;if(!k)return;let ee=0;const ie=k.querySelector("tbody tr td[data-event-id]");if(ie)ee=ie.getBoundingClientRect().width;else if(Nn!=null&&Nn.value){const He=Nn.value.querySelector(".col-event");He&&(ee=He.getBoundingClientRect().width)}(!ee||!isFinite(ee))&&(ee=k.clientWidth*.6);const ye=ee/6,pe=120,Ve=()=>{if(!ei.value||Gr.value===0)return;Xi.value||(Xi.value=!0);const He=k.scrollLeft+Gr.value*ye;k.scrollTo({left:He,behavior:"auto"}),Zs.value=window.setTimeout(Ve,pe)};Zs.value=window.setTimeout(Ve,250)}function xr(_){_&&typeof _.preventDefault=="function"&&_.preventDefault();const m=ei.value,k=Xi.value;if(ei.value=!1,Zs.value&&(clearTimeout(Zs.value),Zs.value=null),_&&typeof _.type=="string"&&_.type.startsWith("touch")&&!k){const ee=Gr.value||0;ee!==0&&kc(ee),Gr.value=0;return}Gr.value=0,m&&k&&cf()}function cf(){const _=dr.value;if(!_)return;let m=0;const k=_.querySelector("tbody tr td[data-event-id]");if(k)m=k.getBoundingClientRect().width;else if(Nn!=null&&Nn.value){const pe=Nn.value.querySelector(".col-event");pe&&(m=pe.getBoundingClientRect().width)}if(!m||!isFinite(m)||m<=0)return;const ee=_.scrollLeft,ye=Math.round(ee/m)*m;_.scrollTo({left:ye,behavior:"smooth"})}function df(_){P.value=_;const m=document.querySelector(`[data-player-id="${_}"]`);m&&m.scrollIntoView({behavior:"smooth",block:"center"}),$e.value=!0,lt.value="Nouveau joueur ajouté !",setTimeout(()=>{$e.value=!1},3e3)}function Dc(){if(Xt.value!==1)return;const _=document.querySelector('button[data-onboarding="add-player"]');if(!_)return;const m=_.getBoundingClientRect(),k=document.getElementById("coachmark-add"),ee=280,ie=100,ye=k!=null&&k.offsetWidth&&k.offsetWidth>0?k.offsetWidth:ee,pe=k!=null&&k.offsetHeight&&k.offsetHeight>0?k.offsetHeight:ie,Ve=Math.round(m.right+12);if(Ve+ye<=window.innerWidth-12){const Xe=m.top+m.height/2-pe/2,Qt=Ol(Xe+-14,pe);$.value={position:{x:Ve,y:Qt},side:"right"}}else{const Xe=Math.round(m.left+m.width/2-ye/2),vt=Ol(m.top-pe-8,pe),Qt=8,ln=window.innerWidth-ye-8;$.value={position:{x:Math.max(Qt,Math.min(Xe,ln)),y:vt},side:null}}}function Ol(_,m){const k=pageHeaderRef==null?void 0:pageHeaderRef.value,ee=k?Math.max(0,Math.round(k.getBoundingClientRect().height||0)):0,ie=Math.max(12,ee+8),ye=window.innerHeight-m-12;return Math.max(ie,Math.min(Math.round(_),ye))}const Hr=S(!1),Vr=S(null),Ir=S(null),eo=S({position:"fixed",top:"0px",right:"0px"});function ti(){try{const _=Vr.value;if(!_)return;const m=_.getBoundingClientRect(),k=8,ee=Math.max(k,Math.round(m.bottom+k)),ie=Math.max(k,Math.round(window.innerWidth-m.right));eo.value={position:"fixed",top:`${ee}px`,right:`${ie}px`,zIndex:400}}catch{}}function Nc(){Hr.value=!Hr.value,Hr.value&&Bt(()=>ti())}function Et(){Hr.value=!1}function to(_){if(!Hr.value)return;const m=Vr.value,k=Ir.value,ee=m&&m.contains(_.target),ie=k&&k.contains(_.target);!ee&&!ie&&(Hr.value=!1)}function ni(_){_.key==="Escape"&&Et()}function Wr(){Hr.value&&ti()}Un(()=>{document.addEventListener("click",to),document.addEventListener("keydown",ni),window.addEventListener("scroll",Wr,{passive:!0}),window.addEventListener("resize",Wr)}),ka(()=>{document.removeEventListener("click",to),document.removeEventListener("keydown",ni),window.removeEventListener("scroll",Wr),window.removeEventListener("resize",Wr)});function la(){var _;Xt.value===1&&((_=$.value)!=null&&_.position)&&Dc()}Un(()=>{window.addEventListener("scroll",la,{passive:!0}),window.addEventListener("resize",la)}),ka(()=>{window.removeEventListener("scroll",la),window.removeEventListener("resize",la)});function no(_){return cr.value.has(_)}async function Ml(){if(o.value)try{const _=await Wp(o.value),m=new Set;_.forEach(k=>{k.isProtected&&m.add(k.playerId||k.id)}),cr.value=m}catch{const m=new Set;for(const k of Fe.value)await Si(k.id,o.value)&&m.add(k.id);cr.value=m}}const $e=S(!1),lt=S(""),hr=S(!1),Er=S("");function Qr(){try{const _=`${window.location.origin}/season/${s}`;navigator.clipboard.writeText(_),$e.value=!0,lt.value="Lien copié dans le presse-papiers",setTimeout(()=>{$e.value=!1},2500)}catch{hr.value=!0,Er.value="Impossible de copier le lien",setTimeout(()=>{hr.value=!1},2500)}}async function Ll(_){await Y({type:"deleteEvent",data:{eventId:_}})}async function Vc(_=null){const m=_||c.value;if(console.debug("deleteEventConfirmed"),!m){console.error("Aucun événement à supprimer");return}try{await q4(m,o.value),ze.value=ze.value.filter(k=>k.id!==m),await Promise.all([ih(o.value),To(Fe.value,ze.value,o.value),Ao(o.value)]).then(([k,ee,ie])=>{ze.value=k,Zt.value=ee,mt.value=ie}),l.value=!1,c.value=null,$e.value=!0,lt.value="Événement supprimé avec succès !",setTimeout(()=>{$e.value=!1},3e3)}catch{console.error("Erreur lors de la suppression de l'événement"),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function Oc(){l.value=!1,c.value=null}async function Jr(){if(!h.value||!f.value.trim()||!g.value)return;const _=parseInt(y.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}try{const m={title:f.value.trim(),date:g.value,description:ue.value.trim()||"",playerCount:_,archived:!!re.value};await w_(h.value,m,o.value),!m.archived&&Fe.value.length>0&&cr.value.size>0&&(gs.value={id:h.value,...m},Qi.value=!0),await Promise.all([ih(o.value),To(Fe.value,ze.value,o.value),Ao(o.value)]).then(([k,ee,ie])=>{ze.value=k,Zt.value=ee,mt.value=ie}),h.value=null,f.value="",g.value="",ue.value="",y.value=6,re.value=!1,$e.value=!0,lt.value="Événement mis à jour avec succès !",setTimeout(()=>{$e.value=!1},3e3)}catch{console.error("Erreur lors de l'édition de l'événement"),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function hf(){if(A.value.trim())try{const _=A.value.trim(),m=await mT(_,o.value);await Promise.all([Au(o.value),To(Fe.value,ze.value,o.value),Ao(o.value)]).then(([k,ee,ie])=>{Fe.value=k,Zt.value=ee,mt.value=ie,Ml();const ye=Fe.value.find(Ve=>Ve.id===m);df(m),j.value=m,B.value=fr.value&&fr.value[0]&&fr.value[0].id?fr.value[0].id:null;try{o.value&&localStorage.setItem(`lastAddedPlayerId:${o.value}`,m)}catch{}try{typeof Xt<"u"&&(Xt.value=2)}catch{}const pe=document.querySelector(`[data-player-id="${m}"]`);pe&&pe.scrollIntoView({behavior:"smooth",block:"center"}),Bt(()=>{const Ve=`[data-player-id="${j.value}"] td[data-event-id="${B.value}"]`,He=document.querySelector(Ve);if(He){const Xe=He.getBoundingClientRect();z.value.position={x:Math.round(Xe.left),y:Math.round(Xe.top+window.scrollY-48)}}}),$e.value=!0,lt.value="Joueur ajouté avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{$e.value=!1},3e3),setTimeout(()=>{$e.value=!1,lt.value=""},5e3)}),I.value=!1,A.value=""}catch{console.error("Erreur lors de l'ajout du joueur"),alert("Erreur lors de l'ajout du joueur. Veuillez réessayer.")}}function ro(){h.value=null,f.value="",g.value="",ue.value="",y.value=6}S(null);const ua=S(!1),Yn=S(""),ri=S(""),so=S(""),Yr=S(6),_s=S(!1);async function Mc(){if(!Yn.value.trim()||!ri.value){alert("Veuillez remplir le titre et la date de l'événement");return}const _=parseInt(Yr.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}const m={title:Yn.value.trim(),date:ri.value,description:so.value.trim()||"",playerCount:_,archived:!!_s.value};await io(m)}async function io(_){try{const m=await B4(_,o.value);ze.value=[...ze.value,{id:m,..._}];const k={};for(const ee of Fe.value)k[ee.name]=Zt.value[ee.name]||{},k[ee.name][m]=null,await b_(ee.name,k[ee.name],o.value);Yn.value="",ri.value="",so.value="",Yr.value=6,_s.value=!1,ua.value=!1,await Promise.resolve(),$e.value=!0,lt.value="Événement créé avec succès !",!_.archived&&Fe.value.length>0&&cr.value.size>0&&(gs.value={id:m,..._},Qi.value=!0),setTimeout(()=>{$e.value=!1},3e3)}catch{console.error("Erreur lors de la création de l'événement"),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function oo(){Yn.value="",ri.value="",so.value="",Yr.value=6,ua.value=!1}async function $l(){await Y({type:"addEvent",data:{}})}const ze=S([]),Fe=S([]),Zt=S({}),mt=S({}),Lc=S({}),ca=S({});St([()=>ze.value.length,()=>Fe.value.length,zr],()=>{zr.value||Bt(()=>{oa()})}),St([()=>Fe.value.length,()=>ze.value.length,o],()=>{Pc()}),Un(async()=>{try{ev("firebase"),await pT();const m=Hu(Je(de,"seasons"),Yd("slug","==",e.slug)),k=await xt(m);if(k.empty){t.push("/seasons");return}else{const pe=k.docs[0];o.value=pe.id;const Ve=pe.data();i.value=Ve.name,a.value=Ve,document.title=`Saison : ${i.value}`,OO(e.slug)}if(o.value){Nr.value="Chargement des événements de la saison",wr.value=20;const pe=await xt(Je(de,"seasons",o.value,"events"));ze.value=pe.docs.map(yt=>({id:yt.id,...yt.data(),playerCount:yt.data().playerCount||6})),Nr.value="Chargement des joueurs",wr.value=45;const Ve=await xt(Je(de,"seasons",o.value,"players"));Fe.value=Ve.docs.map(yt=>({id:yt.id,...yt.data()})),Nr.value="Chargement des disponibilités",wr.value=70;const He=await xt(Je(de,"seasons",o.value,"availability")),Xe={};He.docs.forEach(yt=>{const mr=yt.data(),Lr={};Object.keys(mr).forEach(yo=>{const _a=mr[yo];Lr[yo]=_a==="oui"?!0:_a==="non"?!1:_a}),Xe[yt.id]=Lr}),Zt.value=Xe,Nr.value="Chargement des sélections",wr.value=85;const vt=await xt(Je(de,"seasons",o.value,"selections")),Qt={};vt.docs.forEach(yt=>{Qt[yt.id]=yt.data().players||[]}),mt.value=Qt;const ln=await Wp(o.value),un=new Set;Array.isArray(ln)&&ln.forEach(yt=>{yt.isProtected&&un.add(yt.playerId||yt.id)}),cr.value=un}const ee=pe=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>pe()):setTimeout(pe,0)};Nr.value="Préparation de l'interface",wr.value=95,ee(()=>{fo(),Vn()}),console.debug("players (deduplicated)"),console.debug("availability loaded"),await Bt(),wr.value=100,zr.value=!1,Bt(()=>{In(),requestAnimationFrame(()=>In()),setTimeout(()=>In(),250);const pe=dr.value;pe&&(pe.addEventListener("scroll",Ve=>{In(),Xs.value=pe.scrollLeft||0},{passive:!0}),window.addEventListener("resize",In),typeof ResizeObserver<"u"&&(Kr.value=new ResizeObserver(()=>{In()}),Kr.value.observe(pe)))});const ie=r.query.event;if(ie&&ze.value.length>0){const pe=ze.value.find(Ve=>Ve.id===ie);pe?(console.debug("Événement trouvé depuis l'URL"),await vf(ie,pe)):(console.warn("Événement non trouvé avec l'ID"),hr.value=!0,Er.value="Événement non trouvé",setTimeout(()=>{hr.value=!1},3e3))}const ye=r.query.player;if(ye&&Fe.value.length>0){const pe=Fe.value.find(Ve=>Ve.id===ye);pe&&(pf(pe),await Bt(),r.query.verified==="1"&&($e.value=!0,lt.value="Joueur associé à votre compte.",setTimeout(()=>{$e.value=!1},2500)))}}catch(_){console.error("Erreur lors du chargement de la grille:",_),hr.value=!0,Er.value="Erreur lors du chargement des données",setTimeout(()=>{hr.value=!1},5e3),zr.value=!1}}),St(()=>r.params.eventId,_=>{if(_){const m=()=>{const k=ze.value.find(ee=>ee.id===_);return k?(nv(k),!0):!1};if(ze.value.length>0)m();else{const k=St(ze,ee=>{ee.length>0&&m()&&k()},{immediate:!0})}}},{immediate:!0});function Fl(_){if(!_)return null;if(_ instanceof Date)return _;if(typeof(_==null?void 0:_.toDate)=="function")return _.toDate();if(typeof _=="string"||typeof _=="number"){const m=new Date(_);return isNaN(m.getTime())?null:m}return null}const Or=je(()=>{let _=null;try{o.value&&(_=localStorage.getItem(`seasonPreferredPlayer:${o.value}`))}catch{}const m=[...Fe.value].sort((pe,Ve)=>(pe.name||"").localeCompare(Ve.name||"","fr",{sensitivity:"base"}));if(!_)return m;let k=[];try{_.startsWith("[")?k=JSON.parse(_):_&&(k=[_])}catch{k=[]}const ee=new Set(k);if(ee.size===0)return m;const ie=m.filter(pe=>ee.has(pe.id)),ye=m.filter(pe=>!ee.has(pe.id));return[...ie,...ye]}),Xr=je(()=>{try{if(o.value){const _=localStorage.getItem(`seasonPreferredPlayer:${o.value}`);if(!_)return new Set;if(_.startsWith("[")){const m=JSON.parse(_);return new Set(Array.isArray(m)?m:[])}return new Set([_])}}catch{}return new Set}),Mr=je(()=>[...ze.value].sort((_,m)=>{const k=Fl(_.date),ee=Fl(m.date),ie=k?k.getTime():Number.POSITIVE_INFINITY,ye=ee?ee.getTime():Number.POSITIVE_INFINITY;return ie!==ye?ie-ye:(_.title||"").localeCompare(m.title||"","fr",{sensitivity:"base"})})),bs=S(!1),fr=je(()=>{const _=Mr.value;return bs.value?_:_.filter(m=>!m.archived)});function ao(){bs.value=!bs.value}const da=S("selected"),Ul=je(()=>{var k;if(!M.value)return Or.value;const _=M.value.id,m=new Set(((k=mt.value)==null?void 0:k[_])||[]);return Or.value.filter(ee=>{var Ve;const ie=ee.name,ye=(Ve=Zt.value[ie])==null?void 0:Ve[_],pe=m.has(ie);switch(da.value){case"selected":return pe;case"available":return ye===!0&&!pe;case"unavailable":return ye===!1;case"unknown":return ye!==!0&&ye!==!1;case"all":default:return!0}})}),ha=je(()=>M.value?go(M.value.id):null),$c=je(()=>{if(!M.value)return!1;const _=go(M.value.id);return _.type==="incomplete"||_.type==="insufficient"}),lo=je(()=>M.value?Bl(M.value.id):"");async function fa(_,m){const k=Fe.value.find(ye=>ye.name===_);if(!k){console.error("Joueur non trouvé");return}const ee=ze.value.find(ye=>ye.id===m);if(!ee){console.error("Événement non trouvé");return}if(ee.archived){$e.value=!0,lt.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{$e.value=!1},3e3);return}if(no(k.id)){const ye=Fo(k.id),pe=ps.value===k.id;console.debug("Joueur protégé:",{playerId:k.id,hasCachedPassword:ye,wasRecentlyVerified:pe,recentlyVerifiedPlayer:ps.value}),ye||pe?(console.debug("Session active ou joueur récemment vérifié, procéder au toggle"),pe&&(console.debug("Nettoyage du flag recentlyVerifiedPlayer"),ps.value=null),pa(k,m)):(console.debug("Pas de session, affichage de la modal de vérification"),an.value={playerName:_,eventId:m},Dt.value=k,ur.value=!0);return}pa(k,m)}function pa(_,m){var ie,ye,pe;const k=(ie=Zt.value[_.name])==null?void 0:ie[m];console.debug("toggleAvailability");let ee;k===!0?ee=!1:k===!1?ee=void 0:ee=!0,ee===void 0?Zt.value[_.name]&&delete Zt.value[_.name][m]:(Zt.value[_.name]||(Zt.value[_.name]={}),Zt.value[_.name][m]=ee);try{typeof Xt<"u"&&Xt.value===1&&_.id===(j.value||((ye=Or.value[0])==null?void 0:ye.id))&&m===(B.value||((pe=fr.value[0])==null?void 0:pe.id))&&(Xt.value=3,Bt(()=>{const He=document.querySelector(`[data-player-id="${_.id}"]`);if(He){const Xe=He.querySelector(".player-name");if(Xe){const vt=Xe.getBoundingClientRect();he.value.position={x:Math.round(vt.right+8),y:Math.round(vt.top+window.scrollY-4)}}}}),ka(()=>{try{window.removeEventListener("resize",In)}catch{}try{Kr.value&&Kr.value.disconnect()}catch{}}))}catch{}b_(_.name,Zt.value[_.name],o.value).then(async()=>{await Bt(),Vn(),$e.value=!0,lt.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{$e.value=!1},3e3)}).catch(Ve=>{console.error("Erreur lors de la mise à jour de la disponibilité"),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}function En(_,m){var k;return(k=Zt.value[_])==null?void 0:k[m]}function Fc(_,m){var ie;const k=mt.value[m]||[],ee=(ie=Zt.value[_])==null?void 0:ie[m];return k.includes(_)&&ee===!0}async function Uc(_,m=6){const k=ze.value.find(pe=>pe.id===_),ee=(k==null?void 0:k.playerCount)||6,ie=mt.value[_]||[];if(ie.length>0&&ie.every(pe=>En(pe,_))){console.debug("Tous les joueurs sélectionnés sont disponibles, nouveau tirage complet");const Ve=Fe.value.filter(vt=>En(vt.name,_)).map(vt=>{const Qt=ws(vt.name);return{name:vt.name,weight:1/(1+Qt)}}),He=[],Xe=[...Ve];for(;He.length<ee&&Xe.length>0;){const vt=Xe.reduce((un,yt)=>un+yt.weight,0);let Qt=Math.random()*vt;const ln=Xe.findIndex(un=>(Qt-=un.weight,Qt<=0));ln>=0&&(He.push(Xe[ln].name),Xe.splice(ln,1))}mt.value[_]=He}else{const pe=ie.filter(He=>En(He,_)),Ve=ee-pe.length;if(Ve<=0)mt.value[_]=pe;else{const He=new Set(pe),vt=Fe.value.filter(un=>En(un.name,_)&&!He.has(un.name)).map(un=>{const yt=ws(un.name);return{name:un.name,weight:1/(1+yt)}}),Qt=[],ln=[...vt];for(;Qt.length<Ve&&ln.length>0;){const un=ln.reduce((Lr,yo)=>Lr+yo.weight,0);let yt=Math.random()*un;const mr=ln.findIndex(Lr=>(yt-=Lr.weight,yt<=0));mr>=0&&(Qt.push(ln[mr].name),ln.splice(mr,1))}mt.value[_]=[...pe,...Qt]}}await Jp(_,mt.value[_],o.value),fo(),Vn()}async function ma(_,m=6){var pe,Ve;console.debug("tirerProtected appelé"),console.debug("etat modal selection avant");const k=Br.value,ee=(pe=yn.value)==null?void 0:pe.id,ie=mt.value[_]&&mt.value[_].length>0,ye=ie?[...mt.value[_]]:[];if(await Uc(_,m),console.debug("etat modal selection apres"),k&&!Br.value&&(console.debug("Restauration de la popin de sélection..."),Br.value=!0,yn.value=ze.value.find(He=>He.id===ee)),Br.value&&((Ve=yn.value)==null?void 0:Ve.id)===_)if(console.debug("Popin de sélection ouverte, mise à jour..."),await Bt(),ms.value&&ms.value.showSuccess){console.debug("Appel de showSuccess sur la popin de sélection");const He=mt.value[_]||[],Xe=ye.filter(Qt=>He.includes(Qt)),vt=Xe.length>0&&Xe.length<ye.length;ms.value.showSuccess(ie,vt)}else console.debug("showSuccess indisponible");else console.debug("Popin de sélection fermée, affichage message global"),$e.value=!0,ze.value.find(He=>He.id===_),mt.value[_],ie?lt.value="Sélection mise à jour avec succès !":lt.value="Sélection effectuée avec succès !",setTimeout(()=>{$e.value=!1},3e3)}function uo(_){_===0?$.value.position=null:_===1?z.value.position=null:_===2&&(he.value.position=null)}function jc(_){var k;return _?(typeof _=="string"?new Date(_):((k=_.toDate)==null?void 0:k.call(_))||_).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function co(_){var k;return _?(typeof _=="string"?new Date(_):((k=_.toDate)==null?void 0:k.call(_))||_).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function ws(_){return Object.values(mt.value).filter(m=>m.includes(_)).length}function ga(_){const m=Zt.value[_]||{};return Object.values(m).filter(k=>k===!0).length}function Tr(_){return _?Object.values(Zt.value).filter(m=>m[_]===!0).length:0}function ho(_){return _?(mt.value[_]||[]).length:0}function jl(_){const m=ze.value.find(ee=>ee.id===_),k=(m==null?void 0:m.playerCount)||6;return ho(_)>=k}function qc(_){const m=ga(_),k=ws(_);return m===0?0:k/m}function Bc(_){Lc.value[_]={availability:ga(_),selection:ws(_),ratio:qc(_)}}function fo(){Fe.value.forEach(_=>Bc(_.name))}function Vn(){const _={};ze.value.forEach(m=>{const k=m.playerCount||6,ie=Fe.value.filter(pe=>En(pe.name,m.id)===!0).map(pe=>{const Ve=ws(pe.name);return{name:pe.name,weight:1/(1+Ve)}}),ye=ie.reduce((pe,Ve)=>pe+Ve.weight,0);ie.forEach(pe=>{const Ve=Math.min(1,pe.weight/ye*k);_[pe.name]||(_[pe.name]={}),_[pe.name][m.id]=Math.round(Ve*100)})}),ca.value=_}const po=S(null),mo=S(!1);async function si(_=null){const m=_||po.value;if(!m){console.error("Aucun joueur à supprimer");return}try{await F4(m,o.value),Fe.value=Fe.value.filter(k=>k.id!==m),mo.value=!1,po.value=null,$e.value=!0,lt.value="Joueur supprimé avec succès !",setTimeout(()=>{$e.value=!1},3e3)}catch{console.error("Erreur lors de la suppression du joueur"),alert("Erreur lors de la suppression du joueur. Veuillez réessayer.")}}function u(){mo.value=!1,po.value=null}async function p(_){ov(),await Si(_,o.value)?await Te({type:"deletePlayer",data:{playerId:_}}):await Y({type:"deletePlayer",data:{playerId:_}})}async function v(){if(T.value){const _=ze.value.find(k=>k.id===T.value),m=(_==null?void 0:_.playerCount)||6;await ma(T.value,m),ve.value=!1,T.value=null}}function b(){ve.value=!1,T.value=null}function K(){return q.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis",toggleArchive:"Archivage d'événement - Code PIN requis",updateSelection:"Mise à jour de sélection - Code PIN requis"}[q.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function Y(_){if(On.isPinCached(o.value)){const m=On.getCachedPin(o.value);if(console.debug("PIN en cache trouvé, utilisation automatique"),await nh(o.value,m)){await oi(_);return}else On.clearSession()}q.value=_,L.value=!0}async function Te(_){const m=_.data.playerId;try{if(On.isPinCached(o.value)){console.debug("PIN de saison en cache — saut de la demande de mot de passe joueur"),await oi(_);return}}catch{}if(Fo(m)){console.debug("Mot de passe du joueur en cache trouvé, utilisation automatique"),await oi(_);return}Ze.value=_,ft.value=!0}async function Tt(_){try{if(await nh(o.value,_)){On.saveSession(o.value,_),L.value=!1;const k=q.value;q.value=null,await oi(k)}else R.value="Code PIN incorrect",setTimeout(()=>{R.value=""},3e3)}catch{console.error("Erreur lors de la vérification du PIN"),R.value="Erreur lors de la vérification du code PIN"}}function _n(){L.value=!1,q.value=null,R.value=""}async function ut(_){if(_){W.value=!0,ne.value="";try{const m=Ze.value.data.playerId,k=await Bp(o.value);if(_===k){try{On.saveSession(o.value,_)}catch{}try{Fi.saveSession(Ze.value.data.playerId)}catch{}ft.value=!1;const ie=Ze.value;Ze.value=null,F.value="",await oi(ie);return}if(await verifyPlayerPassword(m,_,o.value)){ft.value=!1;const ie=Ze.value;Ze.value=null,F.value="",await oi(ie)}else ne.value="Mot de passe incorrect",setTimeout(()=>{ne.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),ne.value="Erreur lors de la vérification du mot de passe"}finally{W.value=!1}}}function Tn(){ft.value=!1,Ze.value=null,ne.value="",F.value="",W.value=!1}async function bn(_){if(_){Ge.value=!0,J.value="";try{const m=te.value.data.player,k=await Bp(o.value);if(_===k){try{On.saveSession(o.value,_)}catch{}try{Fi.saveSession(te.value.data.player.id)}catch{}Pe.value=!1;const ie=te.value;te.value=null,Ee.value="",await oi(ie);return}if(await verifyPlayerPassword(m.id,_,o.value)){Pe.value=!1;const ie=te.value;te.value=null,Ee.value="",await oi(ie)}else J.value="Mot de passe incorrect",setTimeout(()=>{J.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),J.value="Erreur lors de la vérification du mot de passe"}finally{Ge.value=!1}}}function ii(){Pe.value=!1,te.value=null,J.value="",Ee.value="",Ge.value=!1}async function pr(){Z.value=!0,Ae.value="",we.value="";try{const _=te.value.data.player,m=await sendPasswordResetEmail(_.id,o.value);we.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),Ae.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{Z.value=!1}}async function va(){We.value=!0,at.value="",x.value="";try{const _=Ze.value.data.playerId,m=await sendPasswordResetEmail(_,o.value);x.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),at.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{We.value=!1}}function ql(){return On.isPinCached(o.value)?{timeRemaining:On.getTimeRemaining(),isExpiringSoon:On.isExpiringSoon()}:null}async function oi(_){var ee;if(!_)return;const{type:m,data:k}=_;try{switch(m){case"deleteEvent":console.debug("executePendingOperation - data.eventId reçu"),c.value=k.eventId,l.value=!0;break;case"addEvent":ua.value=!0;break;case"deletePlayer":po.value=k.playerId,mo.value=!0;break;case"launchSelection":mt.value[k.eventId]&&mt.value[k.eventId].length>0?(T.value=k.eventId,ve.value=!0,C.value=!1):(await ma(k.eventId,k.count),C.value=!1);break;case"toggleAvailability":pa(k.player,k.eventId);break;case"toggleArchive":await setEventArchived(k.eventId,k.archived,o.value);{const ie=ze.value.findIndex(ye=>ye.id===k.eventId);ie!==-1&&(ze.value[ie]={...ze.value[ie],archived:!!k.archived}),re.value=!!k.archived}break;case"updateSelection":{const{eventId:ie,players:ye}=k,pe=[...mt.value[ie]||[]],Ve=Array.isArray(ye)?ye:[];await Jp(ie,Ve,o.value),mt.value[ie]=Ve;try{const He=pe.filter(Xe=>!Ve.includes(Xe));if(He.length>0){const Xe=ze.value.find(vt=>vt.id===ie);await EM({eventId:ie,eventData:Xe,removedPlayers:He,newSelectedPlayers:Ve,seasonId:o.value,seasonSlug:s,players:ys.value})}}catch{}try{(ee=ms.value)==null||ee.showSuccess(!0,!0)}catch{}}break}}catch{console.error("Erreur lors de l'exécution de l'opération"),$e.value=!0,lt.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{$e.value=!1},3e3)}}function _T(){t.push("/seasons")}ka(()=>{const _=dr.value;_&&_.removeEventListener("scroll",In),window.removeEventListener("resize",In)});async function nv(_){M.value=_,ue.value=_.description||"",re.value=!!_.archived;try{const[m,k]=await Promise.all([To(Fe.value,ze.value,o.value),Ao(o.value)]);Zt.value=m,mt.value=k}catch(m){console.warn("Impossible de rafraîchir les données avant ouverture des détails:",m)}C.value=!0}function ff(){C.value=!1,M.value=null,ue.value="",ae.value=!1,be.value=!1,qt(),kn(),Q.value={position:"fixed",top:"0px",left:"0px"},fe.value={position:"fixed",top:"0px",left:"0px"}}function ya(_,m=null){const k=m||M.value;if(k)try{B3(_,k,i.value),$e.value=!0,_==="ics"?lt.value="Fichier .ics téléchargé ! Importez-le dans votre agenda":_==="google"?lt.value="Google Calendar ouvert dans un nouvel onglet":_==="outlook"&&(lt.value="Outlook ouvert dans un nouvel onglet"),setTimeout(()=>{$e.value=!1},3e3)}catch(ee){console.error("Erreur lors de l'ajout au calendrier:",ee),$e.value=!0,lt.value="Erreur lors de l'ajout au calendrier",setTimeout(()=>{$e.value=!1},3e3)}}function rv(){ff(),r.params.eventId&&t.push(`/season/${e.slug}`)}async function bT(_,m){console.debug("handleAvailabilityToggle appelé");const k=Fe.value.find(ye=>ye.name===_);if(!k){console.error("Joueur non trouvé");return}const ee=ze.value.find(ye=>ye.id===m);if(ee!=null&&ee.archived){$e.value=!0,lt.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{$e.value=!1},3e3);return}console.debug("Joueur trouvé");const ie=no(k.id);if(console.debug("Joueur protégé"),ie){Fo(k.id)?(console.debug("Session active, procéder au toggle"),await fa(_,m)):(console.debug("Demande du mot de passe pour joueur protégé"),an.value={playerName:_,eventId:m},Dt.value=k,ur.value=!0);return}console.debug("Joueur non protégé, procéder au toggle"),await fa(_,m)}function wT(_,m){return(mt.value[m]||[]).includes(_)}async function xT(_){if(console.debug("Mot de passe vérifié"),Dt.value&&(ps.value=Dt.value.id,console.debug("Joueur marqué comme récemment vérifié")),an.value){const{playerName:m,eventId:k}=an.value;console.debug("Exécution de l'action en attente"),await fa(m,k),an.value=null}else console.debug("Aucune action en attente trouvée");ur.value=!1,Dt.value=null}function sv(){h.value=M.value.id,f.value=M.value.title,g.value=M.value.date,ue.value=M.value.description||"",y.value=M.value.playerCount||6,C.value=!1}async function iv(){if(M.value)try{const _=!M.value.archived,m={...M.value,archived:_};await w_(M.value.id,m,o.value),M.value.archived=_;const k=ze.value.findIndex(ee=>ee.id===M.value.id);k!==-1&&(ze.value[k].archived=_),$e.value=!0,lt.value=_?"Événement archivé avec succès !":"Événement désarchivé avec succès !",setTimeout(()=>{$e.value=!1},3e3)}catch{console.error("Erreur lors de la modification de l'archivage"),alert("Erreur lors de la modification de l'archivage. Veuillez réessayer.")}}function pf(_){E.value=_,w.value=!0;try{typeof Xt<"u"&&Xt.value}catch{}}function ov(){w.value=!1,E.value=null}async function IT({playerId:_,newName:m}){try{await U4(_,m,o.value),await Promise.all([Au(o.value),To(Fe.value,ze.value,o.value),Ao(o.value)]).then(([k,ee,ie])=>{if(Fe.value=k,Zt.value=ee,mt.value=ie,Ml(),E.value&&E.value.id===_){const ye=k.find(pe=>pe.id===_);ye&&(E.value=ye)}}),$e.value=!0,lt.value="Joueur mis à jour avec succès !",setTimeout(()=>{$e.value=!1},3e3)}catch{console.error("Erreur lors de l'édition du joueur"),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function ET(){try{await Promise.all([Au(o.value),To(Fe.value,ze.value,o.value),Ao(o.value)]).then(([_,m,k])=>{if(Fe.value=_,Zt.value=m,mt.value=k,Ml(),E.value){const ee=_.find(ie=>ie.id===E.value.id);ee&&(E.value=ee)}}),$e.value=!0,lt.value="Données mises à jour !",setTimeout(()=>{$e.value=!1},3e3)}catch{console.error("Erreur lors du rafraîchissement")}}function TT(_){if(!_)return{availability:0,selection:0,ratio:0};const m=ga(_.name),k=ws(_.name),ee=m===0?0:Math.round(k/m*100);return{availability:m,selection:k,ratio:ee}}function go(_){const m=mt.value[_]||[],k=ze.value.find(ye=>ye.id===_),ee=(k==null?void 0:k.playerCount)||6,ie=Tr(_);if(m.length>0){const ye=m.some(Ve=>!En(Ve,_)),pe=ie<ee;if(ye||pe)return{type:"incomplete",hasUnavailablePlayers:ye,hasInsufficientPlayers:pe,unavailablePlayers:m.filter(Ve=>!En(Ve,_)),availableCount:ie,requiredCount:ee}}return ie<ee?{type:"insufficient",availableCount:ie,requiredCount:ee}:m.length===0?{type:"ready",availableCount:ie,requiredCount:ee}:{type:"complete",availableCount:ie,requiredCount:ee}}function Bl(_){const m=go(_);switch(m.type){case"incomplete":return m.hasUnavailablePlayers?m.unavailablePlayers.length===1?`Sélection incomplète : ${m.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${m.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${m.availableCount} joueurs disponibles pour ${m.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${m.availableCount} disponibles pour ${m.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${m.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${m.availableCount} joueurs disponibles`;default:return""}}async function AT(){const _=[];for(const m of Fe.value){if(!await Si(m.id,o.value))continue;const ee=await ME(m.id,o.value);ee&&_.push({...m,email:ee})}return _}function zc(_){if(_!=null&&_.archived){$e.value=!0,lt.value="Impossible d'annoncer un événement archivé",setTimeout(()=>{$e.value=!1},3e3);return}av(),br.value=_,Wi.value=!0;try{const m=new URLSearchParams(window.location.search);m.set("modal","announce"),m.set("event",(_==null?void 0:_.id)||""),history.replaceState(null,"",`${window.location.pathname}?${m.toString()}`)}catch{}}function ST(){Wi.value=!1,br.value=null;try{const _=new URLSearchParams(window.location.search);_.get("modal")==="announce"&&(_.delete("modal"),_.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${_.toString()}`))}catch{}}function av(){Qi.value=!1,gs.value=null}const mf=S(!1);async function lv({eventId:_,eventData:m,reason:k,selectedPlayers:ee,scope:ie="all",recipient:ye=null}){mf.value=!0;try{k==="selection"?(ie==="single"&&(ye!=null&&ye.email)?await I_({eventId:_,eventData:m,selectedPlayers:[ye.name],seasonId:o.value,seasonSlug:s,players:ys.value}):await I_({eventId:_,eventData:m,selectedPlayers:ee,seasonId:o.value,seasonSlug:s,players:ys.value}),$e.value=!0,lt.value=ie==="single"?`Notification envoyée à ${(ye==null?void 0:ye.name)||"1 joueur"}`:"Notifications de sélection envoyées à tous les joueurs sélectionnés !",setTimeout(()=>{$e.value=!1},3e3)):(ie==="single"&&(ye!=null&&ye.email)?await x_({eventId:_,eventData:m,players:[ye],seasonId:o.value,seasonSlug:s,createMagicLink:Kp,reminder:!1,getAvailabilityForEvent:(pe,Ve)=>En(pe,Ve)}):await x_({eventId:_,eventData:m,players:await AT(),seasonId:o.value,seasonSlug:s,createMagicLink:Kp,reminder:!1,getAvailabilityForEvent:(pe,Ve)=>En(pe,Ve)}),$e.value=!0,lt.value=ie==="single"?`Notification envoyée à ${(ye==null?void 0:ye.name)||"1 joueur"}`:"Notifications envoyées à tous les joueurs protégés !",setTimeout(()=>{$e.value=!1},3e3))}catch{console.error("Erreur lors de l'envoi des notifications"),$e.value=!0,lt.value="Erreur lors de l'envoi des notifications",setTimeout(()=>{$e.value=!1},3e3)}mf.value=!1}function gf(_){if(!_)return{};const m={};return Fe.value.forEach(k=>{m[k.name]=En(k.name,_)}),m}function vo(_){if(_!=null&&_.archived){$e.value=!0,lt.value="Impossible d'ouvrir la sélection sur un événement archivé",setTimeout(()=>{$e.value=!1},3e3);return}yn.value=_,Br.value=!0;try{const m=new URLSearchParams(window.location.search);m.set("modal","selection"),m.set("event",(_==null?void 0:_.id)||""),history.replaceState(null,"",`${window.location.pathname}?${m.toString()}`)}catch{}}function uv(){Br.value=!1,yn.value=null;try{const _=new URLSearchParams(window.location.search);_.get("modal")==="selection"&&(_.delete("modal"),_.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${_.toString()}`))}catch{}}async function PT(){if(!yn.value)return;const _=yn.value.id,m=yn.value.playerCount||6;if(Tr(_)===0){$e.value=!0,lt.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{$e.value=!1},3e3);return}await Y({type:"launchSelection",data:{eventId:_,count:m}})}function RT(){uv(),$e.value=!0,lt.value="Sélection validée !",setTimeout(()=>{$e.value=!1},3e3)}async function CT(_){if(!_||!_.eventId)return;const{eventId:m,players:k}=_;await Y({type:"updateSelection",data:{eventId:m,players:k}})}async function vf(_,m){if(!_||!m)return;dv(),Dn.value=_,Dl.value=!0,await Bt();const k=document.querySelector(`[data-event-id="${_}"]`);if(!k){console.warn("Élément événement non trouvé dans le DOM");return}document.querySelectorAll(".focused-event-highlight").forEach(pe=>{pe.classList.remove("focused-event-highlight")});const ee=document.querySelectorAll(`[data-event-id="${_}"]`);ee.forEach(pe=>{pe.classList.add("focused-event-highlight")});const ie=ee[0],ye=ee[ee.length-1];ie&&ie.classList.add("focused-event-column-start"),ye&&ye.classList.add("focused-event-column-end"),await kT(k),$e.value=!0,lt.value=`Événement ciblé : ${m.title}`,setTimeout(()=>{$e.value=!1},4e3),Yi.value=setTimeout(()=>{dv()},8e3)}function cv(_){if(!_)return;const m=ze.value.find(k=>k.id===_);if(!m){console.warn("Événement non trouvé dans la liste des événements"),setTimeout(()=>{const k=ze.value.find(ee=>ee.id===_);k?vf(_,k):console.error("Événement toujours introuvable après retry")},500);return}vf(_,m)}St(ze,_=>{try{const m=new URLSearchParams(window.location.search),k=m.get("modal"),ee=m.get("event");if(!k||!ee)return;const ie=_.find(ye=>ye.id===ee);if(!ie)return;k==="announce"&&zc(ie),k==="selection"&&vo(ie)}catch{}},{immediate:!0});async function kT(_){if(!_)return;if(await new Promise(k=>setTimeout(k,100)),window.innerWidth<=768){const k=dr.value;if(k){const ee=_.offsetLeft,ie=_.offsetWidth,ye=k.clientWidth,pe=ee-ye/2+ie/2,Ve=k.scrollWidth-ye,He=Math.max(0,Math.min(pe,Ve));k.scrollTo({left:He,behavior:"smooth"}),setTimeout(()=>{const Xe=_.getBoundingClientRect();if(Xe.left<0||Xe.right>window.innerWidth){const vt=ee-20;k.scrollTo({left:Math.max(0,vt),behavior:"smooth"})}},500)}}else _.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const m=dr.value;m&&setTimeout(()=>{const k=document.querySelector(`[data-event-id="${Dn.value}"]`);if(k&&k.closest("tbody")){const ee=k.offsetLeft,ie=k.offsetWidth,ye=m.clientWidth,pe=ee-ye/2+ie/2,Ve=m.scrollWidth-ye,He=Math.max(0,Math.min(pe,Ve));m.scrollTo({left:He,behavior:"smooth"})}},300)}function dv(){Yi.value&&(clearTimeout(Yi.value),Yi.value=null),Dn.value=null,Dl.value=!1,document.querySelectorAll(".focused-event-highlight").forEach(_=>{_.classList.remove("focused-event-highlight")}),document.querySelectorAll(".focused-event-column-start, .focused-event-column-end").forEach(_=>{_.classList.remove("focused-event-column-start","focused-event-column-end")})}return(_,m)=>{var k,ee,ie,ye,pe,Ve,He,Xe,vt,Qt,ln,un,yt,mr,Lr,yo,_a,hv,fv,pv,mv,gv,vv,yv;return N(),V(ct,null,[d("div",Z6,[d("div",e5,[d("button",{onClick:_T,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour aux saisons"},m[77]||(m[77]=[d("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),d("h1",t5,le(i.value?i.value:"Chargement..."),1),d("div",n5,[d("div",r5,[d("button",{onClick:Js,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Mon compte","aria-label":"Mon compte"},m[78]||(m[78]=[d("span",{class:"text-2xl"},"👤",-1)])),d("button",{onClick:m[0]||(m[0]=H=>Ji.value=!0),class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Kezako ?","aria-label":"Kezako ?"},m[79]||(m[79]=[d("span",{class:"text-2xl"},"❓",-1)]))]),d("div",{class:"relative md:hidden",ref_key:"headerMenuRef",ref:Vr},[d("button",{onClick:m[1]||(m[1]=gt(H=>{Nc(),ti()},["stop"])),class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Menu","aria-label":"Menu"},m[80]||(m[80]=[d("span",{class:"text-2xl"},"⋯",-1)]))],512),(N(),ko(fu,{to:"body"},[Hr.value?(N(),V("div",{key:0,ref_key:"headerMenuDropdownRef",ref:Ir,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:gr(eo.value)},[d("button",{onClick:m[2]||(m[2]=H=>{Js(),Et()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[81]||(m[81]=[d("span",null,"👤",-1),d("span",{class:"text-sm"},"Mon compte",-1)])),d("button",{onClick:m[3]||(m[3]=H=>{Ji.value=!0,Et()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[82]||(m[82]=[d("span",null,"❓",-1),d("span",{class:"text-sm"},"Kezako ?",-1)]))],4)):_e("",!0)]))])],512),d("div",s5,[d("div",{ref_key:"headerBarRef",ref:Cc,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[d("div",i5,[ze.value.length===0&&Fe.value.length===0?_e("",!0):(N(),V("div",o5,[d("div",{class:"flex items-center justify-center h-full gap-2"},[d("button",{onClick:$l,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel événement"},m[83]||(m[83]=[d("span",{class:"text-lg"},"➕",-1),d("span",{class:"hidden sm:inline"},"Ajouter un événement",-1),d("span",{class:"sm:hidden"},"Événement",-1)]))])])),d("div",a5,[d("div",{ref_key:"headerEventsRef",ref:Nn,class:"flex relative z-[60]",style:gr({transform:`translateX(-${Xs.value}px)`})},[(N(!0),V(ct,null,Ar(fr.value,H=>(N(),V("div",{key:"h-"+H.id,"data-event-id":H.id,class:Ot(["col-event flex-shrink-0 p-3 text-center flex flex-col justify-between",{"archived-header":H.archived}])},[d("div",{class:"flex flex-col items-center justify-between p-2 rounded-lg hover:bg-white/10 transition-colors duration-200 cursor-pointer group h-24",title:H.title+" - Cliquez pour voir les détails",onClick:gt(en=>nv(H),["stop"])},[d("div",c5,[d("div",d5,le(H.title||"Sans titre"),1),H.archived?(N(),V("div",h5,"(Archivé)")):_e("",!0)]),d("div",f5,[d("div",{onClick:gt(en=>jt(H.id),["stop"]),class:"header-date text-[16px] md:text-base text-gray-300 group-hover:text-purple-200 transition-colors duration-200 cursor-pointer hover:bg-white/10 px-2 py-1 rounded",title:co(H.date)+" - Cliquez pour ajouter à votre agenda"},le(jc(H.date)),9,p5),xe.value===H.id?(N(),V("div",m5,[d("div",g5,[d("button",{onClick:gt(en=>{ya("google",H),qt()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},m[84]||(m[84]=[d("span",null,"🌐",-1),d("span",null,"Google Calendar",-1)]),8,v5),d("button",{onClick:gt(en=>{ya("outlook",H),qt()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},m[85]||(m[85]=[d("span",null,"📧",-1),d("span",null,"Outlook",-1)]),8,y5),d("button",{onClick:gt(en=>{ya("ics",H),qt()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Télécharger un fichier .ics compatible avec tous les agendas"},m[86]||(m[86]=[d("span",null,"📥",-1),d("span",null,"Télécharger (.ics)",-1)]),8,_5)])])):_e("",!0)])],8,u5),d("div",b5,[H.archived?(N(),V("div",w5,m[87]||(m[87]=[d("span",{class:"text-xs text-gray-300 font-medium"},"📁",-1),d("span",{class:"text-xs text-gray-200 font-medium ml-1"},"Archivé",-1)]))):go(H.id).type==="ready"?(N(),V("div",{key:1,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-blue-500/30 transition-colors duration-200 cursor-pointer group",title:Bl(H.id)+" - Cliquez pour ouvrir la sélection",onClick:gt(en=>vo(H),["stop"])},m[88]||(m[88]=[d("span",{class:"text-xs text-blue-300 font-medium group-hover:text-blue-200"},"🆕",-1),d("span",{class:"text-xs text-blue-200 font-medium ml-1 group-hover:text-blue-100"},"Nouveau",-1)]),8,x5)):go(H.id).type==="complete"?(N(),V("div",{key:2,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-green-500/30 transition-colors duration-200 cursor-pointer group",title:Bl(H.id)+" - Cliquez pour ouvrir la sélection",onClick:gt(en=>vo(H),["stop"])},m[89]||(m[89]=[d("span",{class:"text-xs text-green-300 font-medium group-hover:text-green-200"},"✅",-1),d("span",{class:"text-xs text-green-200 font-medium ml-1 group-hover:text-green-100"},"Complet",-1)]),8,I5)):go(H.id).type==="incomplete"?(N(),V("div",{key:3,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-orange-500/30 transition-colors duration-200 cursor-pointer group",title:Bl(H.id)+" - Cliquez pour ouvrir la sélection",onClick:gt(en=>vo(H),["stop"])},m[90]||(m[90]=[d("span",{class:"text-xs text-orange-300 font-medium group-hover:text-orange-200"},"⚠️",-1),d("span",{class:"text-xs text-orange-200 font-medium ml-1 group-hover:text-orange-100"},"À finaliser",-1)]),8,E5)):go(H.id).type==="insufficient"?(N(),V("div",{key:4,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-red-500/30 transition-colors duration-200 cursor-pointer group",title:Bl(H.id)+" - Cliquez pour ouvrir la sélection",onClick:gt(en=>vo(H),["stop"])},m[91]||(m[91]=[d("span",{class:"text-xs text-red-300 font-medium group-hover:text-red-200"},"❌",-1),d("span",{class:"text-xs text-red-200 font-medium ml-1 group-hover:text-red-100"},"Manque",-1)]),8,T5)):_e("",!0)])],10,l5))),128))],4)]),m[94]||(m[94]=d("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),d("button",{onClick:ao,class:"absolute right-2 top-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[86] backdrop-blur-sm",title:bs.value?"Masquer les événements archivés":"Afficher les événements archivés","aria-label":bs.value?"Masquer les événements archivés":"Afficher les événements archivés"},[(N(),V("svg",S5,[m[92]||(m[92]=d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.25 12c1.5-4 5.25-7.5 9.75-7.5S20.25 8 21.75 12c-1.5 4-5.25 7.5-9.75 7.5S3.75 16 2.25 12z"},null,-1)),m[93]||(m[93]=d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)),bs.value?_e("",!0):(N(),V("path",P5))]))],8,A5),tt(d("button",{onClick:m[4]||(m[4]=gt(H=>aa(-1,H),["prevent"])),onMousedown:m[5]||(m[5]=gt(H=>Zi(-1,H),["prevent"])),onMouseup:m[6]||(m[6]=H=>xr(H)),onMouseleave:m[7]||(m[7]=H=>xr(H)),onTouchstart:m[8]||(m[8]=gt(H=>Zi(-1,H),["prevent"])),onTouchend:m[9]||(m[9]=H=>xr(H)),onTouchcancel:m[10]||(m[10]=H=>xr(H)),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements précédents — cliquez pour défiler"}," ‹ ",544),[[Af,Vl.value]]),tt(d("button",{onClick:m[11]||(m[11]=gt(H=>aa(1,H),["prevent"])),onMousedown:m[12]||(m[12]=gt(H=>Zi(1,H),["prevent"])),onMouseup:m[13]||(m[13]=H=>xr(H)),onMouseleave:m[14]||(m[14]=H=>xr(H)),onTouchstart:m[15]||(m[15]=gt(H=>Zi(1,H),["prevent"])),onTouchend:m[16]||(m[16]=H=>xr(H)),onTouchcancel:m[17]||(m[17]=H=>xr(H)),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements suivants — cliquez pour défiler"}," › ",544),[[Af,Rc.value]])])],512),tt(d("div",{ref_key:"gridboardRef",ref:dr,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[Xt.value===1?(N(),V("div",R5,[$.value.position?(N(),V("div",{key:0,class:"fixed z-[400]",style:gr({left:$.value.position.x+"px",top:$.value.position.y+"px"})},[d("div",{id:"coachmark-add",class:Ot(["coachmark pointer-events-auto max-w-sm bg-gray-900 border border-purple-500/40 rounded-xl shadow-2xl p-3 text-white relative",{"coachmark-right":$.value.side==="right","coachmark-left":$.value.side==="left"}])},[m[96]||(m[96]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ajoutez votre nom",-1)),m[97]||(m[97]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},'Cliquez sur "Ajouter un joueur" pour vous inscrire',-1)),d("div",C5,[m[95]||(m[95]=d("span",{class:"text-purple-300 text-base md:text-sm"},"Étape 1/4",-1)),d("button",{onClick:m[18]||(m[18]=H=>uo(0)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant >")])],2)],4)):_e("",!0)])):_e("",!0),Xt.value===2&&j.value&&B.value?(N(),V("div",k5,[z.value.position?(N(),V("div",{key:0,class:"fixed z-[400]",style:gr({position:"absolute",left:z.value.position.x+"px",top:z.value.position.y+"px"})},[d("div",D5,[m[99]||(m[99]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Indiquez vos disponibilités",-1)),m[100]||(m[100]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez cette case pour alterner Oui / Non / Vide",-1)),d("div",N5,[m[98]||(m[98]=d("span",{class:"text-pink-300 text-base md:text-sm"},"Étape 2/4",-1)),d("button",{onClick:m[19]||(m[19]=H=>uo(1)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):_e("",!0)])):_e("",!0),Xt.value===3&&j.value?(N(),V("div",V5,[he.value.position?(N(),V("div",{key:0,class:"fixed z-[400]",style:gr({position:"absolute",left:he.value.position.x+"px",top:he.value.position.y+"px"})},[d("div",O5,[m[102]||(m[102]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ouvrez votre fiche",-1)),m[103]||(m[103]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez sur votre nom pour voir les détails et la protection",-1)),d("div",M5,[m[101]||(m[101]=d("span",{class:"text-yellow-300 text-base md:text-sm"},"Étape 3/4",-1)),d("button",{onClick:m[20]||(m[20]=H=>uo(2)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):_e("",!0)])):_e("",!0),d("table",L5,[d("colgroup",null,[m[104]||(m[104]=d("col",{class:"col-left"},null,-1)),(N(!0),V(ct,null,Ar(fr.value,(H,en)=>(N(),V("col",{key:"c"+en,class:"col-event"}))),128)),m[105]||(m[105]=d("col",{class:"col-right"},null,-1))]),m[109]||(m[109]=d("thead",{class:"hidden"},null,-1)),d("tbody",null,[(N(!0),V(ct,null,Ar(Or.value,H=>{var en;return N(),V("tr",{key:H.id,class:Ot(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":H.id===P.value,"preferred-player":Xr.value.has(H.id)}]),"data-player-id":H.id},[d("td",F5,[d("div",U5,[Xr.value.has(H.id)?(N(),V("span",j5," ⭐ ")):no(H.id)?(N(),V("span",q5," 🔒 ")):_e("",!0),d("div",{onClick:rr=>pf(H),class:Ot(["player-name hover:bg-white/10 rounded-lg p-2 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight block truncate max-w-full flex-1 min-w-0 group",{"inline-block rounded px-1 ring-2 ring-yellow-400 animate-pulse":Xt.value===3&&H.id===(j.value||((en=Or.value[0])==null?void 0:en.id))}]),title:"Cliquez pour voir les détails : "+H.name},[d("span",z5,le(H.name),1)],10,B5)])]),(N(!0),V(ct,null,Ar(fr.value,rr=>{var _v,bv,wv;return N(),V("td",{key:rr.id,"data-event-id":rr.id,class:Ot(["p-0",rr.archived?"archived-col":"",{"relative ring-2 ring-pink-400 rounded-md animate-pulse":Xt.value===2&&H.id===(j.value||((_v=Or.value[0])==null?void 0:_v.id))&&rr.id===(B.value||((bv=fr.value[0])==null?void 0:bv.id))}])},[nt(E_,{"player-name":H.name,"event-id":rr.id,"is-available":En(H.name,rr.id),"is-selected":Fc(H.name,rr.id),"chance-percent":((wv=ca.value[H.name])==null?void 0:wv[rr.id])??null,"show-selected-chance":jl(rr.id),disabled:rr.archived===!0,onToggle:fa},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])],10,K5)}),128)),m[106]||(m[106]=d("td",{class:"p-3 md:p-4"},null,-1))],10,$5)}),128)),d("tr",G5,[d("td",H5,[d("div",W5,[d("button",{onClick:m[21]||(m[21]=H=>I.value=!0),class:"w-full md:w-auto flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur","data-onboarding":"add-player"},m[107]||(m[107]=[d("span",{class:"text-lg"},"➕",-1),d("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),d("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(N(!0),V(ct,null,Ar(fr.value,H=>(N(),V("td",{key:"add-row-"+H.id,"data-event-id":H.id,class:Ot(["p-3 md:p-5",H.archived?"archived-col":""])},null,10,Q5))),128)),m[108]||(m[108]=d("td",{class:"p-3 md:p-4"},null,-1))])])])],512),[[Af,!zr.value]])])]),zr.value?(N(),V("div",J5,[d("div",Y5,[m[110]||(m[110]=d("div",{class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"},[d("span",{class:"text-3xl"},"🎭")],-1)),d("p",X5,le(Nr.value)+"…",1),d("div",Z5,[d("div",{class:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-300",style:gr({width:wr.value+"%"})},null,4)]),d("p",eU,le(wr.value)+"%",1)])])):_e("",!0),zr.value?_e("",!0):(N(),ko(X6,{key:1,"season-id":o.value,"season-slug":is(s),"players-count":Fe.value.length,"events-count":ze.value.length,"onboarding-done":((k=a.value)==null?void 0:k.onboardingCreatorDone)===!0,onCreateEvent:$l,onAddPlayer:m[22]||(m[22]=()=>{I.value=!0}),onCopyLink:Qr,onDismissed:uf},null,8,["season-id","season-slug","players-count","events-count","onboarding-done"])),_e("",!0),$e.value?(N(),V("div",tU,[d("div",nU,[m[111]||(m[111]=d("span",{class:"text-xl"},"✨",-1)),d("span",null,le(lt.value),1)])])):_e("",!0),hr.value?(N(),V("div",rU,[d("div",sU,[m[112]||(m[112]=d("span",{class:"text-xl"},"⚠️",-1)),d("span",null,le(Er.value),1)])])):_e("",!0),ua.value?(N(),V("div",iU,[d("div",oU,[m[118]||(m[118]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvel événement",-1)),d("div",aU,[m[113]||(m[113]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),tt(d("input",{"onUpdate:modelValue":m[23]||(m[23]=H=>Yn.value=H),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'événement"},null,512),[[Vt,Yn.value]])]),d("div",lU,[m[114]||(m[114]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),tt(d("input",{"onUpdate:modelValue":m[24]||(m[24]=H=>ri.value=H),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[Vt,ri.value]])]),d("div",uU,[m[115]||(m[115]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),tt(d("textarea",{"onUpdate:modelValue":m[25]||(m[25]=H=>so.value=H),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)"},null,512),[[Vt,so.value]])]),d("div",cU,[tt(d("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":m[26]||(m[26]=H=>_s.value=H),class:"w-4 h-4"},null,512),[[xi,_s.value]]),m[116]||(m[116]=d("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Créer comme archivé",-1))]),d("div",dU,[m[117]||(m[117]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),tt(d("input",{"onUpdate:modelValue":m[27]||(m[27]=H=>Yr.value=H),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[Vt,Yr.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:oo,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:Mc,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):_e("",!0),I.value?(N(),V("div",hU,[d("div",fU,[m[120]||(m[120]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau joueur",-1)),d("div",pU,[m[119]||(m[119]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),tt(d("input",{"onUpdate:modelValue":m[28]||(m[28]=H=>A.value=H),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[Vt,A.value]])]),d("div",mU,[d("button",{onClick:m[29]||(m[29]=H=>I.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:hf,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):_e("",!0),l.value?(N(),V("div",gU,[d("div",vU,[m[121]||(m[121]=Ln('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cet événement ?</p></div>',1)),d("div",yU,[d("button",{onClick:Oc,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:m[30]||(m[30]=()=>Vc()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):_e("",!0),mo.value?(N(),V("div",_U,[d("div",bU,[m[122]||(m[122]=Ln('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce joueur ?</p></div>',1)),d("div",wU,[d("button",{onClick:u,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{onClick:m[31]||(m[31]=()=>si()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):_e("",!0),ve.value?(N(),V("div",xU,[d("div",IU,[d("div",EU,[m[123]||(m[123]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🎭")],-1)),m[124]||(m[124]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),d("p",TU,[T.value&&mt.value[T.value]&&mt.value[T.value].every(H=>En(H,T.value))?(N(),V("span",AU,"Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.")):(N(),V("span",SU,"La sélection sera mise à jour : les joueurs disponibles seront conservés, les slots vides seront complétés."))])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:b,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{onClick:v,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):_e("",!0),C.value?(N(),V("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:ff},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:m[45]||(m[45]=gt(()=>{},["stop"]))},[d("div",PU,[d("button",{onClick:ff,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",RU,[m[130]||(m[130]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),d("div",CU,[d("div",kU,[d("h2",DU,le((ee=M.value)==null?void 0:ee.title),1),d("div",NU,[m[125]||(m[125]=d("span",{class:"text-blue-300"},"👥",-1)),d("span",VU,le(((ie=M.value)==null?void 0:ie.playerCount)||6)+" joueurs",1)])]),d("div",OU,[d("p",MU,le(co((ye=M.value)==null?void 0:ye.date)),1),d("div",LU,[d("button",{onClick:m[32]||(m[32]=H=>Rt()),class:"px-3 py-1.5 hover:bg-white/20 rounded text-purple-300 hover:text-green-400 transition-colors duration-200 text-sm flex items-center gap-2 border border-purple-500/30",title:"Ajouter à votre agenda"},m[126]||(m[126]=[d("span",null,"📅",-1),d("span",null,"Agenda",-1)])),Oe.value?(N(),V("div",$U,[d("div",FU,[d("button",{onClick:m[33]||(m[33]=H=>{ya("google"),kn()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},m[127]||(m[127]=[d("span",null,"🌐",-1),d("span",null,"Google Calendar",-1)])),d("button",{onClick:m[34]||(m[34]=H=>{ya("outlook"),kn()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},m[128]||(m[128]=[d("span",null,"📧",-1),d("span",null,"Outlook",-1)])),d("button",{onClick:m[35]||(m[35]=H=>{ya("ics"),kn()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Télécharger un fichier .ics compatible avec tous les agendas"},m[129]||(m[129]=[d("span",null,"📥",-1),d("span",null,"Télécharger (.ics)",-1)]))])])):_e("",!0)])]),(pe=M.value)!=null&&pe.description?(N(),V("div",UU,le(M.value.description),1)):_e("",!0)])])]),d("div",jU,[d("div",qU,[d("div",BU,[d("div",zU,le(Tr((Ve=M.value)==null?void 0:Ve.id)),1),m[131]||(m[131]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),d("div",KU,[d("div",GU,le(ho((He=M.value)==null?void 0:He.id)),1),m[132]||(m[132]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),d("div",HU,[d("div",WU,le(Math.max((((Xe=M.value)==null?void 0:Xe.playerCount)||6)-ho((vt=M.value)==null?void 0:vt.id),0)),1),m[133]||(m[133]=d("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))])]),M.value?(N(),V("div",QU,[d("div",JU,[$c.value?(N(),V("div",{key:0,class:Ot(["flex items-center gap-2 px-2 py-1 rounded-md border text-[11px] md:text-xs max-w-[70%] truncate",((Qt=ha.value)==null?void 0:Qt.type)==="incomplete"?"bg-yellow-500/10 border-yellow-500/30 text-yellow-200":"bg-orange-500/10 border-orange-500/30 text-orange-200"]),title:lo.value},[m[134]||(m[134]=d("span",null,"⚠️",-1)),d("span",XU,le(lo.value),1)],10,YU)):_e("",!0),tt(d("select",{"onUpdate:modelValue":m[36]||(m[36]=H=>da.value=H),class:"ml-auto bg-gray-800 text-white rounded-md px-3 py-2 border border-white/10 focus:outline-none text-sm",title:"Filtrer les joueurs par statut"},m[135]||(m[135]=[Ln('<option value="selected">Sélectionnés</option><option value="available">Disponibles</option><option value="unavailable">Non Disponibles</option><option value="unknown">Pas de réponse</option><option value="all">Tous</option>',5)]),512),[[z1,da.value]])]),d("div",ZU,[(N(!0),V(ct,null,Ar(Ul.value,H=>{var en,rr;return N(),V("div",{key:H.id,class:"flex items-center justify-between px-2 py-1.5 rounded-md hover:bg-gray-800/40 transition-colors"},[d("div",ej,[Xr.value.has(H.id)?(N(),V("span",tj," ⭐ ")):no(H.id)?(N(),V("span",nj," 🔒 ")):_e("",!0),d("span",{class:"text-white text-sm md:text-base block truncate max-w-full flex-1 min-w-0",title:H.name},le(H.name),9,rj)]),d("div",sj,[nt(E_,{"player-name":H.name,"event-id":M.value.id,"is-available":gf(M.value.id)[H.name],"is-selected":wT(H.name,M.value.id),"chance-percent":((en=ca.value[H.name])==null?void 0:en[M.value.id])??null,"show-selected-chance":jl(M.value.id),disabled:((rr=M.value)==null?void 0:rr.archived)===!0,compact:!0,onToggle:bT},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])])])}),128))])])):_e("",!0),d("div",ij,[d("button",{onClick:m[37]||(m[37]=H=>vo(M.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},m[136]||(m[136]=[d("span",null,"🎭",-1),d("span",null,"Sélectionner",-1)])),d("button",{onClick:m[38]||(m[38]=H=>zc(M.value)),disabled:(ln=M.value)==null?void 0:ln.archived,class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(un=M.value)!=null&&un.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[137]||(m[137]=[d("span",null,"📢",-1),d("span",null,"Annoncer",-1)]),8,oj),d("div",{class:"relative",ref_key:"eventMoreActionsRef",ref:U},[d("button",{onClick:m[39]||(m[39]=H=>et()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},m[138]||(m[138]=[d("span",null,"⋯",-1),d("span",null,"Plus",-1)]))],512),d("button",{onClick:rv,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),(N(),ko(fu,{to:"body"},[be.value?(N(),V("div",{key:0,ref_key:"eventMoreActionsDropdownRef",ref:O,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:gr(Q.value)},[d("button",{onClick:m[40]||(m[40]=H=>{sv(),be.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},m[139]||(m[139]=[d("span",null,"✏️",-1),d("span",null,"Modifier",-1)])),d("button",{onClick:m[41]||(m[41]=H=>{iv(),be.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10",title:(yt=M.value)!=null&&yt.archived?"Désarchiver cet événement":"Archiver cet événement"},[d("span",null,le((mr=M.value)!=null&&mr.archived?"📂":"📁"),1),d("span",null,le((Lr=M.value)!=null&&Lr.archived?"Désarchiver":"Archiver"),1)],8,aj),d("button",{onClick:m[42]||(m[42]=H=>{var en;Ll((en=M.value)==null?void 0:en.id),be.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[140]||(m[140]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):_e("",!0)]))])]),d("div",lj,[d("button",{onClick:m[43]||(m[43]=H=>vo(M.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélectionner"),d("button",{onClick:rv,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),d("button",{onClick:m[44]||(m[44]=H=>on()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):_e("",!0),(N(),ko(fu,{to:"body"},[ae.value?(N(),V("div",{key:0,ref_key:"eventMoreActionsMobileDropdownRef",ref:ce,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:gr(fe.value)},[d("button",{onClick:m[46]||(m[46]=H=>{zc(M.value),ae.value=!1}),disabled:(yo=M.value)==null?void 0:yo.archived,class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10 disabled:opacity-50 disabled:cursor-not-allowed",title:(_a=M.value)!=null&&_a.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[141]||(m[141]=[d("span",null,"📢",-1),d("span",null,"Annoncer",-1)]),8,uj),d("button",{onClick:m[47]||(m[47]=H=>{sv(),ae.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},m[142]||(m[142]=[d("span",null,"✏️",-1),d("span",null,"Modifier",-1)])),d("button",{onClick:m[48]||(m[48]=H=>{iv(),ae.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},[d("span",null,le((hv=M.value)!=null&&hv.archived?"📂":"📁"),1),d("span",null,le((fv=M.value)!=null&&fv.archived?"Désarchiver":"Archiver"),1)]),d("button",{onClick:m[49]||(m[49]=H=>{var en;Ll((en=M.value)==null?void 0:en.id),ae.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[143]||(m[143]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):_e("",!0)])),nt(tv,{show:ur.value,player:Dt.value,seasonId:o.value,onClose:m[50]||(m[50]=H=>ur.value=!1),onVerified:xT},null,8,["show","player","seasonId"]),h.value?(N(),V("div",cj,[d("div",dj,[m[149]||(m[149]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier l'événement",-1)),d("div",hj,[m[144]||(m[144]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),tt(d("input",{"onUpdate:modelValue":m[51]||(m[51]=H=>f.value=H),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Bn(ro,["esc"]),Bn(Jr,["enter"])],ref:"editTitleInput"},null,544),[[Vt,f.value]])]),d("div",fj,[m[145]||(m[145]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),tt(d("input",{"onUpdate:modelValue":m[52]||(m[52]=H=>g.value=H),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[Bn(ro,["esc"]),Bn(Jr,["enter"])]},null,544),[[Vt,g.value]])]),d("div",pj,[m[146]||(m[146]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),tt(d("textarea",{"onUpdate:modelValue":m[53]||(m[53]=H=>ue.value=H),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)",onKeydown:Bn(ro,["esc"])},null,544),[[Vt,ue.value]])]),d("div",mj,[tt(d("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":m[54]||(m[54]=H=>re.value=H),class:"w-4 h-4"},null,512),[[xi,re.value]]),m[147]||(m[147]=d("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver cet événement",-1))]),d("div",gj,[m[148]||(m[148]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),tt(d("input",{"onUpdate:modelValue":m[55]||(m[55]=H=>y.value=H),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:Bn(ro,["esc"])},null,544),[[Vt,y.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:ro,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:Jr,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):_e("",!0),nt(xE,{show:L.value,message:K(),error:R.value,"session-info":ql(),onSubmit:Tt,onCancel:_n},null,8,["show","message","error","session-info"]),ft.value?(N(),V("div",vj,[d("div",yj,[m[151]||(m[151]=Ln('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protégé par mot de passe</p></div>',1)),d("div",_j,[d("div",bj,[d("div",null,[m[150]||(m[150]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),tt(d("input",{"onUpdate:modelValue":m[56]||(m[56]=H=>F.value=H),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[57]||(m[57]=Bn(H=>ut(F.value),["enter"])),ref_key:"playerPasswordInputRef",ref:se},null,544),[[Vt,F.value]])])]),d("button",{onClick:m[58]||(m[58]=H=>ut(F.value)),disabled:!F.value||W.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[W.value?(N(),V("span",xj,"⏳")):(N(),V("span",Ij,"🔓")),d("span",null,le(W.value?"Vérification...":"Vérifier et supprimer"),1)],8,wj)]),d("div",Ej,[d("button",{onClick:m[59]||(m[59]=H=>De.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),ne.value?(N(),V("div",Tj,[d("div",Aj,le(ne.value),1)])):_e("",!0),d("div",{class:"flex justify-center"},[d("button",{onClick:Tn,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):_e("",!0),Pe.value?(N(),V("div",Sj,[d("div",Pj,[m[154]||(m[154]=Ln('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protégé par mot de passe</p></div>',1)),d("div",Rj,[d("div",Cj,[d("div",null,[m[152]||(m[152]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),tt(d("input",{"onUpdate:modelValue":m[60]||(m[60]=H=>Ee.value=H),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[61]||(m[61]=Bn(H=>bn(Ee.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:pt},null,544),[[Vt,Ee.value]])])]),d("div",kj,[d("button",{onClick:m[62]||(m[62]=H=>It.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),J.value?(N(),V("div",Dj,[d("div",Nj,le(J.value),1)])):_e("",!0)]),d("div",Vj,[d("button",{onClick:ii,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),d("button",{onClick:m[63]||(m[63]=H=>bn(Ee.value)),disabled:!Ee.value||Ge.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[Ge.value?(N(),V("span",Mj,"⏳")):(N(),V("span",Lj,"🔓")),d("span",null,[zt(le(Ge.value?"Vérification...":"Vérifier"),1),m[153]||(m[153]=d("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,Oj)])])])):_e("",!0),It.value?(N(),V("div",{key:14,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[66]||(m[66]=H=>It.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[65]||(m[65]=gt(()=>{},["stop"]))},[m[156]||(m[156]=Ln('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),d("div",$j,[m[155]||(m[155]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),d("button",{onClick:pr,disabled:Z.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[Z.value?(N(),V("span",Uj,"⏳")):(N(),V("span",jj,"📧")),d("span",null,le(Z.value?"Envoi...":"Envoyer l'email"),1)],8,Fj)]),Ae.value?(N(),V("div",qj,[d("div",Bj,le(Ae.value),1)])):_e("",!0),we.value?(N(),V("div",zj,[d("div",Kj,le(we.value),1)])):_e("",!0),d("div",Gj,[d("button",{onClick:m[64]||(m[64]=H=>It.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):_e("",!0),De.value?(N(),V("div",{key:15,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[69]||(m[69]=H=>De.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[68]||(m[68]=gt(()=>{},["stop"]))},[m[158]||(m[158]=Ln('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p></div>',1)),d("div",Hj,[m[157]||(m[157]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),d("button",{onClick:va,disabled:We.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[We.value?(N(),V("span",Qj,"⏳")):(N(),V("span",Jj,"📧")),d("span",null,le(We.value?"Envoi...":"Envoyer l'email"),1)],8,Wj)]),at.value?(N(),V("div",Yj,[d("div",Xj,le(at.value),1)])):_e("",!0),x.value?(N(),V("div",Zj,[d("div",eq,le(x.value),1)])):_e("",!0),d("div",tq,[d("button",{onClick:m[67]||(m[67]=H=>De.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):_e("",!0),nt(WF,{ref_key:"playerModalRef",ref:D,show:w.value,player:E.value,stats:TT(E.value),seasonId:o.value,"onboarding-step":Xt.value,"onboarding-player-id":j.value,"is-protected":E.value?cr.value.has(E.value.id):!1,"is-preferred":E.value?Xr.value.has(E.value.id):!1,onClose:ov,onUpdate:IT,onDelete:p,onRefresh:ET,onAdvanceOnboarding:m[70]||(m[70]=H=>{try{typeof Xt.value<"u"&&(Xt.value.value=H)}catch{}})},null,8,["show","player","stats","seasonId","onboarding-step","onboarding-player-id","is-protected","is-preferred"]),nt(F6,{ref_key:"selectionModalRef",ref:ms,show:Br.value,event:yn.value,"current-selection":mt.value[(pv=yn.value)==null?void 0:pv.id]||[],"available-count":Tr((mv=yn.value)==null?void 0:mv.id),"selected-count":ho((gv=yn.value)==null?void 0:gv.id),"player-availability":gf((vv=yn.value)==null?void 0:vv.id),"season-id":o.value,"season-slug":is(s),players:ys.value,onClose:uv,onSelection:PT,onPerfect:RT,onSendNotifications:lv,onUpdateSelection:CT},null,8,["show","event","current-selection","available-count","selected-count","player-availability","season-id","season-slug","players"]),nt(gT,{show:Wi.value,event:br.value,"season-id":o.value,"season-slug":is(s),players:ys.value,sending:mf.value,"availability-by-player":gf((yv=br.value)==null?void 0:yv.id),onClose:ST,onSendNotifications:lv},null,8,["show","event","season-id","season-slug","players","sending","availability-by-player"]),nt(S$,{show:Ji.value,onClose:m[71]||(m[71]=H=>Ji.value=!1)},null,8,["show"]),nt(fT,{show:Dr.value,"season-id":o.value,onClose:vs,onManagePlayer:lf,onChangePassword:of,onLogoutDevice:af,onDeleteAccount:Ys},null,8,["show","season-id"]),nt(vT,{show:ia.value,player:kl.value,"season-id":o.value,onClose:m[72]||(m[72]=H=>ia.value=!1),onSuccess:m[73]||(m[73]=()=>{ia.value=!1,Dr.value=!0})},null,8,["show","player","season-id"]),nt(EE,{show:mn.value,onClose:m[74]||(m[74]=H=>mn.value=!1),onSuccess:m[75]||(m[75]=()=>{mn.value=!1,Dr.value=!0})},null,8,["show"]),Qi.value?(N(),V("div",nq,[d("div",rq,[m[159]||(m[159]=d("h3",{class:"text-xl font-bold text-white mb-4 text-center"},"Voulez-vous annoncer cet événement ?",-1)),m[160]||(m[160]=d("p",{class:"text-gray-300 text-center mb-6"},"Envoyer des notifications aux joueurs pour qu'ils indiquent leur disponibilité",-1)),d("div",sq,[d("button",{onClick:m[76]||(m[76]=H=>zc(gs.value)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300"}," 📢 Oui "),d("button",{onClick:av,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300"}," Plus tard ")])])])):_e("",!0)],64)}}},iq={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},oq={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},aq={key:0,class:"text-center py-8"},lq={key:1,class:"text-center py-8"},uq={class:"text-gray-300 mb-6"},cq={key:2,class:"space-y-6"},dq={class:"text-center"},hq={class:"text-gray-300"},fq={class:"font-semibold text-white"},pq={class:"space-y-4"},mq=["disabled"],gq={key:0,class:"animate-spin"},vq={key:1},yq={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},_q={class:"text-red-300 text-sm"},bq={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},wq={class:"text-green-300 text-sm"},xq={__name:"PasswordReset",setup(n){const e=hl(),t=dl(),r=S(!0),s=S(""),i=S(""),o=S(""),a=S(""),l=S(""),c=S(!1),h=S(""),f=S(""),g=je(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);Un(async()=>{try{const{oobCode:A}=e.query;if(oe.debug("Token reçu (masqué)"),!A){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=A,i.value="patrice.lamarque+ron@gmail.com",r.value=!1}catch(A){oe.error("Erreur lors de la vérification du lien",A),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function y(){if(g.value){c.value=!0,h.value="",f.value="";try{oe.debug("Début réinitialisation avec token (masqué)"),await CN(ht,o.value,a.value),oe.info("Mot de passe Firebase Auth mis à jour"),oe.info("Réinitialisation terminée avec Firebase Auth"),f.value="Mot de passe réinitialisé avec succès ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{I()},3e3)}catch(A){oe.error("Erreur lors de la réinitialisation",A),A.code==="auth/weak-password"?h.value="Le mot de passe doit contenir au moins 6 caractères":A.code==="auth/invalid-action-code"?h.value="Lien de réinitialisation invalide ou expiré":h.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{c.value=!1}}}function I(){t.push("/seasons")}return(A,P)=>(N(),V("div",iq,[d("div",oq,[P[8]||(P[8]=Ln('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(N(),V("div",aq,P[2]||(P[2]=[d("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),d("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(N(),V("div",lq,[P[3]||(P[3]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"❌")],-1)),P[4]||(P[4]=d("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),d("p",uq,le(s.value),1),d("button",{onClick:I,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):i.value?(N(),V("div",cq,[d("div",dq,[d("p",hq,[P[5]||(P[5]=zt("Email : ")),d("span",fq,le(i.value),1)])]),d("div",pq,[d("div",null,[P[6]||(P[6]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),tt(d("input",{"onUpdate:modelValue":P[0]||(P[0]=j=>a.value=j),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:Bn(y,["enter"])},null,544),[[Vt,a.value]])]),d("div",null,[P[7]||(P[7]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),tt(d("input",{"onUpdate:modelValue":P[1]||(P[1]=j=>l.value=j),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:Bn(y,["enter"])},null,544),[[Vt,l.value]])])]),d("button",{onClick:y,disabled:!g.value||c.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[c.value?(N(),V("span",gq,"⏳")):(N(),V("span",vq,"🔑")),d("span",null,le(c.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,mq),h.value?(N(),V("div",yq,[d("div",_q,le(h.value),1)])):_e("",!0),f.value?(N(),V("div",bq,[d("div",wq,le(f.value),1)])):_e("",!0)])):_e("",!0)])]))}},Iq={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},Eq={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},Tq={class:"text-3xl"},Aq={class:"text-2xl font-bold text-white mb-2"},Sq={class:"text-gray-300 mb-6"},Pq={__name:"MagicLink",setup(n){const e=hl(),t=dl(),r=S("loading"),s=S("Traitement en cours..."),i=S("Merci de patienter pendant la validation du lien."),o=je(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/seasons")}return Un(async()=>{var l;try{ev("firebase");const c=String(e.query.sid||""),h=String(e.query.pid||"");let f=String(e.query.eid||"");const g=String(e.query.t||""),y=String(e.query.a||""),I=String(e.query.slug||"");if(!g||!y){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants.";return}if(y==="account_email_update"){const z=await PE({token:g});if(!z.valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}try{await MN(ht.currentUser,z.data.newEmail),await RE({token:g}),r.value="ok",s.value="Email mis à jour",i.value="Votre adresse email a été mise à jour avec succès."}catch{r.value="error",s.value="Action impossible",i.value="Veuillez vous reconnecter puis réessayer."}return}if(y==="verify_email"&&(f="protection"),!(await AE({seasonId:c,playerId:h,eventId:f,token:g,action:y})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}if(y==="verify_email"){await NE({playerId:h,seasonId:c});try{await $E({playerId:h,seasonId:c})}catch{}await Gp({seasonId:c,playerId:h,eventId:"protection",action:y}),r.value="ok",s.value="Email vérifié",i.value="Merci ! Vous pouvez maintenant définir votre mot de passe.",setTimeout(I?()=>t.push(`/season/${I}?player=${encodeURIComponent(h)}&verified=1`):()=>t.push("/seasons"),800);return}const P=Re(de,"seasons",c,"players",h),j=await Wt(P),B=j.exists()&&j.data().name||"";if(!B){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}if(await j4({seasonId:c,playerName:B,eventId:f,value:y==="yes"}),y==="no")try{const z=Re(de,"seasons",c,"selections",f),he=await Wt(z);if(he.exists()){const ve=Array.isArray((l=he.data())==null?void 0:l.players)?he.data().players:[],T=ve.filter(w=>w!==B);T.length!==ve.length&&await setDoc(z,{players:T},{merge:!0})}}catch{}await Gp({seasonId:c,playerId:h,eventId:f,action:y}),r.value="ok",s.value="Merci !",i.value=y==="yes"?"Votre disponibilité a été enregistrée: Disponible.":"Votre disponibilité a été enregistrée: Non disponible. (Si vous étiez sélectionné(e), vous avez été retiré(e) de la sélection.)",setTimeout(I?()=>t.push(`/season/${I}/event/${f}`):()=>t.push("/seasons"),1200)}catch(c){oe.error("Magic link error",c),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,c)=>(N(),V("div",Iq,[d("div",Eq,[d("div",{class:Ot(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[d("span",Tq,le(o.value),1)],2),d("h1",Aq,le(s.value),1),d("p",Sq,le(i.value),1),d("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},Rq={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},Cq={class:"text-center py-12 px-4"},kq={class:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},Dq={class:"container mx-auto px-4 pb-16"},Nq={class:"max-w-xl mx-auto bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl"},Vq={class:"space-y-5"},Oq=["onKeydown"],Mq={class:"flex items-center justify-end gap-3 pt-2"},Lq=["disabled"],$q={key:0,class:"mt-6 text-sm text-gray-200"},Fq={__name:"JoinSeason",setup(n){const e=hl(),t=dl(),r=e.params.slug,s=S(""),i=S(""),o=S(""),a=S(!1),l=S("");Un(async()=>{const f=Hu(Je(de,"seasons"),Yd("slug","==",r)),g=await xt(f);if(g.empty)l.value="Saison introuvable";else{const y=g.docs[0];s.value=y.id,i.value=y.data().name,document.title=`Rejoindre : ${i.value}`}});function c(){t.push(`/season/${r}`)}async function h(){if(!(!o.value.trim()||!s.value)){a.value=!0,l.value="";try{await mT(o.value.trim(),s.value),l.value="Inscription réussie. Vous pouvez maintenant indiquer vos disponibilités.";try{localStorage.setItem(`startPlayerTour:${s.value}`,"1"),localStorage.setItem(`dismissCreatorOnboarding:${s.value}`,"1")}catch{}setTimeout(()=>{c()},600)}catch(f){oe.error("Erreur inscription",f),l.value=`Erreur lors de l'inscription: ${(f==null?void 0:f.message)||"Veuillez réessayer"}`}finally{a.value=!1}}}return(f,g)=>(N(),V("div",Rq,[d("div",Cq,[d("h1",kq,le(i.value||"Rejoindre la saison"),1),g[1]||(g[1]=d("p",{class:"text-gray-300"},"Inscrivez-vous pour indiquer vos disponibilités aux événements",-1))]),d("div",Dq,[d("div",Nq,[g[3]||(g[3]=d("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Je rejoins la saison",-1)),d("div",Vq,[d("div",null,[g[2]||(g[2]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Votre nom",-1)),tt(d("input",{"onUpdate:modelValue":g[0]||(g[0]=y=>o.value=y),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: Marie Dupont",onKeydown:Bn(gt(h,["prevent"]),["enter"])},null,40,Oq),[[Vt,o.value]])]),d("div",Mq,[d("button",{onClick:c,class:"px-5 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{disabled:!o.value.trim()||a.value,onClick:h,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Rejoindre ",8,Lq)])]),l.value?(N(),V("div",$q,le(l.value),1)):_e("",!0)])])]))}};{const n=()=>{};console.debug=n,console.log=n,console.info=n}const Uq=[{path:"/",component:jO},{path:"/seasons",component:N3},{path:"/season/:slug",component:T_,props:!0},{path:"/season/:slug/event/:eventId",component:T_,props:!0},{path:"/season/:slug/join",component:Fq,props:!0},{path:"/reset-password",component:xq},{path:"/magic",component:Pq}],jq=nP({history:kS("/"),routes:Uq}),yT=J1(eS);yT.use(jq);yT.mount("#app");oP({immediate:!0,onRegistered(n){window.__swReg=n}});export{Je as $,xI as A,Wo as B,ls as C,fn as D,KB as E,Zo as F,ug as G,zB as H,Gq as I,Cr as J,H2 as K,Q2 as L,Al as M,yB as N,_B as O,bD as P,jn as Q,uB as R,Yq as S,Jt as T,MB as U,Mh as V,vD as W,_D as X,vB as Y,eB as Z,hw as _,zu as a,Ic as a$,Qq as a0,W2 as a1,oD as a2,BB as a3,ul as a4,OB as a5,rB as a6,qB as a7,Re as a8,aB as a9,oB as aA,TB as aB,AB as aC,lB as aD,sD as aE,kB as aF,DB as aG,mD as aH,Hu as aI,lI as aJ,Jq as aK,VB as aL,Hi as aM,nn as aN,FB as aO,qq as aP,bB as aQ,fB as aR,hB as aS,gB as aT,sB as aU,Tl as aV,$B as aW,tB as aX,Yd as aY,bg as aZ,YB as a_,Y2 as aa,Zq as ab,nB as ac,jB as ad,mB as ae,pB as af,Yt as ag,_c as ah,lD as ai,SB as aj,Wt as ak,wB as al,xB as am,xt as an,IB as ao,EB as ap,J2 as aq,UB as ar,LB as as,Xq as at,cB as au,dB as av,iB as aw,PB as ax,CB as ay,RB as az,X2 as b,TN as b$,xc as b0,ZB as b1,Yu as b2,ra as b3,yi as b4,HB as b5,bi as b6,_i as b7,qs as b8,xd as b9,ND as bA,b9 as bB,N9 as bC,H0 as bD,hV as bE,eN as bF,p9 as bG,a9 as bH,AN as bI,E9 as bJ,R9 as bK,D9 as bL,w9 as bM,GN as bN,zN as bO,t9 as bP,xD as bQ,SN as bR,T9 as bS,P9 as bT,k9 as bU,MD as bV,y9 as bW,c9 as bX,RN as bY,o9 as bZ,BN as b_,JB as ba,$o as bb,qa as bc,mO as bd,WB as be,x9 as bf,jp as bg,QB as bh,gO as bi,jg as bj,wi as bk,s9 as bl,KN as bm,nE as bn,pO as bo,sE as bp,kN as bq,CN as br,nN as bs,DN as bt,XB as bu,_9 as bv,u9 as bw,f9 as bx,IO as by,e9 as bz,al as c,Cg as c0,r9 as c1,NN as c2,l9 as c3,I9 as c4,S9 as c5,C9 as c6,HN as c7,n9 as c8,v9 as c9,MN as ca,LN as cb,A9 as cc,h9 as cd,g9 as ce,m9 as cf,d9 as cg,i9 as ch,ea as d,kt as e,ge as f,El as g,vc as h,_d as i,Bh as j,yc as k,jh as l,yg as m,ll as n,qh as o,Do as p,yD as q,rn as r,Uo as s,Ce as t,zq as u,UR as v,Gt as w,GB as x,rt as y,Bq as z};
