(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Ff(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const yt={},Uo=[],ir=()=>{},AI=()=>!1,nd=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),Uf=n=>n.startsWith("onUpdate:"),un=Object.assign,$f=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},PI=Object.prototype.hasOwnProperty,ot=(n,e)=>PI.call(n,e),ke=Array.isArray,$o=n=>tu(n)==="[object Map]",rd=n=>tu(n)==="[object Set]",Vm=n=>tu(n)==="[object Date]",qe=n=>typeof n=="function",Xt=n=>typeof n=="string",Rr=n=>typeof n=="symbol",It=n=>n!==null&&typeof n=="object",Iy=n=>(It(n)||qe(n))&&qe(n.then)&&qe(n.catch),Ey=Object.prototype.toString,tu=n=>Ey.call(n),SI=n=>tu(n).slice(8,-1),Ty=n=>tu(n)==="[object Object]",jf=n=>Xt(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,pl=Ff(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),sd=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},RI=/-(\w)/g,Yn=sd(n=>n.replace(RI,(e,t)=>t?t.toUpperCase():"")),CI=/\B([A-Z])/g,ti=sd(n=>n.replace(CI,"-$1").toLowerCase()),id=sd(n=>n.charAt(0).toUpperCase()+n.slice(1)),ch=sd(n=>n?`on${id(n)}`:""),Us=(n,e)=>!Object.is(n,e),sc=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},qh=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},zh=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let Nm;const od=()=>Nm||(Nm=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Rl(n){if(ke(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=Xt(r)?NI(r):Rl(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(Xt(n)||It(n))return n}const kI=/;(?![^(]*\))/g,DI=/:([^]+)/,VI=/\/\*[^]*?\*\//g;function NI(n){const e={};return n.replace(VI,"").split(kI).forEach(t=>{if(t){const r=t.split(DI);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function qn(n){let e="";if(Xt(n))e=n;else if(ke(n))for(let t=0;t<n.length;t++){const r=qn(n[t]);r&&(e+=r+" ")}else if(It(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const OI="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",MI=Ff(OI);function xy(n){return!!n||n===""}function LI(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=ad(n[r],e[r]);return t}function ad(n,e){if(n===e)return!0;let t=Vm(n),r=Vm(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=Rr(n),r=Rr(e),t||r)return n===e;if(t=ke(n),r=ke(e),t||r)return t&&r?LI(n,e):!1;if(t=It(n),r=It(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),u=e.hasOwnProperty(o);if(a&&!u||!a&&u||!ad(n[o],e[o]))return!1}}return String(n)===String(e)}function Ay(n,e){return n.findIndex(t=>ad(t,e))}const Py=n=>!!(n&&n.__v_isRef===!0),le=n=>Xt(n)?n:n==null?"":ke(n)||It(n)&&(n.toString===Ey||!qe(n.toString))?Py(n)?le(n.value):JSON.stringify(n,Sy,2):String(n),Sy=(n,e)=>Py(e)?Sy(n,e.value):$o(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[dh(r,i)+" =>"]=s,t),{})}:rd(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>dh(t))}:Rr(e)?dh(e):It(e)&&!ke(e)&&!Ty(e)?String(e):e,dh=(n,e="")=>{var t;return Rr(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Vn;class FI{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Vn,!e&&Vn&&(this.index=(Vn.scopes||(Vn.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=Vn;try{return Vn=this,e()}finally{Vn=t}}}on(){++this._on===1&&(this.prevScope=Vn,Vn=this)}off(){this._on>0&&--this._on===0&&(Vn=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function UI(){return Vn}let wt;const hh=new WeakSet;class Ry{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Vn&&Vn.active&&Vn.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,hh.has(this)&&(hh.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||ky(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Om(this),Dy(this);const e=wt,t=or;wt=this,or=!0;try{return this.fn()}finally{Vy(this),wt=e,or=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)zf(e);this.deps=this.depsTail=void 0,Om(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?hh.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Gh(this)&&this.run()}get dirty(){return Gh(this)}}let Cy=0,ml,gl;function ky(n,e=!1){if(n.flags|=8,e){n.next=gl,gl=n;return}n.next=ml,ml=n}function Bf(){Cy++}function qf(){if(--Cy>0)return;if(gl){let e=gl;for(gl=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;ml;){let e=ml;for(ml=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function Dy(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function Vy(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),zf(r),$I(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function Gh(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(Ny(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function Ny(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===Cl)||(n.globalVersion=Cl,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!Gh(n))))return;n.flags|=2;const e=n.dep,t=wt,r=or;wt=n,or=!0;try{Dy(n);const s=n.fn(n._value);(e.version===0||Us(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{wt=t,or=r,Vy(n),n.flags&=-3}}function zf(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)zf(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function $I(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let or=!0;const Oy=[];function Yr(){Oy.push(or),or=!1}function Xr(){const n=Oy.pop();or=n===void 0?!0:n}function Om(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=wt;wt=void 0;try{e()}finally{wt=t}}}let Cl=0;class jI{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Gf{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!wt||!or||wt===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==wt)t=this.activeLink=new jI(wt,this),wt.deps?(t.prevDep=wt.depsTail,wt.depsTail.nextDep=t,wt.depsTail=t):wt.deps=wt.depsTail=t,My(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=wt.depsTail,t.nextDep=void 0,wt.depsTail.nextDep=t,wt.depsTail=t,wt.deps===t&&(wt.deps=r)}return t}trigger(e){this.version++,Cl++,this.notify(e)}notify(e){Bf();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{qf()}}}function My(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)My(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const Kh=new WeakMap,Oi=Symbol(""),Hh=Symbol(""),kl=Symbol("");function _n(n,e,t){if(or&&wt){let r=Kh.get(n);r||Kh.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new Gf),s.map=r,s.key=t),s.track()}}function qr(n,e,t,r,s,i){const o=Kh.get(n);if(!o){Cl++;return}const a=u=>{u&&u.trigger()};if(Bf(),e==="clear")o.forEach(a);else{const u=ke(n),c=u&&jf(t);if(u&&t==="length"){const d=Number(r);o.forEach((f,g)=>{(g==="length"||g===kl||!Rr(g)&&g>=d)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(kl)),e){case"add":u?c&&a(o.get("length")):(a(o.get(Oi)),$o(n)&&a(o.get(Hh)));break;case"delete":u||(a(o.get(Oi)),$o(n)&&a(o.get(Hh)));break;case"set":$o(n)&&a(o.get(Oi));break}}qf()}function Ao(n){const e=it(n);return e===n?e:(_n(e,"iterate",kl),Jn(n)?e:e.map(hn))}function ld(n){return _n(n=it(n),"iterate",kl),n}const BI={__proto__:null,[Symbol.iterator](){return fh(this,Symbol.iterator,hn)},concat(...n){return Ao(this).concat(...n.map(e=>ke(e)?Ao(e):e))},entries(){return fh(this,"entries",n=>(n[1]=hn(n[1]),n))},every(n,e){return $r(this,"every",n,e,void 0,arguments)},filter(n,e){return $r(this,"filter",n,e,t=>t.map(hn),arguments)},find(n,e){return $r(this,"find",n,e,hn,arguments)},findIndex(n,e){return $r(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return $r(this,"findLast",n,e,hn,arguments)},findLastIndex(n,e){return $r(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return $r(this,"forEach",n,e,void 0,arguments)},includes(...n){return ph(this,"includes",n)},indexOf(...n){return ph(this,"indexOf",n)},join(n){return Ao(this).join(n)},lastIndexOf(...n){return ph(this,"lastIndexOf",n)},map(n,e){return $r(this,"map",n,e,void 0,arguments)},pop(){return Ja(this,"pop")},push(...n){return Ja(this,"push",n)},reduce(n,...e){return Mm(this,"reduce",n,e)},reduceRight(n,...e){return Mm(this,"reduceRight",n,e)},shift(){return Ja(this,"shift")},some(n,e){return $r(this,"some",n,e,void 0,arguments)},splice(...n){return Ja(this,"splice",n)},toReversed(){return Ao(this).toReversed()},toSorted(n){return Ao(this).toSorted(n)},toSpliced(...n){return Ao(this).toSpliced(...n)},unshift(...n){return Ja(this,"unshift",n)},values(){return fh(this,"values",hn)}};function fh(n,e,t){const r=ld(n),s=r[e]();return r!==n&&!Jn(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const qI=Array.prototype;function $r(n,e,t,r,s,i){const o=ld(n),a=o!==n&&!Jn(n),u=o[e];if(u!==qI[e]){const f=u.apply(n,i);return a?hn(f):f}let c=t;o!==n&&(a?c=function(f,g){return t.call(this,hn(f),g,n)}:t.length>2&&(c=function(f,g){return t.call(this,f,g,n)}));const d=u.call(o,c,r);return a&&s?s(d):d}function Mm(n,e,t,r){const s=ld(n);let i=t;return s!==n&&(Jn(n)?t.length>3&&(i=function(o,a,u){return t.call(this,o,a,u,n)}):i=function(o,a,u){return t.call(this,o,hn(a),u,n)}),s[e](i,...r)}function ph(n,e,t){const r=it(n);_n(r,"iterate",kl);const s=r[e](...t);return(s===-1||s===!1)&&Wf(t[0])?(t[0]=it(t[0]),r[e](...t)):s}function Ja(n,e,t=[]){Yr(),Bf();const r=it(n)[e].apply(n,t);return qf(),Xr(),r}const zI=Ff("__proto__,__v_isRef,__isVue"),Ly=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Rr));function GI(n){Rr(n)||(n=String(n));const e=it(this);return _n(e,"has",n),e.hasOwnProperty(n)}class Fy{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?tE:By:i?jy:$y).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=ke(e);if(!s){let u;if(o&&(u=BI[t]))return u;if(t==="hasOwnProperty")return GI}const a=Reflect.get(e,t,In(e)?e:r);return(Rr(t)?Ly.has(t):zI(t))||(s||_n(e,"get",t),i)?a:In(a)?o&&jf(t)?a:a.value:It(a)?s?zy(a):ud(a):a}}class Uy extends Fy{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const u=zs(i);if(!Jn(r)&&!zs(r)&&(i=it(i),r=it(r)),!ke(e)&&In(i)&&!In(r))return u?!1:(i.value=r,!0)}const o=ke(e)&&jf(t)?Number(t)<e.length:ot(e,t),a=Reflect.set(e,t,r,In(e)?e:s);return e===it(s)&&(o?Us(r,i)&&qr(e,"set",t,r):qr(e,"add",t,r)),a}deleteProperty(e,t){const r=ot(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&qr(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!Rr(t)||!Ly.has(t))&&_n(e,"has",t),r}ownKeys(e){return _n(e,"iterate",ke(e)?"length":Oi),Reflect.ownKeys(e)}}class KI extends Fy{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const HI=new Uy,WI=new KI,QI=new Uy(!0);const Wh=n=>n,Ku=n=>Reflect.getPrototypeOf(n);function JI(n,e,t){return function(...r){const s=this.__v_raw,i=it(s),o=$o(i),a=n==="entries"||n===Symbol.iterator&&o,u=n==="keys"&&o,c=s[n](...r),d=t?Wh:e?Ec:hn;return!e&&_n(i,"iterate",u?Hh:Oi),{next(){const{value:f,done:g}=c.next();return g?{value:f,done:g}:{value:a?[d(f[0]),d(f[1])]:d(f),done:g}},[Symbol.iterator](){return this}}}}function Hu(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function YI(n,e){const t={get(s){const i=this.__v_raw,o=it(i),a=it(s);n||(Us(s,a)&&_n(o,"get",s),_n(o,"get",a));const{has:u}=Ku(o),c=e?Wh:n?Ec:hn;if(u.call(o,s))return c(i.get(s));if(u.call(o,a))return c(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&_n(it(s),"iterate",Oi),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=it(i),a=it(s);return n||(Us(s,a)&&_n(o,"has",s),_n(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,u=it(a),c=e?Wh:n?Ec:hn;return!n&&_n(u,"iterate",Oi),a.forEach((d,f)=>s.call(i,c(d),c(f),o))}};return un(t,n?{add:Hu("add"),set:Hu("set"),delete:Hu("delete"),clear:Hu("clear")}:{add(s){!e&&!Jn(s)&&!zs(s)&&(s=it(s));const i=it(this);return Ku(i).has.call(i,s)||(i.add(s),qr(i,"add",s,s)),this},set(s,i){!e&&!Jn(i)&&!zs(i)&&(i=it(i));const o=it(this),{has:a,get:u}=Ku(o);let c=a.call(o,s);c||(s=it(s),c=a.call(o,s));const d=u.call(o,s);return o.set(s,i),c?Us(i,d)&&qr(o,"set",s,i):qr(o,"add",s,i),this},delete(s){const i=it(this),{has:o,get:a}=Ku(i);let u=o.call(i,s);u||(s=it(s),u=o.call(i,s)),a&&a.call(i,s);const c=i.delete(s);return u&&qr(i,"delete",s,void 0),c},clear(){const s=it(this),i=s.size!==0,o=s.clear();return i&&qr(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=JI(s,n,e)}),t}function Kf(n,e){const t=YI(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(ot(t,s)&&s in r?t:r,s,i)}const XI={get:Kf(!1,!1)},ZI={get:Kf(!1,!0)},eE={get:Kf(!0,!1)};const $y=new WeakMap,jy=new WeakMap,By=new WeakMap,tE=new WeakMap;function nE(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function rE(n){return n.__v_skip||!Object.isExtensible(n)?0:nE(SI(n))}function ud(n){return zs(n)?n:Hf(n,!1,HI,XI,$y)}function qy(n){return Hf(n,!1,QI,ZI,jy)}function zy(n){return Hf(n,!0,WI,eE,By)}function Hf(n,e,t,r,s){if(!It(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=rE(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function jo(n){return zs(n)?jo(n.__v_raw):!!(n&&n.__v_isReactive)}function zs(n){return!!(n&&n.__v_isReadonly)}function Jn(n){return!!(n&&n.__v_isShallow)}function Wf(n){return n?!!n.__v_raw:!1}function it(n){const e=n&&n.__v_raw;return e?it(e):n}function sE(n){return!ot(n,"__v_skip")&&Object.isExtensible(n)&&qh(n,"__v_skip",!0),n}const hn=n=>It(n)?ud(n):n,Ec=n=>It(n)?zy(n):n;function In(n){return n?n.__v_isRef===!0:!1}function O(n){return Gy(n,!1)}function iE(n){return Gy(n,!0)}function Gy(n,e){return In(n)?n:new oE(n,e)}class oE{constructor(e,t){this.dep=new Gf,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:it(e),this._value=t?e:hn(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||Jn(e)||zs(e);e=r?e:it(e),Us(e,t)&&(this._rawValue=e,this._value=r?e:hn(e),this.dep.trigger())}}function Qr(n){return In(n)?n.value:n}const aE={get:(n,e,t)=>e==="__v_raw"?n:Qr(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return In(s)&&!In(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function Ky(n){return jo(n)?n:new Proxy(n,aE)}class lE{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Gf(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Cl-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&wt!==this)return ky(this,!0),!0}get value(){const e=this.dep.track();return Ny(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function uE(n,e,t=!1){let r,s;return qe(n)?r=n:(r=n.get,s=n.set),new lE(r,s,t)}const Wu={},Tc=new WeakMap;let xi;function cE(n,e=!1,t=xi){if(t){let r=Tc.get(t);r||Tc.set(t,r=[]),r.push(n)}}function dE(n,e,t=yt){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:u}=t,c=z=>s?z:Jn(z)||s===!1||s===0?zr(z,1):zr(z);let d,f,g,_,C=!1,T=!1;if(In(n)?(f=()=>n.value,C=Jn(n)):jo(n)?(f=()=>c(n),C=!0):ke(n)?(T=!0,C=n.some(z=>jo(z)||Jn(z)),f=()=>n.map(z=>{if(In(z))return z.value;if(jo(z))return c(z);if(qe(z))return u?u(z,2):z()})):qe(n)?e?f=u?()=>u(n,2):n:f=()=>{if(g){Yr();try{g()}finally{Xr()}}const z=xi;xi=d;try{return u?u(n,3,[_]):n(_)}finally{xi=z}}:f=ir,e&&s){const z=f,Y=s===!0?1/0:s;f=()=>zr(z(),Y)}const k=UI(),j=()=>{d.stop(),k&&k.active&&$f(k.effects,d)};if(i&&e){const z=e;e=(...Y)=>{z(...Y),j()}}let q=T?new Array(n.length).fill(Wu):Wu;const U=z=>{if(!(!(d.flags&1)||!d.dirty&&!z))if(e){const Y=d.run();if(s||C||(T?Y.some((H,P)=>Us(H,q[P])):Us(Y,q))){g&&g();const H=xi;xi=d;try{const P=[Y,q===Wu?void 0:T&&q[0]===Wu?[]:q,_];q=Y,u?u(e,3,P):e(...P)}finally{xi=H}}}else d.run()};return a&&a(U),d=new Ry(f),d.scheduler=o?()=>o(U,!1):U,_=z=>cE(z,!1,d),g=d.onStop=()=>{const z=Tc.get(d);if(z){if(u)u(z,4);else for(const Y of z)Y();Tc.delete(d)}},e?r?U(!0):q=d.run():o?o(U.bind(null,!0),!0):d.run(),j.pause=d.pause.bind(d),j.resume=d.resume.bind(d),j.stop=j,j}function zr(n,e=1/0,t){if(e<=0||!It(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,In(n))zr(n.value,e,t);else if(ke(n))for(let r=0;r<n.length;r++)zr(n[r],e,t);else if(rd(n)||$o(n))n.forEach(r=>{zr(r,e,t)});else if(Ty(n)){for(const r in n)zr(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&zr(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function nu(n,e,t,r){try{return r?n(...r):n()}catch(s){cd(s,e,t)}}function Cr(n,e,t,r){if(qe(n)){const s=nu(n,e,t,r);return s&&Iy(s)&&s.catch(i=>{cd(i,e,t)}),s}if(ke(n)){const s=[];for(let i=0;i<n.length;i++)s.push(Cr(n[i],e,t,r));return s}}function cd(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||yt;if(e){let a=e.parent;const u=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const d=a.ec;if(d){for(let f=0;f<d.length;f++)if(d[f](n,u,c)===!1)return}a=a.parent}if(i){Yr(),nu(i,null,10,[n,u,c]),Xr();return}}hE(n,t,s,r,o)}function hE(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const Sn=[];let wr=-1;const Bo=[];let Ss=null,Vo=0;const Hy=Promise.resolve();let xc=null;function Bn(n){const e=xc||Hy;return n?e.then(this?n.bind(this):n):e}function fE(n){let e=wr+1,t=Sn.length;for(;e<t;){const r=e+t>>>1,s=Sn[r],i=Dl(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function Qf(n){if(!(n.flags&1)){const e=Dl(n),t=Sn[Sn.length-1];!t||!(n.flags&2)&&e>=Dl(t)?Sn.push(n):Sn.splice(fE(e),0,n),n.flags|=1,Wy()}}function Wy(){xc||(xc=Hy.then(Jy))}function pE(n){ke(n)?Bo.push(...n):Ss&&n.id===-1?Ss.splice(Vo+1,0,n):n.flags&1||(Bo.push(n),n.flags|=1),Wy()}function Lm(n,e,t=wr+1){for(;t<Sn.length;t++){const r=Sn[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;Sn.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function Qy(n){if(Bo.length){const e=[...new Set(Bo)].sort((t,r)=>Dl(t)-Dl(r));if(Bo.length=0,Ss){Ss.push(...e);return}for(Ss=e,Vo=0;Vo<Ss.length;Vo++){const t=Ss[Vo];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Ss=null,Vo=0}}const Dl=n=>n.id==null?n.flags&2?-1:1/0:n.id;function Jy(n){const e=ir;try{for(wr=0;wr<Sn.length;wr++){const t=Sn[wr];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),nu(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;wr<Sn.length;wr++){const t=Sn[wr];t&&(t.flags&=-2)}wr=-1,Sn.length=0,Qy(),xc=null,(Sn.length||Bo.length)&&Jy()}}let zn=null,Yy=null;function Ac(n){const e=zn;return zn=n,Yy=n&&n.type.__scopeId||null,e}function mE(n,e=zn,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&Km(-1);const i=Ac(e);let o;try{o=n(...s)}finally{Ac(i),r._d&&Km(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function lt(n,e){if(zn===null)return n;const t=pd(zn),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,u=yt]=e[s];i&&(qe(i)&&(i={mounted:i,updated:i}),i.deep&&zr(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:u}))}return n}function Ii(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let u=a.dir[r];u&&(Yr(),Cr(u,t,8,[n.el,a,n,e]),Xr())}}const gE=Symbol("_vte"),vE=n=>n.__isTeleport;function Jf(n,e){n.shapeFlag&6&&n.component?(n.transition=e,Jf(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}/*! #__NO_SIDE_EFFECTS__ */function Xy(n,e){return qe(n)?(()=>un({name:n.name},e,{setup:n}))():n}function Zy(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function vl(n,e,t,r,s=!1){if(ke(n)){n.forEach((C,T)=>vl(C,e&&(ke(e)?e[T]:e),t,r,s));return}if(yl(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&vl(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?pd(r.component):r.el,o=s?null:i,{i:a,r:u}=n,c=e&&e.r,d=a.refs===yt?a.refs={}:a.refs,f=a.setupState,g=it(f),_=f===yt?()=>!1:C=>ot(g,C);if(c!=null&&c!==u&&(Xt(c)?(d[c]=null,_(c)&&(f[c]=null)):In(c)&&(c.value=null)),qe(u))nu(u,a,12,[o,d]);else{const C=Xt(u),T=In(u);if(C||T){const k=()=>{if(n.f){const j=C?_(u)?f[u]:d[u]:u.value;s?ke(j)&&$f(j,i):ke(j)?j.includes(i)||j.push(i):C?(d[u]=[i],_(u)&&(f[u]=d[u])):(u.value=[i],n.k&&(d[n.k]=u.value))}else C?(d[u]=o,_(u)&&(f[u]=o)):T&&(u.value=o,n.k&&(d[n.k]=o))};o?(k.id=-1,jn(k,t)):k()}}}od().requestIdleCallback;od().cancelIdleCallback;const yl=n=>!!n.type.__asyncLoader,e_=n=>n.type.__isKeepAlive;function yE(n,e){t_(n,"a",e)}function _E(n,e){t_(n,"da",e)}function t_(n,e,t=bn){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(dd(e,r,t),t){let s=t.parent;for(;s&&s.parent;)e_(s.parent.vnode)&&bE(r,e,t,s),s=s.parent}}function bE(n,e,t,r){const s=dd(e,n,r,!0);Yf(()=>{$f(r[e],s)},t)}function dd(n,e,t=bn,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{Yr();const a=ru(t),u=Cr(e,t,n,o);return a(),Xr(),u});return r?s.unshift(i):s.push(i),i}}const is=n=>(e,t=bn)=>{(!Nl||n==="sp")&&dd(n,(...r)=>e(...r),t)},wE=is("bm"),Gs=is("m"),IE=is("bu"),EE=is("u"),TE=is("bum"),Yf=is("um"),xE=is("sp"),AE=is("rtg"),PE=is("rtc");function SE(n,e=bn){dd("ec",n,e)}const n_="components";function RE(n,e){return kE(n_,n,!0,e)||n}const CE=Symbol.for("v-ndc");function kE(n,e,t=!0,r=!1){const s=zn||bn;if(s){const i=s.type;if(n===n_){const a=vT(i,!1);if(a&&(a===e||a===Yn(e)||a===id(Yn(e))))return i}const o=Fm(s[n]||i[n],e)||Fm(s.appContext[n],e);return!o&&r?i:o}}function Fm(n,e){return n&&(n[e]||n[Yn(e)]||n[id(Yn(e))])}function sr(n,e,t,r){let s;const i=t&&t[r],o=ke(n);if(o||Xt(n)){const a=o&&jo(n);let u=!1,c=!1;a&&(u=!Jn(n),c=zs(n),n=ld(n)),s=new Array(n.length);for(let d=0,f=n.length;d<f;d++)s[d]=e(u?c?Ec(hn(n[d])):hn(n[d]):n[d],d,void 0,i&&i[d])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(It(n))if(n[Symbol.iterator])s=Array.from(n,(a,u)=>e(a,u,void 0,i&&i[u]));else{const a=Object.keys(n);s=new Array(a.length);for(let u=0,c=a.length;u<c;u++){const d=a[u];s[u]=e(n[d],d,u,i&&i[u])}}else s=[];return t&&(t[r]=s),s}const Qh=n=>n?w_(n)?pd(n):Qh(n.parent):null,_l=un(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>Qh(n.parent),$root:n=>Qh(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>Xf(n),$forceUpdate:n=>n.f||(n.f=()=>{Qf(n.update)}),$nextTick:n=>n.n||(n.n=Bn.bind(n.proxy)),$watch:n=>XE.bind(n)}),mh=(n,e)=>n!==yt&&!n.__isScriptSetup&&ot(n,e),DE={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:u}=n;let c;if(e[0]!=="$"){const _=o[e];if(_!==void 0)switch(_){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(mh(r,e))return o[e]=1,r[e];if(s!==yt&&ot(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&ot(c,e))return o[e]=3,i[e];if(t!==yt&&ot(t,e))return o[e]=4,t[e];Jh&&(o[e]=0)}}const d=_l[e];let f,g;if(d)return e==="$attrs"&&_n(n.attrs,"get",""),d(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==yt&&ot(t,e))return o[e]=4,t[e];if(g=u.config.globalProperties,ot(g,e))return g[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return mh(s,e)?(s[e]=t,!0):r!==yt&&ot(r,e)?(r[e]=t,!0):ot(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==yt&&ot(n,o)||mh(e,o)||(a=i[0])&&ot(a,o)||ot(r,o)||ot(_l,o)||ot(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:ot(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function Um(n){return ke(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let Jh=!0;function VE(n){const e=Xf(n),t=n.proxy,r=n.ctx;Jh=!1,e.beforeCreate&&$m(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:u,inject:c,created:d,beforeMount:f,mounted:g,beforeUpdate:_,updated:C,activated:T,deactivated:k,beforeDestroy:j,beforeUnmount:q,destroyed:U,unmounted:z,render:Y,renderTracked:H,renderTriggered:P,errorCaptured:I,serverPrefetch:R,expose:x,inheritAttrs:S,components:D,directives:w,filters:He}=e;if(c&&NE(c,r,null),o)for(const $e in o){const Ve=o[$e];qe(Ve)&&(r[$e]=Ve.bind(t))}if(s){const $e=s.call(t,t);It($e)&&(n.data=ud($e))}if(Jh=!0,i)for(const $e in i){const Ve=i[$e],Ie=qe(Ve)?Ve.bind(t,t):qe(Ve.get)?Ve.get.bind(t,t):ir,oe=!qe(Ve)&&qe(Ve.set)?Ve.set.bind(t):ir,Re=We({get:Ie,set:oe});Object.defineProperty(r,$e,{enumerable:!0,configurable:!0,get:()=>Re.value,set:_e=>Re.value=_e})}if(a)for(const $e in a)r_(a[$e],r,t,$e);if(u){const $e=qe(u)?u.call(t):u;Reflect.ownKeys($e).forEach(Ve=>{ic(Ve,$e[Ve])})}d&&$m(d,n,"c");function et($e,Ve){ke(Ve)?Ve.forEach(Ie=>$e(Ie.bind(t))):Ve&&$e(Ve.bind(t))}if(et(wE,f),et(Gs,g),et(IE,_),et(EE,C),et(yE,T),et(_E,k),et(SE,I),et(PE,H),et(AE,P),et(TE,q),et(Yf,z),et(xE,R),ke(x))if(x.length){const $e=n.exposed||(n.exposed={});x.forEach(Ve=>{Object.defineProperty($e,Ve,{get:()=>t[Ve],set:Ie=>t[Ve]=Ie})})}else n.exposed||(n.exposed={});Y&&n.render===ir&&(n.render=Y),S!=null&&(n.inheritAttrs=S),D&&(n.components=D),w&&(n.directives=w),R&&Zy(n)}function NE(n,e,t=ir){ke(n)&&(n=Yh(n));for(const r in n){const s=n[r];let i;It(s)?"default"in s?i=ar(s.from||r,s.default,!0):i=ar(s.from||r):i=ar(s),In(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function $m(n,e,t){Cr(ke(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function r_(n,e,t,r){let s=r.includes(".")?g_(t,r):()=>t[r];if(Xt(n)){const i=e[n];qe(i)&&Yt(s,i)}else if(qe(n))Yt(s,n.bind(t));else if(It(n))if(ke(n))n.forEach(i=>r_(i,e,t,r));else{const i=qe(n.handler)?n.handler.bind(t):e[n.handler];qe(i)&&Yt(s,i,n)}}function Xf(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let u;return a?u=a:!s.length&&!t&&!r?u=e:(u={},s.length&&s.forEach(c=>Pc(u,c,o,!0)),Pc(u,e,o)),It(e)&&i.set(e,u),u}function Pc(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&Pc(n,i,t,!0),s&&s.forEach(o=>Pc(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=OE[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const OE={data:jm,props:Bm,emits:Bm,methods:ol,computed:ol,beforeCreate:Pn,created:Pn,beforeMount:Pn,mounted:Pn,beforeUpdate:Pn,updated:Pn,beforeDestroy:Pn,beforeUnmount:Pn,destroyed:Pn,unmounted:Pn,activated:Pn,deactivated:Pn,errorCaptured:Pn,serverPrefetch:Pn,components:ol,directives:ol,watch:LE,provide:jm,inject:ME};function jm(n,e){return e?n?function(){return un(qe(n)?n.call(this,this):n,qe(e)?e.call(this,this):e)}:e:n}function ME(n,e){return ol(Yh(n),Yh(e))}function Yh(n){if(ke(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function Pn(n,e){return n?[...new Set([].concat(n,e))]:e}function ol(n,e){return n?un(Object.create(null),n,e):e}function Bm(n,e){return n?ke(n)&&ke(e)?[...new Set([...n,...e])]:un(Object.create(null),Um(n),Um(e??{})):e}function LE(n,e){if(!n)return e;if(!e)return n;const t=un(Object.create(null),n);for(const r in e)t[r]=Pn(n[r],e[r]);return t}function s_(){return{app:null,config:{isNativeTag:AI,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let FE=0;function UE(n,e){return function(r,s=null){qe(r)||(r=un({},r)),s!=null&&!It(s)&&(s=null);const i=s_(),o=new WeakSet,a=[];let u=!1;const c=i.app={_uid:FE++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:_T,get config(){return i.config},set config(d){},use(d,...f){return o.has(d)||(d&&qe(d.install)?(o.add(d),d.install(c,...f)):qe(d)&&(o.add(d),d(c,...f))),c},mixin(d){return i.mixins.includes(d)||i.mixins.push(d),c},component(d,f){return f?(i.components[d]=f,c):i.components[d]},directive(d,f){return f?(i.directives[d]=f,c):i.directives[d]},mount(d,f,g){if(!u){const _=c._ceVNode||mt(r,s);return _.appContext=i,g===!0?g="svg":g===!1&&(g=void 0),f&&e?e(_,d):n(_,d,g),u=!0,c._container=d,d.__vue_app__=c,pd(_.component)}},onUnmount(d){a.push(d)},unmount(){u&&(Cr(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(d,f){return i.provides[d]=f,c},runWithContext(d){const f=qo;qo=c;try{return d()}finally{qo=f}}};return c}}let qo=null;function ic(n,e){if(bn){let t=bn.provides;const r=bn.parent&&bn.parent.provides;r===t&&(t=bn.provides=Object.create(r)),t[n]=e}}function ar(n,e,t=!1){const r=bn||zn;if(r||qo){let s=qo?qo._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&qe(e)?e.call(r&&r.proxy):e}}const i_={},o_=()=>Object.create(i_),a_=n=>Object.getPrototypeOf(n)===i_;function $E(n,e,t,r=!1){const s={},i=o_();n.propsDefaults=Object.create(null),l_(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:qy(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function jE(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=it(s),[u]=n.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const d=n.vnode.dynamicProps;for(let f=0;f<d.length;f++){let g=d[f];if(hd(n.emitsOptions,g))continue;const _=e[g];if(u)if(ot(i,g))_!==i[g]&&(i[g]=_,c=!0);else{const C=Yn(g);s[C]=Xh(u,a,C,_,n,!1)}else _!==i[g]&&(i[g]=_,c=!0)}}}else{l_(n,e,s,i)&&(c=!0);let d;for(const f in a)(!e||!ot(e,f)&&((d=ti(f))===f||!ot(e,d)))&&(u?t&&(t[f]!==void 0||t[d]!==void 0)&&(s[f]=Xh(u,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!ot(e,f))&&(delete i[f],c=!0)}c&&qr(n.attrs,"set","")}function l_(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let u in e){if(pl(u))continue;const c=e[u];let d;s&&ot(s,d=Yn(u))?!i||!i.includes(d)?t[d]=c:(a||(a={}))[d]=c:hd(n.emitsOptions,u)||(!(u in r)||c!==r[u])&&(r[u]=c,o=!0)}if(i){const u=it(t),c=a||yt;for(let d=0;d<i.length;d++){const f=i[d];t[f]=Xh(s,u,f,c[f],n,!ot(c,f))}}return o}function Xh(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=ot(o,"default");if(a&&r===void 0){const u=o.default;if(o.type!==Function&&!o.skipFactory&&qe(u)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const d=ru(s);r=c[t]=u.call(null,e),d()}}else r=u;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===ti(t))&&(r=!0))}return r}const BE=new WeakMap;function u_(n,e,t=!1){const r=t?BE:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let u=!1;if(!qe(n)){const d=f=>{u=!0;const[g,_]=u_(f,e,!0);un(o,g),_&&a.push(..._)};!t&&e.mixins.length&&e.mixins.forEach(d),n.extends&&d(n.extends),n.mixins&&n.mixins.forEach(d)}if(!i&&!u)return It(n)&&r.set(n,Uo),Uo;if(ke(i))for(let d=0;d<i.length;d++){const f=Yn(i[d]);qm(f)&&(o[f]=yt)}else if(i)for(const d in i){const f=Yn(d);if(qm(f)){const g=i[d],_=o[f]=ke(g)||qe(g)?{type:g}:un({},g),C=_.type;let T=!1,k=!0;if(ke(C))for(let j=0;j<C.length;++j){const q=C[j],U=qe(q)&&q.name;if(U==="Boolean"){T=!0;break}else U==="String"&&(k=!1)}else T=qe(C)&&C.name==="Boolean";_[0]=T,_[1]=k,(T||ot(_,"default"))&&a.push(f)}}const c=[o,a];return It(n)&&r.set(n,c),c}function qm(n){return n[0]!=="$"&&!pl(n)}const Zf=n=>n[0]==="_"||n==="$stable",ep=n=>ke(n)?n.map(Ir):[Ir(n)],qE=(n,e,t)=>{if(e._n)return e;const r=mE((...s)=>ep(e(...s)),t);return r._c=!1,r},c_=(n,e,t)=>{const r=n._ctx;for(const s in n){if(Zf(s))continue;const i=n[s];if(qe(i))e[s]=qE(s,i,r);else if(i!=null){const o=ep(i);e[s]=()=>o}}},d_=(n,e)=>{const t=ep(e);n.slots.default=()=>t},h_=(n,e,t)=>{for(const r in e)(t||!Zf(r))&&(n[r]=e[r])},zE=(n,e,t)=>{const r=n.slots=o_();if(n.vnode.shapeFlag&32){const s=e.__;s&&qh(r,"__",s,!0);const i=e._;i?(h_(r,e,t),t&&qh(r,"_",i,!0)):c_(e,r)}else e&&d_(n,e)},GE=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=yt;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:h_(s,e,t):(i=!e.$stable,c_(e,s)),o=e}else e&&(d_(n,e),o={default:1});if(i)for(const a in s)!Zf(a)&&o[a]==null&&delete s[a]},jn=iT;function KE(n){return HE(n)}function HE(n,e){const t=od();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:u,setText:c,setElementText:d,parentNode:f,nextSibling:g,setScopeId:_=ir,insertStaticContent:C}=n,T=(E,A,$,Z=null,K=null,X=null,pe=void 0,ae=null,ie=!!A.dynamicChildren)=>{if(E===A)return;E&&!Ya(E,A)&&(Z=W(E),_e(E,K,X,!0),E=null),A.patchFlag===-2&&(ie=!1,A.dynamicChildren=null);const{type:re,ref:Ee,shapeFlag:fe}=A;switch(re){case fd:k(E,A,$,Z);break;case Ks:j(E,A,$,Z);break;case oc:E==null&&q(A,$,Z,pe);break;case ut:D(E,A,$,Z,K,X,pe,ae,ie);break;default:fe&1?Y(E,A,$,Z,K,X,pe,ae,ie):fe&6?w(E,A,$,Z,K,X,pe,ae,ie):(fe&64||fe&128)&&re.process(E,A,$,Z,K,X,pe,ae,ie,ne)}Ee!=null&&K?vl(Ee,E&&E.ref,X,A||E,!A):Ee==null&&E&&E.ref!=null&&vl(E.ref,null,X,E,!0)},k=(E,A,$,Z)=>{if(E==null)r(A.el=a(A.children),$,Z);else{const K=A.el=E.el;A.children!==E.children&&c(K,A.children)}},j=(E,A,$,Z)=>{E==null?r(A.el=u(A.children||""),$,Z):A.el=E.el},q=(E,A,$,Z)=>{[E.el,E.anchor]=C(E.children,A,$,Z,E.el,E.anchor)},U=({el:E,anchor:A},$,Z)=>{let K;for(;E&&E!==A;)K=g(E),r(E,$,Z),E=K;r(A,$,Z)},z=({el:E,anchor:A})=>{let $;for(;E&&E!==A;)$=g(E),s(E),E=$;s(A)},Y=(E,A,$,Z,K,X,pe,ae,ie)=>{A.type==="svg"?pe="svg":A.type==="math"&&(pe="mathml"),E==null?H(A,$,Z,K,X,pe,ae,ie):R(E,A,K,X,pe,ae,ie)},H=(E,A,$,Z,K,X,pe,ae)=>{let ie,re;const{props:Ee,shapeFlag:fe,transition:be,dirs:Pe}=E;if(ie=E.el=o(E.type,X,Ee&&Ee.is,Ee),fe&8?d(ie,E.children):fe&16&&I(E.children,ie,null,Z,K,gh(E,X),pe,ae),Pe&&Ii(E,null,Z,"created"),P(ie,E,E.scopeId,pe,Z),Ee){for(const Be in Ee)Be!=="value"&&!pl(Be)&&i(ie,Be,null,Ee[Be],X,Z);"value"in Ee&&i(ie,"value",null,Ee.value,X),(re=Ee.onVnodeBeforeMount)&&br(re,Z,E)}Pe&&Ii(E,null,Z,"beforeMount");const Ae=WE(K,be);Ae&&be.beforeEnter(ie),r(ie,A,$),((re=Ee&&Ee.onVnodeMounted)||Ae||Pe)&&jn(()=>{re&&br(re,Z,E),Ae&&be.enter(ie),Pe&&Ii(E,null,Z,"mounted")},K)},P=(E,A,$,Z,K)=>{if($&&_(E,$),Z)for(let X=0;X<Z.length;X++)_(E,Z[X]);if(K){let X=K.subTree;if(A===X||y_(X.type)&&(X.ssContent===A||X.ssFallback===A)){const pe=K.vnode;P(E,pe,pe.scopeId,pe.slotScopeIds,K.parent)}}},I=(E,A,$,Z,K,X,pe,ae,ie=0)=>{for(let re=ie;re<E.length;re++){const Ee=E[re]=ae?Rs(E[re]):Ir(E[re]);T(null,Ee,A,$,Z,K,X,pe,ae)}},R=(E,A,$,Z,K,X,pe)=>{const ae=A.el=E.el;let{patchFlag:ie,dynamicChildren:re,dirs:Ee}=A;ie|=E.patchFlag&16;const fe=E.props||yt,be=A.props||yt;let Pe;if($&&Ei($,!1),(Pe=be.onVnodeBeforeUpdate)&&br(Pe,$,A,E),Ee&&Ii(A,E,$,"beforeUpdate"),$&&Ei($,!0),(fe.innerHTML&&be.innerHTML==null||fe.textContent&&be.textContent==null)&&d(ae,""),re?x(E.dynamicChildren,re,ae,$,Z,gh(A,K),X):pe||Ve(E,A,ae,null,$,Z,gh(A,K),X,!1),ie>0){if(ie&16)S(ae,fe,be,$,K);else if(ie&2&&fe.class!==be.class&&i(ae,"class",null,be.class,K),ie&4&&i(ae,"style",fe.style,be.style,K),ie&8){const Ae=A.dynamicProps;for(let Be=0;Be<Ae.length;Be++){const ze=Ae[Be],Tt=fe[ze],ht=be[ze];(ht!==Tt||ze==="value")&&i(ae,ze,Tt,ht,K,$)}}ie&1&&E.children!==A.children&&d(ae,A.children)}else!pe&&re==null&&S(ae,fe,be,$,K);((Pe=be.onVnodeUpdated)||Ee)&&jn(()=>{Pe&&br(Pe,$,A,E),Ee&&Ii(A,E,$,"updated")},Z)},x=(E,A,$,Z,K,X,pe)=>{for(let ae=0;ae<A.length;ae++){const ie=E[ae],re=A[ae],Ee=ie.el&&(ie.type===ut||!Ya(ie,re)||ie.shapeFlag&198)?f(ie.el):$;T(ie,re,Ee,null,Z,K,X,pe,!0)}},S=(E,A,$,Z,K)=>{if(A!==$){if(A!==yt)for(const X in A)!pl(X)&&!(X in $)&&i(E,X,A[X],null,K,Z);for(const X in $){if(pl(X))continue;const pe=$[X],ae=A[X];pe!==ae&&X!=="value"&&i(E,X,ae,pe,K,Z)}"value"in $&&i(E,"value",A.value,$.value,K)}},D=(E,A,$,Z,K,X,pe,ae,ie)=>{const re=A.el=E?E.el:a(""),Ee=A.anchor=E?E.anchor:a("");let{patchFlag:fe,dynamicChildren:be,slotScopeIds:Pe}=A;Pe&&(ae=ae?ae.concat(Pe):Pe),E==null?(r(re,$,Z),r(Ee,$,Z),I(A.children||[],$,Ee,K,X,pe,ae,ie)):fe>0&&fe&64&&be&&E.dynamicChildren?(x(E.dynamicChildren,be,$,K,X,pe,ae),(A.key!=null||K&&A===K.subTree)&&f_(E,A,!0)):Ve(E,A,$,Ee,K,X,pe,ae,ie)},w=(E,A,$,Z,K,X,pe,ae,ie)=>{A.slotScopeIds=ae,E==null?A.shapeFlag&512?K.ctx.activate(A,$,Z,pe,ie):He(A,$,Z,K,X,pe,ie):Fe(E,A,ie)},He=(E,A,$,Z,K,X,pe)=>{const ae=E.component=hT(E,Z,K);if(e_(E)&&(ae.ctx.renderer=ne),fT(ae,!1,pe),ae.asyncDep){if(K&&K.registerDep(ae,et,pe),!E.el){const ie=ae.subTree=mt(Ks);j(null,ie,A,$)}}else et(ae,E,A,$,K,X,pe)},Fe=(E,A,$)=>{const Z=A.component=E.component;if(rT(E,A,$))if(Z.asyncDep&&!Z.asyncResolved){$e(Z,A,$);return}else Z.next=A,Z.update();else A.el=E.el,Z.vnode=A},et=(E,A,$,Z,K,X,pe)=>{const ae=()=>{if(E.isMounted){let{next:fe,bu:be,u:Pe,parent:Ae,vnode:Be}=E;{const ft=p_(E);if(ft){fe&&(fe.el=Be.el,$e(E,fe,pe)),ft.asyncDep.then(()=>{E.isUnmounted||ae()});return}}let ze=fe,Tt;Ei(E,!1),fe?(fe.el=Be.el,$e(E,fe,pe)):fe=Be,be&&sc(be),(Tt=fe.props&&fe.props.onVnodeBeforeUpdate)&&br(Tt,Ae,fe,Be),Ei(E,!0);const ht=vh(E),Wt=E.subTree;E.subTree=ht,T(Wt,ht,f(Wt.el),W(Wt),E,K,X),fe.el=ht.el,ze===null&&sT(E,ht.el),Pe&&jn(Pe,K),(Tt=fe.props&&fe.props.onVnodeUpdated)&&jn(()=>br(Tt,Ae,fe,Be),K)}else{let fe;const{el:be,props:Pe}=A,{bm:Ae,m:Be,parent:ze,root:Tt,type:ht}=E,Wt=yl(A);if(Ei(E,!1),Ae&&sc(Ae),!Wt&&(fe=Pe&&Pe.onVnodeBeforeMount)&&br(fe,ze,A),Ei(E,!0),be&&tt){const ft=()=>{E.subTree=vh(E),tt(be,E.subTree,E,K,null)};Wt&&ht.__asyncHydrate?ht.__asyncHydrate(be,E,ft):ft()}else{Tt.ce&&Tt.ce._def.shadowRoot!==!1&&Tt.ce._injectChildStyle(ht);const ft=E.subTree=vh(E);T(null,ft,$,Z,E,K,X),A.el=ft.el}if(Be&&jn(Be,K),!Wt&&(fe=Pe&&Pe.onVnodeMounted)){const ft=A;jn(()=>br(fe,ze,ft),K)}(A.shapeFlag&256||ze&&yl(ze.vnode)&&ze.vnode.shapeFlag&256)&&E.a&&jn(E.a,K),E.isMounted=!0,A=$=Z=null}};E.scope.on();const ie=E.effect=new Ry(ae);E.scope.off();const re=E.update=ie.run.bind(ie),Ee=E.job=ie.runIfDirty.bind(ie);Ee.i=E,Ee.id=E.uid,ie.scheduler=()=>Qf(Ee),Ei(E,!0),re()},$e=(E,A,$)=>{A.component=E;const Z=E.vnode.props;E.vnode=A,E.next=null,jE(E,A.props,Z,$),GE(E,A.children,$),Yr(),Lm(E),Xr()},Ve=(E,A,$,Z,K,X,pe,ae,ie=!1)=>{const re=E&&E.children,Ee=E?E.shapeFlag:0,fe=A.children,{patchFlag:be,shapeFlag:Pe}=A;if(be>0){if(be&128){oe(re,fe,$,Z,K,X,pe,ae,ie);return}else if(be&256){Ie(re,fe,$,Z,K,X,pe,ae,ie);return}}Pe&8?(Ee&16&&Nt(re,K,X),fe!==re&&d($,fe)):Ee&16?Pe&16?oe(re,fe,$,Z,K,X,pe,ae,ie):Nt(re,K,X,!0):(Ee&8&&d($,""),Pe&16&&I(fe,$,Z,K,X,pe,ae,ie))},Ie=(E,A,$,Z,K,X,pe,ae,ie)=>{E=E||Uo,A=A||Uo;const re=E.length,Ee=A.length,fe=Math.min(re,Ee);let be;for(be=0;be<fe;be++){const Pe=A[be]=ie?Rs(A[be]):Ir(A[be]);T(E[be],Pe,$,null,K,X,pe,ae,ie)}re>Ee?Nt(E,K,X,!0,!1,fe):I(A,$,Z,K,X,pe,ae,ie,fe)},oe=(E,A,$,Z,K,X,pe,ae,ie)=>{let re=0;const Ee=A.length;let fe=E.length-1,be=Ee-1;for(;re<=fe&&re<=be;){const Pe=E[re],Ae=A[re]=ie?Rs(A[re]):Ir(A[re]);if(Ya(Pe,Ae))T(Pe,Ae,$,null,K,X,pe,ae,ie);else break;re++}for(;re<=fe&&re<=be;){const Pe=E[fe],Ae=A[be]=ie?Rs(A[be]):Ir(A[be]);if(Ya(Pe,Ae))T(Pe,Ae,$,null,K,X,pe,ae,ie);else break;fe--,be--}if(re>fe){if(re<=be){const Pe=be+1,Ae=Pe<Ee?A[Pe].el:Z;for(;re<=be;)T(null,A[re]=ie?Rs(A[re]):Ir(A[re]),$,Ae,K,X,pe,ae,ie),re++}}else if(re>be)for(;re<=fe;)_e(E[re],K,X,!0),re++;else{const Pe=re,Ae=re,Be=new Map;for(re=Ae;re<=be;re++){const jt=A[re]=ie?Rs(A[re]):Ir(A[re]);jt.key!=null&&Be.set(jt.key,re)}let ze,Tt=0;const ht=be-Ae+1;let Wt=!1,ft=0;const er=new Array(ht);for(re=0;re<ht;re++)er[re]=0;for(re=Pe;re<=fe;re++){const jt=E[re];if(Tt>=ht){_e(jt,K,X,!0);continue}let kn;if(jt.key!=null)kn=Be.get(jt.key);else for(ze=Ae;ze<=be;ze++)if(er[ze-Ae]===0&&Ya(jt,A[ze])){kn=ze;break}kn===void 0?_e(jt,K,X,!0):(er[kn-Ae]=re+1,kn>=ft?ft=kn:Wt=!0,T(jt,A[kn],$,null,K,X,pe,ae,ie),Tt++)}const ur=Wt?QE(er):Uo;for(ze=ur.length-1,re=ht-1;re>=0;re--){const jt=Ae+re,kn=A[jt],xn=jt+1<Ee?A[jt+1].el:Z;er[re]===0?T(null,kn,$,xn,K,X,pe,ae,ie):Wt&&(ze<0||re!==ur[ze]?Re(kn,$,xn,2):ze--)}}},Re=(E,A,$,Z,K=null)=>{const{el:X,type:pe,transition:ae,children:ie,shapeFlag:re}=E;if(re&6){Re(E.component.subTree,A,$,Z);return}if(re&128){E.suspense.move(A,$,Z);return}if(re&64){pe.move(E,A,$,ne);return}if(pe===ut){r(X,A,$);for(let fe=0;fe<ie.length;fe++)Re(ie[fe],A,$,Z);r(E.anchor,A,$);return}if(pe===oc){U(E,A,$);return}if(Z!==2&&re&1&&ae)if(Z===0)ae.beforeEnter(X),r(X,A,$),jn(()=>ae.enter(X),K);else{const{leave:fe,delayLeave:be,afterLeave:Pe}=ae,Ae=()=>{E.ctx.isUnmounted?s(X):r(X,A,$)},Be=()=>{fe(X,()=>{Ae(),Pe&&Pe()})};be?be(X,Ae,Be):Be()}else r(X,A,$)},_e=(E,A,$,Z=!1,K=!1)=>{const{type:X,props:pe,ref:ae,children:ie,dynamicChildren:re,shapeFlag:Ee,patchFlag:fe,dirs:be,cacheIndex:Pe}=E;if(fe===-2&&(K=!1),ae!=null&&(Yr(),vl(ae,null,$,E,!0),Xr()),Pe!=null&&(A.renderCache[Pe]=void 0),Ee&256){A.ctx.deactivate(E);return}const Ae=Ee&1&&be,Be=!yl(E);let ze;if(Be&&(ze=pe&&pe.onVnodeBeforeUnmount)&&br(ze,A,E),Ee&6)$t(E.component,$,Z);else{if(Ee&128){E.suspense.unmount($,Z);return}Ae&&Ii(E,null,A,"beforeUnmount"),Ee&64?E.type.remove(E,A,$,ne,Z):re&&!re.hasOnce&&(X!==ut||fe>0&&fe&64)?Nt(re,A,$,!1,!0):(X===ut&&fe&384||!K&&Ee&16)&&Nt(ie,A,$),Z&&Le(E)}(Be&&(ze=pe&&pe.onVnodeUnmounted)||Ae)&&jn(()=>{ze&&br(ze,A,E),Ae&&Ii(E,null,A,"unmounted")},$)},Le=E=>{const{type:A,el:$,anchor:Z,transition:K}=E;if(A===ut){dt($,Z);return}if(A===oc){z(E);return}const X=()=>{s($),K&&!K.persisted&&K.afterLeave&&K.afterLeave()};if(E.shapeFlag&1&&K&&!K.persisted){const{leave:pe,delayLeave:ae}=K,ie=()=>pe($,X);ae?ae(E.el,X,ie):ie()}else X()},dt=(E,A)=>{let $;for(;E!==A;)$=g(E),s(E),E=$;s(A)},$t=(E,A,$)=>{const{bum:Z,scope:K,job:X,subTree:pe,um:ae,m:ie,a:re,parent:Ee,slots:{__:fe}}=E;zm(ie),zm(re),Z&&sc(Z),Ee&&ke(fe)&&fe.forEach(be=>{Ee.renderCache[be]=void 0}),K.stop(),X&&(X.flags|=8,_e(pe,E,A,$)),ae&&jn(ae,A),jn(()=>{E.isUnmounted=!0},A),A&&A.pendingBranch&&!A.isUnmounted&&E.asyncDep&&!E.asyncResolved&&E.suspenseId===A.pendingId&&(A.deps--,A.deps===0&&A.resolve())},Nt=(E,A,$,Z=!1,K=!1,X=0)=>{for(let pe=X;pe<E.length;pe++)_e(E[pe],A,$,Z,K)},W=E=>{if(E.shapeFlag&6)return W(E.component.subTree);if(E.shapeFlag&128)return E.suspense.next();const A=g(E.anchor||E.el),$=A&&A[gE];return $?g($):A};let ge=!1;const he=(E,A,$)=>{E==null?A._vnode&&_e(A._vnode,null,null,!0):T(A._vnode||null,E,A,null,null,null,$),A._vnode=E,ge||(ge=!0,Lm(),Qy(),ge=!1)},ne={p:T,um:_e,m:Re,r:Le,mt:He,mc:I,pc:Ve,pbc:x,n:W,o:n};let je,tt;return e&&([je,tt]=e(ne)),{render:he,hydrate:je,createApp:UE(he,je)}}function gh({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function Ei({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function WE(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function f_(n,e,t=!1){const r=n.children,s=e.children;if(ke(r)&&ke(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=Rs(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&f_(o,a)),a.type===fd&&(a.el=o.el),a.type===Ks&&!a.el&&(a.el=o.el)}}function QE(n){const e=n.slice(),t=[0];let r,s,i,o,a;const u=n.length;for(r=0;r<u;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<c?i=a+1:o=a;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function p_(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:p_(e)}function zm(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const JE=Symbol.for("v-scx"),YE=()=>ar(JE);function Yt(n,e,t){return m_(n,e,t)}function m_(n,e,t=yt){const{immediate:r,deep:s,flush:i,once:o}=t,a=un({},t),u=e&&r||!e&&i!=="post";let c;if(Nl){if(i==="sync"){const _=YE();c=_.__watcherHandles||(_.__watcherHandles=[])}else if(!u){const _=()=>{};return _.stop=ir,_.resume=ir,_.pause=ir,_}}const d=bn;a.call=(_,C,T)=>Cr(_,d,C,T);let f=!1;i==="post"?a.scheduler=_=>{jn(_,d&&d.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(_,C)=>{C?_():Qf(_)}),a.augmentJob=_=>{e&&(_.flags|=4),f&&(_.flags|=2,d&&(_.id=d.uid,_.i=d))};const g=dE(n,e,a);return Nl&&(c?c.push(g):u&&g()),g}function XE(n,e,t){const r=this.proxy,s=Xt(n)?n.includes(".")?g_(r,n):()=>r[n]:n.bind(r,r);let i;qe(e)?i=e:(i=e.handler,t=e);const o=ru(this),a=m_(s,i.bind(r),t);return o(),a}function g_(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const ZE=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Yn(e)}Modifiers`]||n[`${ti(e)}Modifiers`];function eT(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||yt;let s=t;const i=e.startsWith("update:"),o=i&&ZE(r,e.slice(7));o&&(o.trim&&(s=t.map(d=>Xt(d)?d.trim():d)),o.number&&(s=t.map(zh)));let a,u=r[a=ch(e)]||r[a=ch(Yn(e))];!u&&i&&(u=r[a=ch(ti(e))]),u&&Cr(u,n,6,s);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,Cr(c,n,6,s)}}function v_(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!qe(n)){const u=c=>{const d=v_(c,e,!0);d&&(a=!0,un(o,d))};!t&&e.mixins.length&&e.mixins.forEach(u),n.extends&&u(n.extends),n.mixins&&n.mixins.forEach(u)}return!i&&!a?(It(n)&&r.set(n,null),null):(ke(i)?i.forEach(u=>o[u]=null):un(o,i),It(n)&&r.set(n,o),o)}function hd(n,e){return!n||!nd(e)?!1:(e=e.slice(2).replace(/Once$/,""),ot(n,e[0].toLowerCase()+e.slice(1))||ot(n,ti(e))||ot(n,e))}function vh(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:u,render:c,renderCache:d,props:f,data:g,setupState:_,ctx:C,inheritAttrs:T}=n,k=Ac(n);let j,q;try{if(t.shapeFlag&4){const z=s||r,Y=z;j=Ir(c.call(Y,z,d,f,_,g,C)),q=a}else{const z=e;j=Ir(z.length>1?z(f,{attrs:a,slots:o,emit:u}):z(f,null)),q=e.props?a:tT(a)}}catch(z){bl.length=0,cd(z,n,1),j=mt(Ks)}let U=j;if(q&&T!==!1){const z=Object.keys(q),{shapeFlag:Y}=U;z.length&&Y&7&&(i&&z.some(Uf)&&(q=nT(q,i)),U=Xo(U,q,!1,!0))}return t.dirs&&(U=Xo(U,null,!1,!0),U.dirs=U.dirs?U.dirs.concat(t.dirs):t.dirs),t.transition&&Jf(U,t.transition),j=U,Ac(k),j}const tT=n=>{let e;for(const t in n)(t==="class"||t==="style"||nd(t))&&((e||(e={}))[t]=n[t]);return e},nT=(n,e)=>{const t={};for(const r in n)(!Uf(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function rT(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:u}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&u>=0){if(u&1024)return!0;if(u&16)return r?Gm(r,o,c):!!o;if(u&8){const d=e.dynamicProps;for(let f=0;f<d.length;f++){const g=d[f];if(o[g]!==r[g]&&!hd(c,g))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?Gm(r,o,c):!0:!!o;return!1}function Gm(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!hd(t,i))return!0}return!1}function sT({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const y_=n=>n.__isSuspense;function iT(n,e){e&&e.pendingBranch?ke(n)?e.effects.push(...n):e.effects.push(n):pE(n)}const ut=Symbol.for("v-fgt"),fd=Symbol.for("v-txt"),Ks=Symbol.for("v-cmt"),oc=Symbol.for("v-stc"),bl=[];let Gn=null;function F(n=!1){bl.push(Gn=n?null:[])}function oT(){bl.pop(),Gn=bl[bl.length-1]||null}let Vl=1;function Km(n,e=!1){Vl+=n,n<0&&Gn&&e&&(Gn.hasOnce=!0)}function __(n){return n.dynamicChildren=Vl>0?Gn||Uo:null,oT(),Vl>0&&Gn&&Gn.push(n),n}function B(n,e,t,r,s,i){return __(p(n,e,t,r,s,i,!0))}function Sc(n,e,t,r,s){return __(mt(n,e,t,r,s,!0))}function Rc(n){return n?n.__v_isVNode===!0:!1}function Ya(n,e){return n.type===e.type&&n.key===e.key}const b_=({key:n})=>n??null,ac=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?Xt(n)||In(n)||qe(n)?{i:zn,r:n,k:e,f:!!t}:n:null);function p(n,e=null,t=null,r=0,s=null,i=n===ut?0:1,o=!1,a=!1){const u={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&b_(e),ref:e&&ac(e),scopeId:Yy,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:zn};return a?(tp(u,t),i&128&&n.normalize(u)):t&&(u.shapeFlag|=Xt(t)?8:16),Vl>0&&!o&&Gn&&(u.patchFlag>0||i&6)&&u.patchFlag!==32&&Gn.push(u),u}const mt=aT;function aT(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===CE)&&(n=Ks),Rc(n)){const a=Xo(n,e,!0);return t&&tp(a,t),Vl>0&&!i&&Gn&&(a.shapeFlag&6?Gn[Gn.indexOf(n)]=a:Gn.push(a)),a.patchFlag=-2,a}if(yT(n)&&(n=n.__vccOpts),e){e=lT(e);let{class:a,style:u}=e;a&&!Xt(a)&&(e.class=qn(a)),It(u)&&(Wf(u)&&!ke(u)&&(u=un({},u)),e.style=Rl(u))}const o=Xt(n)?1:y_(n)?128:vE(n)?64:It(n)?4:qe(n)?2:0;return p(n,e,t,r,s,o,i,!0)}function lT(n){return n?Wf(n)||a_(n)?un({},n):n:null}function Xo(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:u}=n,c=e?uT(s||{},e):s,d={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&b_(c),ref:e&&e.ref?t&&i?ke(i)?i.concat(ac(e)):[i,ac(e)]:ac(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==ut?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:u,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Xo(n.ssContent),ssFallback:n.ssFallback&&Xo(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return u&&r&&Jf(d,u.clone(d)),d}function Rn(n=" ",e=0){return mt(fd,null,n,e)}function rr(n,e){const t=mt(oc,null,n);return t.staticCount=e,t}function ce(n="",e=!1){return e?(F(),Sc(Ks,null,n)):mt(Ks,null,n)}function Ir(n){return n==null||typeof n=="boolean"?mt(Ks):ke(n)?mt(ut,null,n.slice()):Rc(n)?Rs(n):mt(fd,null,String(n))}function Rs(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:Xo(n)}function tp(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(ke(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),tp(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!a_(e)?e._ctx=zn:s===3&&zn&&(zn.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else qe(e)?(e={default:e,_ctx:zn},t=32):(e=String(e),r&64?(t=16,e=[Rn(e)]):t=8);n.children=e,n.shapeFlag|=t}function uT(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=qn([e.class,r.class]));else if(s==="style")e.style=Rl([e.style,r.style]);else if(nd(s)){const i=e[s],o=r[s];o&&i!==o&&!(ke(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function br(n,e,t,r=null){Cr(n,e,7,[t,r])}const cT=s_();let dT=0;function hT(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||cT,i={uid:dT++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new FI(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:u_(r,s),emitsOptions:v_(r,s),emit:null,emitted:null,propsDefaults:yt,inheritAttrs:r.inheritAttrs,ctx:yt,data:yt,props:yt,attrs:yt,slots:yt,refs:yt,setupState:yt,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=eT.bind(null,i),n.ce&&n.ce(i),i}let bn=null,Cc,Zh;{const n=od(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};Cc=e("__VUE_INSTANCE_SETTERS__",t=>bn=t),Zh=e("__VUE_SSR_SETTERS__",t=>Nl=t)}const ru=n=>{const e=bn;return Cc(n),n.scope.on(),()=>{n.scope.off(),Cc(e)}},Hm=()=>{bn&&bn.scope.off(),Cc(null)};function w_(n){return n.vnode.shapeFlag&4}let Nl=!1;function fT(n,e=!1,t=!1){e&&Zh(e);const{props:r,children:s}=n.vnode,i=w_(n);$E(n,r,i,e),zE(n,s,t||e);const o=i?pT(n,e):void 0;return e&&Zh(!1),o}function pT(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,DE);const{setup:r}=t;if(r){Yr();const s=n.setupContext=r.length>1?gT(n):null,i=ru(n),o=nu(r,n,0,[n.props,s]),a=Iy(o);if(Xr(),i(),(a||n.sp)&&!yl(n)&&Zy(n),a){if(o.then(Hm,Hm),e)return o.then(u=>{Wm(n,u,e)}).catch(u=>{cd(u,n,0)});n.asyncDep=o}else Wm(n,o,e)}else I_(n,e)}function Wm(n,e,t){qe(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:It(e)&&(n.setupState=Ky(e)),I_(n,t)}let Qm;function I_(n,e,t){const r=n.type;if(!n.render){if(!e&&Qm&&!r.render){const s=r.template||Xf(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:u}=r,c=un(un({isCustomElement:i,delimiters:a},o),u);r.render=Qm(s,c)}}n.render=r.render||ir}{const s=ru(n);Yr();try{VE(n)}finally{Xr(),s()}}}const mT={get(n,e){return _n(n,"get",""),n[e]}};function gT(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,mT),slots:n.slots,emit:n.emit,expose:e}}function pd(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(Ky(sE(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in _l)return _l[t](n)},has(e,t){return t in e||t in _l}})):n.proxy}function vT(n,e=!0){return qe(n)?n.displayName||n.name:n.name||e&&n.__name}function yT(n){return qe(n)&&"__vccOpts"in n}const We=(n,e)=>uE(n,e,Nl);function E_(n,e,t){const r=arguments.length;return r===2?It(e)&&!ke(e)?Rc(e)?mt(n,null,[e]):mt(n,e):mt(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&Rc(t)&&(t=[t]),mt(n,e,t))}const _T="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let ef;const Jm=typeof window<"u"&&window.trustedTypes;if(Jm)try{ef=Jm.createPolicy("vue",{createHTML:n=>n})}catch{}const T_=ef?n=>ef.createHTML(n):n=>n,bT="http://www.w3.org/2000/svg",wT="http://www.w3.org/1998/Math/MathML",Br=typeof document<"u"?document:null,Ym=Br&&Br.createElement("template"),IT={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?Br.createElementNS(bT,n):e==="mathml"?Br.createElementNS(wT,n):t?Br.createElement(n,{is:t}):Br.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>Br.createTextNode(n),createComment:n=>Br.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Br.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{Ym.innerHTML=T_(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=Ym.content;if(r==="svg"||r==="mathml"){const u=a.firstChild;for(;u.firstChild;)a.appendChild(u.firstChild);a.removeChild(u)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},ET=Symbol("_vtc");function TT(n,e,t){const r=n[ET];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const kc=Symbol("_vod"),x_=Symbol("_vsh"),yh={beforeMount(n,{value:e},{transition:t}){n[kc]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):Xa(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),Xa(n,!0),r.enter(n)):r.leave(n,()=>{Xa(n,!1)}):Xa(n,e))},beforeUnmount(n,{value:e}){Xa(n,e)}};function Xa(n,e){n.style.display=e?n[kc]:"none",n[x_]=!e}const xT=Symbol(""),AT=/(^|;)\s*display\s*:/;function PT(n,e,t){const r=n.style,s=Xt(t);let i=!1;if(t&&!s){if(e)if(Xt(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&lc(r,a,"")}else for(const o in e)t[o]==null&&lc(r,o,"");for(const o in t)o==="display"&&(i=!0),lc(r,o,t[o])}else if(s){if(e!==t){const o=r[xT];o&&(t+=";"+o),r.cssText=t,i=AT.test(t)}}else e&&n.removeAttribute("style");kc in n&&(n[kc]=i?r.display:"",n[x_]&&(r.display="none"))}const Xm=/\s*!important$/;function lc(n,e,t){if(ke(t))t.forEach(r=>lc(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=ST(n,e);Xm.test(t)?n.setProperty(ti(r),t.replace(Xm,""),"important"):n[r]=t}}const Zm=["Webkit","Moz","ms"],_h={};function ST(n,e){const t=_h[e];if(t)return t;let r=Yn(e);if(r!=="filter"&&r in n)return _h[e]=r;r=id(r);for(let s=0;s<Zm.length;s++){const i=Zm[s]+r;if(i in n)return _h[e]=i}return e}const eg="http://www.w3.org/1999/xlink";function tg(n,e,t,r,s,i=MI(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(eg,e.slice(6,e.length)):n.setAttributeNS(eg,e,t):t==null||i&&!xy(t)?n.removeAttribute(e):n.setAttribute(e,i?"":Rr(t)?String(t):t)}function ng(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?T_(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,u=t==null?n.type==="checkbox"?"on":"":String(t);(a!==u||!("_value"in n))&&(n.value=u),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=xy(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function Si(n,e,t,r){n.addEventListener(e,t,r)}function RT(n,e,t,r){n.removeEventListener(e,t,r)}const rg=Symbol("_vei");function CT(n,e,t,r,s=null){const i=n[rg]||(n[rg]={}),o=i[e];if(r&&o)o.value=r;else{const[a,u]=kT(e);if(r){const c=i[e]=NT(r,s);Si(n,a,c,u)}else o&&(RT(n,a,o,u),i[e]=void 0)}}const sg=/(?:Once|Passive|Capture)$/;function kT(n){let e;if(sg.test(n)){e={};let r;for(;r=n.match(sg);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):ti(n.slice(2)),e]}let bh=0;const DT=Promise.resolve(),VT=()=>bh||(DT.then(()=>bh=0),bh=Date.now());function NT(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;Cr(OT(r,t.value),e,5,[r])};return t.value=n,t.attached=VT(),t}function OT(n,e){if(ke(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const ig=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,MT=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?TT(n,r,o):e==="style"?PT(n,t,r):nd(e)?Uf(e)||CT(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):LT(n,e,r,o))?(ng(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&tg(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!Xt(r))?ng(n,Yn(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),tg(n,e,r,o))};function LT(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&ig(e)&&qe(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return ig(e)&&Xt(t)?!1:e in n}const Dc=n=>{const e=n.props["onUpdate:modelValue"]||!1;return ke(e)?t=>sc(e,t):e};function FT(n){n.target.composing=!0}function og(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const zo=Symbol("_assign"),Rt={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[zo]=Dc(s);const i=r||s.props&&s.props.type==="number";Si(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=zh(a)),n[zo](a)}),t&&Si(n,"change",()=>{n.value=n.value.trim()}),e||(Si(n,"compositionstart",FT),Si(n,"compositionend",og),Si(n,"change",og))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[zo]=Dc(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?zh(n.value):n.value,u=e??"";a!==u&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===u)||(n.value=u))}},ag={deep:!0,created(n,e,t){n[zo]=Dc(t),Si(n,"change",()=>{const r=n._modelValue,s=UT(n),i=n.checked,o=n[zo];if(ke(r)){const a=Ay(r,s),u=a!==-1;if(i&&!u)o(r.concat(s));else if(!i&&u){const c=[...r];c.splice(a,1),o(c)}}else if(rd(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o(A_(n,i))})},mounted:lg,beforeUpdate(n,e,t){n[zo]=Dc(t),lg(n,e,t)}};function lg(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(ke(e))s=Ay(e,r.props.value)>-1;else if(rd(e))s=e.has(r.props.value);else{if(e===t)return;s=ad(e,A_(n,!0))}n.checked!==s&&(n.checked=s)}function UT(n){return"_value"in n?n._value:n.value}function A_(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const $T=["ctrl","shift","alt","meta"],jT={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>$T.some(t=>n[`${t}Key`]&&!e.includes(t))},Bt=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=jT[e[o]];if(a&&a(s,e))return}return n(s,...i)})},BT={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},vn=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=ti(s.key);if(e.some(o=>o===i||BT[o]===i))return n(s)})},qT=un({patchProp:MT},IT);let ug;function zT(){return ug||(ug=KE(qT))}const GT=(...n)=>{const e=zT().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=HT(r);if(!s)return;const i=e._component;!qe(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,KT(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function KT(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function HT(n){return Xt(n)?document.querySelector(n):n}const WT={__name:"App",setup(n){return(e,t)=>{const r=RE("router-view");return F(),Sc(r)}}};/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const No=typeof document<"u";function P_(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function QT(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&P_(n.default)}const st=Object.assign;function wh(n,e){const t={};for(const r in e){const s=e[r];t[r]=lr(s)?s.map(n):n(s)}return t}const wl=()=>{},lr=Array.isArray,S_=/#/g,JT=/&/g,YT=/\//g,XT=/=/g,ZT=/\?/g,R_=/\+/g,ex=/%5B/g,tx=/%5D/g,C_=/%5E/g,nx=/%60/g,k_=/%7B/g,rx=/%7C/g,D_=/%7D/g,sx=/%20/g;function np(n){return encodeURI(""+n).replace(rx,"|").replace(ex,"[").replace(tx,"]")}function ix(n){return np(n).replace(k_,"{").replace(D_,"}").replace(C_,"^")}function tf(n){return np(n).replace(R_,"%2B").replace(sx,"+").replace(S_,"%23").replace(JT,"%26").replace(nx,"`").replace(k_,"{").replace(D_,"}").replace(C_,"^")}function ox(n){return tf(n).replace(XT,"%3D")}function ax(n){return np(n).replace(S_,"%23").replace(ZT,"%3F")}function lx(n){return n==null?"":ax(n).replace(YT,"%2F")}function Ol(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const ux=/\/$/,cx=n=>n.replace(ux,"");function Ih(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let u=e.indexOf("?");return a<u&&a>=0&&(u=-1),u>-1&&(r=e.slice(0,u),i=e.slice(u+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=px(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:Ol(o)}}function dx(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function cg(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function hx(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&Zo(e.matched[r],t.matched[s])&&V_(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function Zo(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function V_(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!fx(n[t],e[t]))return!1;return!0}function fx(n,e){return lr(n)?dg(n,e):lr(e)?dg(e,n):n===e}function dg(n,e){return lr(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function px(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const Ts={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Ml;(function(n){n.pop="pop",n.push="push"})(Ml||(Ml={}));var Il;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Il||(Il={}));function mx(n){if(!n)if(No){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),cx(n)}const gx=/^[^#]+#/;function vx(n,e){return n.replace(gx,"#")+e}function yx(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const md=()=>({left:window.scrollX,top:window.scrollY});function _x(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=yx(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function hg(n,e){return(history.state?history.state.position-e:-1)+n}const nf=new Map;function bx(n,e){nf.set(n,e)}function wx(n){const e=nf.get(n);return nf.delete(n),e}let Ix=()=>location.protocol+"//"+location.host;function N_(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,u=s.slice(a);return u[0]!=="/"&&(u="/"+u),cg(u,"")}return cg(t,n)+r+s}function Ex(n,e,t,r){let s=[],i=[],o=null;const a=({state:g})=>{const _=N_(n,location),C=t.value,T=e.value;let k=0;if(g){if(t.value=_,e.value=g,o&&o===C){o=null;return}k=T?g.position-T.position:0}else r(_);s.forEach(j=>{j(t.value,C,{delta:k,type:Ml.pop,direction:k?k>0?Il.forward:Il.back:Il.unknown})})};function u(){o=t.value}function c(g){s.push(g);const _=()=>{const C=s.indexOf(g);C>-1&&s.splice(C,1)};return i.push(_),_}function d(){const{history:g}=window;g.state&&g.replaceState(st({},g.state,{scroll:md()}),"")}function f(){for(const g of i)g();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",d)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",d,{passive:!0}),{pauseListeners:u,listen:c,destroy:f}}function fg(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?md():null}}function Tx(n){const{history:e,location:t}=window,r={value:N_(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(u,c,d){const f=n.indexOf("#"),g=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+u:Ix()+n+u;try{e[d?"replaceState":"pushState"](c,"",g),s.value=c}catch(_){console.error(_),t[d?"replace":"assign"](g)}}function o(u,c){const d=st({},e.state,fg(s.value.back,u,s.value.forward,!0),c,{position:s.value.position});i(u,d,!0),r.value=u}function a(u,c){const d=st({},s.value,e.state,{forward:u,scroll:md()});i(d.current,d,!0);const f=st({},fg(r.value,u,null),{position:d.position+1},c);i(u,f,!1),r.value=u}return{location:r,state:s,push:a,replace:o}}function xx(n){n=mx(n);const e=Tx(n),t=Ex(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=st({location:"",base:n,go:r,createHref:vx.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function Ax(n){return typeof n=="string"||n&&typeof n=="object"}function O_(n){return typeof n=="string"||typeof n=="symbol"}const M_=Symbol("");var pg;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(pg||(pg={}));function ea(n,e){return st(new Error,{type:n,[M_]:!0},e)}function jr(n,e){return n instanceof Error&&M_ in n&&(e==null||!!(n.type&e))}const mg="[^/]+?",Px={sensitive:!1,strict:!1,start:!0,end:!0},Sx=/[.+*?^${}()[\]/\\]/g;function Rx(n,e){const t=st({},Px,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const d=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let f=0;f<c.length;f++){const g=c[f];let _=40+(t.sensitive?.25:0);if(g.type===0)f||(s+="/"),s+=g.value.replace(Sx,"\\$&"),_+=40;else if(g.type===1){const{value:C,repeatable:T,optional:k,regexp:j}=g;i.push({name:C,repeatable:T,optional:k});const q=j||mg;if(q!==mg){_+=10;try{new RegExp(`(${q})`)}catch(z){throw new Error(`Invalid custom RegExp for param "${C}" (${q}): `+z.message)}}let U=T?`((?:${q})(?:/(?:${q}))*)`:`(${q})`;f||(U=k&&c.length<2?`(?:/${U})`:"/"+U),k&&(U+="?"),s+=U,_+=20,k&&(_+=-8),T&&(_+=-20),q===".*"&&(_+=-50)}d.push(_)}r.push(d)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const d=c.match(o),f={};if(!d)return null;for(let g=1;g<d.length;g++){const _=d[g]||"",C=i[g-1];f[C.name]=_&&C.repeatable?_.split("/"):_}return f}function u(c){let d="",f=!1;for(const g of n){(!f||!d.endsWith("/"))&&(d+="/"),f=!1;for(const _ of g)if(_.type===0)d+=_.value;else if(_.type===1){const{value:C,repeatable:T,optional:k}=_,j=C in c?c[C]:"";if(lr(j)&&!T)throw new Error(`Provided param "${C}" is an array but it is not repeatable (* or + modifiers)`);const q=lr(j)?j.join("/"):j;if(!q)if(k)g.length<2&&(d.endsWith("/")?d=d.slice(0,-1):f=!0);else throw new Error(`Missing required param "${C}"`);d+=q}}return d||"/"}return{re:o,score:r,keys:i,parse:a,stringify:u}}function Cx(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function L_(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=Cx(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(gg(r))return 1;if(gg(s))return-1}return s.length-r.length}function gg(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const kx={type:0,value:""},Dx=/[a-zA-Z0-9_]/;function Vx(n){if(!n)return[[]];if(n==="/")return[[kx]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(_){throw new Error(`ERR (${t})/"${c}": ${_}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,u,c="",d="";function f(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(u==="*"||u==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:d,repeatable:u==="*"||u==="+",optional:u==="*"||u==="?"})):e("Invalid state to consume buffer"),c="")}function g(){c+=u}for(;a<n.length;){if(u=n[a++],u==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:u==="/"?(c&&f(),o()):u===":"?(f(),t=1):g();break;case 4:g(),t=r;break;case 1:u==="("?t=2:Dx.test(u)?g():(f(),t=0,u!=="*"&&u!=="?"&&u!=="+"&&a--);break;case 2:u===")"?d[d.length-1]=="\\"?d=d.slice(0,-1)+u:t=3:d+=u;break;case 3:f(),t=0,u!=="*"&&u!=="?"&&u!=="+"&&a--,d="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),f(),o(),s}function Nx(n,e,t){const r=Rx(Vx(n.path),t),s=st(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function Ox(n,e){const t=[],r=new Map;e=bg({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,g,_){const C=!_,T=yg(f);T.aliasOf=_&&_.record;const k=bg(e,f),j=[T];if("alias"in f){const z=typeof f.alias=="string"?[f.alias]:f.alias;for(const Y of z)j.push(yg(st({},T,{components:_?_.record.components:T.components,path:Y,aliasOf:_?_.record:T})))}let q,U;for(const z of j){const{path:Y}=z;if(g&&Y[0]!=="/"){const H=g.record.path,P=H[H.length-1]==="/"?"":"/";z.path=g.record.path+(Y&&P+Y)}if(q=Nx(z,g,k),_?_.alias.push(q):(U=U||q,U!==q&&U.alias.push(q),C&&f.name&&!_g(q)&&o(f.name)),F_(q)&&u(q),T.children){const H=T.children;for(let P=0;P<H.length;P++)i(H[P],q,_&&_.children[P])}_=_||q}return U?()=>{o(U)}:wl}function o(f){if(O_(f)){const g=r.get(f);g&&(r.delete(f),t.splice(t.indexOf(g),1),g.children.forEach(o),g.alias.forEach(o))}else{const g=t.indexOf(f);g>-1&&(t.splice(g,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function u(f){const g=Fx(f,t);t.splice(g,0,f),f.record.name&&!_g(f)&&r.set(f.record.name,f)}function c(f,g){let _,C={},T,k;if("name"in f&&f.name){if(_=r.get(f.name),!_)throw ea(1,{location:f});k=_.record.name,C=st(vg(g.params,_.keys.filter(U=>!U.optional).concat(_.parent?_.parent.keys.filter(U=>U.optional):[]).map(U=>U.name)),f.params&&vg(f.params,_.keys.map(U=>U.name))),T=_.stringify(C)}else if(f.path!=null)T=f.path,_=t.find(U=>U.re.test(T)),_&&(C=_.parse(T),k=_.record.name);else{if(_=g.name?r.get(g.name):t.find(U=>U.re.test(g.path)),!_)throw ea(1,{location:f,currentLocation:g});k=_.record.name,C=st({},g.params,f.params),T=_.stringify(C)}const j=[];let q=_;for(;q;)j.unshift(q.record),q=q.parent;return{name:k,path:T,params:C,matched:j,meta:Lx(j)}}n.forEach(f=>i(f));function d(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:o,clearRoutes:d,getRoutes:a,getRecordMatcher:s}}function vg(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function yg(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:Mx(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function Mx(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function _g(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function Lx(n){return n.reduce((e,t)=>st(e,t.meta),{})}function bg(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function Fx(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;L_(n,e[i])<0?r=i:t=i+1}const s=Ux(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function Ux(n){let e=n;for(;e=e.parent;)if(F_(e)&&L_(n,e)===0)return e}function F_({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function $x(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(R_," "),o=i.indexOf("="),a=Ol(o<0?i:i.slice(0,o)),u=o<0?null:Ol(i.slice(o+1));if(a in e){let c=e[a];lr(c)||(c=e[a]=[c]),c.push(u)}else e[a]=u}return e}function wg(n){let e="";for(let t in n){const r=n[t];if(t=ox(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(lr(r)?r.map(i=>i&&tf(i)):[r&&tf(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function jx(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=lr(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const Bx=Symbol(""),Ig=Symbol(""),gd=Symbol(""),rp=Symbol(""),rf=Symbol("");function Za(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function Cs(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,u)=>{const c=g=>{g===!1?u(ea(4,{from:t,to:e})):g instanceof Error?u(g):Ax(g)?u(ea(2,{from:e,to:g})):(o&&r.enterCallbacks[s]===o&&typeof g=="function"&&o.push(g),a())},d=i(()=>n.call(r&&r.instances[s],e,t,c));let f=Promise.resolve(d);n.length<3&&(f=f.then(c)),f.catch(g=>u(g))})}function Eh(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let u=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(P_(u)){const d=(u.__vccOpts||u)[e];d&&i.push(Cs(d,t,r,o,a,s))}else{let c=u();i.push(()=>c.then(d=>{if(!d)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=QT(d)?d.default:d;o.mods[a]=d,o.components[a]=f;const _=(f.__vccOpts||f)[e];return _&&Cs(_,t,r,o,a,s)()}))}}return i}function Eg(n){const e=ar(gd),t=ar(rp),r=We(()=>{const u=Qr(n.to);return e.resolve(u)}),s=We(()=>{const{matched:u}=r.value,{length:c}=u,d=u[c-1],f=t.matched;if(!d||!f.length)return-1;const g=f.findIndex(Zo.bind(null,d));if(g>-1)return g;const _=Tg(u[c-2]);return c>1&&Tg(d)===_&&f[f.length-1].path!==_?f.findIndex(Zo.bind(null,u[c-2])):g}),i=We(()=>s.value>-1&&Hx(t.params,r.value.params)),o=We(()=>s.value>-1&&s.value===t.matched.length-1&&V_(t.params,r.value.params));function a(u={}){if(Kx(u)){const c=e[Qr(n.replace)?"replace":"push"](Qr(n.to)).catch(wl);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:We(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function qx(n){return n.length===1?n[0]:n}const zx=Xy({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:Eg,setup(n,{slots:e}){const t=ud(Eg(n)),{options:r}=ar(gd),s=We(()=>({[xg(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[xg(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&qx(e.default(t));return n.custom?i:E_("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),Gx=zx;function Kx(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function Hx(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!lr(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function Tg(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const xg=(n,e,t)=>n??e??t,Wx=Xy({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=ar(rf),s=We(()=>n.route||r.value),i=ar(Ig,0),o=We(()=>{let c=Qr(i);const{matched:d}=s.value;let f;for(;(f=d[c])&&!f.components;)c++;return c}),a=We(()=>s.value.matched[o.value]);ic(Ig,We(()=>o.value+1)),ic(Bx,a),ic(rf,s);const u=O();return Yt(()=>[u.value,a.value,n.name],([c,d,f],[g,_,C])=>{d&&(d.instances[f]=c,_&&_!==d&&c&&c===g&&(d.leaveGuards.size||(d.leaveGuards=_.leaveGuards),d.updateGuards.size||(d.updateGuards=_.updateGuards))),c&&d&&(!_||!Zo(d,_)||!g)&&(d.enterCallbacks[f]||[]).forEach(T=>T(c))},{flush:"post"}),()=>{const c=s.value,d=n.name,f=a.value,g=f&&f.components[d];if(!g)return Ag(t.default,{Component:g,route:c});const _=f.props[d],C=_?_===!0?c.params:typeof _=="function"?_(c):_:null,k=E_(g,st({},C,e,{onVnodeUnmounted:j=>{j.component.isUnmounted&&(f.instances[d]=null)},ref:u}));return Ag(t.default,{Component:k,route:c})||k}}});function Ag(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const Qx=Wx;function Jx(n){const e=Ox(n.routes,n),t=n.parseQuery||$x,r=n.stringifyQuery||wg,s=n.history,i=Za(),o=Za(),a=Za(),u=iE(Ts);let c=Ts;No&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const d=wh.bind(null,W=>""+W),f=wh.bind(null,lx),g=wh.bind(null,Ol);function _(W,ge){let he,ne;return O_(W)?(he=e.getRecordMatcher(W),ne=ge):ne=W,e.addRoute(ne,he)}function C(W){const ge=e.getRecordMatcher(W);ge&&e.removeRoute(ge)}function T(){return e.getRoutes().map(W=>W.record)}function k(W){return!!e.getRecordMatcher(W)}function j(W,ge){if(ge=st({},ge||u.value),typeof W=="string"){const A=Ih(t,W,ge.path),$=e.resolve({path:A.path},ge),Z=s.createHref(A.fullPath);return st(A,$,{params:g($.params),hash:Ol(A.hash),redirectedFrom:void 0,href:Z})}let he;if(W.path!=null)he=st({},W,{path:Ih(t,W.path,ge.path).path});else{const A=st({},W.params);for(const $ in A)A[$]==null&&delete A[$];he=st({},W,{params:f(A)}),ge.params=f(ge.params)}const ne=e.resolve(he,ge),je=W.hash||"";ne.params=d(g(ne.params));const tt=dx(r,st({},W,{hash:ix(je),path:ne.path})),E=s.createHref(tt);return st({fullPath:tt,hash:je,query:r===wg?jx(W.query):W.query||{}},ne,{redirectedFrom:void 0,href:E})}function q(W){return typeof W=="string"?Ih(t,W,u.value.path):st({},W)}function U(W,ge){if(c!==W)return ea(8,{from:ge,to:W})}function z(W){return P(W)}function Y(W){return z(st(q(W),{replace:!0}))}function H(W){const ge=W.matched[W.matched.length-1];if(ge&&ge.redirect){const{redirect:he}=ge;let ne=typeof he=="function"?he(W):he;return typeof ne=="string"&&(ne=ne.includes("?")||ne.includes("#")?ne=q(ne):{path:ne},ne.params={}),st({query:W.query,hash:W.hash,params:ne.path!=null?{}:W.params},ne)}}function P(W,ge){const he=c=j(W),ne=u.value,je=W.state,tt=W.force,E=W.replace===!0,A=H(he);if(A)return P(st(q(A),{state:typeof A=="object"?st({},je,A.state):je,force:tt,replace:E}),ge||he);const $=he;$.redirectedFrom=ge;let Z;return!tt&&hx(r,ne,he)&&(Z=ea(16,{to:$,from:ne}),Re(ne,ne,!0,!1)),(Z?Promise.resolve(Z):x($,ne)).catch(K=>jr(K)?jr(K,2)?K:oe(K):Ve(K,$,ne)).then(K=>{if(K){if(jr(K,2))return P(st({replace:E},q(K.to),{state:typeof K.to=="object"?st({},je,K.to.state):je,force:tt}),ge||$)}else K=D($,ne,!0,E,je);return S($,ne,K),K})}function I(W,ge){const he=U(W,ge);return he?Promise.reject(he):Promise.resolve()}function R(W){const ge=dt.values().next().value;return ge&&typeof ge.runWithContext=="function"?ge.runWithContext(W):W()}function x(W,ge){let he;const[ne,je,tt]=Yx(W,ge);he=Eh(ne.reverse(),"beforeRouteLeave",W,ge);for(const A of ne)A.leaveGuards.forEach($=>{he.push(Cs($,W,ge))});const E=I.bind(null,W,ge);return he.push(E),Nt(he).then(()=>{he=[];for(const A of i.list())he.push(Cs(A,W,ge));return he.push(E),Nt(he)}).then(()=>{he=Eh(je,"beforeRouteUpdate",W,ge);for(const A of je)A.updateGuards.forEach($=>{he.push(Cs($,W,ge))});return he.push(E),Nt(he)}).then(()=>{he=[];for(const A of tt)if(A.beforeEnter)if(lr(A.beforeEnter))for(const $ of A.beforeEnter)he.push(Cs($,W,ge));else he.push(Cs(A.beforeEnter,W,ge));return he.push(E),Nt(he)}).then(()=>(W.matched.forEach(A=>A.enterCallbacks={}),he=Eh(tt,"beforeRouteEnter",W,ge,R),he.push(E),Nt(he))).then(()=>{he=[];for(const A of o.list())he.push(Cs(A,W,ge));return he.push(E),Nt(he)}).catch(A=>jr(A,8)?A:Promise.reject(A))}function S(W,ge,he){a.list().forEach(ne=>R(()=>ne(W,ge,he)))}function D(W,ge,he,ne,je){const tt=U(W,ge);if(tt)return tt;const E=ge===Ts,A=No?history.state:{};he&&(ne||E?s.replace(W.fullPath,st({scroll:E&&A&&A.scroll},je)):s.push(W.fullPath,je)),u.value=W,Re(W,ge,he,E),oe()}let w;function He(){w||(w=s.listen((W,ge,he)=>{if(!$t.listening)return;const ne=j(W),je=H(ne);if(je){P(st(je,{replace:!0,force:!0}),ne).catch(wl);return}c=ne;const tt=u.value;No&&bx(hg(tt.fullPath,he.delta),md()),x(ne,tt).catch(E=>jr(E,12)?E:jr(E,2)?(P(st(q(E.to),{force:!0}),ne).then(A=>{jr(A,20)&&!he.delta&&he.type===Ml.pop&&s.go(-1,!1)}).catch(wl),Promise.reject()):(he.delta&&s.go(-he.delta,!1),Ve(E,ne,tt))).then(E=>{E=E||D(ne,tt,!1),E&&(he.delta&&!jr(E,8)?s.go(-he.delta,!1):he.type===Ml.pop&&jr(E,20)&&s.go(-1,!1)),S(ne,tt,E)}).catch(wl)}))}let Fe=Za(),et=Za(),$e;function Ve(W,ge,he){oe(W);const ne=et.list();return ne.length?ne.forEach(je=>je(W,ge,he)):console.error(W),Promise.reject(W)}function Ie(){return $e&&u.value!==Ts?Promise.resolve():new Promise((W,ge)=>{Fe.add([W,ge])})}function oe(W){return $e||($e=!W,He(),Fe.list().forEach(([ge,he])=>W?he(W):ge()),Fe.reset()),W}function Re(W,ge,he,ne){const{scrollBehavior:je}=n;if(!No||!je)return Promise.resolve();const tt=!he&&wx(hg(W.fullPath,0))||(ne||!he)&&history.state&&history.state.scroll||null;return Bn().then(()=>je(W,ge,tt)).then(E=>E&&_x(E)).catch(E=>Ve(E,W,ge))}const _e=W=>s.go(W);let Le;const dt=new Set,$t={currentRoute:u,listening:!0,addRoute:_,removeRoute:C,clearRoutes:e.clearRoutes,hasRoute:k,getRoutes:T,resolve:j,options:n,push:z,replace:Y,go:_e,back:()=>_e(-1),forward:()=>_e(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:et.add,isReady:Ie,install(W){const ge=this;W.component("RouterLink",Gx),W.component("RouterView",Qx),W.config.globalProperties.$router=ge,Object.defineProperty(W.config.globalProperties,"$route",{enumerable:!0,get:()=>Qr(u)}),No&&!Le&&u.value===Ts&&(Le=!0,z(s.location).catch(je=>{}));const he={};for(const je in Ts)Object.defineProperty(he,je,{get:()=>u.value[je],enumerable:!0});W.provide(gd,ge),W.provide(rp,qy(he)),W.provide(rf,u);const ne=W.unmount;dt.add(W),W.unmount=function(){dt.delete(W),dt.size<1&&(c=Ts,w&&w(),w=null,u.value=Ts,Le=!1,$e=!1),ne()}}};function Nt(W){return W.reduce((ge,he)=>ge.then(()=>R(he)),Promise.resolve())}return $t}function Yx(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(c=>Zo(c,a))?r.push(a):t.push(a));const u=n.matched[o];u&&(e.matched.find(c=>Zo(c,u))||s.push(u))}return[t,r,s]}function su(){return ar(gd)}function iu(n){return ar(rp)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U_=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Xx=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],u=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},$_={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,u=s+2<n.length,c=u?n[s+2]:0,d=i>>2,f=(i&3)<<4|a>>4;let g=(a&15)<<2|c>>6,_=c&63;u||(_=64,o||(g=64)),r.push(t[d],t[f],t[g],t[_])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(U_(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Xx(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||f==null)throw new Zx;const g=i<<2|a>>4;if(r.push(g),c!==64){const _=a<<4&240|c>>2;if(r.push(_),f!==64){const C=c<<6&192|f;r.push(C)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Zx extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const eA=function(n){const e=U_(n);return $_.encodeByteArray(e,!0)},Vc=function(n){return eA(n).replace(/\./g,"")},j_=function(n){try{return $_.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tA(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nA=()=>tA().__FIREBASE_DEFAULTS__,rA=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},sA=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&j_(n[1]);return e&&JSON.parse(e)},vd=()=>{try{return nA()||rA()||sA()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},B_=n=>{var e,t;return(t=(e=vd())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},iA=n=>{const e=B_(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},q_=()=>{var n;return(n=vd())===null||n===void 0?void 0:n.config},z_=n=>{var e;return(e=vd())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oA{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aA(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[Vc(JSON.stringify(t)),Vc(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function lA(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(tn())}function uA(){var n;const e=(n=vd())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function cA(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function dA(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function hA(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function fA(){const n=tn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function G_(){return!uA()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function K_(){try{return typeof indexedDB=="object"}catch{return!1}}function pA(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mA="FirebaseError";class os extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=mA,Object.setPrototypeOf(this,os.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ou.prototype.create)}}class ou{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?gA(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new os(s,a,r)}}function gA(n,e){return n.replace(vA,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const vA=/\{\$([^}]+)}/g;function yA(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Hs(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(Pg(i)&&Pg(o)){if(!Hs(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Pg(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _a(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function al(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function ll(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function _A(n,e){const t=new bA(n,e);return t.subscribe.bind(t)}class bA{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");wA(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Th),s.error===void 0&&(s.error=Th),s.complete===void 0&&(s.complete=Th);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function wA(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Th(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xe(n){return n&&n._delegate?n._delegate:n}class $i{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ai="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IA{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new oA;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(TA(e))try{this.getOrInitializeService({instanceIdentifier:Ai})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Ai){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ai){return this.instances.has(e)}getOptions(e=Ai){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:EA(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Ai){return this.component?this.component.multipleInstances?e:Ai:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function EA(n){return n===Ai?void 0:n}function TA(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xA{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new IA(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ye;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Ye||(Ye={}));const AA={debug:Ye.DEBUG,verbose:Ye.VERBOSE,info:Ye.INFO,warn:Ye.WARN,error:Ye.ERROR,silent:Ye.SILENT},PA=Ye.INFO,SA={[Ye.DEBUG]:"log",[Ye.VERBOSE]:"log",[Ye.INFO]:"info",[Ye.WARN]:"warn",[Ye.ERROR]:"error"},RA=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=SA[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class sp{constructor(e){this.name=e,this._logLevel=PA,this._logHandler=RA,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ye))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?AA[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ye.DEBUG,...e),this._logHandler(this,Ye.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ye.VERBOSE,...e),this._logHandler(this,Ye.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ye.INFO,...e),this._logHandler(this,Ye.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ye.WARN,...e),this._logHandler(this,Ye.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ye.ERROR,...e),this._logHandler(this,Ye.ERROR,...e)}}const CA=(n,e)=>e.some(t=>n instanceof t);let Sg,Rg;function kA(){return Sg||(Sg=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function DA(){return Rg||(Rg=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const H_=new WeakMap,sf=new WeakMap,W_=new WeakMap,xh=new WeakMap,ip=new WeakMap;function VA(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t($s(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&H_.set(t,n)}).catch(()=>{}),ip.set(e,n),e}function NA(n){if(sf.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});sf.set(n,e)}let of={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return sf.get(n);if(e==="objectStoreNames")return n.objectStoreNames||W_.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return $s(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function OA(n){of=n(of)}function MA(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Ah(this),e,...t);return W_.set(r,e.sort?e.sort():[e]),$s(r)}:DA().includes(n)?function(...e){return n.apply(Ah(this),e),$s(H_.get(this))}:function(...e){return $s(n.apply(Ah(this),e))}}function LA(n){return typeof n=="function"?MA(n):(n instanceof IDBTransaction&&NA(n),CA(n,kA())?new Proxy(n,of):n)}function $s(n){if(n instanceof IDBRequest)return VA(n);if(xh.has(n))return xh.get(n);const e=LA(n);return e!==n&&(xh.set(n,e),ip.set(e,n)),e}const Ah=n=>ip.get(n);function FA(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=$s(o);return r&&o.addEventListener("upgradeneeded",u=>{r($s(o.result),u.oldVersion,u.newVersion,$s(o.transaction),u)}),t&&o.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),a.then(u=>{i&&u.addEventListener("close",()=>i()),s&&u.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const UA=["get","getKey","getAll","getAllKeys","count"],$A=["put","add","delete","clear"],Ph=new Map;function Cg(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Ph.get(e))return Ph.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=$A.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||UA.includes(t)))return;const i=async function(o,...a){const u=this.transaction(o,s?"readwrite":"readonly");let c=u.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&u.done]))[0]};return Ph.set(e,i),i}OA(n=>({...n,get:(e,t,r)=>Cg(e,t)||n.get(e,t,r),has:(e,t)=>!!Cg(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jA{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(BA(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function BA(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const af="@firebase/app",kg="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zr=new sp("@firebase/app"),qA="@firebase/app-compat",zA="@firebase/analytics-compat",GA="@firebase/analytics",KA="@firebase/app-check-compat",HA="@firebase/app-check",WA="@firebase/auth",QA="@firebase/auth-compat",JA="@firebase/database",YA="@firebase/data-connect",XA="@firebase/database-compat",ZA="@firebase/functions",eP="@firebase/functions-compat",tP="@firebase/installations",nP="@firebase/installations-compat",rP="@firebase/messaging",sP="@firebase/messaging-compat",iP="@firebase/performance",oP="@firebase/performance-compat",aP="@firebase/remote-config",lP="@firebase/remote-config-compat",uP="@firebase/storage",cP="@firebase/storage-compat",dP="@firebase/firestore",hP="@firebase/vertexai-preview",fP="@firebase/firestore-compat",pP="firebase",mP="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nc="[DEFAULT]",gP={[af]:"fire-core",[qA]:"fire-core-compat",[GA]:"fire-analytics",[zA]:"fire-analytics-compat",[HA]:"fire-app-check",[KA]:"fire-app-check-compat",[WA]:"fire-auth",[QA]:"fire-auth-compat",[JA]:"fire-rtdb",[YA]:"fire-data-connect",[XA]:"fire-rtdb-compat",[ZA]:"fire-fn",[eP]:"fire-fn-compat",[tP]:"fire-iid",[nP]:"fire-iid-compat",[rP]:"fire-fcm",[sP]:"fire-fcm-compat",[iP]:"fire-perf",[oP]:"fire-perf-compat",[aP]:"fire-rc",[lP]:"fire-rc-compat",[uP]:"fire-gcs",[cP]:"fire-gcs-compat",[dP]:"fire-fst",[fP]:"fire-fst-compat",[hP]:"fire-vertex","fire-js":"fire-js",[pP]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oc=new Map,vP=new Map,lf=new Map;function Dg(n,e){try{n.container.addComponent(e)}catch(t){Zr.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function ta(n){const e=n.name;if(lf.has(e))return Zr.debug(`There were multiple attempts to register component ${e}.`),!1;lf.set(e,n);for(const t of Oc.values())Dg(t,n);for(const t of vP.values())Dg(t,n);return!0}function au(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function yP(n,e,t=Nc){au(n,e).clearInstance(t)}function Gt(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _P={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},js=new ou("app","Firebase",_P);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bP{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new $i("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw js.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ba=mP;function Q_(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Nc,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw js.create("bad-app-name",{appName:String(s)});if(t||(t=q_()),!t)throw js.create("no-options");const i=Oc.get(s);if(i){if(Hs(t,i.options)&&Hs(r,i.config))return i;throw js.create("duplicate-app",{appName:s})}const o=new xA(s);for(const u of lf.values())o.addComponent(u);const a=new bP(t,r,o);return Oc.set(s,a),a}function J_(n=Nc){const e=Oc.get(n);if(!e&&n===Nc&&q_())return Q_();if(!e)throw js.create("no-app",{appName:n});return e}function Bs(n,e,t){var r;let s=(r=gP[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Zr.warn(a.join(" "));return}ta(new $i(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wP="firebase-heartbeat-database",IP=1,Ll="firebase-heartbeat-store";let Sh=null;function Y_(){return Sh||(Sh=FA(wP,IP,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Ll)}catch(t){console.warn(t)}}}}).catch(n=>{throw js.create("idb-open",{originalErrorMessage:n.message})})),Sh}async function EP(n){try{const t=(await Y_()).transaction(Ll),r=await t.objectStore(Ll).get(X_(n));return await t.done,r}catch(e){if(e instanceof os)Zr.warn(e.message);else{const t=js.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Zr.warn(t.message)}}}async function Vg(n,e){try{const r=(await Y_()).transaction(Ll,"readwrite");await r.objectStore(Ll).put(e,X_(n)),await r.done}catch(t){if(t instanceof os)Zr.warn(t.message);else{const r=js.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Zr.warn(r.message)}}}function X_(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TP=1024,xP=30*24*60*60*1e3;class AP{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new SP(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Ng();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=xP}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Zr.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Ng(),{heartbeatsToSend:r,unsentEntries:s}=PP(this._heartbeatsCache.heartbeats),i=Vc(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Zr.warn(t),""}}}function Ng(){return new Date().toISOString().substring(0,10)}function PP(n,e=TP){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),Og(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Og(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class SP{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return K_()?pA().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await EP(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Vg(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Vg(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Og(n){return Vc(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RP(n){ta(new $i("platform-logger",e=>new jA(e),"PRIVATE")),ta(new $i("heartbeat",e=>new AP(e),"PRIVATE")),Bs(af,kg,n),Bs(af,kg,"esm2017"),Bs("fire-js","")}RP("");var CP="firebase",kP="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Bs(CP,kP,"app");var Mg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Mi,Z_;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(P,I){function R(){}R.prototype=I.prototype,P.D=I.prototype,P.prototype=new R,P.prototype.constructor=P,P.C=function(x,S,D){for(var w=Array(arguments.length-2),He=2;He<arguments.length;He++)w[He-2]=arguments[He];return I.prototype[S].apply(x,w)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(P,I,R){R||(R=0);var x=Array(16);if(typeof I=="string")for(var S=0;16>S;++S)x[S]=I.charCodeAt(R++)|I.charCodeAt(R++)<<8|I.charCodeAt(R++)<<16|I.charCodeAt(R++)<<24;else for(S=0;16>S;++S)x[S]=I[R++]|I[R++]<<8|I[R++]<<16|I[R++]<<24;I=P.g[0],R=P.g[1],S=P.g[2];var D=P.g[3],w=I+(D^R&(S^D))+x[0]+3614090360&4294967295;I=R+(w<<7&4294967295|w>>>25),w=D+(S^I&(R^S))+x[1]+3905402710&4294967295,D=I+(w<<12&4294967295|w>>>20),w=S+(R^D&(I^R))+x[2]+606105819&4294967295,S=D+(w<<17&4294967295|w>>>15),w=R+(I^S&(D^I))+x[3]+3250441966&4294967295,R=S+(w<<22&4294967295|w>>>10),w=I+(D^R&(S^D))+x[4]+4118548399&4294967295,I=R+(w<<7&4294967295|w>>>25),w=D+(S^I&(R^S))+x[5]+1200080426&4294967295,D=I+(w<<12&4294967295|w>>>20),w=S+(R^D&(I^R))+x[6]+2821735955&4294967295,S=D+(w<<17&4294967295|w>>>15),w=R+(I^S&(D^I))+x[7]+4249261313&4294967295,R=S+(w<<22&4294967295|w>>>10),w=I+(D^R&(S^D))+x[8]+1770035416&4294967295,I=R+(w<<7&4294967295|w>>>25),w=D+(S^I&(R^S))+x[9]+2336552879&4294967295,D=I+(w<<12&4294967295|w>>>20),w=S+(R^D&(I^R))+x[10]+4294925233&4294967295,S=D+(w<<17&4294967295|w>>>15),w=R+(I^S&(D^I))+x[11]+2304563134&4294967295,R=S+(w<<22&4294967295|w>>>10),w=I+(D^R&(S^D))+x[12]+1804603682&4294967295,I=R+(w<<7&4294967295|w>>>25),w=D+(S^I&(R^S))+x[13]+4254626195&4294967295,D=I+(w<<12&4294967295|w>>>20),w=S+(R^D&(I^R))+x[14]+2792965006&4294967295,S=D+(w<<17&4294967295|w>>>15),w=R+(I^S&(D^I))+x[15]+1236535329&4294967295,R=S+(w<<22&4294967295|w>>>10),w=I+(S^D&(R^S))+x[1]+4129170786&4294967295,I=R+(w<<5&4294967295|w>>>27),w=D+(R^S&(I^R))+x[6]+3225465664&4294967295,D=I+(w<<9&4294967295|w>>>23),w=S+(I^R&(D^I))+x[11]+643717713&4294967295,S=D+(w<<14&4294967295|w>>>18),w=R+(D^I&(S^D))+x[0]+3921069994&4294967295,R=S+(w<<20&4294967295|w>>>12),w=I+(S^D&(R^S))+x[5]+3593408605&4294967295,I=R+(w<<5&4294967295|w>>>27),w=D+(R^S&(I^R))+x[10]+38016083&4294967295,D=I+(w<<9&4294967295|w>>>23),w=S+(I^R&(D^I))+x[15]+3634488961&4294967295,S=D+(w<<14&4294967295|w>>>18),w=R+(D^I&(S^D))+x[4]+3889429448&4294967295,R=S+(w<<20&4294967295|w>>>12),w=I+(S^D&(R^S))+x[9]+568446438&4294967295,I=R+(w<<5&4294967295|w>>>27),w=D+(R^S&(I^R))+x[14]+3275163606&4294967295,D=I+(w<<9&4294967295|w>>>23),w=S+(I^R&(D^I))+x[3]+4107603335&4294967295,S=D+(w<<14&4294967295|w>>>18),w=R+(D^I&(S^D))+x[8]+1163531501&4294967295,R=S+(w<<20&4294967295|w>>>12),w=I+(S^D&(R^S))+x[13]+2850285829&4294967295,I=R+(w<<5&4294967295|w>>>27),w=D+(R^S&(I^R))+x[2]+4243563512&4294967295,D=I+(w<<9&4294967295|w>>>23),w=S+(I^R&(D^I))+x[7]+1735328473&4294967295,S=D+(w<<14&4294967295|w>>>18),w=R+(D^I&(S^D))+x[12]+2368359562&4294967295,R=S+(w<<20&4294967295|w>>>12),w=I+(R^S^D)+x[5]+4294588738&4294967295,I=R+(w<<4&4294967295|w>>>28),w=D+(I^R^S)+x[8]+2272392833&4294967295,D=I+(w<<11&4294967295|w>>>21),w=S+(D^I^R)+x[11]+1839030562&4294967295,S=D+(w<<16&4294967295|w>>>16),w=R+(S^D^I)+x[14]+4259657740&4294967295,R=S+(w<<23&4294967295|w>>>9),w=I+(R^S^D)+x[1]+2763975236&4294967295,I=R+(w<<4&4294967295|w>>>28),w=D+(I^R^S)+x[4]+1272893353&4294967295,D=I+(w<<11&4294967295|w>>>21),w=S+(D^I^R)+x[7]+4139469664&4294967295,S=D+(w<<16&4294967295|w>>>16),w=R+(S^D^I)+x[10]+3200236656&4294967295,R=S+(w<<23&4294967295|w>>>9),w=I+(R^S^D)+x[13]+681279174&4294967295,I=R+(w<<4&4294967295|w>>>28),w=D+(I^R^S)+x[0]+3936430074&4294967295,D=I+(w<<11&4294967295|w>>>21),w=S+(D^I^R)+x[3]+3572445317&4294967295,S=D+(w<<16&4294967295|w>>>16),w=R+(S^D^I)+x[6]+76029189&4294967295,R=S+(w<<23&4294967295|w>>>9),w=I+(R^S^D)+x[9]+3654602809&4294967295,I=R+(w<<4&4294967295|w>>>28),w=D+(I^R^S)+x[12]+3873151461&4294967295,D=I+(w<<11&4294967295|w>>>21),w=S+(D^I^R)+x[15]+530742520&4294967295,S=D+(w<<16&4294967295|w>>>16),w=R+(S^D^I)+x[2]+3299628645&4294967295,R=S+(w<<23&4294967295|w>>>9),w=I+(S^(R|~D))+x[0]+4096336452&4294967295,I=R+(w<<6&4294967295|w>>>26),w=D+(R^(I|~S))+x[7]+1126891415&4294967295,D=I+(w<<10&4294967295|w>>>22),w=S+(I^(D|~R))+x[14]+2878612391&4294967295,S=D+(w<<15&4294967295|w>>>17),w=R+(D^(S|~I))+x[5]+4237533241&4294967295,R=S+(w<<21&4294967295|w>>>11),w=I+(S^(R|~D))+x[12]+1700485571&4294967295,I=R+(w<<6&4294967295|w>>>26),w=D+(R^(I|~S))+x[3]+2399980690&4294967295,D=I+(w<<10&4294967295|w>>>22),w=S+(I^(D|~R))+x[10]+4293915773&4294967295,S=D+(w<<15&4294967295|w>>>17),w=R+(D^(S|~I))+x[1]+2240044497&4294967295,R=S+(w<<21&4294967295|w>>>11),w=I+(S^(R|~D))+x[8]+1873313359&4294967295,I=R+(w<<6&4294967295|w>>>26),w=D+(R^(I|~S))+x[15]+4264355552&4294967295,D=I+(w<<10&4294967295|w>>>22),w=S+(I^(D|~R))+x[6]+2734768916&4294967295,S=D+(w<<15&4294967295|w>>>17),w=R+(D^(S|~I))+x[13]+1309151649&4294967295,R=S+(w<<21&4294967295|w>>>11),w=I+(S^(R|~D))+x[4]+4149444226&4294967295,I=R+(w<<6&4294967295|w>>>26),w=D+(R^(I|~S))+x[11]+3174756917&4294967295,D=I+(w<<10&4294967295|w>>>22),w=S+(I^(D|~R))+x[2]+718787259&4294967295,S=D+(w<<15&4294967295|w>>>17),w=R+(D^(S|~I))+x[9]+3951481745&4294967295,P.g[0]=P.g[0]+I&4294967295,P.g[1]=P.g[1]+(S+(w<<21&4294967295|w>>>11))&4294967295,P.g[2]=P.g[2]+S&4294967295,P.g[3]=P.g[3]+D&4294967295}r.prototype.u=function(P,I){I===void 0&&(I=P.length);for(var R=I-this.blockSize,x=this.B,S=this.h,D=0;D<I;){if(S==0)for(;D<=R;)s(this,P,D),D+=this.blockSize;if(typeof P=="string"){for(;D<I;)if(x[S++]=P.charCodeAt(D++),S==this.blockSize){s(this,x),S=0;break}}else for(;D<I;)if(x[S++]=P[D++],S==this.blockSize){s(this,x),S=0;break}}this.h=S,this.o+=I},r.prototype.v=function(){var P=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);P[0]=128;for(var I=1;I<P.length-8;++I)P[I]=0;var R=8*this.o;for(I=P.length-8;I<P.length;++I)P[I]=R&255,R/=256;for(this.u(P),P=Array(16),I=R=0;4>I;++I)for(var x=0;32>x;x+=8)P[R++]=this.g[I]>>>x&255;return P};function i(P,I){var R=a;return Object.prototype.hasOwnProperty.call(R,P)?R[P]:R[P]=I(P)}function o(P,I){this.h=I;for(var R=[],x=!0,S=P.length-1;0<=S;S--){var D=P[S]|0;x&&D==I||(R[S]=D,x=!1)}this.g=R}var a={};function u(P){return-128<=P&&128>P?i(P,function(I){return new o([I|0],0>I?-1:0)}):new o([P|0],0>P?-1:0)}function c(P){if(isNaN(P)||!isFinite(P))return f;if(0>P)return k(c(-P));for(var I=[],R=1,x=0;P>=R;x++)I[x]=P/R|0,R*=4294967296;return new o(I,0)}function d(P,I){if(P.length==0)throw Error("number format error: empty string");if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(P.charAt(0)=="-")return k(d(P.substring(1),I));if(0<=P.indexOf("-"))throw Error('number format error: interior "-" character');for(var R=c(Math.pow(I,8)),x=f,S=0;S<P.length;S+=8){var D=Math.min(8,P.length-S),w=parseInt(P.substring(S,S+D),I);8>D?(D=c(Math.pow(I,D)),x=x.j(D).add(c(w))):(x=x.j(R),x=x.add(c(w)))}return x}var f=u(0),g=u(1),_=u(16777216);n=o.prototype,n.m=function(){if(T(this))return-k(this).m();for(var P=0,I=1,R=0;R<this.g.length;R++){var x=this.i(R);P+=(0<=x?x:4294967296+x)*I,I*=4294967296}return P},n.toString=function(P){if(P=P||10,2>P||36<P)throw Error("radix out of range: "+P);if(C(this))return"0";if(T(this))return"-"+k(this).toString(P);for(var I=c(Math.pow(P,6)),R=this,x="";;){var S=z(R,I).g;R=j(R,S.j(I));var D=((0<R.g.length?R.g[0]:R.h)>>>0).toString(P);if(R=S,C(R))return D+x;for(;6>D.length;)D="0"+D;x=D+x}},n.i=function(P){return 0>P?0:P<this.g.length?this.g[P]:this.h};function C(P){if(P.h!=0)return!1;for(var I=0;I<P.g.length;I++)if(P.g[I]!=0)return!1;return!0}function T(P){return P.h==-1}n.l=function(P){return P=j(this,P),T(P)?-1:C(P)?0:1};function k(P){for(var I=P.g.length,R=[],x=0;x<I;x++)R[x]=~P.g[x];return new o(R,~P.h).add(g)}n.abs=function(){return T(this)?k(this):this},n.add=function(P){for(var I=Math.max(this.g.length,P.g.length),R=[],x=0,S=0;S<=I;S++){var D=x+(this.i(S)&65535)+(P.i(S)&65535),w=(D>>>16)+(this.i(S)>>>16)+(P.i(S)>>>16);x=w>>>16,D&=65535,w&=65535,R[S]=w<<16|D}return new o(R,R[R.length-1]&-2147483648?-1:0)};function j(P,I){return P.add(k(I))}n.j=function(P){if(C(this)||C(P))return f;if(T(this))return T(P)?k(this).j(k(P)):k(k(this).j(P));if(T(P))return k(this.j(k(P)));if(0>this.l(_)&&0>P.l(_))return c(this.m()*P.m());for(var I=this.g.length+P.g.length,R=[],x=0;x<2*I;x++)R[x]=0;for(x=0;x<this.g.length;x++)for(var S=0;S<P.g.length;S++){var D=this.i(x)>>>16,w=this.i(x)&65535,He=P.i(S)>>>16,Fe=P.i(S)&65535;R[2*x+2*S]+=w*Fe,q(R,2*x+2*S),R[2*x+2*S+1]+=D*Fe,q(R,2*x+2*S+1),R[2*x+2*S+1]+=w*He,q(R,2*x+2*S+1),R[2*x+2*S+2]+=D*He,q(R,2*x+2*S+2)}for(x=0;x<I;x++)R[x]=R[2*x+1]<<16|R[2*x];for(x=I;x<2*I;x++)R[x]=0;return new o(R,0)};function q(P,I){for(;(P[I]&65535)!=P[I];)P[I+1]+=P[I]>>>16,P[I]&=65535,I++}function U(P,I){this.g=P,this.h=I}function z(P,I){if(C(I))throw Error("division by zero");if(C(P))return new U(f,f);if(T(P))return I=z(k(P),I),new U(k(I.g),k(I.h));if(T(I))return I=z(P,k(I)),new U(k(I.g),I.h);if(30<P.g.length){if(T(P)||T(I))throw Error("slowDivide_ only works with positive integers.");for(var R=g,x=I;0>=x.l(P);)R=Y(R),x=Y(x);var S=H(R,1),D=H(x,1);for(x=H(x,2),R=H(R,2);!C(x);){var w=D.add(x);0>=w.l(P)&&(S=S.add(R),D=w),x=H(x,1),R=H(R,1)}return I=j(P,S.j(I)),new U(S,I)}for(S=f;0<=P.l(I);){for(R=Math.max(1,Math.floor(P.m()/I.m())),x=Math.ceil(Math.log(R)/Math.LN2),x=48>=x?1:Math.pow(2,x-48),D=c(R),w=D.j(I);T(w)||0<w.l(P);)R-=x,D=c(R),w=D.j(I);C(D)&&(D=g),S=S.add(D),P=j(P,w)}return new U(S,P)}n.A=function(P){return z(this,P).h},n.and=function(P){for(var I=Math.max(this.g.length,P.g.length),R=[],x=0;x<I;x++)R[x]=this.i(x)&P.i(x);return new o(R,this.h&P.h)},n.or=function(P){for(var I=Math.max(this.g.length,P.g.length),R=[],x=0;x<I;x++)R[x]=this.i(x)|P.i(x);return new o(R,this.h|P.h)},n.xor=function(P){for(var I=Math.max(this.g.length,P.g.length),R=[],x=0;x<I;x++)R[x]=this.i(x)^P.i(x);return new o(R,this.h^P.h)};function Y(P){for(var I=P.g.length+1,R=[],x=0;x<I;x++)R[x]=P.i(x)<<1|P.i(x-1)>>>31;return new o(R,P.h)}function H(P,I){var R=I>>5;I%=32;for(var x=P.g.length-R,S=[],D=0;D<x;D++)S[D]=0<I?P.i(D+R)>>>I|P.i(D+R+1)<<32-I:P.i(D+R);return new o(S,P.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Z_=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=d,Mi=o}).apply(typeof Mg<"u"?Mg:typeof self<"u"?self:typeof window<"u"?window:{});var Qu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var e0,ul,t0,uc,uf,n0,r0,s0;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,h,m){return l==Array.prototype||l==Object.prototype||(l[h]=m.value),l};function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof Qu=="object"&&Qu];for(var h=0;h<l.length;++h){var m=l[h];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}var r=t(this);function s(l,h){if(h)e:{var m=r;l=l.split(".");for(var y=0;y<l.length-1;y++){var V=l[y];if(!(V in m))break e;m=m[V]}l=l[l.length-1],y=m[l],h=h(y),h!=y&&h!=null&&e(m,l,{configurable:!0,writable:!0,value:h})}}function i(l,h){l instanceof String&&(l+="");var m=0,y=!1,V={next:function(){if(!y&&m<l.length){var L=m++;return{value:h(L,l[L]),done:!1}}return y=!0,{done:!0,value:void 0}}};return V[Symbol.iterator]=function(){return V},V}s("Array.prototype.values",function(l){return l||function(){return i(this,function(h,m){return m})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function u(l){var h=typeof l;return h=h!="object"?h:l?Array.isArray(l)?"array":h:"null",h=="array"||h=="object"&&typeof l.length=="number"}function c(l){var h=typeof l;return h=="object"&&l!=null||h=="function"}function d(l,h,m){return l.call.apply(l.bind,arguments)}function f(l,h,m){if(!l)throw Error();if(2<arguments.length){var y=Array.prototype.slice.call(arguments,2);return function(){var V=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(V,y),l.apply(h,V)}}return function(){return l.apply(h,arguments)}}function g(l,h,m){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,g.apply(null,arguments)}function _(l,h){var m=Array.prototype.slice.call(arguments,1);return function(){var y=m.slice();return y.push.apply(y,arguments),l.apply(this,y)}}function C(l,h){function m(){}m.prototype=h.prototype,l.aa=h.prototype,l.prototype=new m,l.prototype.constructor=l,l.Qb=function(y,V,L){for(var se=Array(arguments.length-2),Ce=2;Ce<arguments.length;Ce++)se[Ce-2]=arguments[Ce];return h.prototype[V].apply(y,se)}}function T(l){const h=l.length;if(0<h){const m=Array(h);for(let y=0;y<h;y++)m[y]=l[y];return m}return[]}function k(l,h){for(let m=1;m<arguments.length;m++){const y=arguments[m];if(u(y)){const V=l.length||0,L=y.length||0;l.length=V+L;for(let se=0;se<L;se++)l[V+se]=y[se]}else l.push(y)}}class j{constructor(h,m){this.i=h,this.j=m,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function q(l){return/^[\s\xa0]*$/.test(l)}function U(){var l=a.navigator;return l&&(l=l.userAgent)?l:""}function z(l){return z[" "](l),l}z[" "]=function(){};var Y=U().indexOf("Gecko")!=-1&&!(U().toLowerCase().indexOf("webkit")!=-1&&U().indexOf("Edge")==-1)&&!(U().indexOf("Trident")!=-1||U().indexOf("MSIE")!=-1)&&U().indexOf("Edge")==-1;function H(l,h,m){for(const y in l)h.call(m,l[y],y,l)}function P(l,h){for(const m in l)h.call(void 0,l[m],m,l)}function I(l){const h={};for(const m in l)h[m]=l[m];return h}const R="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function x(l,h){let m,y;for(let V=1;V<arguments.length;V++){y=arguments[V];for(m in y)l[m]=y[m];for(let L=0;L<R.length;L++)m=R[L],Object.prototype.hasOwnProperty.call(y,m)&&(l[m]=y[m])}}function S(l){var h=1;l=l.split(":");const m=[];for(;0<h&&l.length;)m.push(l.shift()),h--;return l.length&&m.push(l.join(":")),m}function D(l){a.setTimeout(()=>{throw l},0)}function w(){var l=Ie;let h=null;return l.g&&(h=l.g,l.g=l.g.next,l.g||(l.h=null),h.next=null),h}class He{constructor(){this.h=this.g=null}add(h,m){const y=Fe.get();y.set(h,m),this.h?this.h.next=y:this.g=y,this.h=y}}var Fe=new j(()=>new et,l=>l.reset());class et{constructor(){this.next=this.g=this.h=null}set(h,m){this.h=h,this.g=m,this.next=null}reset(){this.next=this.g=this.h=null}}let $e,Ve=!1,Ie=new He,oe=()=>{const l=a.Promise.resolve(void 0);$e=()=>{l.then(Re)}};var Re=()=>{for(var l;l=w();){try{l.h.call(l.g)}catch(m){D(m)}var h=Fe;h.j(l),100>h.h&&(h.h++,l.next=h.g,h.g=l)}Ve=!1};function _e(){this.s=this.s,this.C=this.C}_e.prototype.s=!1,_e.prototype.ma=function(){this.s||(this.s=!0,this.N())},_e.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Le(l,h){this.type=l,this.g=this.target=h,this.defaultPrevented=!1}Le.prototype.h=function(){this.defaultPrevented=!0};var dt=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var l=!1,h=Object.defineProperty({},"passive",{get:function(){l=!0}});try{const m=()=>{};a.addEventListener("test",m,h),a.removeEventListener("test",m,h)}catch{}return l}();function $t(l,h){if(Le.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var m=this.type=l.type,y=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=h,h=l.relatedTarget){if(Y){e:{try{z(h.nodeName);var V=!0;break e}catch{}V=!1}V||(h=null)}}else m=="mouseover"?h=l.fromElement:m=="mouseout"&&(h=l.toElement);this.relatedTarget=h,y?(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:Nt[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&$t.aa.h.call(this)}}C($t,Le);var Nt={2:"touch",3:"pen",4:"mouse"};$t.prototype.h=function(){$t.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var W="closure_listenable_"+(1e6*Math.random()|0),ge=0;function he(l,h,m,y,V){this.listener=l,this.proxy=null,this.src=h,this.type=m,this.capture=!!y,this.ha=V,this.key=++ge,this.da=this.fa=!1}function ne(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function je(l){this.src=l,this.g={},this.h=0}je.prototype.add=function(l,h,m,y,V){var L=l.toString();l=this.g[L],l||(l=this.g[L]=[],this.h++);var se=E(l,h,y,V);return-1<se?(h=l[se],m||(h.fa=!1)):(h=new he(h,this.src,L,!!y,V),h.fa=m,l.push(h)),h};function tt(l,h){var m=h.type;if(m in l.g){var y=l.g[m],V=Array.prototype.indexOf.call(y,h,void 0),L;(L=0<=V)&&Array.prototype.splice.call(y,V,1),L&&(ne(h),l.g[m].length==0&&(delete l.g[m],l.h--))}}function E(l,h,m,y){for(var V=0;V<l.length;++V){var L=l[V];if(!L.da&&L.listener==h&&L.capture==!!m&&L.ha==y)return V}return-1}var A="closure_lm_"+(1e6*Math.random()|0),$={};function Z(l,h,m,y,V){if(y&&y.once)return pe(l,h,m,y,V);if(Array.isArray(h)){for(var L=0;L<h.length;L++)Z(l,h[L],m,y,V);return null}return m=Pe(m),l&&l[W]?l.K(h,m,c(y)?!!y.capture:!!y,V):K(l,h,m,!1,y,V)}function K(l,h,m,y,V,L){if(!h)throw Error("Invalid event type");var se=c(V)?!!V.capture:!!V,Ce=fe(l);if(Ce||(l[A]=Ce=new je(l)),m=Ce.add(h,m,y,se,L),m.proxy)return m;if(y=X(),m.proxy=y,y.src=l,y.listener=m,l.addEventListener)dt||(V=se),V===void 0&&(V=!1),l.addEventListener(h.toString(),y,V);else if(l.attachEvent)l.attachEvent(re(h.toString()),y);else if(l.addListener&&l.removeListener)l.addListener(y);else throw Error("addEventListener and attachEvent are unavailable.");return m}function X(){function l(m){return h.call(l.src,l.listener,m)}const h=Ee;return l}function pe(l,h,m,y,V){if(Array.isArray(h)){for(var L=0;L<h.length;L++)pe(l,h[L],m,y,V);return null}return m=Pe(m),l&&l[W]?l.L(h,m,c(y)?!!y.capture:!!y,V):K(l,h,m,!0,y,V)}function ae(l,h,m,y,V){if(Array.isArray(h))for(var L=0;L<h.length;L++)ae(l,h[L],m,y,V);else y=c(y)?!!y.capture:!!y,m=Pe(m),l&&l[W]?(l=l.i,h=String(h).toString(),h in l.g&&(L=l.g[h],m=E(L,m,y,V),-1<m&&(ne(L[m]),Array.prototype.splice.call(L,m,1),L.length==0&&(delete l.g[h],l.h--)))):l&&(l=fe(l))&&(h=l.g[h.toString()],l=-1,h&&(l=E(h,m,y,V)),(m=-1<l?h[l]:null)&&ie(m))}function ie(l){if(typeof l!="number"&&l&&!l.da){var h=l.src;if(h&&h[W])tt(h.i,l);else{var m=l.type,y=l.proxy;h.removeEventListener?h.removeEventListener(m,y,l.capture):h.detachEvent?h.detachEvent(re(m),y):h.addListener&&h.removeListener&&h.removeListener(y),(m=fe(h))?(tt(m,l),m.h==0&&(m.src=null,h[A]=null)):ne(l)}}}function re(l){return l in $?$[l]:$[l]="on"+l}function Ee(l,h){if(l.da)l=!0;else{h=new $t(h,this);var m=l.listener,y=l.ha||l.src;l.fa&&ie(l),l=m.call(y,h)}return l}function fe(l){return l=l[A],l instanceof je?l:null}var be="__closure_events_fn_"+(1e9*Math.random()>>>0);function Pe(l){return typeof l=="function"?l:(l[be]||(l[be]=function(h){return l.handleEvent(h)}),l[be])}function Ae(){_e.call(this),this.i=new je(this),this.M=this,this.F=null}C(Ae,_e),Ae.prototype[W]=!0,Ae.prototype.removeEventListener=function(l,h,m,y){ae(this,l,h,m,y)};function Be(l,h){var m,y=l.F;if(y)for(m=[];y;y=y.F)m.push(y);if(l=l.M,y=h.type||h,typeof h=="string")h=new Le(h,l);else if(h instanceof Le)h.target=h.target||l;else{var V=h;h=new Le(y,l),x(h,V)}if(V=!0,m)for(var L=m.length-1;0<=L;L--){var se=h.g=m[L];V=ze(se,y,!0,h)&&V}if(se=h.g=l,V=ze(se,y,!0,h)&&V,V=ze(se,y,!1,h)&&V,m)for(L=0;L<m.length;L++)se=h.g=m[L],V=ze(se,y,!1,h)&&V}Ae.prototype.N=function(){if(Ae.aa.N.call(this),this.i){var l=this.i,h;for(h in l.g){for(var m=l.g[h],y=0;y<m.length;y++)ne(m[y]);delete l.g[h],l.h--}}this.F=null},Ae.prototype.K=function(l,h,m,y){return this.i.add(String(l),h,!1,m,y)},Ae.prototype.L=function(l,h,m,y){return this.i.add(String(l),h,!0,m,y)};function ze(l,h,m,y){if(h=l.i.g[String(h)],!h)return!0;h=h.concat();for(var V=!0,L=0;L<h.length;++L){var se=h[L];if(se&&!se.da&&se.capture==m){var Ce=se.listener,Je=se.ha||se.src;se.fa&&tt(l.i,se),V=Ce.call(Je,y)!==!1&&V}}return V&&!y.defaultPrevented}function Tt(l,h,m){if(typeof l=="function")m&&(l=g(l,m));else if(l&&typeof l.handleEvent=="function")l=g(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:a.setTimeout(l,h||0)}function ht(l){l.g=Tt(()=>{l.g=null,l.i&&(l.i=!1,ht(l))},l.l);const h=l.h;l.h=null,l.m.apply(null,h)}class Wt extends _e{constructor(h,m){super(),this.m=h,this.l=m,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:ht(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ft(l){_e.call(this),this.h=l,this.g={}}C(ft,_e);var er=[];function ur(l){H(l.g,function(h,m){this.g.hasOwnProperty(m)&&ie(h)},l),l.g={}}ft.prototype.N=function(){ft.aa.N.call(this),ur(this)},ft.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var jt=a.JSON.stringify,kn=a.JSON.parse,xn=class{stringify(l){return a.JSON.stringify(l,void 0)}parse(l){return a.JSON.parse(l,void 0)}};function so(){}so.prototype.h=null;function Na(l){return l.h||(l.h=l.i())}function io(){}var ai={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function cn(){Le.call(this,"d")}C(cn,Le);function cr(){Le.call(this,"c")}C(cr,Le);var dr={},Oa=null;function hr(){return Oa=Oa||new Ae}dr.La="serverreachability";function ps(l){Le.call(this,dr.La,l)}C(ps,Le);function fr(l){const h=hr();Be(h,new ps(h))}dr.STAT_EVENT="statevent";function Dr(l,h){Le.call(this,dr.STAT_EVENT,l),this.stat=h}C(Dr,Le);function rn(l){const h=hr();Be(h,new Dr(h,l))}dr.Ma="timingevent";function li(l,h){Le.call(this,dr.Ma,l),this.size=h}C(li,Le);function An(l,h){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){l()},h)}function ui(){this.g=!0}ui.prototype.xa=function(){this.g=!1};function eh(l,h,m,y,V,L){l.info(function(){if(l.g)if(L)for(var se="",Ce=L.split("&"),Je=0;Je<Ce.length;Je++){var Se=Ce[Je].split("=");if(1<Se.length){var Ue=Se[0];Se=Se[1];var bt=Ue.split("_");se=2<=bt.length&&bt[1]=="type"?se+(Ue+"="+Se+"&"):se+(Ue+"=redacted&")}}else se=null;else se=L;return"XMLHTTP REQ ("+y+") [attempt "+V+"]: "+h+`
`+m+`
`+se})}function oo(l,h,m,y,V,L,se){l.info(function(){return"XMLHTTP RESP ("+y+") [ attempt "+V+"]: "+h+`
`+m+`
`+L+" "+se})}function pr(l,h,m,y){l.info(function(){return"XMLHTTP TEXT ("+h+"): "+vt(l,m)+(y?" "+y:"")})}function Ne(l,h){l.info(function(){return"TIMEOUT: "+h})}ui.prototype.info=function(){};function vt(l,h){if(!l.g)return h;if(!h)return null;try{var m=JSON.parse(h);if(m){for(l=0;l<m.length;l++)if(Array.isArray(m[l])){var y=m[l];if(!(2>y.length)){var V=y[1];if(Array.isArray(V)&&!(1>V.length)){var L=V[0];if(L!="noop"&&L!="stop"&&L!="close")for(var se=1;se<V.length;se++)V[se]=""}}}}return jt(m)}catch{return h}}var mr={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ao={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ma;function ci(){}C(ci,so),ci.prototype.g=function(){return new XMLHttpRequest},ci.prototype.i=function(){return{}},Ma=new ci;function gr(l,h,m,y){this.j=l,this.i=h,this.l=m,this.R=y||1,this.U=new ft(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ku}function ku(){this.i=null,this.g="",this.h=!1}var lo={},La={};function Vr(l,h,m){l.L=1,l.v=ho($n(h)),l.m=m,l.P=!0,di(l,null)}function di(l,h){l.F=Date.now(),vr(l),l.A=$n(l.v);var m=l.A,y=l.R;Array.isArray(y)||(y=[String(y)]),Ou(m.i,"t",y),l.C=0,m=l.j.J,l.h=new ku,l.g=Qa(l.j,m?h:null,!l.m),0<l.O&&(l.M=new Wt(g(l.Y,l,l.g),l.O)),h=l.U,m=l.g,y=l.ca;var V="readystatechange";Array.isArray(V)||(V&&(er[0]=V.toString()),V=er);for(var L=0;L<V.length;L++){var se=Z(m,V[L],y||h.handleEvent,!1,h.h||h);if(!se)break;h.g[se.key]=se}h=l.H?I(l.H):{},l.m?(l.u||(l.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,h)):(l.u="GET",l.g.ea(l.A,l.u,null,h)),fr(),eh(l.i,l.u,l.A,l.l,l.R,l.m)}gr.prototype.ca=function(l){l=l.target;const h=this.M;h&&tr(l)==3?h.j():this.Y(l)},gr.prototype.Y=function(l){try{if(l==this.g)e:{const bt=tr(this.g);var h=this.g.Ba();const mn=this.g.Z();if(!(3>bt)&&(bt!=3||this.g&&(this.h.h||this.g.oa()||Uu(this.g)))){this.J||bt!=4||h==7||(h==8||0>=mn?fr(3):fr(2)),vs(this);var m=this.g.Z();this.X=m;t:if(Nr(this)){var y=Uu(this.g);l="";var V=y.length,L=tr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Or(this),hi(this);var se="";break t}this.h.i=new a.TextDecoder}for(h=0;h<V;h++)this.h.h=!0,l+=this.h.i.decode(y[h],{stream:!(L&&h==V-1)});y.length=0,this.h.g+=l,this.C=0,se=this.h.g}else se=this.g.oa();if(this.o=m==200,oo(this.i,this.u,this.A,this.l,this.R,bt,m),this.o){if(this.T&&!this.K){t:{if(this.g){var Ce,Je=this.g;if((Ce=Je.g?Je.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!q(Ce)){var Se=Ce;break t}}Se=null}if(m=Se)pr(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Fa(this,m);else{this.o=!1,this.s=3,rn(12),Or(this),hi(this);break e}}if(this.P){m=!0;let Zt;for(;!this.J&&this.C<se.length;)if(Zt=ms(this,se),Zt==La){bt==4&&(this.s=4,rn(14),m=!1),pr(this.i,this.l,null,"[Incomplete Response]");break}else if(Zt==lo){this.s=4,rn(15),pr(this.i,this.l,se,"[Invalid Chunk]"),m=!1;break}else pr(this.i,this.l,Zt,null),Fa(this,Zt);if(Nr(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),bt!=4||se.length!=0||this.h.h||(this.s=1,rn(16),m=!1),this.o=this.o&&m,!m)pr(this.i,this.l,se,"[Invalid Chunked Response]"),Or(this),hi(this);else if(0<se.length&&!this.W){this.W=!0;var Ue=this.j;Ue.g==this&&Ue.ba&&!Ue.M&&(Ue.j.info("Great, no buffering proxy detected. Bytes received: "+se.length),Io(Ue),Ue.M=!0,rn(11))}}else pr(this.i,this.l,se,null),Fa(this,se);bt==4&&Or(this),this.o&&!this.J&&(bt==4?bi(this.j,this):(this.o=!1,vr(this)))}else $u(this.g),m==400&&0<se.indexOf("Unknown SID")?(this.s=3,rn(12)):(this.s=0,rn(13)),Or(this),hi(this)}}}catch{}finally{}};function Nr(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function ms(l,h){var m=l.C,y=h.indexOf(`
`,m);return y==-1?La:(m=Number(h.substring(m,y)),isNaN(m)?lo:(y+=1,y+m>h.length?La:(h=h.slice(y,y+m),l.C=y+m,h)))}gr.prototype.cancel=function(){this.J=!0,Or(this)};function vr(l){l.S=Date.now()+l.I,gs(l,l.I)}function gs(l,h){if(l.B!=null)throw Error("WatchDog timer not null");l.B=An(g(l.ba,l),h)}function vs(l){l.B&&(a.clearTimeout(l.B),l.B=null)}gr.prototype.ba=function(){this.B=null;const l=Date.now();0<=l-this.S?(Ne(this.i,this.A),this.L!=2&&(fr(),rn(17)),Or(this),this.s=2,hi(this)):gs(this,this.S-l)};function hi(l){l.j.G==0||l.J||bi(l.j,l)}function Or(l){vs(l);var h=l.M;h&&typeof h.ma=="function"&&h.ma(),l.M=null,ur(l.U),l.g&&(h=l.g,l.g=null,h.abort(),h.ma())}function Fa(l,h){try{var m=l.j;if(m.G!=0&&(m.g==l||at(m.h,l))){if(!l.K&&at(m.h,l)&&m.G==3){try{var y=m.Da.g.parse(h)}catch{y=null}if(Array.isArray(y)&&y.length==3){var V=y;if(V[0]==0){e:if(!m.u){if(m.g)if(m.g.F+3e3<l.F)_i(m),yo(m);else break e;wo(m),rn(18)}}else m.za=V[1],0<m.za-m.T&&37500>V[2]&&m.F&&m.v==0&&!m.C&&(m.C=An(g(m.Za,m),6e3));if(1>=Ot(m.h)&&m.ca){try{m.ca()}catch{}m.ca=void 0}}else Fr(m,11)}else if((l.K||m.g==l)&&_i(m),!q(h))for(V=m.Da.g.parse(h),h=0;h<V.length;h++){let Se=V[h];if(m.T=Se[0],Se=Se[1],m.G==2)if(Se[0]=="c"){m.K=Se[1],m.ia=Se[2];const Ue=Se[3];Ue!=null&&(m.la=Ue,m.j.info("VER="+m.la));const bt=Se[4];bt!=null&&(m.Aa=bt,m.j.info("SVER="+m.Aa));const mn=Se[5];mn!=null&&typeof mn=="number"&&0<mn&&(y=1.5*mn,m.L=y,m.j.info("backChannelRequestTimeoutMs_="+y)),y=m;const Zt=l.g;if(Zt){const nr=Zt.g?Zt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(nr){var L=y.h;L.g||nr.indexOf("spdy")==-1&&nr.indexOf("quic")==-1&&nr.indexOf("h2")==-1||(L.j=L.l,L.g=new Set,L.h&&(Ua(L,L.h),L.h=null))}if(y.D){const xo=Zt.g?Zt.g.getResponseHeader("X-HTTP-Session-Id"):null;xo&&(y.ya=xo,pt(y.I,y.D,xo))}}m.G=3,m.l&&m.l.ua(),m.ba&&(m.R=Date.now()-l.F,m.j.info("Handshake RTT: "+m.R+"ms")),y=m;var se=l;if(y.qa=To(y,y.J?y.ia:null,y.W),se.K){uo(y.h,se);var Ce=se,Je=y.L;Je&&(Ce.I=Je),Ce.B&&(vs(Ce),vr(Ce)),y.g=se}else bo(y);0<m.i.length&&_o(m)}else Se[0]!="stop"&&Se[0]!="close"||Fr(m,7);else m.G==3&&(Se[0]=="stop"||Se[0]=="close"?Se[0]=="stop"?Fr(m,7):vo(m):Se[0]!="noop"&&m.l&&m.l.ta(Se),m.v=0)}}fr(4)}catch{}}var Du=class{constructor(l,h){this.g=l,this.map=h}};function Oe(l){this.l=l||10,a.PerformanceNavigationTiming?(l=a.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ke(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function Ot(l){return l.h?1:l.g?l.g.size:0}function at(l,h){return l.h?l.h==h:l.g?l.g.has(h):!1}function Ua(l,h){l.g?l.g.add(h):l.h=h}function uo(l,h){l.h&&l.h==h?l.h=null:l.g&&l.g.has(h)&&l.g.delete(h)}Oe.prototype.cancel=function(){if(this.i=$a(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const l of this.g.values())l.cancel();this.g.clear()}};function $a(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let h=l.i;for(const m of l.g.values())h=h.concat(m.D);return h}return T(l.i)}function fi(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(u(l)){for(var h=[],m=l.length,y=0;y<m;y++)h.push(l[y]);return h}h=[],m=0;for(y in l)h[m++]=l[y];return h}function th(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(u(l)||typeof l=="string"){var h=[];l=l.length;for(var m=0;m<l;m++)h.push(m);return h}h=[],m=0;for(const y in l)h[m++]=y;return h}}}function ys(l,h){if(l.forEach&&typeof l.forEach=="function")l.forEach(h,void 0);else if(u(l)||typeof l=="string")Array.prototype.forEach.call(l,h,void 0);else for(var m=th(l),y=fi(l),V=y.length,L=0;L<V;L++)h.call(void 0,y[L],m&&m[L],l)}var yr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function nh(l,h){if(l){l=l.split("&");for(var m=0;m<l.length;m++){var y=l[m].indexOf("="),V=null;if(0<=y){var L=l[m].substring(0,y);V=l[m].substring(y+1)}else L=l[m];h(L,V?decodeURIComponent(V.replace(/\+/g," ")):"")}}}function Hn(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof Hn){this.h=l.h,Dn(this,l.j),this.o=l.o,this.g=l.g,co(this,l.s),this.l=l.l;var h=l.i,m=new _s;m.i=h.i,h.g&&(m.g=new Map(h.g),m.h=h.h),Vu(this,m),this.m=l.m}else l&&(h=String(l).match(yr))?(this.h=!1,Dn(this,h[1]||"",!0),this.o=Mr(h[2]||""),this.g=Mr(h[3]||"",!0),co(this,h[4]),this.l=Mr(h[5]||"",!0),Vu(this,h[6]||"",!0),this.m=Mr(h[7]||"")):(this.h=!1,this.i=new _s(null,this.h))}Hn.prototype.toString=function(){var l=[],h=this.j;h&&l.push(Wn(h,pi,!0),":");var m=this.g;return(m||h=="file")&&(l.push("//"),(h=this.o)&&l.push(Wn(h,pi,!0),"@"),l.push(encodeURIComponent(String(m)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m=this.s,m!=null&&l.push(":",String(m))),(m=this.l)&&(this.g&&m.charAt(0)!="/"&&l.push("/"),l.push(Wn(m,m.charAt(0)=="/"?Nu:Ba,!0))),(m=this.i.toString())&&l.push("?",m),(m=this.m)&&l.push("#",Wn(m,sh)),l.join("")};function $n(l){return new Hn(l)}function Dn(l,h,m){l.j=m?Mr(h,!0):h,l.j&&(l.j=l.j.replace(/:$/,""))}function co(l,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);l.s=h}else l.s=null}function Vu(l,h,m){h instanceof _s?(l.i=h,ih(l.i,l.h)):(m||(h=Wn(h,rh)),l.i=new _s(h,l.h))}function pt(l,h,m){l.i.set(h,m)}function ho(l){return pt(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function Mr(l,h){return l?h?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function Wn(l,h,m){return typeof l=="string"?(l=encodeURI(l).replace(h,ja),m&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function ja(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var pi=/[#\/\?@]/g,Ba=/[#\?:]/g,Nu=/[#\?]/g,rh=/[#\?@]/g,sh=/#/g;function _s(l,h){this.h=this.g=null,this.i=l||null,this.j=!!h}function Qn(l){l.g||(l.g=new Map,l.h=0,l.i&&nh(l.i,function(h,m){l.add(decodeURIComponent(h.replace(/\+/g," ")),m)}))}n=_s.prototype,n.add=function(l,h){Qn(this),this.i=null,l=bs(this,l);var m=this.g.get(l);return m||this.g.set(l,m=[]),m.push(h),this.h+=1,this};function mi(l,h){Qn(l),h=bs(l,h),l.g.has(h)&&(l.i=null,l.h-=l.g.get(h).length,l.g.delete(h))}function gi(l,h){return Qn(l),h=bs(l,h),l.g.has(h)}n.forEach=function(l,h){Qn(this),this.g.forEach(function(m,y){m.forEach(function(V){l.call(h,V,y,this)},this)},this)},n.na=function(){Qn(this);const l=Array.from(this.g.values()),h=Array.from(this.g.keys()),m=[];for(let y=0;y<h.length;y++){const V=l[y];for(let L=0;L<V.length;L++)m.push(h[y])}return m},n.V=function(l){Qn(this);let h=[];if(typeof l=="string")gi(this,l)&&(h=h.concat(this.g.get(bs(this,l))));else{l=Array.from(this.g.values());for(let m=0;m<l.length;m++)h=h.concat(l[m])}return h},n.set=function(l,h){return Qn(this),this.i=null,l=bs(this,l),gi(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[h]),this.h+=1,this},n.get=function(l,h){return l?(l=this.V(l),0<l.length?String(l[0]):h):h};function Ou(l,h,m){mi(l,h),0<m.length&&(l.i=null,l.g.set(bs(l,h),T(m)),l.h+=m.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const l=[],h=Array.from(this.g.keys());for(var m=0;m<h.length;m++){var y=h[m];const L=encodeURIComponent(String(y)),se=this.V(y);for(y=0;y<se.length;y++){var V=L;se[y]!==""&&(V+="="+encodeURIComponent(String(se[y]))),l.push(V)}}return this.i=l.join("&")};function bs(l,h){return h=String(h),l.j&&(h=h.toLowerCase()),h}function ih(l,h){h&&!l.j&&(Qn(l),l.i=null,l.g.forEach(function(m,y){var V=y.toLowerCase();y!=V&&(mi(this,y),Ou(this,V,m))},l)),l.j=h}function oh(l,h){const m=new ui;if(a.Image){const y=new Image;y.onload=_(_r,m,"TestLoadImage: loaded",!0,h,y),y.onerror=_(_r,m,"TestLoadImage: error",!1,h,y),y.onabort=_(_r,m,"TestLoadImage: abort",!1,h,y),y.ontimeout=_(_r,m,"TestLoadImage: timeout",!1,h,y),a.setTimeout(function(){y.ontimeout&&y.ontimeout()},1e4),y.src=l}else h(!1)}function ah(l,h){const m=new ui,y=new AbortController,V=setTimeout(()=>{y.abort(),_r(m,"TestPingServer: timeout",!1,h)},1e4);fetch(l,{signal:y.signal}).then(L=>{clearTimeout(V),L.ok?_r(m,"TestPingServer: ok",!0,h):_r(m,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(V),_r(m,"TestPingServer: error",!1,h)})}function _r(l,h,m,y,V){try{V&&(V.onload=null,V.onerror=null,V.onabort=null,V.ontimeout=null),y(m)}catch{}}function fo(){this.g=new xn}function lh(l,h,m){const y=m||"";try{ys(l,function(V,L){let se=V;c(V)&&(se=jt(V)),h.push(y+L+"="+encodeURIComponent(se))})}catch(V){throw h.push(y+"type="+encodeURIComponent("_badmap")),V}}function po(l){this.l=l.Ub||null,this.j=l.eb||!1}C(po,so),po.prototype.g=function(){return new mo(this.l,this.j)},po.prototype.i=function(l){return function(){return l}}({});function mo(l,h){Ae.call(this),this.D=l,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(mo,Ae),n=mo.prototype,n.open=function(l,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=h,this.readyState=1,ws(this)},n.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(h.body=l),(this.D||a).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,vi(this)),this.readyState=0},n.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,ws(this)),this.g&&(this.readyState=3,ws(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;qa(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function qa(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}n.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var h=l.value?l.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!l.done}))&&(this.response=this.responseText+=h)}l.done?vi(this):ws(this),this.readyState==3&&qa(this)}},n.Ra=function(l){this.g&&(this.response=this.responseText=l,vi(this))},n.Qa=function(l){this.g&&(this.response=l,vi(this))},n.ga=function(){this.g&&vi(this)};function vi(l){l.readyState=4,l.l=null,l.j=null,l.v=null,ws(l)}n.setRequestHeader=function(l,h){this.u.append(l,h)},n.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const l=[],h=this.h.entries();for(var m=h.next();!m.done;)m=m.value,l.push(m[0]+": "+m[1]),m=h.next();return l.join(`\r
`)};function ws(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(mo.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function Mu(l){let h="";return H(l,function(m,y){h+=y,h+=":",h+=m,h+=`\r
`}),h}function za(l,h,m){e:{for(y in m){var y=!1;break e}y=!0}y||(m=Mu(m),typeof l=="string"?m!=null&&encodeURIComponent(String(m)):pt(l,h,m))}function St(l){Ae.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(St,Ae);var uh=/^https?$/i,Lr=["POST","PUT"];n=St.prototype,n.Ha=function(l){this.J=l},n.ea=function(l,h,m,y){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);h=h?h.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ma.g(),this.v=this.o?Na(this.o):Na(Ma),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(h,String(l),!0),this.B=!1}catch(L){Lu(this,L);return}if(l=m||"",m=new Map(this.headers),y)if(Object.getPrototypeOf(y)===Object.prototype)for(var V in y)m.set(V,y[V]);else if(typeof y.keys=="function"&&typeof y.get=="function")for(const L of y.keys())m.set(L,y.get(L));else throw Error("Unknown input type for opt_headers: "+String(y));y=Array.from(m.keys()).find(L=>L.toLowerCase()=="content-type"),V=a.FormData&&l instanceof a.FormData,!(0<=Array.prototype.indexOf.call(Lr,h,void 0))||y||V||m.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[L,se]of m)this.g.setRequestHeader(L,se);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Fu(this),this.u=!0,this.g.send(l),this.u=!1}catch(L){Lu(this,L)}};function Lu(l,h){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=h,l.m=5,Ga(l),yi(l)}function Ga(l){l.A||(l.A=!0,Be(l,"complete"),Be(l,"error"))}n.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,Be(this,"complete"),Be(this,"abort"),yi(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),yi(this,!0)),St.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?go(this):this.bb())},n.bb=function(){go(this)};function go(l){if(l.h&&typeof o<"u"&&(!l.v[1]||tr(l)!=4||l.Z()!=2)){if(l.u&&tr(l)==4)Tt(l.Ea,0,l);else if(Be(l,"readystatechange"),tr(l)==4){l.h=!1;try{const se=l.Z();e:switch(se){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var m;if(!(m=h)){var y;if(y=se===0){var V=String(l.D).match(yr)[1]||null;!V&&a.self&&a.self.location&&(V=a.self.location.protocol.slice(0,-1)),y=!uh.test(V?V.toLowerCase():"")}m=y}if(m)Be(l,"complete"),Be(l,"success");else{l.m=6;try{var L=2<tr(l)?l.g.statusText:""}catch{L=""}l.l=L+" ["+l.Z()+"]",Ga(l)}}finally{yi(l)}}}}function yi(l,h){if(l.g){Fu(l);const m=l.g,y=l.v[0]?()=>{}:null;l.g=null,l.v=null,h||Be(l,"ready");try{m.onreadystatechange=y}catch{}}}function Fu(l){l.I&&(a.clearTimeout(l.I),l.I=null)}n.isActive=function(){return!!this.g};function tr(l){return l.g?l.g.readyState:0}n.Z=function(){try{return 2<tr(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(l){if(this.g){var h=this.g.responseText;return l&&h.indexOf(l)==0&&(h=h.substring(l.length)),kn(h)}};function Uu(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function $u(l){const h={};l=(l.g&&2<=tr(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let y=0;y<l.length;y++){if(q(l[y]))continue;var m=S(l[y]);const V=m[0];if(m=m[1],typeof m!="string")continue;m=m.trim();const L=h[V]||[];h[V]=L,L.push(m)}P(h,function(y){return y.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Is(l,h,m){return m&&m.internalChannelParams&&m.internalChannelParams[l]||h}function Ka(l){this.Aa=0,this.i=[],this.j=new ui,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Is("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Is("baseRetryDelayMs",5e3,l),this.cb=Is("retryDelaySeedMs",1e4,l),this.Wa=Is("forwardChannelMaxRetries",2,l),this.wa=Is("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new Oe(l&&l.concurrentRequestLimit),this.Da=new fo,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Ka.prototype,n.la=8,n.G=1,n.connect=function(l,h,m,y){rn(0),this.W=l,this.H=h||{},m&&y!==void 0&&(this.H.OSID=m,this.H.OAID=y),this.F=this.X,this.I=To(this,null,this.W),_o(this)};function vo(l){if(ju(l),l.G==3){var h=l.U++,m=$n(l.I);if(pt(m,"SID",l.K),pt(m,"RID",h),pt(m,"TYPE","terminate"),Es(l,m),h=new gr(l,l.j,h),h.L=2,h.v=ho($n(m)),m=!1,a.navigator&&a.navigator.sendBeacon)try{m=a.navigator.sendBeacon(h.v.toString(),"")}catch{}!m&&a.Image&&(new Image().src=h.v,m=!0),m||(h.g=Qa(h.j,null),h.g.ea(h.v)),h.F=Date.now(),vr(h)}zu(l)}function yo(l){l.g&&(Io(l),l.g.cancel(),l.g=null)}function ju(l){yo(l),l.u&&(a.clearTimeout(l.u),l.u=null),_i(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&a.clearTimeout(l.s),l.s=null)}function _o(l){if(!Ke(l.h)&&!l.s){l.s=!0;var h=l.Ga;$e||oe(),Ve||($e(),Ve=!0),Ie.add(h,l),l.B=0}}function Ha(l,h){return Ot(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=h.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=An(g(l.Ga,l,h),Eo(l,l.B)),l.B++,!0)}n.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;const V=new gr(this,this.j,l);let L=this.o;if(this.S&&(L?(L=I(L),x(L,this.S)):L=this.S),this.m!==null||this.O||(V.H=L,L=null),this.P)e:{for(var h=0,m=0;m<this.i.length;m++){t:{var y=this.i[m];if("__data__"in y.map&&(y=y.map.__data__,typeof y=="string")){y=y.length;break t}y=void 0}if(y===void 0)break;if(h+=y,4096<h){h=m;break e}if(h===4096||m===this.i.length-1){h=m+1;break e}}h=1e3}else h=1e3;h=qu(this,V,h),m=$n(this.I),pt(m,"RID",l),pt(m,"CVER",22),this.D&&pt(m,"X-HTTP-Session-Id",this.D),Es(this,m),L&&(this.O?h="headers="+encodeURIComponent(String(Mu(L)))+"&"+h:this.m&&za(m,this.m,L)),Ua(this.h,V),this.Ua&&pt(m,"TYPE","init"),this.P?(pt(m,"$req",h),pt(m,"SID","null"),V.T=!0,Vr(V,m,null)):Vr(V,m,h),this.G=2}}else this.G==3&&(l?Bu(this,l):this.i.length==0||Ke(this.h)||Bu(this))};function Bu(l,h){var m;h?m=h.l:m=l.U++;const y=$n(l.I);pt(y,"SID",l.K),pt(y,"RID",m),pt(y,"AID",l.T),Es(l,y),l.m&&l.o&&za(y,l.m,l.o),m=new gr(l,l.j,m,l.B+1),l.m===null&&(m.H=l.o),h&&(l.i=h.D.concat(l.i)),h=qu(l,m,1e3),m.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),Ua(l.h,m),Vr(m,y,h)}function Es(l,h){l.H&&H(l.H,function(m,y){pt(h,y,m)}),l.l&&ys({},function(m,y){pt(h,y,m)})}function qu(l,h,m){m=Math.min(l.i.length,m);var y=l.l?g(l.l.Na,l.l,l):null;e:{var V=l.i;let L=-1;for(;;){const se=["count="+m];L==-1?0<m?(L=V[0].g,se.push("ofs="+L)):L=0:se.push("ofs="+L);let Ce=!0;for(let Je=0;Je<m;Je++){let Se=V[Je].g;const Ue=V[Je].map;if(Se-=L,0>Se)L=Math.max(0,V[Je].g-100),Ce=!1;else try{lh(Ue,se,"req"+Se+"_")}catch{y&&y(Ue)}}if(Ce){y=se.join("&");break e}}}return l=l.i.splice(0,m),h.D=l,y}function bo(l){if(!l.g&&!l.u){l.Y=1;var h=l.Fa;$e||oe(),Ve||($e(),Ve=!0),Ie.add(h,l),l.v=0}}function wo(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=An(g(l.Fa,l),Eo(l,l.v)),l.v++,!0)}n.Fa=function(){if(this.u=null,Wa(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=An(g(this.ab,this),l)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,rn(10),yo(this),Wa(this))};function Io(l){l.A!=null&&(a.clearTimeout(l.A),l.A=null)}function Wa(l){l.g=new gr(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var h=$n(l.qa);pt(h,"RID","rpc"),pt(h,"SID",l.K),pt(h,"AID",l.T),pt(h,"CI",l.F?"0":"1"),!l.F&&l.ja&&pt(h,"TO",l.ja),pt(h,"TYPE","xmlhttp"),Es(l,h),l.m&&l.o&&za(h,l.m,l.o),l.L&&(l.g.I=l.L);var m=l.g;l=l.ia,m.L=1,m.v=ho($n(h)),m.m=null,m.P=!0,di(m,l)}n.Za=function(){this.C!=null&&(this.C=null,yo(this),wo(this),rn(19))};function _i(l){l.C!=null&&(a.clearTimeout(l.C),l.C=null)}function bi(l,h){var m=null;if(l.g==h){_i(l),Io(l),l.g=null;var y=2}else if(at(l.h,h))m=h.D,uo(l.h,h),y=1;else return;if(l.G!=0){if(h.o)if(y==1){m=h.m?h.m.length:0,h=Date.now()-h.F;var V=l.B;y=hr(),Be(y,new li(y,m)),_o(l)}else bo(l);else if(V=h.s,V==3||V==0&&0<h.X||!(y==1&&Ha(l,h)||y==2&&wo(l)))switch(m&&0<m.length&&(h=l.h,h.i=h.i.concat(m)),V){case 1:Fr(l,5);break;case 4:Fr(l,10);break;case 3:Fr(l,6);break;default:Fr(l,2)}}}function Eo(l,h){let m=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(m*=2),m*h}function Fr(l,h){if(l.j.info("Error code "+h),h==2){var m=g(l.fb,l),y=l.Xa;const V=!y;y=new Hn(y||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Dn(y,"https"),ho(y),V?oh(y.toString(),m):ah(y.toString(),m)}else rn(2);l.G=0,l.l&&l.l.sa(h),zu(l),ju(l)}n.fb=function(l){l?(this.j.info("Successfully pinged google.com"),rn(2)):(this.j.info("Failed to ping google.com"),rn(1))};function zu(l){if(l.G=0,l.ka=[],l.l){const h=$a(l.h);(h.length!=0||l.i.length!=0)&&(k(l.ka,h),k(l.ka,l.i),l.h.i.length=0,T(l.i),l.i.length=0),l.l.ra()}}function To(l,h,m){var y=m instanceof Hn?$n(m):new Hn(m);if(y.g!="")h&&(y.g=h+"."+y.g),co(y,y.s);else{var V=a.location;y=V.protocol,h=h?h+"."+V.hostname:V.hostname,V=+V.port;var L=new Hn(null);y&&Dn(L,y),h&&(L.g=h),V&&co(L,V),m&&(L.l=m),y=L}return m=l.D,h=l.ya,m&&h&&pt(y,m,h),pt(y,"VER",l.la),Es(l,y),y}function Qa(l,h,m){if(h&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=l.Ca&&!l.pa?new St(new po({eb:m})):new St(l.pa),h.Ha(l.J),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Gu(){}n=Gu.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function wi(){}wi.prototype.g=function(l,h){return new b(l,h)};function b(l,h){Ae.call(this),this.g=new Ka(h),this.l=l,this.h=h&&h.messageUrlParams||null,l=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(l?l["X-WebChannel-Content-Type"]=h.messageContentType:l={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(l?l["X-WebChannel-Client-Profile"]=h.va:l={"X-WebChannel-Client-Profile":h.va}),this.g.S=l,(l=h&&h.Sb)&&!q(l)&&(this.g.m=l),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!q(h)&&(this.g.D=h,l=this.h,l!==null&&h in l&&(l=this.h,h in l&&delete l[h])),this.j=new J(this)}C(b,Ae),b.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},b.prototype.close=function(){vo(this.g)},b.prototype.o=function(l){var h=this.g;if(typeof l=="string"){var m={};m.__data__=l,l=m}else this.u&&(m={},m.__data__=jt(l),l=m);h.i.push(new Du(h.Ya++,l)),h.G==3&&_o(h)},b.prototype.N=function(){this.g.l=null,delete this.j,vo(this.g),delete this.g,b.aa.N.call(this)};function v(l){cn.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var h=l.__sm__;if(h){e:{for(const m in h){l=m;break e}l=void 0}(this.i=l)&&(l=this.i,h=h!==null&&l in h?h[l]:void 0),this.data=h}else this.data=l}C(v,cn);function N(){cr.call(this),this.status=1}C(N,cr);function J(l){this.g=l}C(J,Gu),J.prototype.ua=function(){Be(this.g,"a")},J.prototype.ta=function(l){Be(this.g,new v(l))},J.prototype.sa=function(l){Be(this.g,new N)},J.prototype.ra=function(){Be(this.g,"b")},wi.prototype.createWebChannel=wi.prototype.g,b.prototype.send=b.prototype.o,b.prototype.open=b.prototype.m,b.prototype.close=b.prototype.close,s0=function(){return new wi},r0=function(){return hr()},n0=dr,uf={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},mr.NO_ERROR=0,mr.TIMEOUT=8,mr.HTTP_ERROR=6,uc=mr,ao.COMPLETE="complete",t0=ao,io.EventType=ai,ai.OPEN="a",ai.CLOSE="b",ai.ERROR="c",ai.MESSAGE="d",Ae.prototype.listen=Ae.prototype.K,ul=io,St.prototype.listenOnce=St.prototype.L,St.prototype.getLastError=St.prototype.Ka,St.prototype.getLastErrorCode=St.prototype.Ba,St.prototype.getStatus=St.prototype.Z,St.prototype.getResponseJson=St.prototype.Oa,St.prototype.getResponseText=St.prototype.oa,St.prototype.send=St.prototype.ea,St.prototype.setWithCredentials=St.prototype.Ha,e0=St}).apply(typeof Qu<"u"?Qu:typeof self<"u"?self:typeof window<"u"?window:{});const Lg="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class on{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}on.UNAUTHENTICATED=new on(null),on.GOOGLE_CREDENTIALS=new on("google-credentials-uid"),on.FIRST_PARTY=new on("first-party-uid"),on.MOCK_USER=new on("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wa="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ws=new sp("@firebase/firestore");function Oo(){return Ws.logLevel}function f4(n){Ws.setLogLevel(n)}function ee(n,...e){if(Ws.logLevel<=Ye.DEBUG){const t=e.map(op);Ws.debug(`Firestore (${wa}): ${n}`,...t)}}function zt(n,...e){if(Ws.logLevel<=Ye.ERROR){const t=e.map(op);Ws.error(`Firestore (${wa}): ${n}`,...t)}}function Xn(n,...e){if(Ws.logLevel<=Ye.WARN){const t=e.map(op);Ws.warn(`Firestore (${wa}): ${n}`,...t)}}function op(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ye(n="Unexpected state"){const e=`FIRESTORE (${wa}) INTERNAL ASSERTION FAILED: `+n;throw zt(e),new Error(e)}function we(n,e){n||ye()}function p4(n,e){n||ye()}function de(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class te extends os{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i0{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class DP{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(on.UNAUTHENTICATED))}shutdown(){}}class VP{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class NP{constructor(e){this.t=e,this.currentUser=on.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){we(this.o===void 0);let r=this.i;const s=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve();let i=new an;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new an,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const u=i;e.enqueueRetryable(async()=>{await u.promise,await s(this.currentUser)})},a=u=>{ee("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?a(u):(ee("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new an)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(ee("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(we(typeof r.accessToken=="string"),new i0(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return we(e===null||typeof e=="string"),new on(e)}}class OP{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=on.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class MP{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new OP(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(on.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class o0{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class LP{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){we(this.o===void 0);const r=i=>{i.error!=null&&ee("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,ee("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{ee("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):ee("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(we(typeof t.token=="string"),this.R=t.token,new o0(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class m4{getToken(){return Promise.resolve(new o0(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FP(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a0{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=FP(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Me(n,e){return n<e?-1:n>e?1:0}function na(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function l0(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new te(G.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new te(G.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new te(G.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new te(G.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Mt.fromMillis(Date.now())}static fromDate(e){return Mt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Mt(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Me(this.nanoseconds,e.nanoseconds):Me(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Te{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Te(e)}static min(){return new Te(new Mt(0,0))}static max(){return new Te(new Mt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fl{constructor(e,t,r){t===void 0?t=0:t>e.length&&ye(),r===void 0?r=e.length-t:r>e.length-t&&ye(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Fl.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Fl?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Xe extends Fl{construct(e,t,r){return new Xe(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new te(G.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new Xe(t)}static emptyPath(){return new Xe([])}}const UP=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class kt extends Fl{construct(e,t,r){return new kt(e,t,r)}static isValidIdentifier(e){return UP.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),kt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new kt(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new te(G.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new te(G.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new te(G.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new te(G.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new kt(t)}static emptyPath(){return new kt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class me{constructor(e){this.path=e}static fromPath(e){return new me(Xe.fromString(e))}static fromName(e){return new me(Xe.fromString(e).popFirst(5))}static empty(){return new me(Xe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Xe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Xe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new me(new Xe(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ra{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function cf(n){return n.fields.find(e=>e.kind===2)}function Pi(n){return n.fields.filter(e=>e.kind!==2)}function $P(n,e){let t=Me(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=jP(n.fields[r],e.fields[r]),t!==0)return t;return Me(n.fields.length,e.fields.length)}ra.UNKNOWN_ID=-1;class Li{constructor(e,t){this.fieldPath=e,this.kind=t}}function jP(n,e){const t=kt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Me(n.kind,e.kind)}class sa{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new sa(0,Kn.min())}}function u0(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Te.fromTimestamp(r===1e9?new Mt(t+1,0):new Mt(t,r));return new Kn(s,me.empty(),e)}function c0(n){return new Kn(n.readTime,n.key,-1)}class Kn{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Kn(Te.min(),me.empty(),-1)}static max(){return new Kn(Te.max(),me.empty(),-1)}}function ap(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=me.comparator(n.documentKey,e.documentKey),t!==0?t:Me(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d0="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class h0{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ni(n){if(n.code!==G.FAILED_PRECONDITION||n.message!==d0)throw n;ee("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ye(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new M((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof M?t:M.resolve(t)}catch(t){return M.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):M.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):M.reject(t)}static resolve(e){return new M((t,r)=>{t(e)})}static reject(e){return new M((t,r)=>{r(e)})}static waitFor(e){return new M((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},u=>r(u))}),o=!0,i===s&&t()})}static or(e){let t=M.resolve(!1);for(const r of e)t=t.next(s=>s?M.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new M((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let u=0;u<i;u++){const c=u;t(e[c]).next(d=>{o[c]=d,++a,a===i&&r(o)},d=>s(d))}})}static doWhile(e,t){return new M((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yd{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new an,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new El(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=lp(r.target.error);this.V.reject(new El(e,s))}}static open(e,t,r,s){try{return new yd(t,e.transaction(s,r))}catch(i){throw new El(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(ee("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new qP(t)}}class Ar{constructor(e,t,r){this.name=e,this.version=t,this.p=r,Ar.S(tn())===12.2&&zt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return ee("SimpleDb","Removing database:",e),Ri(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!K_())return!1;if(Ar.v())return!0;const e=tn(),t=Ar.S(e),r=0<t&&t<10,s=f0(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(ee("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new El(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new te(G.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new te(G.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new El(e,o))},s.onupgradeneeded=i=>{ee("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{ee("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=yd.open(this.db,e,i?"readonly":"readwrite",r),u=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),M.reject(c))).toPromise();return u.catch(()=>{}),await a.m,u}catch(a){const u=a,c=u.name!=="FirebaseError"&&o<3;if(ee("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}}close(){this.db&&this.db.close(),this.db=void 0}}function f0(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class BP{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Ri(this.B.delete())}}class El extends te{constructor(e,t){super(G.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ri(n){return n.name==="IndexedDbTransactionError"}class qP{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(ee("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(ee("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Ri(r)}add(e){return ee("SimpleDb","ADD",this.store.name,e,e),Ri(this.store.add(e))}get(e){return Ri(this.store.get(e)).next(t=>(t===void 0&&(t=null),ee("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return ee("SimpleDb","DELETE",this.store.name,e),Ri(this.store.delete(e))}count(){return ee("SimpleDb","COUNT",this.store.name),Ri(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new M((o,a)=>{i.onerror=u=>{a(u.target.error)},i.onsuccess=u=>{o(u.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,u)=>{o.push(u)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new M((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){ee("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new M((r,s)=>{t.onerror=i=>{const o=lp(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new M((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const u=new BP(a),c=t(a.primaryKey,a.value,u);if(c instanceof M){const d=c.catch(f=>(u.done(),M.reject(f)));r.push(d)}u.isDone?s():u.K===null?a.continue():a.continue(u.K)}}).next(()=>M.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Ri(n){return new M((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=lp(r.target.error);t(s)}})}let Fg=!1;function lp(n){const e=Ar.S(tn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new te("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Fg||(Fg=!0,setTimeout(()=>{throw r},0)),r}}return n}class zP{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){ee("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{ee("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){ri(t)?ee("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await ni(t)}await this.X(6e4)})}}class GP{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return M.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return ee("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(ee("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=c0(i);ap(o,r)>0&&(r=o)}),new Kn(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class On{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}On.oe=-1;function lu(n){return n==null}function Ul(n){return n===0&&1/n==-1/0}function p0(n){return typeof n=="number"&&Number.isInteger(n)&&!Ul(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function En(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Ug(e)),e=KP(n.get(t),e);return Ug(e)}function KP(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function Ug(n){return n+""}function Er(n){const e=n.length;if(we(e>=2),e===2)return we(n.charAt(0)===""&&n.charAt(1)===""),Xe.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&ye(),n.charAt(o+1)){case"":const a=n.substring(i,o);let u;s.length===0?u=a:(s+=a,u=s,s=""),r.push(u);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:ye()}i=o+2}return new Xe(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $g=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cc(n,e){return[n,En(e)]}function m0(n,e,t){return[n,En(e),t]}const HP={},WP=["prefixPath","collectionGroup","readTime","documentId"],QP=["prefixPath","collectionGroup","documentId"],JP=["collectionGroup","readTime","prefixPath","documentId"],YP=["canonicalId","targetId"],XP=["targetId","path"],ZP=["path","targetId"],eS=["collectionId","parent"],tS=["indexId","uid"],nS=["uid","sequenceNumber"],rS=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],sS=["indexId","uid","orderedDocumentKey"],iS=["userId","collectionPath","documentId"],oS=["userId","collectionPath","largestBatchId"],aS=["userId","collectionGroup","largestBatchId"],g0=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],lS=[...g0,"documentOverlays"],v0=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],y0=v0,up=[...y0,"indexConfiguration","indexState","indexEntries"],uS=up,cS=[...up,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class df extends h0{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function nn(n,e){const t=de(n);return Ar.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jg(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function si(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function _0(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function b0(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Et{constructor(e,t){this.comparator=e,this.root=t||dn.EMPTY}insert(e,t){return new Et(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,dn.BLACK,null,null))}remove(e){return new Et(this.comparator,this.root.remove(e,this.comparator).copy(null,null,dn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ju(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ju(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ju(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ju(this.root,e,this.comparator,!0)}}class Ju{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class dn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??dn.RED,this.left=s??dn.EMPTY,this.right=i??dn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new dn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return dn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return dn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,dn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,dn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ye();const e=this.left.check();if(e!==this.right.check())throw ye();return e+(this.isRed()?0:1)}}dn.EMPTY=null,dn.RED=!0,dn.BLACK=!1;dn.EMPTY=new class{constructor(){this.size=0}get key(){throw ye()}get value(){throw ye()}get color(){throw ye()}get left(){throw ye()}get right(){throw ye()}copy(e,t,r,s,i){return this}insert(e,t,r){return new dn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gt{constructor(e){this.comparator=e,this.data=new Et(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Bg(this.data.getIterator())}getIteratorFrom(e){return new Bg(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof gt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new gt(this.comparator);return t.data=e,t}}class Bg{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Po(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mn{constructor(e){this.fields=e,e.sort(kt.comparator)}static empty(){return new Mn([])}unionWith(e){let t=new gt(kt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Mn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return na(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w0 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v4(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ft{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new w0("Invalid base64 string: "+i):i}}(e);return new Ft(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Ft(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Me(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ft.EMPTY_BYTE_STRING=new Ft("");const dS=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function es(n){if(we(!!n),typeof n=="string"){let e=0;const t=dS.exec(n);if(we(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ct(n.seconds),nanos:Ct(n.nanos)}}function Ct(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ts(n){return typeof n=="string"?Ft.fromBase64String(n):Ft.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _d(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function bd(n){const e=n.mapValue.fields.__previous_value__;return _d(e)?bd(e):e}function $l(n){const e=es(n.mapValue.fields.__local_write_time__.timestampValue);return new Mt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hS{constructor(e,t,r,s,i,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}}class ji{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ji("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof ji&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fs={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},dc={nullValue:"NULL_VALUE"};function Qs(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?_d(n)?4:I0(n)?9007199254740991:wd(n)?10:11:ye()}function kr(n,e){if(n===e)return!0;const t=Qs(n);if(t!==Qs(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return $l(n).isEqual($l(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=es(s.timestampValue),a=es(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return ts(s.bytesValue).isEqual(ts(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Ct(s.geoPointValue.latitude)===Ct(i.geoPointValue.latitude)&&Ct(s.geoPointValue.longitude)===Ct(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Ct(s.integerValue)===Ct(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Ct(s.doubleValue),a=Ct(i.doubleValue);return o===a?Ul(o)===Ul(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return na(n.arrayValue.values||[],e.arrayValue.values||[],kr);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(jg(o)!==jg(a))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!kr(o[u],a[u])))return!1;return!0}(n,e);default:return ye()}}function jl(n,e){return(n.values||[]).find(t=>kr(t,e))!==void 0}function Js(n,e){if(n===e)return 0;const t=Qs(n),r=Qs(e);if(t!==r)return Me(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Me(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=Ct(i.integerValue||i.doubleValue),u=Ct(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return qg(n.timestampValue,e.timestampValue);case 4:return qg($l(n),$l(e));case 5:return Me(n.stringValue,e.stringValue);case 6:return function(i,o){const a=ts(i),u=ts(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){const d=Me(a[c],u[c]);if(d!==0)return d}return Me(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Me(Ct(i.latitude),Ct(o.latitude));return a!==0?a:Me(Ct(i.longitude),Ct(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return zg(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,u,c,d;const f=i.fields||{},g=o.fields||{},_=(a=f.value)===null||a===void 0?void 0:a.arrayValue,C=(u=g.value)===null||u===void 0?void 0:u.arrayValue,T=Me(((c=_==null?void 0:_.values)===null||c===void 0?void 0:c.length)||0,((d=C==null?void 0:C.values)===null||d===void 0?void 0:d.length)||0);return T!==0?T:zg(_,C)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Fs.mapValue&&o===Fs.mapValue)return 0;if(i===Fs.mapValue)return 1;if(o===Fs.mapValue)return-1;const a=i.fields||{},u=Object.keys(a),c=o.fields||{},d=Object.keys(c);u.sort(),d.sort();for(let f=0;f<u.length&&f<d.length;++f){const g=Me(u[f],d[f]);if(g!==0)return g;const _=Js(a[u[f]],c[d[f]]);if(_!==0)return _}return Me(u.length,d.length)}(n.mapValue,e.mapValue);default:throw ye()}}function qg(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Me(n,e);const t=es(n),r=es(e),s=Me(t.seconds,r.seconds);return s!==0?s:Me(t.nanos,r.nanos)}function zg(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Js(t[s],r[s]);if(i)return i}return Me(t.length,r.length)}function ia(n){return hf(n)}function hf(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=es(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return ts(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return me.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=hf(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${hf(t.fields[o])}`;return s+"}"}(n.mapValue):ye()}function hc(n){switch(Qs(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=bd(n);return e?16+hc(e):16;case 5:return 2*n.stringValue.length;case 6:return ts(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+hc(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return si(r.fields,(i,o)=>{s+=i.length+hc(o)}),s}(n.mapValue);default:throw ye()}}function Bi(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function ff(n){return!!n&&"integerValue"in n}function Bl(n){return!!n&&"arrayValue"in n}function Gg(n){return!!n&&"nullValue"in n}function Kg(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function fc(n){return!!n&&"mapValue"in n}function wd(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Tl(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return si(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Tl(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Tl(n.arrayValue.values[t]);return e}return Object.assign({},n)}function I0(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const E0={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function fS(n){return"nullValue"in n?dc:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Bi(ji.empty(),me.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?wd(n)?E0:{mapValue:{}}:ye()}function pS(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Bi(ji.empty(),me.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?E0:"mapValue"in n?wd(n)?{mapValue:{}}:Fs:ye()}function Hg(n,e){const t=Js(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Wg(n,e){const t=Js(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn{constructor(e){this.value=e}static empty(){return new fn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!fc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Tl(t)}setAll(e){let t=kt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Tl(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());fc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return kr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];fc(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){si(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new fn(Tl(this.value))}}function T0(n){const e=[];return si(n.fields,(t,r)=>{const s=new kt([t]);if(fc(r)){const i=T0(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Mn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xt{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new xt(e,0,Te.min(),Te.min(),Te.min(),fn.empty(),0)}static newFoundDocument(e,t,r,s){return new xt(e,1,t,Te.min(),r,s,0)}static newNoDocument(e,t){return new xt(e,2,t,Te.min(),Te.min(),fn.empty(),0)}static newUnknownDocument(e,t){return new xt(e,3,t,Te.min(),Te.min(),fn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Te.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=fn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=fn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Te.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof xt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new xt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys{constructor(e,t){this.position=e,this.inclusive=t}}function Qg(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=me.comparator(me.fromName(o.referenceValue),t.key):r=Js(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Jg(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!kr(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ql{constructor(e,t="asc"){this.field=e,this.dir=t}}function mS(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x0{}class Ze extends x0{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new gS(e,t,r):t==="array-contains"?new _S(e,r):t==="in"?new k0(e,r):t==="not-in"?new bS(e,r):t==="array-contains-any"?new wS(e,r):new Ze(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new vS(e,r):new yS(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Js(t,this.value)):t!==null&&Qs(this.value)===Qs(t)&&this.matchesComparison(Js(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ye()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ct extends x0{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new ct(e,t)}matches(e){return oa(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function oa(n){return n.op==="and"}function pf(n){return n.op==="or"}function cp(n){return A0(n)&&oa(n)}function A0(n){for(const e of n.filters)if(e instanceof ct)return!1;return!0}function mf(n){if(n instanceof Ze)return n.field.canonicalString()+n.op.toString()+ia(n.value);if(cp(n))return n.filters.map(e=>mf(e)).join(",");{const e=n.filters.map(t=>mf(t)).join(",");return`${n.op}(${e})`}}function P0(n,e){return n instanceof Ze?function(r,s){return s instanceof Ze&&r.op===s.op&&r.field.isEqual(s.field)&&kr(r.value,s.value)}(n,e):n instanceof ct?function(r,s){return s instanceof ct&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&P0(o,s.filters[a]),!0):!1}(n,e):void ye()}function S0(n,e){const t=n.filters.concat(e);return ct.create(t,n.op)}function R0(n){return n instanceof Ze?function(t){return`${t.field.canonicalString()} ${t.op} ${ia(t.value)}`}(n):n instanceof ct?function(t){return t.op.toString()+" {"+t.getFilters().map(R0).join(" ,")+"}"}(n):"Filter"}class gS extends Ze{constructor(e,t,r){super(e,t,r),this.key=me.fromName(r.referenceValue)}matches(e){const t=me.comparator(e.key,this.key);return this.matchesComparison(t)}}class vS extends Ze{constructor(e,t){super(e,"in",t),this.keys=C0("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class yS extends Ze{constructor(e,t){super(e,"not-in",t),this.keys=C0("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function C0(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>me.fromName(r.referenceValue))}class _S extends Ze{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Bl(t)&&jl(t.arrayValue,this.value)}}class k0 extends Ze{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&jl(this.value.arrayValue,t)}}class bS extends Ze{constructor(e,t){super(e,"not-in",t)}matches(e){if(jl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!jl(this.value.arrayValue,t)}}class wS extends Ze{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Bl(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>jl(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IS{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function gf(n,e=null,t=[],r=[],s=null,i=null,o=null){return new IS(n,e,t,r,s,i,o)}function qi(n){const e=de(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>mf(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),lu(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>ia(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>ia(r)).join(",")),e.ue=t}return e.ue}function uu(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!mS(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!P0(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Jg(n.startAt,e.startAt)&&Jg(n.endAt,e.endAt)}function Mc(n){return me.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Lc(n,e){return n.filters.filter(t=>t instanceof Ze&&t.field.isEqual(e))}function Yg(n,e,t){let r=dc,s=!0;for(const i of Lc(n,e)){let o=dc,a=!0;switch(i.op){case"<":case"<=":o=fS(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=dc}Hg({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Hg({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function Xg(n,e,t){let r=Fs,s=!0;for(const i of Lc(n,e)){let o=Fs,a=!0;switch(i.op){case">=":case">":o=pS(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Fs}Wg({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Wg({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class as{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function D0(n,e,t,r,s,i,o,a){return new as(n,e,t,r,s,i,o,a)}function Ia(n){return new as(n)}function Zg(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function dp(n){return n.collectionGroup!==null}function Go(n){const e=de(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new gt(kt.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new ql(i,r))}),t.has(kt.keyField().canonicalString())||e.ce.push(new ql(kt.keyField(),r))}return e.ce}function Tn(n){const e=de(n);return e.le||(e.le=N0(e,Go(n))),e.le}function V0(n){const e=de(n);return e.he||(e.he=N0(e,n.explicitOrderBy)),e.he}function N0(n,e){if(n.limitType==="F")return gf(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new ql(s.field,i)});const t=n.endAt?new Ys(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Ys(n.startAt.position,n.startAt.inclusive):null;return gf(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function vf(n,e){const t=n.filters.concat([e]);return new as(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Fc(n,e,t){return new as(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function cu(n,e){return uu(Tn(n),Tn(e))&&n.limitType===e.limitType}function O0(n){return`${qi(Tn(n))}|lt:${n.limitType}`}function Mo(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>R0(s)).join(", ")}]`),lu(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>ia(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>ia(s)).join(",")),`Target(${r})`}(Tn(n))}; limitType=${n.limitType})`}function du(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):me.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of Go(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,u){const c=Qg(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,Go(r),s)||r.endAt&&!function(o,a,u){const c=Qg(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,Go(r),s))}(n,e)}function M0(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function L0(n){return(e,t)=>{let r=!1;for(const s of Go(n)){const i=ES(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function ES(n,e,t){const r=n.field.isKeyField()?me.comparator(e.key,t.key):function(i,o,a){const u=o.data.field(i),c=a.data.field(i);return u!==null&&c!==null?Js(u,c):ye()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return ye()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ls{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){si(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return b0(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TS=new Et(me.comparator);function Ln(){return TS}const F0=new Et(me.comparator);function cl(...n){let e=F0;for(const t of n)e=e.insert(t.key,t);return e}function U0(n){let e=F0;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Tr(){return xl()}function $0(){return xl()}function xl(){return new ls(n=>n.toString(),(n,e)=>n.isEqual(e))}const xS=new Et(me.comparator),AS=new gt(me.comparator);function Ge(...n){let e=AS;for(const t of n)e=e.add(t);return e}const PS=new gt(Me);function hp(){return PS}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fp(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ul(e)?"-0":e}}function j0(n){return{integerValue:""+n}}function B0(n,e){return p0(e)?j0(e):fp(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Id{constructor(){this._=void 0}}function SS(n,e,t){return n instanceof aa?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&_d(i)&&(i=bd(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof zi?z0(n,e):n instanceof Gi?G0(n,e):function(s,i){const o=q0(s,i),a=ev(o)+ev(s.Pe);return ff(o)&&ff(s.Pe)?j0(a):fp(s.serializer,a)}(n,e)}function RS(n,e,t){return n instanceof zi?z0(n,e):n instanceof Gi?G0(n,e):t}function q0(n,e){return n instanceof la?function(r){return ff(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class aa extends Id{}class zi extends Id{constructor(e){super(),this.elements=e}}function z0(n,e){const t=K0(e);for(const r of n.elements)t.some(s=>kr(s,r))||t.push(r);return{arrayValue:{values:t}}}class Gi extends Id{constructor(e){super(),this.elements=e}}function G0(n,e){let t=K0(e);for(const r of n.elements)t=t.filter(s=>!kr(s,r));return{arrayValue:{values:t}}}class la extends Id{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function ev(n){return Ct(n.integerValue||n.doubleValue)}function K0(n){return Bl(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hu{constructor(e,t){this.field=e,this.transform=t}}function CS(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof zi&&s instanceof zi||r instanceof Gi&&s instanceof Gi?na(r.elements,s.elements,kr):r instanceof la&&s instanceof la?kr(r.Pe,s.Pe):r instanceof aa&&s instanceof aa}(n.transform,e.transform)}class kS{constructor(e,t){this.version=e,this.transformResults=t}}class Dt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Dt}static exists(e){return new Dt(void 0,e)}static updateTime(e){return new Dt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function pc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Ed{}function H0(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Ta(n.key,Dt.none()):new Ea(n.key,n.data,Dt.none());{const t=n.data,r=fn.empty();let s=new gt(kt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new us(n.key,r,new Mn(s.toArray()),Dt.none())}}function DS(n,e,t){n instanceof Ea?function(s,i,o){const a=s.value.clone(),u=nv(s.fieldTransforms,i,o.transformResults);a.setAll(u),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof us?function(s,i,o){if(!pc(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=nv(s.fieldTransforms,i,o.transformResults),u=i.data;u.setAll(W0(s)),u.setAll(a),i.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Al(n,e,t,r){return n instanceof Ea?function(i,o,a,u){if(!pc(i.precondition,o))return a;const c=i.value.clone(),d=rv(i.fieldTransforms,u,o);return c.setAll(d),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof us?function(i,o,a,u){if(!pc(i.precondition,o))return a;const c=rv(i.fieldTransforms,u,o),d=o.data;return d.setAll(W0(i)),d.setAll(c),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return pc(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function VS(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=q0(r.transform,s||null);i!=null&&(t===null&&(t=fn.empty()),t.set(r.field,i))}return t||null}function tv(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&na(r,s,(i,o)=>CS(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Ea extends Ed{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class us extends Ed{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function W0(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function nv(n,e,t){const r=new Map;we(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,RS(o,a,t[s]))}return r}function rv(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,SS(i,o,e))}return r}class Ta extends Ed{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class pp extends Ed{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mp{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&DS(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Al(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Al(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=$0();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const u=H0(o,a);u!==null&&r.set(s.key,u),o.isValidDocument()||o.convertToNoDocument(Te.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ge())}isEqual(e){return this.batchId===e.batchId&&na(this.mutations,e.mutations,(t,r)=>tv(t,r))&&na(this.baseMutations,e.baseMutations,(t,r)=>tv(t,r))}}class gp{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){we(e.mutations.length===r.length);let s=function(){return xS}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new gp(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vp{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q0{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NS{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qt,rt;function J0(n){switch(n){default:return ye();case G.CANCELLED:case G.UNKNOWN:case G.DEADLINE_EXCEEDED:case G.RESOURCE_EXHAUSTED:case G.INTERNAL:case G.UNAVAILABLE:case G.UNAUTHENTICATED:return!1;case G.INVALID_ARGUMENT:case G.NOT_FOUND:case G.ALREADY_EXISTS:case G.PERMISSION_DENIED:case G.FAILED_PRECONDITION:case G.ABORTED:case G.OUT_OF_RANGE:case G.UNIMPLEMENTED:case G.DATA_LOSS:return!0}}function Y0(n){if(n===void 0)return zt("GRPC error has no .code"),G.UNKNOWN;switch(n){case Qt.OK:return G.OK;case Qt.CANCELLED:return G.CANCELLED;case Qt.UNKNOWN:return G.UNKNOWN;case Qt.DEADLINE_EXCEEDED:return G.DEADLINE_EXCEEDED;case Qt.RESOURCE_EXHAUSTED:return G.RESOURCE_EXHAUSTED;case Qt.INTERNAL:return G.INTERNAL;case Qt.UNAVAILABLE:return G.UNAVAILABLE;case Qt.UNAUTHENTICATED:return G.UNAUTHENTICATED;case Qt.INVALID_ARGUMENT:return G.INVALID_ARGUMENT;case Qt.NOT_FOUND:return G.NOT_FOUND;case Qt.ALREADY_EXISTS:return G.ALREADY_EXISTS;case Qt.PERMISSION_DENIED:return G.PERMISSION_DENIED;case Qt.FAILED_PRECONDITION:return G.FAILED_PRECONDITION;case Qt.ABORTED:return G.ABORTED;case Qt.OUT_OF_RANGE:return G.OUT_OF_RANGE;case Qt.UNIMPLEMENTED:return G.UNIMPLEMENTED;case Qt.DATA_LOSS:return G.DATA_LOSS;default:return ye()}}(rt=Qt||(Qt={}))[rt.OK=0]="OK",rt[rt.CANCELLED=1]="CANCELLED",rt[rt.UNKNOWN=2]="UNKNOWN",rt[rt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",rt[rt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",rt[rt.NOT_FOUND=5]="NOT_FOUND",rt[rt.ALREADY_EXISTS=6]="ALREADY_EXISTS",rt[rt.PERMISSION_DENIED=7]="PERMISSION_DENIED",rt[rt.UNAUTHENTICATED=16]="UNAUTHENTICATED",rt[rt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",rt[rt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",rt[rt.ABORTED=10]="ABORTED",rt[rt.OUT_OF_RANGE=11]="OUT_OF_RANGE",rt[rt.UNIMPLEMENTED=12]="UNIMPLEMENTED",rt[rt.INTERNAL=13]="INTERNAL",rt[rt.UNAVAILABLE=14]="UNAVAILABLE",rt[rt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Uc=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X0(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OS=new Mi([4294967295,4294967295],0);function sv(n){const e=X0().encode(n),t=new Z_;return t.update(e),new Uint8Array(t.digest())}function iv(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Mi([t,r],0),new Mi([s,i],0)]}class yp{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new dl(`Invalid padding: ${t}`);if(r<0)throw new dl(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new dl(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new dl(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Mi.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(Mi.fromNumber(r)));return s.compare(OS)===1&&(s=new Mi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=sv(e),[r,s]=iv(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new yp(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=sv(e),[r,s]=iv(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class dl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fu{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,pu.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new fu(Te.min(),s,new Et(Me),Ln(),Ge())}}class pu{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new pu(r,t,Ge(),Ge(),Ge())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mc{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class Z0{constructor(e,t){this.targetId=e,this.me=t}}class eb{constructor(e,t,r=Ft.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class ov{constructor(){this.fe=0,this.ge=lv(),this.pe=Ft.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Ge(),t=Ge(),r=Ge();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:ye()}}),new pu(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=lv()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,we(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class MS{constructor(e){this.Le=e,this.Be=new Map,this.ke=Ln(),this.qe=av(),this.Qe=new Et(Me)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:ye()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(Mc(i))if(r===0){const o=new me(i.path);this.Ue(t,o,xt.newNoDocument(o,Te.min()))}else we(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),u=a?this.Xe(a,e,o):1;if(u!==0){this.je(t);const c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}Uc==null||Uc.et(function(d,f,g,_,C){var T,k,j,q,U,z;const Y={localCacheCount:d,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},H=f.unchangedNames;return H&&(Y.bloomFilter={applied:C===0,hashCount:(T=H==null?void 0:H.hashCount)!==null&&T!==void 0?T:0,bitmapLength:(q=(j=(k=H==null?void 0:H.bits)===null||k===void 0?void 0:k.bitmap)===null||j===void 0?void 0:j.length)!==null&&q!==void 0?q:0,padding:(z=(U=H==null?void 0:H.bits)===null||U===void 0?void 0:U.padding)!==null&&z!==void 0?z:0,mightContain:P=>{var I;return(I=_==null?void 0:_.mightContain(P))!==null&&I!==void 0&&I}}),Y}(o,e.me,this.Le.tt(),a,u))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=ts(r).toUint8Array()}catch(u){if(u instanceof w0)return Xn("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new yp(o,s,i)}catch(u){return Xn(u instanceof dl?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&Mc(a.target)){const u=new me(a.target.path);this.ke.get(u)!==null||this.it(o,u)||this.Ue(o,u,xt.newNoDocument(u,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=Ge();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(u=>{const c=this.Je(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new fu(e,t,this.Qe,this.ke,r);return this.ke=Ln(),this.qe=av(),this.Qe=new Et(Me),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new ov,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new gt(Me),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||ee("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new ov),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function av(){return new Et(me.comparator)}function lv(){return new Et(me.comparator)}const LS=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),FS=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),US=(()=>({and:"AND",or:"OR"}))();class $S{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function yf(n,e){return n.useProto3Json||lu(e)?e:{value:e}}function ua(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function tb(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function jS(n,e){return ua(n,e.toTimestamp())}function Kt(n){return we(!!n),Te.fromTimestamp(function(t){const r=es(t);return new Mt(r.seconds,r.nanos)}(n))}function _p(n,e){return _f(n,e).canonicalString()}function _f(n,e){const t=function(s){return new Xe(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function nb(n){const e=Xe.fromString(n);return we(hb(e)),e}function zl(n,e){return _p(n.databaseId,e.path)}function Pr(n,e){const t=nb(e);if(t.get(1)!==n.databaseId.projectId)throw new te(G.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new te(G.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new me(ib(t))}function rb(n,e){return _p(n.databaseId,e)}function sb(n){const e=nb(n);return e.length===4?Xe.emptyPath():ib(e)}function bf(n){return new Xe(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function ib(n){return we(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function uv(n,e,t){return{name:zl(n,e),fields:t.value.mapValue.fields}}function ob(n,e,t){const r=Pr(n,e.name),s=Kt(e.updateTime),i=e.createTime?Kt(e.createTime):Te.min(),o=new fn({mapValue:{fields:e.fields}}),a=xt.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function BS(n,e){return"found"in e?function(r,s){we(!!s.found),s.found.name,s.found.updateTime;const i=Pr(r,s.found.name),o=Kt(s.found.updateTime),a=s.found.createTime?Kt(s.found.createTime):Te.min(),u=new fn({mapValue:{fields:s.found.fields}});return xt.newFoundDocument(i,o,a,u)}(n,e):"missing"in e?function(r,s){we(!!s.missing),we(!!s.readTime);const i=Pr(r,s.missing),o=Kt(s.readTime);return xt.newNoDocument(i,o)}(n,e):ye()}function qS(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:ye()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,d){return c.useProto3Json?(we(d===void 0||typeof d=="string"),Ft.fromBase64String(d||"")):(we(d===void 0||d instanceof Buffer||d instanceof Uint8Array),Ft.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const d=c.code===void 0?G.UNKNOWN:Y0(c.code);return new te(d,c.message||"")}(o);t=new eb(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Pr(n,r.document.name),i=Kt(r.document.updateTime),o=r.document.createTime?Kt(r.document.createTime):Te.min(),a=new fn({mapValue:{fields:r.document.fields}}),u=xt.newFoundDocument(s,i,o,a),c=r.targetIds||[],d=r.removedTargetIds||[];t=new mc(c,d,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Pr(n,r.document),i=r.readTime?Kt(r.readTime):Te.min(),o=xt.newNoDocument(s,i),a=r.removedTargetIds||[];t=new mc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Pr(n,r.document),i=r.removedTargetIds||[];t=new mc([],i,s,null)}else{if(!("filter"in e))return ye();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new NS(s,i),a=r.targetId;t=new Z0(a,o)}}return t}function Gl(n,e){let t;if(e instanceof Ea)t={update:uv(n,e.key,e.value)};else if(e instanceof Ta)t={delete:zl(n,e.key)};else if(e instanceof us)t={update:uv(n,e.key,e.data),updateMask:QS(e.fieldMask)};else{if(!(e instanceof pp))return ye();t={verify:zl(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof aa)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof zi)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Gi)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof la)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw ye()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:jS(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ye()}(n,e.precondition)),t}function wf(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?Dt.updateTime(Kt(i.updateTime)):i.exists!==void 0?Dt.exists(i.exists):Dt.none()}(e.currentDocument):Dt.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let u=null;if("setToServerValue"in a)we(a.setToServerValue==="REQUEST_TIME"),u=new aa;else if("appendMissingElements"in a){const d=a.appendMissingElements.values||[];u=new zi(d)}else if("removeAllFromArray"in a){const d=a.removeAllFromArray.values||[];u=new Gi(d)}else"increment"in a?u=new la(o,a.increment):ye();const c=kt.fromServerFormat(a.fieldPath);return new hu(c,u)}(n,s)):[];if(e.update){e.update.name;const s=Pr(n,e.update.name),i=new fn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(u){const c=u.fieldPaths||[];return new Mn(c.map(d=>kt.fromServerFormat(d)))}(e.updateMask);return new us(s,i,o,t,r)}return new Ea(s,i,t,r)}if(e.delete){const s=Pr(n,e.delete);return new Ta(s,t)}if(e.verify){const s=Pr(n,e.verify);return new pp(s,t)}return ye()}function zS(n,e){return n&&n.length>0?(we(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?Kt(s.updateTime):Kt(i);return o.isEqual(Te.min())&&(o=Kt(i)),new kS(o,s.transformResults||[])}(t,e))):[]}function ab(n,e){return{documents:[rb(n,e.path)]}}function Td(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=rb(n,s);const i=function(c){if(c.length!==0)return db(ct.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(d=>function(g){return{field:ks(g.field),direction:KS(g.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=yf(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function lb(n,e,t,r){const{_t:s,parent:i}=Td(n,e),o={},a=[];let u=0;return t.forEach(c=>{const d=r?c.alias:"aggregate_"+u++;o[d]=c.alias,c.aggregateType==="count"?a.push({alias:d,count:{}}):c.aggregateType==="avg"?a.push({alias:d,avg:{field:ks(c.fieldPath)}}):c.aggregateType==="sum"&&a.push({alias:d,sum:{field:ks(c.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function ub(n){let e=sb(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){we(r===1);const d=t.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let i=[];t.where&&(i=function(f){const g=cb(f);return g instanceof ct&&cp(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(C){return new ql(Lo(C.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,lu(g)?null:g}(t.limit));let u=null;t.startAt&&(u=function(f){const g=!!f.before,_=f.values||[];return new Ys(_,g)}(t.startAt));let c=null;return t.endAt&&(c=function(f){const g=!f.before,_=f.values||[];return new Ys(_,g)}(t.endAt)),D0(e,s,o,i,a,"F",u,c)}function GS(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ye()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function cb(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Lo(t.unaryFilter.field);return Ze.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Lo(t.unaryFilter.field);return Ze.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Lo(t.unaryFilter.field);return Ze.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Lo(t.unaryFilter.field);return Ze.create(o,"!=",{nullValue:"NULL_VALUE"});default:return ye()}}(n):n.fieldFilter!==void 0?function(t){return Ze.create(Lo(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ye()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ct.create(t.compositeFilter.filters.map(r=>cb(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ye()}}(t.compositeFilter.op))}(n):ye()}function KS(n){return LS[n]}function HS(n){return FS[n]}function WS(n){return US[n]}function ks(n){return{fieldPath:n.canonicalString()}}function Lo(n){return kt.fromServerFormat(n.fieldPath)}function db(n){return n instanceof Ze?function(t){if(t.op==="=="){if(Kg(t.value))return{unaryFilter:{field:ks(t.field),op:"IS_NAN"}};if(Gg(t.value))return{unaryFilter:{field:ks(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Kg(t.value))return{unaryFilter:{field:ks(t.field),op:"IS_NOT_NAN"}};if(Gg(t.value))return{unaryFilter:{field:ks(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ks(t.field),op:HS(t.op),value:t.value}}}(n):n instanceof ct?function(t){const r=t.getFilters().map(s=>db(s));return r.length===1?r[0]:{compositeFilter:{op:WS(t.op),filters:r}}}(n):ye()}function QS(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function hb(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gr{constructor(e,t,r,s,i=Te.min(),o=Te.min(),a=Ft.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new Gr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Gr(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Gr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Gr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fb{constructor(e){this.ct=e}}function JS(n,e){let t;if(e.document)t=ob(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=me.fromSegments(e.noDocument.path),s=Hi(e.noDocument.readTime);t=xt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return ye();{const r=me.fromSegments(e.unknownDocument.path),s=Hi(e.unknownDocument.version);t=xt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Mt(s[0],s[1]);return Te.fromTimestamp(i)}(e.readTime)),t}function cv(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:$c(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:zl(i,o.key),fields:o.data.value.mapValue.fields,updateTime:ua(i,o.version.toTimestamp()),createTime:ua(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Ki(e.version)};else{if(!e.isUnknownDocument())return ye();r.unknownDocument={path:t.path.toArray(),version:Ki(e.version)}}return r}function $c(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Ki(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Hi(n){const e=new Mt(n.seconds,n.nanoseconds);return Te.fromTimestamp(e)}function Ci(n,e){const t=(e.baseMutations||[]).map(i=>wf(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>wf(n.ct,i)),s=Mt.fromMillis(e.localWriteTimeMs);return new mp(e.batchId,s,t,r)}function hl(n){const e=Hi(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Hi(n.lastLimboFreeSnapshotVersion):Te.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return we(i.documents.length===1),Tn(Ia(sb(i.documents[0])))}(n.query):function(i){return Tn(ub(i))}(n.query),new Gr(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ft.fromBase64String(n.resumeToken))}function pb(n,e){const t=Ki(e.snapshotVersion),r=Ki(e.lastLimboFreeSnapshotVersion);let s;s=Mc(e.target)?ab(n.ct,e.target):Td(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:qi(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function bp(n){const e=ub({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Fc(e,e.limit,"L"):e}function Rh(n,e){return new vp(e.largestBatchId,wf(n.ct,e.overlayMutation))}function dv(n,e){const t=e.path.lastSegment();return[n,En(e.path.popLast()),t]}function hv(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Ki(r.readTime),documentKey:En(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YS{getBundleMetadata(e,t){return fv(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:Hi(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return fv(e).put(function(s){return{bundleId:s.id,createTime:Ki(Kt(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return pv(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:bp(i.bundledQuery),readTime:Hi(i.readTime)}}(r)})}saveNamedQuery(e,t){return pv(e).put(function(s){return{name:s.name,readTime:Ki(Kt(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function fv(n){return nn(n,"bundles")}function pv(n){return nn(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xd{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new xd(e,r)}getOverlay(e,t){return el(e).get(dv(this.userId,t)).next(r=>r?Rh(this.serializer,r):null)}getOverlays(e,t){const r=Tr();return M.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new vp(t,o);s.push(this.ht(e,a))}),M.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(En(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(el(e).j("collectionPathOverlayIndex",a))}),M.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Tr(),i=En(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return el(e).U("collectionPathOverlayIndex",o).next(a=>{for(const u of a){const c=Rh(this.serializer,u);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Tr();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return el(e).J({index:"collectionGroupOverlayIndex",range:a},(u,c,d)=>{const f=Rh(this.serializer,c);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):d.done()}).next(()=>i)}ht(e,t){return el(e).put(function(s,i,o){const[a,u,c]=dv(i,o.mutation.key);return{userId:i,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Gl(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function el(n){return nn(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XS{Pt(e){return nn(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?Ft.fromUint8Array(r):Ft.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ki{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Ct(e.integerValue));else if("doubleValue"in e){const r=Ct(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),Ul(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=es(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(ts(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?I0(e)?this.dt(t,Number.MAX_SAFE_INTEGER):wd(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):ye()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(Ct(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),me.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}ki.vt=new ki;function ZS(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function mv(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=ZS(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class eR{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=mv(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=mv(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class tR{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class nR{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class tl{constructor(){this.jt=new eR,this.Ht=new tR(this.jt),this.Jt=new nR(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Di{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Di(this.indexId,this.documentKey,this.arrayValue,r)}}function xs(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=gv(n.arrayValue,e.arrayValue),t!==0?t:(t=gv(n.directionalValue,e.directionalValue),t!==0?t:me.comparator(n.documentKey,e.documentKey)))}function gv(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vv{constructor(e){this.Xt=new gt((t,r)=>kt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(we(e.collectionGroup===this.collectionId),this.nn)return!1;const t=cf(e);if(t!==void 0&&!this.sn(t))return!1;const r=Pi(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const u=r[i];if(!this.on(a,u)||!this._n(this.en[o++],u))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new gt(kt.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Li(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Li(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Li(r.field,r.dir==="asc"?0:1)));return new ra(ra.UNKNOWN_ID,this.collectionId,t,sa.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mb(n){var e,t;if(we(n instanceof Ze||n instanceof ct),n instanceof Ze){if(n instanceof k0){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>Ze.create(n.field,"==",i)))||[];return ct.create(s,"or")}return n}const r=n.filters.map(s=>mb(s));return ct.create(r,n.op)}function rR(n){if(n.getFilters().length===0)return[];const e=Tf(mb(n));return we(gb(e)),If(e)||Ef(e)?[e]:e.getFilters()}function If(n){return n instanceof Ze}function Ef(n){return n instanceof ct&&cp(n)}function gb(n){return If(n)||Ef(n)||function(t){if(t instanceof ct&&pf(t)){for(const r of t.getFilters())if(!If(r)&&!Ef(r))return!1;return!0}return!1}(n)}function Tf(n){if(we(n instanceof Ze||n instanceof ct),n instanceof Ze)return n;if(n.filters.length===1)return Tf(n.filters[0]);const e=n.filters.map(r=>Tf(r));let t=ct.create(e,n.op);return t=jc(t),gb(t)?t:(we(t instanceof ct),we(oa(t)),we(t.filters.length>1),t.filters.reduce((r,s)=>wp(r,s)))}function wp(n,e){let t;return we(n instanceof Ze||n instanceof ct),we(e instanceof Ze||e instanceof ct),t=n instanceof Ze?e instanceof Ze?function(s,i){return ct.create([s,i],"and")}(n,e):yv(n,e):e instanceof Ze?yv(e,n):function(s,i){if(we(s.filters.length>0&&i.filters.length>0),oa(s)&&oa(i))return S0(s,i.getFilters());const o=pf(s)?s:i,a=pf(s)?i:s,u=o.filters.map(c=>wp(c,a));return ct.create(u,"or")}(n,e),jc(t)}function yv(n,e){if(oa(e))return S0(e,n.getFilters());{const t=e.filters.map(r=>wp(n,r));return ct.create(t,"or")}}function jc(n){if(we(n instanceof Ze||n instanceof ct),n instanceof Ze)return n;const e=n.getFilters();if(e.length===1)return jc(e[0]);if(A0(n))return n;const t=e.map(s=>jc(s)),r=[];return t.forEach(s=>{s instanceof Ze?r.push(s):s instanceof ct&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:ct.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sR{constructor(){this.un=new Ip}addToCollectionParentIndex(e,t){return this.un.add(t),M.resolve()}getCollectionParents(e,t){return M.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return M.resolve()}deleteFieldIndex(e,t){return M.resolve()}deleteAllFieldIndexes(e){return M.resolve()}createTargetIndexes(e,t){return M.resolve()}getDocumentsMatchingTarget(e,t){return M.resolve(null)}getIndexType(e,t){return M.resolve(0)}getFieldIndexes(e,t){return M.resolve([])}getNextCollectionGroupToUpdate(e){return M.resolve(null)}getMinOffset(e,t){return M.resolve(Kn.min())}getMinOffsetFromCollectionGroup(e,t){return M.resolve(Kn.min())}updateCollectionGroup(e,t,r){return M.resolve()}updateIndexEntries(e,t){return M.resolve()}}class Ip{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new gt(Xe.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new gt(Xe.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yu=new Uint8Array(0);class iR{constructor(e,t){this.databaseId=t,this.cn=new Ip,this.ln=new ls(r=>qi(r),(r,s)=>uu(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:En(s)};return _v(e).put(i)}return M.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[l0(t),""],!1,!0);return _v(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Er(o.parent))}return r})}addFieldIndex(e,t){const r=nl(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Ro(e);return i.next(a=>{o.put(hv(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=nl(e),s=Ro(e),i=So(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=nl(e),r=So(e),s=Ro(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return M.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new vv(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=So(e);let s=!0;const i=new Map;return M.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=Ge();const a=[];return M.forEach(i,(u,c)=>{ee("IndexedDbIndexManager",`Using index ${function(U){return`id=${U.indexId}|cg=${U.collectionGroup}|f=${U.fields.map(z=>`${z.fieldPath}:${z.kind}`).join(",")}`}(u)} to execute ${qi(t)}`);const d=function(U,z){const Y=cf(z);if(Y===void 0)return null;for(const H of Lc(U,Y.fieldPath))switch(H.op){case"array-contains-any":return H.value.arrayValue.values||[];case"array-contains":return[H.value]}return null}(c,u),f=function(U,z){const Y=new Map;for(const H of Pi(z))for(const P of Lc(U,H.fieldPath))switch(P.op){case"==":case"in":Y.set(H.fieldPath.canonicalString(),P.value);break;case"not-in":case"!=":return Y.set(H.fieldPath.canonicalString(),P.value),Array.from(Y.values())}return null}(c,u),g=function(U,z){const Y=[];let H=!0;for(const P of Pi(z)){const I=P.kind===0?Yg(U,P.fieldPath,U.startAt):Xg(U,P.fieldPath,U.startAt);Y.push(I.value),H&&(H=I.inclusive)}return new Ys(Y,H)}(c,u),_=function(U,z){const Y=[];let H=!0;for(const P of Pi(z)){const I=P.kind===0?Xg(U,P.fieldPath,U.endAt):Yg(U,P.fieldPath,U.endAt);Y.push(I.value),H&&(H=I.inclusive)}return new Ys(Y,H)}(c,u),C=this.In(u,c,g),T=this.In(u,c,_),k=this.Tn(u,c,f),j=this.En(u.indexId,d,C,g.inclusive,T,_.inclusive,k);return M.forEach(j,q=>r.G(q,t.limit).next(U=>{U.forEach(z=>{const Y=me.fromSegments(z.documentKey);o.has(Y)||(o=o.add(Y),a.push(Y))})}))}).next(()=>a)}return M.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=rR(ct.create(e.filters,"and")).map(r=>gf(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const u=(t!=null?t.length:1)*Math.max(r.length,i.length),c=u/(t!=null?t.length:1),d=[];for(let f=0;f<u;++f){const g=t?this.dn(t[f/c]):Yu,_=this.An(e,g,r[f%c],s),C=this.Rn(e,g,i[f%c],o),T=a.map(k=>this.An(e,g,k,!0));d.push(...this.createRange(_,C,T))}return d}An(e,t,r,s){const i=new Di(e,me.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new Di(e,me.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new vv(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return M.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(u){let c=new gt(kt.comparator),d=!1;for(const f of u.filters)for(const g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?d=!0:c=c.add(g.field));for(const f of u.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(d?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new tl;for(const s of Pi(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);ki.vt.It(i,o)}return r.zt()}dn(e){const t=new tl;return ki.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new tl;return ki.vt.It(Bi(this.databaseId,t),r.Yt(function(i){const o=Pi(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new tl);let i=0;for(const o of Pi(e)){const a=r[i++];for(const u of s)if(this.fn(t,o.fieldPath)&&Bl(a))s=this.gn(s,o,a);else{const c=u.Yt(o.kind);ki.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const u=new tl;u.seed(a.zt()),ki.vt.It(o,u.Yt(t.kind)),i.push(u)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof Ze&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=nl(e),s=Ro(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return M.forEach(i,a=>s.get([a.indexId,this.uid]).next(u=>{o.push(function(d,f){const g=f?new sa(f.sequenceNumber,new Kn(Hi(f.readTime),new me(Er(f.documentKey)),f.largestBatchId)):sa.empty(),_=d.fields.map(([C,T])=>new Li(kt.fromServerFormat(C),T));return new ra(d.indexId,d.collectionGroup,_,g)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Me(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=nl(e),i=Ro(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>M.forEach(a,u=>i.put(hv(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return M.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?M.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),M.forEach(a,u=>this.wn(e,s,u).next(c=>{const d=this.Sn(i,u);return c.isEqual(d)?M.resolve():this.bn(e,i,u,c,d)}))))})}Dn(e,t,r,s){return So(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return So(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=So(e);let i=new gt(xs);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new Di(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new gt(xs);const s=this.Vn(t,e);if(s==null)return r;const i=cf(t);if(i!=null){const o=e.data.field(i.fieldPath);if(Bl(o))for(const a of o.arrayValue.values||[])r=r.add(new Di(t.indexId,e.key,this.dn(a),s))}else r=r.add(new Di(t.indexId,e.key,Yu,s));return r}bn(e,t,r,s,i){ee("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(u,c,d,f,g){const _=u.getIterator(),C=c.getIterator();let T=Po(_),k=Po(C);for(;T||k;){let j=!1,q=!1;if(T&&k){const U=d(T,k);U<0?q=!0:U>0&&(j=!0)}else T!=null?q=!0:j=!0;j?(f(k),k=Po(C)):q?(g(T),T=Po(_)):(T=Po(_),k=Po(C))}}(s,i,xs,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),M.waitFor(o)}yn(e){let t=1;return Ro(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>xs(o,a)).filter((o,a,u)=>!a||xs(o,u[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=xs(o,e),u=xs(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&u<0)s.push(o),s.push(o.Zt());else if(u>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Yu,[]],u=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Yu,[]];i.push(IDBKeyRange.bound(a,u))}return i}Cn(e,t){return xs(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(bv)}getMinOffset(e,t){return M.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||ye())).next(bv)}}function _v(n){return nn(n,"collectionParents")}function So(n){return nn(n,"indexEntries")}function nl(n){return nn(n,"indexConfiguration")}function Ro(n){return nn(n,"indexState")}function bv(n){we(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;ap(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Kn(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wv={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class yn{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new yn(e,yn.DEFAULT_COLLECTION_PERCENTILE,yn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vb(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const u=r.J({range:o},(d,f,g)=>(a++,g.delete()));i.push(u.next(()=>{we(a===1)}));const c=[];for(const d of t.mutations){const f=m0(e,d.key.path,t.batchId);i.push(s.delete(f)),c.push(d.key)}return M.waitFor(i).next(()=>c)}function Bc(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw ye();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */yn.DEFAULT_COLLECTION_PERCENTILE=10,yn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,yn.DEFAULT=new yn(41943040,yn.DEFAULT_COLLECTION_PERCENTILE,yn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),yn.DISABLED=new yn(-1,0,0);class Ad{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){we(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new Ad(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return As(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Fo(e),o=As(e);return o.add({}).next(a=>{we(typeof a=="number");const u=new mp(a,t,r,s),c=function(_,C,T){const k=T.baseMutations.map(q=>Gl(_.ct,q)),j=T.mutations.map(q=>Gl(_.ct,q));return{userId:C,batchId:T.batchId,localWriteTimeMs:T.localWriteTime.toMillis(),baseMutations:k,mutations:j}}(this.serializer,this.userId,u),d=[];let f=new gt((g,_)=>Me(g.canonicalString(),_.canonicalString()));for(const g of s){const _=m0(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),d.push(o.put(c)),d.push(i.put(_,HP))}return f.forEach(g=>{d.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Fn[a]=u.keys()}),M.waitFor(d).next(()=>u)})}lookupMutationBatch(e,t){return As(e).get(t).next(r=>r?(we(r.userId===this.userId),Ci(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?M.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return As(e).J({index:"userMutationsIndex",range:s},(o,a,u)=>{a.userId===this.userId&&(we(a.batchId>=r),i=Ci(this.serializer,a)),u.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return As(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return As(e).U("userMutationsIndex",t).next(r=>r.map(s=>Ci(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=cc(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Fo(e).J({range:s},(o,a,u)=>{const[c,d,f]=o,g=Er(d);if(c===this.userId&&t.path.isEqual(g))return As(e).get(f).next(_=>{if(!_)throw ye();we(_.userId===this.userId),i.push(Ci(this.serializer,_))});u.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new gt(Me);const s=[];return t.forEach(i=>{const o=cc(this.userId,i.path),a=IDBKeyRange.lowerBound(o),u=Fo(e).J({range:a},(c,d,f)=>{const[g,_,C]=c,T=Er(_);g===this.userId&&i.path.isEqual(T)?r=r.add(C):f.done()});s.push(u)}),M.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=cc(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new gt(Me);return Fo(e).J({range:o},(u,c,d)=>{const[f,g,_]=u,C=Er(g);f===this.userId&&r.isPrefixOf(C)?C.length===s&&(a=a.add(_)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(As(e).get(i).next(o=>{if(o===null)throw ye();we(o.userId===this.userId),r.push(Ci(this.serializer,o))}))}),M.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return vb(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),M.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return M.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Fo(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const u=Er(i[1]);s.push(u)}else a.done()}).next(()=>{we(s.length===0)})})}containsKey(e,t){return yb(e,this.userId,t)}Nn(e){return _b(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function yb(n,e,t){const r=cc(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Fo(n).J({range:i,H:!0},(a,u,c)=>{const[d,f,g]=a;d===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function As(n){return nn(n,"mutations")}function Fo(n){return nn(n,"documentMutations")}function _b(n){return nn(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wi{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Wi(0)}static kn(){return new Wi(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oR{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new Wi(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>Te.fromTimestamp(new Mt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Co(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(we(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Co(e).J((o,a)=>{const u=hl(a);u.sequenceNumber<=t&&r.get(u.targetId)===null&&(s++,i.push(this.removeTargetData(e,u)))}).next(()=>M.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Co(e).J((r,s)=>{const i=hl(s);t(i)})}qn(e){return Iv(e).get("targetGlobalKey").next(t=>(we(t!==null),t))}Qn(e,t){return Iv(e).put("targetGlobalKey",t)}Kn(e,t){return Co(e).put(pb(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=qi(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Co(e).J({range:s,index:"queryTargetsIndex"},(o,a,u)=>{const c=hl(a);uu(t,c.target)&&(i=c,u.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=Ds(e);return t.forEach(o=>{const a=En(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),M.waitFor(s)}removeMatchingKeys(e,t,r){const s=Ds(e);return M.forEach(t,i=>{const o=En(i.path);return M.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=Ds(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=Ds(e);let i=Ge();return s.J({range:r,H:!0},(o,a,u)=>{const c=Er(o[1]),d=new me(c);i=i.add(d)}).next(()=>i)}containsKey(e,t){const r=En(t.path),s=IDBKeyRange.bound([r],[l0(r)],!1,!0);let i=0;return Ds(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],u,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return Co(e).get(t).next(r=>r?hl(r):null)}}function Co(n){return nn(n,"targets")}function Iv(n){return nn(n,"targetGlobal")}function Ds(n){return nn(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ev([n,e],[t,r]){const s=Me(n,t);return s===0?Me(e,r):s}class aR{constructor(e){this.Un=e,this.buffer=new gt(Ev),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Ev(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class bb{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){ee("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){ri(t)?ee("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await ni(t)}await this.Hn(3e5)})}}class lR{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return M.resolve(On.oe);const r=new aR(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(ee("LruGarbageCollector","Garbage collection skipped; disabled"),M.resolve(wv)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(ee("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),wv):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,u,c;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(ee("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),Oo()<=Ye.DEBUG&&ee("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(u-a)+`ms
	Removed ${f} documents in `+(c-u)+`ms
Total Duration: ${c-d}ms`),M.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function wb(n,e){return new lR(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uR{constructor(e,t){this.db=e,this.garbageCollector=wb(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return Xu(e,r)}removeReference(e,t,r){return Xu(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Xu(e,t)}nr(e,t){return function(s,i){let o=!1;return _b(s).Y(a=>yb(s,a,i).next(u=>(u&&(o=!0),M.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const u=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,Te.min()),Ds(e).delete(function(f){return[0,En(f.path)]}(o))))});s.push(u)}}).next(()=>M.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Xu(e,t)}tr(e,t){const r=Ds(e);let s,i=On.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{o===0?(i!==On.oe&&t(new me(Er(s)),i),i=c,s=u):i=On.oe}).next(()=>{i!==On.oe&&t(new me(Er(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Xu(n,e){return Ds(n).put(function(r,s){return{targetId:0,path:En(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ib{constructor(){this.changes=new ls(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,xt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?M.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cR{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Ti(e).put(r)}removeEntry(e,t,r){return Ti(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],$c(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=xt.newInvalidDocument(t);return Ti(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(rl(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:xt.newInvalidDocument(t)};return Ti(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(rl(t))},(s,i)=>{r={document:this.ir(t,i),size:Bc(i)}}).next(()=>r)}getEntries(e,t){let r=Ln();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=Ln(),s=new Et(me.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,Bc(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return M.resolve();let s=new gt(Av);t.forEach(u=>s=s.add(u));const i=IDBKeyRange.bound(rl(s.first()),rl(s.last())),o=s.getIterator();let a=o.getNext();return Ti(e).J({index:"documentKeyIndex",range:i},(u,c,d)=>{const f=me.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&Av(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?d.$(rl(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),$c(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ti(e).U(IDBKeyRange.bound(a,u,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let d=Ln();for(const f of c){const g=this.ir(me.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&(du(t,g)||s.has(g.key))&&(d=d.insert(g.key,g))}return d})}getAllFromCollectionGroup(e,t,r,s){let i=Ln();const o=xv(t,r),a=xv(t,Kn.max());return Ti(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,d)=>{const f=this.ir(me.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(f.key,f),i.size===s&&d.done()}).next(()=>i)}newChangeBuffer(e){return new dR(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Tv(e).get("remoteDocumentGlobalKey").next(t=>(we(!!t),t))}rr(e,t){return Tv(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=JS(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Te.min())))return r}return xt.newInvalidDocument(e)}}function Eb(n){return new cR(n)}class dR extends Ib{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new ls(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new gt((i,o)=>Me(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const u=cv(this.cr.serializer,o);s=s.add(i.path.popLast());const c=Bc(u);r+=c-a.size,t.push(this.cr.addEntry(e,i,u))}else if(r-=a.size,this.trackRemovals){const u=cv(this.cr.serializer,o.convertToNoDocument(Te.min()));t.push(this.cr.addEntry(e,i,u))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),M.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function Tv(n){return nn(n,"remoteDocumentGlobal")}function Ti(n){return nn(n,"remoteDocumentsV14")}function rl(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function xv(n,e){const t=e.documentKey.path.toArray();return[n,$c(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Av(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Me(t[i],r[i]),s)return s;return s=Me(t.length,r.length),s||(s=Me(t[t.length-2],r[r.length-2]),s||Me(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hR{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tb{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Al(r.mutation,s,Mn.empty(),Mt.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Ge()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Ge()){const s=Tr();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=cl();return i.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Tr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Ge()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=Ln();const o=xl(),a=function(){return xl()}();return t.forEach((u,c)=>{const d=r.get(c.key);s.has(c.key)&&(d===void 0||d.mutation instanceof us)?i=i.insert(c.key,c):d!==void 0?(o.set(c.key,d.mutation.getFieldMask()),Al(d.mutation,c,d.mutation.getFieldMask(),Mt.now())):o.set(c.key,Mn.empty())}),this.recalculateAndSaveOverlays(e,i).next(u=>(u.forEach((c,d)=>o.set(c,d)),t.forEach((c,d)=>{var f;return a.set(c,new hR(d,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=xl();let s=new Et((o,a)=>o-a),i=Ge();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(u=>{const c=t.get(u);if(c===null)return;let d=r.get(u)||Mn.empty();d=a.applyToLocalView(c,d),r.set(u,d);const f=(s.get(a.batchId)||Ge()).add(u);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),c=u.key,d=u.value,f=$0();d.forEach(g=>{if(!i.has(g)){const _=H0(t.get(g),r.get(g));_!==null&&f.set(g,_),i=i.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return M.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return me.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):dp(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):M.resolve(Tr());let a=-1,u=i;return o.next(c=>M.forEach(c,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(d)?M.resolve():this.remoteDocumentCache.getEntry(e,d).next(g=>{u=u.insert(d,g)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,u,c,Ge())).next(d=>({batchId:a,changes:U0(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new me(t)).next(r=>{let s=cl();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=cl();return this.indexManager.getCollectionParents(e,i).next(a=>M.forEach(a,u=>{const c=function(f,g){return new as(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,u.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(d=>{d.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((u,c)=>{const d=c.getKey();o.get(d)===null&&(o=o.insert(d,xt.newInvalidDocument(d)))});let a=cl();return o.forEach((u,c)=>{const d=i.get(u);d!==void 0&&Al(d.mutation,c,Mn.empty(),Mt.now()),du(t,c)&&(a=a.insert(u,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fR{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return M.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Kt(s.createTime)}}(t)),M.resolve()}getNamedQuery(e,t){return M.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:bp(s.bundledQuery),readTime:Kt(s.readTime)}}(t)),M.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pR{constructor(){this.overlays=new Et(me.comparator),this.Ir=new Map}getOverlay(e,t){return M.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Tr();return M.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),M.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),M.resolve()}getOverlaysForCollection(e,t,r){const s=Tr(),i=t.length+1,o=new me(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return M.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Et((c,d)=>c-d);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let d=i.get(c.largestBatchId);d===null&&(d=Tr(),i=i.insert(c.largestBatchId,d)),d.set(c.getKey(),c)}}const a=Tr(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,d)=>a.set(c,d)),!(a.size()>=s)););return M.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new vp(t,r));let i=this.Ir.get(t);i===void 0&&(i=Ge(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mR{constructor(){this.sessionToken=Ft.EMPTY_BYTE_STRING}getSessionToken(e){return M.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,M.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ep{constructor(){this.Tr=new gt(sn.Er),this.dr=new gt(sn.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new sn(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new sn(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new me(new Xe([])),r=new sn(t,e),s=new sn(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new me(new Xe([])),r=new sn(t,e),s=new sn(t,e+1);let i=Ge();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new sn(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class sn{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return me.comparator(e.key,t.key)||Me(e.wr,t.wr)}static Ar(e,t){return Me(e.wr,t.wr)||me.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new gt(sn.Er)}checkEmpty(e){return M.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new mp(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new sn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return M.resolve(o)}lookupMutationBatch(e,t){return M.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return M.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return M.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return M.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new sn(t,0),s=new sn(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),M.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new gt(Me);return t.forEach(s=>{const i=new sn(s,0),o=new sn(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),M.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;me.isDocumentKey(i)||(i=i.child(""));const o=new sn(new me(i),0);let a=new gt(Me);return this.br.forEachWhile(u=>{const c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(u.wr)),!0)},o),M.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){we(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return M.forEach(t.mutations,s=>{const i=new sn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new sn(t,0),s=this.br.firstAfterOrEqual(r);return M.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,M.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vR{constructor(e){this.Mr=e,this.docs=function(){return new Et(me.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return M.resolve(r?r.document.mutableCopy():xt.newInvalidDocument(t))}getEntries(e,t){let r=Ln();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():xt.newInvalidDocument(s))}),M.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Ln();const o=t.path,a=new me(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){const{key:c,value:{document:d}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||ap(c0(d),r)<=0||(s.has(d.key)||du(t,d))&&(i=i.insert(d.key,d.mutableCopy()))}return M.resolve(i)}getAllFromCollectionGroup(e,t,r,s){ye()}Or(e,t){return M.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new yR(this)}getSize(e){return M.resolve(this.size)}}class yR extends Ib{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),M.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _R{constructor(e){this.persistence=e,this.Nr=new ls(t=>qi(t),uu),this.lastRemoteSnapshotVersion=Te.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Ep,this.targetCount=0,this.kr=Wi.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),M.resolve()}getLastRemoteSnapshotVersion(e){return M.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return M.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),M.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),M.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Wi(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,M.resolve()}updateTargetData(e,t){return this.Kn(t),M.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,M.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),M.waitFor(i).next(()=>s)}getTargetCount(e){return M.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return M.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),M.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),M.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),M.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return M.resolve(r)}containsKey(e,t){return M.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tp{constructor(e,t){this.qr={},this.overlays={},this.Qr=new On(0),this.Kr=!1,this.Kr=!0,this.$r=new mR,this.referenceDelegate=e(this),this.Ur=new _R(this),this.indexManager=new sR,this.remoteDocumentCache=function(s){return new vR(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new fb(t),this.Gr=new fR(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new pR,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new gR(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){ee("MemoryPersistence","Starting transaction:",e);const s=new bR(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return M.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class bR extends h0{constructor(e){super(),this.currentSequenceNumber=e}}class Pd{constructor(e){this.persistence=e,this.Jr=new Ep,this.Yr=null}static Zr(e){return new Pd(e)}get Xr(){if(this.Yr)return this.Yr;throw ye()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),M.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),M.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),M.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return M.forEach(this.Xr,r=>{const s=me.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,Te.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return M.or([()=>M.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class qc{constructor(e,t){this.persistence=e,this.ti=new ls(r=>En(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=wb(this,t)}static Zr(e,t){return new qc(e,t)}zr(){}jr(e){return M.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return M.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?M.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,Te.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),M.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),M.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),M.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),M.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=hc(e.data.value)),t}nr(e,t,r){return M.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return M.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wR{constructor(e){this.serializer=e}O(e,t,r,s){const i=new yd("createOrUpgrade",t);r<1&&s>=1&&(function(u){u.createObjectStore("owner")}(e),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",$g,{unique:!0}),u.createObjectStore("documentMutations")}(e),Pv(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=M.resolve();return r<3&&s>=3&&(r!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),Pv(e)),o=o.next(()=>function(u){const c=u.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Te.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",d)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(u,c){return c.store("mutations").U().next(d=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",$g,{unique:!0});const f=c.store("mutations"),g=d.map(_=>f.put(_));return M.waitFor(g)})}(e,i))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(u){const c=u.createObjectStore("documentOverlays",{keyPath:iS});c.createIndex("collectionPathOverlayIndex",oS,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",aS,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(u){const c=u.createObjectStore("remoteDocumentsV14",{keyPath:WP});c.createIndex("documentKeyIndex",QP),c.createIndex("collectionGroupIndex",JP)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:tS}).createIndex("sequenceNumberIndex",nS,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:rS}).createIndex("documentKeyIndex",sS,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(u){u.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=Bc(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>M.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>M.forEach(a,u=>{we(u.userId===i.userId);const c=Ci(this.serializer,u);return vb(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const u=new Xe(o),c=function(f){return[0,En(f)]}(u);i.push(t.get(c).next(d=>d?M.resolve():(f=>t.put({targetId:0,path:En(f),sequenceNumber:s.highestListenSequenceNumber}))(u)))}).next(()=>M.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:eS});const r=t.store("collectionParents"),s=new Ip,i=o=>{if(s.add(o)){const a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:En(u)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const u=new Xe(o);return i(u.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,u],c)=>{const d=Er(a);return i(d.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=hl(s),o=pb(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),u=function(f){return f.document?new me(Xe.fromString(f.document.name).popFirst(5)):f.noDocument?me.fromSegments(f.noDocument.path):f.unknownDocument?me.fromSegments(f.unknownDocument.path):ye()}(o).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>M.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=Eb(this.serializer),i=new Tp(Pd.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(u=>{var c;let d=(c=a.get(u.userId))!==null&&c!==void 0?c:Ge();Ci(this.serializer,u).keys().forEach(f=>d=d.add(f)),a.set(u.userId,d)}),M.forEach(a,(u,c)=>{const d=new on(c),f=xd.lt(this.serializer,d),g=i.getIndexManager(d),_=Ad.lt(d,this.serializer,g,i.referenceDelegate);return new Tb(s,_,f,g).recalculateAndSaveOverlaysForDocumentKeys(new df(t,On.oe),u).next()})})}}function Pv(n){n.createObjectStore("targetDocuments",{keyPath:XP}).createIndex("documentTargetsIndex",ZP,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",YP,{unique:!0}),n.createObjectStore("targetGlobal")}const Ch="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class xp{constructor(e,t,r,s,i,o,a,u,c,d,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=d,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=g=>Promise.resolve(),!xp.D())throw new te(G.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new uR(this,s),this.Ai=t+"main",this.serializer=new fb(u),this.Ri=new Ar(this.Ai,this.hi,new wR(this.serializer)),this.$r=new XS,this.Ur=new oR(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Eb(this.serializer),this.Gr=new YS,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&zt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new te(G.FAILED_PRECONDITION,Ch);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new On(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Zu(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(ri(e))return ee("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ee("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return sl(e).get("owner").next(t=>M.resolve(this.vi(t)))}Ci(e){return Zu(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=nn(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return M.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?M.resolve(!0):sl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new te(G.FAILED_PRECONDITION,Ch);return!1}}return!(!this.networkEnabled||!this.inForeground)||Zu(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&ee("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new df(e,On.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Zu(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Ad.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new iR(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return xd.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){ee("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(u){return u===17?cS:u===16?uS:u===15?up:u===14?y0:u===13?v0:u===12?lS:u===11?g0:void ye()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new df(a,this.Qr?this.Qr.next():On.oe),t==="readwrite-primary"?this.wi(o).next(u=>!!u||this.Si(o)).next(u=>{if(!u)throw zt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new te(G.FAILED_PRECONDITION,d0);return r(o)}).next(u=>this.Di(o).next(()=>u)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return sl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new te(G.FAILED_PRECONDITION,Ch)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return sl(e).put("owner",t)}static D(){return Ar.D()}bi(e){const t=sl(e);return t.get("owner").next(r=>this.vi(r)?(ee("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):M.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(zt(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;G_()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return ee("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return zt("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){zt("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function sl(n){return nn(n,"owner")}function Zu(n){return nn(n,"clientMetadata")}function Ap(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pp{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=Ge(),s=Ge();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Pp(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IR{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xb{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return G_()?8:f0(tn())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new IR;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(Oo()<=Ye.DEBUG&&ee("QueryEngine","SDK will not create cache indexes for query:",Mo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),M.resolve()):(Oo()<=Ye.DEBUG&&ee("QueryEngine","Query:",Mo(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Oo()<=Ye.DEBUG&&ee("QueryEngine","The SDK decides to create cache indexes for query:",Mo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Tn(t))):M.resolve())}Yi(e,t){if(Zg(t))return M.resolve(null);let r=Tn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=Fc(t,null,"F"),r=Tn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Ge(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{const c=this.ts(t,a);return this.ns(t,c,o,u.readTime)?this.Yi(e,Fc(t,null,"F")):this.rs(e,c,t,u)}))})))}Zi(e,t,r,s){return Zg(t)||s.isEqual(Te.min())?M.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?M.resolve(null):(Oo()<=Ye.DEBUG&&ee("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Mo(t)),this.rs(e,o,t,u0(s,-1)).next(a=>a))})}ts(e,t){let r=new gt(L0(e));return t.forEach((s,i)=>{du(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return Oo()<=Ye.DEBUG&&ee("QueryEngine","Using full collection scan to execute query:",Mo(t)),this.Ji.getDocumentsMatchingQuery(e,t,Kn.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ER{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Et(Me),this._s=new ls(i=>qi(i),uu),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Tb(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function Ab(n,e,t,r){return new ER(n,e,t,r)}async function Pb(n,e){const t=de(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let u=Ge();for(const c of s){o.push(c.batchId);for(const d of c.mutations)u=u.add(d.key)}for(const c of i){a.push(c.batchId);for(const d of c.mutations)u=u.add(d.key)}return t.localDocuments.getDocuments(r,u).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function TR(n,e){const t=de(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,u,c,d){const f=c.batch,g=f.keys();let _=M.resolve();return g.forEach(C=>{_=_.next(()=>d.getEntry(u,C)).next(T=>{const k=c.docVersions.get(C);we(k!==null),T.version.compareTo(k)<0&&(f.applyToRemoteDocument(T,c),T.isValidDocument()&&(T.setReadTime(c.commitVersion),d.addEntry(T)))})}),_.next(()=>a.mutationQueue.removeMutationBatch(u,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=Ge();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function Sb(n){const e=de(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function xR(n,e){const t=de(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((d,f)=>{const g=s.get(f);if(!g)return;a.push(t.Ur.removeMatchingKeys(i,d.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,d.addedDocuments,f)));let _=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?_=_.withResumeToken(Ft.EMPTY_BYTE_STRING,Te.min()).withLastLimboFreeSnapshotVersion(Te.min()):d.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(d.resumeToken,r)),s=s.insert(f,_),function(T,k,j){return T.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-T.snapshotVersion.toMicroseconds()>=3e8?!0:j.addedDocuments.size+j.modifiedDocuments.size+j.removedDocuments.size>0}(g,_,d)&&a.push(t.Ur.updateTargetData(i,_))});let u=Ln(),c=Ge();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,d))}),a.push(Rb(i,o,e.documentUpdates).next(d=>{u=d.Ps,c=d.Is})),!r.isEqual(Te.min())){const d=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(d)}return M.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,u,c)).next(()=>u)}).then(i=>(t.os=s,i))}function Rb(n,e,t){let r=Ge(),s=Ge();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=Ln();return t.forEach((a,u)=>{const c=i.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),u.isNoDocument()&&u.version.isEqual(Te.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):ee("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{Ps:o,Is:s}})}function AR(n,e){const t=de(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function ca(n,e){const t=de(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,M.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new Gr(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function da(n,e,t){const r=de(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!ri(o))throw o;ee("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function zc(n,e,t){const r=de(n);let s=Te.min(),i=Ge();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,d){const f=de(u),g=f._s.get(d);return g!==void 0?M.resolve(f.os.get(g)):f.Ur.getTargetData(c,d)}(r,o,Tn(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(u=>{i=u})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:Te.min(),t?i:Ge())).next(a=>(Db(r,M0(e),a),{documents:a,Ts:i})))}function Cb(n,e){const t=de(n),r=de(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function kb(n,e){const t=de(n),r=t.us.get(e)||Te.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,u0(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(Db(t,e,s),s))}function Db(n,e,t){let r=n.us.get(e)||Te.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function PR(n,e,t,r){const s=de(n);let i=Ge(),o=Ln();for(const c of t){const d=e.Es(c.metadata.name);c.document&&(i=i.add(d));const f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(d,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),u=await ca(s,function(d){return Tn(Ia(Xe.fromString(`__bundle__/docs/${d}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>Rb(c,a,o).next(d=>(a.apply(c),d)).next(d=>s.Ur.removeMatchingKeysForTargetId(c,u.targetId).next(()=>s.Ur.addMatchingKeys(c,i,u.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,d.Ps,d.Is)).next(()=>d.Ps)))}async function SR(n,e,t=Ge()){const r=await ca(n,Tn(bp(e.bundledQuery))),s=de(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=Kt(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(Ft.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function Sv(n,e){return`firestore_clients_${n}_${e}`}function Rv(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function kh(n,e){return`firestore_targets_${n}_${e}`}class Gc{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new te(s.error.code,s.error.message))),o?new Gc(e,t,s.state,i):(zt("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Pl{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new te(r.error.code,r.error.message))),i?new Pl(e,r.state,s):(zt("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Kc{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=hp();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=p0(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Kc(e,i):(zt("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Sp{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Sp(t.clientId,t.onlineState):(zt("SharedClientState",`Failed to parse online state: ${e}`),null)}}class xf{constructor(){this.activeTargetIds=hp()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Dh{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Et(Me),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=Sv(this.persistenceKey,this.ps),this.vs=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new xf),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.Os=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(Sv(this.persistenceKey,r));if(s){const i=Kc.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(kh(this.persistenceKey,e));if(s){const i=Pl.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(kh(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return ee("SharedClientState","READ",e,t),t}setItem(e,t){ee("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){ee("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(ee("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void zt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=On.oe;if(i!=null)try{const a=JSON.parse(i);we(typeof a=="number"),o=a}catch(a){zt("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==On.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new Gc(this.currentUser,e,t,r),i=Rv(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=Rv(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=kh(this.persistenceKey,e),i=new Pl(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return Kc.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return Gc.Rs(new on(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return Pl.Rs(s,t)}Ls(e){return Sp.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);ee("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(u=>{s.has(u)||o.push(u)}),s.forEach(u=>{i.has(u)||a.push(u)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=hp();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class Vb{constructor(){this.so=new xf,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new xf,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RR{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cv{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){ee("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){ee("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ec=null;function Vh(){return ec===null?ec=function(){return 268435456+Math.round(2147483648*Math.random())}():ec++,"0x"+ec.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kR{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gn="WebChannelConnection";class DR extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=Vh(),u=this.xo(t,r.toUriEncodedString());ee("RestConnection",`Sending RPC '${t}' ${a}:`,u,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,u,c,s).then(d=>(ee("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw Xn("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",u,"request:",s),d})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+wa}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=CR[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=Vh();return new Promise((o,a)=>{const u=new e0;u.setWithCredentials(!0),u.listenOnce(t0.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case uc.NO_ERROR:const d=u.getResponseJson();ee(gn,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(d)),o(d);break;case uc.TIMEOUT:ee(gn,`RPC '${e}' ${i} timed out`),a(new te(G.DEADLINE_EXCEEDED,"Request time out"));break;case uc.HTTP_ERROR:const f=u.getStatus();if(ee(gn,`RPC '${e}' ${i} failed with status:`,f,"response text:",u.getResponseText()),f>0){let g=u.getResponseJson();Array.isArray(g)&&(g=g[0]);const _=g==null?void 0:g.error;if(_&&_.status&&_.message){const C=function(k){const j=k.toLowerCase().replace(/_/g,"-");return Object.values(G).indexOf(j)>=0?j:G.UNKNOWN}(_.status);a(new te(C,_.message))}else a(new te(G.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new te(G.UNAVAILABLE,"Connection failed."));break;default:ye()}}finally{ee(gn,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);ee(gn,`RPC '${e}' ${i} sending request:`,s),u.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=Vh(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=s0(),a=r0(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Oo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const d=i.join("");ee(gn,`Creating RPC '${e}' stream ${s}: ${d}`,u);const f=o.createWebChannel(d,u);let g=!1,_=!1;const C=new kR({Io:k=>{_?ee(gn,`Not sending because RPC '${e}' stream ${s} is closed:`,k):(g||(ee(gn,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),ee(gn,`RPC '${e}' stream ${s} sending:`,k),f.send(k))},To:()=>f.close()}),T=(k,j,q)=>{k.listen(j,U=>{try{q(U)}catch(z){setTimeout(()=>{throw z},0)}})};return T(f,ul.EventType.OPEN,()=>{_||(ee(gn,`RPC '${e}' stream ${s} transport opened.`),C.yo())}),T(f,ul.EventType.CLOSE,()=>{_||(_=!0,ee(gn,`RPC '${e}' stream ${s} transport closed`),C.So())}),T(f,ul.EventType.ERROR,k=>{_||(_=!0,Xn(gn,`RPC '${e}' stream ${s} transport errored:`,k),C.So(new te(G.UNAVAILABLE,"The operation could not be completed")))}),T(f,ul.EventType.MESSAGE,k=>{var j;if(!_){const q=k.data[0];we(!!q);const U=q,z=U.error||((j=U[0])===null||j===void 0?void 0:j.error);if(z){ee(gn,`RPC '${e}' stream ${s} received error:`,z);const Y=z.status;let H=function(R){const x=Qt[R];if(x!==void 0)return Y0(x)}(Y),P=z.message;H===void 0&&(H=G.INTERNAL,P="Unknown error status: "+Y+" with message "+z.message),_=!0,C.So(new te(H,P)),f.close()}else ee(gn,`RPC '${e}' stream ${s} received:`,q),C.bo(q)}}),T(a,n0.STAT_EVENT,k=>{k.stat===uf.PROXY?ee(gn,`RPC '${e}' stream ${s} detected buffering proxy`):k.stat===uf.NOPROXY&&ee(gn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{C.wo()},0),C}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nb(){return typeof window<"u"?window:null}function gc(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mu(n){return new $S(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rp{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&ee("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ob{constructor(e,t,r,s,i,o,a,u){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Rp(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===G.RESOURCE_EXHAUSTED?(zt(t.toString()),zt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===G.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new te(G.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return ee("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(ee("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class VR extends Ob{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=qS(this.serializer,e),r=function(i){if(!("targetChange"in i))return Te.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Te.min():o.readTime?Kt(o.readTime):Te.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=bf(this.serializer),t.addTarget=function(i,o){let a;const u=o.target;if(a=Mc(u)?{documents:ab(i,u)}:{query:Td(i,u)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=tb(i,o.resumeToken);const c=yf(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(Te.min())>0){a.readTime=ua(i,o.snapshotVersion.toTimestamp());const c=yf(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=GS(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=bf(this.serializer),t.removeTarget=e,this.a_(t)}}class NR extends Ob{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return we(!!e.streamToken),this.lastStreamToken=e.streamToken,we(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){we(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=zS(e.writeResults,e.commitTime),r=Kt(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=bf(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Gl(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OR extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new te(G.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,_f(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===G.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new te(G.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,_f(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===G.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new te(G.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class MR{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(zt(t),this.D_=!1):ee("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LR{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{ii(this)&&(ee("RemoteStore","Restarting streams for network reachability change."),await async function(u){const c=de(u);c.L_.add(4),await xa(c),c.q_.set("Unknown"),c.L_.delete(4),await gu(c)}(this))})}),this.q_=new MR(r,s)}}async function gu(n){if(ii(n))for(const e of n.B_)await e(!0)}async function xa(n){for(const e of n.B_)await e(!1)}function Sd(n,e){const t=de(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Dp(t)?kp(t):Pa(t).r_()&&Cp(t,e))}function ha(n,e){const t=de(n),r=Pa(t);t.N_.delete(e),r.r_()&&Mb(t,e),t.N_.size===0&&(r.r_()?r.o_():ii(t)&&t.q_.set("Unknown"))}function Cp(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Te.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Pa(n).A_(e)}function Mb(n,e){n.Q_.xe(e),Pa(n).R_(e)}function kp(n){n.Q_=new MS({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Pa(n).start(),n.q_.v_()}function Dp(n){return ii(n)&&!Pa(n).n_()&&n.N_.size>0}function ii(n){return de(n).L_.size===0}function Lb(n){n.Q_=void 0}async function FR(n){n.q_.set("Online")}async function UR(n){n.N_.forEach((e,t)=>{Cp(n,e)})}async function $R(n,e){Lb(n),Dp(n)?(n.q_.M_(e),kp(n)):n.q_.set("Unknown")}async function jR(n,e,t){if(n.q_.set("Online"),e instanceof eb&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){ee("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Hc(n,r)}else if(e instanceof mc?n.Q_.Ke(e):e instanceof Z0?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Te.min()))try{const r=await Sb(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){const d=i.N_.get(c);d&&i.N_.set(c,d.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{const d=i.N_.get(u);if(!d)return;i.N_.set(u,d.withResumeToken(Ft.EMPTY_BYTE_STRING,d.snapshotVersion)),Mb(i,u);const f=new Gr(d.target,u,c,d.sequenceNumber);Cp(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){ee("RemoteStore","Failed to raise snapshot:",r),await Hc(n,r)}}async function Hc(n,e,t){if(!ri(e))throw e;n.L_.add(1),await xa(n),n.q_.set("Offline"),t||(t=()=>Sb(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{ee("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await gu(n)})}function Fb(n,e){return e().catch(t=>Hc(n,t,e))}async function Aa(n){const e=de(n),t=Xs(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;BR(e);)try{const s=await AR(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,qR(e,s)}catch(s){await Hc(e,s)}Ub(e)&&$b(e)}function BR(n){return ii(n)&&n.O_.length<10}function qR(n,e){n.O_.push(e);const t=Xs(n);t.r_()&&t.V_&&t.m_(e.mutations)}function Ub(n){return ii(n)&&!Xs(n).n_()&&n.O_.length>0}function $b(n){Xs(n).start()}async function zR(n){Xs(n).p_()}async function GR(n){const e=Xs(n);for(const t of n.O_)e.m_(t.mutations)}async function KR(n,e,t){const r=n.O_.shift(),s=gp.from(r,e,t);await Fb(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Aa(n)}async function HR(n,e){e&&Xs(n).V_&&await async function(r,s){if(function(o){return J0(o)&&o!==G.ABORTED}(s.code)){const i=r.O_.shift();Xs(r).s_(),await Fb(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Aa(r)}}(n,e),Ub(n)&&$b(n)}async function kv(n,e){const t=de(n);t.asyncQueue.verifyOperationInProgress(),ee("RemoteStore","RemoteStore received new credentials");const r=ii(t);t.L_.add(3),await xa(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await gu(t)}async function Af(n,e){const t=de(n);e?(t.L_.delete(2),await gu(t)):e||(t.L_.add(2),await xa(t),t.q_.set("Unknown"))}function Pa(n){return n.K_||(n.K_=function(t,r,s){const i=de(t);return i.w_(),new VR(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:FR.bind(null,n),Ro:UR.bind(null,n),mo:$R.bind(null,n),d_:jR.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Dp(n)?kp(n):n.q_.set("Unknown")):(await n.K_.stop(),Lb(n))})),n.K_}function Xs(n){return n.U_||(n.U_=function(t,r,s){const i=de(t);return i.w_(),new NR(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:zR.bind(null,n),mo:HR.bind(null,n),f_:GR.bind(null,n),g_:KR.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await Aa(n)):(await n.U_.stop(),n.O_.length>0&&(ee("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vp{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new an,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Vp(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new te(G.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Sa(n,e){if(zt("AsyncQueue",`${e}: ${n}`),ri(n))return new te(G.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ko{constructor(e){this.comparator=e?(t,r)=>e(t,r)||me.comparator(t.key,r.key):(t,r)=>me.comparator(t.key,r.key),this.keyedMap=cl(),this.sortedSet=new Et(this.comparator)}static emptySet(e){return new Ko(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ko)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Ko;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dv{constructor(){this.W_=new Et(me.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):ye():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class fa{constructor(e,t,r,s,i,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new fa(e,t,Ko.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&cu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WR{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class QR{constructor(){this.queries=Vv(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=de(t),i=s.queries;s.queries=Vv(),i.forEach((o,a)=>{for(const u of a.j_)u.onError(r)})})(this,new te(G.ABORTED,"Firestore shutting down"))}}function Vv(){return new ls(n=>O0(n),cu)}async function Np(n,e){const t=de(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new WR,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Sa(o,`Initialization of query '${Mo(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Mp(t)}async function Op(n,e){const t=de(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function JR(n,e){const t=de(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&Mp(t)}function YR(n,e,t){const r=de(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function Mp(n){n.Y_.forEach(e=>{e.next()})}var Pf,Nv;(Nv=Pf||(Pf={})).ea="default",Nv.Cache="cache";class Lp{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new fa(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=fa.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Pf.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XR{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ov{constructor(e){this.serializer=e}Es(e){return Pr(this.serializer,e)}ds(e){return e.metadata.exists?ob(this.serializer,e.document,!1):xt.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Kt(e)}}class ZR{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=jb(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=Xe.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new Ov(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||Ge()).add(i);t.set(o,a)}}return t}async complete(){const e=await PR(this.localStore,new Ov(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await SR(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function jb(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bb{constructor(e){this.key=e}}class qb{constructor(e){this.key=e}}class zb{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Ge(),this.mutatedKeys=Ge(),this.Aa=L0(e),this.Ra=new Ko(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new Dv,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((d,f)=>{const g=s.get(d),_=du(this.query,f)?f:null,C=!!g&&this.mutatedKeys.has(g.key),T=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let k=!1;g&&_?g.data.isEqual(_.data)?C!==T&&(r.track({type:3,doc:_}),k=!0):this.ga(g,_)||(r.track({type:2,doc:_}),k=!0,(u&&this.Aa(_,u)>0||c&&this.Aa(_,c)<0)&&(a=!0)):!g&&_?(r.track({type:0,doc:_}),k=!0):g&&!_&&(r.track({type:1,doc:g}),k=!0,(u||c)&&(a=!0)),k&&(_?(o=o.add(_),i=T?i.add(d):i.delete(d)):(o=o.delete(d),i=i.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),i=i.delete(d.key),r.track({type:1,doc:d})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((d,f)=>function(_,C){const T=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ye()}};return T(_)-T(C)}(d.type,f.type)||this.Aa(d.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],u=this.da.size===0&&this.current&&!s?1:0,c=u!==this.Ea;return this.Ea=u,o.length!==0||c?{snapshot:new fa(this.query,e.Ra,i,o,e.mutatedKeys,u===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Dv,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Ge(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new qb(r))}),this.da.forEach(r=>{e.has(r)||t.push(new Bb(r))}),t}ba(e){this.Ta=e.Ts,this.da=Ge();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return fa.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class e1{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class t1{constructor(e){this.key=e,this.va=!1}}class n1{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new ls(a=>O0(a),cu),this.Ma=new Map,this.xa=new Set,this.Oa=new Et(me.comparator),this.Na=new Map,this.La=new Ep,this.Ba={},this.ka=new Map,this.qa=Wi.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function r1(n,e,t=!0){const r=Rd(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await Gb(r,e,t,!0),s}async function s1(n,e){const t=Rd(n);await Gb(t,e,!0,!1)}async function Gb(n,e,t,r){const s=await ca(n.localStore,Tn(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await Fp(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&Sd(n.remoteStore,s),a}async function Fp(n,e,t,r,s){n.Ka=(f,g,_)=>async function(T,k,j,q){let U=k.view.ma(j);U.ns&&(U=await zc(T.localStore,k.query,!1).then(({documents:P})=>k.view.ma(P,U)));const z=q&&q.targetChanges.get(k.targetId),Y=q&&q.targetMismatches.get(k.targetId)!=null,H=k.view.applyChanges(U,T.isPrimaryClient,z,Y);return Sf(T,k.targetId,H.wa),H.snapshot}(n,f,g,_);const i=await zc(n.localStore,e,!0),o=new zb(e,i.Ts),a=o.ma(i.documents),u=pu.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,u);Sf(n,t,c.wa);const d=new e1(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function i1(n,e,t){const r=de(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!cu(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await da(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&ha(r.remoteStore,s.targetId),pa(r,s.targetId)}).catch(ni)):(pa(r,s.targetId),await da(r.localStore,s.targetId,!0))}async function o1(n,e){const t=de(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ha(t.remoteStore,r.targetId))}async function a1(n,e,t){const r=Bp(n);try{const s=await function(o,a){const u=de(o),c=Mt.now(),d=a.reduce((_,C)=>_.add(C.key),Ge());let f,g;return u.persistence.runTransaction("Locally write mutations","readwrite",_=>{let C=Ln(),T=Ge();return u.cs.getEntries(_,d).next(k=>{C=k,C.forEach((j,q)=>{q.isValidDocument()||(T=T.add(j))})}).next(()=>u.localDocuments.getOverlayedDocuments(_,C)).next(k=>{f=k;const j=[];for(const q of a){const U=VS(q,f.get(q.key).overlayedDocument);U!=null&&j.push(new us(q.key,U,T0(U.value.mapValue),Dt.exists(!0)))}return u.mutationQueue.addMutationBatch(_,c,j,a)}).next(k=>{g=k;const j=k.applyToLocalDocumentSet(f,T);return u.documentOverlayCache.saveOverlays(_,k.batchId,j)})}).then(()=>({batchId:g.batchId,changes:U0(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,u){let c=o.Ba[o.currentUser.toKey()];c||(c=new Et(Me)),c=c.insert(a,u),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await cs(r,s.changes),await Aa(r.remoteStore)}catch(s){const i=Sa(s,"Failed to persist write");t.reject(i)}}async function Kb(n,e){const t=de(n);try{const r=await xR(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(we(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?we(o.va):s.removedDocuments.size>0&&(we(o.va),o.va=!1))}),await cs(t,r,e)}catch(r){await ni(r)}}function Mv(n,e,t){const r=de(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const u=de(o);u.onlineState=a;let c=!1;u.queries.forEach((d,f)=>{for(const g of f.j_)g.Z_(a)&&(c=!0)}),c&&Mp(u)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function l1(n,e,t){const r=de(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Et(me.comparator);o=o.insert(i,xt.newNoDocument(i,Te.min()));const a=Ge().add(i),u=new fu(Te.min(),new Map,new Et(Me),o,a);await Kb(r,u),r.Oa=r.Oa.remove(i),r.Na.delete(e),jp(r)}else await da(r.localStore,e,!1).then(()=>pa(r,e,t)).catch(ni)}async function u1(n,e){const t=de(n),r=e.batch.batchId;try{const s=await TR(t.localStore,e);$p(t,r,null),Up(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await cs(t,s)}catch(s){await ni(s)}}async function c1(n,e,t){const r=de(n);try{const s=await function(o,a){const u=de(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let d;return u.mutationQueue.lookupMutationBatch(c,a).next(f=>(we(f!==null),d=f.keys(),u.mutationQueue.removeMutationBatch(c,f))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,d,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,d)).next(()=>u.localDocuments.getDocuments(c,d))})}(r.localStore,e);$p(r,e,t),Up(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await cs(r,s)}catch(s){await ni(s)}}async function d1(n,e){const t=de(n);ii(t.remoteStore)||ee("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=de(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=Sa(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function Up(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function $p(n,e,t){const r=de(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function pa(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||Hb(n,r)})}function Hb(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(ha(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),jp(n))}function Sf(n,e,t){for(const r of t)r instanceof Bb?(n.La.addReference(r.key,e),h1(n,r)):r instanceof qb?(ee("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||Hb(n,r.key)):ye()}function h1(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(ee("SyncEngine","New document in limbo: "+t),n.xa.add(r),jp(n))}function jp(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new me(Xe.fromString(e)),r=n.qa.next();n.Na.set(r,new t1(t)),n.Oa=n.Oa.insert(t,r),Sd(n.remoteStore,new Gr(Tn(Ia(t.path)),r,"TargetPurposeLimboResolution",On.oe))}}async function cs(n,e,t){const r=de(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,u)=>{o.push(r.Ka(u,e,t).then(c=>{var d;if((c||t)&&r.isPrimaryClient){const f=c?!c.fromCache:(d=t==null?void 0:t.targetChanges.get(u.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(u.targetId,f?"current":"not-current")}if(c){s.push(c);const f=Pp.Wi(u.targetId,c);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(u,c){const d=de(u);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>M.forEach(c,g=>M.forEach(g.$i,_=>d.persistence.referenceDelegate.addReference(f,g.targetId,_)).next(()=>M.forEach(g.Ui,_=>d.persistence.referenceDelegate.removeReference(f,g.targetId,_)))))}catch(f){if(!ri(f))throw f;ee("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const g=f.targetId;if(!f.fromCache){const _=d.os.get(g),C=_.snapshotVersion,T=_.withLastLimboFreeSnapshotVersion(C);d.os=d.os.insert(g,T)}}}(r.localStore,i))}async function f1(n,e){const t=de(n);if(!t.currentUser.isEqual(e)){ee("SyncEngine","User change. New user:",e.toKey());const r=await Pb(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(u=>{u.reject(new te(G.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await cs(t,r.hs)}}function p1(n,e){const t=de(n),r=t.Na.get(e);if(r&&r.va)return Ge().add(r.key);{let s=Ge();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function m1(n,e){const t=de(n),r=await zc(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&Sf(t,e.targetId,s.wa),s}async function g1(n,e){const t=de(n);return kb(t.localStore,e).then(r=>cs(t,r))}async function v1(n,e,t,r){const s=de(n),i=await function(a,u){const c=de(a),d=de(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>d.Mn(f,u).next(g=>g?c.localDocuments.getDocuments(f,g):M.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await Aa(s.remoteStore):t==="acknowledged"||t==="rejected"?($p(s,e,r||null),Up(s,e),function(a,u){de(de(a).mutationQueue).On(u)}(s.localStore,e)):ye(),await cs(s,i)):ee("SyncEngine","Cannot apply mutation batch with id: "+e)}async function y1(n,e){const t=de(n);if(Rd(t),Bp(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await Lv(t,r.toArray());t.Qa=!0,await Af(t.remoteStore,!0);for(const i of s)Sd(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(pa(t,o),da(t.localStore,o,!0))),ha(t.remoteStore,o)}),await s,await Lv(t,r),function(o){const a=de(o);a.Na.forEach((u,c)=>{ha(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new Et(me.comparator)}(t),t.Qa=!1,await Af(t.remoteStore,!1)}}async function Lv(n,e,t){const r=de(n),s=[],i=[];for(const o of e){let a;const u=r.Ma.get(o);if(u&&u.length!==0){a=await ca(r.localStore,Tn(u[0]));for(const c of u){const d=r.Fa.get(c),f=await m1(r,d);f.snapshot&&i.push(f.snapshot)}}else{const c=await Cb(r.localStore,o);a=await ca(r.localStore,c),await Fp(r,Wb(c),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function Wb(n){return D0(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function _1(n){return function(t){return de(de(t).persistence).Qi()}(de(n).localStore)}async function b1(n,e,t,r){const s=de(n);if(s.Qa)return void ee("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await kb(s.localStore,M0(i[0])),a=fu.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ft.EMPTY_BYTE_STRING);await cs(s,o,a);break}case"rejected":await da(s.localStore,e,!0),pa(s,e,r);break;default:ye()}}async function w1(n,e,t){const r=Rd(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){ee("SyncEngine","Adding an already active target "+s);continue}const i=await Cb(r.localStore,s),o=await ca(r.localStore,i);await Fp(r,Wb(i),o.targetId,!1,o.resumeToken),Sd(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await da(r.localStore,s,!1).then(()=>{ha(r.remoteStore,s),pa(r,s)}).catch(ni)}}function Rd(n){const e=de(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Kb.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=p1.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=l1.bind(null,e),e.Ca.d_=JR.bind(null,e.eventManager),e.Ca.$a=YR.bind(null,e.eventManager),e}function Bp(n){const e=de(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=u1.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=c1.bind(null,e),e}function I1(n,e,t){const r=de(n);(async function(i,o,a){try{const u=await o.getMetadata();if(await function(_,C){const T=de(_),k=Kt(C.createTime);return T.persistence.runTransaction("hasNewerBundle","readonly",j=>T.Gr.getBundleMetadata(j,C.id)).then(j=>!!j&&j.createTime.compareTo(k)>=0)}(i.localStore,u))return await o.close(),a._completeWith(function(_){return{taskState:"Success",documentsLoaded:_.totalDocuments,bytesLoaded:_.totalBytes,totalDocuments:_.totalDocuments,totalBytes:_.totalBytes}}(u)),Promise.resolve(new Set);a._updateProgress(jb(u));const c=new ZR(u,i.localStore,o.serializer);let d=await o.Ua();for(;d;){const g=await c.la(d);g&&a._updateProgress(g),d=await o.Ua()}const f=await c.complete();return await cs(i,f.Ia,void 0),await function(_,C){const T=de(_);return T.persistence.runTransaction("Save bundle","readwrite",k=>T.Gr.saveBundleMetadata(k,C))}(i.localStore,u),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(u){return Xn("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class Zs{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=mu(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return Ab(this.persistence,new xb,e.initialUser,this.serializer)}Ga(e){return new Tp(Pd.Zr,this.serializer)}Wa(e){return new Vb}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Zs.provider={build:()=>new Zs};class E1 extends Zs{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){we(this.persistence.referenceDelegate instanceof qc);const r=this.persistence.referenceDelegate.garbageCollector;return new bb(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?yn.withCacheSize(this.cacheSizeBytes):yn.DEFAULT;return new Tp(r=>qc.Zr(r,t),this.serializer)}}class qp extends Zs{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await Bp(this.Ja.syncEngine),await Aa(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return Ab(this.persistence,new xb,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new bb(r,e.asyncQueue,t)}Ha(e,t){const r=new GP(t,this.persistence);return new zP(e.asyncQueue,r)}Ga(e){const t=Ap(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?yn.withCacheSize(this.cacheSizeBytes):yn.DEFAULT;return new xp(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Nb(),gc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new Vb}}class Qb extends qp{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof Dh&&(this.sharedClientState.syncEngine={no:v1.bind(null,t),ro:b1.bind(null,t),io:w1.bind(null,t),Qi:_1.bind(null,t),eo:g1.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await y1(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=Nb();if(!Dh.D(t))throw new te(G.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Ap(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Dh(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class ei{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Mv(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=f1.bind(null,this.syncEngine),await Af(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new QR}()}createDatastore(e){const t=mu(e.databaseInfo.databaseId),r=function(i){return new DR(i)}(e.databaseInfo);return function(i,o,a,u){return new OR(i,o,a,u)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new LR(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>Mv(this.syncEngine,t,0),function(){return Cv.D()?new Cv:new RR}())}createSyncEngine(e,t){return function(s,i,o,a,u,c,d){const f=new n1(s,i,o,a,u,c);return d&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=de(s);ee("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await xa(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}ei.provider={build:()=>new ei};function Fv(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):zt("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T1{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new an,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new XR(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x1{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new te(G.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=de(s),a={documents:i.map(f=>zl(o.serializer,f))},u=await o.Lo("BatchGetDocuments",o.serializer.databaseId,Xe.emptyPath(),a,i.length),c=new Map;u.forEach(f=>{const g=BS(o.serializer,f);c.set(g.key.toString(),g)});const d=[];return i.forEach(f=>{const g=c.get(f.toString());we(!!g),d.push(g)}),d}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Ta(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=me.fromPath(r);this.mutations.push(new pp(s,this.precondition(s)))}),await async function(r,s){const i=de(r),o={writes:s.map(a=>Gl(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,Xe.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw ye();t=Te.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new te(G.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Te.min())?Dt.exists(!1):Dt.updateTime(t):Dt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Te.min()))throw new te(G.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Dt.updateTime(t)}return Dt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A1{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new Rp(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new x1(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!lu(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!J0(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P1{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=on.UNAUTHENTICATED,this.clientId=a0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{ee("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(ee("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new an;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Sa(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Nh(n,e){n.asyncQueue.verifyOperationInProgress(),ee("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await Pb(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function Uv(n,e){n.asyncQueue.verifyOperationInProgress();const t=await zp(n);ee("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>kv(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>kv(e.remoteStore,s)),n._onlineComponents=e}async function zp(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){ee("FirestoreClient","Using user provided OfflineComponentProvider");try{await Nh(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===G.FAILED_PRECONDITION||s.code===G.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Xn("Error using user provided cache. Falling back to memory cache: "+t),await Nh(n,new Zs)}}else ee("FirestoreClient","Using default OfflineComponentProvider"),await Nh(n,new Zs);return n._offlineComponents}async function kd(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(ee("FirestoreClient","Using user provided OnlineComponentProvider"),await Uv(n,n._uninitializedComponentsProvider._online)):(ee("FirestoreClient","Using default OnlineComponentProvider"),await Uv(n,new ei))),n._onlineComponents}function Jb(n){return zp(n).then(e=>e.persistence)}function Ra(n){return zp(n).then(e=>e.localStore)}function Yb(n){return kd(n).then(e=>e.remoteStore)}function Gp(n){return kd(n).then(e=>e.syncEngine)}function Xb(n){return kd(n).then(e=>e.datastore)}async function ma(n){const e=await kd(n),t=e.eventManager;return t.onListen=r1.bind(null,e.syncEngine),t.onUnlisten=i1.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=s1.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=o1.bind(null,e.syncEngine),t}function S1(n){return n.asyncQueue.enqueue(async()=>{const e=await Jb(n),t=await Yb(n);return e.setNetworkEnabled(!0),function(s){const i=de(s);return i.L_.delete(0),gu(i)}(t)})}function R1(n){return n.asyncQueue.enqueue(async()=>{const e=await Jb(n),t=await Yb(n);return e.setNetworkEnabled(!1),async function(s){const i=de(s);i.L_.add(0),await xa(i),i.q_.set("Offline")}(t)})}function C1(n,e){const t=new an;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(c,d){const f=de(c);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,d))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new te(G.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const u=Sa(a,`Failed to get document '${i} from cache`);o.reject(u)}}(await Ra(n),e,t)),t.promise}function Zb(n,e,t={}){const r=new an;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,u,c){const d=new Cd({next:g=>{d.Za(),o.enqueueAndForget(()=>Op(i,f));const _=g.docs.has(a);!_&&g.fromCache?c.reject(new te(G.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&g.fromCache&&u&&u.source==="server"?c.reject(new te(G.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new Lp(Ia(a.path),d,{includeMetadataChanges:!0,_a:!0});return Np(i,f)}(await ma(n),n.asyncQueue,e,t,r)),r.promise}function k1(n,e){const t=new an;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await zc(s,i,!0),u=new zb(i,a.Ts),c=u.ma(a.documents),d=u.applyChanges(c,!1);o.resolve(d.snapshot)}catch(a){const u=Sa(a,`Failed to execute query '${i} against cache`);o.reject(u)}}(await Ra(n),e,t)),t.promise}function ew(n,e,t={}){const r=new an;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,u,c){const d=new Cd({next:g=>{d.Za(),o.enqueueAndForget(()=>Op(i,f)),g.fromCache&&u.source==="server"?c.reject(new te(G.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new Lp(a,d,{includeMetadataChanges:!0,_a:!0});return Np(i,f)}(await ma(n),n.asyncQueue,e,t,r)),r.promise}function D1(n,e,t){const r=new an;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await Xb(n);r.resolve(async function(o,a,u){var c;const d=de(o),{request:f,ut:g,parent:_}=lb(d.serializer,V0(a),u);d.connection.Fo||delete f.parent;const C=(await d.Lo("RunAggregationQuery",d.serializer.databaseId,_,f,1)).filter(k=>!!k.result);we(C.length===1);const T=(c=C[0].result)===null||c===void 0?void 0:c.aggregateFields;return Object.keys(T).reduce((k,j)=>(k[g[j]]=T[j],k),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function V1(n,e){const t=new Cd(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){de(s).Y_.add(i),i.next()}(await ma(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){de(s).Y_.delete(i)}(await ma(n),t))}}function N1(n,e,t,r){const s=function(o,a){let u;return u=typeof o=="string"?X0().encode(o):o,function(d,f){return new T1(d,f)}(function(d,f){if(d instanceof Uint8Array)return Fv(d,f);if(d instanceof ArrayBuffer)return Fv(new Uint8Array(d),f);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),a)}(t,mu(e));n.asyncQueue.enqueueAndForget(async()=>{I1(await Gp(n),s,r)})}function O1(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=de(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await Ra(n),e))}function M1(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=de(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",u=>o.getFieldIndexes(u).next(c=>function(f,g,_,C,T){f=[...f],g=[...g],f.sort(_),g.sort(_);const k=f.length,j=g.length;let q=0,U=0;for(;q<j&&U<k;){const z=_(f[U],g[q]);z<0?T(f[U++]):z>0?C(g[q++]):(q++,U++)}for(;q<j;)C(g[q++]);for(;U<k;)T(f[U++])}(c,s,$P,d=>{a.push(o.addFieldIndex(u,d))},d=>{a.push(o.deleteFieldIndex(u,d))})).next(()=>M.waitFor(a)))}(await Ra(n),e))}function L1(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){de(r).ss.zi=s}(await Ra(n),e))}function F1(n){return n.asyncQueue.enqueue(async()=>function(t){const r=de(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Ra(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tw(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $v=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kp(n,e,t){if(!t)throw new te(G.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function U1(n,e,t,r){if(e===!0&&r===!0)throw new te(G.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function jv(n){if(!me.isDocumentKey(n))throw new te(G.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Bv(n){if(me.isDocumentKey(n))throw new te(G.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Dd(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ye()}function Qe(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new te(G.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Dd(n);throw new te(G.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function nw(n,e){if(e<=0)throw new te(G.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qv{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new te(G.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new te(G.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}U1("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=tw((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new te(G.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new te(G.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new te(G.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class vu{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new qv({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new te(G.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new te(G.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new qv(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new DP;switch(r.type){case"firstParty":return new MP(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new te(G.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=$v.get(t);r&&(ee("ComponentProvider","Removing Datastore"),$v.delete(t),r.terminate())}(this),Promise.resolve()}}function $1(n,e,t,r={}){var s;const i=(n=Qe(n,vu))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Xn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,u;if(typeof r.mockUserToken=="string")a=r.mockUserToken,u=on.MOCK_USER;else{a=aA(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new te(G.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new on(c)}n._authCredentials=new VP(new i0(a,u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new pn(this.firestore,e,this._query)}}class Ht{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Sr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ht(this.firestore,e,this._key)}}class Sr extends pn{constructor(e,t,r){super(e,t,Ia(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ht(this.firestore,null,new me(e))}withConverter(e){return new Sr(this.firestore,e,this._path)}}function nt(n,e,...t){if(n=xe(n),Kp("collection","path",e),n instanceof vu){const r=Xe.fromString(e,...t);return Bv(r),new Sr(n,null,r)}{if(!(n instanceof Ht||n instanceof Sr))throw new te(G.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Xe.fromString(e,...t));return Bv(r),new Sr(n.firestore,null,r)}}function b4(n,e){if(n=Qe(n,vu),Kp("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new te(G.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new pn(n,null,function(r){return new as(Xe.emptyPath(),r)}(e))}function De(n,e,...t){if(n=xe(n),arguments.length===1&&(e=a0.newId()),Kp("doc","path",e),n instanceof vu){const r=Xe.fromString(e,...t);return jv(r),new Ht(n,null,new me(r))}{if(!(n instanceof Ht||n instanceof Sr))throw new te(G.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Xe.fromString(e,...t));return jv(r),new Ht(n.firestore,n instanceof Sr?n.converter:null,new me(r))}}function w4(n,e){return n=xe(n),e=xe(e),(n instanceof Ht||n instanceof Sr)&&(e instanceof Ht||e instanceof Sr)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function rw(n,e){return n=xe(n),e=xe(e),n instanceof pn&&e instanceof pn&&n.firestore===e.firestore&&cu(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zv{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Rp(this,"async_queue_retry"),this.Vu=()=>{const r=gc();r&&ee("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=gc();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=gc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new an;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!ri(e))throw e;ee("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw zt("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Vp.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&ye()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function Rf(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class j1{constructor(){this._progressObserver={},this._taskCompletionResolver=new an,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I4=-1;class _t extends vu{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new zv,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new zv(e),this._firestoreClient=void 0,await e}}}function E4(n,e,t){t||(t="(default)");const r=au(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(Hs(i,e))return s;throw new te(G.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new te(G.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new te(G.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function B1(n,e){const t=typeof n=="object"?n:J_(),r=typeof n=="string"?n:e||"(default)",s=au(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=iA("firestore");i&&$1(s,...i)}return s}function Lt(n){if(n._terminated)throw new te(G.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||sw(n),n._firestoreClient}function sw(n){var e,t,r;const s=n._freezeSettings(),i=function(a,u,c,d){return new hS(a,u,c,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,tw(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new P1(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const u=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(u),_online:u}}(n._componentsProvider))}function q1(n,e){Xn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return iw(n,ei.provider,{build:r=>new qp(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function T4(n){Xn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();iw(n,ei.provider,{build:t=>new Qb(t,e.cacheSizeBytes)})}function iw(n,e,t){if((n=Qe(n,_t))._firestoreClient||n._terminated)throw new te(G.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new te(G.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},sw(n)}function x4(n){if(n._initialized&&!n._terminated)throw new te(G.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new an;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Ar.D())return Promise.resolve();const s=r+"main";await Ar.delete(s)}(Ap(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function A4(n){return function(t){const r=new an;return t.asyncQueue.enqueueAndForget(async()=>d1(await Gp(t),r)),r.promise}(Lt(n=Qe(n,_t)))}function P4(n){return S1(Lt(n=Qe(n,_t)))}function S4(n){return R1(Lt(n=Qe(n,_t)))}function R4(n){return yP(n.app,"firestore",n._databaseId.database),n._delete()}function C4(n,e){const t=Lt(n=Qe(n,_t)),r=new j1;return N1(t,n._databaseId,e,r),r}function k4(n,e){return O1(Lt(n=Qe(n,_t)),e).then(t=>t?new pn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kl{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class z1{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qi{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Qi(Ft.fromBase64String(e))}catch(t){throw new te(G.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Qi(Ft.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yi{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new te(G.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new kt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function D4(){return new Yi("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xi{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hp{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new te(G.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new te(G.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Me(this._lat,e._lat)||Me(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vd{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G1=/^__.*__$/;class K1{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new us(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ea(e,this.data,t,this.fieldTransforms)}}class ow{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new us(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function aw(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ye()}}class Nd{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Nd(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Wc(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(aw(this.Cu)&&G1.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class H1{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||mu(e)}Qu(e,t,r,s=!1){return new Nd({Cu:e,methodName:t,qu:r,path:kt.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Zi(n){const e=n._freezeSettings(),t=mu(n._databaseId);return new H1(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Od(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);em("Data must be an object, but it was:",o,r);const a=cw(r,o);let u,c;if(i.merge)u=new Mn(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const d=[];for(const f of i.mergeFields){const g=Hl(e,f,t);if(!o.contains(g))throw new te(G.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);hw(d,g)||d.push(g)}u=new Mn(d),c=o.fieldTransforms.filter(f=>u.covers(f.field))}else u=null,c=o.fieldTransforms;return new K1(new fn(a),u,c)}class yu extends Xi{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof yu}}function lw(n,e,t){return new Nd({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Wp extends Xi{_toFieldTransform(e){return new hu(e.path,new aa)}isEqual(e){return e instanceof Wp}}class Qp extends Xi{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=lw(this,e,!0),r=this.Ku.map(i=>eo(i,t)),s=new zi(r);return new hu(e.path,s)}isEqual(e){return e instanceof Qp&&Hs(this.Ku,e.Ku)}}class Jp extends Xi{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=lw(this,e,!0),r=this.Ku.map(i=>eo(i,t)),s=new Gi(r);return new hu(e.path,s)}isEqual(e){return e instanceof Jp&&Hs(this.Ku,e.Ku)}}class Yp extends Xi{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new la(e.serializer,B0(e.serializer,this.$u));return new hu(e.path,t)}isEqual(e){return e instanceof Yp&&this.$u===e.$u}}function Xp(n,e,t,r){const s=n.Qu(1,e,t);em("Data must be an object, but it was:",s,r);const i=[],o=fn.empty();si(r,(u,c)=>{const d=Md(e,u,t);c=xe(c);const f=s.Nu(d);if(c instanceof yu)i.push(d);else{const g=eo(c,f);g!=null&&(i.push(d),o.set(d,g))}});const a=new Mn(i);return new ow(o,a,s.fieldTransforms)}function Zp(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[Hl(e,r,t)],u=[s];if(i.length%2!=0)throw new te(G.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)a.push(Hl(e,i[g])),u.push(i[g+1]);const c=[],d=fn.empty();for(let g=a.length-1;g>=0;--g)if(!hw(c,a[g])){const _=a[g];let C=u[g];C=xe(C);const T=o.Nu(_);if(C instanceof yu)c.push(_);else{const k=eo(C,T);k!=null&&(c.push(_),d.set(_,k))}}const f=new Mn(c);return new ow(d,f,o.fieldTransforms)}function uw(n,e,t,r=!1){return eo(t,n.Qu(r?4:3,e))}function eo(n,e){if(dw(n=xe(n)))return em("Unsupported field value:",e,n),cw(n,e);if(n instanceof Xi)return function(r,s){if(!aw(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let u=eo(a,s.Lu(o));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=xe(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return B0(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Mt.fromDate(r);return{timestampValue:ua(s.serializer,i)}}if(r instanceof Mt){const i=new Mt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:ua(s.serializer,i)}}if(r instanceof Hp)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Qi)return{bytesValue:tb(s.serializer,r._byteString)};if(r instanceof Ht){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:_p(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Vd)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Bu("VectorValues must only contain numeric values.");return fp(a.serializer,u)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${Dd(r)}`)}(n,e)}function cw(n,e){const t={};return b0(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):si(n,(r,s)=>{const i=eo(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function dw(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Mt||n instanceof Hp||n instanceof Qi||n instanceof Ht||n instanceof Xi||n instanceof Vd)}function em(n,e,t){if(!dw(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=Dd(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function Hl(n,e,t){if((e=xe(e))instanceof Yi)return e._internalPath;if(typeof e=="string")return Md(n,e);throw Wc("Field path arguments must be of type string or ",n,!1,void 0,t)}const W1=new RegExp("[~\\*/\\[\\]]");function Md(n,e,t){if(e.search(W1)>=0)throw Wc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Yi(...e.split("."))._internalPath}catch{throw Wc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Wc(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${r}`),o&&(u+=` in document ${s}`),u+=")"),new te(G.INVALID_ARGUMENT,a+n+u)}function hw(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wl{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Ht(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Q1(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ld("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Q1 extends Wl{data(){return super.data()}}function Ld(n,e){return typeof e=="string"?Md(n,e):e instanceof Yi?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fw(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new te(G.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class tm{}class _u extends tm{}function Fd(n,e,...t){let r=[];e instanceof tm&&r.push(e),r=r.concat(t),function(i){const o=i.filter(u=>u instanceof Ca).length,a=i.filter(u=>u instanceof bu).length;if(o>1||o>0&&a>0)throw new te(G.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class bu extends _u{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new bu(e,t,r)}_apply(e){const t=this._parse(e);return mw(e._query,t),new pn(e.firestore,e.converter,vf(e._query,t))}_parse(e){const t=Zi(e.firestore);return function(i,o,a,u,c,d,f){let g;if(c.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new te(G.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){Kv(f,d);const _=[];for(const C of f)_.push(Gv(u,i,C));g={arrayValue:{values:_}}}else g=Gv(u,i,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||Kv(f,d),g=uw(a,o,f,d==="in"||d==="not-in");return Ze.create(c,d,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function nm(n,e,t){const r=e,s=Ld("where",n);return bu._create(s,r,t)}class Ca extends tm{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Ca(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ct.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const u of a)mw(o,u),o=vf(o,u)}(e._query,t),new pn(e.firestore,e.converter,vf(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function V4(...n){return n.forEach(e=>gw("or",e)),Ca._create("or",n)}function N4(...n){return n.forEach(e=>gw("and",e)),Ca._create("and",n)}class rm extends _u{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new rm(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new te(G.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new te(G.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ql(i,o)}(e._query,this._field,this._direction);return new pn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new as(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function J1(n,e="asc"){const t=e,r=Ld("orderBy",n);return rm._create(r,t)}class Ud extends _u{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Ud(e,t,r)}_apply(e){return new pn(e.firestore,e.converter,Fc(e._query,this._limit,this._limitType))}}function O4(n){return nw("limit",n),Ud._create("limit",n,"F")}function M4(n){return nw("limitToLast",n),Ud._create("limitToLast",n,"L")}class $d extends _u{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new $d(e,t,r)}_apply(e){const t=pw(e,this.type,this._docOrFields,this._inclusive);return new pn(e.firestore,e.converter,function(s,i){return new as(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function L4(...n){return $d._create("startAt",n,!0)}function F4(...n){return $d._create("startAfter",n,!1)}class jd extends _u{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new jd(e,t,r)}_apply(e){const t=pw(e,this.type,this._docOrFields,this._inclusive);return new pn(e.firestore,e.converter,function(s,i){return new as(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function U4(...n){return jd._create("endBefore",n,!1)}function $4(...n){return jd._create("endAt",n,!0)}function pw(n,e,t,r){if(t[0]=xe(t[0]),t[0]instanceof Wl)return function(i,o,a,u,c){if(!u)throw new te(G.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const d=[];for(const f of Go(i))if(f.field.isKeyField())d.push(Bi(o,u.key));else{const g=u.data.field(f.field);if(_d(g))throw new te(G.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){const _=f.field.canonicalString();throw new te(G.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${_}' (used as the orderBy) does not exist.`)}d.push(g)}return new Ys(d,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Zi(n.firestore);return function(o,a,u,c,d,f){const g=o.explicitOrderBy;if(d.length>g.length)throw new te(G.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const _=[];for(let C=0;C<d.length;C++){const T=d[C];if(g[C].field.isKeyField()){if(typeof T!="string")throw new te(G.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof T}`);if(!dp(o)&&T.indexOf("/")!==-1)throw new te(G.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${T}' contains a slash.`);const k=o.path.child(Xe.fromString(T));if(!me.isDocumentKey(k))throw new te(G.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${k}' is not because it contains an odd number of segments.`);const j=new me(k);_.push(Bi(a,j))}else{const k=uw(u,c,T);_.push(k)}}return new Ys(_,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function Gv(n,e,t){if(typeof(t=xe(t))=="string"){if(t==="")throw new te(G.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!dp(e)&&t.indexOf("/")!==-1)throw new te(G.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Xe.fromString(t));if(!me.isDocumentKey(r))throw new te(G.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Bi(n,new me(r))}if(t instanceof Ht)return Bi(n,t._key);throw new te(G.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Dd(t)}.`)}function Kv(n,e){if(!Array.isArray(n)||n.length===0)throw new te(G.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function mw(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new te(G.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new te(G.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function gw(n,e){if(!(e instanceof bu||e instanceof Ca))throw new te(G.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class vw{convertValue(e,t="none"){switch(Qs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ct(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ts(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ye()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return si(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>Ct(o.doubleValue));return new Vd(i)}convertGeoPoint(e){return new Hp(Ct(e.latitude),Ct(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=bd(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp($l(e));default:return null}}convertTimestamp(e){const t=es(e);return new Mt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Xe.fromString(e);we(hb(r));const s=new ji(r.get(1),r.get(3)),i=new me(r.popFirst(5));return s.isEqual(t)||zt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bd(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class Y1 extends vw{constructor(e){super(),this.firestore=e}convertBytes(e){return new Qi(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ht(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j4(n){return new Kl("sum",Hl("sum",n))}function B4(n){return new Kl("avg",Hl("average",n))}function X1(){return new Kl("count")}function q4(n,e){var t,r;return n instanceof Kl&&e instanceof Kl&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function z4(n,e){return rw(n.query,e.query)&&Hs(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vi{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ga extends Wl{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new vc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Ld("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class vc extends ga{data(e={}){return super.data(e)}}class va{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Vi(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new vc(this._firestore,this._userDataWriter,r.key,r,new Vi(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new te(G.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const u=new vc(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Vi(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const u=new vc(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Vi(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,d=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:Z1(a.type),doc:u,oldIndex:c,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Z1(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ye()}}function G4(n,e){return n instanceof ga&&e instanceof ga?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof va&&e instanceof va&&n._firestore===e._firestore&&rw(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ds(n){n=Qe(n,Ht);const e=Qe(n.firestore,_t);return Zb(Lt(e),n._key).then(t=>sm(e,n,t))}class oi extends vw{constructor(e){super(),this.firestore=e}convertBytes(e){return new Qi(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ht(this.firestore,null,t)}}function K4(n){n=Qe(n,Ht);const e=Qe(n.firestore,_t),t=Lt(e),r=new oi(e);return C1(t,n._key).then(s=>new ga(e,r,n._key,s,new Vi(s!==null&&s.hasLocalMutations,!0),n.converter))}function H4(n){n=Qe(n,Ht);const e=Qe(n.firestore,_t);return Zb(Lt(e),n._key,{source:"server"}).then(t=>sm(e,n,t))}function Vt(n){n=Qe(n,pn);const e=Qe(n.firestore,_t),t=Lt(e),r=new oi(e);return fw(n._query),ew(t,n._query).then(s=>new va(e,r,n,s))}function W4(n){n=Qe(n,pn);const e=Qe(n.firestore,_t),t=Lt(e),r=new oi(e);return k1(t,n._query).then(s=>new va(e,r,n,s))}function Q4(n){n=Qe(n,pn);const e=Qe(n.firestore,_t),t=Lt(e),r=new oi(e);return ew(t,n._query,{source:"server"}).then(s=>new va(e,r,n,s))}function wn(n,e,t){n=Qe(n,Ht);const r=Qe(n.firestore,_t),s=Bd(n.converter,e,t);return Iu(r,[Od(Zi(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Dt.none())])}function wu(n,e,t,...r){n=Qe(n,Ht);const s=Qe(n.firestore,_t),i=Zi(s);let o;return o=typeof(e=xe(e))=="string"||e instanceof Yi?Zp(i,"updateDoc",n._key,e,t,r):Xp(i,"updateDoc",n._key,e),Iu(s,[o.toMutation(n._key,Dt.exists(!0))])}function Qc(n){return Iu(Qe(n.firestore,_t),[new Ta(n._key,Dt.none())])}function qd(n,e){const t=Qe(n.firestore,_t),r=De(n),s=Bd(n.converter,e);return Iu(t,[Od(Zi(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Dt.exists(!1))]).then(()=>r)}function J4(n,...e){var t,r,s;n=xe(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Rf(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Rf(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let u,c,d;if(n instanceof Ht)c=Qe(n.firestore,_t),d=Ia(n._key.path),u={next:f=>{e[o]&&e[o](sm(c,n,f))},error:e[o+1],complete:e[o+2]};else{const f=Qe(n,pn);c=Qe(f.firestore,_t),d=f._query;const g=new oi(c);u={next:_=>{e[o]&&e[o](new va(c,g,f,_))},error:e[o+1],complete:e[o+2]},fw(n._query)}return function(g,_,C,T){const k=new Cd(T),j=new Lp(_,k,C);return g.asyncQueue.enqueueAndForget(async()=>Np(await ma(g),j)),()=>{k.Za(),g.asyncQueue.enqueueAndForget(async()=>Op(await ma(g),j))}}(Lt(c),d,a,u)}function Y4(n,e){return V1(Lt(n=Qe(n,_t)),Rf(e)?e:{next:e})}function Iu(n,e){return function(r,s){const i=new an;return r.asyncQueue.enqueueAndForget(async()=>a1(await Gp(r),s,i)),i.promise}(Lt(n),e)}function sm(n,e,t){const r=t.docs.get(e._key),s=new oi(n);return new ga(n,s,e._key,r,new Vi(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X4(n){return eC(n,{count:X1()})}function eC(n,e){const t=Qe(n.firestore,_t),r=Lt(t),s=_0(e,(i,o)=>new Q0(o,i.aggregateType,i._internalFieldPath));return D1(r,n._query,s).then(i=>function(a,u,c){const d=new oi(a);return new z1(u,d,c)}(t,n,i))}class tC{constructor(e){this.kind="memory",this._onlineComponentProvider=ei.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=Zs.provider}toJSON(){return{kind:this.kind}}}class nC{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=aC(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class rC{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Zs.provider}toJSON(){return{kind:this.kind}}}class sC{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new E1(e)}}toJSON(){return{kind:this.kind}}}function Z4(){return new rC}function eU(n){return new sC(n==null?void 0:n.cacheSizeBytes)}function tU(n){return new tC(n)}function nU(n){return new nC(n)}class iC{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ei.provider,this._offlineComponentProvider={build:t=>new qp(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class oC{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ei.provider,this._offlineComponentProvider={build:t=>new Qb(t,e==null?void 0:e.cacheSizeBytes)}}}function aC(n){return new iC(n==null?void 0:n.forceOwnership)}function rU(){return new oC}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lC={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uC{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Zi(e)}set(e,t,r){this._verifyNotCommitted();const s=Vs(e,this._firestore),i=Bd(s.converter,t,r),o=Od(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,Dt.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=Vs(e,this._firestore);let o;return o=typeof(t=xe(t))=="string"||t instanceof Yi?Zp(this._dataReader,"WriteBatch.update",i._key,t,r,s):Xp(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Dt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Vs(e,this._firestore);return this._mutations=this._mutations.concat(new Ta(t._key,Dt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new te(G.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Vs(n,e){if((n=xe(n)).firestore!==e)throw new te(G.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cC extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Zi(t)}get(t){const r=Vs(t,this._firestore),s=new Y1(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return ye();const o=i[0];if(o.isFoundDocument())return new Wl(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new Wl(this._firestore,s,r._key,null,r.converter);throw ye()})}set(t,r,s){const i=Vs(t,this._firestore),o=Bd(i.converter,r,s),a=Od(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=Vs(t,this._firestore);let a;return a=typeof(r=xe(r))=="string"||r instanceof Yi?Zp(this._dataReader,"Transaction.update",o._key,r,s,i):Xp(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=Vs(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Vs(e,this._firestore),r=new oi(this._firestore);return super.get(e).then(s=>new ga(this._firestore,r,t._key,s._document,new Vi(!1,!1),t.converter))}}function iU(n,e,t){n=Qe(n,_t);const r=Object.assign(Object.assign({},lC),t);return function(i){if(i.maxAttempts<1)throw new te(G.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const u=new an;return i.asyncQueue.enqueueAndForget(async()=>{const c=await Xb(i);new A1(i.asyncQueue,c,a,o,u).au()}),u.promise}(Lt(n),s=>e(new cC(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oU(){return new yu("deleteField")}function Eu(){return new Wp("serverTimestamp")}function aU(...n){return new Qp("arrayUnion",n)}function lU(...n){return new Jp("arrayRemove",n)}function uU(n){return new Yp("increment",n)}function cU(n){return new Vd(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dC(n){return Lt(n=Qe(n,_t)),new uC(n,e=>Iu(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dU(n,e){const t=Lt(n=Qe(n,_t));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Xn("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(c){try{return JSON.parse(c)}catch(d){throw new te(G.INVALID_ARGUMENT,"Failed to parse JSON: "+(d==null?void 0:d.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const u of o.indexes){const c=Hv(u,"collectionGroup"),d=[];if(Array.isArray(u.fields))for(const f of u.fields){const g=Md("setIndexConfiguration",Hv(f,"fieldPath"));f.arrayConfig==="CONTAINS"?d.push(new Li(g,2)):f.order==="ASCENDING"?d.push(new Li(g,0)):f.order==="DESCENDING"&&d.push(new Li(g,1))}a.push(new ra(ra.UNKNOWN_ID,c,d,sa.empty()))}return a}(e);return M1(t,r)}function Hv(n,e){if(typeof n[e]!="string")throw new te(G.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hC{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function hU(n){var e;n=Qe(n,_t);const t=Wv.get(n);if(t)return t;if(((e=Lt(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new hC(n);return Wv.set(n,r),r}function fU(n){yw(n,!0)}function pU(n){yw(n,!1)}function mU(n){F1(Lt(n._firestore)).then(e=>ee("deleting all persistent cache indexes succeeded")).catch(e=>Xn("deleting all persistent cache indexes failed",e))}function yw(n,e){L1(Lt(n._firestore),e).then(t=>ee(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>Xn(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const Wv=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gU(n){var e;const t=(e=Lt(Qe(n.firestore,_t))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:Td(t,Tn(n._query))._t}function vU(n,e){var t;const r=_0(e,(i,o)=>new Q0(o,i.aggregateType,i._internalFieldPath)),s=(t=Lt(Qe(n.firestore,_t))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:lb(s,V0(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yU{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return im.instance.onExistenceFilterMismatch(e)}}class im{constructor(){this.Uu=new Map}static get instance(){return tc||(tc=new im,function(t){if(Uc)throw new Error("a TestingHooksSpi instance is already set");Uc=t}(tc)),tc}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let tc=null;(function(e,t=!0){(function(s){wa=s})(ba),ta(new $i("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new _t(new NP(r.getProvider("auth-internal")),new LP(r.getProvider("app-check-internal")),function(c,d){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new te(G.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ji(c.options.projectId,d)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Bs(Lg,"4.7.3",e),Bs(Lg,"4.7.3","esm2017")})();function om(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _U={PHONE:"phone",TOTP:"totp"},bU={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},wU={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},IU={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},EU={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fC(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function _w(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const TU=fC,pC=_w,bw=new ou("auth","Firebase",_w()),xU={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jc=new sp("@firebase/auth");function mC(n,...e){Jc.logLevel<=Ye.WARN&&Jc.warn(`Auth (${ba}): ${n}`,...e)}function yc(n,...e){Jc.logLevel<=Ye.ERROR&&Jc.error(`Auth (${ba}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fn(n,...e){throw lm(n,...e)}function Cn(n,...e){return lm(n,...e)}function am(n,e,t){const r=Object.assign(Object.assign({},pC()),{[e]:t});return new ou("auth","Firebase",r).create(e,{appName:n.name})}function ln(n){return am(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ka(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Fn(n,"argument-error"),am(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function lm(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return bw.create(n,...e)}function ue(n,e,...t){if(!n)throw lm(e,...t)}function xr(n){const e="INTERNAL ASSERTION FAILED: "+n;throw yc(e),new Error(e)}function ns(n,e){n||xr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ql(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function um(){return Qv()==="http:"||Qv()==="https:"}function Qv(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gC(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(um()||dA()||"connection"in navigator)?navigator.onLine:!0}function vC(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tu{constructor(e,t){this.shortDelay=e,this.longDelay=t,ns(t>e,"Short delay should be less than long delay!"),this.isMobile=lA()||hA()}get(){return gC()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cm(n,e){ns(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ww{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;xr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;xr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;xr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yC={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _C=new Tu(3e4,6e4);function At(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Pt(n,e,t,r,s={}){return Iw(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=_a(Object.assign({key:n.config.apiKey},o)).slice(1),u=await n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:u},i);return cA()||(c.referrerPolicy="no-referrer"),ww.fetch()(Ew(n,n.config.apiHost,t,a),c)})}async function Iw(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},yC),e);try{const s=new wC(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw fl(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[u,c]=a.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw fl(n,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw fl(n,"email-already-in-use",o);if(u==="USER_DISABLED")throw fl(n,"user-disabled",o);const d=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw am(n,d,c);Fn(n,d)}}catch(s){if(s instanceof os)throw s;Fn(n,"network-request-failed",{message:String(s)})}}async function hs(n,e,t,r,s={}){const i=await Pt(n,e,t,r,s);return"mfaPendingCredential"in i&&Fn(n,"multi-factor-auth-required",{_serverResponse:i}),i}function Ew(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?cm(n.config,s):`${n.config.apiScheme}://${s}`}function bC(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class wC{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Cn(this.auth,"network-request-failed")),_C.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function fl(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=Cn(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jv(n){return n!==void 0&&n.getResponse!==void 0}function Yv(n){return n!==void 0&&n.enterprise!==void 0}class Tw{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return bC(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IC(n){return(await Pt(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function xw(n,e){return Pt(n,"GET","/v2/recaptchaConfig",At(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EC(n,e){return Pt(n,"POST","/v1/accounts:delete",e)}async function TC(n,e){return Pt(n,"POST","/v1/accounts:update",e)}async function Aw(n,e){return Pt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sl(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AU(n,e=!1){return xe(n).getIdToken(e)}async function xC(n,e=!1){const t=xe(n),r=await t.getIdToken(e),s=zd(r);ue(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Sl(Oh(s.auth_time)),issuedAtTime:Sl(Oh(s.iat)),expirationTime:Sl(Oh(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Oh(n){return Number(n)*1e3}function zd(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return yc("JWT malformed, contained fewer than 3 sections"),null;try{const s=j_(t);return s?JSON.parse(s):(yc("Failed to decode base64 JWT payload"),null)}catch(s){return yc("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Xv(n){const e=zd(n);return ue(e,"internal-error"),ue(typeof e.exp<"u","internal-error"),ue(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rs(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof os&&AC(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function AC({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PC{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cf{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Sl(this.lastLoginAt),this.creationTime=Sl(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jl(n){var e;const t=n.auth,r=await n.getIdToken(),s=await rs(n,Aw(t,{idToken:r}));ue(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?Pw(i.providerUserInfo):[],a=RC(n.providerData,o),u=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),d=u?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Cf(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,f)}async function SC(n){const e=xe(n);await Jl(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function RC(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Pw(n){return n.map(e=>{var{providerId:t}=e,r=om(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CC(n,e){const t=await Iw(n,{},async()=>{const r=_a({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=Ew(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",ww.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function kC(n,e){return Pt(n,"POST","/v2/accounts:revokeToken",At(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ue(e.idToken,"internal-error"),ue(typeof e.idToken<"u","internal-error"),ue(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Xv(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ue(e.length!==0,"internal-error");const t=Xv(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ue(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await CC(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new Ho;return r&&(ue(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(ue(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(ue(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ho,this.toJSON())}_performRefresh(){return xr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ps(n,e){ue(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Kr{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=om(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new PC(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Cf(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await rs(this,this.stsTokenManager.getToken(this.auth,e));return ue(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return xC(this,e)}reload(){return SC(this)}_assign(e){this!==e&&(ue(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Kr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){ue(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Jl(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Gt(this.auth.app))return Promise.reject(ln(this.auth));const e=await this.getIdToken();return await rs(this,EC(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,u,c,d;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,g=(s=t.email)!==null&&s!==void 0?s:void 0,_=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,C=(o=t.photoURL)!==null&&o!==void 0?o:void 0,T=(a=t.tenantId)!==null&&a!==void 0?a:void 0,k=(u=t._redirectEventId)!==null&&u!==void 0?u:void 0,j=(c=t.createdAt)!==null&&c!==void 0?c:void 0,q=(d=t.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:U,emailVerified:z,isAnonymous:Y,providerData:H,stsTokenManager:P}=t;ue(U&&P,e,"internal-error");const I=Ho.fromJSON(this.name,P);ue(typeof U=="string",e,"internal-error"),Ps(f,e.name),Ps(g,e.name),ue(typeof z=="boolean",e,"internal-error"),ue(typeof Y=="boolean",e,"internal-error"),Ps(_,e.name),Ps(C,e.name),Ps(T,e.name),Ps(k,e.name),Ps(j,e.name),Ps(q,e.name);const R=new Kr({uid:U,auth:e,email:g,emailVerified:z,displayName:f,isAnonymous:Y,photoURL:C,phoneNumber:_,tenantId:T,stsTokenManager:I,createdAt:j,lastLoginAt:q});return H&&Array.isArray(H)&&(R.providerData=H.map(x=>Object.assign({},x))),k&&(R._redirectEventId=k),R}static async _fromIdTokenResponse(e,t,r=!1){const s=new Ho;s.updateFromServerResponse(t);const i=new Kr({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Jl(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];ue(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?Pw(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new Ho;a.updateFromIdToken(r);const u=new Kr({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Cf(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(u,c),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zv=new Map;function Hr(n){ns(n instanceof Function,"Expected a class definition");let e=Zv.get(n);return e?(ns(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Zv.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sw{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Sw.type="NONE";const ey=Sw;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _c(n,e,t){return`firebase:${n}:${e}:${t}`}class Wo{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=_c(this.userKey,s.apiKey,i),this.fullPersistenceKey=_c("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Kr._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Wo(Hr(ey),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||Hr(ey);const o=_c(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const d=await c._get(o);if(d){const f=Kr._fromJSON(e,d);c!==i&&(a=f),i=c;break}}catch{}const u=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!u.length?new Wo(i,e,r):(i=u[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new Wo(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ty(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Dw(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Rw(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Nw(e))return"Blackberry";if(Ow(e))return"Webos";if(Cw(e))return"Safari";if((e.includes("chrome/")||kw(e))&&!e.includes("edge/"))return"Chrome";if(Vw(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function Rw(n=tn()){return/firefox\//i.test(n)}function Cw(n=tn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function kw(n=tn()){return/crios\//i.test(n)}function Dw(n=tn()){return/iemobile/i.test(n)}function Vw(n=tn()){return/android/i.test(n)}function Nw(n=tn()){return/blackberry/i.test(n)}function Ow(n=tn()){return/webos/i.test(n)}function dm(n=tn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function DC(n=tn()){var e;return dm(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function VC(){return fA()&&document.documentMode===10}function Mw(n=tn()){return dm(n)||Vw(n)||Ow(n)||Nw(n)||/windows phone/i.test(n)||Dw(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lw(n,e=[]){let t;switch(n){case"Browser":t=ty(tn());break;case"Worker":t=`${ty(tn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${ba}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NC{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const u=e(i);o(u)}catch(u){a(u)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OC(n,e={}){return Pt(n,"GET","/v2/passwordPolicy",At(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MC=6;class LC{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:MC,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(t=u.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),u.isValid&&(u.isValid=(r=u.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(s=u.containsLowercaseLetter)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(i=u.containsUppercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(o=u.containsNumericCharacter)!==null&&o!==void 0?o:!0),u.isValid&&(u.isValid=(a=u.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),u}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FC{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ny(this),this.idTokenSubscription=new ny(this),this.beforeStateQueue=new NC(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=bw,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Hr(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await Wo.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Aw(this,{idToken:e}),r=await Kr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Gt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,u=await this.tryRedirectSignIn(e);(!o||o===a)&&(u!=null&&u.user)&&(s=u.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return ue(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Jl(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=vC()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Gt(this.app))return Promise.reject(ln(this));const t=e?xe(e):null;return t&&ue(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ue(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Gt(this.app)?Promise.reject(ln(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Gt(this.app)?Promise.reject(ln(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Hr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await OC(this),t=new LC(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new ou("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await kC(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Hr(e)||this._popupRedirectResolver;ue(t,this,"argument-error"),this.redirectPersistenceManager=await Wo.create(this,[Hr(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ue(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,r,s);return()=>{o=!0,u()}}else{const u=e.addObserver(t);return()=>{o=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ue(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Lw(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&mC(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Ut(n){return xe(n)}class ny{constructor(e){this.auth=e,this.observer=null,this.addObserver=_A(t=>this.observer=t)}get next(){return ue(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xu={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function UC(n){xu=n}function hm(n){return xu.loadJS(n)}function $C(){return xu.recaptchaV2Script}function jC(){return xu.recaptchaEnterpriseScript}function BC(){return xu.gapiScript}function Fw(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const qC="recaptcha-enterprise",zC="NO_RECAPTCHA";class Uw{constructor(e){this.type=qC,this.auth=Ut(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{xw(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new Tw(u);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(u=>{a(u)})})}function s(i,o,a){const u=window.grecaptcha;Yv(u)?u.enterprise.ready(()=>{u.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(zC)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&Yv(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let u=jC();u.length!==0&&(u+=a),hm(u).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function ry(n,e,t,r=!1){const s=new Uw(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Yl(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await ry(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await ry(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function GC(n){const e=Ut(n),t=await xw(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new Tw(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new Uw(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KC(n,e){const t=au(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Hs(i,e??{}))return s;Fn(s,"already-initialized")}return t.initialize({options:e})}function HC(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Hr);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function WC(n,e,t){const r=Ut(n);ue(r._canInitEmulator,r,"emulator-config-failed"),ue(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=$w(e),{host:o,port:a}=QC(e),u=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${u}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||JC()}function $w(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function QC(n){const e=$w(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:sy(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:sy(o)}}}function sy(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function JC(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Au{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return xr("not implemented")}_getIdTokenResponse(e){return xr("not implemented")}_linkToIdToken(e,t){return xr("not implemented")}_getReauthenticationResolver(e){return xr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jw(n,e){return Pt(n,"POST","/v1/accounts:resetPassword",At(n,e))}async function YC(n,e){return Pt(n,"POST","/v1/accounts:update",e)}async function XC(n,e){return Pt(n,"POST","/v1/accounts:signUp",e)}async function ZC(n,e){return Pt(n,"POST","/v1/accounts:update",At(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ek(n,e){return hs(n,"POST","/v1/accounts:signInWithPassword",At(n,e))}async function Gd(n,e){return Pt(n,"POST","/v1/accounts:sendOobCode",At(n,e))}async function tk(n,e){return Gd(n,e)}async function nk(n,e){return Gd(n,e)}async function rk(n,e){return Gd(n,e)}async function sk(n,e){return Gd(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ik(n,e){return hs(n,"POST","/v1/accounts:signInWithEmailLink",At(n,e))}async function ok(n,e){return hs(n,"POST","/v1/accounts:signInWithEmailLink",At(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xl extends Au{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Xl(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Xl(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Yl(e,t,"signInWithPassword",ek);case"emailLink":return ik(e,{email:this._email,oobCode:this._password});default:Fn(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Yl(e,r,"signUpPassword",XC);case"emailLink":return ok(e,{idToken:t,email:this._email,oobCode:this._password});default:Fn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jr(n,e){return hs(n,"POST","/v1/accounts:signInWithIdp",At(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ak="http://localhost";class ss extends Au{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ss(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Fn("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=om(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new ss(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Jr(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Jr(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Jr(e,t)}buildRequest(){const e={requestUri:ak,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=_a(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lk(n,e){return Pt(n,"POST","/v1/accounts:sendVerificationCode",At(n,e))}async function uk(n,e){return hs(n,"POST","/v1/accounts:signInWithPhoneNumber",At(n,e))}async function ck(n,e){const t=await hs(n,"POST","/v1/accounts:signInWithPhoneNumber",At(n,e));if(t.temporaryProof)throw fl(n,"account-exists-with-different-credential",t);return t}const dk={USER_NOT_FOUND:"user-not-found"};async function hk(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return hs(n,"POST","/v1/accounts:signInWithPhoneNumber",At(n,t),dk)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fi extends Au{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Fi({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Fi({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return uk(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return ck(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return hk(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new Fi({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fk(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function pk(n){const e=al(ll(n)).link,t=e?al(ll(e)).deep_link_id:null,r=al(ll(n)).deep_link_id;return(r?al(ll(r)).link:null)||r||t||e||n}class Pu{constructor(e){var t,r,s,i,o,a;const u=al(ll(e)),c=(t=u.apiKey)!==null&&t!==void 0?t:null,d=(r=u.oobCode)!==null&&r!==void 0?r:null,f=fk((s=u.mode)!==null&&s!==void 0?s:null);ue(c&&d&&f,"argument-error"),this.apiKey=c,this.operation=f,this.code=d,this.continueUrl=(i=u.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=u.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=u.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=pk(e);try{return new Pu(t)}catch{return null}}}function PU(n){return Pu.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class to{constructor(){this.providerId=to.PROVIDER_ID}static credential(e,t){return Xl._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Pu.parseLink(t);return ue(r,"argument-error"),Xl._fromEmailAndCode(e,r.code,r.tenantId)}}to.PROVIDER_ID="password";to.EMAIL_PASSWORD_SIGN_IN_METHOD="password";to.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fs{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Da extends fs{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class bc extends Da{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return ue("providerId"in t&&"signInMethod"in t,"argument-error"),ss._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return ue(e.idToken||e.accessToken,"argument-error"),ss._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return bc.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return bc.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new bc(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ns extends Da{constructor(){super("facebook.com")}static credential(e){return ss._fromParams({providerId:Ns.PROVIDER_ID,signInMethod:Ns.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ns.credentialFromTaggedObject(e)}static credentialFromError(e){return Ns.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ns.credential(e.oauthAccessToken)}catch{return null}}}Ns.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ns.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Os extends Da{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ss._fromParams({providerId:Os.PROVIDER_ID,signInMethod:Os.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Os.credentialFromTaggedObject(e)}static credentialFromError(e){return Os.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Os.credential(t,r)}catch{return null}}}Os.GOOGLE_SIGN_IN_METHOD="google.com";Os.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ms extends Da{constructor(){super("github.com")}static credential(e){return ss._fromParams({providerId:Ms.PROVIDER_ID,signInMethod:Ms.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ms.credentialFromTaggedObject(e)}static credentialFromError(e){return Ms.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ms.credential(e.oauthAccessToken)}catch{return null}}}Ms.GITHUB_SIGN_IN_METHOD="github.com";Ms.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mk="http://localhost";class Zl extends Au{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Jr(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Jr(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Jr(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new Zl(r,i)}static _create(e,t){return new Zl(e,t)}buildRequest(){return{requestUri:mk,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gk="saml.";class kf extends fs{constructor(e){ue(e.startsWith(gk),"argument-error"),super(e)}static credentialFromResult(e){return kf.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return kf.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Zl.fromJSON(e);return ue(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Zl._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ls extends Da{constructor(){super("twitter.com")}static credential(e,t){return ss._fromParams({providerId:Ls.PROVIDER_ID,signInMethod:Ls.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ls.credentialFromTaggedObject(e)}static credentialFromError(e){return Ls.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Ls.credential(t,r)}catch{return null}}}Ls.TWITTER_SIGN_IN_METHOD="twitter.com";Ls.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bw(n,e){return hs(n,"POST","/v1/accounts:signUp",At(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Kr._fromIdTokenResponse(e,r,s),o=iy(r);return new Zn({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=iy(r);return new Zn({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function iy(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vk(n){var e;if(Gt(n.app))return Promise.reject(ln(n));const t=Ut(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new Zn({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await Bw(t,{returnSecureToken:!0}),s=await Zn._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yc extends os{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Yc.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Yc(e,t,r,s)}}function qw(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Yc._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zw(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SU(n,e){const t=xe(n);await Kd(!0,t,e);const{providerUserInfo:r}=await TC(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=zw(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function fm(n,e,t=!1){const r=await rs(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Zn._forOperation(n,"link",r)}async function Kd(n,e,t){await Jl(e);const r=zw(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";ue(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gw(n,e,t=!1){const{auth:r}=n;if(Gt(r.app))return Promise.reject(ln(r));const s="reauthenticate";try{const i=await rs(n,qw(r,s,e,n),t);ue(i.idToken,r,"internal-error");const o=zd(i.idToken);ue(o,r,"internal-error");const{sub:a}=o;return ue(n.uid===a,r,"user-mismatch"),Zn._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Fn(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kw(n,e,t=!1){if(Gt(n.app))return Promise.reject(ln(n));const r="signIn",s=await qw(n,r,e),i=await Zn._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function pm(n,e){return Kw(Ut(n),e)}async function yk(n,e){const t=xe(n);return await Kd(!1,t,e.providerId),fm(t,e)}async function _k(n,e){return Gw(xe(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bk(n,e){return hs(n,"POST","/v1/accounts:signInWithCustomToken",At(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RU(n,e){if(Gt(n.app))return Promise.reject(ln(n));const t=Ut(n),r=await bk(t,{token:e,returnSecureToken:!0}),s=await Zn._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Su{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?mm._fromServerResponse(e,t):"totpInfo"in t?gm._fromServerResponse(e,t):Fn(e,"internal-error")}}class mm extends Su{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new mm(t)}}class gm extends Su{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new gm(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hd(n,e,t){var r;ue(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),ue(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(ue(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(ue(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vm(n){const e=Ut(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function wk(n,e,t){const r=Ut(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Hd(r,s,t),await Yl(r,s,"getOobCode",nk)}async function Ik(n,e,t){await jw(xe(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&vm(n),r})}async function CU(n,e){await ZC(xe(n),{oobCode:e})}async function Ek(n,e){const t=xe(n),r=await jw(t,{oobCode:e}),s=r.requestType;switch(ue(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":ue(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":ue(r.mfaInfo,t,"internal-error");default:ue(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Su._fromServerResponse(Ut(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function kU(n,e){const{data:t}=await Ek(xe(n),e);return t.email}async function Tk(n,e,t){if(Gt(n.app))return Promise.reject(ln(n));const r=Ut(n),o=await Yl(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Bw).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&vm(n),u}),a=await Zn._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function xk(n,e,t){return Gt(n.app)?Promise.reject(ln(n)):pm(xe(n),to.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&vm(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DU(n,e,t){const r=Ut(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){ue(a.handleCodeInApp,r,"argument-error"),a&&Hd(r,o,a)}i(s,t),await Yl(r,s,"getOobCode",rk)}function VU(n,e){const t=Pu.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function NU(n,e,t){if(Gt(n.app))return Promise.reject(ln(n));const r=xe(n),s=to.credentialWithLink(e,t||Ql());return ue(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),pm(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ak(n,e){return Pt(n,"POST","/v1/accounts:createAuthUri",At(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OU(n,e){const t=um()?Ql():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await Ak(xe(n),r);return s||[]}async function MU(n,e){const t=xe(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Hd(t.auth,s,e);const{email:i}=await tk(t.auth,s);i!==n.email&&await n.reload()}async function LU(n,e,t){const r=xe(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Hd(r.auth,i,t);const{email:o}=await sk(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pk(n,e){return Pt(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FU(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=xe(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await rs(r,Pk(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:u})=>u==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function UU(n,e){const t=xe(n);return Gt(t.auth.app)?Promise.reject(ln(t.auth)):Hw(t,e,null)}function Sk(n,e){return Hw(xe(n),null,e)}async function Hw(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await rs(n,YC(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rk(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=zd(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new Qo(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new Ck(i,s);case"github.com":return new kk(i,s);case"google.com":return new Dk(i,s);case"twitter.com":return new Vk(i,s,n.screenName||null);case"custom":case"anonymous":return new Qo(i,null);default:return new Qo(i,r,s)}}class Qo{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class Ww extends Qo{constructor(e,t,r,s){super(e,t,r),this.username=s}}class Ck extends Qo{constructor(e,t){super(e,"facebook.com",t)}}class kk extends Ww{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class Dk extends Qo{constructor(e,t){super(e,"google.com",t)}}class Vk extends Ww{constructor(e,t,r){super(e,"twitter.com",t,r)}}function $U(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:Rk(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jU(n,e){return xe(n).setPersistence(e)}function BU(n){return GC(n)}async function qU(n,e){return Ut(n).validatePassword(e)}function Nk(n,e,t,r){return xe(n).onIdTokenChanged(e,t,r)}function Ok(n,e,t){return xe(n).beforeAuthStateChanged(e,t)}function zU(n,e,t,r){return xe(n).onAuthStateChanged(e,t,r)}function GU(n){xe(n).useDeviceLanguage()}function KU(n,e){return xe(n).updateCurrentUser(e)}function HU(n){return xe(n).signOut()}function WU(n,e){return Ut(n).revokeAccessToken(e)}async function QU(n){return xe(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ni{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new Ni("enroll",e,t)}static _fromMfaPendingCredential(e){return new Ni("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return Ni._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return Ni._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ym{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=Ut(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Su._fromServerResponse(r,a));ue(s.mfaPendingCredential,r,"internal-error");const o=Ni._fromMfaPendingCredential(s.mfaPendingCredential);return new ym(o,i,async a=>{const u=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const c=Object.assign(Object.assign({},s),{idToken:u.idToken,refreshToken:u.refreshToken});switch(t.operationType){case"signIn":const d=await Zn._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(d.user),d;case"reauthenticate":return ue(t.user,r,"internal-error"),Zn._forOperation(t.user,t.operationType,c);default:Fn(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function JU(n,e){var t;const r=xe(n),s=e;return ue(e.customData.operationType,r,"argument-error"),ue((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),ym._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mk(n,e){return Pt(n,"POST","/v2/accounts/mfaEnrollment:start",At(n,e))}function Lk(n,e){return Pt(n,"POST","/v2/accounts/mfaEnrollment:finalize",At(n,e))}function Fk(n,e){return Pt(n,"POST","/v2/accounts/mfaEnrollment:start",At(n,e))}function Uk(n,e){return Pt(n,"POST","/v2/accounts/mfaEnrollment:finalize",At(n,e))}function $k(n,e){return Pt(n,"POST","/v2/accounts/mfaEnrollment:withdraw",At(n,e))}class _m{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Su._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new _m(e)}async getSession(){return Ni._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await rs(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await rs(this.user,$k(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const Mh=new WeakMap;function YU(n){const e=xe(n);return Mh.has(e)||Mh.set(e,_m._fromUser(e)),Mh.get(e)}const Xc="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qw{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Xc,"1"),this.storage.removeItem(Xc),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jk=1e3,Bk=10;class Jw extends Qw{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Mw(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,u)=>{this.notifyListeners(o,u)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);VC()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Bk):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},jk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Jw.type="LOCAL";const qk=Jw;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yw extends Qw{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Yw.type="SESSION";const Xw=Yw;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zk(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wd{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Wd(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),u=await zk(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Wd.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qd(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gk{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,u)=>{const c=Qd("",20);s.port1.start();const d=setTimeout(()=>{u(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const g=f;if(g.data.eventId===c)switch(g.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(g.data.response);break;default:clearTimeout(d),clearTimeout(i),u(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jt(){return window}function Kk(n){Jt().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bm(){return typeof Jt().WorkerGlobalScope<"u"&&typeof Jt().importScripts=="function"}async function Hk(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Wk(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function Qk(){return bm()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zw="firebaseLocalStorageDb",Jk=1,Zc="firebaseLocalStorage",eI="fbase_key";class Ru{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Jd(n,e){return n.transaction([Zc],e?"readwrite":"readonly").objectStore(Zc)}function Yk(){const n=indexedDB.deleteDatabase(Zw);return new Ru(n).toPromise()}function Df(){const n=indexedDB.open(Zw,Jk);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Zc,{keyPath:eI})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Zc)?e(r):(r.close(),await Yk(),e(await Df()))})})}async function oy(n,e,t){const r=Jd(n,!0).put({[eI]:e,value:t});return new Ru(r).toPromise()}async function Xk(n,e){const t=Jd(n,!1).get(e),r=await new Ru(t).toPromise();return r===void 0?null:r.value}function ay(n,e){const t=Jd(n,!0).delete(e);return new Ru(t).toPromise()}const Zk=800,eD=3;class tI{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Df(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>eD)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return bm()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Wd._getInstance(Qk()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await Hk(),!this.activeServiceWorker)return;this.sender=new Gk(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Wk()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Df();return await oy(e,Xc,"1"),await ay(e,Xc),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>oy(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>Xk(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>ay(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Jd(s,!1).getAll();return new Ru(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Zk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}tI.type="LOCAL";const tD=tI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nD(n,e){return Pt(n,"POST","/v2/accounts/mfaSignIn:start",At(n,e))}function rD(n,e){return Pt(n,"POST","/v2/accounts/mfaSignIn:finalize",At(n,e))}function sD(n,e){return Pt(n,"POST","/v2/accounts/mfaSignIn:finalize",At(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iD=500,oD=6e4,nc=1e12;class aD{constructor(e){this.auth=e,this.counter=nc,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new lD(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||nc;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||nc;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||nc;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class lD{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;ue(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=uD(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},oD)},iD))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function uD(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lh=Fw("rcb"),cD=new Tu(3e4,6e4);class dD{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=Jt().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return ue(hD(t),e,"argument-error"),this.shouldResolveImmediately(t)&&Jv(Jt().grecaptcha)?Promise.resolve(Jt().grecaptcha):new Promise((r,s)=>{const i=Jt().setTimeout(()=>{s(Cn(e,"network-request-failed"))},cD.get());Jt()[Lh]=()=>{Jt().clearTimeout(i),delete Jt()[Lh];const a=Jt().grecaptcha;if(!a||!Jv(a)){s(Cn(e,"internal-error"));return}const u=a.render;a.render=(c,d)=>{const f=u(c,d);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${$C()}?${_a({onload:Lh,render:"explicit",hl:t})}`;hm(o).catch(()=>{clearTimeout(i),s(Cn(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=Jt().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function hD(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class fD{async load(e){return new aD(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nI="recaptcha",pD={theme:"light",type:"image"};class XU{constructor(e,t,r=Object.assign({},pD)){this.parameters=r,this.type=nI,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Ut(e),this.isInvisible=this.parameters.size==="invisible",ue(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;ue(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new fD:new dD,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){ue(!this.parameters.sitekey,this.auth,"argument-error"),ue(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),ue(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=Jt()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){ue(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){ue(um()&&!bm(),this.auth,"internal-error"),await mD(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await IC(this.auth);ue(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return ue(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function mD(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wm{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Fi._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function ZU(n,e,t){if(Gt(n.app))return Promise.reject(ln(n));const r=Ut(n),s=await Yd(r,e,xe(t));return new wm(s,i=>pm(r,i))}async function e3(n,e,t){const r=xe(n);await Kd(!1,r,"phone");const s=await Yd(r.auth,e,xe(t));return new wm(s,i=>yk(r,i))}async function t3(n,e,t){const r=xe(n);if(Gt(r.auth.app))return Promise.reject(ln(r.auth));const s=await Yd(r.auth,e,xe(t));return new wm(s,i=>_k(r,i))}async function Yd(n,e,t){var r;const s=await t.verify();try{ue(typeof s=="string",n,"argument-error"),ue(t.type===nI,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return ue(o.type==="enroll",n,"internal-error"),(await Mk(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{ue(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return ue(a,n,"missing-multi-factor-info"),(await nD(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await lk(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function n3(n,e){const t=xe(n);if(Gt(t.auth.app))return Promise.reject(ln(t.auth));await fm(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jo{constructor(e){this.providerId=Jo.PROVIDER_ID,this.auth=Ut(e)}verifyPhoneNumber(e,t){return Yd(this.auth,e,xe(t))}static credential(e,t){return Fi._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Jo.credentialFromTaggedObject(t)}static credentialFromError(e){return Jo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Fi._fromTokenResponse(t,r):null}}Jo.PROVIDER_ID="phone";Jo.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function no(n,e){return e?Hr(e):(ue(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Im extends Au{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Jr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Jr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Jr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function gD(n){return Kw(n.auth,new Im(n),n.bypassAuthState)}function vD(n){const{auth:e,user:t}=n;return ue(t,e,"internal-error"),Gw(t,new Im(n),n.bypassAuthState)}async function yD(n){const{auth:e,user:t}=n;return ue(t,e,"internal-error"),fm(t,new Im(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rI{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const u={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(u))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return gD;case"linkViaPopup":case"linkViaRedirect":return yD;case"reauthViaPopup":case"reauthViaRedirect":return vD;default:Fn(this.auth,"internal-error")}}resolve(e){ns(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ns(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _D=new Tu(2e3,1e4);async function r3(n,e,t){if(Gt(n.app))return Promise.reject(Cn(n,"operation-not-supported-in-this-environment"));const r=Ut(n);ka(n,e,fs);const s=no(r,t);return new Wr(r,"signInViaPopup",e,s).executeNotNull()}async function s3(n,e,t){const r=xe(n);if(Gt(r.auth.app))return Promise.reject(Cn(r.auth,"operation-not-supported-in-this-environment"));ka(r.auth,e,fs);const s=no(r.auth,t);return new Wr(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function i3(n,e,t){const r=xe(n);ka(r.auth,e,fs);const s=no(r.auth,t);return new Wr(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class Wr extends rI{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Wr.currentPopupAction&&Wr.currentPopupAction.cancel(),Wr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ue(e,this.auth,"internal-error"),e}async onExecution(){ns(this.filter.length===1,"Popup operations only handle one event");const e=Qd();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Cn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Cn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Wr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Cn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,_D.get())};e()}}Wr.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bD="pendingRedirect",wc=new Map;class wD extends rI{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=wc.get(this.auth._key());if(!e){try{const r=await ID(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}wc.set(this.auth._key(),e)}return this.bypassAuthState||wc.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function ID(n,e){const t=iI(e),r=sI(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function Em(n,e){return sI(n)._set(iI(e),"true")}function ED(n,e){wc.set(n._key(),e)}function sI(n){return Hr(n._redirectPersistence)}function iI(n){return _c(bD,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o3(n,e,t){return TD(n,e,t)}async function TD(n,e,t){if(Gt(n.app))return Promise.reject(ln(n));const r=Ut(n);ka(n,e,fs),await r._initializationPromise;const s=no(r,t);return await Em(s,r),s._openRedirect(r,e,"signInViaRedirect")}function a3(n,e,t){return xD(n,e,t)}async function xD(n,e,t){const r=xe(n);if(ka(r.auth,e,fs),Gt(r.auth.app))return Promise.reject(ln(r.auth));await r.auth._initializationPromise;const s=no(r.auth,t);await Em(s,r.auth);const i=await aI(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function l3(n,e,t){return AD(n,e,t)}async function AD(n,e,t){const r=xe(n);ka(r.auth,e,fs),await r.auth._initializationPromise;const s=no(r.auth,t);await Kd(!1,r,e.providerId),await Em(s,r.auth);const i=await aI(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function u3(n,e){return await Ut(n)._initializationPromise,oI(n,e,!1)}async function oI(n,e,t=!1){if(Gt(n.app))return Promise.reject(ln(n));const r=Ut(n),s=no(r,e),o=await new wD(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function aI(n){const e=Qd(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PD=10*60*1e3;class SD{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!RD(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!lI(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Cn(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=PD&&this.cachedEventUids.clear(),this.cachedEventUids.has(ly(e))}saveEventToCache(e){this.cachedEventUids.add(ly(e)),this.lastProcessedEventTime=Date.now()}}function ly(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function lI({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function RD(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return lI(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CD(n,e={}){return Pt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kD=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,DD=/^https?/;async function VD(n){if(n.config.emulator)return;const{authorizedDomains:e}=await CD(n);for(const t of e)try{if(ND(t))return}catch{}Fn(n,"unauthorized-domain")}function ND(n){const e=Ql(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!DD.test(t))return!1;if(kD.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OD=new Tu(3e4,6e4);function uy(){const n=Jt().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function MD(n){return new Promise((e,t)=>{var r,s,i;function o(){uy(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{uy(),t(Cn(n,"network-request-failed"))},timeout:OD.get()})}if(!((s=(r=Jt().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=Jt().gapi)===null||i===void 0)&&i.load)o();else{const a=Fw("iframefcb");return Jt()[a]=()=>{gapi.load?o():t(Cn(n,"network-request-failed"))},hm(`${BC()}?onload=${a}`).catch(u=>t(u))}}).catch(e=>{throw Ic=null,e})}let Ic=null;function LD(n){return Ic=Ic||MD(n),Ic}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FD=new Tu(5e3,15e3),UD="__/auth/iframe",$D="emulator/auth/iframe",jD={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},BD=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function qD(n){const e=n.config;ue(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?cm(e,$D):`https://${n.config.authDomain}/${UD}`,r={apiKey:e.apiKey,appName:n.name,v:ba},s=BD.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${_a(r).slice(1)}`}async function zD(n){const e=await LD(n),t=Jt().gapi;return ue(t,n,"internal-error"),e.open({where:document.body,url:qD(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:jD,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Cn(n,"network-request-failed"),a=Jt().setTimeout(()=>{i(o)},FD.get());function u(){Jt().clearTimeout(a),s(r)}r.ping(u).then(u,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GD={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},KD=500,HD=600,WD="_blank",QD="http://localhost";class cy{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function JD(n,e,t,r=KD,s=HD){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const u=Object.assign(Object.assign({},GD),{width:r.toString(),height:s.toString(),top:i,left:o}),c=tn().toLowerCase();t&&(a=kw(c)?WD:t),Rw(c)&&(e=e||QD,u.scrollbars="yes");const d=Object.entries(u).reduce((g,[_,C])=>`${g}${_}=${C},`,"");if(DC(c)&&a!=="_self")return YD(e||"",a),new cy(null);const f=window.open(e||"",a,d);ue(f,n,"popup-blocked");try{f.focus()}catch{}return new cy(f)}function YD(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XD="__/auth/handler",ZD="emulator/auth/handler",eV=encodeURIComponent("fac");async function dy(n,e,t,r,s,i){ue(n.config.authDomain,n,"auth-domain-config-required"),ue(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:ba,eventId:s};if(e instanceof fs){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",yA(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,f]of Object.entries(i||{}))o[d]=f}if(e instanceof Da){const d=e.getScopes().filter(f=>f!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const u=await n._getAppCheckToken(),c=u?`#${eV}=${encodeURIComponent(u)}`:"";return`${tV(n)}?${_a(a).slice(1)}${c}`}function tV({config:n}){return n.emulator?cm(n,ZD):`https://${n.authDomain}/${XD}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fh="webStorageSupport";class nV{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Xw,this._completeRedirectFn=oI,this._overrideRedirectResult=ED}async _openPopup(e,t,r,s){var i;ns((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await dy(e,t,r,Ql(),s);return JD(e,o,Qd())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await dy(e,t,r,Ql(),s);return Kk(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(ns(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await zD(e),r=new SD(e);return t.register("authEvent",s=>(ue(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Fh,{type:Fh},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[Fh];o!==void 0&&t(!!o),Fn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=VD(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Mw()||Cw()||dm()}}const rV=nV;class uI{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return xr("unexpected MultiFactorSessionType")}}}class Tm extends uI{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Tm(e)}_finalizeEnroll(e,t,r){return Lk(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return rD(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class sV{constructor(){}static assertion(e){return Tm._fromCredential(e)}}sV.FACTOR_ID="phone";class iV{static assertionForEnrollment(e,t){return eu._fromSecret(e,t)}static assertionForSignIn(e,t){return eu._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;ue(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await Fk(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return xm._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}iV.FACTOR_ID="totp";class eu extends uI{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new eu(t,void 0,e)}static _fromEnrollmentId(e,t){return new eu(t,e)}async _finalizeEnroll(e,t,r){return ue(typeof this.secret<"u",e,"argument-error"),Uk(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){ue(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return sD(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class xm{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new xm(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(rc(e)||rc(t))&&(s=!0),s&&(rc(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),rc(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function rc(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var hy="@firebase/auth",fy="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oV{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ue(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aV(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function lV(n){ta(new $i("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;ue(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Lw(n)},c=new FC(r,s,i,u);return HC(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),ta(new $i("auth-internal",e=>{const t=Ut(e.getProvider("auth").getImmediate());return(r=>new oV(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Bs(hy,fy,aV(n)),Bs(hy,fy,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uV=5*60,cV=z_("authIdTokenMaxAge")||uV;let py=null;const dV=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>cV)return;const s=t==null?void 0:t.token;py!==s&&(py=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function hV(n=J_()){const e=au(n,"auth");if(e.isInitialized())return e.getImmediate();const t=KC(n,{popupRedirectResolver:rV,persistence:[tD,qk,Xw]}),r=z_("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=dV(i.toString());Ok(t,o,()=>o(t.currentUser)),Nk(t,a=>o(a))}}const s=B_("auth");return s&&WC(t,`http://${s}`),t}function fV(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}UC({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=Cn("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",fV().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});lV("Browser");const pV={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},cI=Q_(pV),ve=B1(cI),ro=hV(cI);try{q1(ve)}catch{}vk(ro);async function mV(n,e){try{return(await Tk(ro,n,e)).user}catch(t){throw t}}async function gV(n,e){try{return(await xk(ro,n,e)).user}catch(t){throw t}}async function vV(n){try{await wk(ro,n)}catch(e){throw e}}async function yV(n){try{const e=ro.currentUser;if(e)await Sk(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const qs=Object.freeze(Object.defineProperty({__proto__:null,auth:ro,createPlayerAccount:mV,db:ve,resetPlayerPassword:vV,signInPlayer:gV,updatePlayerPassword:yV},Symbol.toStringTag,{value:"Module"})),Va="seasons";async function _V(n,e,t){return await qd(nt(ve,Va),{name:n,slug:e,pinCode:t,createdAt:Eu()})}async function bV(n){return await Qc(De(ve,Va,n))}async function Uh(){const n=Fd(nt(ve,Va),J1("createdAt","desc"));return(await Vt(n)).docs.map(t=>({id:t.id,...t.data()}))}async function ed(n,e){const t=await ds(De(ve,Va,n));return t.exists()?t.data().pinCode===e:!1}async function Vf(n){const e=await ds(De(ve,Va,n));return e.exists()?e.data().pinCode:null}async function il(n,e){const t=De(ve,Va,n);await wu(t,{sortOrder:e})}const $h=10*60*1e3,jh="impro_selector_pin_session";class wV{constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(jh);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<$h)return t;this.clearSession()}}catch(e){console.error("Erreur lors du chargement de la session PIN:",e)}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(jh,JSON.stringify(r)),this.sessionData=r}catch(r){console.error("Erreur lors de la sauvegarde de la session PIN:",r)}}isPinCached(e){return this.sessionData?this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<$h:!1}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(jh),this.sessionData=null}catch(e){console.error("Erreur lors de la suppression de la session PIN:",e)}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=$h-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const Nn=new wV,IV={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},EV={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},TV={class:"text-center mb-6"},xV={class:"text-gray-300"},AV={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},PV={class:"text-sm text-green-400"},SV={class:"mb-6"},RV={class:"mb-4"},CV={key:0,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},kV={class:"flex justify-end space-x-3"},DV=["disabled"],dI={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=O(""),i=O(""),o=O(null);Yt(()=>t.show,d=>{d&&(s.value="",i.value="",Bn(()=>{var f;(f=o.value)==null||f.focus()}))});function a(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function u(){s.value.length===4&&r("submit",s.value)}function c(){r("cancel")}return(d,f)=>n.show?(F(),B("div",IV,[p("div",EV,[p("div",TV,[f[1]||(f[1]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"🔒")],-1)),f[2]||(f[2]=p("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),p("p",xV,le(n.message),1),n.sessionInfo?(F(),B("div",AV,[p("p",PV," Session active : "+le(n.sessionInfo.timeRemaining)+" min restantes ",1)])):ce("",!0)]),p("div",SV,[p("div",RV,[f[3]||(f[3]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),lt(p("input",{"onUpdate:modelValue":f[0]||(f[0]=g=>s.value=g),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:a,onKeydown:[vn(u,["enter"]),vn(c,["escape"])],ref_key:"pinInput",ref:o},null,544),[[Rt,s.value]])]),f[4]||(f[4]=p("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))]),i.value||t.error?(F(),B("div",CV,le(i.value||t.error),1)):ce("",!0),p("div",kV,[p("button",{onClick:c,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:u,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,DV)])])])):ce("",!0)}},VV={class:"relative p-6 pb-4 border-b border-white/10"},NV={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},hI={__name:"AppHelpModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(F(),B("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[95] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=Bt(()=>{},["stop"]))},[p("div",VV,[p("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=p("div",{class:"flex items-center gap-3"},[p("div",{class:"w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-2xl"},"🎭"),p("div",null,[p("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Bienvenue dans Impro Pick"),p("p",{class:"text-sm text-purple-300"},"L'appli impro pour organiser saisons, événements et sélections")])],-1))]),s[5]||(s[5]=rr('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">À quoi ça sert ?</h3><p> Impro Pick vous aide à gérer vos spectacles d&#39;impro : saisons, événements, joueurs, disponibilités, tirage au sort équitable et annonces. Fini les prises de tête : indiquez qui est dispo, et laissez le hasard pondéré faire le reste. </p></div><div class="space-y-3"><h3 class="text-white font-semibold">Fonctionnalités principales</h3><ul class="list-disc list-inside space-y-2 text-gray-300"><li><span class="text-white">Saisons</span> : regroupez vos événements par saison pour garder un historique clair.</li><li><span class="text-white">Événements</span> : créez des dates avec un titre et un nombre de joueurs à sélectionner; archivez-les quand ils sont passés.</li><li><span class="text-white">Joueurs</span> : gérez la liste des joueurs et leurs informations.</li><li><span class="text-white">Indication de disponibilité</span> : Oui/Non/Peut‑être via liens magiques ou directement dans la grille.</li><li><span class="text-white">Sélection automatique</span> : tirage au sort pondéré qui favorise l&#39;équité sur la durée.</li><li><span class="text-white">Protection des saisies</span> : PIN de saison pour sécuriser les actions sensibles, mot de passe possible pour certains joueurs.</li><li><span class="text-white">Notifications</span> : annoncez un événement (email/lien) pour collecter facilement les disponibilités.</li></ul></div><div class="space-y-2 text-sm text-gray-300"><h3 class="text-white font-semibold">Astuces</h3><ul class="list-disc list-inside space-y-1"><li>Sur mobile, faites glisser horizontalement pour parcourir les événements.</li><li>Le bouton ⚠️ dans les en-têtes signale qu&#39;un événement est prêt pour une sélection ou nécessite votre attention.</li></ul></div></div>',1)),p("div",NV,[p("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ce("",!0)}},OV={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},MV={class:"text-center py-16 px-4 relative"},LV=["aria-busy"],FV={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto animate-pulse"},UV={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto"},$V=["onClick"],jV={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},BV={class:"absolute top-4 right-4"},qV=["onClick","aria-expanded"],zV={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},GV=["onClick"],KV=["onClick"],HV=["onClick"],WV={key:2,class:"flex justify-center mt-12"},QV={key:3,class:"text-center py-16"},JV={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},YV={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},XV={class:"mb-6"},ZV={class:"mb-6"},eN={class:"mb-6"},tN={class:"flex justify-end space-x-3"},nN=["disabled"],rN={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},sN={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},iN={class:"text-center mb-6"},oN={class:"text-gray-300"},aN={__name:"Home",setup(n){const e=O([]),t=O(!0),r=su(),s=O(null),i=O(!1),o=O(!1),a=O(""),u=O(""),c=O(""),d=O(null),f=O(!1),g=O(null),_=O(""),C=O(!1);Gs(async()=>{try{e.value=await Uh(),console.log("Saisons chargées:",e.value),U().catch(Ie=>console.error("Migration sortOrder échouée",Ie))}finally{t.value=!1}});const T=We(()=>[...e.value].sort((Ie,oe)=>{var $t,Nt;const Re=typeof Ie.sortOrder=="number"?Ie.sortOrder:Number.MAX_SAFE_INTEGER,_e=typeof oe.sortOrder=="number"?oe.sortOrder:Number.MAX_SAFE_INTEGER;if(Re!==_e)return Re-_e;const Le=($t=Ie.createdAt)!=null&&$t.toMillis?Ie.createdAt.toMillis():0,dt=(Nt=oe.createdAt)!=null&&Nt.toMillis?oe.createdAt.toMillis():0;return Le!==dt?dt-Le:(Ie.name||"").localeCompare(oe.name||"")}));function k(Ie){r.push(`/season/${Ie}`)}function j(Ie){s.value=s.value===Ie?null:Ie}function q(){s.value=null}async function U(){if(!e.value.length)return;const Ie=e.value.map(Re=>typeof Re.sortOrder=="number"?Re.sortOrder:null).filter(Re=>Re!==null);let oe=Ie.length?Math.max(...Ie):0;for(const Re of e.value)if(typeof Re.sortOrder!="number"){oe+=1;try{await il(Re.id,oe),Re.sortOrder=oe}catch(_e){console.error("Erreur migration sortOrder pour",Re.name,_e)}}}async function z(Ie){if(q(),Ie<=0)return;const oe=[...T.value],Re=oe[Ie],_e=oe[Ie-1],Le=Re.sortOrder;Re.sortOrder=_e.sortOrder,_e.sortOrder=Le;try{await Promise.all([il(Re.id,Re.sortOrder),il(_e.id,_e.sortOrder)])}catch(dt){console.error("Erreur lors du déplacement vers le haut",dt)}}async function Y(Ie){q();const oe=[...T.value];if(Ie>=oe.length-1)return;const Re=oe[Ie],_e=oe[Ie+1],Le=Re.sortOrder;Re.sortOrder=_e.sortOrder,_e.sortOrder=Le;try{await Promise.all([il(Re.id,Re.sortOrder),il(_e.id,_e.sortOrder)])}catch(dt){console.error("Erreur lors du déplacement vers le bas",dt)}}function H(){a.value&&(u.value=a.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function P(){c.value=c.value.replace(/[^0-9]/g,""),c.value.length>4&&(c.value=c.value.slice(0,4))}async function I(){if(!a.value.trim()||!u.value.trim()||!c.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(c.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await _V(a.value.trim(),u.value.trim(),c.value.trim()),e.value=await Uh(),await U(),R()}catch(Ie){console.error("Erreur lors de la création de la saison:",Ie),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function R(){i.value=!1,a.value="",u.value="",c.value=""}function x(Ie){d.value=Ie,o.value=!0}async function S(){o.value=!1,await He({type:"deleteSeason",data:{seasonId:d.value.id,seasonName:d.value.name}})}function D(){o.value=!1,d.value=null}function w(){return g.value?{deleteSeason:"Suppression de saison - Code PIN requis"}[g.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function He(Ie){if(Nn.isPinCached(d.value.id)){const oe=Nn.getCachedPin(d.value.id);if(console.log("PIN en cache trouvé, utilisation automatique"),await ed(d.value.id,oe)){await Ve(Ie);return}else Nn.clearSession()}g.value=Ie,f.value=!0}async function Fe(Ie){var oe,Re,_e;console.log("PIN soumis:",Ie,"pour l'opération:",g.value);try{const Le=((Re=(oe=g.value)==null?void 0:oe.data)==null?void 0:Re.seasonId)||((_e=d.value)==null?void 0:_e.id),dt=await ed(Le,Ie);if(console.log("PIN valide:",dt),dt){Nn.saveSession(Le,Ie),console.log("PIN correct, fermeture de la modal et exécution de l'opération"),f.value=!1;const $t=g.value;g.value=null,console.log("Appel de executePendingOperation avec:",$t),await Ve($t)}else _.value="Code PIN incorrect",setTimeout(()=>{_.value=""},3e3)}catch(Le){console.error("Erreur lors de la vérification du PIN:",Le),_.value="Erreur lors de la vérification du code PIN"}}function et(){f.value=!1,g.value=null,_.value=""}function $e(){return d.value&&Nn.isPinCached(d.value.id)?{timeRemaining:Nn.getTimeRemaining(),isExpiringSoon:Nn.isExpiringSoon()}:null}async function Ve(Ie){if(console.log("executePendingOperation appelé avec:",Ie),!Ie){console.log("Aucune opération à exécuter");return}const{type:oe,data:Re}=Ie;console.log("Exécution de l'opération:",oe,"avec données:",Re);try{switch(oe){case"deleteSeason":console.log("Suppression de la saison ID:",Re.seasonId),await bV(Re.seasonId),console.log("Saison supprimée, rechargement de la liste..."),e.value=await Uh(),console.log("Nouvelle liste des saisons:",e.value);break;default:console.log("Type d'opération non reconnu:",oe)}}catch(_e){console.error("Erreur lors de l'exécution de l'opération:",_e),alert("Erreur lors de l'opération. Veuillez réessayer.")}}return(Ie,oe)=>{var Re;return F(),B("div",OV,[p("div",MV,[p("button",{onClick:oe[0]||(oe[0]=_e=>C.value=!0),class:"absolute right-4 top-4 text-white/90 hover:text-white p-2 rounded-full hover:bg-white/10",title:"Comment ça marche ?","aria-label":"Comment ça marche ?"},oe[8]||(oe[8]=[p("span",{class:"text-2xl"},"❓",-1)])),oe[9]||(oe[9]=p("h1",{class:"text-6xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent animate-pulse"}," Impro Pick ",-1)),oe[10]||(oe[10]=p("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto leading-relaxed"},"Arrêtez de vous prendre la tête pour savoir qui doit jouer, laissez le hasard choisir pour vous !",-1))]),p("div",{class:"container mx-auto px-4 pb-16","aria-busy":t.value},[t.value?(F(),B("div",FV,[(F(),B(ut,null,sr(8,_e=>p("div",{key:"skeleton-"+_e,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8"},oe[11]||(oe[11]=[p("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),p("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),p("div",{class:"h-px bg-white/10 mb-4"},null,-1),p("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(F(),B("div",UV,[(F(!0),B(ut,null,sr(T.value,(_e,Le)=>(F(),B("div",{key:_e.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20"},[p("div",{onClick:dt=>k(_e.slug),class:"text-center cursor-pointer"},[oe[12]||(oe[12]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg"},[p("span",{class:"text-2xl"},"🎭")],-1)),p("h2",jV,le(_e.name),1),oe[13]||(oe[13]=p("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),oe[14]||(oe[14]=p("p",{class:"text-gray-300 text-sm"}," Cliquez pour accéder ",-1))],8,$V),p("div",BV,[p("div",{class:"relative",onClick:oe[1]||(oe[1]=Bt(()=>{},["stop"]))},[p("button",{onClick:dt=>j(Le),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===Le,"aria-haspopup":"true",title:"Options"},oe[15]||(oe[15]=[p("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,qV),s.value===Le?(F(),B("div",zV,[p("button",{onClick:dt=>z(Le),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Monter ",8,GV),p("button",{onClick:dt=>Y(Le),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Descendre ",8,KV),oe[16]||(oe[16]=p("div",{class:"border-t border-white/10 my-1"},null,-1)),p("button",{onClick:dt=>x(_e),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10",role:"menuitem"}," Supprimer ",8,HV)])):ce("",!0)])])]))),128))])):ce("",!0),!t.value&&e.value.length>0?(F(),B("div",WV,[p("button",{onClick:oe[2]||(oe[2]=_e=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105"}," ✨ Nouvelle saison ")])):ce("",!0),!t.value&&e.value.length===0?(F(),B("div",QV,[oe[17]||(oe[17]=p("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[p("span",{class:"text-4xl"},"🎪")],-1)),oe[18]||(oe[18]=p("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),oe[19]||(oe[19]=p("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),p("button",{onClick:oe[3]||(oe[3]=_e=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):ce("",!0)],8,LV),i.value?(F(),B("div",JV,[p("div",YV,[oe[24]||(oe[24]=p("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),p("div",XV,[oe[20]||(oe[20]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),lt(p("input",{"onUpdate:modelValue":oe[4]||(oe[4]=_e=>a.value=_e),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:H},null,544),[[Rt,a.value]])]),p("div",ZV,[oe[21]||(oe[21]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),lt(p("input",{"onUpdate:modelValue":oe[5]||(oe[5]=_e=>u.value=_e),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[Rt,u.value]])]),p("div",eN,[oe[22]||(oe[22]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),lt(p("input",{"onUpdate:modelValue":oe[6]||(oe[6]=_e=>c.value=_e),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:P},null,544),[[Rt,c.value]]),oe[23]||(oe[23]=p("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),p("div",tN,[p("button",{onClick:R,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:I,disabled:!a.value.trim()||!u.value.trim()||!c.value.trim()||c.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,nN)])])])):ce("",!0),o.value?(F(),B("div",rN,[p("div",sN,[p("div",iN,[oe[25]||(oe[25]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"⚠️")],-1)),oe[26]||(oe[26]=p("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),p("p",oN,'Êtes-vous sûr de vouloir supprimer la saison "'+le((Re=d.value)==null?void 0:Re.name)+'" ?',1)]),oe[27]||(oe[27]=p("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),p("div",{class:"flex justify-end space-x-3"},[p("button",{onClick:D,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:S,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ce("",!0),mt(dI,{show:f.value,message:w(),error:_.value,"session-info":$e(),onSubmit:Fe,onCancel:et},null,8,["show","message","error","session-info"]),mt(hI,{show:C.value,onClose:oe[7]||(oe[7]=_e=>C.value=!1)},null,8,["show"]),oe[28]||(oe[28]=rr('<footer class="mt-16 border-t border-white/10"><div class="container mx-auto px-4 py-6 text-center text-xs text-gray-400"><span>© Patrice Lamarque 2025</span><span class="mx-2">•</span><span>Licence MIT</span><span class="mx-2">•</span><a href="https://github.com/plamarque/impro-selector" target="_blank" rel="noopener noreferrer" class="underline decoration-white/20 hover:decoration-white/40 hover:text-gray-200">GitHub</a></div></footer>',1))])}}},lN="modulepreload",uN=function(n){return"/"+n},my={},qt=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=uN(i),i in my)return;my[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let d=s.length-1;d>=0;d--){const f=s[d];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":lN,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((d,f)=>{c.addEventListener("load",d),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},Xd="magicLinks";function Zd({seasonId:n,playerId:e,eventId:t,action:r}){return`${n}__${e}__${t}__${r}`}function fI(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function Nf({seasonId:n,playerId:e,eventId:t,action:r}){const s=Zd({seasonId:n,playerId:e,eventId:t,action:r}),i=fI(40),o=De(ve,Xd,s),a=Date.now()+1e3*60*60*24*7;await wn(o,{seasonId:n,playerId:e,eventId:t,token:i,action:r,expiresAt:a});const c=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(i)}&a=${encodeURIComponent(r)}`;return{id:s,token:i,url:c}}async function pI({seasonId:n,playerId:e,email:t}){const r="protection",s="verify_email",i=Zd({seasonId:n,playerId:e,eventId:r,action:s}),o=fI(40),a=De(ve,Xd,i),u=Date.now()+1e3*60*60*24*7;await wn(a,{seasonId:n,playerId:e,eventId:r,token:o,action:s,email:t,expiresAt:u});const d=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(s)}`;return{id:i,token:o,url:d}}async function mI({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=Zd({seasonId:n,playerId:e,eventId:t,action:s}),o=De(ve,Xd,i),a=await ds(o);if(!a.exists())return{valid:!1,reason:"not_found"};const u=a.data();return u.token!==r?{valid:!1,reason:"token_mismatch"}:u.action!==s?{valid:!1,reason:"action_mismatch"}:typeof u.expiresAt=="number"&&Date.now()>u.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:u}}async function Of({seasonId:n,playerId:e,eventId:t,action:r}){const s=Zd({seasonId:n,playerId:e,eventId:t,action:r}),i=De(ve,Xd,s);await Qc(i)}const cN=Object.freeze(Object.defineProperty({__proto__:null,consumeMagicLink:Of,createEmailVerificationLink:pI,createMagicLink:Nf,verifyMagicLink:mI},Symbol.toStringTag,{value:"Module"}));class dN{constructor(){this.sessions=new Map,this.sessionDuration=10*60*1e3}isPasswordCached(e){const t=this.sessions.get(e);return t?Date.now()-t.timestamp>this.sessionDuration?(this.sessions.delete(e),!1):!0:!1}getCachedPassword(e){const t=this.sessions.get(e);return t?Date.now()-t.timestamp>this.sessionDuration?(this.sessions.delete(e),null):t.password:null}saveSession(e,t){this.sessions.set(e,{password:t,timestamp:Date.now()})}clearSession(e){this.sessions.delete(e)}clearExpiredSessions(){const e=Date.now();for(const[t,r]of this.sessions.entries())e-r.timestamp>this.sessionDuration&&this.sessions.delete(t)}clearAllSessions(){this.sessions.clear()}}const ya=new dN;function Am(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}async function gI(n,e,t,r=null){try{console.log("🔍 [DEBUG] Début protectPlayer:",{playerId:n,email:e,seasonId:r});const s=await Cu(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:u}=await qt(()=>import("./index.esm-5febd93d.js"),[]),{db:c}=await qt(()=>Promise.resolve().then(()=>qs),void 0),d=r?i(c,"seasons",r,"playerProtection"):i(c,"playerProtection"),f=o(d,a("email","==",e)),g=await u(f);if(!g.empty&&g.docs.find(U=>U.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");console.log("🔍 [DEBUG] Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:_}=await qt(()=>import("./index.esm-861a7c66.js"),[]),{auth:C}=await qt(()=>Promise.resolve().then(()=>qs),void 0),T=await _(C,e,t);console.log("🔍 [DEBUG] Compte Firebase Auth créé:",T.user.uid);const k=Am(t),j=r?De(c,"seasons",r,"playerProtection",n):De(c,"playerProtection",n);return await wn(j,{playerId:n,email:e,passwordHash:k,firebaseUid:T.user.uid,isProtected:!0,createdAt:new Date}),console.log("🔍 [DEBUG] Protection sauvegardée dans Firestore"),{success:!0}}catch(s){throw console.error("❌ [ERROR] Erreur lors de la protection du joueur:",s),s}}async function vI({playerId:n,email:e,seasonId:t=null}){const r=t?nt(ve,"seasons",t,"playerProtection"):nt(ve,"playerProtection"),s=Fd(r,nm("email","==",e)),i=await Vt(s);if(!i.empty&&i.docs.find(d=>d.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");try{const{fetchSignInMethodsForEmail:c}=await qt(()=>import("./index.esm-861a7c66.js"),[]),{auth:d}=await qt(()=>Promise.resolve().then(()=>qs),void 0),f=await c(d,e);if(Array.isArray(f)&&f.length>0)throw new Error("Cette adresse email est déjà utilisée par un autre joueur")}catch(c){if(c!=null&&c.code&&c.code!=="auth/invalid-email")throw c}const o=t?De(ve,"seasons",t,"playerProtection",n):De(ve,"playerProtection",n);(await ds(o)).exists()?await wu(o,{email:e,updatedAt:new Date}):await wn(o,{playerId:n,email:e,isProtected:!1,createdAt:new Date});const{url:u}=await pI({seasonId:t,playerId:n,email:e});return{success:!0,url:u}}async function yI({playerId:n,seasonId:e=null}){const t=e?De(ve,"seasons",e,"playerProtection",n):De(ve,"playerProtection",n);if(!(await ds(t)).exists())throw new Error("Protection introuvable");return await wu(t,{emailVerifiedAt:new Date}),{success:!0}}async function hN({playerId:n,seasonId:e=null}){const t=e?De(ve,"seasons",e,"playerProtection",n):De(ve,"playerProtection",n);return await wu(t,{emailVerifiedAt:null}),{success:!0}}async function _I(n,e=null){try{const t=e?De(ve,"seasons",e,"playerProtection",n):De(ve,"playerProtection",n);return await wn(t,{playerId:n,email:"",isProtected:!1,emailVerifiedAt:null,updatedAt:new Date}),{success:!0,email:""}}catch(t){throw console.error("Erreur lors de la suppression de la protection:",t),t}}async function Ui(n,e=null){try{const t=e?De(ve,"seasons",e,"playerProtection",n):De(ve,"playerProtection",n),r=await ds(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return console.error("Erreur lors de la vérification de protection:",t),!1}}async function Cu(n,e=null){try{const t=e?De(ve,"seasons",e,"playerProtection",n):De(ve,"playerProtection",n),r=await ds(t);return r.exists()?r.data():null}catch(t){return console.error("Erreur lors de la récupération des données de protection:",t),null}}async function bI(n,e=null){try{const t=await Cu(n,e);return(t==null?void 0:t.email)||""}catch(t){return console.error("Erreur lors de la récupération de l'email:",t),""}}async function Mf(n=null){try{const e=n?nt(ve,"seasons",n,"playerProtection"):nt(ve,"playerProtection");return(await Vt(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return console.error("Erreur lors du chargement des protections:",e),[]}}async function Pm(n,e,t=null){try{const r=await Cu(n,t);if(!r||!r.isProtected)return!1;if(r.firebaseUid){console.log("🔍 [DEBUG] Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await qt(()=>import("./index.esm-861a7c66.js"),[]),{auth:i}=await qt(()=>Promise.resolve().then(()=>qs),void 0);return await s(i,r.email,e),console.log("🔍 [DEBUG] Mot de passe Firebase Auth valide"),ya.saveSession(n,e),!0}catch(s){return console.log("🔍 [DEBUG] Mot de passe Firebase Auth invalide:",s.code),!1}}else{console.log("🔍 [DEBUG] Vérification avec hash local");const s=Am(e),i=r.passwordHash===s;return i&&ya.saveSession(n,e),i}}catch(r){return console.error("Erreur lors de la vérification du mot de passe:",r),!1}}function Yo(n){return ya.isPasswordCached(n)}function fN(n){return ya.getCachedPassword(n)}async function wI(n,e=null){try{console.log("🔍 [DEBUG] Début sendPasswordResetEmail:",{playerId:n,seasonId:e});const t=await Cu(n,e);if(console.log("🔍 [DEBUG] Protection data:",t),!t||!t.isProtected)throw new Error("Joueur non protégé");if(console.log("🔍 [DEBUG] Email à utiliser:",t.email),t.firebaseUid){console.log("🔍 [DEBUG] Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await qt(()=>import("./index.esm-861a7c66.js"),[]),{auth:s}=await qt(()=>Promise.resolve().then(()=>qs),void 0);console.log("🔍 [DEBUG] Tentative d'envoi d'email à:",t.email),await r(s,t.email),console.log("🔍 [DEBUG] Email envoyé avec succès via Firebase Auth!"),console.log("🔍 [DEBUG] Vérifiez votre boîte mail:",t.email)}else{console.log("🔍 [DEBUG] Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await qt(()=>import("./index.esm-861a7c66.js"),[]),{auth:i}=await qt(()=>Promise.resolve().then(()=>qs),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);console.log("🔍 [DEBUG] Compte temporaire créé:",a.user.uid),await s(i,t.email),console.log("🔍 [DEBUG] Email envoyé avec succès!");const{updateDoc:u}=await qt(()=>import("./index.esm-5febd93d.js"),[]),{db:c}=await qt(()=>Promise.resolve().then(()=>qs),void 0),d=e?De(c,"seasons",e,"playerProtection",n):De(c,"playerProtection",n);await u(d,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")console.log("🔍 [DEBUG] Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),console.log("🔍 [DEBUG] Email envoyé avec succès!");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw console.error("❌ [ERROR] Erreur lors de l'envoi de l'email de réinitialisation:",t),console.error("❌ [ERROR] Code d'erreur:",t.code),console.error("❌ [ERROR] Message d'erreur:",t.message),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}async function pN(n,e,t=null){try{const r=Am(e),s=t?De(ve,"seasons",t,"playerProtection",n):De(ve,"playerProtection",n);return await wu(s,{passwordHash:r,updatedAt:new Date}),{success:!0}}catch(r){throw console.error("Erreur lors de la mise à jour du mot de passe:",r),r}}async function mN(n){return new Promise((e,t)=>{console.log("Demande de mot de passe pour disponibilité:",n),t(new Error("Gestion de mot de passe à implémenter côté composant"))})}const td=Object.freeze(Object.defineProperty({__proto__:null,clearEmailVerificationForProtection:hN,getCachedPlayerPassword:fN,getPlayerEmail:bI,getPlayerProtectionData:Cu,isPlayerPasswordCached:Yo,isPlayerProtected:Ui,listProtectedPlayers:Mf,markEmailVerifiedForProtection:yI,protectPlayer:gI,requirePlayerPasswordForAvailability:mN,sendPasswordResetEmail:wI,startEmailVerificationForProtection:vI,unprotectPlayer:_I,updatePlayerPasswordInFirestore:pN,verifyPlayerPassword:Pm},Symbol.toStringTag,{value:"Module"}));let Un="mock",Lf=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],Ji=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function II(n){Un=n}async function gN(){if(Un!=="firebase"||!(await Vt(nt(ve,"seasons"))).empty)return;const e=De(nt(ve,"seasons"));await wn(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:Eu()});const t=await Vt(nt(ve,"players"));for(const o of t.docs)await wn(De(e,"players",o.id),o.data());const r=await Vt(nt(ve,"events"));for(const o of r.docs)await wn(De(e,"events",o.id),o.data());const s=await Vt(nt(ve,"availability"));for(const o of s.docs)await wn(De(e,"availability",o.id),o.data());const i=await Vt(nt(ve,"selections"));for(const o of i.docs)await wn(De(e,"selections",o.id),o.data())}async function vN(){Un==="firebase"&&await gN()}async function gy(n=null){return(Un==="firebase"?n?(await Vt(nt(ve,"seasons",n,"events"))).docs.map(t=>({id:t.id,...t.data()})):(await Vt(nt(ve,"events"))).docs.map(t=>({id:t.id,...t.data()})):Ji).sort((t,r)=>{const s=c=>{if(!c)return null;if(c instanceof Date)return c;if(typeof(c==null?void 0:c.toDate)=="function")return c.toDate();const d=new Date(c);return isNaN(d.getTime())?null:d},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,u=o?o.getTime():Number.POSITIVE_INFINITY;return a!==u?a-u:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function Bh(n=null){return(Un==="firebase"?n?(await Vt(nt(ve,"seasons",n,"players"))).docs.map(t=>({id:t.id,...t.data()})):(await Vt(nt(ve,"players"))).docs.map(t=>({id:t.id,...t.data()})):Lf).sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function EI(n,e=null){if(Un==="firebase"){const t=De(e?nt(ve,"seasons",e,"players"):nt(ve,"players"));return await wn(t,{name:n}),t.id}else{const t=`p${Lf.length+1}`;return Lf.push({id:t,name:n}),t}}async function ko(n,e,t=null){if(Un==="firebase"){const r=t?await Vt(nt(ve,"seasons",t,"availability")):await Vt(nt(ve,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function Do(n=null){if(Un==="firebase"){const e=n?await Vt(nt(ve,"seasons",n,"selections")):await Vt(nt(ve,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function vy(n,e,t=null){if(Un==="firebase"){const r=t?De(ve,"seasons",t,"availability",n):De(ve,"availability",n);await wn(r,e)}}async function yN({seasonId:n,playerName:e,eventId:t,value:r}){if(Un!=="firebase")return;const s=n?De(ve,"seasons",n,"availability",e):De(ve,"availability",e),i=await ds(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await wn(s,a)}async function _N(n,e,t=null){if(Un==="firebase"){const r=t?De(ve,"seasons",t,"selections",n):De(ve,"selections",n);await wn(r,{players:e})}}async function bN(n,e=null){if(console.log("Suppression de l'événement:",n),Un==="firebase")try{console.log("Suppression de l'événement dans Firestore");const t=e?De(ve,"seasons",e,"events",n):De(ve,"events",n);await Qc(t),console.log("Suppression de la sélection associée");const r=e?De(ve,"seasons",e,"selections",n):De(ve,"selections",n);await Qc(r),console.log("Suppression des disponibilités");const s=e?await Vt(nt(ve,"seasons",e,"availability")):await Vt(nt(ve,"availability")),i=dC(ve);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){console.log("Mise à jour de la disponibilité pour:",o.id);const u={...a};delete u[n],i.update(o.ref,u)}}),await i.commit(),console.log("Opérations de suppression terminées avec succès")}catch(t){throw console.error("Erreur lors de la suppression:",t),t}else Ji=Ji.filter(t=>t.id!==n)}async function wN(n,e=null){if(Un==="firebase"){const t=De(e?nt(ve,"seasons",e,"events"):nt(ve,"events"));return await wn(t,n),t.id}else{const t=`event${Ji.length+1}`;return Ji.push({id:t,...n}),t}}async function yy(n,e,t=null){if(Un==="firebase"){const r=t?De(ve,"seasons",t,"events",n):De(ve,"events",n);await wn(r,e,{merge:!0})}else{const r=Ji.findIndex(s=>s.id===n);r!==-1&&(Ji[r]={id:n,...e})}}async function IN({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,reason:o="new_event",fromEmail:a=void 0}){const u=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>Disponibilité demandée</h2>
      <p>Bonjour ${e},</p>
      <p>Peux-tu indiquer ta disponibilité pour <strong>${t}</strong> (${r}) ?</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;margin-right:8px;background:#16a34a;color:#fff;border-radius:8px;text-decoration:none;">Je suis dispo ✅</a>
        <a href="${i}" style="display:inline-block;padding:10px 16px;background:#dc2626;color:#fff;border-radius:8px;text-decoration:none;">Pas dispo ❌</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: ${o}</p>
    </div>
  `,c=`Disponibilité demandée · ${t}`,d={to:n,message:{subject:c,html:u},createdAt:Eu(),meta:{reason:o,eventTitle:t,eventDate:r,playerName:e}};return a&&(d.from=a,d.replyTo=a),await qd(nt(ve,"mail"),d),{success:!0}}async function EN({toEmail:n,playerName:e,verifyUrl:t,fromEmail:r=void 0}){const s=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>Vérification de votre email</h2>
      <p>Bonjour ${e},</p>
      <p>Pour sécuriser votre joueur, merci de confirmer que vous avez accès à cette adresse email.</p>
      <p>
        <a href="${t}" style="display:inline-block;padding:10px 16px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;">Vérifier mon email</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Ce lien expirera dans 7 jours.</p>
    </div>
  `,o={to:n,message:{subject:"Confirmez votre email pour activer la protection",html:s},createdAt:Eu(),meta:{reason:"protection_email_verification",playerName:e}};r&&(o.from=r,o.replyTo=r),await qd(nt(ve,"mail"),o)}async function TN({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,html:i=void 0,subject:o=void 0,fromEmail:a=void 0}){console.log(`🔍 DEBUG queueSelectionEmail appelée pour ${e} avec:`,{toEmail:n,eventTitle:t,eventDate:r,eventUrl:s,hasCustomHtml:!!i,hasCustomSubject:!!o});const u=i||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>🎭 Tu as été sélectionné(e) !</h2>
      <p>Bonjour ${e},</p>
      <p>Félicitations ! Tu as été sélectionné(e) pour <strong>${t}</strong> (${r}).</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#8b5cf6;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Tu recevras bientôt plus d'informations sur l'organisation.</p>
    </div>
  `,c=o||`🎭 Sélection confirmée · ${t}`;console.log("🔍 DEBUG HTML final utilisé:",u.substring(0,200)+"..."),console.log("🔍 DEBUG Sujet final utilisé:",c);const d={to:n,message:{subject:c,html:u},createdAt:Eu(),meta:{reason:"selection",eventTitle:t,eventDate:r,playerName:e}};a&&(d.from=a,d.replyTo=a),console.log("🔍 DEBUG Données à envoyer à Firestore:",d);try{return await qd(nt(ve,"mail"),d),console.log(`✅ Email ajouté à la queue Firestore pour ${e}`),{success:!0}}catch(f){throw console.error(`❌ Erreur lors de l'ajout à Firestore pour ${e}:`,f),f}}async function xN({eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,players:i}){if(console.log("🔍 DEBUG sendSelectionEmailsForEvent appelée avec:",{eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,playersCount:i==null?void 0:i.length}),!e||!t||t.length===0)throw new Error("Données manquantes pour l'envoi des emails de sélection");const{getPlayerEmail:o}=await qt(()=>Promise.resolve().then(()=>td),void 0),{createMagicLink:a}=await qt(()=>Promise.resolve().then(()=>cN),void 0),u=`${window.location.origin}/season/${s}/event/${n}`;console.log("🔍 DEBUG eventUrl:",u);const c=t.join(", ");console.log("🔍 DEBUG playersList:",c);const d=`🎭 Sélection confirmée · ${e.title}`;console.log("🔍 DEBUG subject:",d);const f=[];for(const g of t){console.log(`🔍 DEBUG Traitement du joueur: ${g}`);try{const _=i==null?void 0:i.find(U=>U.name===g);if(!_){console.warn(`⚠️ Joueur non trouvé: ${g}`);continue}console.log("🔍 DEBUG Joueur trouvé:",_);const C=await o(_.id,r);if(!C){console.warn(`⚠️ Pas d'email pour le joueur: ${g}`);continue}console.log(`🔍 DEBUG Email trouvé pour ${g}:`,C);const k=`${(await a({seasonId:r,playerId:_.id,eventId:n,action:"no"})).url}&slug=${encodeURIComponent(s)}`,j=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2>🎭 Sélection confirmée</h2>
          <p>Bonjour <strong>${g}</strong>,</p>
          <p>Tu as été sélectionné(e) pour <strong>${e.title}</strong> (${_y(e.date)}).</p>
          <p>Sélection complète : <strong>${c}</strong>.</p>
          <p>Tu n'es plus disponible ? Signale le rapidement ici :</p>
          <p>
            <a href="${k}" style="display:inline-block;padding:10px 16px;background:#dc2626;color:#fff;border-radius:8px;text-decoration:none;">Signaler que je ne suis plus disponible</a>
          </p>
          <p>
            <a href="${u}" style="display:inline-block;padding:10px 16px;background:#8b5cf6;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
          </p>
        </div>
      `;console.log(`🔍 DEBUG HTML généré pour ${g}:`,j.substring(0,200)+"...");const q=TN({toEmail:C,playerName:g,eventTitle:e.title,eventDate:_y(e.date),eventUrl:u,html:j,subject:d});f.push(q),console.log(`✅ Email ajouté à la queue pour ${g}`)}catch(_){console.error(`❌ Erreur lors de l'envoi de l'email de sélection pour ${g}:`,_)}}return console.log(`🔍 DEBUG Nombre total d'emails à envoyer: ${f.length}`),await Promise.all(f),console.log("✅ Tous les emails ont été envoyés avec succès"),{success:!0,count:f.length}}function _y(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}const AN={class:"relative p-5 pb-4 border-b border-white/10"},PN={class:"text-xl md:text-2xl font-bold text-white pr-10"},SN={key:0,class:"text-sm text-purple-300 mt-1"},RN={class:"px-4 md:px-6 py-4 md:py-6 space-y-6 overflow-y-auto"},CN={class:"bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20 p-3"},kN={class:"text-blue-200 text-sm"},DN={class:"flex space-x-1 bg-gray-800 rounded-lg p-1"},VN=["onClick"],NN={key:0,class:"space-y-4"},ON={class:"bg-gray-800 border border-gray-600 rounded-lg p-4 text-white whitespace-pre-line"},MN={class:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2"},LN={key:0,class:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-3"},FN={class:"text-blue-200 text-sm"},UN={class:"bg-gray-800 border border-gray-600 rounded-lg p-3"},$N={key:0,class:"space-y-2"},jN={class:"flex flex-wrap gap-2"},BN={key:1,class:"text-amber-400 text-sm"},qN={key:1,class:"space-y-4"},zN={class:"relative"},GN=["value"],KN=["title"],HN={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},WN={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},QN={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},JN=["disabled"],YN={key:0},XN={key:1},TI={__name:"EventAnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},mode:{type:String,default:"event",validator:n=>["event","selection"].includes(n)},selectedPlayers:{type:Array,default:()=>[]}},emits:["close","notifications-sent","send-email-notifications"],setup(n,{emit:e}){const t=n,r=e,s=O("email"),i=O(!1),o=O("Copier le message"),a=O(!1),u=O(!1),c=[{id:"email",label:"📧 Email"},{id:"copy",label:"📋 Copie"}],d=We(()=>!t.event||!t.seasonSlug?"":`${window.location.origin}/season/${t.seasonSlug}/event/${t.event.id}`),f=We(()=>{if(!t.event)return"";const U=k(t.event.date);if(t.mode==="selection"){const z=t.selectedPlayers.join(", ");return`Sélection pour ${t.event.title} du ${U} : ${z}`}else return`Bonjour !

Nouvel événement : ${t.event.title}
Date : ${U}

Lien direct vers l'événement : ${d.value}

Merci de confirmer votre disponibilité.`}),g=We(()=>{if(!t.event||!t.selectedPlayers)return"";if(t.mode==="selection"){const U=t.selectedPlayers.join(", ");return`Sélection confirmée

Bonjour [Nom du joueur],

Tu as été sélectionné(e) pour ${t.event.title} (${k(t.event.date)}).

Sélection complète : ${U}.

Tu n'es plus disponible ? Signale le rapidement ici : [Lien de désistement]`}else return`Disponibilité demandée

Bonjour [Nom du joueur],

Peux-tu indiquer ta disponibilité pour ${t.event.title} (${k(t.event.date)}) ?`}),_=O([]);async function C(){if(!t.seasonId)return;let U=[];t.mode==="selection"?U=t.players.filter(Y=>t.selectedPlayers.includes(Y.name)):U=t.players.filter(Y=>Y.isProtected);const z=[];for(const Y of U)try{const{getPlayerEmail:H}=await qt(()=>Promise.resolve().then(()=>td),void 0),P=await H(Y.id,t.seasonId);P&&z.push({...Y,email:P})}catch(H){console.warn(`Impossible de charger l'email pour ${Y.name}:`,H)}_.value=z}function T(){r("close")}function k(U){var Y;return U?(typeof U=="string"?new Date(U):((Y=U.toDate)==null?void 0:Y.call(U))||U).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function j(){const U=f.value;navigator.clipboard.writeText(U).then(()=>{i.value=!0,o.value="Copié !",setTimeout(()=>{i.value=!1,o.value="Copier le message"},2e3)}).catch(z=>{console.error("Erreur lors de la copie du texte:",z),alert("Impossible de copier le message.")})}async function q(){if(!(!t.event||_.value.length===0)){a.value=!0;try{t.mode==="selection"?r("send-email-notifications",{eventId:t.event.id,eventData:t.event,reason:"selection",selectedPlayers:t.selectedPlayers}):r("send-email-notifications",{eventId:t.event.id,eventData:t.event,reason:"manual"})}catch(U){console.error("Erreur lors de l'envoi des notifications:",U),alert("Erreur lors de l'envoi des notifications. Veuillez réessayer.")}finally{a.value=!1}}}return Gs(()=>{t.show&&(s.value="email",C())}),Yt(()=>t.show,U=>{U&&(s.value="email",C())}),Yt(()=>t.selectedPlayers,()=>{t.show&&t.mode==="selection"&&C()}),(U,z)=>n.show?(F(),B("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:T},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] flex flex-col",onClick:z[1]||(z[1]=Bt(()=>{},["stop"]))},[p("div",AN,[p("button",{onClick:T,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),p("h2",PN,le(n.mode==="selection"?"Annoncer la sélection":"Annoncer l'événement"),1),n.event?(F(),B("p",SN,le(n.event.title)+" — "+le(k(n.event.date)),1)):ce("",!0)]),p("div",RN,[p("div",CN,[p("p",kN,le(n.mode==="selection"?"Choisis comment annoncer cette sélection aux joueurs :":"Choisis comment annoncer cet événement aux joueurs :"),1)]),p("div",DN,[(F(),B(ut,null,sr(c,Y=>p("button",{key:Y.id,onClick:H=>s.value=Y.id,class:qn(["flex-1 px-4 py-2 rounded-md text-sm font-medium transition-all duration-200",s.value===Y.id?"bg-purple-600 text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-gray-700"])},le(Y.label),11,VN)),64))]),s.value==="email"?(F(),B("div",NN,[p("div",null,[z[2]||(z[2]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Prévisualisation du message :",-1)),p("div",ON,le(g.value),1)]),p("div",null,[p("label",MN,[z[3]||(z[3]=Rn(" Destinataires ")),p("button",{onClick:z[0]||(z[0]=Y=>u.value=!u.value),class:"text-blue-400 hover:text-blue-300 text-lg cursor-help",title:"Cliquer pour plus d'information"}," ? ")]),u.value?(F(),B("div",LN,[p("p",FN,le(n.mode==="selection"?"Les destinataires sont les joueurs sélectionnés qui ont renseigné une adresse email en utilisant la fonction Protéger.":"Les destinataires sont les joueurs qui ont renseigné une adresse email en utilisant la fonction Protéger."),1)])):ce("",!0),p("div",UN,[_.value.length>0?(F(),B("div",$N,[p("div",jN,[(F(!0),B(ut,null,sr(_.value,Y=>(F(),B("span",{key:Y.id,class:"px-3 py-1 bg-gray-700 text-white rounded text-sm"},le(Y.name),1))),128))])])):(F(),B("div",BN," ⚠️ "+le(n.mode==="selection"?"Aucun joueur sélectionné avec email renseigné. Les notifications ne pourront pas être envoyées.":"Aucun joueur protégé avec email renseigné. Les notifications ne pourront pas être envoyées."),1))])])])):ce("",!0),s.value==="copy"?(F(),B("div",qN,[z[6]||(z[6]=p("div",{class:"bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-lg border border-purple-500/20 p-3"},[p("p",{class:"text-purple-200 text-sm"},"📋 Copie du message pour partage manuel")],-1)),p("div",zN,[p("textarea",{value:f.value,class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400 resize-none",rows:"6",readonly:""},null,8,GN),p("button",{onClick:j,class:"absolute top-2 right-2 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg p-2 hover:from-purple-600 hover:to-pink-700 transition-all duration-300",title:o.value},[i.value?(F(),B("svg",WN,z[5]||(z[5]=[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(F(),B("svg",HN,z[4]||(z[4]=[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2z"},null,-1)])))],8,KN)])])):ce("",!0)]),p("div",QN,[s.value==="email"?(F(),B("button",{key:0,onClick:q,disabled:_.value.length===0||a.value,class:"h-12 px-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600 flex-1"},[a.value?(F(),B("span",XN,"📧 Envoi en cours...")):(F(),B("span",YN,"📧 Envoyer les notifications email"))],8,JN)):ce("",!0),s.value==="copy"?(F(),B("button",{key:1,onClick:j,class:"h-12 px-6 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 flex-1"}," 📋 Copier le message ")):ce("",!0),p("button",{onClick:T,class:"h-12 px-4 bg-gray-700 text-white rounded-lg"}," Fermer ")])])])):ce("",!0)}},ZN={class:"text-center mb-6"},e2={class:"text-lg text-gray-300"},t2={class:"mb-6"},n2={class:"space-y-4"},r2=["disabled"],s2={key:0,class:"animate-spin"},i2={key:1},o2={class:"mb-6 text-center"},a2={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},l2={class:"text-red-300 text-sm"},u2={class:"text-center mb-6"},c2={class:"text-lg text-gray-300"},d2={class:"mb-6"},h2=["disabled"],f2={key:0,class:"animate-spin"},p2={key:1},m2={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},g2={class:"text-red-300 text-sm"},v2={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},y2={class:"text-green-300 text-sm"},_2={class:"flex justify-center"},xI={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=O(""),i=O(!1),o=O(""),a=O(!1),u=O(""),c=O(""),d=O(null);async function f(){if(s.value){i.value=!0,o.value="";try{const C=await Vf(t.seasonId);if(s.value===C){r("verified",{type:"season_pin"}),_();return}await Pm(t.player.id,s.value,t.seasonId)?(r("verified",{type:"player_password"}),_()):o.value="Mot de passe incorrect. Veuillez réessayer."}catch(C){console.error("Erreur lors de la vérification:",C),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function g(){i.value=!0,u.value="",c.value="";try{const C=await wI(t.player.id,t.seasonId);c.value=C.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(C){console.error("Erreur lors de l'envoi de l'email:",C),u.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function _(){r("close"),s.value="",o.value="",a.value=!1,u.value="",c.value=""}return Yt(()=>t.show,C=>{C&&Bn(()=>{d.value&&d.value.focus()})}),(C,T)=>{var k,j;return F(),B(ut,null,[n.show?(F(),B("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:_},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:T[2]||(T[2]=Bt(()=>{},["stop"]))},[p("div",ZN,[T[6]||(T[6]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"🔐")],-1)),T[7]||(T[7]=p("h2",{class:"text-2xl font-bold text-white mb-2"},"Vérification requise",-1)),p("p",e2,le((k=n.player)==null?void 0:k.name),1),T[8]||(T[8]=p("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protégé par mot de passe",-1))]),p("div",t2,[p("div",n2,[p("div",null,[T[9]||(T[9]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),lt(p("input",{"onUpdate:modelValue":T[0]||(T[0]=q=>s.value=q),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:vn(f,["enter"]),ref_key:"passwordInput",ref:d},null,544),[[Rt,s.value]])])]),p("button",{onClick:f,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(F(),B("span",s2,"⏳")):(F(),B("span",i2,"🔓")),p("span",null,le(i.value?"Vérification...":"Vérifier"),1)],8,r2)]),p("div",o2,[p("button",{onClick:T[1]||(T[1]=q=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(F(),B("div",a2,[p("div",l2,le(o.value),1)])):ce("",!0),p("div",{class:"flex justify-center"},[p("button",{onClick:_,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ce("",!0),a.value?(F(),B("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:T[5]||(T[5]=q=>a.value=!1)},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:T[4]||(T[4]=Bt(()=>{},["stop"]))},[p("div",u2,[T[10]||(T[10]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"📧")],-1)),T[11]||(T[11]=p("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oublié",-1)),p("p",c2,le((j=n.player)==null?void 0:j.name),1)]),p("div",d2,[T[12]||(T[12]=p("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),p("button",{onClick:g,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(F(),B("span",f2,"⏳")):(F(),B("span",p2,"📧")),p("span",null,le(i.value?"Envoi...":"Envoyer l'email"),1)],8,h2)]),u.value?(F(),B("div",m2,[p("div",g2,le(u.value),1)])):ce("",!0),c.value?(F(),B("div",v2,[p("div",y2,le(c.value),1)])):ce("",!0),p("div",_2,[p("button",{onClick:T[3]||(T[3]=q=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0)],64)}}},b2={class:"text-center mb-6"},w2={class:"text-lg text-gray-300"},I2={class:"mb-6"},E2={class:"flex items-center space-x-3"},T2={class:"text-2xl"},x2={class:"font-semibold text-white"},A2={class:"text-sm text-gray-300"},P2={class:"mb-6"},S2={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-1"},R2={key:0,class:"mb-6"},C2={class:"flex items-center justify-center gap-3 mb-4 text-sm"},k2={key:0,class:"space-y-4"},D2=["disabled"],V2={key:0,class:"animate-spin"},N2={key:1},O2={key:0,class:"text-sm text-gray-300"},M2={key:1,class:"space-y-4"},L2={key:0,class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},F2=["disabled"],U2={key:0,class:"animate-spin"},$2={key:1},j2={key:1,class:"mb-6"},B2={key:0,class:"space-y-4 mb-4"},q2=["disabled"],z2={key:0,class:"animate-spin"},G2={key:1},K2=["disabled"],H2={key:2,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},W2={class:"text-red-300 text-sm"},Q2={key:3,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},J2={class:"text-green-300 text-sm"},Y2={__name:"PlayerProtectionModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","update"],setup(n,{emit:e}){const t=n,r=e,s=O(!1),i=O(1),o=O(""),a=O(""),u=O(""),c=O(""),d=O(!1),f=O(""),g=O(""),_=O(!1),C=O(!1),T=O(""),k=O(!1),j=O(!1),q=iu(),U=We(()=>o.value&&o.value.includes("@")),z=We(()=>u.value&&c.value&&u.value===c.value&&u.value.length>=6);async function Y(){var D,w;if((D=t.player)!=null&&D.id&&(s.value=await Ui(t.player.id,t.seasonId),!s.value)){o.value="";try{const He=await(await qt(()=>Promise.resolve().then(()=>td),void 0)).getPlayerProtectionData(t.player.id,t.seasonId);a.value=(He==null?void 0:He.email)||"";const Fe=!!(He!=null&&He.emailVerifiedAt);i.value=Fe?2:1;const et=((w=q.query)==null?void 0:w.verified)==="1";j.value=et&&Fe}catch{a.value="",i.value=1,j.value=!1}}}async function H(){var D,w;if(U.value){d.value=!0,f.value="",g.value="";try{const He=await vI({playerId:t.player.id,email:o.value.trim(),seasonId:t.seasonId}),Fe=(D=q.params)==null?void 0:D.slug,et=`${He.url}${Fe?`&slug=${encodeURIComponent(Fe)}`:""}&player=${encodeURIComponent(t.player.id)}&open=protection`;await EN({toEmail:o.value,playerName:((w=t.player)==null?void 0:w.name)||"joueur",verifyUrl:et}),k.value=!0}catch(He){f.value=(He==null?void 0:He.message)||"Impossible d'envoyer l'email de vérification"}finally{d.value=!1}}}async function P(){try{const{clearEmailVerificationForProtection:D}=await qt(()=>Promise.resolve().then(()=>td),void 0);await D({playerId:t.player.id,seasonId:t.seasonId})}catch{}i.value=1,k.value=!1,j.value=!1,o.value="",u.value="",c.value=""}async function I(){if(z.value){d.value=!0,f.value="",g.value="";try{const D=a.value||o.value;if(!D)throw new Error("Adresse email manquante");await gI(t.player.id,D,u.value,t.seasonId),g.value="Protection activée avec succès !",s.value=!0,o.value="",a.value="",u.value="",c.value="",r("update")}catch(D){console.error("Erreur lors de l'activation de la protection:",D),D.message&&D.message.includes("email")?f.value="Cette adresse email est déjà utilisée par un autre joueur.":f.value="Erreur lors de l'activation de la protection. Veuillez réessayer."}finally{d.value=!1}}}function R(){C.value=!0,T.value="",f.value=""}async function x(){if(T.value){d.value=!0,f.value="",g.value="";try{if(!await Pm(t.player.id,T.value,t.seasonId)){f.value="Mot de passe incorrect. Veuillez réessayer.";return}const w=await _I(t.player.id,t.seasonId);g.value="Protection désactivée avec succès !",s.value=!1,C.value=!1,T.value="",w.email&&(o.value=w.email),r("update")}catch(D){console.error("Erreur lors de la désactivation de la protection:",D),f.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{d.value=!1}}}function S(){r("close")}return Yt(()=>t.player,()=>{t.show&&t.player&&Y()},{immediate:!0}),Yt(()=>t.show,D=>{D&&t.player&&(o.value="",u.value="",c.value="",f.value="",g.value="",_.value=!1,C.value=!1,T.value="",i.value=1,k.value=!1,Y())}),(D,w)=>{var He;return n.show?(F(),B("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:S},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:w[6]||(w[6]=Bt(()=>{},["stop"]))},[p("div",b2,[w[7]||(w[7]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"🔒")],-1)),w[8]||(w[8]=p("h2",{class:"text-2xl font-bold text-white mb-2"},"Protection du joueur",-1)),p("p",w2,le((He=n.player)==null?void 0:He.name),1)]),p("div",I2,[p("div",{class:qn(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[p("div",E2,[p("span",T2,le(s.value?"🔒":"🔓"),1),p("div",null,[p("div",x2,le(s.value?"Protégé":"Non protégé"),1),p("div",A2,le(s.value?"Modifications sécurisées":"Modifications libres"),1)])])],2)]),p("div",P2,[p("button",{onClick:w[0]||(w[0]=Fe=>_.value=!_.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[w[9]||(w[9]=p("h3",{class:"text-sm font-semibold text-blue-300"},"💡 Pourquoi protéger son joueur ?",-1)),p("span",{class:qn(["text-blue-300 transition-transform duration-200",{"rotate-180":_.value}])},"▼",2)]),_.value?(F(),B("div",S2,w[10]||(w[10]=[p("div",null,[Rn("• "),p("span",{class:"text-blue-300"},"Protection des disponibilités :"),Rn(" Seul vous pouvez modifier vos disponibilités")],-1),p("div",null,[Rn("• "),p("span",{class:"text-blue-300"},"Protection du nom :"),Rn(" Seul vous pouvez changer votre nom de joueur")],-1),p("div",null,[Rn("• "),p("span",{class:"text-blue-300"},"Email requis :"),Rn(" Permet de réinitialiser le mot de passe en cas d'oubli et de recevoir des notifications quand des changements surviennent")],-1)]))):ce("",!0)]),s.value?ce("",!0):(F(),B("div",R2,[w[18]||(w[18]=p("h3",{class:"text-lg font-semibold text-white mb-4"},"🔐 Activer la protection",-1)),p("div",C2,[p("div",{class:qn(["px-3 py-1 rounded-full border",i.value===1?"bg-blue-500/20 border-blue-400 text-blue-200":"bg-green-500/20 border-green-400 text-green-200"])},"1. Email",2),w[11]||(w[11]=p("div",{class:"text-gray-400"},"→",-1)),p("div",{class:qn(["px-3 py-1 rounded-full border",i.value===2?"bg-yellow-500/20 border-yellow-400 text-yellow-200":i.value>2?"bg-green-500/20 border-green-400 text-green-200":"bg-gray-500/20 border-gray-400 text-gray-200"])},"2. Mot de passe",2)]),i.value===1?(F(),B("div",k2,[p("div",null,[w[12]||(w[12]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),lt(p("input",{"onUpdate:modelValue":w[1]||(w[1]=Fe=>o.value=Fe),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Rt,o.value]])]),p("button",{onClick:H,disabled:!U.value||d.value,class:"w-full px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[d.value?(F(),B("span",V2,"⏳")):(F(),B("span",N2,"✉️")),p("span",null,le(d.value?"Envoi...":"Envoyer le lien de vérification"),1)],8,D2),k.value?(F(),B("div",O2," Un email de vérification a été envoyé. Cliquez sur le lien reçu, puis revenez ici. ")):ce("",!0)])):i.value===2?(F(),B("div",M2,[j.value?(F(),B("div",L2,[w[13]||(w[13]=p("span",null,"✅",-1)),w[14]||(w[14]=p("span",null,"Adresse email vérifiée",-1)),p("button",{type:"button",onClick:P,title:"Changer d'adresse email",class:"ml-auto px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-colors"},"✏️")])):ce("",!0),w[17]||(w[17]=p("div",{class:"text-sm text-gray-300"},"Définissez maintenant votre mot de passe.",-1)),p("div",null,[w[15]||(w[15]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),lt(p("input",{"onUpdate:modelValue":w[2]||(w[2]=Fe=>u.value=Fe),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé (min. 6 caractères)"},null,512),[[Rt,u.value]])]),p("div",null,[w[16]||(w[16]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),lt(p("input",{"onUpdate:modelValue":w[3]||(w[3]=Fe=>c.value=Fe),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[Rt,c.value]])]),p("button",{onClick:I,disabled:!z.value||d.value,class:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[d.value?(F(),B("span",U2,"⏳")):(F(),B("span",$2,"🔒")),p("span",null,le(d.value?"Activation...":"Activer la protection"),1)],8,F2)])):ce("",!0)])),s.value?(F(),B("div",j2,[w[21]||(w[21]=p("h3",{class:"text-lg font-semibold text-white mb-4"},"🔓 Désactiver la protection",-1)),w[22]||(w[22]=p("p",{class:"text-sm text-gray-300 mb-4"}," Attention : désactiver la protection supprimera définitivement le mot de passe et l'email associés. ",-1)),C.value?(F(),B("div",B2,[p("div",null,[w[19]||(w[19]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe de confirmation",-1)),lt(p("input",{"onUpdate:modelValue":w[4]||(w[4]=Fe=>T.value=Fe),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe pour confirmer"},null,512),[[Rt,T.value]])]),p("button",{onClick:x,disabled:!T.value||d.value,class:"w-full px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[d.value?(F(),B("span",z2,"⏳")):(F(),B("span",G2,"🔓")),p("span",null,le(d.value?"Désactivation...":"Confirmer la désactivation"),1)],8,q2),p("button",{onClick:w[5]||(w[5]=Fe=>C.value=!1),class:"w-full px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])):ce("",!0),C.value?ce("",!0):(F(),B("button",{key:1,onClick:R,disabled:d.value,class:"w-full px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},w[20]||(w[20]=[p("span",null,"🔓",-1),p("span",null,"Désactiver la protection",-1)]),8,K2))])):ce("",!0),f.value?(F(),B("div",H2,[p("div",W2,le(f.value),1)])):ce("",!0),g.value?(F(),B("div",Q2,[p("div",J2,le(g.value),1)])):ce("",!0),p("div",{class:"flex justify-center"},[p("button",{onClick:S,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0)}}},X2={class:"relative text-center p-6 pb-4 border-b border-white/10"},Z2={class:"text-2xl md:text-3xl font-bold text-white mb-1"},eO={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},tO={class:"grid grid-cols-3 gap-3 md:gap-4"},nO={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},rO={class:"text-xl md:text-2xl font-bold text-white"},sO={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},iO={class:"text-xl md:text-2xl font-bold text-white"},oO={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},aO={class:"text-xl md:text-2xl font-bold text-white"},lO={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},uO={key:0,class:"md:hidden mt-3 space-y-2"},cO={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},dO={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},hO={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},fO={class:"mb-6"},pO={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null}},emits:["close","update","delete","refresh"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=O(!1),o=O(""),a=O(null),u=O(!1),c=O(!1),d=O(null),f=O(!1);function g(){s("close")}function _(){var Y;o.value=((Y=r.player)==null?void 0:Y.name)||"",i.value=!0,Bn(()=>{a.value&&a.value.focus()})}function C(){i.value=!1,o.value=""}async function T(){var H,P;if(!o.value.trim())return;if(await Ui((H=r.player)==null?void 0:H.id,r.seasonId)){Yo((P=r.player)==null?void 0:P.id)?k():(d.value="update",c.value=!0);return}k()}function k(){var Y;s("update",{playerId:(Y=r.player)==null?void 0:Y.id,newName:o.value.trim()}),i.value=!1,o.value=""}async function j(){var H,P;if(await Ui((H=r.player)==null?void 0:H.id,r.seasonId)){Yo((P=r.player)==null?void 0:P.id)?q():(d.value="delete",c.value=!0);return}q()}function q(){var Y;s("delete",(Y=r.player)==null?void 0:Y.id)}function U(){s("refresh")}function z(Y){d.value==="update"?k():d.value==="delete"&&q(),d.value=null}return Yt(()=>r.show,Y=>{Y||(i.value=!1,o.value="",d.value=null,u.value=!1)}),e({openProtection(){u.value=!0}}),(Y,H)=>{var P;return F(),B(ut,null,[n.show?(F(),B("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:g},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:H[5]||(H[5]=Bt(()=>{},["stop"]))},[p("div",X2,[p("button",{onClick:g,class:"absolute right-3 top-3 text-white/80 hover:text-white"},"✖️"),H[9]||(H[9]=p("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[p("span",{class:"text-2xl md:text-3xl"},"👤")],-1)),p("h2",Z2,le((P=n.player)==null?void 0:P.name),1)]),p("div",eO,[p("div",null,[p("div",tO,[p("div",nO,[p("div",rO,le(r.stats.availability),1),H[10]||(H[10]=p("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),p("div",sO,[p("div",iO,le(r.stats.selection),1),H[11]||(H[11]=p("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),p("div",oO,[p("div",aO,le(r.stats.ratio)+"%",1),H[12]||(H[12]=p("div",{class:"text-xs md:text-sm text-gray-300"},"Taux",-1))])])]),p("div",lO,[p("button",{onClick:_,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},H[13]||(H[13]=[p("span",null,"✏️",-1),p("span",null,"Modifier",-1)])),p("button",{onClick:H[0]||(H[0]=I=>u.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},H[14]||(H[14]=[p("span",null,"🔒",-1),p("span",null,"Protection",-1)])),p("button",{onClick:j,class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},H[15]||(H[15]=[p("span",null,"🗑️",-1),p("span",null,"Supprimer",-1)])),p("button",{onClick:g,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")]),f.value?(F(),B("div",uO,[p("button",{onClick:H[1]||(H[1]=I=>{_(),f.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"}," ✏️ Modifier "),p("button",{onClick:H[2]||(H[2]=I=>{j(),f.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"}," 🗑️ Supprimer ")])):ce("",!0)]),p("div",cO,[p("button",{onClick:H[3]||(H[3]=I=>u.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"}," 🔒 Protection "),p("button",{onClick:g,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer "),p("button",{onClick:H[4]||(H[4]=I=>f.value=!f.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ ")])])])):ce("",!0),i.value?(F(),B("div",dO,[p("div",hO,[H[17]||(H[17]=p("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier le joueur",-1)),p("div",fO,[H[16]||(H[16]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),lt(p("input",{"onUpdate:modelValue":H[6]||(H[6]=I=>o.value=I),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[vn(C,["esc"]),vn(T,["enter"])],ref_key:"editNameInput",ref:a},null,544),[[Rt,o.value]])]),p("div",{class:"flex justify-end space-x-3"},[p("button",{onClick:C,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:T,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ce("",!0),mt(Y2,{show:u.value,player:n.player,seasonId:n.seasonId,onClose:H[7]||(H[7]=I=>u.value=!1),onUpdate:U},null,8,["show","player","seasonId"]),mt(xI,{show:c.value,player:n.player,seasonId:n.seasonId,onClose:H[8]||(H[8]=I=>c.value=!1),onVerified:z},null,8,["show","player","seasonId"])],64)}}},mO={class:"relative p-6 pb-4 border-b border-white/10"},gO={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},vO={__name:"HowItWorksModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(F(),B("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=Bt(()=>{},["stop"]))},[p("div",mO,[p("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=p("div",{class:"flex items-center gap-3"},[p("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-2xl"},"❓"),p("div",null,[p("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Comment fonctionne la sélection automatique ?"),p("p",{class:"text-sm text-blue-300"},"Tirage au sort pondéré pour favoriser l'équité")])],-1))]),s[5]||(s[5]=rr('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">En bref</h3><p>On tire au sort uniquement parmi les joueurs <span class="text-green-300">disponibles</span>. Ceux qui ont <span class="text-purple-300">moins joué</span> ont plus de chances d&#39;être tirés. À long terme, tout le monde joue à peu près autant.</p></div><div class="space-y-3"><h3 class="text-white font-semibold">Détails du tirage</h3><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><span class="text-white">Qui participe ?</span> Tous les joueurs marqués « ✅ Disponible » pour l’événement.</li><li><span class="text-white">Un coup de pouce aux moins joués</span> : si vous avez moins joué récemment, le tirage vous favorise un peu plus.</li><li><span class="text-white">Comment se fait le tirage ?</span> On tire un nom au hasard en tenant compte de cet avantage, on le met de côté, puis on recommence jusqu’à avoir assez de joueurs.</li><li><span class="text-white">Si on relance</span> : on garde les joueurs encore disponibles et on complète seulement les places manquantes.</li><li><span class="text-white">Indisponibles</span> : ils ne sont jamais tirés au sort.</li></ol></div><div class="space-y-2"><h3 class="text-white font-semibold">Estimation des chances</h3><p>L’application peut afficher un pourcentage indicatif pour aider à comprendre : si Alice a moins joué que Bob, elle aura un pourcentage plus élevé. C’est une indication, pas une promesse : deux tirages peuvent donner des résultats différents.</p></div><div class="space-y-2"><h3 class="text-white font-semibold">Pourquoi c’est juste</h3><ul class="list-disc list-inside space-y-1 text-gray-300"><li>Ceux qui ont moins joué ont automatiquement plus de chances.</li><li>Après une sélection, vos chances diminuent un peu pour laisser la place aux autres.</li><li>Sur la durée, les sélections s’<span class="text-green-300">équilibrent naturellement</span>.</li></ul></div><div class="space-y-2"><h3 class="text-white font-semibold">Exemples rapides</h3><p> • Alice n’a encore jamais été sélectionnée, Bob a été sélectionné une fois, Charlie plusieurs fois. Pour 1 place, on aura environ : Alice 57 %, Bob 29 %, Charlie 14 %.<br> • S’il y a 2 places, les chances de chacun augmentent, mais l’ordre reste aléatoire : un tirage peut donner Alice + Bob, un autre Alice + Charlie. </p></div><div class="text-xs text-gray-400"> Remarque : l’algorithme favorise l’équité à long terme, mais <span class="text-gray-300">n’assure pas</span> une rotation parfaite à chaque événement. </div></div>',1)),p("div",gO,[p("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ce("",!0)}},yO={class:"relative text-center p-6 pb-4 border-b border-white/10"},_O={class:"text-2xl md:text-3xl font-bold text-white mb-1"},bO={class:"text-sm md:text-base text-purple-300"},wO={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},IO={key:0,class:"mb-3"},EO={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},TO={class:"text-white font-medium"},xO={key:0,class:"text-purple-400 mr-2"},AO={key:1,class:"text-green-400 mr-2"},PO={key:2,class:"text-red-400 mr-2"},SO={key:3,class:"text-gray-400 mr-2"},RO={key:1,class:"mb-3"},CO={class:"grid grid-cols-3 gap-2 md:gap-3 mb-3"},kO={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},DO={class:"text-cyan-300 text-lg md:text-xl font-semibold"},VO={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},NO={class:"text-green-400 text-lg md:text-xl font-semibold"},OO={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},MO={class:"text-purple-400 text-lg md:text-xl font-semibold"},LO={key:2,class:"mb-3"},FO={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},UO={class:"flex-1"},$O={class:"text-blue-300 text-sm font-medium"},jO={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},BO=["disabled","title"],qO=["disabled"],zO={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]}},emits:["close","selection","perfect","send-email-notifications"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=O(!1),o=O("Copier le message"),a=O(!1),u=O(!1),c=O(""),d=O(!1),f=O(!1),g=We(()=>r.currentSelection&&r.currentSelection.length>0),_=We(()=>{var w;if(!g.value)return!1;const x=r.currentSelection.some(He=>!z(He)),S=((w=r.event)==null?void 0:w.playerCount)||6,D=r.availableCount<S;return x||D});We(()=>{var D;if(!_.value)return"";const x=r.currentSelection.filter(w=>!z(w)),S=((D=r.event)==null?void 0:D.playerCount)||6;return x.length>0?x.length===1?`${x[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${x.length} joueurs ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<S?`Seulement ${r.availableCount} joueurs disponibles pour ${S} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de joueurs à sélectionner.`:"Sélection incomplète"}),We(()=>{if(!r.event||!g.value)return"";const x=C(r.event.date),S=r.currentSelection.join(", ");return`Sélection pour ${r.event.title} du ${x} : ${S}`}),Yt(()=>r.show,x=>{x&&(i.value=!1,o.value="Copier le message",u.value=!1,c.value="",d.value=!1,a.value=!1)});function C(x){var D;return x?(typeof x=="string"?new Date(x):((D=x.toDate)==null?void 0:D.call(x))||x).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function T(){s("selection")}function k(){s("perfect")}function j(){s("close")}function q(){a.value=!0}function U(){f.value=!0}function z(x){return r.playerAvailability[x]===!0}function Y(x){return r.playerAvailability[x]===!1}function H(x){return r.currentSelection.includes(x)&&z(x)}function P(x=!1,S=!1){if(d.value=x,x){const D=C(r.event.date),w=r.currentSelection.join(", ");S?c.value=`Sélection mise à jour pour ${r.event.title} du ${D} : ${w}`:c.value=`Nouvelle sélection pour ${r.event.title} du ${D} : ${w}`}else c.value="Sélection effectuée avec succès !";u.value=!0,setTimeout(()=>{u.value=!1},8e3)}function I(){u.value=!1}e({showSuccess:P});function R(x){s("send-email-notifications",x),a.value=!1}return(x,S)=>{var D,w,He;return F(),B(ut,null,[n.show?(F(),B("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:j},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:S[0]||(S[0]=Bt(()=>{},["stop"]))},[p("div",yO,[p("button",{onClick:j,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),S[4]||(S[4]=p("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-3xl"},"🎭")],-1)),p("h2",_O,"Sélection pour "+le((D=n.event)==null?void 0:D.title),1),p("p",bO,le(C((w=n.event)==null?void 0:w.date)),1),p("div",{class:"mt-3"},[p("button",{onClick:U,class:"inline-flex items-center gap-2 text-sm text-blue-300 hover:text-blue-200"},S[3]||(S[3]=[p("span",null,"❓",-1),Rn(),p("span",null,"Comment ça marche ?",-1)]))])]),p("div",wO,[g.value?(F(),B("div",IO,[S[5]||(S[5]=p("h3",{class:"text-base md:text-lg font-semibold text-white mb-2"},"Joueurs sélectionnés",-1)),p("div",EO,[(F(!0),B(ut,null,sr(n.currentSelection,Fe=>(F(),B("div",{key:Fe,class:qn(["bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 rounded-lg border border-green-500/30 text-center",{"from-red-500/20 to-red-600/20 border-red-500/30":!z(Fe),"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":Y(Fe)}])},[p("span",TO,[H(Fe)?(F(),B("span",xO,"🎭")):z(Fe)?(F(),B("span",AO,"✅")):Y(Fe)?(F(),B("span",PO,"❌")):(F(),B("span",SO,"–")),Rn(" "+le(Fe),1)])],2))),128))])])):ce("",!0),_.value?(F(),B("div",RO,S[6]||(S[6]=[p("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[p("div",{class:"text-yellow-400"},"⚠️"),p("div",{class:"text-yellow-200 text-sm"},"Sélection incomplète. Vérifie ci-dessous.")],-1)]))):ce("",!0),p("div",CO,[p("div",kO,[p("div",DO,le(((He=n.event)==null?void 0:He.playerCount)||6),1),S[7]||(S[7]=p("div",{class:"text-xs md:text-sm text-gray-400"},"À sélectionner",-1))]),p("div",VO,[p("div",NO,le(n.availableCount),1),S[8]||(S[8]=p("div",{class:"text-xs md:text-sm text-gray-400"},"Disponibles",-1))]),p("div",OO,[p("div",MO,le(n.selectedCount),1),S[9]||(S[9]=p("div",{class:"text-xs md:text-sm text-gray-400"},"Sélectionnés",-1))])]),u.value?(F(),B("div",LO,[p("div",FO,[S[11]||(S[11]=p("div",{class:"text-blue-400 text-xl"},"✨",-1)),p("div",UO,[p("p",$O,le(c.value),1)]),p("button",{onClick:I,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},S[10]||(S[10]=[p("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):ce("",!0)]),p("div",jO,[p("button",{onClick:T,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":g.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},S[12]||(S[12]=[Rn(" ✨ "),p("span",{class:"hidden sm:inline"},"Sélection Auto",-1),p("span",{class:"sm:hidden"},"Auto",-1)]),8,BO),g.value?(F(),B("button",{key:0,onClick:k,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap"},S[13]||(S[13]=[Rn(" 👍 "),p("span",{class:"hidden sm:inline"},"Parfait",-1)]))):ce("",!0),p("button",{onClick:q,disabled:!g.value,class:"h-12 px-3 md:px-4 bg-gray-700 text-white rounded-lg flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},S[14]||(S[14]=[Rn(" 📣 "),p("span",{class:"hidden sm:inline"},"Annoncer",-1)]),8,qO)])])])):ce("",!0),mt(TI,{show:a.value,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,mode:"selection","selected-players":n.currentSelection,onClose:S[1]||(S[1]=Fe=>a.value=!1),onSendEmailNotifications:R},null,8,["show","event","season-id","season-slug","players","selected-players"]),mt(vO,{show:f.value,onClose:S[2]||(S[2]=Fe=>f.value=!1)},null,8,["show"])],64)}}},GO={class:"flex items-center justify-center gap-2"},KO=["title"],HO=["title"],WO=["title"],QO=["title"],JO=["title"],by={__name:"AvailabilityCell",props:{playerName:{type:String,required:!0},eventId:{type:String,required:!0},isAvailable:{type:Boolean,default:null},isSelected:{type:Boolean,default:!1},chancePercent:{type:Number,default:null},showSelectedChance:{type:Boolean,default:!1}},emits:["toggle"],setup(n,{emit:e}){const t=n,r=e,s=O(!1),i=We(()=>!(t.chancePercent==null||t.isAvailable!==!0||t.isSelected&&!t.showSelectedChance)),o=We(()=>t.isSelected?i.value?`${t.playerName} est sélectionné pour cet événement • avait ~${t.chancePercent}% de chances`:`${t.playerName} est sélectionné pour cet événement`:t.isAvailable===!0?t.chancePercent!=null?`${t.playerName} est disponible • ~${t.chancePercent}% de chances d'être sélectionné`:`${t.playerName} est disponible`:t.isAvailable===!1?`${t.playerName} n'est pas disponible`:`Cliquer pour indiquer la disponibilité de ${t.playerName}`);function a(){r("toggle",t.playerName,t.eventId)}return(u,c)=>(F(),B("div",{class:"flex items-center justify-center cursor-pointer hover:bg-white/10 transition-all duration-200 min-h-20 p-3 md:p-5",onClick:a,onMouseenter:c[0]||(c[0]=d=>s.value=!0),onMouseleave:c[1]||(c[1]=d=>s.value=!1)},[p("div",GO,[i.value&&s.value?(F(),B("span",{key:0,class:"text-[11px] md:text-xs px-2 py-0.5 rounded-full bg-emerald-500/15 border border-emerald-400/40 text-emerald-200",title:o.value},le(n.chancePercent)+"% ",9,KO)):(F(),B(ut,{key:1},[n.isSelected?(F(),B("span",{key:0,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:o.value}," 🎭 ",8,HO)):n.isAvailable===!0?(F(),B("span",{key:1,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:o.value}," ✅ ",8,WO)):n.isAvailable===!1?(F(),B("span",{key:2,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:o.value}," ❌ ",8,QO)):(F(),B("span",{key:3,class:"text-gray-500 hover:text-white transition-colors duration-200 text-xl",title:o.value}," – ",8,JO))],64))])],32))}},YO={key:0,class:"fixed inset-0 z-[130] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},XO={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},ZO={class:"text-2xl md:text-3xl font-bold text-white mb-3"},eM={class:"text-gray-300 mb-6"},tM={class:"flex flex-col items-stretch justify-center gap-3"},nM=["value"],rM={__name:"CreatorOnboardingModal",props:{seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},onboardingDone:{type:Boolean,default:!1}},emits:["create-event","add-player","copy-link","dismissed"],setup(n,{emit:e}){const t=n,r=e,s=window.location.origin,i=We(()=>`${s}/season/${t.seasonSlug}`),o=O(!1);try{t.seasonId&&(o.value=!!localStorage.getItem(`dismissCreatorOnboarding:${t.seasonId}`))}catch{}const a=We(()=>t.onboardingDone?0:t.eventsCount===0&&t.playersCount===0?1:t.eventsCount>0&&t.playersCount===0?2:t.eventsCount>0&&t.playersCount>0&&!o.value?3:0),u=We(()=>a.value>0),c=O(u.value);Yt(a,k=>{c.value=k>0});const d=We(()=>{switch(a.value){case 1:return"Commençons par créer votre premier événement";case 2:return"Super ! Ajoutez votre premier joueur";case 3:return"Vous y êtes presque! Maintenant, invitez vos joueurs.";default:return""}}),f=We(()=>{switch(a.value){case 1:return"Un titre, une date... et c’est parti.";case 2:return"Ajoutez au moins un joueur pour commencer à saisir des disponibilités.";case 3:return"Laissez vos membres s’inscrire eux-même et indiquer leurs disponibilités en leur envoyant le lien direct.";default:return""}});function g(){c.value=!1,r("create-event")}function _(){c.value=!1,r("add-player")}function C(){var k;try{(k=navigator.clipboard)==null||k.writeText(i.value)}catch{}r("copy-link")}async function T(){try{if(t.seasonId){const{db:k}=await qt(()=>Promise.resolve().then(()=>qs),void 0),{doc:j,updateDoc:q}=await qt(()=>import("./index.esm-5febd93d.js"),[]);await q(j(k,"seasons",t.seasonId),{onboardingCreatorDone:!0})}else localStorage.setItem("dismissCreatorOnboarding","1")}catch{}o.value=!0,c.value=!1,r("dismissed")}return(k,j)=>u.value&&c.value?(F(),B("div",YO,[p("div",XO,[j[1]||(j[1]=p("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[p("span",{class:"text-3xl"},"🎬")],-1)),p("h2",ZO,le(d.value),1),p("p",eM,le(f.value),1),p("div",tM,[a.value===1?(F(),B("button",{key:0,onClick:g,class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all"}," ✨ Créer un événement ")):a.value===2?(F(),B("button",{key:1,onClick:_,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"}," 👤 Ajouter un joueur ")):a.value===3?(F(),B(ut,{key:2},[p("input",{value:i.value,type:"text",readonly:"",class:"w-full px-3 py-2 bg-gray-800 border border-white/20 rounded-lg text-white text-sm select-all",onFocus:j[0]||(j[0]=q=>q.target.select())},null,40,nM),p("div",{class:"flex gap-3 justify-center"},[p("button",{onClick:C,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"}," 🔗 Copier le lien "),p("button",{onClick:T,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"}," J’ai compris ")])],64)):ce("",!0)])])])):ce("",!0)}},sM={key:0,class:"fixed inset-0 z-[140] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},iM={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},oM={class:"text-2xl md:text-3xl font-bold text-white mb-3"},aM={class:"text-gray-300 mb-6"},lM={class:"flex flex-col gap-3"},uM={__name:"PlayerOnboardingModal",props:{seasonId:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},creatorOnboardingDone:{type:Boolean,default:!1}},emits:["add-self","focus-availability","open-protection","done"],setup(n,{emit:e}){const t=n,r=e,s=O(1),i=We(()=>{if(!t.creatorOnboardingDone||t.eventsCount===0||t.playersCount===0)return!1;try{if(t.seasonId&&localStorage.getItem(`playerTourDone:${t.seasonId}`))return!1}catch{}return!0}),o=O(i.value);Yt(i,k=>{o.value=k});const a=We(()=>{switch(s.value){case 1:return"Bienvenue !";case 2:return"Indiquez vos disponibilités";case 3:return"Sécurisez votre profil";default:return""}}),u=We(()=>{switch(s.value){case 1:return"Ajoutez votre nom à la saison pour apparaître dans la grille.";case 2:return"Cliquez dans la cellule pour vous déclarer disponible ou non.";case 3:return"Protégez vos actions sensibles avec un mot de passe.";default:return""}});function c(){s.value=Math.min(3,s.value+1)}function d(){r("add-self"),c()}function f(){r("focus-availability")}function g(){r("open-protection")}function _(){try{t.seasonId&&localStorage.setItem(`playerTourDone:${t.seasonId}`,"1")}catch{}}function C(){_(),o.value=!1,r("done")}function T(){_(),o.value=!1,r("done")}return(k,j)=>i.value&&o.value?(F(),B("div",sM,[p("div",iM,[j[0]||(j[0]=p("div",{class:"w-20 h-20 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[p("span",{class:"text-3xl"},"🧑‍🎤")],-1)),p("h2",oM,le(a.value),1),p("p",aM,le(u.value),1),p("div",lM,[s.value===1?(F(),B(ut,{key:0},[p("button",{onClick:d,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"},"➕ Ajouter mon nom"),p("button",{onClick:c,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"},"Passer")],64)):s.value===2?(F(),B(ut,{key:1},[p("button",{onClick:f,class:"px-5 py-3 bg-gradient-to-r from-emerald-500 to-green-600 text-white rounded-lg hover:from-emerald-600 hover:to-green-700 transition-all"},"✅ Indiquer mes disponibilités"),p("button",{onClick:c,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"},"J'ai fait / Passer")],64)):s.value===3?(F(),B(ut,{key:2},[p("button",{onClick:g,class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all"},"🔒 Protéger mon compte"),p("div",{class:"flex gap-3 justify-center"},[p("button",{onClick:C,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"},"Terminer"),p("button",{onClick:T,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"},"Ignorer")])],64)):ce("",!0)])])])):ce("",!0)}};const cM={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},dM={ref:"pageHeaderRef",class:"sticky top-0 z-[70] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},hM={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},fM={class:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2"},pM=["title"],mM={class:"text-2xl"},gM={class:"w-full px-0 md:px-0 pb-0 pt-[72px] md:pt-[80px] -mt-[72px] md:-mt-[80px] bg-gray-900"},vM={class:"flex items-stretch relative"},yM={key:0,class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},_M={class:"flex-1 overflow-hidden"},bM=["data-event-id","onClick"],wM=["title"],IM=["title"],EM={key:0,class:"mt-1 text-xs text-gray-400"},TM=["title","onClick"],xM=["title","onClick"],AM={class:"table-auto border-separate border-spacing-0 table-fixed w-full min-w-max"},PM=["data-player-id"],SM={class:"p-4 md:p-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900"},RM={class:"font-bold text-xl md:text-2xl whitespace-pre-wrap flex items-center"},CM={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protégé par mot de passe"},kM=["onClick","title"],DM=["data-event-id"],VM={key:0,class:"border-t border-white/10"},NM={class:"p-4 md:p-5 sticky left-0 z-40 bg-gray-900"},OM={class:"flex items-center"},MM=["data-event-id"],LM={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},FM={class:"text-center"},UM={class:"text-white text-lg"},$M={class:"mt-3 w-64 h-2 bg-white/10 rounded-full overflow-hidden"},jM={class:"text-white/60 text-xs mt-2"},BM={key:3,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-[200]"},qM={class:"flex items-center space-x-2"},zM={key:4,class:"fixed bottom-4 left-4 bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl shadow-2xl border border-red-400/30 backdrop-blur-sm z-[200]"},GM={class:"flex items-center space-x-2"},KM={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},HM={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},WM={class:"mb-6"},QM={class:"mb-6"},JM={class:"mb-6"},YM={class:"mb-6 flex items-center gap-3"},XM={class:"mb-6"},ZM={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},eL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},tL={class:"mb-6"},nL={class:"flex justify-end space-x-3"},rL={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},sL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},iL={class:"flex justify-end space-x-3"},oL={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},aL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},lL={class:"flex justify-end space-x-3"},uL={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},cL={class:"relative text-center p-6 pb-4 border-b border-white/10"},dL={class:"text-2xl md:text-3xl font-bold text-white mb-1"},hL={class:"text-sm md:text-base text-purple-300"},fL={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},pL={key:0,class:"mb-4 md:mb-6"},mL={class:"text-gray-300 bg-gray-800/50 p-4 rounded-lg border border-gray-600/50"},gL={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},vL={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},yL={class:"text-xl md:text-2xl font-bold text-white"},_L={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},bL={class:"text-xl md:text-2xl font-bold text-white"},wL={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},IL={class:"text-xl md:text-2xl font-bold text-white"},EL={key:1,class:"mb-4 md:mb-6"},TL={class:"bg-gray-800 border border-gray-600 rounded-lg overflow-hidden"},xL={class:"col-span-4 p-3 flex items-center"},AL={class:"font-medium text-white"},PL={key:0,class:"text-yellow-400 ml-2 text-lg",title:"Joueur protégé"},SL={class:"col-span-8 p-0"},RL={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},CL=["disabled","title"],kL=["title"],DL={key:2,class:"md:hidden mt-3 space-y-2"},VL=["disabled","title"],NL={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},OL={key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},ML={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},LL={class:"mb-6"},FL={class:"mb-6"},UL={class:"mb-6"},$L={class:"mb-6 flex items-center gap-3"},jL={class:"mb-6"},BL={key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},qL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},zL={class:"mb-6"},GL={class:"space-y-4"},KL=["disabled"],HL={key:0,class:"animate-spin"},WL={key:1},QL={class:"mb-6 text-center"},JL={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},YL={class:"text-red-300 text-sm"},XL={key:13,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},ZL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},eF={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},tF={class:"space-y-4"},nF={class:"mt-2 text-center"},rF={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},sF={class:"text-red-300 text-sm"},iF={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},oF=["disabled"],aF={key:0,class:"animate-spin"},lF={key:1},uF={class:"mb-6"},cF=["disabled"],dF={key:0,class:"animate-spin"},hF={key:1},fF={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},pF={class:"text-red-300 text-sm"},mF={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},gF={class:"text-green-300 text-sm"},vF={class:"flex justify-center"},yF={class:"mb-6"},_F=["disabled"],bF={key:0,class:"animate-spin"},wF={key:1},IF={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},EF={class:"text-red-300 text-sm"},TF={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},xF={class:"text-green-300 text-sm"},AF={class:"flex justify-center"},PF={key:16,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},SF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl max-w-md"},RF={class:"flex gap-3"},wy={__name:"GridBoard",props:{slug:{type:String,required:!0},eventId:{type:String,required:!1}},setup(n){const e=n,t=su(),r=iu(),s=e.slug,i=O(""),o=O(""),a=O({}),u=O(!1),c=O(null),d=O(null),f=O(""),g=O(""),_=O(6),C=O(!1),T=O(""),k=O(null),j=O(!1),q=O(null),U=O(!1),z=O(null),Y=O(null),H=O(!1),P=O(null),I=O(""),R=O(!1),x=O(null),S=O(""),D=O(""),w=O(!1),He=O(null),Fe=O(!1),et=O(null),$e=O(""),Ve=O(""),Ie=O(!1),oe=O(null),Re=O(!1),_e=O(!1),Le=O(""),dt=O(""),$t=O(!1),Nt=O(!1),W=O(""),ge=O(""),he=O(!1),ne=O(null),je=O(""),tt=O(!1),E=O(!1),A=O(!1),$=O(null),Z=O(null),K=O(null),X=O(0);function pe(){try{if(!o.value||!a.value||a.value.onboardingCreatorDone!==!0||Ke.value.length===0||Oe.value.length===0)return;const b=localStorage.getItem(`playerTourCompleted:${o.value}`),v=localStorage.getItem(`startPlayerTour:${o.value}`);!b&&v&&(X.value=1,localStorage.removeItem(`startPlayerTour:${o.value}`))}catch{}}const ae=O(!1),ie=O(null),re=O(null),Ee=O(!1),fe=O(null),be=O(!1),Pe=O(null),Ae=O(!1);Gs(()=>{try{o.value&&localStorage.getItem(`dismissCreatorOnboarding:${o.value}`)&&(onboardingDismissedShare.value=!0)}catch{}});function Be(){Bn(()=>{dr()})}const ze=O(new Set),Tt=O(!0),ht=O(0),Wt=O("Préparation de la grille"),ft=O(e.eventId||null),er=O(!1),ur=O(null);Yt(()=>e.eventId,b=>{if(b)if(ft.value=b,Oe.value.length>0)Qa(b);else{const v=Yt(Oe,N=>{N.length>0&&(Qa(b),v())},{immediate:!0})}});const jt=We(()=>Ke.value.map(b=>({...b,isProtected:ze.value.has(b.id),email:null}))),kn=We(()=>ft.value?yr.value.findIndex(b=>b.id===ft.value):-1);We(()=>{if(!ft.value||kn.value===-1)return!1;if(window.innerWidth<=768){const b=document.querySelector(`[data-event-id="${ft.value}"]`);if(b){const v=b.getBoundingClientRect();return v.left>=0&&v.right<=window.innerWidth}}return!0});const xn=O(null),so=O(!1),Na=O(!1),io=O(0),ai=O(null),cn=O(null);function cr(){const b=xn.value;if(!b)return;const{scrollLeft:v,scrollWidth:N,clientWidth:J}=b;so.value=v>2,Na.value=v<N-J-2}function dr(){var b;try{cr(),io.value=((b=xn.value)==null?void 0:b.scrollLeft)||0}catch{}}function Oa(b){const v=xn.value;if(!v)return;let N=0;const J=v.querySelector("tbody tr td[data-event-id]");if(J)N=J.getBoundingClientRect().width;else if(cn!=null&&cn.value){const h=cn.value.querySelector(".col-event");h&&(N=h.getBoundingClientRect().width)}(!N||!isFinite(N))&&(N=v.clientWidth*.6);const l=v.scrollLeft+b*N;v.scrollTo({left:l,behavior:"smooth"})}const hr=O(null);O(0);const ps=O(!1),fr=O(!1),Dr=O(0);function rn(b,v){v&&typeof v.preventDefault=="function"&&v.preventDefault(),An(),Oa(b)}function li(b,v){if(v&&typeof v.preventDefault=="function"&&v.preventDefault(),ps.value)return;ps.value=!0,Dr.value=b,fr.value=!1;const N=xn.value;if(!N)return;let J=0;const l=N.querySelector("tbody tr td[data-event-id]");if(l)J=l.getBoundingClientRect().width;else if(cn!=null&&cn.value){const V=cn.value.querySelector(".col-event");V&&(J=V.getBoundingClientRect().width)}(!J||!isFinite(J))&&(J=N.clientWidth*.6);const h=J/6,m=120,y=()=>{if(!ps.value||Dr.value===0)return;fr.value||(fr.value=!0);const V=N.scrollLeft+Dr.value*h;N.scrollTo({left:V,behavior:"auto"}),hr.value=window.setTimeout(y,m)};hr.value=window.setTimeout(y,250)}function An(b){b&&typeof b.preventDefault=="function"&&b.preventDefault();const v=ps.value,N=fr.value;if(ps.value=!1,hr.value&&(clearTimeout(hr.value),hr.value=null),b&&typeof b.type=="string"&&b.type.startsWith("touch")&&!N){const J=Dr.value||0;J!==0&&Oa(J),Dr.value=0;return}Dr.value=0,v&&N&&ui()}function ui(){const b=xn.value;if(!b)return;let v=0;const N=b.querySelector("tbody tr td[data-event-id]");if(N)v=N.getBoundingClientRect().width;else if(cn!=null&&cn.value){const m=cn.value.querySelector(".col-event");m&&(v=m.getBoundingClientRect().width)}if(!v||!isFinite(v)||v<=0)return;const J=b.scrollLeft,h=Math.round(J/v)*v;b.scrollTo({left:h,behavior:"smooth"})}function eh(b){k.value=b;const v=document.querySelector(`[data-player-id="${b}"]`);v&&v.scrollIntoView({behavior:"smooth",block:"center"}),Ne.value=!0,vt.value="Nouveau joueur ajouté !",setTimeout(()=>{Ne.value=!1},3e3)}function oo(b){return ze.value.has(b)}async function pr(){if(o.value)try{const b=await Mf(o.value),v=new Set;b.forEach(N=>{N.isProtected&&v.add(N.playerId||N.id)}),ze.value=v}catch{const v=new Set;for(const N of Ke.value)await Ui(N.id,o.value)&&v.add(N.id);ze.value=v}}const Ne=O(!1),vt=O(""),mr=O(!1),ao=O("");function Ma(){try{const b=`${window.location.origin}/season/${s}`;navigator.clipboard.writeText(b),Ne.value=!0,vt.value="Lien copié dans le presse-papiers",setTimeout(()=>{Ne.value=!1},2500)}catch{mr.value=!0,ao.value="Impossible de copier le lien",setTimeout(()=>{mr.value=!1},2500)}}async function ci(b){await fo({type:"deleteEvent",data:{eventId:b}})}async function gr(b=null){const v=b||c.value;if(console.log("deleteEventConfirmed - eventId param:",b),console.log("deleteEventConfirmed - eventToDelete.value:",c.value),console.log("deleteEventConfirmed - eventIdToDelete:",v),console.log("deleteEventConfirmed - type de eventIdToDelete:",typeof v),!v){console.error("Aucun événement à supprimer");return}try{await bN(v,o.value),Oe.value=Oe.value.filter(N=>N.id!==v),await Promise.all([gy(o.value),ko(Ke.value,Oe.value,o.value),Do(o.value)]).then(([N,J,l])=>{Oe.value=N,Ot.value=J,at.value=l}),u.value=!1,c.value=null,Ne.value=!0,vt.value="Événement supprimé avec succès !",setTimeout(()=>{Ne.value=!1},3e3)}catch(N){console.error("Erreur lors de la suppression de l'événement:",N),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function ku(){u.value=!1,c.value=null}async function lo(){if(!d.value||!f.value.trim()||!g.value)return;const b=parseInt(_.value);if(isNaN(b)||b<1||b>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}try{const v={title:f.value.trim(),date:g.value,description:je.value.trim()||"",playerCount:b,archived:!!tt.value};await yy(d.value,v,o.value),!v.archived&&Ke.value.length>0&&ze.value.size>0&&(Pe.value={id:d.value,...v},be.value=!0),await Promise.all([gy(o.value),ko(Ke.value,Oe.value,o.value),Do(o.value)]).then(([N,J,l])=>{Oe.value=N,Ot.value=J,at.value=l}),d.value=null,f.value="",g.value="",je.value="",_.value=6,tt.value=!1,Ne.value=!0,vt.value="Événement mis à jour avec succès !",setTimeout(()=>{Ne.value=!1},3e3)}catch(v){console.error("Erreur lors de l'édition de l'événement:",v),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function La(){if(T.value.trim())try{const b=T.value.trim(),v=await EI(b,o.value);await Promise.all([Bh(o.value),ko(Ke.value,Oe.value,o.value),Do(o.value)]).then(([N,J,l])=>{Ke.value=N,Ot.value=J,at.value=l,pr();const h=Ke.value.find(y=>y.id===v);eh(v);const m=document.querySelector(`[data-player-id="${v}"]`);m&&m.scrollIntoView({behavior:"smooth",block:"center"}),Ne.value=!0,vt.value="Joueur ajouté avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{Ne.value=!1},3e3),setTimeout(()=>{Ne.value=!1,vt.value=""},5e3)}),C.value=!1,T.value=""}catch(b){console.error("Erreur lors de l'ajout du joueur:",b),alert("Erreur lors de l'ajout du joueur. Veuillez réessayer.")}}function Vr(){d.value=null,f.value="",g.value="",je.value="",_.value=6}O(null);const di=O(!1),Nr=O(""),ms=O(""),vr=O(""),gs=O(6),vs=O(!1);async function hi(){if(!Nr.value.trim()||!ms.value){alert("Veuillez remplir le titre et la date de l'événement");return}const b=parseInt(gs.value);if(isNaN(b)||b<1||b>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}const v={title:Nr.value.trim(),date:ms.value,description:vr.value.trim()||"",playerCount:b,archived:!!vs.value};await Or(v)}async function Or(b){try{const v=await wN(b,o.value);Oe.value=[...Oe.value,{id:v,...b}];const N={};for(const J of Ke.value)N[J.name]=Ot.value[J.name]||{},N[J.name][v]=null,await vy(J.name,N[J.name],o.value);Nr.value="",ms.value="",vr.value="",gs.value=6,vs.value=!1,di.value=!1,await Promise.resolve(),Ne.value=!0,vt.value="Événement créé avec succès !",!b.archived&&Ke.value.length>0&&ze.value.size>0&&(Pe.value={id:v,...b},be.value=!0),setTimeout(()=>{Ne.value=!1},3e3)}catch(v){console.error("Erreur lors de la création de l'événement:",(v==null?void 0:v.message)||v),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function Fa(){Nr.value="",ms.value="",vr.value="",gs.value=6,di.value=!1}async function Du(){await fo({type:"addEvent",data:{}})}const Oe=O([]),Ke=O([]),Ot=O({}),at=O({}),Ua=O({}),uo=O({});Yt([()=>Oe.value.length,()=>Ke.value.length,Tt],()=>{Tt.value||Bn(()=>{dr()})}),Yt([()=>Ke.value.length,()=>Oe.value.length,o],()=>{pe()}),Gs(async()=>{var h;II("firebase"),await vN();const b=Fd(nt(ve,"seasons"),nm("slug","==",e.slug)),v=await Vt(b);if(v.empty){t.push("/");return}else{const m=v.docs[0];o.value=m.id;const y=m.data();i.value=y.name,a.value=y,document.title=`Saison : ${i.value}`}if(o.value){Wt.value="Chargement des événements de la saison",ht.value=20;const m=await Vt(nt(ve,"seasons",o.value,"events"));Oe.value=m.docs.map(Ue=>({id:Ue.id,...Ue.data(),playerCount:Ue.data().playerCount||6})),Wt.value="Chargement des joueurs",ht.value=45;const y=await Vt(nt(ve,"seasons",o.value,"players"));Ke.value=y.docs.map(Ue=>({id:Ue.id,...Ue.data()})),Wt.value="Chargement des disponibilités",ht.value=70;const V=await Vt(nt(ve,"seasons",o.value,"availability")),L={};V.docs.forEach(Ue=>{const bt=Ue.data(),mn={};Object.keys(bt).forEach(Zt=>{const nr=bt[Zt];mn[Zt]=nr==="oui"?!0:nr==="non"?!1:nr}),L[Ue.id]=mn}),Ot.value=L,Wt.value="Chargement des sélections",ht.value=85;const se=await Vt(nt(ve,"seasons",o.value,"selections")),Ce={};se.docs.forEach(Ue=>{Ce[Ue.id]=Ue.data().players||[]}),at.value=Ce;const Je=await Mf(o.value),Se=new Set;Array.isArray(Je)&&Je.forEach(Ue=>{Ue.isProtected&&Se.add(Ue.playerId||Ue.id)}),ze.value=Se}const N=m=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>m()):setTimeout(m,0)};Wt.value="Préparation de l'interface",ht.value=95,N(()=>{_s(),Qn()}),console.log("players (deduplicated):",Ke.value.map(m=>({id:m.id,name:m.name}))),console.log("availability loaded:",Ot.value),await Bn(),ht.value=100,Tt.value=!1,Bn(()=>{cr();const m=xn.value;m&&(m.addEventListener("scroll",y=>{cr(),io.value=m.scrollLeft||0},{passive:!0}),window.addEventListener("resize",cr))});const J=r.query.event;if(J&&Oe.value.length>0){const m=Oe.value.find(y=>y.id===J);m?(console.log("Événement trouvé depuis l'URL:",m.title),await To(J,m)):(console.warn("Événement non trouvé avec l'ID:",J),mr.value=!0,ao.value="Événement non trouvé",setTimeout(()=>{mr.value=!1},3e3))}const l=r.query.player;if(l&&Ke.value.length>0){const m=Ke.value.find(y=>y.id===l);m&&(Ka(m),await Bn(),r.query.open==="protection"&&((h=Y==null?void 0:Y.value)!=null&&h.openProtection)&&Y.value.openProtection())}}),Yt(()=>r.params.eventId,b=>{if(b){const v=()=>{const N=Oe.value.find(J=>J.id===b);return N?(Ga(N),!0):!1};if(Oe.value.length>0)v();else{const N=Yt(Oe,J=>{J.length>0&&v()&&N()},{immediate:!0})}}},{immediate:!0});function $a(b){if(!b)return null;if(b instanceof Date)return b;if(typeof(b==null?void 0:b.toDate)=="function")return b.toDate();if(typeof b=="string"||typeof b=="number"){const v=new Date(b);return isNaN(v.getTime())?null:v}return null}const fi=We(()=>[...Ke.value].sort((b,v)=>(b.name||"").localeCompare(v.name||"","fr",{sensitivity:"base"}))),th=We(()=>[...Oe.value].sort((b,v)=>{const N=$a(b.date),J=$a(v.date),l=N?N.getTime():Number.POSITIVE_INFINITY,h=J?J.getTime():Number.POSITIVE_INFINITY;return l!==h?l-h:(b.title||"").localeCompare(v.title||"","fr",{sensitivity:"base"})})),ys=O(!1),yr=We(()=>{const b=th.value;return ys.value?b:b.filter(v=>!v.archived)});function nh(){ys.value=!ys.value}async function Hn(b,v){const N=Ke.value.find(h=>h.name===b);if(!N){console.error("Joueur non trouvé:",b);return}if(!Oe.value.find(h=>h.id===v)){console.error("Événement non trouvé:",v);return}if(oo(N.id)){const h=Yo(N.id),m=K.value===N.id;console.log("Joueur protégé:",{playerId:N.id,hasCachedPassword:h,wasRecentlyVerified:m,recentlyVerifiedPlayer:K.value}),h||m?(console.log("Session active ou joueur récemment vérifié, procéder au toggle"),m&&(console.log("Nettoyage du flag recentlyVerifiedPlayer"),K.value=null),$n(N,v)):(console.log("Pas de session, affichage de la modal de vérification"),Z.value={playerName:b,eventId:v},$.value=N,A.value=!0);return}$n(N,v)}function $n(b,v){var l,h,m;const N=(l=Ot.value[b.name])==null?void 0:l[v];console.log(`toggleAvailability - ${b.name} pour ${v}:`,N);let J;N===!0?J=!1:N===!1?J=void 0:J=!0,J===void 0?Ot.value[b.name]&&delete Ot.value[b.name][v]:(Ot.value[b.name]||(Ot.value[b.name]={}),Ot.value[b.name][v]=J);try{typeof X<"u"&&X.value===1&&b.id===((h=fi.value[0])==null?void 0:h.id)&&v===((m=yr.value[0])==null?void 0:m.id)&&(X.value=2)}catch{}vy(b.name,Ot.value[b.name],o.value).then(async()=>{await Bn(),Qn(),Ne.value=!0,vt.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{Ne.value=!1},3e3)}).catch(y=>{console.error("Erreur lors de la mise à jour de la disponibilité:",y),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}function Dn(b,v){var N;return(N=Ot.value[b])==null?void 0:N[v]}function co(b,v){var l;const N=at.value[v]||[],J=(l=Ot.value[b])==null?void 0:l[v];return N.includes(b)&&J===!0}async function Vu(b,v=6){const N=Oe.value.find(m=>m.id===b),J=(N==null?void 0:N.playerCount)||6,l=at.value[b]||[];if(l.length>0&&l.every(m=>Dn(m,b))){console.log("Tous les joueurs sélectionnés sont disponibles, nouveau tirage complet");const y=Ke.value.filter(se=>Dn(se.name,b)).map(se=>{const Ce=Wn(se.name);return{name:se.name,weight:1/(1+Ce)}}),V=[],L=[...y];for(;V.length<J&&L.length>0;){const se=L.reduce((Se,Ue)=>Se+Ue.weight,0);let Ce=Math.random()*se;const Je=L.findIndex(Se=>(Ce-=Se.weight,Ce<=0));Je>=0&&(V.push(L[Je].name),L.splice(Je,1))}at.value[b]=V}else{const m=l.filter(V=>Dn(V,b)),y=J-m.length;if(y<=0)at.value[b]=m;else{const V=new Set(m),se=Ke.value.filter(Se=>Dn(Se.name,b)&&!V.has(Se.name)).map(Se=>{const Ue=Wn(Se.name);return{name:Se.name,weight:1/(1+Ue)}}),Ce=[],Je=[...se];for(;Ce.length<y&&Je.length>0;){const Se=Je.reduce((mn,Zt)=>mn+Zt.weight,0);let Ue=Math.random()*Se;const bt=Je.findIndex(mn=>(Ue-=mn.weight,Ue<=0));bt>=0&&(Ce.push(Je[bt].name),Je.splice(bt,1))}at.value[b]=[...m,...Ce]}}await _N(b,at.value[b],o.value),_s(),Qn()}async function pt(b,v=6){var m,y,V,L,se;console.log("tirerProtected appelé avec eventId:",b),console.log("showSelectionModal.value AVANT:",ae.value),console.log("selectionModalEvent.value?.id AVANT:",(m=ie.value)==null?void 0:m.id);const N=ae.value,J=(y=ie.value)==null?void 0:y.id,l=at.value[b]&&at.value[b].length>0,h=l?[...at.value[b]]:[];if(await Vu(b,v),console.log("showSelectionModal.value APRÈS tirage:",ae.value),console.log("selectionModalEvent.value?.id APRÈS tirage:",(V=ie.value)==null?void 0:V.id),N&&!ae.value&&(console.log("Restauration de la popin de sélection..."),ae.value=!0,ie.value=Oe.value.find(Ce=>Ce.id===J)),ae.value&&((L=ie.value)==null?void 0:L.id)===b)if(console.log("Popin de sélection ouverte, mise à jour..."),await Bn(),re.value&&re.value.showSuccess){console.log("Appel de showSuccess sur la popin de sélection");const Ce=at.value[b]||[],Je=h.filter(Ue=>Ce.includes(Ue)),Se=Je.length>0&&Je.length<h.length;re.value.showSuccess(l,Se)}else console.log("selectionModalRef.value:",re.value),console.log("showSuccess disponible:",(se=re.value)==null?void 0:se.showSuccess);else console.log("Popin de sélection fermée, affichage message global"),Ne.value=!0,Oe.value.find(Ce=>Ce.id===b),at.value[b],l?vt.value="Sélection mise à jour avec succès !":vt.value="Sélection effectuée avec succès !",setTimeout(()=>{Ne.value=!1},3e3)}function ho(b){var N;return b?(typeof b=="string"?new Date(b):((N=b.toDate)==null?void 0:N.call(b))||b).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function Mr(b){var N;return b?(typeof b=="string"?new Date(b):((N=b.toDate)==null?void 0:N.call(b))||b).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function Wn(b){return Object.values(at.value).filter(v=>v.includes(b)).length}function ja(b){const v=Ot.value[b]||{};return Object.values(v).filter(N=>N===!0).length}function pi(b){return b?Object.values(Ot.value).filter(v=>v[b]===!0).length:0}function Ba(b){return b?(at.value[b]||[]).length:0}function Nu(b){const v=Oe.value.find(J=>J.id===b),N=(v==null?void 0:v.playerCount)||6;return Ba(b)>=N}function rh(b){const v=ja(b),N=Wn(b);return v===0?0:N/v}function sh(b){Ua.value[b]={availability:ja(b),selection:Wn(b),ratio:rh(b)}}function _s(){Ke.value.forEach(b=>sh(b.name))}function Qn(){const b={};Oe.value.forEach(v=>{const N=v.playerCount||6,l=Ke.value.filter(m=>Dn(m.name,v.id)===!0).map(m=>{const y=Wn(m.name);return{name:m.name,weight:1/(1+y)}}),h=l.reduce((m,y)=>m+y.weight,0);l.forEach(m=>{const y=Math.min(1,m.weight/h*N);b[m.name]||(b[m.name]={}),b[m.name][v.id]=Math.round(y*100)})}),uo.value=b}const mi=O(null),gi=O(!1);async function Ou(b=null){const v=b||mi.value;if(!v){console.error("Aucun joueur à supprimer");return}try{await deletePlayer(v,o.value),Ke.value=Ke.value.filter(N=>N.id!==v),gi.value=!1,mi.value=null,Ne.value=!0,vt.value="Joueur supprimé avec succès !",setTimeout(()=>{Ne.value=!1},3e3)}catch(N){console.error("Erreur lors de la suppression du joueur :",N),alert("Erreur lors de la suppression du joueur. Veuillez réessayer.")}}function bs(){gi.value=!1,mi.value=null}async function ih(b){vo(),await Ui(b,o.value)?await lh({type:"deletePlayer",data:{playerId:b}}):await fo({type:"deletePlayer",data:{playerId:b}})}async function oh(){if(q.value){const b=Oe.value.find(N=>N.id===q.value),v=(b==null?void 0:b.playerCount)||6;await pt(q.value,v),j.value=!1,q.value=null}}function ah(){j.value=!1,q.value=null}function _r(){return P.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis",toggleArchive:"Archivage d'événement - Code PIN requis"}[P.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function fo(b){if(Nn.isPinCached(o.value)){const v=Nn.getCachedPin(o.value);if(console.log("PIN en cache trouvé, utilisation automatique"),await ed(o.value,v)){await Lr(b);return}else Nn.clearSession()}P.value=b,H.value=!0}async function lh(b){const v=b.data.playerId;if(Yo(v)){console.log("Mot de passe du joueur en cache trouvé, utilisation automatique"),await Lr(b);return}x.value=b,R.value=!0}async function po(b){try{if(await ed(o.value,b)){Nn.saveSession(o.value,b),H.value=!1;const N=P.value;P.value=null,await Lr(N)}else I.value="Code PIN incorrect",setTimeout(()=>{I.value=""},3e3)}catch(v){console.error("Erreur lors de la vérification du PIN:",v),I.value="Erreur lors de la vérification du code PIN"}}function mo(){H.value=!1,P.value=null,I.value=""}async function qa(b){if(b){w.value=!0,S.value="";try{const v=x.value.data.playerId,N=await Vf(o.value);if(b===N){try{ya.saveSession(x.value.data.playerId,b)}catch{}R.value=!1;const l=x.value;x.value=null,D.value="",await Lr(l);return}if(await verifyPlayerPassword(v,b,o.value)){R.value=!1;const l=x.value;x.value=null,D.value="",await Lr(l)}else S.value="Mot de passe incorrect",setTimeout(()=>{S.value=""},3e3)}catch(v){console.error("Erreur lors de la vérification du mot de passe:",v),S.value="Erreur lors de la vérification du mot de passe"}finally{w.value=!1}}}function vi(){R.value=!1,x.value=null,S.value="",D.value="",w.value=!1}async function ws(b){if(b){Ie.value=!0,$e.value="";try{const v=et.value.data.player,N=await Vf(o.value);if(b===N){try{ya.saveSession(et.value.data.player.id,b)}catch{}Fe.value=!1;const l=et.value;et.value=null,Ve.value="",await Lr(l);return}if(await verifyPlayerPassword(v.id,b,o.value)){Fe.value=!1;const l=et.value;et.value=null,Ve.value="",await Lr(l)}else $e.value="Mot de passe incorrect",setTimeout(()=>{$e.value=""},3e3)}catch(v){console.error("Erreur lors de la vérification du mot de passe:",v),$e.value="Erreur lors de la vérification du mot de passe"}finally{Ie.value=!1}}}function Mu(){Fe.value=!1,et.value=null,$e.value="",Ve.value="",Ie.value=!1}async function za(){_e.value=!0,Le.value="",dt.value="";try{const b=et.value.data.player,v=await sendPasswordResetEmail(b.id,o.value);dt.value=v.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(b){console.error("Erreur lors de l'envoi de l'email:",b),Le.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{_e.value=!1}}async function St(){Nt.value=!0,W.value="",ge.value="";try{const b=x.value.data.playerId,v=await sendPasswordResetEmail(b,o.value);ge.value=v.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(b){console.error("Erreur lors de l'envoi de l'email:",b),W.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{Nt.value=!1}}function uh(){return Nn.isPinCached(o.value)?{timeRemaining:Nn.getTimeRemaining(),isExpiringSoon:Nn.isExpiringSoon()}:null}async function Lr(b){if(!b)return;const{type:v,data:N}=b;try{switch(v){case"deleteEvent":console.log("executePendingOperation - data.eventId:",N.eventId),console.log("executePendingOperation - type de data.eventId:",typeof N.eventId),c.value=N.eventId,u.value=!0;break;case"addEvent":di.value=!0;break;case"deletePlayer":mi.value=N.playerId,gi.value=!0;break;case"launchSelection":at.value[N.eventId]&&at.value[N.eventId].length>0?(q.value=N.eventId,j.value=!0,he.value=!1):(await pt(N.eventId,N.count),he.value=!1);break;case"toggleAvailability":$n(N.player,N.eventId);break;case"toggleArchive":await setEventArchived(N.eventId,N.archived,o.value);{const J=Oe.value.findIndex(l=>l.id===N.eventId);J!==-1&&(Oe.value[J]={...Oe.value[J],archived:!!N.archived}),tt.value=!!N.archived}break}}catch(J){console.error("Erreur lors de l'exécution de l'opération:",J),Ne.value=!0,vt.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{Ne.value=!1},3e3)}}function Lu(){t.push("/")}Yf(()=>{const b=xn.value;b&&b.removeEventListener("scroll",cr),window.removeEventListener("resize",cr)});async function Ga(b){ne.value=b,je.value=b.description||"",tt.value=!!b.archived;try{const[v,N]=await Promise.all([ko(Ke.value,Oe.value,o.value),Do(o.value)]);Ot.value=v,at.value=N}catch(v){console.warn("Impossible de rafraîchir les données avant ouverture des détails:",v)}he.value=!0}function go(){he.value=!1,ne.value=null,je.value="",E.value=!1}function yi(){go(),r.params.eventId&&t.push(`/season/${e.slug}`)}async function Fu(b,v){console.log("handleAvailabilityToggle appelé avec:",{playerName:b,eventId:v});const N=Ke.value.find(l=>l.name===b);if(!N){console.error("Joueur non trouvé:",b);return}console.log("Joueur trouvé:",N);const J=oo(N.id);if(console.log("Joueur protégé:",J),J){Yo(N.id)?(console.log("Session active, procéder au toggle"),await Hn(b,v)):(console.log("Demande du mot de passe pour joueur protégé"),Z.value={playerName:b,eventId:v},$.value=N,A.value=!0);return}console.log("Joueur non protégé, procéder au toggle"),await Hn(b,v)}function tr(b,v){return(at.value[v]||[]).includes(b)}async function Uu(b){if(console.log("Mot de passe vérifié:",b),$.value&&(K.value=$.value.id,console.log("Joueur marqué comme récemment vérifié:",$.value.id)),Z.value){const{playerName:v,eventId:N}=Z.value;console.log("Exécution de l'action en attente:",{playerName:v,eventId:N}),await Hn(v,N),Z.value=null}else console.log("Aucune action en attente trouvée");A.value=!1,$.value=null}function $u(){d.value=ne.value.id,f.value=ne.value.title,g.value=ne.value.date,je.value=ne.value.description||"",_.value=ne.value.playerCount||6,he.value=!1}async function Is(){if(ne.value)try{const b=!ne.value.archived,v={...ne.value,archived:b};await yy(ne.value.id,v,o.value),ne.value.archived=b;const N=Oe.value.findIndex(J=>J.id===ne.value.id);N!==-1&&(Oe.value[N].archived=b),Ne.value=!0,vt.value=b?"Événement archivé avec succès !":"Événement désarchivé avec succès !",setTimeout(()=>{Ne.value=!1},3e3)}catch(b){console.error("Erreur lors de la modification de l'archivage:",b),alert("Erreur lors de la modification de l'archivage. Veuillez réessayer.")}}function Ka(b){z.value=b,U.value=!0;try{typeof X<"u"&&X.value===2&&(X.value=3,o.value&&localStorage.setItem(`playerTourCompleted:${o.value}`,"1"))}catch{}}function vo(){U.value=!1,z.value=null}async function yo({playerId:b,newName:v}){try{await updatePlayer(b,v,o.value),await Promise.all([Bh(o.value),ko(Ke.value,Oe.value,o.value),Do(o.value)]).then(([N,J,l])=>{if(Ke.value=N,Ot.value=J,at.value=l,pr(),z.value&&z.value.id===b){const h=N.find(m=>m.id===b);h&&(z.value=h)}}),Ne.value=!0,vt.value="Joueur mis à jour avec succès !",setTimeout(()=>{Ne.value=!1},3e3)}catch(N){console.error("Erreur lors de l'édition du joueur:",N),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function ju(){try{await Promise.all([Bh(o.value),ko(Ke.value,Oe.value,o.value),Do(o.value)]).then(([b,v,N])=>{if(Ke.value=b,Ot.value=v,at.value=N,pr(),z.value){const J=b.find(l=>l.id===z.value.id);J&&(z.value=J)}}),Ne.value=!0,vt.value="Données mises à jour !",setTimeout(()=>{Ne.value=!1},3e3)}catch(b){console.error("Erreur lors du rafraîchissement:",b)}}function _o(b){if(!b)return{availability:0,selection:0,ratio:0};const v=ja(b.name),N=Wn(b.name),J=v===0?0:Math.round(N/v*100);return{availability:v,selection:N,ratio:J}}function Ha(b){const v=at.value[b]||[],N=Oe.value.find(h=>h.id===b),J=(N==null?void 0:N.playerCount)||6,l=pi(b);if(v.length>0){const h=v.some(y=>!Dn(y,b)),m=l<J;if(h||m)return{type:"incomplete",hasUnavailablePlayers:h,hasInsufficientPlayers:m,unavailablePlayers:v.filter(y=>!Dn(y,b)),availableCount:l,requiredCount:J}}return l<J?{type:"insufficient",availableCount:l,requiredCount:J}:v.length===0?{type:"ready",availableCount:l,requiredCount:J}:{type:"complete",availableCount:l,requiredCount:J}}function Bu(b){const v=Ha(b);return v.type==="incomplete"||v.type==="insufficient"}function Es(b){const v=Ha(b);switch(v.type){case"incomplete":return v.hasUnavailablePlayers?v.unavailablePlayers.length===1?`Sélection incomplète : ${v.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${v.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${v.availableCount} joueurs disponibles pour ${v.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${v.availableCount} disponibles pour ${v.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${v.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${v.availableCount} joueurs disponibles`;default:return""}}async function qu({eventId:b,eventData:v,reason:N}){if(!o.value)return;const J={id:b,...v};if(J.archived){console.log("Événement archivé, aucune notification envoyée:",J.title),Ne.value=!0,vt.value="Aucune notification envoyée : événement archivé",setTimeout(()=>{Ne.value=!1},3e3);return}const l=[];for(const h of Ke.value){if(!await Ui(h.id,o.value))continue;const y=await bI(h.id,o.value);if(y)try{const V=await Nf({seasonId:o.value,playerId:h.id,eventId:J.id,action:"yes"}),L=await Nf({seasonId:o.value,playerId:h.id,eventId:J.id,action:"no"}),se=`${V.url}&slug=${encodeURIComponent(s)}`,Ce=`${L.url}&slug=${encodeURIComponent(s)}`;await IN({toEmail:y,playerName:h.name,eventTitle:J.title,eventDate:Mr(J.date),yesUrl:se,noUrl:Ce,reason:N})}catch(V){console.error("Email non envoyé pour",h.name,(V==null?void 0:V.message)||V),l.push(h.id)}}Ne.value=!0,vt.value=l.length>0?`Emails envoyés (avec ${l.length} échec(s))`:"Emails envoyés aux joueurs protégés.",setTimeout(()=>{Ne.value=!1},3e3)}function bo(b){if(b!=null&&b.archived){Ne.value=!0,vt.value="Impossible d'annoncer un événement archivé",setTimeout(()=>{Ne.value=!1},3e3);return}Io(),fe.value=b,Ee.value=!0}function wo(){Ee.value=!1,fe.value=null}function Io(){be.value=!1,Pe.value=null}async function Wa({eventId:b,eventData:v,reason:N,selectedPlayers:J}){try{N==="selection"?(await xN({eventId:b,eventData:v,selectedPlayers:J,seasonId:o.value,seasonSlug:s,players:jt.value}),Eo(),Ne.value=!0,vt.value="Notifications de sélection envoyées avec succès !",setTimeout(()=>{Ne.value=!1},3e3)):(await qu({eventId:b,eventData:v,reason:N}),wo(),Ne.value=!0,vt.value="Notifications envoyées avec succès !",setTimeout(()=>{Ne.value=!1},3e3))}catch(l){console.error("Erreur lors de l'envoi des notifications:",l),Ne.value=!0,vt.value="Erreur lors de l'envoi des notifications",setTimeout(()=>{Ne.value=!1},3e3)}}function _i(b){if(!b)return{};const v={};return Ke.value.forEach(N=>{v[N.name]=Dn(N.name,b)}),v}function bi(b){ie.value=b,ae.value=!0}function Eo(){ae.value=!1,ie.value=null}async function Fr(){if(!ie.value)return;const b=ie.value.id,v=ie.value.playerCount||6;if(pi(b)===0){Ne.value=!0,vt.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{Ne.value=!1},3e3);return}await fo({type:"launchSelection",data:{eventId:b,count:v}})}function zu(){Eo(),Ne.value=!0,vt.value="Sélection validée !",setTimeout(()=>{Ne.value=!1},3e3)}async function To(b,v){if(!b||!v)return;wi(),ft.value=b,er.value=!0,await Bn();const N=document.querySelector(`[data-event-id="${b}"]`);if(!N){console.warn("Élément événement non trouvé dans le DOM");return}document.querySelectorAll(".focused-event-highlight").forEach(m=>{m.classList.remove("focused-event-highlight")});const J=document.querySelectorAll(`[data-event-id="${b}"]`);J.forEach(m=>{m.classList.add("focused-event-highlight")});const l=J[0],h=J[J.length-1];l&&l.classList.add("focused-event-column-start"),h&&h.classList.add("focused-event-column-end"),await Gu(N),Ne.value=!0,vt.value=`Événement ciblé : ${v.title}`,setTimeout(()=>{Ne.value=!1},4e3),ur.value=setTimeout(()=>{wi()},8e3)}function Qa(b){if(!b)return;const v=Oe.value.find(N=>N.id===b);if(!v){console.warn(`Événement ${b} non trouvé dans la liste des événements`),setTimeout(()=>{const N=Oe.value.find(J=>J.id===b);N?To(b,N):console.error(`Événement ${b} toujours introuvable après retry`)},500);return}To(b,v)}async function Gu(b){if(!b)return;if(await new Promise(N=>setTimeout(N,100)),window.innerWidth<=768){const N=xn.value;if(N){const J=b.offsetLeft,l=b.offsetWidth,h=N.clientWidth,m=J-h/2+l/2,y=N.scrollWidth-h,V=Math.max(0,Math.min(m,y));N.scrollTo({left:V,behavior:"smooth"}),setTimeout(()=>{const L=b.getBoundingClientRect();if(L.left<0||L.right>window.innerWidth){const se=J-20;N.scrollTo({left:Math.max(0,se),behavior:"smooth"})}},500)}}else b.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const v=xn.value;v&&setTimeout(()=>{const N=document.querySelector(`[data-event-id="${ft.value}"]`);if(N&&N.closest("tbody")){const J=N.offsetLeft,l=N.offsetWidth,h=v.clientWidth,m=J-h/2+l/2,y=v.scrollWidth-h,V=Math.max(0,Math.min(m,y));v.scrollTo({left:V,behavior:"smooth"})}},300)}function wi(){ur.value&&(clearTimeout(ur.value),ur.value=null),ft.value=null,er.value=!1,document.querySelectorAll(".focused-event-highlight").forEach(b=>{b.classList.remove("focused-event-highlight")}),document.querySelectorAll(".focused-event-column-start, .focused-event-column-end").forEach(b=>{b.classList.remove("focused-event-column-start","focused-event-column-end")})}return(b,v)=>{var N,J,l,h,m,y,V,L,se,Ce,Je,Se,Ue,bt,mn,Zt,nr,xo,Sm,Rm;return F(),B(ut,null,[p("div",cM,[p("div",dM,[p("button",{onClick:Lu,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour à l'accueil"},v[60]||(v[60]=[p("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),p("h1",hM,le(i.value?i.value:"Chargement..."),1),p("div",fM,[p("button",{onClick:nh,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:ys.value?"Masquer les événements archivés":"Afficher les événements archivés"},[p("span",mM,le(ys.value?"📂":"📁"),1)],8,pM),p("button",{onClick:v[0]||(v[0]=Q=>Ae.value=!0),class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Comment ça marche ?","aria-label":"Comment ça marche ?"},v[61]||(v[61]=[p("span",{class:"text-2xl"},"❓",-1)]))])],512),p("div",gM,[p("div",{ref_key:"headerBarRef",ref:ai,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[p("div",vM,[Oe.value.length===0&&Ke.value.length===0?ce("",!0):(F(),B("div",yM,[p("div",{class:"flex items-center justify-center h-full gap-2"},[p("button",{onClick:Du,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel événement"},v[62]||(v[62]=[p("span",{class:"text-lg"},"➕",-1),p("span",{class:"hidden sm:inline"},"Ajouter un événement",-1),p("span",{class:"sm:hidden"},"Événement",-1)]))])])),p("div",_M,[p("div",{ref_key:"headerEventsRef",ref:cn,class:"flex relative z-[60]",style:Rl({transform:`translateX(-${io.value}px)`})},[(F(!0),B(ut,null,sr(yr.value,Q=>(F(),B("div",{key:"h-"+Q.id,"data-event-id":Q.id,class:"col-event flex-shrink-0 p-3 text-center cursor-pointer",onClick:en=>Ga(Q)},[p("div",{class:"header-date text-[16px] md:text-base text-gray-300",title:Mr(Q.date)},le(ho(Q.date)),9,wM),p("div",{class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2",title:Q.title},le(Q.title||"Sans titre"),9,IM),Q.archived?(F(),B("div",EM,"(Archivé)")):ce("",!0),Bu(Q.id)?(F(),B("div",{key:1,class:"mt-1 w-4 h-4 bg-yellow-500 rounded-full mx-auto flex items-center justify-center hover:bg-yellow-400 transition-colors duration-200",title:Es(Q.id)+" - Cliquez pour ouvrir la sélection",onClick:Bt(en=>bi(Q),["stop"])},v[63]||(v[63]=[p("span",{class:"text-xs text-white font-bold"},"⚠️",-1)]),8,TM)):Ha(Q.id).type==="ready"?(F(),B("div",{key:2,class:"mt-1 w-4 h-4 bg-green-500 rounded-full mx-auto flex items-center justify-center hover:bg-green-400 transition-colors duration-200",title:Es(Q.id)+" - Cliquez pour ouvrir la sélection",onClick:Bt(en=>bi(Q),["stop"])},v[64]||(v[64]=[p("span",{class:"text-xs text-white font-bold"},"🎲",-1)]),8,xM)):ce("",!0)],8,bM))),128))],4)]),v[65]||(v[65]=p("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),lt(p("button",{onClick:v[1]||(v[1]=Bt(Q=>rn(-1,Q),["prevent"])),onMousedown:v[2]||(v[2]=Bt(Q=>li(-1,Q),["prevent"])),onMouseup:v[3]||(v[3]=Q=>An(Q)),onMouseleave:v[4]||(v[4]=Q=>An(Q)),onTouchstart:v[5]||(v[5]=Bt(Q=>li(-1,Q),["prevent"])),onTouchend:v[6]||(v[6]=Q=>An(Q)),onTouchcancel:v[7]||(v[7]=Q=>An(Q)),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements précédents — cliquez pour défiler"}," ‹ ",544),[[yh,so.value]]),lt(p("button",{onClick:v[8]||(v[8]=Bt(Q=>rn(1,Q),["prevent"])),onMousedown:v[9]||(v[9]=Bt(Q=>li(1,Q),["prevent"])),onMouseup:v[10]||(v[10]=Q=>An(Q)),onMouseleave:v[11]||(v[11]=Q=>An(Q)),onTouchstart:v[12]||(v[12]=Bt(Q=>li(1,Q),["prevent"])),onTouchend:v[13]||(v[13]=Q=>An(Q)),onTouchcancel:v[14]||(v[14]=Q=>An(Q)),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements suivants — cliquez pour défiler"}," › ",544),[[yh,Na.value]])])],512),lt(p("div",{ref_key:"gridboardRef",ref:xn,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[p("table",AM,[p("colgroup",null,[v[66]||(v[66]=p("col",{class:"col-left"},null,-1)),(F(!0),B(ut,null,sr(yr.value,(Q,en)=>(F(),B("col",{key:"c"+en,class:"col-event"}))),128)),v[67]||(v[67]=p("col",{class:"col-right"},null,-1))]),v[71]||(v[71]=p("thead",{class:"hidden"},null,-1)),p("tbody",null,[(F(!0),B(ut,null,sr(fi.value,Q=>{var en;return F(),B("tr",{key:Q.id,class:qn(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":Q.id===k.value}]),"data-player-id":Q.id},[p("td",SM,[p("div",RM,[oo(Q.id)?(F(),B("span",CM," 🔒 ")):ce("",!0),p("span",{onClick:Ur=>Ka(Q),class:qn(["player-name hover:border-b-2 hover:border-dashed hover:border-purple-400 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight",{"inline-block rounded px-1 ring-2 ring-yellow-400 animate-pulse":X.value===2&&Q.id===((en=fi.value[0])==null?void 0:en.id)}]),title:"Cliquez pour voir les détails : "+Q.name},le(Q.name),11,kM)])]),(F(!0),B(ut,null,sr(yr.value,Ur=>{var Cm,km,Dm;return F(),B("td",{key:Ur.id,"data-event-id":Ur.id,class:qn(["p-0",{"relative ring-2 ring-pink-400 rounded-md animate-pulse":X.value===1&&Q.id===((Cm=fi.value[0])==null?void 0:Cm.id)&&Ur.id===((km=yr.value[0])==null?void 0:km.id)}])},[mt(by,{"player-name":Q.name,"event-id":Ur.id,"is-available":Dn(Q.name,Ur.id),"is-selected":co(Q.name,Ur.id),"chance-percent":((Dm=uo.value[Q.name])==null?void 0:Dm[Ur.id])??null,"show-selected-chance":Nu(Ur.id),onToggle:Hn},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance"])],10,DM)}),128)),v[68]||(v[68]=p("td",{class:"p-3 md:p-4"},null,-1))],10,PM)}),128)),!(Oe.value.length===0&&Ke.value.length===0)&&!(Oe.value.length>0&&Ke.value.length===0)?(F(),B("tr",VM,[p("td",NM,[p("div",OM,[p("button",{onClick:v[15]||(v[15]=Q=>C.value=!0),class:"w-full md:w-auto flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur"},v[69]||(v[69]=[p("span",{class:"text-lg"},"➕",-1),p("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),p("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(F(!0),B(ut,null,sr(yr.value,Q=>(F(),B("td",{key:"add-row-"+Q.id,"data-event-id":Q.id,class:"p-3 md:p-5"},null,8,MM))),128)),v[70]||(v[70]=p("td",{class:"p-3 md:p-4"},null,-1))])):ce("",!0)])])],512),[[yh,!Tt.value]])])]),Tt.value?(F(),B("div",LM,[p("div",FM,[v[72]||(v[72]=p("div",{class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"},[p("span",{class:"text-3xl"},"🎭")],-1)),p("p",UM,le(Wt.value)+"…",1),p("div",$M,[p("div",{class:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-300",style:Rl({width:ht.value+"%"})},null,4)]),p("p",jM,le(ht.value)+"%",1)])])):ce("",!0),Tt.value?ce("",!0):(F(),Sc(rM,{key:1,"season-id":o.value,"season-slug":Qr(s),"players-count":Ke.value.length,"events-count":Oe.value.length,"onboarding-done":((N=a.value)==null?void 0:N.onboardingCreatorDone)===!0,onCreateEvent:Du,onAddPlayer:v[16]||(v[16]=()=>{C.value=!0}),onCopyLink:Ma,onDismissed:Be},null,8,["season-id","season-slug","players-count","events-count","onboarding-done"])),Tt.value?ce("",!0):(F(),Sc(uM,{key:2,"season-id":o.value,"players-count":Ke.value.length,"events-count":Oe.value.length,"creator-onboarding-done":((J=a.value)==null?void 0:J.onboardingCreatorDone)===!0,onAddSelf:v[17]||(v[17]=()=>{C.value=!0}),onFocusAvailability:()=>{},onOpenProtection:v[18]||(v[18]=()=>{var Q,en;(en=(Q=Y.value)==null?void 0:Q.value)!=null&&en.openProtection&&Y.value.value.openProtection()}),onDone:()=>{}},null,8,["season-id","players-count","events-count","creator-onboarding-done"])),Ne.value?(F(),B("div",BM,[p("div",qM,[v[73]||(v[73]=p("span",{class:"text-xl"},"✨",-1)),p("span",null,le(vt.value),1)])])):ce("",!0),mr.value?(F(),B("div",zM,[p("div",GM,[v[74]||(v[74]=p("span",{class:"text-xl"},"⚠️",-1)),p("span",null,le(ao.value),1)])])):ce("",!0),di.value?(F(),B("div",KM,[p("div",HM,[v[80]||(v[80]=p("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvel événement",-1)),p("div",WM,[v[75]||(v[75]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),lt(p("input",{"onUpdate:modelValue":v[19]||(v[19]=Q=>Nr.value=Q),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'événement"},null,512),[[Rt,Nr.value]])]),p("div",QM,[v[76]||(v[76]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),lt(p("input",{"onUpdate:modelValue":v[20]||(v[20]=Q=>ms.value=Q),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[Rt,ms.value]])]),p("div",JM,[v[77]||(v[77]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),lt(p("textarea",{"onUpdate:modelValue":v[21]||(v[21]=Q=>vr.value=Q),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)"},null,512),[[Rt,vr.value]])]),p("div",YM,[lt(p("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":v[22]||(v[22]=Q=>vs.value=Q),class:"w-4 h-4"},null,512),[[ag,vs.value]]),v[78]||(v[78]=p("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Créer comme archivé",-1))]),p("div",XM,[v[79]||(v[79]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),lt(p("input",{"onUpdate:modelValue":v[23]||(v[23]=Q=>gs.value=Q),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[Rt,gs.value]])]),p("div",{class:"flex justify-end space-x-3"},[p("button",{onClick:Fa,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:hi,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):ce("",!0),C.value?(F(),B("div",ZM,[p("div",eL,[v[82]||(v[82]=p("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau joueur",-1)),p("div",tL,[v[81]||(v[81]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),lt(p("input",{"onUpdate:modelValue":v[24]||(v[24]=Q=>T.value=Q),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[Rt,T.value]])]),p("div",nL,[p("button",{onClick:v[25]||(v[25]=Q=>C.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:La,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):ce("",!0),u.value?(F(),B("div",rL,[p("div",sL,[v[83]||(v[83]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cet événement ?</p></div>',1)),p("div",iL,[p("button",{onClick:ku,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:v[26]||(v[26]=()=>gr()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ce("",!0),gi.value?(F(),B("div",oL,[p("div",aL,[v[84]||(v[84]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce joueur ?</p></div>',1)),p("div",lL,[p("button",{onClick:bs,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),p("button",{onClick:v[27]||(v[27]=()=>Ou()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):ce("",!0),j.value?(F(),B("div",uL,[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},[v[85]||(v[85]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🎭</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.</p></div><p class="mb-6 text-sm text-yellow-400 bg-yellow-900/20 p-3 rounded-lg border border-yellow-500/20"> ⚠️ Pensez à prévenir les gens du changement ! </p>',2)),p("div",{class:"flex justify-end space-x-3"},[p("button",{onClick:ah,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),p("button",{onClick:oh,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):ce("",!0),he.value?(F(),B("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:go},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:v[37]||(v[37]=Bt(()=>{},["stop"]))},[p("div",cL,[p("button",{onClick:go,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),v[86]||(v[86]=p("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[p("span",{class:"text-2xl md:text-3xl"},"🎭")],-1)),p("h2",dL,le((l=ne.value)==null?void 0:l.title),1),p("p",hL,le(Mr((h=ne.value)==null?void 0:h.date)),1)]),p("div",fL,[(m=ne.value)!=null&&m.description?(F(),B("div",pL,[p("p",mL,le(ne.value.description),1)])):ce("",!0),p("div",gL,[p("div",vL,[p("div",yL,le(pi((y=ne.value)==null?void 0:y.id)),1),v[87]||(v[87]=p("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),p("div",_L,[p("div",bL,le(Ba((V=ne.value)==null?void 0:V.id)),1),v[88]||(v[88]=p("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),p("div",wL,[p("div",IL,le(((L=ne.value)==null?void 0:L.playerCount)||6),1),v[89]||(v[89]=p("div",{class:"text-xs md:text-sm text-gray-300"},"À sélectionner",-1))])]),ne.value?(F(),B("div",EL,[v[91]||(v[91]=p("h3",{class:"text-lg font-semibold text-white mb-3"},"Disponibilités des joueurs",-1)),p("div",TL,[v[90]||(v[90]=p("div",{class:"grid grid-cols-12 gap-0 bg-gray-700 border-b border-gray-600"},[p("div",{class:"col-span-4 p-3 font-medium text-gray-300"},"Joueur"),p("div",{class:"col-span-8 p-3 font-medium text-gray-300 text-center"},"Disponibilité")],-1)),(F(!0),B(ut,null,sr(fi.value,Q=>{var en;return F(),B("div",{key:Q.id,class:"grid grid-cols-12 gap-0 border-b border-gray-600 last:border-b-0 hover:bg-gray-700/50 transition-colors"},[p("div",xL,[p("span",AL,le(Q.name),1),oo(Q.id)?(F(),B("span",PL,"🔒")):ce("",!0)]),p("div",SL,[mt(by,{"player-name":Q.name,"event-id":ne.value.id,"is-available":_i(ne.value.id)[Q.name],"is-selected":tr(Q.name,ne.value.id),"chance-percent":((en=uo.value[Q.name])==null?void 0:en[ne.value.id])??null,"show-selected-chance":Nu(ne.value.id),onToggle:Fu},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance"])])])}),128))])])):ce("",!0),p("div",RL,[p("button",{onClick:$u,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},v[92]||(v[92]=[p("span",null,"✏️",-1),p("span",null,"Modifier",-1)])),p("button",{onClick:v[28]||(v[28]=Q=>bo(ne.value)),disabled:(se=ne.value)==null?void 0:se.archived,class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(Ce=ne.value)!=null&&Ce.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},v[93]||(v[93]=[p("span",null,"📢",-1),p("span",null,"Annoncer",-1)]),8,CL),p("button",{onClick:Is,class:"px-5 py-3 bg-gradient-to-r from-indigo-500 to-blue-600 text-white rounded-lg hover:from-indigo-600 hover:to-blue-700 transition-all duration-300 flex items-center gap-2",title:(Je=ne.value)!=null&&Je.archived?"Désarchiver cet événement":"Archiver cet événement"},[p("span",null,le((Se=ne.value)!=null&&Se.archived?"📂":"📁"),1),p("span",null,le((Ue=ne.value)!=null&&Ue.archived?"Désarchiver":"Archiver"),1)],8,kL),p("button",{onClick:v[29]||(v[29]=Q=>bi(ne.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},v[94]||(v[94]=[p("span",null,"🎭",-1),p("span",null,"Sélectionner",-1)])),p("button",{onClick:v[30]||(v[30]=Q=>{var en;return ci((en=ne.value)==null?void 0:en.id)}),class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},v[95]||(v[95]=[p("span",null,"🗑️",-1),p("span",null,"Supprimer",-1)])),p("button",{onClick:yi,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")]),E.value?(F(),B("div",DL,[p("button",{onClick:v[31]||(v[31]=Q=>{$u(),E.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"},"✏️ Modifier"),p("button",{onClick:v[32]||(v[32]=Q=>{bo(ne.value),E.value=!1}),disabled:(bt=ne.value)==null?void 0:bt.archived,class:"w-full px-4 py-3 rounded-lg bg-amber-600/20 text-amber-200 border border-amber-500/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(mn=ne.value)!=null&&mn.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},v[96]||(v[96]=[p("span",null,"📢",-1),p("span",null,"Annoncer",-1)]),8,VL),p("button",{onClick:v[33]||(v[33]=Q=>{Is(),E.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-indigo-600/20 text-indigo-200 border border-indigo-500/30"},le((Zt=ne.value)!=null&&Zt.archived?"📂 Désarchiver":"📁 Archiver"),1),p("button",{onClick:v[34]||(v[34]=Q=>{var en;ci((en=ne.value)==null?void 0:en.id),E.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"},"🗑️ Supprimer")])):ce("",!0)]),p("div",NL,[p("button",{onClick:v[35]||(v[35]=Q=>bi(ne.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélectionner"),p("button",{onClick:yi,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),p("button",{onClick:v[36]||(v[36]=Q=>E.value=!E.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):ce("",!0),mt(xI,{show:A.value,player:$.value,seasonId:o.value,onClose:v[38]||(v[38]=Q=>A.value=!1),onVerified:Uu},null,8,["show","player","seasonId"]),d.value?(F(),B("div",OL,[p("div",ML,[v[102]||(v[102]=p("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier l'événement",-1)),p("div",LL,[v[97]||(v[97]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),lt(p("input",{"onUpdate:modelValue":v[39]||(v[39]=Q=>f.value=Q),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[vn(Vr,["esc"]),vn(lo,["enter"])],ref:"editTitleInput"},null,544),[[Rt,f.value]])]),p("div",FL,[v[98]||(v[98]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),lt(p("input",{"onUpdate:modelValue":v[40]||(v[40]=Q=>g.value=Q),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[vn(Vr,["esc"]),vn(lo,["enter"])]},null,544),[[Rt,g.value]])]),p("div",UL,[v[99]||(v[99]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),lt(p("textarea",{"onUpdate:modelValue":v[41]||(v[41]=Q=>je.value=Q),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)",onKeydown:vn(Vr,["esc"])},null,544),[[Rt,je.value]])]),p("div",$L,[lt(p("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":v[42]||(v[42]=Q=>tt.value=Q),class:"w-4 h-4"},null,512),[[ag,tt.value]]),v[100]||(v[100]=p("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver cet événement",-1))]),p("div",jL,[v[101]||(v[101]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),lt(p("input",{"onUpdate:modelValue":v[43]||(v[43]=Q=>_.value=Q),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:vn(Vr,["esc"])},null,544),[[Rt,_.value]])]),p("div",{class:"flex justify-end space-x-3"},[p("button",{onClick:Vr,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:lo,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ce("",!0),mt(dI,{show:H.value,message:_r(),error:I.value,"session-info":uh(),onSubmit:po,onCancel:mo},null,8,["show","message","error","session-info"]),R.value?(F(),B("div",BL,[p("div",qL,[v[104]||(v[104]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protégé par mot de passe</p></div>',1)),p("div",zL,[p("div",GL,[p("div",null,[v[103]||(v[103]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),lt(p("input",{"onUpdate:modelValue":v[44]||(v[44]=Q=>D.value=Q),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:v[45]||(v[45]=vn(Q=>qa(D.value),["enter"])),ref_key:"playerPasswordInputRef",ref:He},null,544),[[Rt,D.value]])])]),p("button",{onClick:v[46]||(v[46]=Q=>qa(D.value)),disabled:!D.value||w.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[w.value?(F(),B("span",HL,"⏳")):(F(),B("span",WL,"🔓")),p("span",null,le(w.value?"Vérification...":"Vérifier et supprimer"),1)],8,KL)]),p("div",QL,[p("button",{onClick:v[47]||(v[47]=Q=>$t.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),S.value?(F(),B("div",JL,[p("div",YL,le(S.value),1)])):ce("",!0),p("div",{class:"flex justify-center"},[p("button",{onClick:vi,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ce("",!0),Fe.value?(F(),B("div",XL,[p("div",ZL,[v[107]||(v[107]=rr('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protégé par mot de passe</p></div>',1)),p("div",eF,[p("div",tF,[p("div",null,[v[105]||(v[105]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),lt(p("input",{"onUpdate:modelValue":v[48]||(v[48]=Q=>Ve.value=Q),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:v[49]||(v[49]=vn(Q=>ws(Ve.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:oe},null,544),[[Rt,Ve.value]])])]),p("div",nF,[p("button",{onClick:v[50]||(v[50]=Q=>Re.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),$e.value?(F(),B("div",rF,[p("div",sF,le($e.value),1)])):ce("",!0)]),p("div",iF,[p("button",{onClick:Mu,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),p("button",{onClick:v[51]||(v[51]=Q=>ws(Ve.value)),disabled:!Ve.value||Ie.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[Ie.value?(F(),B("span",aF,"⏳")):(F(),B("span",lF,"🔓")),p("span",null,[Rn(le(Ie.value?"Vérification...":"Vérifier"),1),v[106]||(v[106]=p("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,oF)])])])):ce("",!0),Re.value?(F(),B("div",{key:14,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:v[54]||(v[54]=Q=>Re.value=!1)},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:v[53]||(v[53]=Bt(()=>{},["stop"]))},[v[109]||(v[109]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),p("div",uF,[v[108]||(v[108]=p("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),p("button",{onClick:za,disabled:_e.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[_e.value?(F(),B("span",dF,"⏳")):(F(),B("span",hF,"📧")),p("span",null,le(_e.value?"Envoi...":"Envoyer l'email"),1)],8,cF)]),Le.value?(F(),B("div",fF,[p("div",pF,le(Le.value),1)])):ce("",!0),dt.value?(F(),B("div",mF,[p("div",gF,le(dt.value),1)])):ce("",!0),p("div",vF,[p("button",{onClick:v[52]||(v[52]=Q=>Re.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0),$t.value?(F(),B("div",{key:15,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:v[57]||(v[57]=Q=>$t.value=!1)},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:v[56]||(v[56]=Bt(()=>{},["stop"]))},[v[111]||(v[111]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p></div>',1)),p("div",yF,[v[110]||(v[110]=p("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),p("button",{onClick:St,disabled:Nt.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[Nt.value?(F(),B("span",bF,"⏳")):(F(),B("span",wF,"📧")),p("span",null,le(Nt.value?"Envoi...":"Envoyer l'email"),1)],8,_F)]),W.value?(F(),B("div",IF,[p("div",EF,le(W.value),1)])):ce("",!0),ge.value?(F(),B("div",TF,[p("div",xF,le(ge.value),1)])):ce("",!0),p("div",AF,[p("button",{onClick:v[55]||(v[55]=Q=>$t.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0),mt(pO,{ref_key:"playerModalRef",ref:Y,show:U.value,player:z.value,stats:_o(z.value),seasonId:o.value,onClose:vo,onUpdate:yo,onDelete:ih,onRefresh:ju},null,8,["show","player","stats","seasonId"]),mt(zO,{ref_key:"selectionModalRef",ref:re,show:ae.value,event:ie.value,"current-selection":at.value[(nr=ie.value)==null?void 0:nr.id]||[],"available-count":pi((xo=ie.value)==null?void 0:xo.id),"selected-count":Ba((Sm=ie.value)==null?void 0:Sm.id),"player-availability":_i((Rm=ie.value)==null?void 0:Rm.id),"season-id":o.value,"season-slug":Qr(s),players:jt.value,onClose:Eo,onSelection:Fr,onPerfect:zu,onSendEmailNotifications:Wa},null,8,["show","event","current-selection","available-count","selected-count","player-availability","season-id","season-slug","players"]),mt(TI,{show:Ee.value,event:fe.value,"season-id":o.value,"season-slug":Qr(s),players:jt.value,onClose:wo,onSendEmailNotifications:Wa},null,8,["show","event","season-id","season-slug","players"]),mt(hI,{show:Ae.value,onClose:v[58]||(v[58]=Q=>Ae.value=!1)},null,8,["show"]),be.value?(F(),B("div",PF,[p("div",SF,[v[112]||(v[112]=p("h3",{class:"text-xl font-bold text-white mb-4 text-center"},"Voulez-vous annoncer cet événement ?",-1)),v[113]||(v[113]=p("p",{class:"text-gray-300 text-center mb-6"},"Envoyer des notifications aux joueurs pour qu'ils indiquent leur disponibilité",-1)),p("div",RF,[p("button",{onClick:v[59]||(v[59]=Q=>bo(Pe.value)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300"}," 📢 Oui "),p("button",{onClick:Io,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300"}," Plus tard ")])])])):ce("",!0)],64)}}},CF={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},kF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},DF={key:0,class:"text-center py-8"},VF={key:1,class:"text-center py-8"},NF={class:"text-gray-300 mb-6"},OF={key:2,class:"space-y-6"},MF={class:"text-center"},LF={class:"text-gray-300"},FF={class:"font-semibold text-white"},UF={class:"space-y-4"},$F=["disabled"],jF={key:0,class:"animate-spin"},BF={key:1},qF={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},zF={class:"text-red-300 text-sm"},GF={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},KF={class:"text-green-300 text-sm"},HF={__name:"PasswordReset",setup(n){const e=iu(),t=su(),r=O(!0),s=O(""),i=O(""),o=O(""),a=O(""),u=O(""),c=O(!1),d=O(""),f=O(""),g=We(()=>a.value&&u.value&&a.value===u.value&&a.value.length>=6);Gs(async()=>{try{const{oobCode:T}=e.query;if(console.log("🔍 [DEBUG] Token reçu:",T),!T){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=T,i.value="patrice.lamarque+ron@gmail.com",r.value=!1}catch(T){console.error("Erreur lors de la vérification du lien:",T),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function _(){if(g.value){c.value=!0,d.value="",f.value="";try{console.log("🔍 [DEBUG] Début réinitialisation avec token:",o.value),await Ik(ro,o.value,a.value),console.log("🔍 [DEBUG] Mot de passe Firebase Auth mis à jour"),console.log("🔍 [DEBUG] Réinitialisation terminée avec Firebase Auth"),f.value="Mot de passe réinitialisé avec succès ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{C()},3e3)}catch(T){console.error("❌ [ERROR] Erreur lors de la réinitialisation:",T),T.code==="auth/weak-password"?d.value="Le mot de passe doit contenir au moins 6 caractères":T.code==="auth/invalid-action-code"?d.value="Lien de réinitialisation invalide ou expiré":d.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{c.value=!1}}}function C(){t.push("/")}return(T,k)=>(F(),B("div",CF,[p("div",kF,[k[8]||(k[8]=rr('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(F(),B("div",DF,k[2]||(k[2]=[p("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),p("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(F(),B("div",VF,[k[3]||(k[3]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"❌")],-1)),k[4]||(k[4]=p("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),p("p",NF,le(s.value),1),p("button",{onClick:C,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):i.value?(F(),B("div",OF,[p("div",MF,[p("p",LF,[k[5]||(k[5]=Rn("Email : ")),p("span",FF,le(i.value),1)])]),p("div",UF,[p("div",null,[k[6]||(k[6]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),lt(p("input",{"onUpdate:modelValue":k[0]||(k[0]=j=>a.value=j),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:vn(_,["enter"])},null,544),[[Rt,a.value]])]),p("div",null,[k[7]||(k[7]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),lt(p("input",{"onUpdate:modelValue":k[1]||(k[1]=j=>u.value=j),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:vn(_,["enter"])},null,544),[[Rt,u.value]])])]),p("button",{onClick:_,disabled:!g.value||c.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[c.value?(F(),B("span",jF,"⏳")):(F(),B("span",BF,"🔑")),p("span",null,le(c.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,$F),d.value?(F(),B("div",qF,[p("div",zF,le(d.value),1)])):ce("",!0),f.value?(F(),B("div",GF,[p("div",KF,le(f.value),1)])):ce("",!0)])):ce("",!0)])]))}},WF={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},QF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},JF={class:"text-3xl"},YF={class:"text-2xl font-bold text-white mb-2"},XF={class:"text-gray-300 mb-6"},ZF={__name:"MagicLink",setup(n){const e=iu(),t=su(),r=O("loading"),s=O("Traitement en cours..."),i=O("Merci de patienter pendant la validation du lien."),o=We(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const u=e.query.slug;u?t.push(`/season/${u}`):t.push("/")}return Gs(async()=>{try{II("firebase");const u=String(e.query.sid||""),c=String(e.query.pid||"");let d=String(e.query.eid||"");const f=String(e.query.t||""),g=String(e.query.a||""),_=String(e.query.slug||"");if(!u||!c||!f||!g){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants.";return}if(g==="verify_email"&&(d="protection"),!(await mI({seasonId:u,playerId:c,eventId:d,token:f,action:g})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}if(g==="verify_email"){await yI({playerId:c,seasonId:u}),await Of({seasonId:u,playerId:c,eventId:"protection",action:g}),r.value="ok",s.value="Email vérifié",i.value="Merci ! Vous pouvez maintenant définir votre mot de passe.",setTimeout(_?()=>t.push(`/season/${_}?player=${encodeURIComponent(c)}&open=protection&verified=1`):()=>t.push("/"),800);return}const T=De(ve,"seasons",u,"players",c),k=await ds(T),j=k.exists()&&k.data().name||"";if(!j){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}await yN({seasonId:u,playerName:j,eventId:d,value:g==="yes"}),await Of({seasonId:u,playerId:c,eventId:d,action:g}),r.value="ok",s.value="Merci !",i.value=g==="yes"?"Votre disponibilité a été enregistrée: Disponible.":"Votre disponibilité a été enregistrée: Non disponible.",setTimeout(_?()=>t.push(`/season/${_}/event/${d}`):()=>t.push("/"),1200)}catch(u){console.error("Magic link error:",u),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(u,c)=>(F(),B("div",WF,[p("div",QF,[p("div",{class:qn(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[p("span",JF,le(o.value),1)],2),p("h1",YF,le(s.value),1),p("p",XF,le(i.value),1),p("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},e4={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},t4={class:"text-center py-12 px-4"},n4={class:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},r4={class:"container mx-auto px-4 pb-16"},s4={class:"max-w-xl mx-auto bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl"},i4={class:"space-y-5"},o4=["onKeydown"],a4={class:"flex items-center justify-end gap-3 pt-2"},l4=["disabled"],u4={key:0,class:"mt-6 text-sm text-gray-200"},c4={__name:"JoinSeason",setup(n){const e=iu(),t=su(),r=e.params.slug,s=O(""),i=O(""),o=O(""),a=O(!1),u=O("");Gs(async()=>{const f=Fd(nt(ve,"seasons"),nm("slug","==",r)),g=await Vt(f);if(g.empty)u.value="Saison introuvable";else{const _=g.docs[0];s.value=_.id,i.value=_.data().name,document.title=`Rejoindre : ${i.value}`}});function c(){t.push(`/season/${r}`)}async function d(){if(!(!o.value.trim()||!s.value)){a.value=!0,u.value="";try{await EI(o.value.trim(),s.value),u.value="Inscription réussie. Vous pouvez maintenant indiquer vos disponibilités.";try{localStorage.setItem(`startPlayerTour:${s.value}`,"1"),localStorage.setItem(`dismissCreatorOnboarding:${s.value}`,"1")}catch{}setTimeout(()=>{c()},600)}catch(f){console.error("Erreur inscription:",f),u.value=`Erreur lors de l'inscription: ${(f==null?void 0:f.message)||"Veuillez réessayer"}`}finally{a.value=!1}}}return(f,g)=>(F(),B("div",e4,[p("div",t4,[p("h1",n4,le(i.value||"Rejoindre la saison"),1),g[1]||(g[1]=p("p",{class:"text-gray-300"},"Inscrivez-vous pour indiquer vos disponibilités aux événements",-1))]),p("div",r4,[p("div",s4,[g[3]||(g[3]=p("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Je rejoins la saison",-1)),p("div",i4,[p("div",null,[g[2]||(g[2]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Votre nom",-1)),lt(p("input",{"onUpdate:modelValue":g[0]||(g[0]=_=>o.value=_),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: Marie Dupont",onKeydown:vn(Bt(d,["prevent"]),["enter"])},null,40,o4),[[Rt,o.value]])]),p("div",a4,[p("button",{onClick:c,class:"px-5 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),p("button",{disabled:!o.value.trim()||a.value,onClick:d,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Rejoindre ",8,l4)])]),u.value?(F(),B("div",u4,le(u.value),1)):ce("",!0)])])]))}},d4=[{path:"/",component:aN},{path:"/season/:slug",component:wy,props:!0},{path:"/season/:slug/event/:eventId",component:wy,props:!0},{path:"/season/:slug/join",component:c4,props:!0},{path:"/reset-password",component:HF},{path:"/magic",component:ZF}],h4=Jx({history:xx("/"),routes:d4});GT(WT).use(h4).mount("#app");export{nt as $,vw as A,Qi as B,Sr as C,Ht as D,vU as E,Yi as F,Hp as G,gU as H,v4 as I,Xn as J,U1 as K,j1 as L,qd as M,q4 as N,z4 as O,hC as P,pn as Q,N4 as R,I4 as S,Mt as T,lU as U,Vd as V,uC as W,aU as X,B4 as Y,x4 as Z,a0 as _,Kl as a,Pu as a$,b4 as a0,$1 as a1,X1 as a2,mU as a3,Qc as a4,oU as a5,S4 as a6,pU as a7,De as a8,D4 as a9,k4 as aA,J4 as aB,Y4 as aC,V4 as aD,J1 as aE,nU as aF,rU as aG,aC as aH,Fd as aI,rw as aJ,w4 as aK,iU as aL,Eu as aM,wn as aN,dU as aO,f4 as aP,G4 as aQ,F4 as aR,L4 as aS,j4 as aT,R4 as aU,wu as aV,cU as aW,A4 as aX,nm as aY,dC as aZ,EU as a_,q1 as aa,T4 as ab,P4 as ac,fU as ad,$4 as ae,U4 as af,Lt as ag,Iu as ah,eC as ai,X4 as aj,ds as ak,K4 as al,H4 as am,Vt as an,W4 as ao,Q4 as ap,B1 as aq,hU as ar,uU as as,E4 as at,O4 as au,M4 as av,C4 as aw,Z4 as ax,tU as ay,eU as az,z1 as b,vk as b$,Au as b0,xU as b1,Xl as b2,to as b3,Ns as b4,_U as b5,Ms as b6,Os as b7,ss as b8,bc as b9,xC as bA,JU as bB,u3 as bC,ey as bD,tD as bE,KC as bF,BU as bG,VU as bH,yk as bI,e3 as bJ,i3 as bK,l3 as bL,YU as bM,zU as bN,Nk as bO,PU as bP,pC as bQ,_k as bR,t3 as bS,s3 as bT,a3 as bU,SC as bV,WU as bW,MU as bX,wk as bY,DU as bZ,jU as b_,IU as ba,Fi as bb,Jo as bc,sV as bd,bU as be,XU as bf,kf as bg,wU as bh,iV as bi,xm as bj,Ls as bk,CU as bl,Ok as bm,qk as bn,rV as bo,Xw as bp,Ek as bq,Ik as br,WC as bs,Tk as bt,TU as bu,QU as bv,OU as bw,$U as bx,hV as by,AU as bz,ga as c,pm as c0,RU as c1,xk as c2,NU as c3,ZU as c4,r3 as c5,o3 as c6,HU as c7,SU as c8,KU as c9,UU as ca,Sk as cb,n3 as cc,FU as cd,GU as ce,qU as cf,LU as cg,kU as ch,Xi as d,_t as e,te as f,Ca as g,_u as h,vc as i,jd as j,bu as k,Ud as l,rm as m,va as n,$d as o,Vi as p,cC as q,Ft as r,ji as s,me as t,m4 as u,DP as v,kt as w,yU as x,Qe as y,p4 as z};
