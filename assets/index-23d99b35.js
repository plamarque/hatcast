(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function tp(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const Et={},Zo=[],br=()=>{},KI=()=>!1,Ed=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),np=n=>n.startsWith("onUpdate:"),bn=Object.assign,rp=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},HI=Object.prototype.hasOwnProperty,mt=(n,e)=>HI.call(n,e),Ue=Array.isArray,ea=n=>pu(n)==="[object Map]",Td=n=>pu(n)==="[object Set]",Jm=n=>pu(n)==="[object Date]",He=n=>typeof n=="function",on=n=>typeof n=="string",Fr=n=>typeof n=="symbol",Rt=n=>n!==null&&typeof n=="object",Uy=n=>(Rt(n)||He(n))&&He(n.then)&&He(n.catch),$y=Object.prototype.toString,pu=n=>$y.call(n),WI=n=>pu(n).slice(8,-1),jy=n=>pu(n)==="[object Object]",sp=n=>on(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,xl=tp(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),xd=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},QI=/-(\w)/g,ur=xd(n=>n.replace(QI,(e,t)=>t?t.toUpperCase():"")),JI=/\B([A-Z])/g,vi=xd(n=>n.replace(JI,"-$1").toLowerCase()),Ad=xd(n=>n.charAt(0).toUpperCase()+n.slice(1)),Sh=xd(n=>n?`on${Ad(n)}`:""),ni=(n,e)=>!Object.is(n,e),Sc=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},af=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},lf=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let Ym;const Sd=()=>Ym||(Ym=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Hs(n){if(Ue(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=on(r)?eE(r):Hs(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(on(n)||Rt(n))return n}const YI=/;(?![^(]*\))/g,XI=/:([^]+)/,ZI=/\/\*[^]*?\*\//g;function eE(n){const e={};return n.replace(ZI,"").split(YI).forEach(t=>{if(t){const r=t.split(XI);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function Hn(n){let e="";if(on(n))e=n;else if(Ue(n))for(let t=0;t<n.length;t++){const r=Hn(n[t]);r&&(e+=r+" ")}else if(Rt(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const tE="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",nE=tp(tE);function By(n){return!!n||n===""}function rE(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=Pd(n[r],e[r]);return t}function Pd(n,e){if(n===e)return!0;let t=Jm(n),r=Jm(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=Fr(n),r=Fr(e),t||r)return n===e;if(t=Ue(n),r=Ue(e),t||r)return t&&r?rE(n,e):!1;if(t=Rt(n),r=Rt(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!Pd(n[o],e[o]))return!1}}return String(n)===String(e)}function qy(n,e){return n.findIndex(t=>Pd(t,e))}const zy=n=>!!(n&&n.__v_isRef===!0),le=n=>on(n)?n:n==null?"":Ue(n)||Rt(n)&&(n.toString===$y||!He(n.toString))?zy(n)?le(n.value):JSON.stringify(n,Gy,2):String(n),Gy=(n,e)=>zy(e)?Gy(n,e.value):ea(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[Ph(r,i)+" =>"]=s,t),{})}:Td(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>Ph(t))}:Fr(e)?Ph(e):Rt(e)&&!Ue(e)&&!jy(e)?String(e):e,Ph=(n,e="")=>{var t;return Fr(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Gn;class sE{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Gn,!e&&Gn&&(this.index=(Gn.scopes||(Gn.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=Gn;try{return Gn=this,e()}finally{Gn=t}}}on(){++this._on===1&&(this.prevScope=Gn,Gn=this)}off(){this._on>0&&--this._on===0&&(Gn=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function iE(){return Gn}let At;const Rh=new WeakSet;class Ky{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Gn&&Gn.active&&Gn.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Rh.has(this)&&(Rh.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Wy(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Xm(this),Qy(this);const e=At,t=wr;At=this,wr=!0;try{return this.fn()}finally{Jy(this),At=e,wr=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)ap(e);this.deps=this.depsTail=void 0,Xm(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Rh.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){uf(this)&&this.run()}get dirty(){return uf(this)}}let Hy=0,Al,Sl;function Wy(n,e=!1){if(n.flags|=8,e){n.next=Sl,Sl=n;return}n.next=Al,Al=n}function ip(){Hy++}function op(){if(--Hy>0)return;if(Sl){let e=Sl;for(Sl=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;Al;){let e=Al;for(Al=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function Qy(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function Jy(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),ap(r),oE(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function uf(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(Yy(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function Yy(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===jl)||(n.globalVersion=jl,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!uf(n))))return;n.flags|=2;const e=n.dep,t=At,r=wr;At=n,wr=!0;try{Qy(n);const s=n.fn(n._value);(e.version===0||ni(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{At=t,wr=r,Jy(n),n.flags&=-3}}function ap(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)ap(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function oE(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let wr=!0;const Xy=[];function ps(){Xy.push(wr),wr=!1}function ms(){const n=Xy.pop();wr=n===void 0?!0:n}function Xm(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=At;At=void 0;try{e()}finally{At=t}}}let jl=0;class aE{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class lp{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!At||!wr||At===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==At)t=this.activeLink=new aE(At,this),At.deps?(t.prevDep=At.depsTail,At.depsTail.nextDep=t,At.depsTail=t):At.deps=At.depsTail=t,Zy(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=At.depsTail,t.nextDep=void 0,At.depsTail.nextDep=t,At.depsTail=t,At.deps===t&&(At.deps=r)}return t}trigger(e){this.version++,jl++,this.notify(e)}notify(e){ip();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{op()}}}function Zy(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)Zy(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const cf=new WeakMap,Wi=Symbol(""),df=Symbol(""),Bl=Symbol("");function Dn(n,e,t){if(wr&&At){let r=cf.get(n);r||cf.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new lp),s.map=r,s.key=t),s.track()}}function os(n,e,t,r,s,i){const o=cf.get(n);if(!o){jl++;return}const a=l=>{l&&l.trigger()};if(ip(),e==="clear")o.forEach(a);else{const l=Ue(n),c=l&&sp(t);if(l&&t==="length"){const d=Number(r);o.forEach((f,v)=>{(v==="length"||v===Bl||!Fr(v)&&v>=d)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(Bl)),e){case"add":l?c&&a(o.get("length")):(a(o.get(Wi)),ea(n)&&a(o.get(df)));break;case"delete":l||(a(o.get(Wi)),ea(n)&&a(o.get(df)));break;case"set":ea(n)&&a(o.get(Wi));break}}op()}function $o(n){const e=pt(n);return e===n?e:(Dn(e,"iterate",Bl),lr(n)?e:e.map(In))}function Rd(n){return Dn(n=pt(n),"iterate",Bl),n}const lE={__proto__:null,[Symbol.iterator](){return Ch(this,Symbol.iterator,In)},concat(...n){return $o(this).concat(...n.map(e=>Ue(e)?$o(e):e))},entries(){return Ch(this,"entries",n=>(n[1]=In(n[1]),n))},every(n,e){return rs(this,"every",n,e,void 0,arguments)},filter(n,e){return rs(this,"filter",n,e,t=>t.map(In),arguments)},find(n,e){return rs(this,"find",n,e,In,arguments)},findIndex(n,e){return rs(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return rs(this,"findLast",n,e,In,arguments)},findLastIndex(n,e){return rs(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return rs(this,"forEach",n,e,void 0,arguments)},includes(...n){return kh(this,"includes",n)},indexOf(...n){return kh(this,"indexOf",n)},join(n){return $o(this).join(n)},lastIndexOf(...n){return kh(this,"lastIndexOf",n)},map(n,e){return rs(this,"map",n,e,void 0,arguments)},pop(){return al(this,"pop")},push(...n){return al(this,"push",n)},reduce(n,...e){return Zm(this,"reduce",n,e)},reduceRight(n,...e){return Zm(this,"reduceRight",n,e)},shift(){return al(this,"shift")},some(n,e){return rs(this,"some",n,e,void 0,arguments)},splice(...n){return al(this,"splice",n)},toReversed(){return $o(this).toReversed()},toSorted(n){return $o(this).toSorted(n)},toSpliced(...n){return $o(this).toSpliced(...n)},unshift(...n){return al(this,"unshift",n)},values(){return Ch(this,"values",In)}};function Ch(n,e,t){const r=Rd(n),s=r[e]();return r!==n&&!lr(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const uE=Array.prototype;function rs(n,e,t,r,s,i){const o=Rd(n),a=o!==n&&!lr(n),l=o[e];if(l!==uE[e]){const f=l.apply(n,i);return a?In(f):f}let c=t;o!==n&&(a?c=function(f,v){return t.call(this,In(f),v,n)}:t.length>2&&(c=function(f,v){return t.call(this,f,v,n)}));const d=l.call(o,c,r);return a&&s?s(d):d}function Zm(n,e,t,r){const s=Rd(n);let i=t;return s!==n&&(lr(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,In(a),l,n)}),s[e](i,...r)}function kh(n,e,t){const r=pt(n);Dn(r,"iterate",Bl);const s=r[e](...t);return(s===-1||s===!1)&&dp(t[0])?(t[0]=pt(t[0]),r[e](...t)):s}function al(n,e,t=[]){ps(),ip();const r=pt(n)[e].apply(n,t);return op(),ms(),r}const cE=tp("__proto__,__v_isRef,__isVue"),e_=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Fr));function dE(n){Fr(n)||(n=String(n));const e=pt(this);return Dn(e,"has",n),e.hasOwnProperty(n)}class t_{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?wE:i_:i?s_:r_).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=Ue(e);if(!s){let l;if(o&&(l=lE[t]))return l;if(t==="hasOwnProperty")return dE}const a=Reflect.get(e,t,On(e)?e:r);return(Fr(t)?e_.has(t):cE(t))||(s||Dn(e,"get",t),i)?a:On(a)?o&&sp(t)?a:a.value:Rt(a)?s?a_(a):Cd(a):a}}class n_ extends t_{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=ai(i);if(!lr(r)&&!ai(r)&&(i=pt(i),r=pt(r)),!Ue(e)&&On(i)&&!On(r))return l?!1:(i.value=r,!0)}const o=Ue(e)&&sp(t)?Number(t)<e.length:mt(e,t),a=Reflect.set(e,t,r,On(e)?e:s);return e===pt(s)&&(o?ni(r,i)&&os(e,"set",t,r):os(e,"add",t,r)),a}deleteProperty(e,t){const r=mt(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&os(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!Fr(t)||!e_.has(t))&&Dn(e,"has",t),r}ownKeys(e){return Dn(e,"iterate",Ue(e)?"length":Wi),Reflect.ownKeys(e)}}class hE extends t_{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const fE=new n_,pE=new hE,mE=new n_(!0);const hf=n=>n,pc=n=>Reflect.getPrototypeOf(n);function gE(n,e,t){return function(...r){const s=this.__v_raw,i=pt(s),o=ea(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...r),d=t?hf:e?Kc:In;return!e&&Dn(i,"iterate",l?df:Wi),{next(){const{value:f,done:v}=c.next();return v?{value:f,done:v}:{value:a?[d(f[0]),d(f[1])]:d(f),done:v}},[Symbol.iterator](){return this}}}}function mc(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function vE(n,e){const t={get(s){const i=this.__v_raw,o=pt(i),a=pt(s);n||(ni(s,a)&&Dn(o,"get",s),Dn(o,"get",a));const{has:l}=pc(o),c=e?hf:n?Kc:In;if(l.call(o,s))return c(i.get(s));if(l.call(o,a))return c(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&Dn(pt(s),"iterate",Wi),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=pt(i),a=pt(s);return n||(ni(s,a)&&Dn(o,"has",s),Dn(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=pt(a),c=e?hf:n?Kc:In;return!n&&Dn(l,"iterate",Wi),a.forEach((d,f)=>s.call(i,c(d),c(f),o))}};return bn(t,n?{add:mc("add"),set:mc("set"),delete:mc("delete"),clear:mc("clear")}:{add(s){!e&&!lr(s)&&!ai(s)&&(s=pt(s));const i=pt(this);return pc(i).has.call(i,s)||(i.add(s),os(i,"add",s,s)),this},set(s,i){!e&&!lr(i)&&!ai(i)&&(i=pt(i));const o=pt(this),{has:a,get:l}=pc(o);let c=a.call(o,s);c||(s=pt(s),c=a.call(o,s));const d=l.call(o,s);return o.set(s,i),c?ni(i,d)&&os(o,"set",s,i):os(o,"add",s,i),this},delete(s){const i=pt(this),{has:o,get:a}=pc(i);let l=o.call(i,s);l||(s=pt(s),l=o.call(i,s)),a&&a.call(i,s);const c=i.delete(s);return l&&os(i,"delete",s,void 0),c},clear(){const s=pt(this),i=s.size!==0,o=s.clear();return i&&os(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=gE(s,n,e)}),t}function up(n,e){const t=vE(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(mt(t,s)&&s in r?t:r,s,i)}const yE={get:up(!1,!1)},_E={get:up(!1,!0)},bE={get:up(!0,!1)};const r_=new WeakMap,s_=new WeakMap,i_=new WeakMap,wE=new WeakMap;function IE(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function EE(n){return n.__v_skip||!Object.isExtensible(n)?0:IE(WI(n))}function Cd(n){return ai(n)?n:cp(n,!1,fE,yE,r_)}function o_(n){return cp(n,!1,mE,_E,s_)}function a_(n){return cp(n,!0,pE,bE,i_)}function cp(n,e,t,r,s){if(!Rt(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=EE(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function ta(n){return ai(n)?ta(n.__v_raw):!!(n&&n.__v_isReactive)}function ai(n){return!!(n&&n.__v_isReadonly)}function lr(n){return!!(n&&n.__v_isShallow)}function dp(n){return n?!!n.__v_raw:!1}function pt(n){const e=n&&n.__v_raw;return e?pt(e):n}function TE(n){return!mt(n,"__v_skip")&&Object.isExtensible(n)&&af(n,"__v_skip",!0),n}const In=n=>Rt(n)?Cd(n):n,Kc=n=>Rt(n)?a_(n):n;function On(n){return n?n.__v_isRef===!0:!1}function O(n){return l_(n,!1)}function xE(n){return l_(n,!0)}function l_(n,e){return On(n)?n:new AE(n,e)}class AE{constructor(e,t){this.dep=new lp,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:pt(e),this._value=t?e:In(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||lr(e)||ai(e);e=r?e:pt(e),ni(e,t)&&(this._rawValue=e,this._value=r?e:In(e),this.dep.trigger())}}function hs(n){return On(n)?n.value:n}const SE={get:(n,e,t)=>e==="__v_raw"?n:hs(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return On(s)&&!On(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function u_(n){return ta(n)?n:new Proxy(n,SE)}class PE{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new lp(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=jl-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&At!==this)return Wy(this,!0),!0}get value(){const e=this.dep.track();return Yy(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function RE(n,e,t=!1){let r,s;return He(n)?r=n:(r=n.get,s=n.set),new PE(r,s,t)}const gc={},Hc=new WeakMap;let Fi;function CE(n,e=!1,t=Fi){if(t){let r=Hc.get(t);r||Hc.set(t,r=[]),r.push(n)}}function kE(n,e,t=Et){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,c=z=>s?z:lr(z)||s===!1||s===0?as(z,1):as(z);let d,f,v,y,C=!1,A=!1;if(On(n)?(f=()=>n.value,C=lr(n)):ta(n)?(f=()=>c(n),C=!0):Ue(n)?(A=!0,C=n.some(z=>ta(z)||lr(z)),f=()=>n.map(z=>{if(On(z))return z.value;if(ta(z))return c(z);if(He(z))return l?l(z,2):z()})):He(n)?e?f=l?()=>l(n,2):n:f=()=>{if(v){ps();try{v()}finally{ms()}}const z=Fi;Fi=d;try{return l?l(n,3,[y]):n(y)}finally{Fi=z}}:f=br,e&&s){const z=f,ne=s===!0?1/0:s;f=()=>as(z(),ne)}const k=iE(),$=()=>{d.stop(),k&&k.active&&rp(k.effects,d)};if(i&&e){const z=e;e=(...ne)=>{z(...ne),$()}}let B=A?new Array(n.length).fill(gc):gc;const F=z=>{if(!(!(d.flags&1)||!d.dirty&&!z))if(e){const ne=d.run();if(s||C||(A?ne.some((re,E)=>ni(re,B[E])):ni(ne,B))){v&&v();const re=Fi;Fi=d;try{const E=[ne,B===gc?void 0:A&&B[0]===gc?[]:B,y];B=ne,l?l(e,3,E):e(...E)}finally{Fi=re}}}else d.run()};return a&&a(F),d=new Ky(f),d.scheduler=o?()=>o(F,!1):F,y=z=>CE(z,!1,d),v=d.onStop=()=>{const z=Hc.get(d);if(z){if(l)l(z,4);else for(const ne of z)ne();Hc.delete(d)}},e?r?F(!0):B=d.run():o?o(F.bind(null,!0),!0):d.run(),$.pause=d.pause.bind(d),$.resume=d.resume.bind(d),$.stop=$,$}function as(n,e=1/0,t){if(e<=0||!Rt(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,On(n))as(n.value,e,t);else if(Ue(n))for(let r=0;r<n.length;r++)as(n[r],e,t);else if(Td(n)||ea(n))n.forEach(r=>{as(r,e,t)});else if(jy(n)){for(const r in n)as(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&as(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function mu(n,e,t,r){try{return r?n(...r):n()}catch(s){kd(s,e,t)}}function Ur(n,e,t,r){if(He(n)){const s=mu(n,e,t,r);return s&&Uy(s)&&s.catch(i=>{kd(i,e,t)}),s}if(Ue(n)){const s=[];for(let i=0;i<n.length;i++)s.push(Ur(n[i],e,t,r));return s}}function kd(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||Et;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const d=a.ec;if(d){for(let f=0;f<d.length;f++)if(d[f](n,l,c)===!1)return}a=a.parent}if(i){ps(),mu(i,null,10,[n,l,c]),ms();return}}DE(n,t,s,r,o)}function DE(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const Un=[];let Rr=-1;const na=[];let zs=null,Ho=0;const c_=Promise.resolve();let Wc=null;function un(n){const e=Wc||c_;return n?e.then(this?n.bind(this):n):e}function VE(n){let e=Rr+1,t=Un.length;for(;e<t;){const r=e+t>>>1,s=Un[r],i=ql(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function hp(n){if(!(n.flags&1)){const e=ql(n),t=Un[Un.length-1];!t||!(n.flags&2)&&e>=ql(t)?Un.push(n):Un.splice(VE(e),0,n),n.flags|=1,d_()}}function d_(){Wc||(Wc=c_.then(f_))}function NE(n){Ue(n)?na.push(...n):zs&&n.id===-1?zs.splice(Ho+1,0,n):n.flags&1||(na.push(n),n.flags|=1),d_()}function eg(n,e,t=Rr+1){for(;t<Un.length;t++){const r=Un[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;Un.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function h_(n){if(na.length){const e=[...new Set(na)].sort((t,r)=>ql(t)-ql(r));if(na.length=0,zs){zs.push(...e);return}for(zs=e,Ho=0;Ho<zs.length;Ho++){const t=zs[Ho];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}zs=null,Ho=0}}const ql=n=>n.id==null?n.flags&2?-1:1/0:n.id;function f_(n){const e=br;try{for(Rr=0;Rr<Un.length;Rr++){const t=Un[Rr];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),mu(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;Rr<Un.length;Rr++){const t=Un[Rr];t&&(t.flags&=-2)}Rr=-1,Un.length=0,h_(),Wc=null,(Un.length||na.length)&&f_()}}let tr=null,p_=null;function Qc(n){const e=tr;return tr=n,p_=n&&n.type.__scopeId||null,e}function OE(n,e=tr,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&ug(-1);const i=Qc(e);let o;try{o=n(...s)}finally{Qc(i),r._d&&ug(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function gt(n,e){if(tr===null)return n;const t=Od(tr),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=Et]=e[s];i&&(He(i)&&(i={mounted:i,updated:i}),i.deep&&as(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function Oi(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(ps(),Ur(l,t,8,[n.el,a,n,e]),ms())}}const ME=Symbol("_vte"),LE=n=>n.__isTeleport;function fp(n,e){n.shapeFlag&6&&n.component?(n.transition=e,fp(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}/*! #__NO_SIDE_EFFECTS__ */function m_(n,e){return He(n)?(()=>bn({name:n.name},e,{setup:n}))():n}function g_(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function Pl(n,e,t,r,s=!1){if(Ue(n)){n.forEach((C,A)=>Pl(C,e&&(Ue(e)?e[A]:e),t,r,s));return}if(Rl(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&Pl(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?Od(r.component):r.el,o=s?null:i,{i:a,r:l}=n,c=e&&e.r,d=a.refs===Et?a.refs={}:a.refs,f=a.setupState,v=pt(f),y=f===Et?()=>!1:C=>mt(v,C);if(c!=null&&c!==l&&(on(c)?(d[c]=null,y(c)&&(f[c]=null)):On(c)&&(c.value=null)),He(l))mu(l,a,12,[o,d]);else{const C=on(l),A=On(l);if(C||A){const k=()=>{if(n.f){const $=C?y(l)?f[l]:d[l]:l.value;s?Ue($)&&rp($,i):Ue($)?$.includes(i)||$.push(i):C?(d[l]=[i],y(l)&&(f[l]=d[l])):(l.value=[i],n.k&&(d[n.k]=l.value))}else C?(d[l]=o,y(l)&&(f[l]=o)):A&&(l.value=o,n.k&&(d[n.k]=o))};o?(k.id=-1,er(k,t)):k()}}}Sd().requestIdleCallback;Sd().cancelIdleCallback;const Rl=n=>!!n.type.__asyncLoader,v_=n=>n.type.__isKeepAlive;function FE(n,e){y_(n,"a",e)}function UE(n,e){y_(n,"da",e)}function y_(n,e,t=Vn){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(Dd(e,r,t),t){let s=t.parent;for(;s&&s.parent;)v_(s.parent.vnode)&&$E(r,e,t,s),s=s.parent}}function $E(n,e,t,r){const s=Dd(e,n,r,!0);Cl(()=>{rp(r[e],s)},t)}function Dd(n,e,t=Vn,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{ps();const a=gu(t),l=Ur(e,t,n,o);return a(),ms(),l});return r?s.unshift(i):s.push(i),i}}const Is=n=>(e,t=Vn)=>{(!Gl||n==="sp")&&Dd(n,(...r)=>e(...r),t)},jE=Is("bm"),kr=Is("m"),BE=Is("bu"),qE=Is("u"),zE=Is("bum"),Cl=Is("um"),GE=Is("sp"),KE=Is("rtg"),HE=Is("rtc");function WE(n,e=Vn){Dd("ec",n,e)}const __="components";function QE(n,e){return YE(__,n,!0,e)||n}const JE=Symbol.for("v-ndc");function YE(n,e,t=!0,r=!1){const s=tr||Vn;if(s){const i=s.type;if(n===__){const a=LT(i,!1);if(a&&(a===e||a===ur(e)||a===Ad(ur(e))))return i}const o=tg(s[n]||i[n],e)||tg(s.appContext[n],e);return!o&&r?i:o}}function tg(n,e){return n&&(n[e]||n[ur(e)]||n[Ad(ur(e))])}function _r(n,e,t,r){let s;const i=t&&t[r],o=Ue(n);if(o||on(n)){const a=o&&ta(n);let l=!1,c=!1;a&&(l=!lr(n),c=ai(n),n=Rd(n)),s=new Array(n.length);for(let d=0,f=n.length;d<f;d++)s[d]=e(l?c?Kc(In(n[d])):In(n[d]):n[d],d,void 0,i&&i[d])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(Rt(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const d=a[l];s[l]=e(n[d],d,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}const ff=n=>n?F_(n)?Od(n):ff(n.parent):null,kl=bn(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>ff(n.parent),$root:n=>ff(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>pp(n),$forceUpdate:n=>n.f||(n.f=()=>{hp(n.update)}),$nextTick:n=>n.n||(n.n=un.bind(n.proxy)),$watch:n=>yT.bind(n)}),Dh=(n,e)=>n!==Et&&!n.__isScriptSetup&&mt(n,e),XE={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const y=o[e];if(y!==void 0)switch(y){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(Dh(r,e))return o[e]=1,r[e];if(s!==Et&&mt(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&mt(c,e))return o[e]=3,i[e];if(t!==Et&&mt(t,e))return o[e]=4,t[e];pf&&(o[e]=0)}}const d=kl[e];let f,v;if(d)return e==="$attrs"&&Dn(n.attrs,"get",""),d(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==Et&&mt(t,e))return o[e]=4,t[e];if(v=l.config.globalProperties,mt(v,e))return v[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return Dh(s,e)?(s[e]=t,!0):r!==Et&&mt(r,e)?(r[e]=t,!0):mt(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==Et&&mt(n,o)||Dh(e,o)||(a=i[0])&&mt(a,o)||mt(r,o)||mt(kl,o)||mt(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:mt(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function ng(n){return Ue(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let pf=!0;function ZE(n){const e=pp(n),t=n.proxy,r=n.ctx;pf=!1,e.beforeCreate&&rg(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:c,created:d,beforeMount:f,mounted:v,beforeUpdate:y,updated:C,activated:A,deactivated:k,beforeDestroy:$,beforeUnmount:B,destroyed:F,unmounted:z,render:ne,renderTracked:re,renderTriggered:E,errorCaptured:I,serverPrefetch:x,expose:P,inheritAttrs:R,components:V,directives:w,filters:ze}=e;if(c&&eT(c,r,null),o)for(const Ge in o){const je=o[Ge];He(je)&&(r[Ge]=je.bind(t))}if(s){const Ge=s.call(t,t);Rt(Ge)&&(n.data=Cd(Ge))}if(pf=!0,i)for(const Ge in i){const je=i[Ge],ke=He(je)?je.bind(t,t):He(je.get)?je.get.bind(t,t):br,ee=!He(je)&&He(je.set)?je.set.bind(t):br,De=nt({get:ke,set:ee});Object.defineProperty(r,Ge,{enumerable:!0,configurable:!0,get:()=>De.value,set:we=>De.value=we})}if(a)for(const Ge in a)b_(a[Ge],r,t,Ge);if(l){const Ge=He(l)?l.call(t):l;Reflect.ownKeys(Ge).forEach(je=>{Pc(je,Ge[je])})}d&&rg(d,n,"c");function it(Ge,je){Ue(je)?je.forEach(ke=>Ge(ke.bind(t))):je&&Ge(je.bind(t))}if(it(jE,f),it(kr,v),it(BE,y),it(qE,C),it(FE,A),it(UE,k),it(WE,I),it(HE,re),it(KE,E),it(zE,B),it(Cl,z),it(GE,x),Ue(P))if(P.length){const Ge=n.exposed||(n.exposed={});P.forEach(je=>{Object.defineProperty(Ge,je,{get:()=>t[je],set:ke=>t[je]=ke})})}else n.exposed||(n.exposed={});ne&&n.render===br&&(n.render=ne),R!=null&&(n.inheritAttrs=R),V&&(n.components=V),w&&(n.directives=w),x&&g_(n)}function eT(n,e,t=br){Ue(n)&&(n=mf(n));for(const r in n){const s=n[r];let i;Rt(s)?"default"in s?i=Ir(s.from||r,s.default,!0):i=Ir(s.from||r):i=Ir(s),On(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function rg(n,e,t){Ur(Ue(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function b_(n,e,t,r){let s=r.includes(".")?V_(t,r):()=>t[r];if(on(n)){const i=e[n];He(i)&&sn(s,i)}else if(He(n))sn(s,n.bind(t));else if(Rt(n))if(Ue(n))n.forEach(i=>b_(i,e,t,r));else{const i=He(n.handler)?n.handler.bind(t):e[n.handler];He(i)&&sn(s,i,n)}}function pp(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(c=>Jc(l,c,o,!0)),Jc(l,e,o)),Rt(e)&&i.set(e,l),l}function Jc(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&Jc(n,i,t,!0),s&&s.forEach(o=>Jc(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=tT[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const tT={data:sg,props:ig,emits:ig,methods:vl,computed:vl,beforeCreate:Fn,created:Fn,beforeMount:Fn,mounted:Fn,beforeUpdate:Fn,updated:Fn,beforeDestroy:Fn,beforeUnmount:Fn,destroyed:Fn,unmounted:Fn,activated:Fn,deactivated:Fn,errorCaptured:Fn,serverPrefetch:Fn,components:vl,directives:vl,watch:rT,provide:sg,inject:nT};function sg(n,e){return e?n?function(){return bn(He(n)?n.call(this,this):n,He(e)?e.call(this,this):e)}:e:n}function nT(n,e){return vl(mf(n),mf(e))}function mf(n){if(Ue(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function Fn(n,e){return n?[...new Set([].concat(n,e))]:e}function vl(n,e){return n?bn(Object.create(null),n,e):e}function ig(n,e){return n?Ue(n)&&Ue(e)?[...new Set([...n,...e])]:bn(Object.create(null),ng(n),ng(e??{})):e}function rT(n,e){if(!n)return e;if(!e)return n;const t=bn(Object.create(null),n);for(const r in e)t[r]=Fn(n[r],e[r]);return t}function w_(){return{app:null,config:{isNativeTag:KI,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let sT=0;function iT(n,e){return function(r,s=null){He(r)||(r=bn({},r)),s!=null&&!Rt(s)&&(s=null);const i=w_(),o=new WeakSet,a=[];let l=!1;const c=i.app={_uid:sT++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:UT,get config(){return i.config},set config(d){},use(d,...f){return o.has(d)||(d&&He(d.install)?(o.add(d),d.install(c,...f)):He(d)&&(o.add(d),d(c,...f))),c},mixin(d){return i.mixins.includes(d)||i.mixins.push(d),c},component(d,f){return f?(i.components[d]=f,c):i.components[d]},directive(d,f){return f?(i.directives[d]=f,c):i.directives[d]},mount(d,f,v){if(!l){const y=c._ceVNode||_t(r,s);return y.appContext=i,v===!0?v="svg":v===!1&&(v=void 0),f&&e?e(y,d):n(y,d,v),l=!0,c._container=d,d.__vue_app__=c,Od(y.component)}},onUnmount(d){a.push(d)},unmount(){l&&(Ur(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(d,f){return i.provides[d]=f,c},runWithContext(d){const f=ra;ra=c;try{return d()}finally{ra=f}}};return c}}let ra=null;function Pc(n,e){if(Vn){let t=Vn.provides;const r=Vn.parent&&Vn.parent.provides;r===t&&(t=Vn.provides=Object.create(r)),t[n]=e}}function Ir(n,e,t=!1){const r=Vn||tr;if(r||ra){let s=ra?ra._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&He(e)?e.call(r&&r.proxy):e}}const I_={},E_=()=>Object.create(I_),T_=n=>Object.getPrototypeOf(n)===I_;function oT(n,e,t,r=!1){const s={},i=E_();n.propsDefaults=Object.create(null),x_(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:o_(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function aT(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=pt(s),[l]=n.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const d=n.vnode.dynamicProps;for(let f=0;f<d.length;f++){let v=d[f];if(Vd(n.emitsOptions,v))continue;const y=e[v];if(l)if(mt(i,v))y!==i[v]&&(i[v]=y,c=!0);else{const C=ur(v);s[C]=gf(l,a,C,y,n,!1)}else y!==i[v]&&(i[v]=y,c=!0)}}}else{x_(n,e,s,i)&&(c=!0);let d;for(const f in a)(!e||!mt(e,f)&&((d=vi(f))===f||!mt(e,d)))&&(l?t&&(t[f]!==void 0||t[d]!==void 0)&&(s[f]=gf(l,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!mt(e,f))&&(delete i[f],c=!0)}c&&os(n.attrs,"set","")}function x_(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(xl(l))continue;const c=e[l];let d;s&&mt(s,d=ur(l))?!i||!i.includes(d)?t[d]=c:(a||(a={}))[d]=c:Vd(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(i){const l=pt(t),c=a||Et;for(let d=0;d<i.length;d++){const f=i[d];t[f]=gf(s,l,f,c[f],n,!mt(c,f))}}return o}function gf(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=mt(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&He(l)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const d=gu(s);r=c[t]=l.call(null,e),d()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===vi(t))&&(r=!0))}return r}const lT=new WeakMap;function A_(n,e,t=!1){const r=t?lT:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!He(n)){const d=f=>{l=!0;const[v,y]=A_(f,e,!0);bn(o,v),y&&a.push(...y)};!t&&e.mixins.length&&e.mixins.forEach(d),n.extends&&d(n.extends),n.mixins&&n.mixins.forEach(d)}if(!i&&!l)return Rt(n)&&r.set(n,Zo),Zo;if(Ue(i))for(let d=0;d<i.length;d++){const f=ur(i[d]);og(f)&&(o[f]=Et)}else if(i)for(const d in i){const f=ur(d);if(og(f)){const v=i[d],y=o[f]=Ue(v)||He(v)?{type:v}:bn({},v),C=y.type;let A=!1,k=!0;if(Ue(C))for(let $=0;$<C.length;++$){const B=C[$],F=He(B)&&B.name;if(F==="Boolean"){A=!0;break}else F==="String"&&(k=!1)}else A=He(C)&&C.name==="Boolean";y[0]=A,y[1]=k,(A||mt(y,"default"))&&a.push(f)}}const c=[o,a];return Rt(n)&&r.set(n,c),c}function og(n){return n[0]!=="$"&&!xl(n)}const mp=n=>n[0]==="_"||n==="$stable",gp=n=>Ue(n)?n.map(Cr):[Cr(n)],uT=(n,e,t)=>{if(e._n)return e;const r=OE((...s)=>gp(e(...s)),t);return r._c=!1,r},S_=(n,e,t)=>{const r=n._ctx;for(const s in n){if(mp(s))continue;const i=n[s];if(He(i))e[s]=uT(s,i,r);else if(i!=null){const o=gp(i);e[s]=()=>o}}},P_=(n,e)=>{const t=gp(e);n.slots.default=()=>t},R_=(n,e,t)=>{for(const r in e)(t||!mp(r))&&(n[r]=e[r])},cT=(n,e,t)=>{const r=n.slots=E_();if(n.vnode.shapeFlag&32){const s=e.__;s&&af(r,"__",s,!0);const i=e._;i?(R_(r,e,t),t&&af(r,"_",i,!0)):S_(e,r)}else e&&P_(n,e)},dT=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=Et;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:R_(s,e,t):(i=!e.$stable,S_(e,s)),o=e}else e&&(P_(n,e),o={default:1});if(i)for(const a in s)!mp(a)&&o[a]==null&&delete s[a]},er=xT;function hT(n){return fT(n)}function fT(n,e){const t=Sd();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:c,setElementText:d,parentNode:f,nextSibling:v,setScopeId:y=br,insertStaticContent:C}=n,A=(T,S,N,J=null,W=null,Y=null,fe=void 0,oe=null,ie=!!S.dynamicChildren)=>{if(T===S)return;T&&!ll(T,S)&&(J=Q(T),we(T,W,Y,!0),T=null),S.patchFlag===-2&&(ie=!1,S.dynamicChildren=null);const{type:te,ref:_e,shapeFlag:ge}=S;switch(te){case Nd:k(T,S,N,J);break;case li:$(T,S,N,J);break;case Rc:T==null&&B(S,N,J,fe);break;case St:V(T,S,N,J,W,Y,fe,oe,ie);break;default:ge&1?ne(T,S,N,J,W,Y,fe,oe,ie):ge&6?w(T,S,N,J,W,Y,fe,oe,ie):(ge&64||ge&128)&&te.process(T,S,N,J,W,Y,fe,oe,ie,Te)}_e!=null&&W?Pl(_e,T&&T.ref,Y,S||T,!S):_e==null&&T&&T.ref!=null&&Pl(T.ref,null,Y,T,!0)},k=(T,S,N,J)=>{if(T==null)r(S.el=a(S.children),N,J);else{const W=S.el=T.el;S.children!==T.children&&c(W,S.children)}},$=(T,S,N,J)=>{T==null?r(S.el=l(S.children||""),N,J):S.el=T.el},B=(T,S,N,J)=>{[T.el,T.anchor]=C(T.children,S,N,J,T.el,T.anchor)},F=({el:T,anchor:S},N,J)=>{let W;for(;T&&T!==S;)W=v(T),r(T,N,J),T=W;r(S,N,J)},z=({el:T,anchor:S})=>{let N;for(;T&&T!==S;)N=v(T),s(T),T=N;s(S)},ne=(T,S,N,J,W,Y,fe,oe,ie)=>{S.type==="svg"?fe="svg":S.type==="math"&&(fe="mathml"),T==null?re(S,N,J,W,Y,fe,oe,ie):x(T,S,W,Y,fe,oe,ie)},re=(T,S,N,J,W,Y,fe,oe)=>{let ie,te;const{props:_e,shapeFlag:ge,transition:Ie,dirs:Se}=T;if(ie=T.el=o(T.type,Y,_e&&_e.is,_e),ge&8?d(ie,T.children):ge&16&&I(T.children,ie,null,J,W,Vh(T,Y),fe,oe),Se&&Oi(T,null,J,"created"),E(ie,T,T.scopeId,fe,J),_e){for(const Be in _e)Be!=="value"&&!xl(Be)&&i(ie,Be,null,_e[Be],Y,J);"value"in _e&&i(ie,"value",null,_e.value,Y),(te=_e.onVnodeBeforeMount)&&Pr(te,J,T)}Se&&Oi(T,null,J,"beforeMount");const Ve=pT(W,Ie);Ve&&Ie.beforeEnter(ie),r(ie,S,N),((te=_e&&_e.onVnodeMounted)||Ve||Se)&&er(()=>{te&&Pr(te,J,T),Ve&&Ie.enter(ie),Se&&Oi(T,null,J,"mounted")},W)},E=(T,S,N,J,W)=>{if(N&&y(T,N),J)for(let Y=0;Y<J.length;Y++)y(T,J[Y]);if(W){let Y=W.subTree;if(S===Y||O_(Y.type)&&(Y.ssContent===S||Y.ssFallback===S)){const fe=W.vnode;E(T,fe,fe.scopeId,fe.slotScopeIds,W.parent)}}},I=(T,S,N,J,W,Y,fe,oe,ie=0)=>{for(let te=ie;te<T.length;te++){const _e=T[te]=oe?Gs(T[te]):Cr(T[te]);A(null,_e,S,N,J,W,Y,fe,oe)}},x=(T,S,N,J,W,Y,fe)=>{const oe=S.el=T.el;let{patchFlag:ie,dynamicChildren:te,dirs:_e}=S;ie|=T.patchFlag&16;const ge=T.props||Et,Ie=S.props||Et;let Se;if(N&&Mi(N,!1),(Se=Ie.onVnodeBeforeUpdate)&&Pr(Se,N,S,T),_e&&Oi(S,T,N,"beforeUpdate"),N&&Mi(N,!0),(ge.innerHTML&&Ie.innerHTML==null||ge.textContent&&Ie.textContent==null)&&d(oe,""),te?P(T.dynamicChildren,te,oe,N,J,Vh(S,W),Y):fe||je(T,S,oe,null,N,J,Vh(S,W),Y,!1),ie>0){if(ie&16)R(oe,ge,Ie,N,W);else if(ie&2&&ge.class!==Ie.class&&i(oe,"class",null,Ie.class,W),ie&4&&i(oe,"style",ge.style,Ie.style,W),ie&8){const Ve=S.dynamicProps;for(let Be=0;Be<Ve.length;Be++){const Ye=Ve[Be],zt=ge[Ye],Mt=Ie[Ye];(Mt!==zt||Ye==="value")&&i(oe,Ye,zt,Mt,W,N)}}ie&1&&T.children!==S.children&&d(oe,S.children)}else!fe&&te==null&&R(oe,ge,Ie,N,W);((Se=Ie.onVnodeUpdated)||_e)&&er(()=>{Se&&Pr(Se,N,S,T),_e&&Oi(S,T,N,"updated")},J)},P=(T,S,N,J,W,Y,fe)=>{for(let oe=0;oe<S.length;oe++){const ie=T[oe],te=S[oe],_e=ie.el&&(ie.type===St||!ll(ie,te)||ie.shapeFlag&198)?f(ie.el):N;A(ie,te,_e,null,J,W,Y,fe,!0)}},R=(T,S,N,J,W)=>{if(S!==N){if(S!==Et)for(const Y in S)!xl(Y)&&!(Y in N)&&i(T,Y,S[Y],null,W,J);for(const Y in N){if(xl(Y))continue;const fe=N[Y],oe=S[Y];fe!==oe&&Y!=="value"&&i(T,Y,oe,fe,W,J)}"value"in N&&i(T,"value",S.value,N.value,W)}},V=(T,S,N,J,W,Y,fe,oe,ie)=>{const te=S.el=T?T.el:a(""),_e=S.anchor=T?T.anchor:a("");let{patchFlag:ge,dynamicChildren:Ie,slotScopeIds:Se}=S;Se&&(oe=oe?oe.concat(Se):Se),T==null?(r(te,N,J),r(_e,N,J),I(S.children||[],N,_e,W,Y,fe,oe,ie)):ge>0&&ge&64&&Ie&&T.dynamicChildren?(P(T.dynamicChildren,Ie,N,W,Y,fe,oe),(S.key!=null||W&&S===W.subTree)&&C_(T,S,!0)):je(T,S,N,_e,W,Y,fe,oe,ie)},w=(T,S,N,J,W,Y,fe,oe,ie)=>{S.slotScopeIds=oe,T==null?S.shapeFlag&512?W.ctx.activate(S,N,J,fe,ie):ze(S,N,J,W,Y,fe,ie):Le(T,S,ie)},ze=(T,S,N,J,W,Y,fe)=>{const oe=T.component=DT(T,J,W);if(v_(T)&&(oe.ctx.renderer=Te),VT(oe,!1,fe),oe.asyncDep){if(W&&W.registerDep(oe,it,fe),!T.el){const ie=oe.subTree=_t(li);$(null,ie,S,N)}}else it(oe,T,S,N,W,Y,fe)},Le=(T,S,N)=>{const J=S.component=T.component;if(ET(T,S,N))if(J.asyncDep&&!J.asyncResolved){Ge(J,S,N);return}else J.next=S,J.update();else S.el=T.el,J.vnode=S},it=(T,S,N,J,W,Y,fe)=>{const oe=()=>{if(T.isMounted){let{next:ge,bu:Ie,u:Se,parent:Ve,vnode:Be}=T;{const Qt=k_(T);if(Qt){ge&&(ge.el=Be.el,Ge(T,ge,fe)),Qt.asyncDep.then(()=>{T.isUnmounted||oe()});return}}let Ye=ge,zt;Mi(T,!1),ge?(ge.el=Be.el,Ge(T,ge,fe)):ge=Be,Ie&&Sc(Ie),(zt=ge.props&&ge.props.onVnodeBeforeUpdate)&&Pr(zt,Ve,ge,Be),Mi(T,!0);const Mt=Nh(T),fn=T.subTree;T.subTree=Mt,A(fn,Mt,f(fn.el),Q(fn),T,W,Y),ge.el=Mt.el,Ye===null&&TT(T,Mt.el),Se&&er(Se,W),(zt=ge.props&&ge.props.onVnodeUpdated)&&er(()=>Pr(zt,Ve,ge,Be),W)}else{let ge;const{el:Ie,props:Se}=S,{bm:Ve,m:Be,parent:Ye,root:zt,type:Mt}=T,fn=Rl(S);if(Mi(T,!1),Ve&&Sc(Ve),!fn&&(ge=Se&&Se.onVnodeBeforeMount)&&Pr(ge,Ye,S),Mi(T,!0),Ie&&ut){const Qt=()=>{T.subTree=Nh(T),ut(Ie,T.subTree,T,W,null)};fn&&Mt.__asyncHydrate?Mt.__asyncHydrate(Ie,T,Qt):Qt()}else{zt.ce&&zt.ce._def.shadowRoot!==!1&&zt.ce._injectChildStyle(Mt);const Qt=T.subTree=Nh(T);A(null,Qt,N,J,T,W,Y),S.el=Qt.el}if(Be&&er(Be,W),!fn&&(ge=Se&&Se.onVnodeMounted)){const Qt=S;er(()=>Pr(ge,Ye,Qt),W)}(S.shapeFlag&256||Ye&&Rl(Ye.vnode)&&Ye.vnode.shapeFlag&256)&&T.a&&er(T.a,W),T.isMounted=!0,S=N=J=null}};T.scope.on();const ie=T.effect=new Ky(oe);T.scope.off();const te=T.update=ie.run.bind(ie),_e=T.job=ie.runIfDirty.bind(ie);_e.i=T,_e.id=T.uid,ie.scheduler=()=>hp(_e),Mi(T,!0),te()},Ge=(T,S,N)=>{S.component=T;const J=T.vnode.props;T.vnode=S,T.next=null,aT(T,S.props,J,N),dT(T,S.children,N),ps(),eg(T),ms()},je=(T,S,N,J,W,Y,fe,oe,ie=!1)=>{const te=T&&T.children,_e=T?T.shapeFlag:0,ge=S.children,{patchFlag:Ie,shapeFlag:Se}=S;if(Ie>0){if(Ie&128){ee(te,ge,N,J,W,Y,fe,oe,ie);return}else if(Ie&256){ke(te,ge,N,J,W,Y,fe,oe,ie);return}}Se&8?(_e&16&&wt(te,W,Y),ge!==te&&d(N,ge)):_e&16?Se&16?ee(te,ge,N,J,W,Y,fe,oe,ie):wt(te,W,Y,!0):(_e&8&&d(N,""),Se&16&&I(ge,N,J,W,Y,fe,oe,ie))},ke=(T,S,N,J,W,Y,fe,oe,ie)=>{T=T||Zo,S=S||Zo;const te=T.length,_e=S.length,ge=Math.min(te,_e);let Ie;for(Ie=0;Ie<ge;Ie++){const Se=S[Ie]=ie?Gs(S[Ie]):Cr(S[Ie]);A(T[Ie],Se,N,null,W,Y,fe,oe,ie)}te>_e?wt(T,W,Y,!0,!1,ge):I(S,N,J,W,Y,fe,oe,ie,ge)},ee=(T,S,N,J,W,Y,fe,oe,ie)=>{let te=0;const _e=S.length;let ge=T.length-1,Ie=_e-1;for(;te<=ge&&te<=Ie;){const Se=T[te],Ve=S[te]=ie?Gs(S[te]):Cr(S[te]);if(ll(Se,Ve))A(Se,Ve,N,null,W,Y,fe,oe,ie);else break;te++}for(;te<=ge&&te<=Ie;){const Se=T[ge],Ve=S[Ie]=ie?Gs(S[Ie]):Cr(S[Ie]);if(ll(Se,Ve))A(Se,Ve,N,null,W,Y,fe,oe,ie);else break;ge--,Ie--}if(te>ge){if(te<=Ie){const Se=Ie+1,Ve=Se<_e?S[Se].el:J;for(;te<=Ie;)A(null,S[te]=ie?Gs(S[te]):Cr(S[te]),N,Ve,W,Y,fe,oe,ie),te++}}else if(te>Ie)for(;te<=ge;)we(T[te],W,Y,!0),te++;else{const Se=te,Ve=te,Be=new Map;for(te=Ve;te<=Ie;te++){const xt=S[te]=ie?Gs(S[te]):Cr(S[te]);xt.key!=null&&Be.set(xt.key,te)}let Ye,zt=0;const Mt=Ie-Ve+1;let fn=!1,Qt=0;const xn=new Array(Mt);for(te=0;te<Mt;te++)xn[te]=0;for(te=Se;te<=ge;te++){const xt=T[te];if(zt>=Mt){we(xt,W,Y,!0);continue}let an;if(xt.key!=null)an=Be.get(xt.key);else for(Ye=Ve;Ye<=Ie;Ye++)if(xn[Ye-Ve]===0&&ll(xt,S[Ye])){an=Ye;break}an===void 0?we(xt,W,Y,!0):(xn[an-Ve]=te+1,an>=Qt?Qt=an:fn=!0,A(xt,S[an],N,null,W,Y,fe,oe,ie),zt++)}const sr=fn?mT(xn):Zo;for(Ye=sr.length-1,te=Mt-1;te>=0;te--){const xt=Ve+te,an=S[xt],Xn=xt+1<_e?S[xt+1].el:J;xn[te]===0?A(null,an,N,Xn,W,Y,fe,oe,ie):fn&&(Ye<0||te!==sr[Ye]?De(an,N,Xn,2):Ye--)}}},De=(T,S,N,J,W=null)=>{const{el:Y,type:fe,transition:oe,children:ie,shapeFlag:te}=T;if(te&6){De(T.component.subTree,S,N,J);return}if(te&128){T.suspense.move(S,N,J);return}if(te&64){fe.move(T,S,N,Te);return}if(fe===St){r(Y,S,N);for(let ge=0;ge<ie.length;ge++)De(ie[ge],S,N,J);r(T.anchor,S,N);return}if(fe===Rc){F(T,S,N);return}if(J!==2&&te&1&&oe)if(J===0)oe.beforeEnter(Y),r(Y,S,N),er(()=>oe.enter(Y),W);else{const{leave:ge,delayLeave:Ie,afterLeave:Se}=oe,Ve=()=>{T.ctx.isUnmounted?s(Y):r(Y,S,N)},Be=()=>{ge(Y,()=>{Ve(),Se&&Se()})};Ie?Ie(Y,Ve,Be):Be()}else r(Y,S,N)},we=(T,S,N,J=!1,W=!1)=>{const{type:Y,props:fe,ref:oe,children:ie,dynamicChildren:te,shapeFlag:_e,patchFlag:ge,dirs:Ie,cacheIndex:Se}=T;if(ge===-2&&(W=!1),oe!=null&&(ps(),Pl(oe,null,N,T,!0),ms()),Se!=null&&(S.renderCache[Se]=void 0),_e&256){S.ctx.deactivate(T);return}const Ve=_e&1&&Ie,Be=!Rl(T);let Ye;if(Be&&(Ye=fe&&fe.onVnodeBeforeUnmount)&&Pr(Ye,S,T),_e&6)hn(T.component,N,J);else{if(_e&128){T.suspense.unmount(N,J);return}Ve&&Oi(T,null,S,"beforeUnmount"),_e&64?T.type.remove(T,S,N,Te,J):te&&!te.hasOnce&&(Y!==St||ge>0&&ge&64)?wt(te,S,N,!1,!0):(Y===St&&ge&384||!W&&_e&16)&&wt(ie,S,N),J&&Fe(T)}(Be&&(Ye=fe&&fe.onVnodeUnmounted)||Ve)&&er(()=>{Ye&&Pr(Ye,S,T),Ve&&Oi(T,null,S,"unmounted")},N)},Fe=T=>{const{type:S,el:N,anchor:J,transition:W}=T;if(S===St){ct(N,J);return}if(S===Rc){z(T);return}const Y=()=>{s(N),W&&!W.persisted&&W.afterLeave&&W.afterLeave()};if(T.shapeFlag&1&&W&&!W.persisted){const{leave:fe,delayLeave:oe}=W,ie=()=>fe(N,Y);oe?oe(T.el,Y,ie):ie()}else Y()},ct=(T,S)=>{let N;for(;T!==S;)N=v(T),s(T),T=N;s(S)},hn=(T,S,N)=>{const{bum:J,scope:W,job:Y,subTree:fe,um:oe,m:ie,a:te,parent:_e,slots:{__:ge}}=T;ag(ie),ag(te),J&&Sc(J),_e&&Ue(ge)&&ge.forEach(Ie=>{_e.renderCache[Ie]=void 0}),W.stop(),Y&&(Y.flags|=8,we(fe,T,S,N)),oe&&er(oe,S),er(()=>{T.isUnmounted=!0},S),S&&S.pendingBranch&&!S.isUnmounted&&T.asyncDep&&!T.asyncResolved&&T.suspenseId===S.pendingId&&(S.deps--,S.deps===0&&S.resolve())},wt=(T,S,N,J=!1,W=!1,Y=0)=>{for(let fe=Y;fe<T.length;fe++)we(T[fe],S,N,J,W)},Q=T=>{if(T.shapeFlag&6)return Q(T.component.subTree);if(T.shapeFlag&128)return T.suspense.next();const S=v(T.anchor||T.el),N=S&&S[ME];return N?v(N):S};let be=!1;const me=(T,S,N)=>{T==null?S._vnode&&we(S._vnode,null,null,!0):A(S._vnode||null,T,S,null,null,null,N),S._vnode=T,be||(be=!0,eg(),h_(),be=!1)},Te={p:A,um:we,m:De,r:Fe,mt:ze,mc:I,pc:je,pbc:P,n:Q,o:n};let Qe,ut;return e&&([Qe,ut]=e(Te)),{render:me,hydrate:Qe,createApp:iT(me,Qe)}}function Vh({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function Mi({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function pT(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function C_(n,e,t=!1){const r=n.children,s=e.children;if(Ue(r)&&Ue(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=Gs(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&C_(o,a)),a.type===Nd&&(a.el=o.el),a.type===li&&!a.el&&(a.el=o.el)}}function mT(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<c?i=a+1:o=a;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function k_(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:k_(e)}function ag(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const gT=Symbol.for("v-scx"),vT=()=>Ir(gT);function sn(n,e,t){return D_(n,e,t)}function D_(n,e,t=Et){const{immediate:r,deep:s,flush:i,once:o}=t,a=bn({},t),l=e&&r||!e&&i!=="post";let c;if(Gl){if(i==="sync"){const y=vT();c=y.__watcherHandles||(y.__watcherHandles=[])}else if(!l){const y=()=>{};return y.stop=br,y.resume=br,y.pause=br,y}}const d=Vn;a.call=(y,C,A)=>Ur(y,d,C,A);let f=!1;i==="post"?a.scheduler=y=>{er(y,d&&d.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(y,C)=>{C?y():hp(y)}),a.augmentJob=y=>{e&&(y.flags|=4),f&&(y.flags|=2,d&&(y.id=d.uid,y.i=d))};const v=kE(n,e,a);return Gl&&(c?c.push(v):l&&v()),v}function yT(n,e,t){const r=this.proxy,s=on(n)?n.includes(".")?V_(r,n):()=>r[n]:n.bind(r,r);let i;He(e)?i=e:(i=e.handler,t=e);const o=gu(this),a=D_(s,i.bind(r),t);return o(),a}function V_(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const _T=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${ur(e)}Modifiers`]||n[`${vi(e)}Modifiers`];function bT(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||Et;let s=t;const i=e.startsWith("update:"),o=i&&_T(r,e.slice(7));o&&(o.trim&&(s=t.map(d=>on(d)?d.trim():d)),o.number&&(s=t.map(lf)));let a,l=r[a=Sh(e)]||r[a=Sh(ur(e))];!l&&i&&(l=r[a=Sh(vi(e))]),l&&Ur(l,n,6,s);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,Ur(c,n,6,s)}}function N_(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!He(n)){const l=c=>{const d=N_(c,e,!0);d&&(a=!0,bn(o,d))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(Rt(n)&&r.set(n,null),null):(Ue(i)?i.forEach(l=>o[l]=null):bn(o,i),Rt(n)&&r.set(n,o),o)}function Vd(n,e){return!n||!Ed(e)?!1:(e=e.slice(2).replace(/Once$/,""),mt(n,e[0].toLowerCase()+e.slice(1))||mt(n,vi(e))||mt(n,e))}function Nh(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:c,renderCache:d,props:f,data:v,setupState:y,ctx:C,inheritAttrs:A}=n,k=Qc(n);let $,B;try{if(t.shapeFlag&4){const z=s||r,ne=z;$=Cr(c.call(ne,z,d,f,y,v,C)),B=a}else{const z=e;$=Cr(z.length>1?z(f,{attrs:a,slots:o,emit:l}):z(f,null)),B=e.props?a:wT(a)}}catch(z){Dl.length=0,kd(z,n,1),$=_t(li)}let F=$;if(B&&A!==!1){const z=Object.keys(B),{shapeFlag:ne}=F;z.length&&ne&7&&(i&&z.some(np)&&(B=IT(B,i)),F=ha(F,B,!1,!0))}return t.dirs&&(F=ha(F,null,!1,!0),F.dirs=F.dirs?F.dirs.concat(t.dirs):t.dirs),t.transition&&fp(F,t.transition),$=F,Qc(k),$}const wT=n=>{let e;for(const t in n)(t==="class"||t==="style"||Ed(t))&&((e||(e={}))[t]=n[t]);return e},IT=(n,e)=>{const t={};for(const r in n)(!np(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function ET(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?lg(r,o,c):!!o;if(l&8){const d=e.dynamicProps;for(let f=0;f<d.length;f++){const v=d[f];if(o[v]!==r[v]&&!Vd(c,v))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?lg(r,o,c):!0:!!o;return!1}function lg(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!Vd(t,i))return!0}return!1}function TT({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const O_=n=>n.__isSuspense;function xT(n,e){e&&e.pendingBranch?Ue(n)?e.effects.push(...n):e.effects.push(n):NE(n)}const St=Symbol.for("v-fgt"),Nd=Symbol.for("v-txt"),li=Symbol.for("v-cmt"),Rc=Symbol.for("v-stc"),Dl=[];let nr=null;function U(n=!1){Dl.push(nr=n?null:[])}function AT(){Dl.pop(),nr=Dl[Dl.length-1]||null}let zl=1;function ug(n,e=!1){zl+=n,n<0&&nr&&e&&(nr.hasOnce=!0)}function M_(n){return n.dynamicChildren=zl>0?nr||Zo:null,AT(),zl>0&&nr&&nr.push(n),n}function j(n,e,t,r,s,i){return M_(p(n,e,t,r,s,i,!0))}function vp(n,e,t,r,s){return M_(_t(n,e,t,r,s,!0))}function Yc(n){return n?n.__v_isVNode===!0:!1}function ll(n,e){return n.type===e.type&&n.key===e.key}const L_=({key:n})=>n??null,Cc=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?on(n)||On(n)||He(n)?{i:tr,r:n,k:e,f:!!t}:n:null);function p(n,e=null,t=null,r=0,s=null,i=n===St?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&L_(e),ref:e&&Cc(e),scopeId:p_,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:tr};return a?(yp(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=on(t)?8:16),zl>0&&!o&&nr&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&nr.push(l),l}const _t=ST;function ST(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===JE)&&(n=li),Yc(n)){const a=ha(n,e,!0);return t&&yp(a,t),zl>0&&!i&&nr&&(a.shapeFlag&6?nr[nr.indexOf(n)]=a:nr.push(a)),a.patchFlag=-2,a}if(FT(n)&&(n=n.__vccOpts),e){e=PT(e);let{class:a,style:l}=e;a&&!on(a)&&(e.class=Hn(a)),Rt(l)&&(dp(l)&&!Ue(l)&&(l=bn({},l)),e.style=Hs(l))}const o=on(n)?1:O_(n)?128:LE(n)?64:Rt(n)?4:He(n)?2:0;return p(n,e,t,r,s,o,i,!0)}function PT(n){return n?dp(n)||T_(n)?bn({},n):n:null}function ha(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,c=e?RT(s||{},e):s,d={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&L_(c),ref:e&&e.ref?t&&i?Ue(i)?i.concat(Cc(e)):[i,Cc(e)]:Cc(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==St?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&ha(n.ssContent),ssFallback:n.ssFallback&&ha(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&fp(d,l.clone(d)),d}function $n(n=" ",e=0){return _t(Nd,null,n,e)}function yr(n,e){const t=_t(Rc,null,n);return t.staticCount=e,t}function ae(n="",e=!1){return e?(U(),vp(li,null,n)):_t(li,null,n)}function Cr(n){return n==null||typeof n=="boolean"?_t(li):Ue(n)?_t(St,null,n.slice()):Yc(n)?Gs(n):_t(Nd,null,String(n))}function Gs(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:ha(n)}function yp(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(Ue(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),yp(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!T_(e)?e._ctx=tr:s===3&&tr&&(tr.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else He(e)?(e={default:e,_ctx:tr},t=32):(e=String(e),r&64?(t=16,e=[$n(e)]):t=8);n.children=e,n.shapeFlag|=t}function RT(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=Hn([e.class,r.class]));else if(s==="style")e.style=Hs([e.style,r.style]);else if(Ed(s)){const i=e[s],o=r[s];o&&i!==o&&!(Ue(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function Pr(n,e,t,r=null){Ur(n,e,7,[t,r])}const CT=w_();let kT=0;function DT(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||CT,i={uid:kT++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new sE(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:A_(r,s),emitsOptions:N_(r,s),emit:null,emitted:null,propsDefaults:Et,inheritAttrs:r.inheritAttrs,ctx:Et,data:Et,props:Et,attrs:Et,slots:Et,refs:Et,setupState:Et,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=bT.bind(null,i),n.ce&&n.ce(i),i}let Vn=null,Xc,vf;{const n=Sd(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};Xc=e("__VUE_INSTANCE_SETTERS__",t=>Vn=t),vf=e("__VUE_SSR_SETTERS__",t=>Gl=t)}const gu=n=>{const e=Vn;return Xc(n),n.scope.on(),()=>{n.scope.off(),Xc(e)}},cg=()=>{Vn&&Vn.scope.off(),Xc(null)};function F_(n){return n.vnode.shapeFlag&4}let Gl=!1;function VT(n,e=!1,t=!1){e&&vf(e);const{props:r,children:s}=n.vnode,i=F_(n);oT(n,r,i,e),cT(n,s,t||e);const o=i?NT(n,e):void 0;return e&&vf(!1),o}function NT(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,XE);const{setup:r}=t;if(r){ps();const s=n.setupContext=r.length>1?MT(n):null,i=gu(n),o=mu(r,n,0,[n.props,s]),a=Uy(o);if(ms(),i(),(a||n.sp)&&!Rl(n)&&g_(n),a){if(o.then(cg,cg),e)return o.then(l=>{dg(n,l,e)}).catch(l=>{kd(l,n,0)});n.asyncDep=o}else dg(n,o,e)}else U_(n,e)}function dg(n,e,t){He(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:Rt(e)&&(n.setupState=u_(e)),U_(n,t)}let hg;function U_(n,e,t){const r=n.type;if(!n.render){if(!e&&hg&&!r.render){const s=r.template||pp(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,c=bn(bn({isCustomElement:i,delimiters:a},o),l);r.render=hg(s,c)}}n.render=r.render||br}{const s=gu(n);ps();try{ZE(n)}finally{ms(),s()}}}const OT={get(n,e){return Dn(n,"get",""),n[e]}};function MT(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,OT),slots:n.slots,emit:n.emit,expose:e}}function Od(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(u_(TE(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in kl)return kl[t](n)},has(e,t){return t in e||t in kl}})):n.proxy}function LT(n,e=!0){return He(n)?n.displayName||n.name:n.name||e&&n.__name}function FT(n){return He(n)&&"__vccOpts"in n}const nt=(n,e)=>RE(n,e,Gl);function $_(n,e,t){const r=arguments.length;return r===2?Rt(e)&&!Ue(e)?Yc(e)?_t(n,null,[e]):_t(n,e):_t(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&Yc(t)&&(t=[t]),_t(n,e,t))}const UT="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let yf;const fg=typeof window<"u"&&window.trustedTypes;if(fg)try{yf=fg.createPolicy("vue",{createHTML:n=>n})}catch{}const j_=yf?n=>yf.createHTML(n):n=>n,$T="http://www.w3.org/2000/svg",jT="http://www.w3.org/1998/Math/MathML",is=typeof document<"u"?document:null,pg=is&&is.createElement("template"),BT={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?is.createElementNS($T,n):e==="mathml"?is.createElementNS(jT,n):t?is.createElement(n,{is:t}):is.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>is.createTextNode(n),createComment:n=>is.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>is.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{pg.innerHTML=j_(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=pg.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},qT=Symbol("_vtc");function zT(n,e,t){const r=n[qT];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const Zc=Symbol("_vod"),B_=Symbol("_vsh"),Oh={beforeMount(n,{value:e},{transition:t}){n[Zc]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):ul(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),ul(n,!0),r.enter(n)):r.leave(n,()=>{ul(n,!1)}):ul(n,e))},beforeUnmount(n,{value:e}){ul(n,e)}};function ul(n,e){n.style.display=e?n[Zc]:"none",n[B_]=!e}const GT=Symbol(""),KT=/(^|;)\s*display\s*:/;function HT(n,e,t){const r=n.style,s=on(t);let i=!1;if(t&&!s){if(e)if(on(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&kc(r,a,"")}else for(const o in e)t[o]==null&&kc(r,o,"");for(const o in t)o==="display"&&(i=!0),kc(r,o,t[o])}else if(s){if(e!==t){const o=r[GT];o&&(t+=";"+o),r.cssText=t,i=KT.test(t)}}else e&&n.removeAttribute("style");Zc in n&&(n[Zc]=i?r.display:"",n[B_]&&(r.display="none"))}const mg=/\s*!important$/;function kc(n,e,t){if(Ue(t))t.forEach(r=>kc(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=WT(n,e);mg.test(t)?n.setProperty(vi(r),t.replace(mg,""),"important"):n[r]=t}}const gg=["Webkit","Moz","ms"],Mh={};function WT(n,e){const t=Mh[e];if(t)return t;let r=ur(e);if(r!=="filter"&&r in n)return Mh[e]=r;r=Ad(r);for(let s=0;s<gg.length;s++){const i=gg[s]+r;if(i in n)return Mh[e]=i}return e}const vg="http://www.w3.org/1999/xlink";function yg(n,e,t,r,s,i=nE(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(vg,e.slice(6,e.length)):n.setAttributeNS(vg,e,t):t==null||i&&!By(t)?n.removeAttribute(e):n.setAttribute(e,i?"":Fr(t)?String(t):t)}function _g(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?j_(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=By(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function ji(n,e,t,r){n.addEventListener(e,t,r)}function QT(n,e,t,r){n.removeEventListener(e,t,r)}const bg=Symbol("_vei");function JT(n,e,t,r,s=null){const i=n[bg]||(n[bg]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=YT(e);if(r){const c=i[e]=ex(r,s);ji(n,a,c,l)}else o&&(QT(n,a,o,l),i[e]=void 0)}}const wg=/(?:Once|Passive|Capture)$/;function YT(n){let e;if(wg.test(n)){e={};let r;for(;r=n.match(wg);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):vi(n.slice(2)),e]}let Lh=0;const XT=Promise.resolve(),ZT=()=>Lh||(XT.then(()=>Lh=0),Lh=Date.now());function ex(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;Ur(tx(r,t.value),e,5,[r])};return t.value=n,t.attached=ZT(),t}function tx(n,e){if(Ue(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const Ig=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,nx=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?zT(n,r,o):e==="style"?HT(n,t,r):Ed(e)?np(e)||JT(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):rx(n,e,r,o))?(_g(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&yg(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!on(r))?_g(n,ur(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),yg(n,e,r,o))};function rx(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&Ig(e)&&He(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Ig(e)&&on(t)?!1:e in n}const ed=n=>{const e=n.props["onUpdate:modelValue"]||!1;return Ue(e)?t=>Sc(e,t):e};function sx(n){n.target.composing=!0}function Eg(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const sa=Symbol("_assign"),Ft={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[sa]=ed(s);const i=r||s.props&&s.props.type==="number";ji(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=lf(a)),n[sa](a)}),t&&ji(n,"change",()=>{n.value=n.value.trim()}),e||(ji(n,"compositionstart",sx),ji(n,"compositionend",Eg),ji(n,"change",Eg))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[sa]=ed(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?lf(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},Tg={deep:!0,created(n,e,t){n[sa]=ed(t),ji(n,"change",()=>{const r=n._modelValue,s=ix(n),i=n.checked,o=n[sa];if(Ue(r)){const a=qy(r,s),l=a!==-1;if(i&&!l)o(r.concat(s));else if(!i&&l){const c=[...r];c.splice(a,1),o(c)}}else if(Td(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o(q_(n,i))})},mounted:xg,beforeUpdate(n,e,t){n[sa]=ed(t),xg(n,e,t)}};function xg(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(Ue(e))s=qy(e,r.props.value)>-1;else if(Td(e))s=e.has(r.props.value);else{if(e===t)return;s=Pd(e,q_(n,!0))}n.checked!==s&&(n.checked=s)}function ix(n){return"_value"in n?n._value:n.value}function q_(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const ox=["ctrl","shift","alt","meta"],ax={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>ox.some(t=>n[`${t}Key`]&&!e.includes(t))},Kt=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=ax[e[o]];if(a&&a(s,e))return}return n(s,...i)})},lx={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Cn=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=vi(s.key);if(e.some(o=>o===i||lx[o]===i))return n(s)})},ux=bn({patchProp:nx},BT);let Ag;function cx(){return Ag||(Ag=hT(ux))}const dx=(...n)=>{const e=cx().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=fx(r);if(!s)return;const i=e._component;!He(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,hx(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function hx(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function fx(n){return on(n)?document.querySelector(n):n}const px={__name:"App",setup(n){return(e,t)=>{const r=QE("router-view");return U(),vp(r)}}};/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const Wo=typeof document<"u";function z_(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function mx(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&z_(n.default)}const ft=Object.assign;function Fh(n,e){const t={};for(const r in e){const s=e[r];t[r]=Er(s)?s.map(n):n(s)}return t}const Vl=()=>{},Er=Array.isArray,G_=/#/g,gx=/&/g,vx=/\//g,yx=/=/g,_x=/\?/g,K_=/\+/g,bx=/%5B/g,wx=/%5D/g,H_=/%5E/g,Ix=/%60/g,W_=/%7B/g,Ex=/%7C/g,Q_=/%7D/g,Tx=/%20/g;function _p(n){return encodeURI(""+n).replace(Ex,"|").replace(bx,"[").replace(wx,"]")}function xx(n){return _p(n).replace(W_,"{").replace(Q_,"}").replace(H_,"^")}function _f(n){return _p(n).replace(K_,"%2B").replace(Tx,"+").replace(G_,"%23").replace(gx,"%26").replace(Ix,"`").replace(W_,"{").replace(Q_,"}").replace(H_,"^")}function Ax(n){return _f(n).replace(yx,"%3D")}function Sx(n){return _p(n).replace(G_,"%23").replace(_x,"%3F")}function Px(n){return n==null?"":Sx(n).replace(vx,"%2F")}function Kl(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const Rx=/\/$/,Cx=n=>n.replace(Rx,"");function Uh(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=Nx(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:Kl(o)}}function kx(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function Sg(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function Dx(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&fa(e.matched[r],t.matched[s])&&J_(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function fa(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function J_(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!Vx(n[t],e[t]))return!1;return!0}function Vx(n,e){return Er(n)?Pg(n,e):Er(e)?Pg(e,n):n===e}function Pg(n,e){return Er(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function Nx(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const $s={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Hl;(function(n){n.pop="pop",n.push="push"})(Hl||(Hl={}));var Nl;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Nl||(Nl={}));function Ox(n){if(!n)if(Wo){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),Cx(n)}const Mx=/^[^#]+#/;function Lx(n,e){return n.replace(Mx,"#")+e}function Fx(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const Md=()=>({left:window.scrollX,top:window.scrollY});function Ux(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=Fx(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function Rg(n,e){return(history.state?history.state.position-e:-1)+n}const bf=new Map;function $x(n,e){bf.set(n,e)}function jx(n){const e=bf.get(n);return bf.delete(n),e}let Bx=()=>location.protocol+"//"+location.host;function Y_(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),Sg(l,"")}return Sg(t,n)+r+s}function qx(n,e,t,r){let s=[],i=[],o=null;const a=({state:v})=>{const y=Y_(n,location),C=t.value,A=e.value;let k=0;if(v){if(t.value=y,e.value=v,o&&o===C){o=null;return}k=A?v.position-A.position:0}else r(y);s.forEach($=>{$(t.value,C,{delta:k,type:Hl.pop,direction:k?k>0?Nl.forward:Nl.back:Nl.unknown})})};function l(){o=t.value}function c(v){s.push(v);const y=()=>{const C=s.indexOf(v);C>-1&&s.splice(C,1)};return i.push(y),y}function d(){const{history:v}=window;v.state&&v.replaceState(ft({},v.state,{scroll:Md()}),"")}function f(){for(const v of i)v();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",d)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",d,{passive:!0}),{pauseListeners:l,listen:c,destroy:f}}function Cg(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?Md():null}}function zx(n){const{history:e,location:t}=window,r={value:Y_(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,c,d){const f=n.indexOf("#"),v=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:Bx()+n+l;try{e[d?"replaceState":"pushState"](c,"",v),s.value=c}catch(y){console.error(y),t[d?"replace":"assign"](v)}}function o(l,c){const d=ft({},e.state,Cg(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});i(l,d,!0),r.value=l}function a(l,c){const d=ft({},s.value,e.state,{forward:l,scroll:Md()});i(d.current,d,!0);const f=ft({},Cg(r.value,l,null),{position:d.position+1},c);i(l,f,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function Gx(n){n=Ox(n);const e=zx(n),t=qx(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=ft({location:"",base:n,go:r,createHref:Lx.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function Kx(n){return typeof n=="string"||n&&typeof n=="object"}function X_(n){return typeof n=="string"||typeof n=="symbol"}const Z_=Symbol("");var kg;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(kg||(kg={}));function pa(n,e){return ft(new Error,{type:n,[Z_]:!0},e)}function ss(n,e){return n instanceof Error&&Z_ in n&&(e==null||!!(n.type&e))}const Dg="[^/]+?",Hx={sensitive:!1,strict:!1,start:!0,end:!0},Wx=/[.+*?^${}()[\]/\\]/g;function Qx(n,e){const t=ft({},Hx,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const d=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let f=0;f<c.length;f++){const v=c[f];let y=40+(t.sensitive?.25:0);if(v.type===0)f||(s+="/"),s+=v.value.replace(Wx,"\\$&"),y+=40;else if(v.type===1){const{value:C,repeatable:A,optional:k,regexp:$}=v;i.push({name:C,repeatable:A,optional:k});const B=$||Dg;if(B!==Dg){y+=10;try{new RegExp(`(${B})`)}catch(z){throw new Error(`Invalid custom RegExp for param "${C}" (${B}): `+z.message)}}let F=A?`((?:${B})(?:/(?:${B}))*)`:`(${B})`;f||(F=k&&c.length<2?`(?:/${F})`:"/"+F),k&&(F+="?"),s+=F,y+=20,k&&(y+=-8),A&&(y+=-20),B===".*"&&(y+=-50)}d.push(y)}r.push(d)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const d=c.match(o),f={};if(!d)return null;for(let v=1;v<d.length;v++){const y=d[v]||"",C=i[v-1];f[C.name]=y&&C.repeatable?y.split("/"):y}return f}function l(c){let d="",f=!1;for(const v of n){(!f||!d.endsWith("/"))&&(d+="/"),f=!1;for(const y of v)if(y.type===0)d+=y.value;else if(y.type===1){const{value:C,repeatable:A,optional:k}=y,$=C in c?c[C]:"";if(Er($)&&!A)throw new Error(`Provided param "${C}" is an array but it is not repeatable (* or + modifiers)`);const B=Er($)?$.join("/"):$;if(!B)if(k)v.length<2&&(d.endsWith("/")?d=d.slice(0,-1):f=!0);else throw new Error(`Missing required param "${C}"`);d+=B}}return d||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function Jx(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function e0(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=Jx(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(Vg(r))return 1;if(Vg(s))return-1}return s.length-r.length}function Vg(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const Yx={type:0,value:""},Xx=/[a-zA-Z0-9_]/;function Zx(n){if(!n)return[[]];if(n==="/")return[[Yx]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(y){throw new Error(`ERR (${t})/"${c}": ${y}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,c="",d="";function f(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:d,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function v(){c+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(c&&f(),o()):l===":"?(f(),t=1):v();break;case 4:v(),t=r;break;case 1:l==="("?t=2:Xx.test(l)?v():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?d[d.length-1]=="\\"?d=d.slice(0,-1)+l:t=3:d+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,d="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),f(),o(),s}function eA(n,e,t){const r=Qx(Zx(n.path),t),s=ft(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function tA(n,e){const t=[],r=new Map;e=Lg({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,v,y){const C=!y,A=Og(f);A.aliasOf=y&&y.record;const k=Lg(e,f),$=[A];if("alias"in f){const z=typeof f.alias=="string"?[f.alias]:f.alias;for(const ne of z)$.push(Og(ft({},A,{components:y?y.record.components:A.components,path:ne,aliasOf:y?y.record:A})))}let B,F;for(const z of $){const{path:ne}=z;if(v&&ne[0]!=="/"){const re=v.record.path,E=re[re.length-1]==="/"?"":"/";z.path=v.record.path+(ne&&E+ne)}if(B=eA(z,v,k),y?y.alias.push(B):(F=F||B,F!==B&&F.alias.push(B),C&&f.name&&!Mg(B)&&o(f.name)),t0(B)&&l(B),A.children){const re=A.children;for(let E=0;E<re.length;E++)i(re[E],B,y&&y.children[E])}y=y||B}return F?()=>{o(F)}:Vl}function o(f){if(X_(f)){const v=r.get(f);v&&(r.delete(f),t.splice(t.indexOf(v),1),v.children.forEach(o),v.alias.forEach(o))}else{const v=t.indexOf(f);v>-1&&(t.splice(v,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function l(f){const v=sA(f,t);t.splice(v,0,f),f.record.name&&!Mg(f)&&r.set(f.record.name,f)}function c(f,v){let y,C={},A,k;if("name"in f&&f.name){if(y=r.get(f.name),!y)throw pa(1,{location:f});k=y.record.name,C=ft(Ng(v.params,y.keys.filter(F=>!F.optional).concat(y.parent?y.parent.keys.filter(F=>F.optional):[]).map(F=>F.name)),f.params&&Ng(f.params,y.keys.map(F=>F.name))),A=y.stringify(C)}else if(f.path!=null)A=f.path,y=t.find(F=>F.re.test(A)),y&&(C=y.parse(A),k=y.record.name);else{if(y=v.name?r.get(v.name):t.find(F=>F.re.test(v.path)),!y)throw pa(1,{location:f,currentLocation:v});k=y.record.name,C=ft({},v.params,f.params),A=y.stringify(C)}const $=[];let B=y;for(;B;)$.unshift(B.record),B=B.parent;return{name:k,path:A,params:C,matched:$,meta:rA($)}}n.forEach(f=>i(f));function d(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:o,clearRoutes:d,getRoutes:a,getRecordMatcher:s}}function Ng(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function Og(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:nA(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function nA(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function Mg(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function rA(n){return n.reduce((e,t)=>ft(e,t.meta),{})}function Lg(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function sA(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;e0(n,e[i])<0?r=i:t=i+1}const s=iA(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function iA(n){let e=n;for(;e=e.parent;)if(t0(e)&&e0(n,e)===0)return e}function t0({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function oA(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(K_," "),o=i.indexOf("="),a=Kl(o<0?i:i.slice(0,o)),l=o<0?null:Kl(i.slice(o+1));if(a in e){let c=e[a];Er(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function Fg(n){let e="";for(let t in n){const r=n[t];if(t=Ax(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(Er(r)?r.map(i=>i&&_f(i)):[r&&_f(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function aA(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=Er(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const lA=Symbol(""),Ug=Symbol(""),Ld=Symbol(""),bp=Symbol(""),wf=Symbol("");function cl(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function Ks(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const c=v=>{v===!1?l(pa(4,{from:t,to:e})):v instanceof Error?l(v):Kx(v)?l(pa(2,{from:e,to:v})):(o&&r.enterCallbacks[s]===o&&typeof v=="function"&&o.push(v),a())},d=i(()=>n.call(r&&r.instances[s],e,t,c));let f=Promise.resolve(d);n.length<3&&(f=f.then(c)),f.catch(v=>l(v))})}function $h(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(z_(l)){const d=(l.__vccOpts||l)[e];d&&i.push(Ks(d,t,r,o,a,s))}else{let c=l();i.push(()=>c.then(d=>{if(!d)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=mx(d)?d.default:d;o.mods[a]=d,o.components[a]=f;const y=(f.__vccOpts||f)[e];return y&&Ks(y,t,r,o,a,s)()}))}}return i}function $g(n){const e=Ir(Ld),t=Ir(bp),r=nt(()=>{const l=hs(n.to);return e.resolve(l)}),s=nt(()=>{const{matched:l}=r.value,{length:c}=l,d=l[c-1],f=t.matched;if(!d||!f.length)return-1;const v=f.findIndex(fa.bind(null,d));if(v>-1)return v;const y=jg(l[c-2]);return c>1&&jg(d)===y&&f[f.length-1].path!==y?f.findIndex(fa.bind(null,l[c-2])):v}),i=nt(()=>s.value>-1&&fA(t.params,r.value.params)),o=nt(()=>s.value>-1&&s.value===t.matched.length-1&&J_(t.params,r.value.params));function a(l={}){if(hA(l)){const c=e[hs(n.replace)?"replace":"push"](hs(n.to)).catch(Vl);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:nt(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function uA(n){return n.length===1?n[0]:n}const cA=m_({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:$g,setup(n,{slots:e}){const t=Cd($g(n)),{options:r}=Ir(Ld),s=nt(()=>({[Bg(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[Bg(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&uA(e.default(t));return n.custom?i:$_("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),dA=cA;function hA(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function fA(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!Er(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function jg(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const Bg=(n,e,t)=>n??e??t,pA=m_({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=Ir(wf),s=nt(()=>n.route||r.value),i=Ir(Ug,0),o=nt(()=>{let c=hs(i);const{matched:d}=s.value;let f;for(;(f=d[c])&&!f.components;)c++;return c}),a=nt(()=>s.value.matched[o.value]);Pc(Ug,nt(()=>o.value+1)),Pc(lA,a),Pc(wf,s);const l=O();return sn(()=>[l.value,a.value,n.name],([c,d,f],[v,y,C])=>{d&&(d.instances[f]=c,y&&y!==d&&c&&c===v&&(d.leaveGuards.size||(d.leaveGuards=y.leaveGuards),d.updateGuards.size||(d.updateGuards=y.updateGuards))),c&&d&&(!y||!fa(d,y)||!v)&&(d.enterCallbacks[f]||[]).forEach(A=>A(c))},{flush:"post"}),()=>{const c=s.value,d=n.name,f=a.value,v=f&&f.components[d];if(!v)return qg(t.default,{Component:v,route:c});const y=f.props[d],C=y?y===!0?c.params:typeof y=="function"?y(c):y:null,k=$_(v,ft({},C,e,{onVnodeUnmounted:$=>{$.component.isUnmounted&&(f.instances[d]=null)},ref:l}));return qg(t.default,{Component:k,route:c})||k}}});function qg(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const mA=pA;function gA(n){const e=tA(n.routes,n),t=n.parseQuery||oA,r=n.stringifyQuery||Fg,s=n.history,i=cl(),o=cl(),a=cl(),l=xE($s);let c=$s;Wo&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const d=Fh.bind(null,Q=>""+Q),f=Fh.bind(null,Px),v=Fh.bind(null,Kl);function y(Q,be){let me,Te;return X_(Q)?(me=e.getRecordMatcher(Q),Te=be):Te=Q,e.addRoute(Te,me)}function C(Q){const be=e.getRecordMatcher(Q);be&&e.removeRoute(be)}function A(){return e.getRoutes().map(Q=>Q.record)}function k(Q){return!!e.getRecordMatcher(Q)}function $(Q,be){if(be=ft({},be||l.value),typeof Q=="string"){const S=Uh(t,Q,be.path),N=e.resolve({path:S.path},be),J=s.createHref(S.fullPath);return ft(S,N,{params:v(N.params),hash:Kl(S.hash),redirectedFrom:void 0,href:J})}let me;if(Q.path!=null)me=ft({},Q,{path:Uh(t,Q.path,be.path).path});else{const S=ft({},Q.params);for(const N in S)S[N]==null&&delete S[N];me=ft({},Q,{params:f(S)}),be.params=f(be.params)}const Te=e.resolve(me,be),Qe=Q.hash||"";Te.params=d(v(Te.params));const ut=kx(r,ft({},Q,{hash:xx(Qe),path:Te.path})),T=s.createHref(ut);return ft({fullPath:ut,hash:Qe,query:r===Fg?aA(Q.query):Q.query||{}},Te,{redirectedFrom:void 0,href:T})}function B(Q){return typeof Q=="string"?Uh(t,Q,l.value.path):ft({},Q)}function F(Q,be){if(c!==Q)return pa(8,{from:be,to:Q})}function z(Q){return E(Q)}function ne(Q){return z(ft(B(Q),{replace:!0}))}function re(Q){const be=Q.matched[Q.matched.length-1];if(be&&be.redirect){const{redirect:me}=be;let Te=typeof me=="function"?me(Q):me;return typeof Te=="string"&&(Te=Te.includes("?")||Te.includes("#")?Te=B(Te):{path:Te},Te.params={}),ft({query:Q.query,hash:Q.hash,params:Te.path!=null?{}:Q.params},Te)}}function E(Q,be){const me=c=$(Q),Te=l.value,Qe=Q.state,ut=Q.force,T=Q.replace===!0,S=re(me);if(S)return E(ft(B(S),{state:typeof S=="object"?ft({},Qe,S.state):Qe,force:ut,replace:T}),be||me);const N=me;N.redirectedFrom=be;let J;return!ut&&Dx(r,Te,me)&&(J=pa(16,{to:N,from:Te}),De(Te,Te,!0,!1)),(J?Promise.resolve(J):P(N,Te)).catch(W=>ss(W)?ss(W,2)?W:ee(W):je(W,N,Te)).then(W=>{if(W){if(ss(W,2))return E(ft({replace:T},B(W.to),{state:typeof W.to=="object"?ft({},Qe,W.to.state):Qe,force:ut}),be||N)}else W=V(N,Te,!0,T,Qe);return R(N,Te,W),W})}function I(Q,be){const me=F(Q,be);return me?Promise.reject(me):Promise.resolve()}function x(Q){const be=ct.values().next().value;return be&&typeof be.runWithContext=="function"?be.runWithContext(Q):Q()}function P(Q,be){let me;const[Te,Qe,ut]=vA(Q,be);me=$h(Te.reverse(),"beforeRouteLeave",Q,be);for(const S of Te)S.leaveGuards.forEach(N=>{me.push(Ks(N,Q,be))});const T=I.bind(null,Q,be);return me.push(T),wt(me).then(()=>{me=[];for(const S of i.list())me.push(Ks(S,Q,be));return me.push(T),wt(me)}).then(()=>{me=$h(Qe,"beforeRouteUpdate",Q,be);for(const S of Qe)S.updateGuards.forEach(N=>{me.push(Ks(N,Q,be))});return me.push(T),wt(me)}).then(()=>{me=[];for(const S of ut)if(S.beforeEnter)if(Er(S.beforeEnter))for(const N of S.beforeEnter)me.push(Ks(N,Q,be));else me.push(Ks(S.beforeEnter,Q,be));return me.push(T),wt(me)}).then(()=>(Q.matched.forEach(S=>S.enterCallbacks={}),me=$h(ut,"beforeRouteEnter",Q,be,x),me.push(T),wt(me))).then(()=>{me=[];for(const S of o.list())me.push(Ks(S,Q,be));return me.push(T),wt(me)}).catch(S=>ss(S,8)?S:Promise.reject(S))}function R(Q,be,me){a.list().forEach(Te=>x(()=>Te(Q,be,me)))}function V(Q,be,me,Te,Qe){const ut=F(Q,be);if(ut)return ut;const T=be===$s,S=Wo?history.state:{};me&&(Te||T?s.replace(Q.fullPath,ft({scroll:T&&S&&S.scroll},Qe)):s.push(Q.fullPath,Qe)),l.value=Q,De(Q,be,me,T),ee()}let w;function ze(){w||(w=s.listen((Q,be,me)=>{if(!hn.listening)return;const Te=$(Q),Qe=re(Te);if(Qe){E(ft(Qe,{replace:!0,force:!0}),Te).catch(Vl);return}c=Te;const ut=l.value;Wo&&$x(Rg(ut.fullPath,me.delta),Md()),P(Te,ut).catch(T=>ss(T,12)?T:ss(T,2)?(E(ft(B(T.to),{force:!0}),Te).then(S=>{ss(S,20)&&!me.delta&&me.type===Hl.pop&&s.go(-1,!1)}).catch(Vl),Promise.reject()):(me.delta&&s.go(-me.delta,!1),je(T,Te,ut))).then(T=>{T=T||V(Te,ut,!1),T&&(me.delta&&!ss(T,8)?s.go(-me.delta,!1):me.type===Hl.pop&&ss(T,20)&&s.go(-1,!1)),R(Te,ut,T)}).catch(Vl)}))}let Le=cl(),it=cl(),Ge;function je(Q,be,me){ee(Q);const Te=it.list();return Te.length?Te.forEach(Qe=>Qe(Q,be,me)):console.error(Q),Promise.reject(Q)}function ke(){return Ge&&l.value!==$s?Promise.resolve():new Promise((Q,be)=>{Le.add([Q,be])})}function ee(Q){return Ge||(Ge=!Q,ze(),Le.list().forEach(([be,me])=>Q?me(Q):be()),Le.reset()),Q}function De(Q,be,me,Te){const{scrollBehavior:Qe}=n;if(!Wo||!Qe)return Promise.resolve();const ut=!me&&jx(Rg(Q.fullPath,0))||(Te||!me)&&history.state&&history.state.scroll||null;return un().then(()=>Qe(Q,be,ut)).then(T=>T&&Ux(T)).catch(T=>je(T,Q,be))}const we=Q=>s.go(Q);let Fe;const ct=new Set,hn={currentRoute:l,listening:!0,addRoute:y,removeRoute:C,clearRoutes:e.clearRoutes,hasRoute:k,getRoutes:A,resolve:$,options:n,push:z,replace:ne,go:we,back:()=>we(-1),forward:()=>we(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:it.add,isReady:ke,install(Q){const be=this;Q.component("RouterLink",dA),Q.component("RouterView",mA),Q.config.globalProperties.$router=be,Object.defineProperty(Q.config.globalProperties,"$route",{enumerable:!0,get:()=>hs(l)}),Wo&&!Fe&&l.value===$s&&(Fe=!0,z(s.location).catch(Qe=>{}));const me={};for(const Qe in $s)Object.defineProperty(me,Qe,{get:()=>l.value[Qe],enumerable:!0});Q.provide(Ld,be),Q.provide(bp,o_(me)),Q.provide(wf,l);const Te=Q.unmount;ct.add(Q),Q.unmount=function(){ct.delete(Q),ct.size<1&&(c=$s,w&&w(),w=null,l.value=$s,Fe=!1,Ge=!1),Te()}}};function wt(Q){return Q.reduce((be,me)=>be.then(()=>x(me)),Promise.resolve())}return hn}function vA(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(c=>fa(c,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>fa(c,l))||s.push(l))}return[t,r,s]}function vu(){return Ir(Ld)}function yu(n){return Ir(bp)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n0=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},yA=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},r0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,d=i>>2,f=(i&3)<<4|a>>4;let v=(a&15)<<2|c>>6,y=c&63;l||(y=64,o||(v=64)),r.push(t[d],t[f],t[v],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(n0(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):yA(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||f==null)throw new _A;const v=i<<2|a>>4;if(r.push(v),c!==64){const y=a<<4&240|c>>2;if(r.push(y),f!==64){const C=c<<6&192|f;r.push(C)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class _A extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const bA=function(n){const e=n0(n);return r0.encodeByteArray(e,!0)},td=function(n){return bA(n).replace(/\./g,"")},s0=function(n){try{return r0.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wA(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IA=()=>wA().__FIREBASE_DEFAULTS__,EA=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},TA=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&s0(n[1]);return e&&JSON.parse(e)},Fd=()=>{try{return IA()||EA()||TA()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},i0=n=>{var e,t;return(t=(e=Fd())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},xA=n=>{const e=i0(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},o0=()=>{var n;return(n=Fd())===null||n===void 0?void 0:n.config},a0=n=>{var e;return(e=Fd())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AA{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SA(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[td(JSON.stringify(t)),td(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function PA(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(cn())}function RA(){var n;const e=(n=Fd())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function CA(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function kA(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function DA(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function VA(){const n=cn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function l0(){return!RA()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function u0(){try{return typeof indexedDB=="object"}catch{return!1}}function NA(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OA="FirebaseError";class Es extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=OA,Object.setPrototypeOf(this,Es.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,_u.prototype.create)}}class _u{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?MA(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Es(s,a,r)}}function MA(n,e){return n.replace(LA,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const LA=/\{\$([^}]+)}/g;function FA(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function ui(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(zg(i)&&zg(o)){if(!ui(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function zg(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Va(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function yl(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function _l(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function UA(n,e){const t=new $A(n,e);return t.subscribe.bind(t)}class $A{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");jA(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=jh),s.error===void 0&&(s.error=jh),s.complete===void 0&&(s.complete=jh);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function jA(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function jh(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Re(n){return n&&n._delegate?n._delegate:n}class Zi{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ui="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BA{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new AA;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(zA(e))try{this.getOrInitializeService({instanceIdentifier:Ui})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Ui){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ui){return this.instances.has(e)}getOptions(e=Ui){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:qA(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Ui){return this.component?this.component.multipleInstances?e:Ui:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function qA(n){return n===Ui?void 0:n}function zA(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GA{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new BA(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(tt||(tt={}));const KA={debug:tt.DEBUG,verbose:tt.VERBOSE,info:tt.INFO,warn:tt.WARN,error:tt.ERROR,silent:tt.SILENT},HA=tt.INFO,WA={[tt.DEBUG]:"log",[tt.VERBOSE]:"log",[tt.INFO]:"info",[tt.WARN]:"warn",[tt.ERROR]:"error"},QA=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=WA[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class wp{constructor(e){this.name=e,this._logLevel=HA,this._logHandler=QA,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in tt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?KA[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,tt.DEBUG,...e),this._logHandler(this,tt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,tt.VERBOSE,...e),this._logHandler(this,tt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,tt.INFO,...e),this._logHandler(this,tt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,tt.WARN,...e),this._logHandler(this,tt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,tt.ERROR,...e),this._logHandler(this,tt.ERROR,...e)}}const JA=(n,e)=>e.some(t=>n instanceof t);let Gg,Kg;function YA(){return Gg||(Gg=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function XA(){return Kg||(Kg=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const c0=new WeakMap,If=new WeakMap,d0=new WeakMap,Bh=new WeakMap,Ip=new WeakMap;function ZA(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(ri(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&c0.set(t,n)}).catch(()=>{}),Ip.set(e,n),e}function eS(n){if(If.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});If.set(n,e)}let Ef={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return If.get(n);if(e==="objectStoreNames")return n.objectStoreNames||d0.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ri(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function tS(n){Ef=n(Ef)}function nS(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(qh(this),e,...t);return d0.set(r,e.sort?e.sort():[e]),ri(r)}:XA().includes(n)?function(...e){return n.apply(qh(this),e),ri(c0.get(this))}:function(...e){return ri(n.apply(qh(this),e))}}function rS(n){return typeof n=="function"?nS(n):(n instanceof IDBTransaction&&eS(n),JA(n,YA())?new Proxy(n,Ef):n)}function ri(n){if(n instanceof IDBRequest)return ZA(n);if(Bh.has(n))return Bh.get(n);const e=rS(n);return e!==n&&(Bh.set(n,e),Ip.set(e,n)),e}const qh=n=>Ip.get(n);function sS(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=ri(o);return r&&o.addEventListener("upgradeneeded",l=>{r(ri(o.result),l.oldVersion,l.newVersion,ri(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const iS=["get","getKey","getAll","getAllKeys","count"],oS=["put","add","delete","clear"],zh=new Map;function Hg(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(zh.get(e))return zh.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=oS.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||iS.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return zh.set(e,i),i}tS(n=>({...n,get:(e,t,r)=>Hg(e,t)||n.get(e,t,r),has:(e,t)=>!!Hg(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aS{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(lS(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function lS(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Tf="@firebase/app",Wg="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gs=new wp("@firebase/app"),uS="@firebase/app-compat",cS="@firebase/analytics-compat",dS="@firebase/analytics",hS="@firebase/app-check-compat",fS="@firebase/app-check",pS="@firebase/auth",mS="@firebase/auth-compat",gS="@firebase/database",vS="@firebase/data-connect",yS="@firebase/database-compat",_S="@firebase/functions",bS="@firebase/functions-compat",wS="@firebase/installations",IS="@firebase/installations-compat",ES="@firebase/messaging",TS="@firebase/messaging-compat",xS="@firebase/performance",AS="@firebase/performance-compat",SS="@firebase/remote-config",PS="@firebase/remote-config-compat",RS="@firebase/storage",CS="@firebase/storage-compat",kS="@firebase/firestore",DS="@firebase/vertexai-preview",VS="@firebase/firestore-compat",NS="firebase",OS="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nd="[DEFAULT]",MS={[Tf]:"fire-core",[uS]:"fire-core-compat",[dS]:"fire-analytics",[cS]:"fire-analytics-compat",[fS]:"fire-app-check",[hS]:"fire-app-check-compat",[pS]:"fire-auth",[mS]:"fire-auth-compat",[gS]:"fire-rtdb",[vS]:"fire-data-connect",[yS]:"fire-rtdb-compat",[_S]:"fire-fn",[bS]:"fire-fn-compat",[wS]:"fire-iid",[IS]:"fire-iid-compat",[ES]:"fire-fcm",[TS]:"fire-fcm-compat",[xS]:"fire-perf",[AS]:"fire-perf-compat",[SS]:"fire-rc",[PS]:"fire-rc-compat",[RS]:"fire-gcs",[CS]:"fire-gcs-compat",[kS]:"fire-fst",[VS]:"fire-fst-compat",[DS]:"fire-vertex","fire-js":"fire-js",[NS]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rd=new Map,LS=new Map,xf=new Map;function Qg(n,e){try{n.container.addComponent(e)}catch(t){gs.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function ma(n){const e=n.name;if(xf.has(e))return gs.debug(`There were multiple attempts to register component ${e}.`),!1;xf.set(e,n);for(const t of rd.values())Qg(t,n);for(const t of LS.values())Qg(t,n);return!0}function bu(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function FS(n,e,t=nd){bu(n,e).clearInstance(t)}function Xt(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const US={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},si=new _u("app","Firebase",US);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $S{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Zi("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw si.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Na=OS;function h0(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:nd,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw si.create("bad-app-name",{appName:String(s)});if(t||(t=o0()),!t)throw si.create("no-options");const i=rd.get(s);if(i){if(ui(t,i.options)&&ui(r,i.config))return i;throw si.create("duplicate-app",{appName:s})}const o=new GA(s);for(const l of xf.values())o.addComponent(l);const a=new $S(t,r,o);return rd.set(s,a),a}function f0(n=nd){const e=rd.get(n);if(!e&&n===nd&&o0())return h0();if(!e)throw si.create("no-app",{appName:n});return e}function ii(n,e,t){var r;let s=(r=MS[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),gs.warn(a.join(" "));return}ma(new Zi(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jS="firebase-heartbeat-database",BS=1,Wl="firebase-heartbeat-store";let Gh=null;function p0(){return Gh||(Gh=sS(jS,BS,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Wl)}catch(t){console.warn(t)}}}}).catch(n=>{throw si.create("idb-open",{originalErrorMessage:n.message})})),Gh}async function qS(n){try{const t=(await p0()).transaction(Wl),r=await t.objectStore(Wl).get(m0(n));return await t.done,r}catch(e){if(e instanceof Es)gs.warn(e.message);else{const t=si.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});gs.warn(t.message)}}}async function Jg(n,e){try{const r=(await p0()).transaction(Wl,"readwrite");await r.objectStore(Wl).put(e,m0(n)),await r.done}catch(t){if(t instanceof Es)gs.warn(t.message);else{const r=si.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});gs.warn(r.message)}}}function m0(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zS=1024,GS=30*24*60*60*1e3;class KS{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new WS(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Yg();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=GS}),this._storage.overwrite(this._heartbeatsCache))}catch(r){gs.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Yg(),{heartbeatsToSend:r,unsentEntries:s}=HS(this._heartbeatsCache.heartbeats),i=td(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return gs.warn(t),""}}}function Yg(){return new Date().toISOString().substring(0,10)}function HS(n,e=zS){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),Xg(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Xg(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class WS{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return u0()?NA().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await qS(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Jg(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Jg(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Xg(n){return td(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QS(n){ma(new Zi("platform-logger",e=>new aS(e),"PRIVATE")),ma(new Zi("heartbeat",e=>new KS(e),"PRIVATE")),ii(Tf,Wg,n),ii(Tf,Wg,"esm2017"),ii("fire-js","")}QS("");var JS="firebase",YS="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ii(JS,YS,"app");var Zg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Qi,g0;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(E,I){function x(){}x.prototype=I.prototype,E.D=I.prototype,E.prototype=new x,E.prototype.constructor=E,E.C=function(P,R,V){for(var w=Array(arguments.length-2),ze=2;ze<arguments.length;ze++)w[ze-2]=arguments[ze];return I.prototype[R].apply(P,w)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,I,x){x||(x=0);var P=Array(16);if(typeof I=="string")for(var R=0;16>R;++R)P[R]=I.charCodeAt(x++)|I.charCodeAt(x++)<<8|I.charCodeAt(x++)<<16|I.charCodeAt(x++)<<24;else for(R=0;16>R;++R)P[R]=I[x++]|I[x++]<<8|I[x++]<<16|I[x++]<<24;I=E.g[0],x=E.g[1],R=E.g[2];var V=E.g[3],w=I+(V^x&(R^V))+P[0]+3614090360&4294967295;I=x+(w<<7&4294967295|w>>>25),w=V+(R^I&(x^R))+P[1]+3905402710&4294967295,V=I+(w<<12&4294967295|w>>>20),w=R+(x^V&(I^x))+P[2]+606105819&4294967295,R=V+(w<<17&4294967295|w>>>15),w=x+(I^R&(V^I))+P[3]+3250441966&4294967295,x=R+(w<<22&4294967295|w>>>10),w=I+(V^x&(R^V))+P[4]+4118548399&4294967295,I=x+(w<<7&4294967295|w>>>25),w=V+(R^I&(x^R))+P[5]+1200080426&4294967295,V=I+(w<<12&4294967295|w>>>20),w=R+(x^V&(I^x))+P[6]+2821735955&4294967295,R=V+(w<<17&4294967295|w>>>15),w=x+(I^R&(V^I))+P[7]+4249261313&4294967295,x=R+(w<<22&4294967295|w>>>10),w=I+(V^x&(R^V))+P[8]+1770035416&4294967295,I=x+(w<<7&4294967295|w>>>25),w=V+(R^I&(x^R))+P[9]+2336552879&4294967295,V=I+(w<<12&4294967295|w>>>20),w=R+(x^V&(I^x))+P[10]+4294925233&4294967295,R=V+(w<<17&4294967295|w>>>15),w=x+(I^R&(V^I))+P[11]+2304563134&4294967295,x=R+(w<<22&4294967295|w>>>10),w=I+(V^x&(R^V))+P[12]+1804603682&4294967295,I=x+(w<<7&4294967295|w>>>25),w=V+(R^I&(x^R))+P[13]+4254626195&4294967295,V=I+(w<<12&4294967295|w>>>20),w=R+(x^V&(I^x))+P[14]+2792965006&4294967295,R=V+(w<<17&4294967295|w>>>15),w=x+(I^R&(V^I))+P[15]+1236535329&4294967295,x=R+(w<<22&4294967295|w>>>10),w=I+(R^V&(x^R))+P[1]+4129170786&4294967295,I=x+(w<<5&4294967295|w>>>27),w=V+(x^R&(I^x))+P[6]+3225465664&4294967295,V=I+(w<<9&4294967295|w>>>23),w=R+(I^x&(V^I))+P[11]+643717713&4294967295,R=V+(w<<14&4294967295|w>>>18),w=x+(V^I&(R^V))+P[0]+3921069994&4294967295,x=R+(w<<20&4294967295|w>>>12),w=I+(R^V&(x^R))+P[5]+3593408605&4294967295,I=x+(w<<5&4294967295|w>>>27),w=V+(x^R&(I^x))+P[10]+38016083&4294967295,V=I+(w<<9&4294967295|w>>>23),w=R+(I^x&(V^I))+P[15]+3634488961&4294967295,R=V+(w<<14&4294967295|w>>>18),w=x+(V^I&(R^V))+P[4]+3889429448&4294967295,x=R+(w<<20&4294967295|w>>>12),w=I+(R^V&(x^R))+P[9]+568446438&4294967295,I=x+(w<<5&4294967295|w>>>27),w=V+(x^R&(I^x))+P[14]+3275163606&4294967295,V=I+(w<<9&4294967295|w>>>23),w=R+(I^x&(V^I))+P[3]+4107603335&4294967295,R=V+(w<<14&4294967295|w>>>18),w=x+(V^I&(R^V))+P[8]+1163531501&4294967295,x=R+(w<<20&4294967295|w>>>12),w=I+(R^V&(x^R))+P[13]+2850285829&4294967295,I=x+(w<<5&4294967295|w>>>27),w=V+(x^R&(I^x))+P[2]+4243563512&4294967295,V=I+(w<<9&4294967295|w>>>23),w=R+(I^x&(V^I))+P[7]+1735328473&4294967295,R=V+(w<<14&4294967295|w>>>18),w=x+(V^I&(R^V))+P[12]+2368359562&4294967295,x=R+(w<<20&4294967295|w>>>12),w=I+(x^R^V)+P[5]+4294588738&4294967295,I=x+(w<<4&4294967295|w>>>28),w=V+(I^x^R)+P[8]+2272392833&4294967295,V=I+(w<<11&4294967295|w>>>21),w=R+(V^I^x)+P[11]+1839030562&4294967295,R=V+(w<<16&4294967295|w>>>16),w=x+(R^V^I)+P[14]+4259657740&4294967295,x=R+(w<<23&4294967295|w>>>9),w=I+(x^R^V)+P[1]+2763975236&4294967295,I=x+(w<<4&4294967295|w>>>28),w=V+(I^x^R)+P[4]+1272893353&4294967295,V=I+(w<<11&4294967295|w>>>21),w=R+(V^I^x)+P[7]+4139469664&4294967295,R=V+(w<<16&4294967295|w>>>16),w=x+(R^V^I)+P[10]+3200236656&4294967295,x=R+(w<<23&4294967295|w>>>9),w=I+(x^R^V)+P[13]+681279174&4294967295,I=x+(w<<4&4294967295|w>>>28),w=V+(I^x^R)+P[0]+3936430074&4294967295,V=I+(w<<11&4294967295|w>>>21),w=R+(V^I^x)+P[3]+3572445317&4294967295,R=V+(w<<16&4294967295|w>>>16),w=x+(R^V^I)+P[6]+76029189&4294967295,x=R+(w<<23&4294967295|w>>>9),w=I+(x^R^V)+P[9]+3654602809&4294967295,I=x+(w<<4&4294967295|w>>>28),w=V+(I^x^R)+P[12]+3873151461&4294967295,V=I+(w<<11&4294967295|w>>>21),w=R+(V^I^x)+P[15]+530742520&4294967295,R=V+(w<<16&4294967295|w>>>16),w=x+(R^V^I)+P[2]+3299628645&4294967295,x=R+(w<<23&4294967295|w>>>9),w=I+(R^(x|~V))+P[0]+4096336452&4294967295,I=x+(w<<6&4294967295|w>>>26),w=V+(x^(I|~R))+P[7]+1126891415&4294967295,V=I+(w<<10&4294967295|w>>>22),w=R+(I^(V|~x))+P[14]+2878612391&4294967295,R=V+(w<<15&4294967295|w>>>17),w=x+(V^(R|~I))+P[5]+4237533241&4294967295,x=R+(w<<21&4294967295|w>>>11),w=I+(R^(x|~V))+P[12]+1700485571&4294967295,I=x+(w<<6&4294967295|w>>>26),w=V+(x^(I|~R))+P[3]+2399980690&4294967295,V=I+(w<<10&4294967295|w>>>22),w=R+(I^(V|~x))+P[10]+4293915773&4294967295,R=V+(w<<15&4294967295|w>>>17),w=x+(V^(R|~I))+P[1]+2240044497&4294967295,x=R+(w<<21&4294967295|w>>>11),w=I+(R^(x|~V))+P[8]+1873313359&4294967295,I=x+(w<<6&4294967295|w>>>26),w=V+(x^(I|~R))+P[15]+4264355552&4294967295,V=I+(w<<10&4294967295|w>>>22),w=R+(I^(V|~x))+P[6]+2734768916&4294967295,R=V+(w<<15&4294967295|w>>>17),w=x+(V^(R|~I))+P[13]+1309151649&4294967295,x=R+(w<<21&4294967295|w>>>11),w=I+(R^(x|~V))+P[4]+4149444226&4294967295,I=x+(w<<6&4294967295|w>>>26),w=V+(x^(I|~R))+P[11]+3174756917&4294967295,V=I+(w<<10&4294967295|w>>>22),w=R+(I^(V|~x))+P[2]+718787259&4294967295,R=V+(w<<15&4294967295|w>>>17),w=x+(V^(R|~I))+P[9]+3951481745&4294967295,E.g[0]=E.g[0]+I&4294967295,E.g[1]=E.g[1]+(R+(w<<21&4294967295|w>>>11))&4294967295,E.g[2]=E.g[2]+R&4294967295,E.g[3]=E.g[3]+V&4294967295}r.prototype.u=function(E,I){I===void 0&&(I=E.length);for(var x=I-this.blockSize,P=this.B,R=this.h,V=0;V<I;){if(R==0)for(;V<=x;)s(this,E,V),V+=this.blockSize;if(typeof E=="string"){for(;V<I;)if(P[R++]=E.charCodeAt(V++),R==this.blockSize){s(this,P),R=0;break}}else for(;V<I;)if(P[R++]=E[V++],R==this.blockSize){s(this,P),R=0;break}}this.h=R,this.o+=I},r.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var I=1;I<E.length-8;++I)E[I]=0;var x=8*this.o;for(I=E.length-8;I<E.length;++I)E[I]=x&255,x/=256;for(this.u(E),E=Array(16),I=x=0;4>I;++I)for(var P=0;32>P;P+=8)E[x++]=this.g[I]>>>P&255;return E};function i(E,I){var x=a;return Object.prototype.hasOwnProperty.call(x,E)?x[E]:x[E]=I(E)}function o(E,I){this.h=I;for(var x=[],P=!0,R=E.length-1;0<=R;R--){var V=E[R]|0;P&&V==I||(x[R]=V,P=!1)}this.g=x}var a={};function l(E){return-128<=E&&128>E?i(E,function(I){return new o([I|0],0>I?-1:0)}):new o([E|0],0>E?-1:0)}function c(E){if(isNaN(E)||!isFinite(E))return f;if(0>E)return k(c(-E));for(var I=[],x=1,P=0;E>=x;P++)I[P]=E/x|0,x*=4294967296;return new o(I,0)}function d(E,I){if(E.length==0)throw Error("number format error: empty string");if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(E.charAt(0)=="-")return k(d(E.substring(1),I));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var x=c(Math.pow(I,8)),P=f,R=0;R<E.length;R+=8){var V=Math.min(8,E.length-R),w=parseInt(E.substring(R,R+V),I);8>V?(V=c(Math.pow(I,V)),P=P.j(V).add(c(w))):(P=P.j(x),P=P.add(c(w)))}return P}var f=l(0),v=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(A(this))return-k(this).m();for(var E=0,I=1,x=0;x<this.g.length;x++){var P=this.i(x);E+=(0<=P?P:4294967296+P)*I,I*=4294967296}return E},n.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(C(this))return"0";if(A(this))return"-"+k(this).toString(E);for(var I=c(Math.pow(E,6)),x=this,P="";;){var R=z(x,I).g;x=$(x,R.j(I));var V=((0<x.g.length?x.g[0]:x.h)>>>0).toString(E);if(x=R,C(x))return V+P;for(;6>V.length;)V="0"+V;P=V+P}},n.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function C(E){if(E.h!=0)return!1;for(var I=0;I<E.g.length;I++)if(E.g[I]!=0)return!1;return!0}function A(E){return E.h==-1}n.l=function(E){return E=$(this,E),A(E)?-1:C(E)?0:1};function k(E){for(var I=E.g.length,x=[],P=0;P<I;P++)x[P]=~E.g[P];return new o(x,~E.h).add(v)}n.abs=function(){return A(this)?k(this):this},n.add=function(E){for(var I=Math.max(this.g.length,E.g.length),x=[],P=0,R=0;R<=I;R++){var V=P+(this.i(R)&65535)+(E.i(R)&65535),w=(V>>>16)+(this.i(R)>>>16)+(E.i(R)>>>16);P=w>>>16,V&=65535,w&=65535,x[R]=w<<16|V}return new o(x,x[x.length-1]&-2147483648?-1:0)};function $(E,I){return E.add(k(I))}n.j=function(E){if(C(this)||C(E))return f;if(A(this))return A(E)?k(this).j(k(E)):k(k(this).j(E));if(A(E))return k(this.j(k(E)));if(0>this.l(y)&&0>E.l(y))return c(this.m()*E.m());for(var I=this.g.length+E.g.length,x=[],P=0;P<2*I;P++)x[P]=0;for(P=0;P<this.g.length;P++)for(var R=0;R<E.g.length;R++){var V=this.i(P)>>>16,w=this.i(P)&65535,ze=E.i(R)>>>16,Le=E.i(R)&65535;x[2*P+2*R]+=w*Le,B(x,2*P+2*R),x[2*P+2*R+1]+=V*Le,B(x,2*P+2*R+1),x[2*P+2*R+1]+=w*ze,B(x,2*P+2*R+1),x[2*P+2*R+2]+=V*ze,B(x,2*P+2*R+2)}for(P=0;P<I;P++)x[P]=x[2*P+1]<<16|x[2*P];for(P=I;P<2*I;P++)x[P]=0;return new o(x,0)};function B(E,I){for(;(E[I]&65535)!=E[I];)E[I+1]+=E[I]>>>16,E[I]&=65535,I++}function F(E,I){this.g=E,this.h=I}function z(E,I){if(C(I))throw Error("division by zero");if(C(E))return new F(f,f);if(A(E))return I=z(k(E),I),new F(k(I.g),k(I.h));if(A(I))return I=z(E,k(I)),new F(k(I.g),I.h);if(30<E.g.length){if(A(E)||A(I))throw Error("slowDivide_ only works with positive integers.");for(var x=v,P=I;0>=P.l(E);)x=ne(x),P=ne(P);var R=re(x,1),V=re(P,1);for(P=re(P,2),x=re(x,2);!C(P);){var w=V.add(P);0>=w.l(E)&&(R=R.add(x),V=w),P=re(P,1),x=re(x,1)}return I=$(E,R.j(I)),new F(R,I)}for(R=f;0<=E.l(I);){for(x=Math.max(1,Math.floor(E.m()/I.m())),P=Math.ceil(Math.log(x)/Math.LN2),P=48>=P?1:Math.pow(2,P-48),V=c(x),w=V.j(I);A(w)||0<w.l(E);)x-=P,V=c(x),w=V.j(I);C(V)&&(V=v),R=R.add(V),E=$(E,w)}return new F(R,E)}n.A=function(E){return z(this,E).h},n.and=function(E){for(var I=Math.max(this.g.length,E.g.length),x=[],P=0;P<I;P++)x[P]=this.i(P)&E.i(P);return new o(x,this.h&E.h)},n.or=function(E){for(var I=Math.max(this.g.length,E.g.length),x=[],P=0;P<I;P++)x[P]=this.i(P)|E.i(P);return new o(x,this.h|E.h)},n.xor=function(E){for(var I=Math.max(this.g.length,E.g.length),x=[],P=0;P<I;P++)x[P]=this.i(P)^E.i(P);return new o(x,this.h^E.h)};function ne(E){for(var I=E.g.length+1,x=[],P=0;P<I;P++)x[P]=E.i(P)<<1|E.i(P-1)>>>31;return new o(x,E.h)}function re(E,I){var x=I>>5;I%=32;for(var P=E.g.length-x,R=[],V=0;V<P;V++)R[V]=0<I?E.i(V+x)>>>I|E.i(V+x+1)<<32-I:E.i(V+x);return new o(R,E.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,g0=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=d,Qi=o}).apply(typeof Zg<"u"?Zg:typeof self<"u"?self:typeof window<"u"?window:{});var vc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var v0,bl,y0,Dc,Af,_0,b0,w0;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,h,g){return u==Array.prototype||u==Object.prototype||(u[h]=g.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof vc=="object"&&vc];for(var h=0;h<u.length;++h){var g=u[h];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var r=t(this);function s(u,h){if(h)e:{var g=r;u=u.split(".");for(var b=0;b<u.length-1;b++){var M=u[b];if(!(M in g))break e;g=g[M]}u=u[u.length-1],b=g[u],h=h(b),h!=b&&h!=null&&e(g,u,{configurable:!0,writable:!0,value:h})}}function i(u,h){u instanceof String&&(u+="");var g=0,b=!1,M={next:function(){if(!b&&g<u.length){var G=g++;return{value:h(G,u[G]),done:!1}}return b=!0,{done:!0,value:void 0}}};return M[Symbol.iterator]=function(){return M},M}s("Array.prototype.values",function(u){return u||function(){return i(this,function(h,g){return g})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var h=typeof u;return h=h!="object"?h:u?Array.isArray(u)?"array":h:"null",h=="array"||h=="object"&&typeof u.length=="number"}function c(u){var h=typeof u;return h=="object"&&u!=null||h=="function"}function d(u,h,g){return u.call.apply(u.bind,arguments)}function f(u,h,g){if(!u)throw Error();if(2<arguments.length){var b=Array.prototype.slice.call(arguments,2);return function(){var M=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(M,b),u.apply(h,M)}}return function(){return u.apply(h,arguments)}}function v(u,h,g){return v=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,v.apply(null,arguments)}function y(u,h){var g=Array.prototype.slice.call(arguments,1);return function(){var b=g.slice();return b.push.apply(b,arguments),u.apply(this,b)}}function C(u,h){function g(){}g.prototype=h.prototype,u.aa=h.prototype,u.prototype=new g,u.prototype.constructor=u,u.Qb=function(b,M,G){for(var de=Array(arguments.length-2),dt=2;dt<arguments.length;dt++)de[dt-2]=arguments[dt];return h.prototype[M].apply(b,de)}}function A(u){const h=u.length;if(0<h){const g=Array(h);for(let b=0;b<h;b++)g[b]=u[b];return g}return[]}function k(u,h){for(let g=1;g<arguments.length;g++){const b=arguments[g];if(l(b)){const M=u.length||0,G=b.length||0;u.length=M+G;for(let de=0;de<G;de++)u[M+de]=b[de]}else u.push(b)}}class ${constructor(h,g){this.i=h,this.j=g,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function B(u){return/^[\s\xa0]*$/.test(u)}function F(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function z(u){return z[" "](u),u}z[" "]=function(){};var ne=F().indexOf("Gecko")!=-1&&!(F().toLowerCase().indexOf("webkit")!=-1&&F().indexOf("Edge")==-1)&&!(F().indexOf("Trident")!=-1||F().indexOf("MSIE")!=-1)&&F().indexOf("Edge")==-1;function re(u,h,g){for(const b in u)h.call(g,u[b],b,u)}function E(u,h){for(const g in u)h.call(void 0,u[g],g,u)}function I(u){const h={};for(const g in u)h[g]=u[g];return h}const x="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function P(u,h){let g,b;for(let M=1;M<arguments.length;M++){b=arguments[M];for(g in b)u[g]=b[g];for(let G=0;G<x.length;G++)g=x[G],Object.prototype.hasOwnProperty.call(b,g)&&(u[g]=b[g])}}function R(u){var h=1;u=u.split(":");const g=[];for(;0<h&&u.length;)g.push(u.shift()),h--;return u.length&&g.push(u.join(":")),g}function V(u){a.setTimeout(()=>{throw u},0)}function w(){var u=ke;let h=null;return u.g&&(h=u.g,u.g=u.g.next,u.g||(u.h=null),h.next=null),h}class ze{constructor(){this.h=this.g=null}add(h,g){const b=Le.get();b.set(h,g),this.h?this.h.next=b:this.g=b,this.h=b}}var Le=new $(()=>new it,u=>u.reset());class it{constructor(){this.next=this.g=this.h=null}set(h,g){this.h=h,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let Ge,je=!1,ke=new ze,ee=()=>{const u=a.Promise.resolve(void 0);Ge=()=>{u.then(De)}};var De=()=>{for(var u;u=w();){try{u.h.call(u.g)}catch(g){V(g)}var h=Le;h.j(u),100>h.h&&(h.h++,u.next=h.g,h.g=u)}je=!1};function we(){this.s=this.s,this.C=this.C}we.prototype.s=!1,we.prototype.ma=function(){this.s||(this.s=!0,this.N())},we.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Fe(u,h){this.type=u,this.g=this.target=h,this.defaultPrevented=!1}Fe.prototype.h=function(){this.defaultPrevented=!0};var ct=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,h=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const g=()=>{};a.addEventListener("test",g,h),a.removeEventListener("test",g,h)}catch{}return u}();function hn(u,h){if(Fe.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var g=this.type=u.type,b=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=h,h=u.relatedTarget){if(ne){e:{try{z(h.nodeName);var M=!0;break e}catch{}M=!1}M||(h=null)}}else g=="mouseover"?h=u.fromElement:g=="mouseout"&&(h=u.toElement);this.relatedTarget=h,b?(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:wt[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&hn.aa.h.call(this)}}C(hn,Fe);var wt={2:"touch",3:"pen",4:"mouse"};hn.prototype.h=function(){hn.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var Q="closure_listenable_"+(1e6*Math.random()|0),be=0;function me(u,h,g,b,M){this.listener=u,this.proxy=null,this.src=h,this.type=g,this.capture=!!b,this.ha=M,this.key=++be,this.da=this.fa=!1}function Te(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function Qe(u){this.src=u,this.g={},this.h=0}Qe.prototype.add=function(u,h,g,b,M){var G=u.toString();u=this.g[G],u||(u=this.g[G]=[],this.h++);var de=T(u,h,b,M);return-1<de?(h=u[de],g||(h.fa=!1)):(h=new me(h,this.src,G,!!b,M),h.fa=g,u.push(h)),h};function ut(u,h){var g=h.type;if(g in u.g){var b=u.g[g],M=Array.prototype.indexOf.call(b,h,void 0),G;(G=0<=M)&&Array.prototype.splice.call(b,M,1),G&&(Te(h),u.g[g].length==0&&(delete u.g[g],u.h--))}}function T(u,h,g,b){for(var M=0;M<u.length;++M){var G=u[M];if(!G.da&&G.listener==h&&G.capture==!!g&&G.ha==b)return M}return-1}var S="closure_lm_"+(1e6*Math.random()|0),N={};function J(u,h,g,b,M){if(b&&b.once)return fe(u,h,g,b,M);if(Array.isArray(h)){for(var G=0;G<h.length;G++)J(u,h[G],g,b,M);return null}return g=Se(g),u&&u[Q]?u.K(h,g,c(b)?!!b.capture:!!b,M):W(u,h,g,!1,b,M)}function W(u,h,g,b,M,G){if(!h)throw Error("Invalid event type");var de=c(M)?!!M.capture:!!M,dt=ge(u);if(dt||(u[S]=dt=new Qe(u)),g=dt.add(h,g,b,de,G),g.proxy)return g;if(b=Y(),g.proxy=b,b.src=u,b.listener=g,u.addEventListener)ct||(M=de),M===void 0&&(M=!1),u.addEventListener(h.toString(),b,M);else if(u.attachEvent)u.attachEvent(te(h.toString()),b);else if(u.addListener&&u.removeListener)u.addListener(b);else throw Error("addEventListener and attachEvent are unavailable.");return g}function Y(){function u(g){return h.call(u.src,u.listener,g)}const h=_e;return u}function fe(u,h,g,b,M){if(Array.isArray(h)){for(var G=0;G<h.length;G++)fe(u,h[G],g,b,M);return null}return g=Se(g),u&&u[Q]?u.L(h,g,c(b)?!!b.capture:!!b,M):W(u,h,g,!0,b,M)}function oe(u,h,g,b,M){if(Array.isArray(h))for(var G=0;G<h.length;G++)oe(u,h[G],g,b,M);else b=c(b)?!!b.capture:!!b,g=Se(g),u&&u[Q]?(u=u.i,h=String(h).toString(),h in u.g&&(G=u.g[h],g=T(G,g,b,M),-1<g&&(Te(G[g]),Array.prototype.splice.call(G,g,1),G.length==0&&(delete u.g[h],u.h--)))):u&&(u=ge(u))&&(h=u.g[h.toString()],u=-1,h&&(u=T(h,g,b,M)),(g=-1<u?h[u]:null)&&ie(g))}function ie(u){if(typeof u!="number"&&u&&!u.da){var h=u.src;if(h&&h[Q])ut(h.i,u);else{var g=u.type,b=u.proxy;h.removeEventListener?h.removeEventListener(g,b,u.capture):h.detachEvent?h.detachEvent(te(g),b):h.addListener&&h.removeListener&&h.removeListener(b),(g=ge(h))?(ut(g,u),g.h==0&&(g.src=null,h[S]=null)):Te(u)}}}function te(u){return u in N?N[u]:N[u]="on"+u}function _e(u,h){if(u.da)u=!0;else{h=new hn(h,this);var g=u.listener,b=u.ha||u.src;u.fa&&ie(u),u=g.call(b,h)}return u}function ge(u){return u=u[S],u instanceof Qe?u:null}var Ie="__closure_events_fn_"+(1e9*Math.random()>>>0);function Se(u){return typeof u=="function"?u:(u[Ie]||(u[Ie]=function(h){return u.handleEvent(h)}),u[Ie])}function Ve(){we.call(this),this.i=new Qe(this),this.M=this,this.F=null}C(Ve,we),Ve.prototype[Q]=!0,Ve.prototype.removeEventListener=function(u,h,g,b){oe(this,u,h,g,b)};function Be(u,h){var g,b=u.F;if(b)for(g=[];b;b=b.F)g.push(b);if(u=u.M,b=h.type||h,typeof h=="string")h=new Fe(h,u);else if(h instanceof Fe)h.target=h.target||u;else{var M=h;h=new Fe(b,u),P(h,M)}if(M=!0,g)for(var G=g.length-1;0<=G;G--){var de=h.g=g[G];M=Ye(de,b,!0,h)&&M}if(de=h.g=u,M=Ye(de,b,!0,h)&&M,M=Ye(de,b,!1,h)&&M,g)for(G=0;G<g.length;G++)de=h.g=g[G],M=Ye(de,b,!1,h)&&M}Ve.prototype.N=function(){if(Ve.aa.N.call(this),this.i){var u=this.i,h;for(h in u.g){for(var g=u.g[h],b=0;b<g.length;b++)Te(g[b]);delete u.g[h],u.h--}}this.F=null},Ve.prototype.K=function(u,h,g,b){return this.i.add(String(u),h,!1,g,b)},Ve.prototype.L=function(u,h,g,b){return this.i.add(String(u),h,!0,g,b)};function Ye(u,h,g,b){if(h=u.i.g[String(h)],!h)return!0;h=h.concat();for(var M=!0,G=0;G<h.length;++G){var de=h[G];if(de&&!de.da&&de.capture==g){var dt=de.listener,tn=de.ha||de.src;de.fa&&ut(u.i,de),M=dt.call(tn,b)!==!1&&M}}return M&&!b.defaultPrevented}function zt(u,h,g){if(typeof u=="function")g&&(u=v(u,g));else if(u&&typeof u.handleEvent=="function")u=v(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:a.setTimeout(u,h||0)}function Mt(u){u.g=zt(()=>{u.g=null,u.i&&(u.i=!1,Mt(u))},u.l);const h=u.h;u.h=null,u.m.apply(null,h)}class fn extends we{constructor(h,g){super(),this.m=h,this.l=g,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:Mt(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Qt(u){we.call(this),this.h=u,this.g={}}C(Qt,we);var xn=[];function sr(u){re(u.g,function(h,g){this.g.hasOwnProperty(g)&&ie(h)},u),u.g={}}Qt.prototype.N=function(){Qt.aa.N.call(this),sr(this)},Qt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var xt=a.JSON.stringify,an=a.JSON.parse,Xn=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function yo(){}yo.prototype.h=null;function Ei(u){return u.h||(u.h=u.i())}function _o(){}var Ti={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function qn(){Fe.call(this,"d")}C(qn,Fe);function bo(){Fe.call(this,"c")}C(bo,Fe);var Tr={},wo=null;function Io(){return wo=wo||new Ve}Tr.La="serverreachability";function An(u){Fe.call(this,Tr.La,u)}C(An,Fe);function ir(u){const h=Io();Be(h,new An(h))}Tr.STAT_EVENT="statevent";function Wa(u,h){Fe.call(this,Tr.STAT_EVENT,u),this.stat=h}C(Wa,Fe);function pn(u){const h=Io();Be(h,new Wa(h,u))}Tr.Ma="timingevent";function ks(u,h){Fe.call(this,Tr.Ma,u),this.size=h}C(ks,Fe);function hr(u,h){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},h)}function xr(){this.g=!0}xr.prototype.xa=function(){this.g=!1};function Ds(u,h,g,b,M,G){u.info(function(){if(u.g)if(G)for(var de="",dt=G.split("&"),tn=0;tn<dt.length;tn++){var ot=dt[tn].split("=");if(1<ot.length){var ln=ot[0];ot=ot[1];var _=ln.split("_");de=2<=_.length&&_[1]=="type"?de+(ln+"="+ot+"&"):de+(ln+"=redacted&")}}else de=null;else de=G;return"XMLHTTP REQ ("+b+") [attempt "+M+"]: "+h+`
`+g+`
`+de})}function zu(u,h,g,b,M,G,de){u.info(function(){return"XMLHTTP RESP ("+b+") [ attempt "+M+"]: "+h+`
`+g+`
`+G+" "+de})}function fr(u,h,g,b){u.info(function(){return"XMLHTTP TEXT ("+h+"): "+wh(u,g)+(b?" "+b:"")})}function pr(u,h){u.info(function(){return"TIMEOUT: "+h})}xr.prototype.info=function(){};function wh(u,h){if(!u.g)return h;if(!h)return null;try{var g=JSON.parse(h);if(g){for(u=0;u<g.length;u++)if(Array.isArray(g[u])){var b=g[u];if(!(2>b.length)){var M=b[1];if(Array.isArray(M)&&!(1>M.length)){var G=M[0];if(G!="noop"&&G!="stop"&&G!="close")for(var de=1;de<M.length;de++)M[de]=""}}}}return xt(g)}catch{return h}}var Eo={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Gu={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},To;function mr(){}C(mr,yo),mr.prototype.g=function(){return new XMLHttpRequest},mr.prototype.i=function(){return{}},To=new mr;function gr(u,h,g,b){this.j=u,this.i=h,this.l=g,this.R=b||1,this.U=new Qt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ku}function Ku(){this.i=null,this.g="",this.h=!1}var xo={},Ao={};function Vs(u,h,g){u.L=1,u.v=Ro(or(h)),u.m=g,u.P=!0,Qa(u,null)}function Qa(u,h){u.F=Date.now(),Ne(u),u.A=or(u.v);var g=u.A,b=u.R;Array.isArray(b)||(b=[String(b)]),Ya(g.i,"t",b),u.C=0,g=u.j.J,u.h=new Ku,u.g=hc(u.j,g?h:null,!u.m),0<u.O&&(u.M=new fn(v(u.Y,u,u.g),u.O)),h=u.U,g=u.g,b=u.ca;var M="readystatechange";Array.isArray(M)||(M&&(xn[0]=M.toString()),M=xn);for(var G=0;G<M.length;G++){var de=J(g,M[G],b||h.handleEvent,!1,h.h||h);if(!de)break;h.g[de.key]=de}h=u.H?I(u.H):{},u.m?(u.u||(u.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,h)):(u.u="GET",u.g.ea(u.A,u.u,null,h)),ir(),Ds(u.i,u.u,u.A,u.l,u.R,u.m)}gr.prototype.ca=function(u){u=u.target;const h=this.M;h&&vr(u)==3?h.j():this.Y(u)},gr.prototype.Y=function(u){try{if(u==this.g)e:{const _=vr(this.g);var h=this.g.Ba();const m=this.g.Z();if(!(3>_)&&(_!=3||this.g&&(this.h.h||this.g.oa()||ic(this.g)))){this.J||_!=4||h==7||(h==8||0>=m?ir(3):ir(2)),jr(this);var g=this.g.Z();this.X=g;t:if(xi(this)){var b=ic(this.g);u="";var M=b.length,G=vr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){qr(this),Br(this);var de="";break t}this.h.i=new a.TextDecoder}for(h=0;h<M;h++)this.h.h=!0,u+=this.h.i.decode(b[h],{stream:!(G&&h==M-1)});b.length=0,this.h.g+=u,this.C=0,de=this.h.g}else de=this.g.oa();if(this.o=g==200,zu(this.i,this.u,this.A,this.l,this.R,_,g),this.o){if(this.T&&!this.K){t:{if(this.g){var dt,tn=this.g;if((dt=tn.g?tn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(dt)){var ot=dt;break t}}ot=null}if(g=ot)fr(this.i,this.l,g,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,So(this,g);else{this.o=!1,this.s=3,pn(12),qr(this),Br(this);break e}}if(this.P){g=!0;let D;for(;!this.J&&this.C<de.length;)if(D=Ja(this,de),D==Ao){_==4&&(this.s=4,pn(14),g=!1),fr(this.i,this.l,null,"[Incomplete Response]");break}else if(D==xo){this.s=4,pn(15),fr(this.i,this.l,de,"[Invalid Chunk]"),g=!1;break}else fr(this.i,this.l,D,null),So(this,D);if(xi(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),_!=4||de.length!=0||this.h.h||(this.s=1,pn(16),g=!1),this.o=this.o&&g,!g)fr(this.i,this.l,de,"[Invalid Chunked Response]"),qr(this),Br(this);else if(0<de.length&&!this.W){this.W=!0;var ln=this.j;ln.g==this&&ln.ba&&!ln.M&&(ln.j.info("Great, no buffering proxy detected. Bytes received: "+de.length),sl(ln),ln.M=!0,pn(11))}}else fr(this.i,this.l,de,null),So(this,de);_==4&&qr(this),this.o&&!this.J&&(_==4?il(this.j,this):(this.o=!1,Ne(this)))}else oc(this.g),g==400&&0<de.indexOf("Unknown SID")?(this.s=3,pn(12)):(this.s=0,pn(13)),qr(this),Br(this)}}}catch{}finally{}};function xi(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function Ja(u,h){var g=u.C,b=h.indexOf(`
`,g);return b==-1?Ao:(g=Number(h.substring(g,b)),isNaN(g)?xo:(b+=1,b+g>h.length?Ao:(h=h.slice(b,b+g),u.C=b+g,h)))}gr.prototype.cancel=function(){this.J=!0,qr(this)};function Ne(u){u.S=Date.now()+u.I,yt(u,u.I)}function yt(u,h){if(u.B!=null)throw Error("WatchDog timer not null");u.B=hr(v(u.ba,u),h)}function jr(u){u.B&&(a.clearTimeout(u.B),u.B=null)}gr.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(pr(this.i,this.A),this.L!=2&&(ir(),pn(17)),qr(this),this.s=2,Br(this)):yt(this,this.S-u)};function Br(u){u.j.G==0||u.J||il(u.j,u)}function qr(u){jr(u);var h=u.M;h&&typeof h.ma=="function"&&h.ma(),u.M=null,sr(u.U),u.g&&(h=u.g,u.g=null,h.abort(),h.ma())}function So(u,h){try{var g=u.j;if(g.G!=0&&(g.g==u||zr(g.h,u))){if(!u.K&&zr(g.h,u)&&g.G==3){try{var b=g.Da.g.parse(h)}catch{b=null}if(Array.isArray(b)&&b.length==3){var M=b;if(M[0]==0){e:if(!g.u){if(g.g)if(g.g.F+3e3<u.F)Vi(g),Vo(g);else break e;rl(g),pn(18)}}else g.za=M[1],0<g.za-g.T&&37500>M[2]&&g.F&&g.v==0&&!g.C&&(g.C=hr(v(g.Za,g),6e3));if(1>=Wu(g.h)&&g.ca){try{g.ca()}catch{}g.ca=void 0}}else Sr(g,11)}else if((u.K||g.g==u)&&Vi(g),!B(h))for(M=g.Da.g.parse(h),h=0;h<M.length;h++){let ot=M[h];if(g.T=ot[0],ot=ot[1],g.G==2)if(ot[0]=="c"){g.K=ot[1],g.ia=ot[2];const ln=ot[3];ln!=null&&(g.la=ln,g.j.info("VER="+g.la));const _=ot[4];_!=null&&(g.Aa=_,g.j.info("SVER="+g.Aa));const m=ot[5];m!=null&&typeof m=="number"&&0<m&&(b=1.5*m,g.L=b,g.j.info("backChannelRequestTimeoutMs_="+b)),b=g;const D=u.g;if(D){const K=D.g?D.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(K){var G=b.h;G.g||K.indexOf("spdy")==-1&&K.indexOf("quic")==-1&&K.indexOf("h2")==-1||(G.j=G.l,G.g=new Set,G.h&&(Ns(G,G.h),G.h=null))}if(b.D){const se=D.g?D.g.getResponseHeader("X-HTTP-Session-Id"):null;se&&(b.ya=se,Oe(b.I,b.D,se))}}g.G=3,g.l&&g.l.ua(),g.ba&&(g.R=Date.now()-u.F,g.j.info("Handshake RTT: "+g.R+"ms")),b=g;var de=u;if(b.qa=dc(b,b.J?b.ia:null,b.W),de.K){Gr(b.h,de);var dt=de,tn=b.L;tn&&(dt.I=tn),dt.B&&(jr(dt),Ne(dt)),b.g=de}else nl(b);0<g.i.length&&No(g)}else ot[0]!="stop"&&ot[0]!="close"||Sr(g,7);else g.G==3&&(ot[0]=="stop"||ot[0]=="close"?ot[0]=="stop"?Sr(g,7):tl(g):ot[0]!="noop"&&g.l&&g.l.ta(ot),g.v=0)}}ir(4)}catch{}}var Ih=class{constructor(u,h){this.g=u,this.map=h}};function Hu(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Po(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function Wu(u){return u.h?1:u.g?u.g.size:0}function zr(u,h){return u.h?u.h==h:u.g?u.g.has(h):!1}function Ns(u,h){u.g?u.g.add(h):u.h=h}function Gr(u,h){u.h&&u.h==h?u.h=null:u.g&&u.g.has(h)&&u.g.delete(h)}Hu.prototype.cancel=function(){if(this.i=Kr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function Kr(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let h=u.i;for(const g of u.g.values())h=h.concat(g.D);return h}return A(u.i)}function Ai(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var h=[],g=u.length,b=0;b<g;b++)h.push(u[b]);return h}h=[],g=0;for(b in u)h[g++]=u[b];return h}function Si(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var h=[];u=u.length;for(var g=0;g<u;g++)h.push(g);return h}h=[],g=0;for(const b in u)h[g++]=b;return h}}}function Pi(u,h){if(u.forEach&&typeof u.forEach=="function")u.forEach(h,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,h,void 0);else for(var g=Si(u),b=Ai(u),M=b.length,G=0;G<M;G++)h.call(void 0,b[G],g&&g[G],u)}var Qu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Eh(u,h){if(u){u=u.split("&");for(var g=0;g<u.length;g++){var b=u[g].indexOf("="),M=null;if(0<=b){var G=u[g].substring(0,b);M=u[g].substring(b+1)}else G=u[g];h(G,M?decodeURIComponent(M.replace(/\+/g," ")):"")}}}function Hr(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof Hr){this.h=u.h,qe(this,u.j),this.o=u.o,this.g=u.g,Je(this,u.s),this.l=u.l;var h=u.i,g=new Jr;g.i=h.i,h.g&&(g.g=new Map(h.g),g.h=h.h),Gt(this,g),this.m=u.m}else u&&(h=String(u).match(Qu))?(this.h=!1,qe(this,h[1]||"",!0),this.o=Wr(h[2]||""),this.g=Wr(h[3]||"",!0),Je(this,h[4]),this.l=Wr(h[5]||"",!0),Gt(this,h[6]||"",!0),this.m=Wr(h[7]||"")):(this.h=!1,this.i=new Jr(null,this.h))}Hr.prototype.toString=function(){var u=[],h=this.j;h&&u.push(Os(h,Ju,!0),":");var g=this.g;return(g||h=="file")&&(u.push("//"),(h=this.o)&&u.push(Os(h,Ju,!0),"@"),u.push(encodeURIComponent(String(g)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.s,g!=null&&u.push(":",String(g))),(g=this.l)&&(this.g&&g.charAt(0)!="/"&&u.push("/"),u.push(Os(g,g.charAt(0)=="/"?zn:Qr,!0))),(g=this.i.toString())&&u.push("?",g),(g=this.m)&&u.push("#",Os(g,Co)),u.join("")};function or(u){return new Hr(u)}function qe(u,h,g){u.j=g?Wr(h,!0):h,u.j&&(u.j=u.j.replace(/:$/,""))}function Je(u,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);u.s=h}else u.s=null}function Gt(u,h,g){h instanceof Jr?(u.i=h,Th(u.i,u.h)):(g||(h=Os(h,Yu)),u.i=new Jr(h,u.h))}function Oe(u,h,g){u.i.set(h,g)}function Ro(u){return Oe(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function Wr(u,h){return u?h?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function Os(u,h,g){return typeof u=="string"?(u=encodeURI(u).replace(h,Ri),g&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function Ri(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var Ju=/[#\/\?@]/g,Qr=/[#\?:]/g,zn=/[#\?]/g,Yu=/[#\?@]/g,Co=/#/g;function Jr(u,h){this.h=this.g=null,this.i=u||null,this.j=!!h}function mn(u){u.g||(u.g=new Map,u.h=0,u.i&&Eh(u.i,function(h,g){u.add(decodeURIComponent(h.replace(/\+/g," ")),g)}))}n=Jr.prototype,n.add=function(u,h){mn(this),this.i=null,u=Ar(this,u);var g=this.g.get(u);return g||this.g.set(u,g=[]),g.push(h),this.h+=1,this};function Xu(u,h){mn(u),h=Ar(u,h),u.g.has(h)&&(u.i=null,u.h-=u.g.get(h).length,u.g.delete(h))}function Zu(u,h){return mn(u),h=Ar(u,h),u.g.has(h)}n.forEach=function(u,h){mn(this),this.g.forEach(function(g,b){g.forEach(function(M){u.call(h,M,b,this)},this)},this)},n.na=function(){mn(this);const u=Array.from(this.g.values()),h=Array.from(this.g.keys()),g=[];for(let b=0;b<h.length;b++){const M=u[b];for(let G=0;G<M.length;G++)g.push(h[b])}return g},n.V=function(u){mn(this);let h=[];if(typeof u=="string")Zu(this,u)&&(h=h.concat(this.g.get(Ar(this,u))));else{u=Array.from(this.g.values());for(let g=0;g<u.length;g++)h=h.concat(u[g])}return h},n.set=function(u,h){return mn(this),this.i=null,u=Ar(this,u),Zu(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[h]),this.h+=1,this},n.get=function(u,h){return u?(u=this.V(u),0<u.length?String(u[0]):h):h};function Ya(u,h,g){Xu(u,h),0<g.length&&(u.i=null,u.g.set(Ar(u,h),A(g)),u.h+=g.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],h=Array.from(this.g.keys());for(var g=0;g<h.length;g++){var b=h[g];const G=encodeURIComponent(String(b)),de=this.V(b);for(b=0;b<de.length;b++){var M=G;de[b]!==""&&(M+="="+encodeURIComponent(String(de[b]))),u.push(M)}}return this.i=u.join("&")};function Ar(u,h){return h=String(h),u.j&&(h=h.toLowerCase()),h}function Th(u,h){h&&!u.j&&(mn(u),u.i=null,u.g.forEach(function(g,b){var M=b.toLowerCase();b!=M&&(Xu(this,b),Ya(this,M,g))},u)),u.j=h}function Xa(u,h){const g=new xr;if(a.Image){const b=new Image;b.onload=y(ar,g,"TestLoadImage: loaded",!0,h,b),b.onerror=y(ar,g,"TestLoadImage: error",!1,h,b),b.onabort=y(ar,g,"TestLoadImage: abort",!1,h,b),b.ontimeout=y(ar,g,"TestLoadImage: timeout",!1,h,b),a.setTimeout(function(){b.ontimeout&&b.ontimeout()},1e4),b.src=u}else h(!1)}function Ms(u,h){const g=new xr,b=new AbortController,M=setTimeout(()=>{b.abort(),ar(g,"TestPingServer: timeout",!1,h)},1e4);fetch(u,{signal:b.signal}).then(G=>{clearTimeout(M),G.ok?ar(g,"TestPingServer: ok",!0,h):ar(g,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(M),ar(g,"TestPingServer: error",!1,h)})}function ar(u,h,g,b,M){try{M&&(M.onload=null,M.onerror=null,M.onabort=null,M.ontimeout=null),b(g)}catch{}}function ko(){this.g=new Xn}function Za(u,h,g){const b=g||"";try{Pi(u,function(M,G){let de=M;c(M)&&(de=xt(M)),h.push(b+G+"="+encodeURIComponent(de))})}catch(M){throw h.push(b+"type="+encodeURIComponent("_badmap")),M}}function Ci(u){this.l=u.Ub||null,this.j=u.eb||!1}C(Ci,yo),Ci.prototype.g=function(){return new Do(this.l,this.j)},Ci.prototype.i=function(u){return function(){return u}}({});function Do(u,h){Ve.call(this),this.D=u,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(Do,Ve),n=Do.prototype,n.open=function(u,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=h,this.readyState=1,Yr(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(h.body=u),(this.D||a).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ls(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,Yr(this)),this.g&&(this.readyState=3,Yr(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;ec(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function ec(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var h=u.value?u.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!u.done}))&&(this.response=this.responseText+=h)}u.done?Ls(this):Yr(this),this.readyState==3&&ec(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,Ls(this))},n.Qa=function(u){this.g&&(this.response=u,Ls(this))},n.ga=function(){this.g&&Ls(this)};function Ls(u){u.readyState=4,u.l=null,u.j=null,u.v=null,Yr(u)}n.setRequestHeader=function(u,h){this.u.append(u,h)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],h=this.h.entries();for(var g=h.next();!g.done;)g=g.value,u.push(g[0]+": "+g[1]),g=h.next();return u.join(`\r
`)};function Yr(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(Do.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function ki(u){let h="";return re(u,function(g,b){h+=b,h+=":",h+=g,h+=`\r
`}),h}function Fs(u,h,g){e:{for(b in g){var b=!1;break e}b=!0}b||(g=ki(g),typeof u=="string"?g!=null&&encodeURIComponent(String(g)):Oe(u,h,g))}function Lt(u){Ve.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(Lt,Ve);var xh=/^https?$/i,Ah=["POST","PUT"];n=Lt.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,h,g,b){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);h=h?h.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():To.g(),this.v=this.o?Ei(this.o):Ei(To),this.g.onreadystatechange=v(this.Ea,this);try{this.B=!0,this.g.open(h,String(u),!0),this.B=!1}catch(G){tc(this,G);return}if(u=g||"",g=new Map(this.headers),b)if(Object.getPrototypeOf(b)===Object.prototype)for(var M in b)g.set(M,b[M]);else if(typeof b.keys=="function"&&typeof b.get=="function")for(const G of b.keys())g.set(G,b.get(G));else throw Error("Unknown input type for opt_headers: "+String(b));b=Array.from(g.keys()).find(G=>G.toLowerCase()=="content-type"),M=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(Ah,h,void 0))||b||M||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[G,de]of g)this.g.setRequestHeader(G,de);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{sc(this),this.u=!0,this.g.send(u),this.u=!1}catch(G){tc(this,G)}};function tc(u,h){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=h,u.m=5,nc(u),Xr(u)}function nc(u){u.A||(u.A=!0,Be(u,"complete"),Be(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,Be(this,"complete"),Be(this,"abort"),Xr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Xr(this,!0)),Lt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?rc(this):this.bb())},n.bb=function(){rc(this)};function rc(u){if(u.h&&typeof o<"u"&&(!u.v[1]||vr(u)!=4||u.Z()!=2)){if(u.u&&vr(u)==4)zt(u.Ea,0,u);else if(Be(u,"readystatechange"),vr(u)==4){u.h=!1;try{const de=u.Z();e:switch(de){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var g;if(!(g=h)){var b;if(b=de===0){var M=String(u.D).match(Qu)[1]||null;!M&&a.self&&a.self.location&&(M=a.self.location.protocol.slice(0,-1)),b=!xh.test(M?M.toLowerCase():"")}g=b}if(g)Be(u,"complete"),Be(u,"success");else{u.m=6;try{var G=2<vr(u)?u.g.statusText:""}catch{G=""}u.l=G+" ["+u.Z()+"]",nc(u)}}finally{Xr(u)}}}}function Xr(u,h){if(u.g){sc(u);const g=u.g,b=u.v[0]?()=>{}:null;u.g=null,u.v=null,h||Be(u,"ready");try{g.onreadystatechange=b}catch{}}}function sc(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function vr(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<vr(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var h=this.g.responseText;return u&&h.indexOf(u)==0&&(h=h.substring(u.length)),an(h)}};function ic(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function oc(u){const h={};u=(u.g&&2<=vr(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let b=0;b<u.length;b++){if(B(u[b]))continue;var g=R(u[b]);const M=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const G=h[M]||[];h[M]=G,G.push(g)}E(h,function(b){return b.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Di(u,h,g){return g&&g.internalChannelParams&&g.internalChannelParams[u]||h}function el(u){this.Aa=0,this.i=[],this.j=new xr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Di("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Di("baseRetryDelayMs",5e3,u),this.cb=Di("retryDelaySeedMs",1e4,u),this.Wa=Di("forwardChannelMaxRetries",2,u),this.wa=Di("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new Hu(u&&u.concurrentRequestLimit),this.Da=new ko,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=el.prototype,n.la=8,n.G=1,n.connect=function(u,h,g,b){pn(0),this.W=u,this.H=h||{},g&&b!==void 0&&(this.H.OSID=g,this.H.OAID=b),this.F=this.X,this.I=dc(this,null,this.W),No(this)};function tl(u){if(ac(u),u.G==3){var h=u.U++,g=or(u.I);if(Oe(g,"SID",u.K),Oe(g,"RID",h),Oe(g,"TYPE","terminate"),Us(u,g),h=new gr(u,u.j,h),h.L=2,h.v=Ro(or(g)),g=!1,a.navigator&&a.navigator.sendBeacon)try{g=a.navigator.sendBeacon(h.v.toString(),"")}catch{}!g&&a.Image&&(new Image().src=h.v,g=!0),g||(h.g=hc(h.j,null),h.g.ea(h.v)),h.F=Date.now(),Ne(h)}cc(u)}function Vo(u){u.g&&(sl(u),u.g.cancel(),u.g=null)}function ac(u){Vo(u),u.u&&(a.clearTimeout(u.u),u.u=null),Vi(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function No(u){if(!Po(u.h)&&!u.s){u.s=!0;var h=u.Ga;Ge||ee(),je||(Ge(),je=!0),ke.add(h,u),u.B=0}}function Zr(u,h){return Wu(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=h.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=hr(v(u.Ga,u,h),ol(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const M=new gr(this,this.j,u);let G=this.o;if(this.S&&(G?(G=I(G),P(G,this.S)):G=this.S),this.m!==null||this.O||(M.H=G,G=null),this.P)e:{for(var h=0,g=0;g<this.i.length;g++){t:{var b=this.i[g];if("__data__"in b.map&&(b=b.map.__data__,typeof b=="string")){b=b.length;break t}b=void 0}if(b===void 0)break;if(h+=b,4096<h){h=g;break e}if(h===4096||g===this.i.length-1){h=g+1;break e}}h=1e3}else h=1e3;h=Oo(this,M,h),g=or(this.I),Oe(g,"RID",u),Oe(g,"CVER",22),this.D&&Oe(g,"X-HTTP-Session-Id",this.D),Us(this,g),G&&(this.O?h="headers="+encodeURIComponent(String(ki(G)))+"&"+h:this.m&&Fs(g,this.m,G)),Ns(this.h,M),this.Ua&&Oe(g,"TYPE","init"),this.P?(Oe(g,"$req",h),Oe(g,"SID","null"),M.T=!0,Vs(M,g,null)):Vs(M,g,h),this.G=2}}else this.G==3&&(u?lc(this,u):this.i.length==0||Po(this.h)||lc(this))};function lc(u,h){var g;h?g=h.l:g=u.U++;const b=or(u.I);Oe(b,"SID",u.K),Oe(b,"RID",g),Oe(b,"AID",u.T),Us(u,b),u.m&&u.o&&Fs(b,u.m,u.o),g=new gr(u,u.j,g,u.B+1),u.m===null&&(g.H=u.o),h&&(u.i=h.D.concat(u.i)),h=Oo(u,g,1e3),g.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),Ns(u.h,g),Vs(g,b,h)}function Us(u,h){u.H&&re(u.H,function(g,b){Oe(h,b,g)}),u.l&&Pi({},function(g,b){Oe(h,b,g)})}function Oo(u,h,g){g=Math.min(u.i.length,g);var b=u.l?v(u.l.Na,u.l,u):null;e:{var M=u.i;let G=-1;for(;;){const de=["count="+g];G==-1?0<g?(G=M[0].g,de.push("ofs="+G)):G=0:de.push("ofs="+G);let dt=!0;for(let tn=0;tn<g;tn++){let ot=M[tn].g;const ln=M[tn].map;if(ot-=G,0>ot)G=Math.max(0,M[tn].g-100),dt=!1;else try{Za(ln,de,"req"+ot+"_")}catch{b&&b(ln)}}if(dt){b=de.join("&");break e}}}return u=u.i.splice(0,g),h.D=u,b}function nl(u){if(!u.g&&!u.u){u.Y=1;var h=u.Fa;Ge||ee(),je||(Ge(),je=!0),ke.add(h,u),u.v=0}}function rl(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=hr(v(u.Fa,u),ol(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,uc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=hr(v(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,pn(10),Vo(this),uc(this))};function sl(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function uc(u){u.g=new gr(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var h=or(u.qa);Oe(h,"RID","rpc"),Oe(h,"SID",u.K),Oe(h,"AID",u.T),Oe(h,"CI",u.F?"0":"1"),!u.F&&u.ja&&Oe(h,"TO",u.ja),Oe(h,"TYPE","xmlhttp"),Us(u,h),u.m&&u.o&&Fs(h,u.m,u.o),u.L&&(u.g.I=u.L);var g=u.g;u=u.ia,g.L=1,g.v=Ro(or(h)),g.m=null,g.P=!0,Qa(g,u)}n.Za=function(){this.C!=null&&(this.C=null,Vo(this),rl(this),pn(19))};function Vi(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function il(u,h){var g=null;if(u.g==h){Vi(u),sl(u),u.g=null;var b=2}else if(zr(u.h,h))g=h.D,Gr(u.h,h),b=1;else return;if(u.G!=0){if(h.o)if(b==1){g=h.m?h.m.length:0,h=Date.now()-h.F;var M=u.B;b=Io(),Be(b,new ks(b,g)),No(u)}else nl(u);else if(M=h.s,M==3||M==0&&0<h.X||!(b==1&&Zr(u,h)||b==2&&rl(u)))switch(g&&0<g.length&&(h=u.h,h.i=h.i.concat(g)),M){case 1:Sr(u,5);break;case 4:Sr(u,10);break;case 3:Sr(u,6);break;default:Sr(u,2)}}}function ol(u,h){let g=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(g*=2),g*h}function Sr(u,h){if(u.j.info("Error code "+h),h==2){var g=v(u.fb,u),b=u.Xa;const M=!b;b=new Hr(b||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||qe(b,"https"),Ro(b),M?Xa(b.toString(),g):Ms(b.toString(),g)}else pn(2);u.G=0,u.l&&u.l.sa(h),cc(u),ac(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),pn(2)):(this.j.info("Failed to ping google.com"),pn(1))};function cc(u){if(u.G=0,u.ka=[],u.l){const h=Kr(u.h);(h.length!=0||u.i.length!=0)&&(k(u.ka,h),k(u.ka,u.i),u.h.i.length=0,A(u.i),u.i.length=0),u.l.ra()}}function dc(u,h,g){var b=g instanceof Hr?or(g):new Hr(g);if(b.g!="")h&&(b.g=h+"."+b.g),Je(b,b.s);else{var M=a.location;b=M.protocol,h=h?h+"."+M.hostname:M.hostname,M=+M.port;var G=new Hr(null);b&&qe(G,b),h&&(G.g=h),M&&Je(G,M),g&&(G.l=g),b=G}return g=u.D,h=u.ya,g&&h&&Oe(b,g,h),Oe(b,"VER",u.la),Us(u,b),b}function hc(u,h,g){if(h&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=u.Ca&&!u.pa?new Lt(new Ci({eb:g})):new Lt(u.pa),h.Ha(u.J),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Mo(){}n=Mo.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Lo(){}Lo.prototype.g=function(u,h){return new Sn(u,h)};function Sn(u,h){Ve.call(this),this.g=new el(h),this.l=u,this.h=h&&h.messageUrlParams||null,u=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(u?u["X-WebChannel-Content-Type"]=h.messageContentType:u={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(u?u["X-WebChannel-Client-Profile"]=h.va:u={"X-WebChannel-Client-Profile":h.va}),this.g.S=u,(u=h&&h.Sb)&&!B(u)&&(this.g.m=u),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!B(h)&&(this.g.D=h,u=this.h,u!==null&&h in u&&(u=this.h,h in u&&delete u[h])),this.j=new es(this)}C(Sn,Ve),Sn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Sn.prototype.close=function(){tl(this.g)},Sn.prototype.o=function(u){var h=this.g;if(typeof u=="string"){var g={};g.__data__=u,u=g}else this.u&&(g={},g.__data__=xt(u),u=g);h.i.push(new Ih(h.Ya++,u)),h.G==3&&No(h)},Sn.prototype.N=function(){this.g.l=null,delete this.j,tl(this.g),delete this.g,Sn.aa.N.call(this)};function fc(u){qn.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var h=u.__sm__;if(h){e:{for(const g in h){u=g;break e}u=void 0}(this.i=u)&&(u=this.i,h=h!==null&&u in h?h[u]:void 0),this.data=h}else this.data=u}C(fc,qn);function Fo(){bo.call(this),this.status=1}C(Fo,bo);function es(u){this.g=u}C(es,Mo),es.prototype.ua=function(){Be(this.g,"a")},es.prototype.ta=function(u){Be(this.g,new fc(u))},es.prototype.sa=function(u){Be(this.g,new Fo)},es.prototype.ra=function(){Be(this.g,"b")},Lo.prototype.createWebChannel=Lo.prototype.g,Sn.prototype.send=Sn.prototype.o,Sn.prototype.open=Sn.prototype.m,Sn.prototype.close=Sn.prototype.close,w0=function(){return new Lo},b0=function(){return Io()},_0=Tr,Af={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Eo.NO_ERROR=0,Eo.TIMEOUT=8,Eo.HTTP_ERROR=6,Dc=Eo,Gu.COMPLETE="complete",y0=Gu,_o.EventType=Ti,Ti.OPEN="a",Ti.CLOSE="b",Ti.ERROR="c",Ti.MESSAGE="d",Ve.prototype.listen=Ve.prototype.K,bl=_o,Lt.prototype.listenOnce=Lt.prototype.L,Lt.prototype.getLastError=Lt.prototype.Ka,Lt.prototype.getLastErrorCode=Lt.prototype.Ba,Lt.prototype.getStatus=Lt.prototype.Z,Lt.prototype.getResponseJson=Lt.prototype.Oa,Lt.prototype.getResponseText=Lt.prototype.oa,Lt.prototype.send=Lt.prototype.ea,Lt.prototype.setWithCredentials=Lt.prototype.Ha,v0=Lt}).apply(typeof vc<"u"?vc:typeof self<"u"?self:typeof window<"u"?window:{});const ev="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}vn.UNAUTHENTICATED=new vn(null),vn.GOOGLE_CREDENTIALS=new vn("google-credentials-uid"),vn.FIRST_PARTY=new vn("first-party-uid"),vn.MOCK_USER=new vn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Oa="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ci=new wp("@firebase/firestore");function Qo(){return ci.logLevel}function G4(n){ci.setLogLevel(n)}function X(n,...e){if(ci.logLevel<=tt.DEBUG){const t=e.map(Ep);ci.debug(`Firestore (${Oa}): ${n}`,...t)}}function Yt(n,...e){if(ci.logLevel<=tt.ERROR){const t=e.map(Ep);ci.error(`Firestore (${Oa}): ${n}`,...t)}}function cr(n,...e){if(ci.logLevel<=tt.WARN){const t=e.map(Ep);ci.warn(`Firestore (${Oa}): ${n}`,...t)}}function Ep(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ee(n="Unexpected state"){const e=`FIRESTORE (${Oa}) INTERNAL ASSERTION FAILED: `+n;throw Yt(e),new Error(e)}function Ae(n,e){n||Ee()}function K4(n,e){n||Ee()}function pe(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Z extends Es{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I0{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class XS{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(vn.UNAUTHENTICATED))}shutdown(){}}class ZS{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class eP{constructor(e){this.t=e,this.currentUser=vn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Ae(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new yn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new yn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{X("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(X("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new yn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(X("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ae(typeof r.accessToken=="string"),new I0(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ae(e===null||typeof e=="string"),new vn(e)}}class tP{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=vn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class nP{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new tP(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(vn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class E0{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rP{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Ae(this.o===void 0);const r=i=>{i.error!=null&&X("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,X("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{X("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):X("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Ae(typeof t.token=="string"),this.R=t.token,new E0(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class H4{getToken(){return Promise.resolve(new E0(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sP(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T0{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=sP(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function $e(n,e){return n<e?-1:n>e?1:0}function ga(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function x0(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Z(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Z(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Z(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Z(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Bt.fromMillis(Date.now())}static fromDate(e){return Bt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Bt(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?$e(this.nanoseconds,e.nanoseconds):$e(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pe{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Pe(e)}static min(){return new Pe(new Bt(0,0))}static max(){return new Pe(new Bt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ql{constructor(e,t,r){t===void 0?t=0:t>e.length&&Ee(),r===void 0?r=e.length-t:r>e.length-t&&Ee(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Ql.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ql?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class rt extends Ql{construct(e,t,r){return new rt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Z(q.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new rt(t)}static emptyPath(){return new rt([])}}const iP=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class $t extends Ql{construct(e,t,r){return new $t(e,t,r)}static isValidIdentifier(e){return iP.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),$t.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new $t(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new Z(q.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new Z(q.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new Z(q.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new Z(q.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new $t(t)}static emptyPath(){return new $t([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ye{constructor(e){this.path=e}static fromPath(e){return new ye(rt.fromString(e))}static fromName(e){return new ye(rt.fromString(e).popFirst(5))}static empty(){return new ye(rt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&rt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return rt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ye(new rt(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function Sf(n){return n.fields.find(e=>e.kind===2)}function $i(n){return n.fields.filter(e=>e.kind!==2)}function oP(n,e){let t=$e(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=aP(n.fields[r],e.fields[r]),t!==0)return t;return $e(n.fields.length,e.fields.length)}va.UNKNOWN_ID=-1;class Ji{constructor(e,t){this.fieldPath=e,this.kind=t}}function aP(n,e){const t=$t.comparator(n.fieldPath,e.fieldPath);return t!==0?t:$e(n.kind,e.kind)}class ya{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ya(0,rr.min())}}function A0(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Pe.fromTimestamp(r===1e9?new Bt(t+1,0):new Bt(t,r));return new rr(s,ye.empty(),e)}function S0(n){return new rr(n.readTime,n.key,-1)}class rr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new rr(Pe.min(),ye.empty(),-1)}static max(){return new rr(Pe.max(),ye.empty(),-1)}}function Tp(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=ye.comparator(n.documentKey,e.documentKey),t!==0?t:$e(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P0="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class R0{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yi(n){if(n.code!==q.FAILED_PRECONDITION||n.message!==P0)throw n;X("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ee(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new L((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof L?t:L.resolve(t)}catch(t){return L.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):L.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):L.reject(t)}static resolve(e){return new L((t,r)=>{t(e)})}static reject(e){return new L((t,r)=>{r(e)})}static waitFor(e){return new L((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=L.resolve(!1);for(const r of e)t=t.next(s=>s?L.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new L((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(d=>{o[c]=d,++a,a===i&&r(o)},d=>s(d))}})}static doWhile(e,t){return new L((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ud{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new yn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Ol(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=xp(r.target.error);this.V.reject(new Ol(e,s))}}static open(e,t,r,s){try{return new Ud(t,e.transaction(s,r))}catch(i){throw new Ol(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(X("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new uP(t)}}class Or{constructor(e,t,r){this.name=e,this.version=t,this.p=r,Or.S(cn())===12.2&&Yt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return X("SimpleDb","Removing database:",e),Bi(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!u0())return!1;if(Or.v())return!0;const e=cn(),t=Or.S(e),r=0<t&&t<10,s=C0(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(X("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new Ol(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new Z(q.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new Z(q.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Ol(e,o))},s.onupgradeneeded=i=>{X("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{X("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=Ud.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),L.reject(c))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(X("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function C0(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class lP{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Bi(this.B.delete())}}class Ol extends Z{constructor(e,t){super(q.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function _i(n){return n.name==="IndexedDbTransactionError"}class uP{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(X("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(X("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Bi(r)}add(e){return X("SimpleDb","ADD",this.store.name,e,e),Bi(this.store.add(e))}get(e){return Bi(this.store.get(e)).next(t=>(t===void 0&&(t=null),X("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return X("SimpleDb","DELETE",this.store.name,e),Bi(this.store.delete(e))}count(){return X("SimpleDb","COUNT",this.store.name),Bi(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new L((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new L((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){X("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new L((r,s)=>{t.onerror=i=>{const o=xp(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new L((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new lP(a),c=t(a.primaryKey,a.value,l);if(c instanceof L){const d=c.catch(f=>(l.done(),L.reject(f)));r.push(d)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>L.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Bi(n){return new L((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=xp(r.target.error);t(s)}})}let tv=!1;function xp(n){const e=Or.S(cn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new Z("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return tv||(tv=!0,setTimeout(()=>{throw r},0)),r}}return n}class cP{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){X("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{X("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){_i(t)?X("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await yi(t)}await this.X(6e4)})}}class dP{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return L.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return X("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(X("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=S0(i);Tp(o,r)>0&&(r=o)}),new rr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Wn.oe=-1;function wu(n){return n==null}function Jl(n){return n===0&&1/n==-1/0}function k0(n){return typeof n=="number"&&Number.isInteger(n)&&!Jl(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mn(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=nv(e)),e=hP(n.get(t),e);return nv(e)}function hP(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function nv(n){return n+""}function Dr(n){const e=n.length;if(Ae(e>=2),e===2)return Ae(n.charAt(0)===""&&n.charAt(1)===""),rt.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&Ee(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:Ee()}i=o+2}return new rt(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rv=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vc(n,e){return[n,Mn(e)]}function D0(n,e,t){return[n,Mn(e),t]}const fP={},pP=["prefixPath","collectionGroup","readTime","documentId"],mP=["prefixPath","collectionGroup","documentId"],gP=["collectionGroup","readTime","prefixPath","documentId"],vP=["canonicalId","targetId"],yP=["targetId","path"],_P=["path","targetId"],bP=["collectionId","parent"],wP=["indexId","uid"],IP=["uid","sequenceNumber"],EP=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],TP=["indexId","uid","orderedDocumentKey"],xP=["userId","collectionPath","documentId"],AP=["userId","collectionPath","largestBatchId"],SP=["userId","collectionGroup","largestBatchId"],V0=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],PP=[...V0,"documentOverlays"],N0=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],O0=N0,Ap=[...O0,"indexConfiguration","indexState","indexEntries"],RP=Ap,CP=[...Ap,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pf extends R0{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function dn(n,e){const t=pe(n);return Or.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sv(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function bi(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function M0(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function L0(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ct{constructor(e,t){this.comparator=e,this.root=t||wn.EMPTY}insert(e,t){return new Ct(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,wn.BLACK,null,null))}remove(e){return new Ct(this.comparator,this.root.remove(e,this.comparator).copy(null,null,wn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new yc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new yc(this.root,e,this.comparator,!1)}getReverseIterator(){return new yc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new yc(this.root,e,this.comparator,!0)}}class yc{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class wn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??wn.RED,this.left=s??wn.EMPTY,this.right=i??wn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new wn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return wn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return wn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,wn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,wn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ee();const e=this.left.check();if(e!==this.right.check())throw Ee();return e+(this.isRed()?0:1)}}wn.EMPTY=null,wn.RED=!0,wn.BLACK=!1;wn.EMPTY=new class{constructor(){this.size=0}get key(){throw Ee()}get value(){throw Ee()}get color(){throw Ee()}get left(){throw Ee()}get right(){throw Ee()}copy(e,t,r,s,i){return this}insert(e,t,r){return new wn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bt{constructor(e){this.comparator=e,this.data=new Ct(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new iv(this.data.getIterator())}getIteratorFrom(e){return new iv(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof bt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new bt(this.comparator);return t.data=e,t}}class iv{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function jo(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qn{constructor(e){this.fields=e,e.sort($t.comparator)}static empty(){return new Qn([])}unionWith(e){let t=new bt($t.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Qn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ga(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F0 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q4(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ht{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new F0("Invalid base64 string: "+i):i}}(e);return new Ht(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Ht(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return $e(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ht.EMPTY_BYTE_STRING=new Ht("");const kP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function vs(n){if(Ae(!!n),typeof n=="string"){let e=0;const t=kP.exec(n);if(Ae(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ut(n.seconds),nanos:Ut(n.nanos)}}function Ut(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ys(n){return typeof n=="string"?Ht.fromBase64String(n):Ht.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $d(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function jd(n){const e=n.mapValue.fields.__previous_value__;return $d(e)?jd(e):e}function Yl(n){const e=vs(n.mapValue.fields.__local_write_time__.timestampValue);return new Bt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DP{constructor(e,t,r,s,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class eo{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new eo("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof eo&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ti={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Nc={nullValue:"NULL_VALUE"};function di(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?$d(n)?4:U0(n)?9007199254740991:Bd(n)?10:11:Ee()}function $r(n,e){if(n===e)return!0;const t=di(n);if(t!==di(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Yl(n).isEqual(Yl(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=vs(s.timestampValue),a=vs(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return ys(s.bytesValue).isEqual(ys(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Ut(s.geoPointValue.latitude)===Ut(i.geoPointValue.latitude)&&Ut(s.geoPointValue.longitude)===Ut(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Ut(s.integerValue)===Ut(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Ut(s.doubleValue),a=Ut(i.doubleValue);return o===a?Jl(o)===Jl(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return ga(n.arrayValue.values||[],e.arrayValue.values||[],$r);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(sv(o)!==sv(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!$r(o[l],a[l])))return!1;return!0}(n,e);default:return Ee()}}function Xl(n,e){return(n.values||[]).find(t=>$r(t,e))!==void 0}function hi(n,e){if(n===e)return 0;const t=di(n),r=di(e);if(t!==r)return $e(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return $e(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=Ut(i.integerValue||i.doubleValue),l=Ut(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return ov(n.timestampValue,e.timestampValue);case 4:return ov(Yl(n),Yl(e));case 5:return $e(n.stringValue,e.stringValue);case 6:return function(i,o){const a=ys(i),l=ys(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const d=$e(a[c],l[c]);if(d!==0)return d}return $e(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=$e(Ut(i.latitude),Ut(o.latitude));return a!==0?a:$e(Ut(i.longitude),Ut(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return av(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,c,d;const f=i.fields||{},v=o.fields||{},y=(a=f.value)===null||a===void 0?void 0:a.arrayValue,C=(l=v.value)===null||l===void 0?void 0:l.arrayValue,A=$e(((c=y==null?void 0:y.values)===null||c===void 0?void 0:c.length)||0,((d=C==null?void 0:C.values)===null||d===void 0?void 0:d.length)||0);return A!==0?A:av(y,C)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===ti.mapValue&&o===ti.mapValue)return 0;if(i===ti.mapValue)return 1;if(o===ti.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},d=Object.keys(c);l.sort(),d.sort();for(let f=0;f<l.length&&f<d.length;++f){const v=$e(l[f],d[f]);if(v!==0)return v;const y=hi(a[l[f]],c[d[f]]);if(y!==0)return y}return $e(l.length,d.length)}(n.mapValue,e.mapValue);default:throw Ee()}}function ov(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return $e(n,e);const t=vs(n),r=vs(e),s=$e(t.seconds,r.seconds);return s!==0?s:$e(t.nanos,r.nanos)}function av(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=hi(t[s],r[s]);if(i)return i}return $e(t.length,r.length)}function _a(n){return Rf(n)}function Rf(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=vs(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return ys(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return ye.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=Rf(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${Rf(t.fields[o])}`;return s+"}"}(n.mapValue):Ee()}function Oc(n){switch(di(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=jd(n);return e?16+Oc(e):16;case 5:return 2*n.stringValue.length;case 6:return ys(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Oc(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return bi(r.fields,(i,o)=>{s+=i.length+Oc(o)}),s}(n.mapValue);default:throw Ee()}}function to(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Cf(n){return!!n&&"integerValue"in n}function Zl(n){return!!n&&"arrayValue"in n}function lv(n){return!!n&&"nullValue"in n}function uv(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Mc(n){return!!n&&"mapValue"in n}function Bd(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Ml(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return bi(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Ml(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ml(n.arrayValue.values[t]);return e}return Object.assign({},n)}function U0(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const $0={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function VP(n){return"nullValue"in n?Nc:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?to(eo.empty(),ye.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Bd(n)?$0:{mapValue:{}}:Ee()}function NP(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?to(eo.empty(),ye.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?$0:"mapValue"in n?Bd(n)?{mapValue:{}}:ti:Ee()}function cv(n,e){const t=hi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function dv(n,e){const t=hi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class En{constructor(e){this.value=e}static empty(){return new En({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Mc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ml(t)}setAll(e){let t=$t.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Ml(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Mc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return $r(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Mc(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){bi(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new En(Ml(this.value))}}function j0(n){const e=[];return bi(n.fields,(t,r)=>{const s=new $t([t]);if(Mc(r)){const i=j0(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Qn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vt{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Vt(e,0,Pe.min(),Pe.min(),Pe.min(),En.empty(),0)}static newFoundDocument(e,t,r,s){return new Vt(e,1,t,Pe.min(),r,s,0)}static newNoDocument(e,t){return new Vt(e,2,t,Pe.min(),Pe.min(),En.empty(),0)}static newUnknownDocument(e,t){return new Vt(e,3,t,Pe.min(),Pe.min(),En.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Pe.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=En.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=En.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Pe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Vt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Vt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fi{constructor(e,t){this.position=e,this.inclusive=t}}function hv(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=ye.comparator(ye.fromName(o.referenceValue),t.key):r=hi(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function fv(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!$r(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eu{constructor(e,t="asc"){this.field=e,this.dir=t}}function OP(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B0{}class st extends B0{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new MP(e,t,r):t==="array-contains"?new UP(e,r):t==="in"?new W0(e,r):t==="not-in"?new $P(e,r):t==="array-contains-any"?new jP(e,r):new st(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new LP(e,r):new FP(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(hi(t,this.value)):t!==null&&di(this.value)===di(t)&&this.matchesComparison(hi(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ee()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class vt extends B0{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new vt(e,t)}matches(e){return ba(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function ba(n){return n.op==="and"}function kf(n){return n.op==="or"}function Sp(n){return q0(n)&&ba(n)}function q0(n){for(const e of n.filters)if(e instanceof vt)return!1;return!0}function Df(n){if(n instanceof st)return n.field.canonicalString()+n.op.toString()+_a(n.value);if(Sp(n))return n.filters.map(e=>Df(e)).join(",");{const e=n.filters.map(t=>Df(t)).join(",");return`${n.op}(${e})`}}function z0(n,e){return n instanceof st?function(r,s){return s instanceof st&&r.op===s.op&&r.field.isEqual(s.field)&&$r(r.value,s.value)}(n,e):n instanceof vt?function(r,s){return s instanceof vt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&z0(o,s.filters[a]),!0):!1}(n,e):void Ee()}function G0(n,e){const t=n.filters.concat(e);return vt.create(t,n.op)}function K0(n){return n instanceof st?function(t){return`${t.field.canonicalString()} ${t.op} ${_a(t.value)}`}(n):n instanceof vt?function(t){return t.op.toString()+" {"+t.getFilters().map(K0).join(" ,")+"}"}(n):"Filter"}class MP extends st{constructor(e,t,r){super(e,t,r),this.key=ye.fromName(r.referenceValue)}matches(e){const t=ye.comparator(e.key,this.key);return this.matchesComparison(t)}}class LP extends st{constructor(e,t){super(e,"in",t),this.keys=H0("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class FP extends st{constructor(e,t){super(e,"not-in",t),this.keys=H0("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function H0(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>ye.fromName(r.referenceValue))}class UP extends st{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Zl(t)&&Xl(t.arrayValue,this.value)}}class W0 extends st{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Xl(this.value.arrayValue,t)}}class $P extends st{constructor(e,t){super(e,"not-in",t)}matches(e){if(Xl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Xl(this.value.arrayValue,t)}}class jP extends st{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Zl(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Xl(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BP{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function Vf(n,e=null,t=[],r=[],s=null,i=null,o=null){return new BP(n,e,t,r,s,i,o)}function no(n){const e=pe(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Df(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),wu(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>_a(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>_a(r)).join(",")),e.ue=t}return e.ue}function Iu(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!OP(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!z0(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!fv(n.startAt,e.startAt)&&fv(n.endAt,e.endAt)}function sd(n){return ye.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function id(n,e){return n.filters.filter(t=>t instanceof st&&t.field.isEqual(e))}function pv(n,e,t){let r=Nc,s=!0;for(const i of id(n,e)){let o=Nc,a=!0;switch(i.op){case"<":case"<=":o=VP(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Nc}cv({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];cv({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function mv(n,e,t){let r=ti,s=!0;for(const i of id(n,e)){let o=ti,a=!0;switch(i.op){case">=":case">":o=NP(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=ti}dv({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];dv({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ts{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Q0(n,e,t,r,s,i,o,a){return new Ts(n,e,t,r,s,i,o,a)}function Ma(n){return new Ts(n)}function gv(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Pp(n){return n.collectionGroup!==null}function ia(n){const e=pe(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new bt($t.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new eu(i,r))}),t.has($t.keyField().canonicalString())||e.ce.push(new eu($t.keyField(),r))}return e.ce}function Ln(n){const e=pe(n);return e.le||(e.le=Y0(e,ia(n))),e.le}function J0(n){const e=pe(n);return e.he||(e.he=Y0(e,n.explicitOrderBy)),e.he}function Y0(n,e){if(n.limitType==="F")return Vf(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new eu(s.field,i)});const t=n.endAt?new fi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new fi(n.startAt.position,n.startAt.inclusive):null;return Vf(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Nf(n,e){const t=n.filters.concat([e]);return new Ts(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function od(n,e,t){return new Ts(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Eu(n,e){return Iu(Ln(n),Ln(e))&&n.limitType===e.limitType}function X0(n){return`${no(Ln(n))}|lt:${n.limitType}`}function Jo(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>K0(s)).join(", ")}]`),wu(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>_a(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>_a(s)).join(",")),`Target(${r})`}(Ln(n))}; limitType=${n.limitType})`}function Tu(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):ye.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of ia(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=hv(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,ia(r),s)||r.endAt&&!function(o,a,l){const c=hv(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,ia(r),s))}(n,e)}function Z0(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function eb(n){return(e,t)=>{let r=!1;for(const s of ia(n)){const i=qP(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function qP(n,e,t){const r=n.field.isKeyField()?ye.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?hi(l,c):Ee()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Ee()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xs{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){bi(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return L0(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zP=new Ct(ye.comparator);function Jn(){return zP}const tb=new Ct(ye.comparator);function wl(...n){let e=tb;for(const t of n)e=e.insert(t.key,t);return e}function nb(n){let e=tb;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Vr(){return Ll()}function rb(){return Ll()}function Ll(){return new xs(n=>n.toString(),(n,e)=>n.isEqual(e))}const GP=new Ct(ye.comparator),KP=new bt(ye.comparator);function We(...n){let e=KP;for(const t of n)e=e.add(t);return e}const HP=new bt($e);function Rp(){return HP}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cp(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Jl(e)?"-0":e}}function sb(n){return{integerValue:""+n}}function ib(n,e){return k0(e)?sb(e):Cp(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qd{constructor(){this._=void 0}}function WP(n,e,t){return n instanceof wa?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&$d(i)&&(i=jd(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof ro?ab(n,e):n instanceof so?lb(n,e):function(s,i){const o=ob(s,i),a=vv(o)+vv(s.Pe);return Cf(o)&&Cf(s.Pe)?sb(a):Cp(s.serializer,a)}(n,e)}function QP(n,e,t){return n instanceof ro?ab(n,e):n instanceof so?lb(n,e):t}function ob(n,e){return n instanceof Ia?function(r){return Cf(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class wa extends qd{}class ro extends qd{constructor(e){super(),this.elements=e}}function ab(n,e){const t=ub(e);for(const r of n.elements)t.some(s=>$r(s,r))||t.push(r);return{arrayValue:{values:t}}}class so extends qd{constructor(e){super(),this.elements=e}}function lb(n,e){let t=ub(e);for(const r of n.elements)t=t.filter(s=>!$r(s,r));return{arrayValue:{values:t}}}class Ia extends qd{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function vv(n){return Ut(n.integerValue||n.doubleValue)}function ub(n){return Zl(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xu{constructor(e,t){this.field=e,this.transform=t}}function JP(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof ro&&s instanceof ro||r instanceof so&&s instanceof so?ga(r.elements,s.elements,$r):r instanceof Ia&&s instanceof Ia?$r(r.Pe,s.Pe):r instanceof wa&&s instanceof wa}(n.transform,e.transform)}class YP{constructor(e,t){this.version=e,this.transformResults=t}}class jt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new jt}static exists(e){return new jt(void 0,e)}static updateTime(e){return new jt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Lc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class zd{}function cb(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Fa(n.key,jt.none()):new La(n.key,n.data,jt.none());{const t=n.data,r=En.empty();let s=new bt($t.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new As(n.key,r,new Qn(s.toArray()),jt.none())}}function XP(n,e,t){n instanceof La?function(s,i,o){const a=s.value.clone(),l=_v(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof As?function(s,i,o){if(!Lc(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=_v(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(db(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Fl(n,e,t,r){return n instanceof La?function(i,o,a,l){if(!Lc(i.precondition,o))return a;const c=i.value.clone(),d=bv(i.fieldTransforms,l,o);return c.setAll(d),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof As?function(i,o,a,l){if(!Lc(i.precondition,o))return a;const c=bv(i.fieldTransforms,l,o),d=o.data;return d.setAll(db(i)),d.setAll(c),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Lc(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function ZP(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=ob(r.transform,s||null);i!=null&&(t===null&&(t=En.empty()),t.set(r.field,i))}return t||null}function yv(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&ga(r,s,(i,o)=>JP(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class La extends zd{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class As extends zd{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function db(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function _v(n,e,t){const r=new Map;Ae(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,QP(o,a,t[s]))}return r}function bv(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,WP(i,o,e))}return r}class Fa extends zd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class kp extends zd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dp{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&XP(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Fl(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Fl(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=rb();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=cb(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(Pe.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),We())}isEqual(e){return this.batchId===e.batchId&&ga(this.mutations,e.mutations,(t,r)=>yv(t,r))&&ga(this.baseMutations,e.baseMutations,(t,r)=>yv(t,r))}}class Vp{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Ae(e.mutations.length===r.length);let s=function(){return GP}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Vp(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Np{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hb{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eR{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nn,lt;function fb(n){switch(n){default:return Ee();case q.CANCELLED:case q.UNKNOWN:case q.DEADLINE_EXCEEDED:case q.RESOURCE_EXHAUSTED:case q.INTERNAL:case q.UNAVAILABLE:case q.UNAUTHENTICATED:return!1;case q.INVALID_ARGUMENT:case q.NOT_FOUND:case q.ALREADY_EXISTS:case q.PERMISSION_DENIED:case q.FAILED_PRECONDITION:case q.ABORTED:case q.OUT_OF_RANGE:case q.UNIMPLEMENTED:case q.DATA_LOSS:return!0}}function pb(n){if(n===void 0)return Yt("GRPC error has no .code"),q.UNKNOWN;switch(n){case nn.OK:return q.OK;case nn.CANCELLED:return q.CANCELLED;case nn.UNKNOWN:return q.UNKNOWN;case nn.DEADLINE_EXCEEDED:return q.DEADLINE_EXCEEDED;case nn.RESOURCE_EXHAUSTED:return q.RESOURCE_EXHAUSTED;case nn.INTERNAL:return q.INTERNAL;case nn.UNAVAILABLE:return q.UNAVAILABLE;case nn.UNAUTHENTICATED:return q.UNAUTHENTICATED;case nn.INVALID_ARGUMENT:return q.INVALID_ARGUMENT;case nn.NOT_FOUND:return q.NOT_FOUND;case nn.ALREADY_EXISTS:return q.ALREADY_EXISTS;case nn.PERMISSION_DENIED:return q.PERMISSION_DENIED;case nn.FAILED_PRECONDITION:return q.FAILED_PRECONDITION;case nn.ABORTED:return q.ABORTED;case nn.OUT_OF_RANGE:return q.OUT_OF_RANGE;case nn.UNIMPLEMENTED:return q.UNIMPLEMENTED;case nn.DATA_LOSS:return q.DATA_LOSS;default:return Ee()}}(lt=nn||(nn={}))[lt.OK=0]="OK",lt[lt.CANCELLED=1]="CANCELLED",lt[lt.UNKNOWN=2]="UNKNOWN",lt[lt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",lt[lt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",lt[lt.NOT_FOUND=5]="NOT_FOUND",lt[lt.ALREADY_EXISTS=6]="ALREADY_EXISTS",lt[lt.PERMISSION_DENIED=7]="PERMISSION_DENIED",lt[lt.UNAUTHENTICATED=16]="UNAUTHENTICATED",lt[lt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",lt[lt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",lt[lt.ABORTED=10]="ABORTED",lt[lt.OUT_OF_RANGE=11]="OUT_OF_RANGE",lt[lt.UNIMPLEMENTED=12]="UNIMPLEMENTED",lt[lt.INTERNAL=13]="INTERNAL",lt[lt.UNAVAILABLE=14]="UNAVAILABLE",lt[lt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ad=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mb(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tR=new Qi([4294967295,4294967295],0);function wv(n){const e=mb().encode(n),t=new g0;return t.update(e),new Uint8Array(t.digest())}function Iv(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Qi([t,r],0),new Qi([s,i],0)]}class Op{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Il(`Invalid padding: ${t}`);if(r<0)throw new Il(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Il(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Il(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Qi.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(Qi.fromNumber(r)));return s.compare(tR)===1&&(s=new Qi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=wv(e),[r,s]=Iv(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Op(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=wv(e),[r,s]=Iv(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Il extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Au{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Su.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Au(Pe.min(),s,new Ct($e),Jn(),We())}}class Su{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Su(r,t,We(),We(),We())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fc{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class gb{constructor(e,t){this.targetId=e,this.me=t}}class vb{constructor(e,t,r=Ht.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Ev{constructor(){this.fe=0,this.ge=xv(),this.pe=Ht.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=We(),t=We(),r=We();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:Ee()}}),new Su(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=xv()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Ae(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class nR{constructor(e){this.Le=e,this.Be=new Map,this.ke=Jn(),this.qe=Tv(),this.Qe=new Ct($e)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:Ee()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(sd(i))if(r===0){const o=new ye(i.path);this.Ue(t,o,Vt.newNoDocument(o,Pe.min()))}else Ae(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}ad==null||ad.et(function(d,f,v,y,C){var A,k,$,B,F,z;const ne={localCacheCount:d,existenceFilterCount:f.count,databaseId:v.database,projectId:v.projectId},re=f.unchangedNames;return re&&(ne.bloomFilter={applied:C===0,hashCount:(A=re==null?void 0:re.hashCount)!==null&&A!==void 0?A:0,bitmapLength:(B=($=(k=re==null?void 0:re.bits)===null||k===void 0?void 0:k.bitmap)===null||$===void 0?void 0:$.length)!==null&&B!==void 0?B:0,padding:(z=(F=re==null?void 0:re.bits)===null||F===void 0?void 0:F.padding)!==null&&z!==void 0?z:0,mightContain:E=>{var I;return(I=y==null?void 0:y.mightContain(E))!==null&&I!==void 0&&I}}),ne}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=ys(r).toUint8Array()}catch(l){if(l instanceof F0)return cr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Op(o,s,i)}catch(l){return cr(l instanceof Il?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&sd(a.target)){const l=new ye(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,Vt.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=We();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Je(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new Au(e,t,this.Qe,this.ke,r);return this.ke=Jn(),this.qe=Tv(),this.Qe=new Ct($e),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Ev,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new bt($e),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||X("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Ev),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Tv(){return new Ct(ye.comparator)}function xv(){return new Ct(ye.comparator)}const rR=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),sR=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),iR=(()=>({and:"AND",or:"OR"}))();class oR{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Of(n,e){return n.useProto3Json||wu(e)?e:{value:e}}function Ea(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function yb(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function aR(n,e){return Ea(n,e.toTimestamp())}function Zt(n){return Ae(!!n),Pe.fromTimestamp(function(t){const r=vs(t);return new Bt(r.seconds,r.nanos)}(n))}function Mp(n,e){return Mf(n,e).canonicalString()}function Mf(n,e){const t=function(s){return new rt(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function _b(n){const e=rt.fromString(n);return Ae(Rb(e)),e}function tu(n,e){return Mp(n.databaseId,e.path)}function Mr(n,e){const t=_b(e);if(t.get(1)!==n.databaseId.projectId)throw new Z(q.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Z(q.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new ye(Ib(t))}function bb(n,e){return Mp(n.databaseId,e)}function wb(n){const e=_b(n);return e.length===4?rt.emptyPath():Ib(e)}function Lf(n){return new rt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Ib(n){return Ae(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Av(n,e,t){return{name:tu(n,e),fields:t.value.mapValue.fields}}function Eb(n,e,t){const r=Mr(n,e.name),s=Zt(e.updateTime),i=e.createTime?Zt(e.createTime):Pe.min(),o=new En({mapValue:{fields:e.fields}}),a=Vt.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function lR(n,e){return"found"in e?function(r,s){Ae(!!s.found),s.found.name,s.found.updateTime;const i=Mr(r,s.found.name),o=Zt(s.found.updateTime),a=s.found.createTime?Zt(s.found.createTime):Pe.min(),l=new En({mapValue:{fields:s.found.fields}});return Vt.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){Ae(!!s.missing),Ae(!!s.readTime);const i=Mr(r,s.missing),o=Zt(s.readTime);return Vt.newNoDocument(i,o)}(n,e):Ee()}function uR(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:Ee()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,d){return c.useProto3Json?(Ae(d===void 0||typeof d=="string"),Ht.fromBase64String(d||"")):(Ae(d===void 0||d instanceof Buffer||d instanceof Uint8Array),Ht.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const d=c.code===void 0?q.UNKNOWN:pb(c.code);return new Z(d,c.message||"")}(o);t=new vb(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Mr(n,r.document.name),i=Zt(r.document.updateTime),o=r.document.createTime?Zt(r.document.createTime):Pe.min(),a=new En({mapValue:{fields:r.document.fields}}),l=Vt.newFoundDocument(s,i,o,a),c=r.targetIds||[],d=r.removedTargetIds||[];t=new Fc(c,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Mr(n,r.document),i=r.readTime?Zt(r.readTime):Pe.min(),o=Vt.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Fc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Mr(n,r.document),i=r.removedTargetIds||[];t=new Fc([],i,s,null)}else{if(!("filter"in e))return Ee();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new eR(s,i),a=r.targetId;t=new gb(a,o)}}return t}function nu(n,e){let t;if(e instanceof La)t={update:Av(n,e.key,e.value)};else if(e instanceof Fa)t={delete:tu(n,e.key)};else if(e instanceof As)t={update:Av(n,e.key,e.data),updateMask:mR(e.fieldMask)};else{if(!(e instanceof kp))return Ee();t={verify:tu(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof wa)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof ro)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof so)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Ia)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw Ee()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:aR(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Ee()}(n,e.precondition)),t}function Ff(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?jt.updateTime(Zt(i.updateTime)):i.exists!==void 0?jt.exists(i.exists):jt.none()}(e.currentDocument):jt.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Ae(a.setToServerValue==="REQUEST_TIME"),l=new wa;else if("appendMissingElements"in a){const d=a.appendMissingElements.values||[];l=new ro(d)}else if("removeAllFromArray"in a){const d=a.removeAllFromArray.values||[];l=new so(d)}else"increment"in a?l=new Ia(o,a.increment):Ee();const c=$t.fromServerFormat(a.fieldPath);return new xu(c,l)}(n,s)):[];if(e.update){e.update.name;const s=Mr(n,e.update.name),i=new En({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new Qn(c.map(d=>$t.fromServerFormat(d)))}(e.updateMask);return new As(s,i,o,t,r)}return new La(s,i,t,r)}if(e.delete){const s=Mr(n,e.delete);return new Fa(s,t)}if(e.verify){const s=Mr(n,e.verify);return new kp(s,t)}return Ee()}function cR(n,e){return n&&n.length>0?(Ae(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?Zt(s.updateTime):Zt(i);return o.isEqual(Pe.min())&&(o=Zt(i)),new YP(o,s.transformResults||[])}(t,e))):[]}function Tb(n,e){return{documents:[bb(n,e.path)]}}function Gd(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=bb(n,s);const i=function(c){if(c.length!==0)return Pb(vt.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(d=>function(v){return{field:Ws(v.field),direction:hR(v.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Of(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function xb(n,e,t,r){const{_t:s,parent:i}=Gd(n,e),o={},a=[];let l=0;return t.forEach(c=>{const d=r?c.alias:"aggregate_"+l++;o[d]=c.alias,c.aggregateType==="count"?a.push({alias:d,count:{}}):c.aggregateType==="avg"?a.push({alias:d,avg:{field:Ws(c.fieldPath)}}):c.aggregateType==="sum"&&a.push({alias:d,sum:{field:Ws(c.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function Ab(n){let e=wb(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Ae(r===1);const d=t.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let i=[];t.where&&(i=function(f){const v=Sb(f);return v instanceof vt&&Sp(v)?v.getFilters():[v]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(v=>function(C){return new eu(Yo(C.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction))}(v))}(t.orderBy));let a=null;t.limit&&(a=function(f){let v;return v=typeof f=="object"?f.value:f,wu(v)?null:v}(t.limit));let l=null;t.startAt&&(l=function(f){const v=!!f.before,y=f.values||[];return new fi(y,v)}(t.startAt));let c=null;return t.endAt&&(c=function(f){const v=!f.before,y=f.values||[];return new fi(y,v)}(t.endAt)),Q0(e,s,o,i,a,"F",l,c)}function dR(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ee()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Sb(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Yo(t.unaryFilter.field);return st.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Yo(t.unaryFilter.field);return st.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Yo(t.unaryFilter.field);return st.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Yo(t.unaryFilter.field);return st.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Ee()}}(n):n.fieldFilter!==void 0?function(t){return st.create(Yo(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ee()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return vt.create(t.compositeFilter.filters.map(r=>Sb(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Ee()}}(t.compositeFilter.op))}(n):Ee()}function hR(n){return rR[n]}function fR(n){return sR[n]}function pR(n){return iR[n]}function Ws(n){return{fieldPath:n.canonicalString()}}function Yo(n){return $t.fromServerFormat(n.fieldPath)}function Pb(n){return n instanceof st?function(t){if(t.op==="=="){if(uv(t.value))return{unaryFilter:{field:Ws(t.field),op:"IS_NAN"}};if(lv(t.value))return{unaryFilter:{field:Ws(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(uv(t.value))return{unaryFilter:{field:Ws(t.field),op:"IS_NOT_NAN"}};if(lv(t.value))return{unaryFilter:{field:Ws(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ws(t.field),op:fR(t.op),value:t.value}}}(n):n instanceof vt?function(t){const r=t.getFilters().map(s=>Pb(s));return r.length===1?r[0]:{compositeFilter:{op:pR(t.op),filters:r}}}(n):Ee()}function mR(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Rb(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ls{constructor(e,t,r,s,i=Pe.min(),o=Pe.min(),a=Ht.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new ls(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ls(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ls(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ls(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cb{constructor(e){this.ct=e}}function gR(n,e){let t;if(e.document)t=Eb(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=ye.fromSegments(e.noDocument.path),s=oo(e.noDocument.readTime);t=Vt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Ee();{const r=ye.fromSegments(e.unknownDocument.path),s=oo(e.unknownDocument.version);t=Vt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Bt(s[0],s[1]);return Pe.fromTimestamp(i)}(e.readTime)),t}function Sv(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:ld(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:tu(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Ea(i,o.version.toTimestamp()),createTime:Ea(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:io(e.version)};else{if(!e.isUnknownDocument())return Ee();r.unknownDocument={path:t.path.toArray(),version:io(e.version)}}return r}function ld(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function io(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function oo(n){const e=new Bt(n.seconds,n.nanoseconds);return Pe.fromTimestamp(e)}function qi(n,e){const t=(e.baseMutations||[]).map(i=>Ff(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>Ff(n.ct,i)),s=Bt.fromMillis(e.localWriteTimeMs);return new Dp(e.batchId,s,t,r)}function El(n){const e=oo(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?oo(n.lastLimboFreeSnapshotVersion):Pe.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return Ae(i.documents.length===1),Ln(Ma(wb(i.documents[0])))}(n.query):function(i){return Ln(Ab(i))}(n.query),new ls(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ht.fromBase64String(n.resumeToken))}function kb(n,e){const t=io(e.snapshotVersion),r=io(e.lastLimboFreeSnapshotVersion);let s;s=sd(e.target)?Tb(n.ct,e.target):Gd(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:no(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Lp(n){const e=Ab({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?od(e,e.limit,"L"):e}function Kh(n,e){return new Np(e.largestBatchId,Ff(n.ct,e.overlayMutation))}function Pv(n,e){const t=e.path.lastSegment();return[n,Mn(e.path.popLast()),t]}function Rv(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:io(r.readTime),documentKey:Mn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vR{getBundleMetadata(e,t){return Cv(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:oo(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return Cv(e).put(function(s){return{bundleId:s.id,createTime:io(Zt(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return kv(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Lp(i.bundledQuery),readTime:oo(i.readTime)}}(r)})}saveNamedQuery(e,t){return kv(e).put(function(s){return{name:s.name,readTime:io(Zt(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function Cv(n){return dn(n,"bundles")}function kv(n){return dn(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kd{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new Kd(e,r)}getOverlay(e,t){return dl(e).get(Pv(this.userId,t)).next(r=>r?Kh(this.serializer,r):null)}getOverlays(e,t){const r=Vr();return L.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Np(t,o);s.push(this.ht(e,a))}),L.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(Mn(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(dl(e).j("collectionPathOverlayIndex",a))}),L.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Vr(),i=Mn(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return dl(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=Kh(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Vr();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return dl(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,d)=>{const f=Kh(this.serializer,c);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):d.done()}).next(()=>i)}ht(e,t){return dl(e).put(function(s,i,o){const[a,l,c]=Pv(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:nu(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function dl(n){return dn(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yR{Pt(e){return dn(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?Ht.fromUint8Array(r):Ht.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Ut(e.integerValue));else if("doubleValue"in e){const r=Ut(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),Jl(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=vs(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(ys(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?U0(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Bd(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Ee()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(Ut(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),ye.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}zi.vt=new zi;function _R(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Dv(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=_R(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class bR{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=Dv(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=Dv(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class wR{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class IR{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class hl{constructor(){this.jt=new bR,this.Ht=new wR(this.jt),this.Jt=new IR(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gi{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Gi(this.indexId,this.documentKey,this.arrayValue,r)}}function js(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=Vv(n.arrayValue,e.arrayValue),t!==0?t:(t=Vv(n.directionalValue,e.directionalValue),t!==0?t:ye.comparator(n.documentKey,e.documentKey)))}function Vv(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nv{constructor(e){this.Xt=new bt((t,r)=>$t.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Ae(e.collectionGroup===this.collectionId),this.nn)return!1;const t=Sf(e);if(t!==void 0&&!this.sn(t))return!1;const r=$i(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new bt($t.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Ji(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Ji(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Ji(r.field,r.dir==="asc"?0:1)));return new va(va.UNKNOWN_ID,this.collectionId,t,ya.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Db(n){var e,t;if(Ae(n instanceof st||n instanceof vt),n instanceof st){if(n instanceof W0){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>st.create(n.field,"==",i)))||[];return vt.create(s,"or")}return n}const r=n.filters.map(s=>Db(s));return vt.create(r,n.op)}function ER(n){if(n.getFilters().length===0)return[];const e=jf(Db(n));return Ae(Vb(e)),Uf(e)||$f(e)?[e]:e.getFilters()}function Uf(n){return n instanceof st}function $f(n){return n instanceof vt&&Sp(n)}function Vb(n){return Uf(n)||$f(n)||function(t){if(t instanceof vt&&kf(t)){for(const r of t.getFilters())if(!Uf(r)&&!$f(r))return!1;return!0}return!1}(n)}function jf(n){if(Ae(n instanceof st||n instanceof vt),n instanceof st)return n;if(n.filters.length===1)return jf(n.filters[0]);const e=n.filters.map(r=>jf(r));let t=vt.create(e,n.op);return t=ud(t),Vb(t)?t:(Ae(t instanceof vt),Ae(ba(t)),Ae(t.filters.length>1),t.filters.reduce((r,s)=>Fp(r,s)))}function Fp(n,e){let t;return Ae(n instanceof st||n instanceof vt),Ae(e instanceof st||e instanceof vt),t=n instanceof st?e instanceof st?function(s,i){return vt.create([s,i],"and")}(n,e):Ov(n,e):e instanceof st?Ov(e,n):function(s,i){if(Ae(s.filters.length>0&&i.filters.length>0),ba(s)&&ba(i))return G0(s,i.getFilters());const o=kf(s)?s:i,a=kf(s)?i:s,l=o.filters.map(c=>Fp(c,a));return vt.create(l,"or")}(n,e),ud(t)}function Ov(n,e){if(ba(e))return G0(e,n.getFilters());{const t=e.filters.map(r=>Fp(n,r));return vt.create(t,"or")}}function ud(n){if(Ae(n instanceof st||n instanceof vt),n instanceof st)return n;const e=n.getFilters();if(e.length===1)return ud(e[0]);if(q0(n))return n;const t=e.map(s=>ud(s)),r=[];return t.forEach(s=>{s instanceof st?r.push(s):s instanceof vt&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:vt.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TR{constructor(){this.un=new Up}addToCollectionParentIndex(e,t){return this.un.add(t),L.resolve()}getCollectionParents(e,t){return L.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return L.resolve()}deleteFieldIndex(e,t){return L.resolve()}deleteAllFieldIndexes(e){return L.resolve()}createTargetIndexes(e,t){return L.resolve()}getDocumentsMatchingTarget(e,t){return L.resolve(null)}getIndexType(e,t){return L.resolve(0)}getFieldIndexes(e,t){return L.resolve([])}getNextCollectionGroupToUpdate(e){return L.resolve(null)}getMinOffset(e,t){return L.resolve(rr.min())}getMinOffsetFromCollectionGroup(e,t){return L.resolve(rr.min())}updateCollectionGroup(e,t,r){return L.resolve()}updateIndexEntries(e,t){return L.resolve()}}class Up{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new bt(rt.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new bt(rt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _c=new Uint8Array(0);class xR{constructor(e,t){this.databaseId=t,this.cn=new Up,this.ln=new xs(r=>no(r),(r,s)=>Iu(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:Mn(s)};return Mv(e).put(i)}return L.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[x0(t),""],!1,!0);return Mv(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Dr(o.parent))}return r})}addFieldIndex(e,t){const r=fl(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=qo(e);return i.next(a=>{o.put(Rv(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=fl(e),s=qo(e),i=Bo(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=fl(e),r=Bo(e),s=qo(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return L.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new Nv(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=Bo(e);let s=!0;const i=new Map;return L.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=We();const a=[];return L.forEach(i,(l,c)=>{X("IndexedDbIndexManager",`Using index ${function(F){return`id=${F.indexId}|cg=${F.collectionGroup}|f=${F.fields.map(z=>`${z.fieldPath}:${z.kind}`).join(",")}`}(l)} to execute ${no(t)}`);const d=function(F,z){const ne=Sf(z);if(ne===void 0)return null;for(const re of id(F,ne.fieldPath))switch(re.op){case"array-contains-any":return re.value.arrayValue.values||[];case"array-contains":return[re.value]}return null}(c,l),f=function(F,z){const ne=new Map;for(const re of $i(z))for(const E of id(F,re.fieldPath))switch(E.op){case"==":case"in":ne.set(re.fieldPath.canonicalString(),E.value);break;case"not-in":case"!=":return ne.set(re.fieldPath.canonicalString(),E.value),Array.from(ne.values())}return null}(c,l),v=function(F,z){const ne=[];let re=!0;for(const E of $i(z)){const I=E.kind===0?pv(F,E.fieldPath,F.startAt):mv(F,E.fieldPath,F.startAt);ne.push(I.value),re&&(re=I.inclusive)}return new fi(ne,re)}(c,l),y=function(F,z){const ne=[];let re=!0;for(const E of $i(z)){const I=E.kind===0?mv(F,E.fieldPath,F.endAt):pv(F,E.fieldPath,F.endAt);ne.push(I.value),re&&(re=I.inclusive)}return new fi(ne,re)}(c,l),C=this.In(l,c,v),A=this.In(l,c,y),k=this.Tn(l,c,f),$=this.En(l.indexId,d,C,v.inclusive,A,y.inclusive,k);return L.forEach($,B=>r.G(B,t.limit).next(F=>{F.forEach(z=>{const ne=ye.fromSegments(z.documentKey);o.has(ne)||(o=o.add(ne),a.push(ne))})}))}).next(()=>a)}return L.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=ER(vt.create(e.filters,"and")).map(r=>Vf(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),c=l/(t!=null?t.length:1),d=[];for(let f=0;f<l;++f){const v=t?this.dn(t[f/c]):_c,y=this.An(e,v,r[f%c],s),C=this.Rn(e,v,i[f%c],o),A=a.map(k=>this.An(e,v,k,!0));d.push(...this.createRange(y,C,A))}return d}An(e,t,r,s){const i=new Gi(e,ye.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new Gi(e,ye.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new Nv(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return L.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new bt($t.comparator),d=!1;for(const f of l.filters)for(const v of f.getFlattenedFilters())v.field.isKeyField()||(v.op==="array-contains"||v.op==="array-contains-any"?d=!0:c=c.add(v.field));for(const f of l.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(d?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new hl;for(const s of $i(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);zi.vt.It(i,o)}return r.zt()}dn(e){const t=new hl;return zi.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new hl;return zi.vt.It(to(this.databaseId,t),r.Yt(function(i){const o=$i(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new hl);let i=0;for(const o of $i(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&Zl(a))s=this.gn(s,o,a);else{const c=l.Yt(o.kind);zi.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new hl;l.seed(a.zt()),zi.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof st&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=fl(e),s=qo(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return L.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(d,f){const v=f?new ya(f.sequenceNumber,new rr(oo(f.readTime),new ye(Dr(f.documentKey)),f.largestBatchId)):ya.empty(),y=d.fields.map(([C,A])=>new Ji($t.fromServerFormat(C),A));return new va(d.indexId,d.collectionGroup,y,v)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:$e(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=fl(e),i=qo(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>L.forEach(a,l=>i.put(Rv(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return L.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?L.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),L.forEach(a,l=>this.wn(e,s,l).next(c=>{const d=this.Sn(i,l);return c.isEqual(d)?L.resolve():this.bn(e,i,l,c,d)}))))})}Dn(e,t,r,s){return Bo(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return Bo(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=Bo(e);let i=new bt(js);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new Gi(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new bt(js);const s=this.Vn(t,e);if(s==null)return r;const i=Sf(t);if(i!=null){const o=e.data.field(i.fieldPath);if(Zl(o))for(const a of o.arrayValue.values||[])r=r.add(new Gi(t.indexId,e.key,this.dn(a),s))}else r=r.add(new Gi(t.indexId,e.key,_c,s));return r}bn(e,t,r,s,i){X("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,c,d,f,v){const y=l.getIterator(),C=c.getIterator();let A=jo(y),k=jo(C);for(;A||k;){let $=!1,B=!1;if(A&&k){const F=d(A,k);F<0?B=!0:F>0&&($=!0)}else A!=null?B=!0:$=!0;$?(f(k),k=jo(C)):B?(v(A),A=jo(y)):(A=jo(y),k=jo(C))}}(s,i,js,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),L.waitFor(o)}yn(e){let t=1;return qo(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>js(o,a)).filter((o,a,l)=>!a||js(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=js(o,e),l=js(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,_c,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,_c,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return js(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Lv)}getMinOffset(e,t){return L.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||Ee())).next(Lv)}}function Mv(n){return dn(n,"collectionParents")}function Bo(n){return dn(n,"indexEntries")}function fl(n){return dn(n,"indexConfiguration")}function qo(n){return dn(n,"indexState")}function Lv(n){Ae(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Tp(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new rr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fv={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class kn{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new kn(e,kn.DEFAULT_COLLECTION_PERCENTILE,kn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nb(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(d,f,v)=>(a++,v.delete()));i.push(l.next(()=>{Ae(a===1)}));const c=[];for(const d of t.mutations){const f=D0(e,d.key.path,t.batchId);i.push(s.delete(f)),c.push(d.key)}return L.waitFor(i).next(()=>c)}function cd(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Ee();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */kn.DEFAULT_COLLECTION_PERCENTILE=10,kn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,kn.DEFAULT=new kn(41943040,kn.DEFAULT_COLLECTION_PERCENTILE,kn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),kn.DISABLED=new kn(-1,0,0);class Hd{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){Ae(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new Hd(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Bs(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Xo(e),o=Bs(e);return o.add({}).next(a=>{Ae(typeof a=="number");const l=new Dp(a,t,r,s),c=function(y,C,A){const k=A.baseMutations.map(B=>nu(y.ct,B)),$=A.mutations.map(B=>nu(y.ct,B));return{userId:C,batchId:A.batchId,localWriteTimeMs:A.localWriteTime.toMillis(),baseMutations:k,mutations:$}}(this.serializer,this.userId,l),d=[];let f=new bt((v,y)=>$e(v.canonicalString(),y.canonicalString()));for(const v of s){const y=D0(this.userId,v.key.path,a);f=f.add(v.key.path.popLast()),d.push(o.put(c)),d.push(i.put(y,fP))}return f.forEach(v=>{d.push(this.indexManager.addToCollectionParentIndex(e,v))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),L.waitFor(d).next(()=>l)})}lookupMutationBatch(e,t){return Bs(e).get(t).next(r=>r?(Ae(r.userId===this.userId),qi(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?L.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Bs(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(Ae(a.batchId>=r),i=qi(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Bs(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Bs(e).U("userMutationsIndex",t).next(r=>r.map(s=>qi(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Vc(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Xo(e).J({range:s},(o,a,l)=>{const[c,d,f]=o,v=Dr(d);if(c===this.userId&&t.path.isEqual(v))return Bs(e).get(f).next(y=>{if(!y)throw Ee();Ae(y.userId===this.userId),i.push(qi(this.serializer,y))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new bt($e);const s=[];return t.forEach(i=>{const o=Vc(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Xo(e).J({range:a},(c,d,f)=>{const[v,y,C]=c,A=Dr(y);v===this.userId&&i.path.isEqual(A)?r=r.add(C):f.done()});s.push(l)}),L.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Vc(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new bt($e);return Xo(e).J({range:o},(l,c,d)=>{const[f,v,y]=l,C=Dr(v);f===this.userId&&r.isPrefixOf(C)?C.length===s&&(a=a.add(y)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(Bs(e).get(i).next(o=>{if(o===null)throw Ee();Ae(o.userId===this.userId),r.push(qi(this.serializer,o))}))}),L.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return Nb(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),L.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return L.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Xo(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=Dr(i[1]);s.push(l)}else a.done()}).next(()=>{Ae(s.length===0)})})}containsKey(e,t){return Ob(e,this.userId,t)}Nn(e){return Mb(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Ob(n,e,t){const r=Vc(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Xo(n).J({range:i,H:!0},(a,l,c)=>{const[d,f,v]=a;d===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function Bs(n){return dn(n,"mutations")}function Xo(n){return dn(n,"documentMutations")}function Mb(n){return dn(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new ao(0)}static kn(){return new ao(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AR{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new ao(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>Pe.fromTimestamp(new Bt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>zo(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Ae(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return zo(e).J((o,a)=>{const l=El(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>L.waitFor(i)).next(()=>s)}forEachTarget(e,t){return zo(e).J((r,s)=>{const i=El(s);t(i)})}qn(e){return Uv(e).get("targetGlobalKey").next(t=>(Ae(t!==null),t))}Qn(e,t){return Uv(e).put("targetGlobalKey",t)}Kn(e,t){return zo(e).put(kb(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=no(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return zo(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const c=El(a);Iu(t,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=Qs(e);return t.forEach(o=>{const a=Mn(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),L.waitFor(s)}removeMatchingKeys(e,t,r){const s=Qs(e);return L.forEach(t,i=>{const o=Mn(i.path);return L.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=Qs(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=Qs(e);let i=We();return s.J({range:r,H:!0},(o,a,l)=>{const c=Dr(o[1]),d=new ye(c);i=i.add(d)}).next(()=>i)}containsKey(e,t){const r=Mn(t.path),s=IDBKeyRange.bound([r],[x0(r)],!1,!0);let i=0;return Qs(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return zo(e).get(t).next(r=>r?El(r):null)}}function zo(n){return dn(n,"targets")}function Uv(n){return dn(n,"targetGlobal")}function Qs(n){return dn(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $v([n,e],[t,r]){const s=$e(n,t);return s===0?$e(e,r):s}class SR{constructor(e){this.Un=e,this.buffer=new bt($v),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();$v(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Lb{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){X("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){_i(t)?X("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await yi(t)}await this.Hn(3e5)})}}class PR{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return L.resolve(Wn.oe);const r=new SR(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(X("LruGarbageCollector","Garbage collection skipped; disabled"),L.resolve(Fv)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(X("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Fv):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,c;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(X("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),Qo()<=tt.DEBUG&&X("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(c-l)+`ms
Total Duration: ${c-d}ms`),L.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function Fb(n,e){return new PR(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RR{constructor(e,t){this.db=e,this.garbageCollector=Fb(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return bc(e,r)}removeReference(e,t,r){return bc(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return bc(e,t)}nr(e,t){return function(s,i){let o=!1;return Mb(s).Y(a=>Ob(s,a,i).next(l=>(l&&(o=!0),L.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,Pe.min()),Qs(e).delete(function(f){return[0,Mn(f.path)]}(o))))});s.push(l)}}).next(()=>L.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return bc(e,t)}tr(e,t){const r=Qs(e);let s,i=Wn.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==Wn.oe&&t(new ye(Dr(s)),i),i=c,s=l):i=Wn.oe}).next(()=>{i!==Wn.oe&&t(new ye(Dr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function bc(n,e){return Qs(n).put(function(r,s){return{targetId:0,path:Mn(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ub{constructor(){this.changes=new xs(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Vt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?L.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CR{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Li(e).put(r)}removeEntry(e,t,r){return Li(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],ld(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=Vt.newInvalidDocument(t);return Li(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(pl(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:Vt.newInvalidDocument(t)};return Li(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(pl(t))},(s,i)=>{r={document:this.ir(t,i),size:cd(i)}}).next(()=>r)}getEntries(e,t){let r=Jn();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=Jn(),s=new Ct(ye.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,cd(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return L.resolve();let s=new bt(qv);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(pl(s.first()),pl(s.last())),o=s.getIterator();let a=o.getNext();return Li(e).J({index:"documentKeyIndex",range:i},(l,c,d)=>{const f=ye.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&qv(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?d.$(pl(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),ld(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Li(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let d=Jn();for(const f of c){const v=this.ir(ye.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);v.isFoundDocument()&&(Tu(t,v)||s.has(v.key))&&(d=d.insert(v.key,v))}return d})}getAllFromCollectionGroup(e,t,r,s){let i=Jn();const o=Bv(t,r),a=Bv(t,rr.max());return Li(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,d)=>{const f=this.ir(ye.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(f.key,f),i.size===s&&d.done()}).next(()=>i)}newChangeBuffer(e){return new kR(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return jv(e).get("remoteDocumentGlobalKey").next(t=>(Ae(!!t),t))}rr(e,t){return jv(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=gR(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Pe.min())))return r}return Vt.newInvalidDocument(e)}}function $b(n){return new CR(n)}class kR extends Ub{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new xs(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new bt((i,o)=>$e(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=Sv(this.cr.serializer,o);s=s.add(i.path.popLast());const c=cd(l);r+=c-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=Sv(this.cr.serializer,o.convertToNoDocument(Pe.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),L.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function jv(n){return dn(n,"remoteDocumentGlobal")}function Li(n){return dn(n,"remoteDocumentsV14")}function pl(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Bv(n,e){const t=e.documentKey.path.toArray();return[n,ld(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function qv(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=$e(t[i],r[i]),s)return s;return s=$e(t.length,r.length),s||(s=$e(t[t.length-2],r[r.length-2]),s||$e(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DR{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jb{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Fl(r.mutation,s,Qn.empty(),Bt.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,We()).next(()=>r))}getLocalViewOfDocuments(e,t,r=We()){const s=Vr();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=wl();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Vr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,We()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=Jn();const o=Ll(),a=function(){return Ll()}();return t.forEach((l,c)=>{const d=r.get(c.key);s.has(c.key)&&(d===void 0||d.mutation instanceof As)?i=i.insert(c.key,c):d!==void 0?(o.set(c.key,d.mutation.getFieldMask()),Fl(d.mutation,c,d.mutation.getFieldMask(),Bt.now())):o.set(c.key,Qn.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,d)=>o.set(c,d)),t.forEach((c,d)=>{var f;return a.set(c,new DR(d,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Ll();let s=new Ct((o,a)=>o-a),i=We();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let d=r.get(l)||Qn.empty();d=a.applyToLocalView(c,d),r.set(l,d);const f=(s.get(a.batchId)||We()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,d=l.value,f=rb();d.forEach(v=>{if(!i.has(v)){const y=cb(t.get(v),r.get(v));y!==null&&f.set(v,y),i=i.add(v)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return L.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return ye.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Pp(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):L.resolve(Vr());let a=-1,l=i;return o.next(c=>L.forEach(c,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(d)?L.resolve():this.remoteDocumentCache.getEntry(e,d).next(v=>{l=l.insert(d,v)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,We())).next(d=>({batchId:a,changes:nb(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ye(t)).next(r=>{let s=wl();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=wl();return this.indexManager.getCollectionParents(e,i).next(a=>L.forEach(a,l=>{const c=function(f,v){return new Ts(v,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(d=>{d.forEach((f,v)=>{o=o.insert(f,v)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const d=c.getKey();o.get(d)===null&&(o=o.insert(d,Vt.newInvalidDocument(d)))});let a=wl();return o.forEach((l,c)=>{const d=i.get(l);d!==void 0&&Fl(d.mutation,c,Qn.empty(),Bt.now()),Tu(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VR{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return L.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Zt(s.createTime)}}(t)),L.resolve()}getNamedQuery(e,t){return L.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:Lp(s.bundledQuery),readTime:Zt(s.readTime)}}(t)),L.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NR{constructor(){this.overlays=new Ct(ye.comparator),this.Ir=new Map}getOverlay(e,t){return L.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Vr();return L.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),L.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),L.resolve()}getOverlaysForCollection(e,t,r){const s=Vr(),i=t.length+1,o=new ye(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return L.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Ct((c,d)=>c-d);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let d=i.get(c.largestBatchId);d===null&&(d=Vr(),i=i.insert(c.largestBatchId,d)),d.set(c.getKey(),c)}}const a=Vr(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,d)=>a.set(c,d)),!(a.size()>=s)););return L.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Np(t,r));let i=this.Ir.get(t);i===void 0&&(i=We(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OR{constructor(){this.sessionToken=Ht.EMPTY_BYTE_STRING}getSessionToken(e){return L.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,L.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $p{constructor(){this.Tr=new bt(gn.Er),this.dr=new bt(gn.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new gn(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new gn(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new ye(new rt([])),r=new gn(t,e),s=new gn(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new ye(new rt([])),r=new gn(t,e),s=new gn(t,e+1);let i=We();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new gn(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class gn{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return ye.comparator(e.key,t.key)||$e(e.wr,t.wr)}static Ar(e,t){return $e(e.wr,t.wr)||ye.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MR{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new bt(gn.Er)}checkEmpty(e){return L.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Dp(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new gn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return L.resolve(o)}lookupMutationBatch(e,t){return L.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return L.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return L.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return L.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new gn(t,0),s=new gn(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),L.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new bt($e);return t.forEach(s=>{const i=new gn(s,0),o=new gn(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),L.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;ye.isDocumentKey(i)||(i=i.child(""));const o=new gn(new ye(i),0);let a=new bt($e);return this.br.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.wr)),!0)},o),L.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Ae(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return L.forEach(t.mutations,s=>{const i=new gn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new gn(t,0),s=this.br.firstAfterOrEqual(r);return L.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,L.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LR{constructor(e){this.Mr=e,this.docs=function(){return new Ct(ye.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return L.resolve(r?r.document.mutableCopy():Vt.newInvalidDocument(t))}getEntries(e,t){let r=Jn();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Vt.newInvalidDocument(s))}),L.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Jn();const o=t.path,a=new ye(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:d}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Tp(S0(d),r)<=0||(s.has(d.key)||Tu(t,d))&&(i=i.insert(d.key,d.mutableCopy()))}return L.resolve(i)}getAllFromCollectionGroup(e,t,r,s){Ee()}Or(e,t){return L.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new FR(this)}getSize(e){return L.resolve(this.size)}}class FR extends Ub{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),L.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UR{constructor(e){this.persistence=e,this.Nr=new xs(t=>no(t),Iu),this.lastRemoteSnapshotVersion=Pe.min(),this.highestTargetId=0,this.Lr=0,this.Br=new $p,this.targetCount=0,this.kr=ao.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),L.resolve()}getLastRemoteSnapshotVersion(e){return L.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return L.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),L.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),L.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new ao(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,L.resolve()}updateTargetData(e,t){return this.Kn(t),L.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,L.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),L.waitFor(i).next(()=>s)}getTargetCount(e){return L.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return L.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),L.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),L.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),L.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return L.resolve(r)}containsKey(e,t){return L.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jp{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Wn(0),this.Kr=!1,this.Kr=!0,this.$r=new OR,this.referenceDelegate=e(this),this.Ur=new UR(this),this.indexManager=new TR,this.remoteDocumentCache=function(s){return new LR(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new Cb(t),this.Gr=new VR(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new NR,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new MR(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){X("MemoryPersistence","Starting transaction:",e);const s=new $R(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return L.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class $R extends R0{constructor(e){super(),this.currentSequenceNumber=e}}class Wd{constructor(e){this.persistence=e,this.Jr=new $p,this.Yr=null}static Zr(e){return new Wd(e)}get Xr(){if(this.Yr)return this.Yr;throw Ee()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),L.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),L.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),L.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return L.forEach(this.Xr,r=>{const s=ye.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,Pe.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return L.or([()=>L.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class dd{constructor(e,t){this.persistence=e,this.ti=new xs(r=>Mn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=Fb(this,t)}static Zr(e,t){return new dd(e,t)}zr(){}jr(e){return L.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return L.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?L.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,Pe.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),L.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),L.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),L.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),L.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Oc(e.data.value)),t}nr(e,t,r){return L.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return L.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jR{constructor(e){this.serializer=e}O(e,t,r,s){const i=new Ud("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",rv,{unique:!0}),l.createObjectStore("documentMutations")}(e),zv(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=L.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),zv(e)),o=o.next(()=>function(l){const c=l.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Pe.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",d)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store("mutations").U().next(d=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",rv,{unique:!0});const f=c.store("mutations"),v=d.map(y=>f.put(y));return L.waitFor(v)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore("documentOverlays",{keyPath:xP});c.createIndex("collectionPathOverlayIndex",AP,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",SP,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore("remoteDocumentsV14",{keyPath:pP});c.createIndex("documentKeyIndex",mP),c.createIndex("collectionGroupIndex",gP)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:wP}).createIndex("sequenceNumberIndex",IP,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:EP}).createIndex("documentKeyIndex",TP,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=cd(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>L.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>L.forEach(a,l=>{Ae(l.userId===i.userId);const c=qi(this.serializer,l);return Nb(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new rt(o),c=function(f){return[0,Mn(f)]}(l);i.push(t.get(c).next(d=>d?L.resolve():(f=>t.put({targetId:0,path:Mn(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>L.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:bP});const r=t.store("collectionParents"),s=new Up,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Mn(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new rt(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],c)=>{const d=Dr(a);return i(d.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=El(s),o=kb(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new ye(rt.fromString(f.document.name).popFirst(5)):f.noDocument?ye.fromSegments(f.noDocument.path):f.unknownDocument?ye.fromSegments(f.unknownDocument.path):Ee()}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>L.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=$b(this.serializer),i=new jp(Wd.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var c;let d=(c=a.get(l.userId))!==null&&c!==void 0?c:We();qi(this.serializer,l).keys().forEach(f=>d=d.add(f)),a.set(l.userId,d)}),L.forEach(a,(l,c)=>{const d=new vn(c),f=Kd.lt(this.serializer,d),v=i.getIndexManager(d),y=Hd.lt(d,this.serializer,v,i.referenceDelegate);return new jb(s,y,f,v).recalculateAndSaveOverlaysForDocumentKeys(new Pf(t,Wn.oe),l).next()})})}}function zv(n){n.createObjectStore("targetDocuments",{keyPath:yP}).createIndex("documentTargetsIndex",_P,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",vP,{unique:!0}),n.createObjectStore("targetGlobal")}const Hh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Bp{constructor(e,t,r,s,i,o,a,l,c,d,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=d,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=v=>Promise.resolve(),!Bp.D())throw new Z(q.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new RR(this,s),this.Ai=t+"main",this.serializer=new Cb(l),this.Ri=new Or(this.Ai,this.hi,new jR(this.serializer)),this.$r=new yR,this.Ur=new AR(this.referenceDelegate,this.serializer),this.remoteDocumentCache=$b(this.serializer),this.Gr=new vR,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&Yt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Z(q.FAILED_PRECONDITION,Hh);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Wn(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>wc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(_i(e))return X("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return X("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return ml(e).get("owner").next(t=>L.resolve(this.vi(t)))}Ci(e){return wc(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=dn(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return L.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?L.resolve(!0):ml(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new Z(q.FAILED_PRECONDITION,Hh);return!1}}return!(!this.networkEnabled||!this.inForeground)||wc(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&X("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new Pf(e,Wn.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>wc(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Hd.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new xR(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Kd.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){X("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?CP:l===16?RP:l===15?Ap:l===14?O0:l===13?N0:l===12?PP:l===11?V0:void Ee()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new Pf(a,this.Qr?this.Qr.next():Wn.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw Yt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new Z(q.FAILED_PRECONDITION,P0);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return ml(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Z(q.FAILED_PRECONDITION,Hh)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ml(e).put("owner",t)}static D(){return Or.D()}bi(e){const t=ml(e);return t.get("owner").next(r=>this.vi(r)?(X("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):L.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Yt(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;l0()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return X("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Yt("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Yt("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function ml(n){return dn(n,"owner")}function wc(n){return dn(n,"clientMetadata")}function qp(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zp{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=We(),s=We();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new zp(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BR{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bb{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return l0()?8:C0(cn())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new BR;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(Qo()<=tt.DEBUG&&X("QueryEngine","SDK will not create cache indexes for query:",Jo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),L.resolve()):(Qo()<=tt.DEBUG&&X("QueryEngine","Query:",Jo(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Qo()<=tt.DEBUG&&X("QueryEngine","The SDK decides to create cache indexes for query:",Jo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ln(t))):L.resolve())}Yi(e,t){if(gv(t))return L.resolve(null);let r=Ln(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=od(t,null,"F"),r=Ln(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=We(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ts(t,a);return this.ns(t,c,o,l.readTime)?this.Yi(e,od(t,null,"F")):this.rs(e,c,t,l)}))})))}Zi(e,t,r,s){return gv(t)||s.isEqual(Pe.min())?L.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?L.resolve(null):(Qo()<=tt.DEBUG&&X("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Jo(t)),this.rs(e,o,t,A0(s,-1)).next(a=>a))})}ts(e,t){let r=new bt(eb(e));return t.forEach((s,i)=>{Tu(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return Qo()<=tt.DEBUG&&X("QueryEngine","Using full collection scan to execute query:",Jo(t)),this.Ji.getDocumentsMatchingQuery(e,t,rr.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qR{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Ct($e),this._s=new xs(i=>no(i),Iu),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new jb(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function qb(n,e,t,r){return new qR(n,e,t,r)}async function zb(n,e){const t=pe(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=We();for(const c of s){o.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}for(const c of i){a.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(r,l).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function zR(n,e){const t=pe(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,d){const f=c.batch,v=f.keys();let y=L.resolve();return v.forEach(C=>{y=y.next(()=>d.getEntry(l,C)).next(A=>{const k=c.docVersions.get(C);Ae(k!==null),A.version.compareTo(k)<0&&(f.applyToRemoteDocument(A,c),A.isValidDocument()&&(A.setReadTime(c.commitVersion),d.addEntry(A)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=We();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function Gb(n){const e=pe(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function GR(n,e){const t=pe(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((d,f)=>{const v=s.get(f);if(!v)return;a.push(t.Ur.removeMatchingKeys(i,d.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,d.addedDocuments,f)));let y=v.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(Ht.EMPTY_BYTE_STRING,Pe.min()).withLastLimboFreeSnapshotVersion(Pe.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,r)),s=s.insert(f,y),function(A,k,$){return A.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-A.snapshotVersion.toMicroseconds()>=3e8?!0:$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0}(v,y,d)&&a.push(t.Ur.updateTargetData(i,y))});let l=Jn(),c=We();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,d))}),a.push(Kb(i,o,e.documentUpdates).next(d=>{l=d.Ps,c=d.Is})),!r.isEqual(Pe.min())){const d=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(d)}return L.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.os=s,i))}function Kb(n,e,t){let r=We(),s=We();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=Jn();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(Pe.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):X("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function KR(n,e){const t=pe(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Ta(n,e){const t=pe(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,L.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new ls(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function xa(n,e,t){const r=pe(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!_i(o))throw o;X("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function hd(n,e,t){const r=pe(n);let s=Pe.min(),i=We();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,d){const f=pe(l),v=f._s.get(d);return v!==void 0?L.resolve(f.os.get(v)):f.Ur.getTargetData(c,d)}(r,o,Ln(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:Pe.min(),t?i:We())).next(a=>(Qb(r,Z0(e),a),{documents:a,Ts:i})))}function Hb(n,e){const t=pe(n),r=pe(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function Wb(n,e){const t=pe(n),r=t.us.get(e)||Pe.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,A0(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(Qb(t,e,s),s))}function Qb(n,e,t){let r=n.us.get(e)||Pe.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function HR(n,e,t,r){const s=pe(n);let i=We(),o=Jn();for(const c of t){const d=e.Es(c.metadata.name);c.document&&(i=i.add(d));const f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(d,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await Ta(s,function(d){return Ln(Ma(rt.fromString(`__bundle__/docs/${d}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>Kb(c,a,o).next(d=>(a.apply(c),d)).next(d=>s.Ur.removeMatchingKeysForTargetId(c,l.targetId).next(()=>s.Ur.addMatchingKeys(c,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,d.Ps,d.Is)).next(()=>d.Ps)))}async function WR(n,e,t=We()){const r=await Ta(n,Ln(Lp(e.bundledQuery))),s=pe(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=Zt(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(Ht.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function Gv(n,e){return`firestore_clients_${n}_${e}`}function Kv(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Wh(n,e){return`firestore_targets_${n}_${e}`}class fd{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new Z(s.error.code,s.error.message))),o?new fd(e,t,s.state,i):(Yt("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ul{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new Z(r.error.code,r.error.message))),i?new Ul(e,r.state,s):(Yt("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class pd{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Rp();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=k0(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new pd(e,i):(Yt("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Gp{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Gp(t.clientId,t.onlineState):(Yt("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Bf{constructor(){this.activeTargetIds=Rp()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Qh{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Ct($e),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=Gv(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Bf),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(Gv(this.persistenceKey,r));if(s){const i=pd.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Wh(this.persistenceKey,e));if(s){const i=Ul.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Wh(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return X("SharedClientState","READ",e,t),t}setItem(e,t){X("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){X("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(X("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void Yt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=Wn.oe;if(i!=null)try{const a=JSON.parse(i);Ae(typeof a=="number"),o=a}catch(a){Yt("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Wn.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new fd(this.currentUser,e,t,r),i=Kv(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=Kv(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=Wh(this.persistenceKey,e),i=new Ul(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return pd.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return fd.Rs(new vn(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return Ul.Rs(s,t)}Ls(e){return Gp.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);X("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Rp();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class Jb{constructor(){this.so=new Bf,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Bf,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QR{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hv{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){X("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){X("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ic=null;function Jh(){return Ic===null?Ic=function(){return 268435456+Math.round(2147483648*Math.random())}():Ic++,"0x"+Ic.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YR{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rn="WebChannelConnection";class XR extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=Jh(),l=this.xo(t,r.toUriEncodedString());X("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,l,c,s).then(d=>(X("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw cr("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",l,"request:",s),d})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Oa}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=JR[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=Jh();return new Promise((o,a)=>{const l=new v0;l.setWithCredentials(!0),l.listenOnce(y0.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case Dc.NO_ERROR:const d=l.getResponseJson();X(Rn,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(d)),o(d);break;case Dc.TIMEOUT:X(Rn,`RPC '${e}' ${i} timed out`),a(new Z(q.DEADLINE_EXCEEDED,"Request time out"));break;case Dc.HTTP_ERROR:const f=l.getStatus();if(X(Rn,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let v=l.getResponseJson();Array.isArray(v)&&(v=v[0]);const y=v==null?void 0:v.error;if(y&&y.status&&y.message){const C=function(k){const $=k.toLowerCase().replace(/_/g,"-");return Object.values(q).indexOf($)>=0?$:q.UNKNOWN}(y.status);a(new Z(C,y.message))}else a(new Z(q.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new Z(q.UNAVAILABLE,"Connection failed."));break;default:Ee()}}finally{X(Rn,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);X(Rn,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=Jh(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=w0(),a=b0(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const d=i.join("");X(Rn,`Creating RPC '${e}' stream ${s}: ${d}`,l);const f=o.createWebChannel(d,l);let v=!1,y=!1;const C=new YR({Io:k=>{y?X(Rn,`Not sending because RPC '${e}' stream ${s} is closed:`,k):(v||(X(Rn,`Opening RPC '${e}' stream ${s} transport.`),f.open(),v=!0),X(Rn,`RPC '${e}' stream ${s} sending:`,k),f.send(k))},To:()=>f.close()}),A=(k,$,B)=>{k.listen($,F=>{try{B(F)}catch(z){setTimeout(()=>{throw z},0)}})};return A(f,bl.EventType.OPEN,()=>{y||(X(Rn,`RPC '${e}' stream ${s} transport opened.`),C.yo())}),A(f,bl.EventType.CLOSE,()=>{y||(y=!0,X(Rn,`RPC '${e}' stream ${s} transport closed`),C.So())}),A(f,bl.EventType.ERROR,k=>{y||(y=!0,cr(Rn,`RPC '${e}' stream ${s} transport errored:`,k),C.So(new Z(q.UNAVAILABLE,"The operation could not be completed")))}),A(f,bl.EventType.MESSAGE,k=>{var $;if(!y){const B=k.data[0];Ae(!!B);const F=B,z=F.error||(($=F[0])===null||$===void 0?void 0:$.error);if(z){X(Rn,`RPC '${e}' stream ${s} received error:`,z);const ne=z.status;let re=function(x){const P=nn[x];if(P!==void 0)return pb(P)}(ne),E=z.message;re===void 0&&(re=q.INTERNAL,E="Unknown error status: "+ne+" with message "+z.message),y=!0,C.So(new Z(re,E)),f.close()}else X(Rn,`RPC '${e}' stream ${s} received:`,B),C.bo(B)}}),A(a,_0.STAT_EVENT,k=>{k.stat===Af.PROXY?X(Rn,`RPC '${e}' stream ${s} detected buffering proxy`):k.stat===Af.NOPROXY&&X(Rn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{C.wo()},0),C}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yb(){return typeof window<"u"?window:null}function Uc(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pu(n){return new oR(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kp{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&X("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xb{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Kp(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===q.RESOURCE_EXHAUSTED?(Yt(t.toString()),Yt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===q.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new Z(q.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return X("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(X("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ZR extends Xb{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=uR(this.serializer,e),r=function(i){if(!("targetChange"in i))return Pe.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Pe.min():o.readTime?Zt(o.readTime):Pe.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=Lf(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=sd(l)?{documents:Tb(i,l)}:{query:Gd(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=yb(i,o.resumeToken);const c=Of(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(Pe.min())>0){a.readTime=Ea(i,o.snapshotVersion.toTimestamp());const c=Of(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=dR(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=Lf(this.serializer),t.removeTarget=e,this.a_(t)}}class e1 extends Xb{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Ae(!!e.streamToken),this.lastStreamToken=e.streamToken,Ae(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Ae(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=cR(e.writeResults,e.commitTime),r=Zt(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=Lf(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>nu(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t1 extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new Z(q.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,Mf(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Z(q.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,Mf(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Z(q.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class n1{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Yt(t),this.D_=!1):X("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r1{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{wi(this)&&(X("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=pe(l);c.L_.add(4),await Ua(c),c.q_.set("Unknown"),c.L_.delete(4),await Ru(c)}(this))})}),this.q_=new n1(r,s)}}async function Ru(n){if(wi(n))for(const e of n.B_)await e(!0)}async function Ua(n){for(const e of n.B_)await e(!1)}function Qd(n,e){const t=pe(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Qp(t)?Wp(t):ja(t).r_()&&Hp(t,e))}function Aa(n,e){const t=pe(n),r=ja(t);t.N_.delete(e),r.r_()&&Zb(t,e),t.N_.size===0&&(r.r_()?r.o_():wi(t)&&t.q_.set("Unknown"))}function Hp(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Pe.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ja(n).A_(e)}function Zb(n,e){n.Q_.xe(e),ja(n).R_(e)}function Wp(n){n.Q_=new nR({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),ja(n).start(),n.q_.v_()}function Qp(n){return wi(n)&&!ja(n).n_()&&n.N_.size>0}function wi(n){return pe(n).L_.size===0}function ew(n){n.Q_=void 0}async function s1(n){n.q_.set("Online")}async function i1(n){n.N_.forEach((e,t)=>{Hp(n,e)})}async function o1(n,e){ew(n),Qp(n)?(n.q_.M_(e),Wp(n)):n.q_.set("Unknown")}async function a1(n,e,t){if(n.q_.set("Online"),e instanceof vb&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){X("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await md(n,r)}else if(e instanceof Fc?n.Q_.Ke(e):e instanceof gb?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Pe.min()))try{const r=await Gb(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const d=i.N_.get(c);d&&i.N_.set(c,d.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const d=i.N_.get(l);if(!d)return;i.N_.set(l,d.withResumeToken(Ht.EMPTY_BYTE_STRING,d.snapshotVersion)),Zb(i,l);const f=new ls(d.target,l,c,d.sequenceNumber);Hp(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){X("RemoteStore","Failed to raise snapshot:",r),await md(n,r)}}async function md(n,e,t){if(!_i(e))throw e;n.L_.add(1),await Ua(n),n.q_.set("Offline"),t||(t=()=>Gb(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{X("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await Ru(n)})}function tw(n,e){return e().catch(t=>md(n,t,e))}async function $a(n){const e=pe(n),t=pi(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;l1(e);)try{const s=await KR(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,u1(e,s)}catch(s){await md(e,s)}nw(e)&&rw(e)}function l1(n){return wi(n)&&n.O_.length<10}function u1(n,e){n.O_.push(e);const t=pi(n);t.r_()&&t.V_&&t.m_(e.mutations)}function nw(n){return wi(n)&&!pi(n).n_()&&n.O_.length>0}function rw(n){pi(n).start()}async function c1(n){pi(n).p_()}async function d1(n){const e=pi(n);for(const t of n.O_)e.m_(t.mutations)}async function h1(n,e,t){const r=n.O_.shift(),s=Vp.from(r,e,t);await tw(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await $a(n)}async function f1(n,e){e&&pi(n).V_&&await async function(r,s){if(function(o){return fb(o)&&o!==q.ABORTED}(s.code)){const i=r.O_.shift();pi(r).s_(),await tw(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await $a(r)}}(n,e),nw(n)&&rw(n)}async function Wv(n,e){const t=pe(n);t.asyncQueue.verifyOperationInProgress(),X("RemoteStore","RemoteStore received new credentials");const r=wi(t);t.L_.add(3),await Ua(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Ru(t)}async function qf(n,e){const t=pe(n);e?(t.L_.delete(2),await Ru(t)):e||(t.L_.add(2),await Ua(t),t.q_.set("Unknown"))}function ja(n){return n.K_||(n.K_=function(t,r,s){const i=pe(t);return i.w_(),new ZR(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:s1.bind(null,n),Ro:i1.bind(null,n),mo:o1.bind(null,n),d_:a1.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Qp(n)?Wp(n):n.q_.set("Unknown")):(await n.K_.stop(),ew(n))})),n.K_}function pi(n){return n.U_||(n.U_=function(t,r,s){const i=pe(t);return i.w_(),new e1(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:c1.bind(null,n),mo:f1.bind(null,n),f_:d1.bind(null,n),g_:h1.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await $a(n)):(await n.U_.stop(),n.O_.length>0&&(X("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jp{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new yn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Jp(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Z(q.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ba(n,e){if(Yt("AsyncQueue",`${e}: ${n}`),_i(n))return new Z(q.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oa{constructor(e){this.comparator=e?(t,r)=>e(t,r)||ye.comparator(t.key,r.key):(t,r)=>ye.comparator(t.key,r.key),this.keyedMap=wl(),this.sortedSet=new Ct(this.comparator)}static emptySet(e){return new oa(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof oa)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new oa;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qv{constructor(){this.W_=new Ct(ye.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Ee():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Sa{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Sa(e,t,oa.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Eu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p1{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class m1{constructor(){this.queries=Jv(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=pe(t),i=s.queries;s.queries=Jv(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new Z(q.ABORTED,"Firestore shutting down"))}}function Jv(){return new xs(n=>X0(n),Eu)}async function Yp(n,e){const t=pe(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new p1,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Ba(o,`Initialization of query '${Jo(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Zp(t)}async function Xp(n,e){const t=pe(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function g1(n,e){const t=pe(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&Zp(t)}function v1(n,e,t){const r=pe(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function Zp(n){n.Y_.forEach(e=>{e.next()})}var zf,Yv;(Yv=zf||(zf={})).ea="default",Yv.Cache="cache";class em{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Sa(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Sa.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==zf.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y1{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xv{constructor(e){this.serializer=e}Es(e){return Mr(this.serializer,e)}ds(e){return e.metadata.exists?Eb(this.serializer,e.document,!1):Vt.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Zt(e)}}class _1{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=sw(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=rt.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new Xv(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||We()).add(i);t.set(o,a)}}return t}async complete(){const e=await HR(this.localStore,new Xv(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await WR(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function sw(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iw{constructor(e){this.key=e}}class ow{constructor(e){this.key=e}}class aw{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=We(),this.mutatedKeys=We(),this.Aa=eb(e),this.Ra=new oa(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new Qv,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((d,f)=>{const v=s.get(d),y=Tu(this.query,f)?f:null,C=!!v&&this.mutatedKeys.has(v.key),A=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let k=!1;v&&y?v.data.isEqual(y.data)?C!==A&&(r.track({type:3,doc:y}),k=!0):this.ga(v,y)||(r.track({type:2,doc:y}),k=!0,(l&&this.Aa(y,l)>0||c&&this.Aa(y,c)<0)&&(a=!0)):!v&&y?(r.track({type:0,doc:y}),k=!0):v&&!y&&(r.track({type:1,doc:v}),k=!0,(l||c)&&(a=!0)),k&&(y?(o=o.add(y),i=A?i.add(d):i.delete(d)):(o=o.delete(d),i=i.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),i=i.delete(d.key),r.track({type:1,doc:d})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((d,f)=>function(y,C){const A=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ee()}};return A(y)-A(C)}(d.type,f.type)||this.Aa(d.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,c=l!==this.Ea;return this.Ea=l,o.length!==0||c?{snapshot:new Sa(this.query,e.Ra,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Qv,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=We(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new ow(r))}),this.da.forEach(r=>{e.has(r)||t.push(new iw(r))}),t}ba(e){this.Ta=e.Ts,this.da=We();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Sa.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class b1{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class w1{constructor(e){this.key=e,this.va=!1}}class I1{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new xs(a=>X0(a),Eu),this.Ma=new Map,this.xa=new Set,this.Oa=new Ct(ye.comparator),this.Na=new Map,this.La=new $p,this.Ba={},this.ka=new Map,this.qa=ao.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function E1(n,e,t=!0){const r=Jd(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await lw(r,e,t,!0),s}async function T1(n,e){const t=Jd(n);await lw(t,e,!0,!1)}async function lw(n,e,t,r){const s=await Ta(n.localStore,Ln(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await tm(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&Qd(n.remoteStore,s),a}async function tm(n,e,t,r,s){n.Ka=(f,v,y)=>async function(A,k,$,B){let F=k.view.ma($);F.ns&&(F=await hd(A.localStore,k.query,!1).then(({documents:E})=>k.view.ma(E,F)));const z=B&&B.targetChanges.get(k.targetId),ne=B&&B.targetMismatches.get(k.targetId)!=null,re=k.view.applyChanges(F,A.isPrimaryClient,z,ne);return Gf(A,k.targetId,re.wa),re.snapshot}(n,f,v,y);const i=await hd(n.localStore,e,!0),o=new aw(e,i.Ts),a=o.ma(i.documents),l=Su.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);Gf(n,t,c.wa);const d=new b1(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function x1(n,e,t){const r=pe(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!Eu(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await xa(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Aa(r.remoteStore,s.targetId),Pa(r,s.targetId)}).catch(yi)):(Pa(r,s.targetId),await xa(r.localStore,s.targetId,!0))}async function A1(n,e){const t=pe(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Aa(t.remoteStore,r.targetId))}async function S1(n,e,t){const r=im(n);try{const s=await function(o,a){const l=pe(o),c=Bt.now(),d=a.reduce((y,C)=>y.add(C.key),We());let f,v;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let C=Jn(),A=We();return l.cs.getEntries(y,d).next(k=>{C=k,C.forEach(($,B)=>{B.isValidDocument()||(A=A.add($))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,C)).next(k=>{f=k;const $=[];for(const B of a){const F=ZP(B,f.get(B.key).overlayedDocument);F!=null&&$.push(new As(B.key,F,j0(F.value.mapValue),jt.exists(!0)))}return l.mutationQueue.addMutationBatch(y,c,$,a)}).next(k=>{v=k;const $=k.applyToLocalDocumentSet(f,A);return l.documentOverlayCache.saveOverlays(y,k.batchId,$)})}).then(()=>({batchId:v.batchId,changes:nb(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Ba[o.currentUser.toKey()];c||(c=new Ct($e)),c=c.insert(a,l),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await Ss(r,s.changes),await $a(r.remoteStore)}catch(s){const i=Ba(s,"Failed to persist write");t.reject(i)}}async function uw(n,e){const t=pe(n);try{const r=await GR(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(Ae(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Ae(o.va):s.removedDocuments.size>0&&(Ae(o.va),o.va=!1))}),await Ss(t,r,e)}catch(r){await yi(r)}}function Zv(n,e,t){const r=pe(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=pe(o);l.onlineState=a;let c=!1;l.queries.forEach((d,f)=>{for(const v of f.j_)v.Z_(a)&&(c=!0)}),c&&Zp(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function P1(n,e,t){const r=pe(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Ct(ye.comparator);o=o.insert(i,Vt.newNoDocument(i,Pe.min()));const a=We().add(i),l=new Au(Pe.min(),new Map,new Ct($e),o,a);await uw(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),sm(r)}else await xa(r.localStore,e,!1).then(()=>Pa(r,e,t)).catch(yi)}async function R1(n,e){const t=pe(n),r=e.batch.batchId;try{const s=await zR(t.localStore,e);rm(t,r,null),nm(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Ss(t,s)}catch(s){await yi(s)}}async function C1(n,e,t){const r=pe(n);try{const s=await function(o,a){const l=pe(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let d;return l.mutationQueue.lookupMutationBatch(c,a).next(f=>(Ae(f!==null),d=f.keys(),l.mutationQueue.removeMutationBatch(c,f))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,d,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,d)).next(()=>l.localDocuments.getDocuments(c,d))})}(r.localStore,e);rm(r,e,t),nm(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Ss(r,s)}catch(s){await yi(s)}}async function k1(n,e){const t=pe(n);wi(t.remoteStore)||X("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=pe(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=Ba(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function nm(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function rm(n,e,t){const r=pe(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function Pa(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||cw(n,r)})}function cw(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Aa(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),sm(n))}function Gf(n,e,t){for(const r of t)r instanceof iw?(n.La.addReference(r.key,e),D1(n,r)):r instanceof ow?(X("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||cw(n,r.key)):Ee()}function D1(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(X("SyncEngine","New document in limbo: "+t),n.xa.add(r),sm(n))}function sm(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new ye(rt.fromString(e)),r=n.qa.next();n.Na.set(r,new w1(t)),n.Oa=n.Oa.insert(t,r),Qd(n.remoteStore,new ls(Ln(Ma(t.path)),r,"TargetPurposeLimboResolution",Wn.oe))}}async function Ss(n,e,t){const r=pe(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(c=>{var d;if((c||t)&&r.isPrimaryClient){const f=c?!c.fromCache:(d=t==null?void 0:t.targetChanges.get(l.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(c){s.push(c);const f=zp.Wi(l.targetId,c);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,c){const d=pe(l);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>L.forEach(c,v=>L.forEach(v.$i,y=>d.persistence.referenceDelegate.addReference(f,v.targetId,y)).next(()=>L.forEach(v.Ui,y=>d.persistence.referenceDelegate.removeReference(f,v.targetId,y)))))}catch(f){if(!_i(f))throw f;X("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const v=f.targetId;if(!f.fromCache){const y=d.os.get(v),C=y.snapshotVersion,A=y.withLastLimboFreeSnapshotVersion(C);d.os=d.os.insert(v,A)}}}(r.localStore,i))}async function V1(n,e){const t=pe(n);if(!t.currentUser.isEqual(e)){X("SyncEngine","User change. New user:",e.toKey());const r=await zb(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new Z(q.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Ss(t,r.hs)}}function N1(n,e){const t=pe(n),r=t.Na.get(e);if(r&&r.va)return We().add(r.key);{let s=We();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function O1(n,e){const t=pe(n),r=await hd(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&Gf(t,e.targetId,s.wa),s}async function M1(n,e){const t=pe(n);return Wb(t.localStore,e).then(r=>Ss(t,r))}async function L1(n,e,t,r){const s=pe(n),i=await function(a,l){const c=pe(a),d=pe(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>d.Mn(f,l).next(v=>v?c.localDocuments.getDocuments(f,v):L.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await $a(s.remoteStore):t==="acknowledged"||t==="rejected"?(rm(s,e,r||null),nm(s,e),function(a,l){pe(pe(a).mutationQueue).On(l)}(s.localStore,e)):Ee(),await Ss(s,i)):X("SyncEngine","Cannot apply mutation batch with id: "+e)}async function F1(n,e){const t=pe(n);if(Jd(t),im(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await ey(t,r.toArray());t.Qa=!0,await qf(t.remoteStore,!0);for(const i of s)Qd(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Pa(t,o),xa(t.localStore,o,!0))),Aa(t.remoteStore,o)}),await s,await ey(t,r),function(o){const a=pe(o);a.Na.forEach((l,c)=>{Aa(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new Ct(ye.comparator)}(t),t.Qa=!1,await qf(t.remoteStore,!1)}}async function ey(n,e,t){const r=pe(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await Ta(r.localStore,Ln(l[0]));for(const c of l){const d=r.Fa.get(c),f=await O1(r,d);f.snapshot&&i.push(f.snapshot)}}else{const c=await Hb(r.localStore,o);a=await Ta(r.localStore,c),await tm(r,dw(c),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function dw(n){return Q0(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function U1(n){return function(t){return pe(pe(t).persistence).Qi()}(pe(n).localStore)}async function $1(n,e,t,r){const s=pe(n);if(s.Qa)return void X("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await Wb(s.localStore,Z0(i[0])),a=Au.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ht.EMPTY_BYTE_STRING);await Ss(s,o,a);break}case"rejected":await xa(s.localStore,e,!0),Pa(s,e,r);break;default:Ee()}}async function j1(n,e,t){const r=Jd(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){X("SyncEngine","Adding an already active target "+s);continue}const i=await Hb(r.localStore,s),o=await Ta(r.localStore,i);await tm(r,dw(i),o.targetId,!1,o.resumeToken),Qd(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await xa(r.localStore,s,!1).then(()=>{Aa(r.remoteStore,s),Pa(r,s)}).catch(yi)}}function Jd(n){const e=pe(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=uw.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=N1.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=P1.bind(null,e),e.Ca.d_=g1.bind(null,e.eventManager),e.Ca.$a=v1.bind(null,e.eventManager),e}function im(n){const e=pe(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=R1.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=C1.bind(null,e),e}function B1(n,e,t){const r=pe(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(y,C){const A=pe(y),k=Zt(C.createTime);return A.persistence.runTransaction("hasNewerBundle","readonly",$=>A.Gr.getBundleMetadata($,C.id)).then($=>!!$&&$.createTime.compareTo(k)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(sw(l));const c=new _1(l,i.localStore,o.serializer);let d=await o.Ua();for(;d;){const v=await c.la(d);v&&a._updateProgress(v),d=await o.Ua()}const f=await c.complete();return await Ss(i,f.Ia,void 0),await function(y,C){const A=pe(y);return A.persistence.runTransaction("Save bundle","readwrite",k=>A.Gr.saveBundleMetadata(k,C))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(l){return cr("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class mi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Pu(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return qb(this.persistence,new Bb,e.initialUser,this.serializer)}Ga(e){return new jp(Wd.Zr,this.serializer)}Wa(e){return new Jb}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}mi.provider={build:()=>new mi};class q1 extends mi{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){Ae(this.persistence.referenceDelegate instanceof dd);const r=this.persistence.referenceDelegate.garbageCollector;return new Lb(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?kn.withCacheSize(this.cacheSizeBytes):kn.DEFAULT;return new jp(r=>dd.Zr(r,t),this.serializer)}}class om extends mi{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await im(this.Ja.syncEngine),await $a(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return qb(this.persistence,new Bb,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new Lb(r,e.asyncQueue,t)}Ha(e,t){const r=new dP(t,this.persistence);return new cP(e.asyncQueue,r)}Ga(e){const t=qp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?kn.withCacheSize(this.cacheSizeBytes):kn.DEFAULT;return new Bp(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Yb(),Uc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new Jb}}class hw extends om{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof Qh&&(this.sharedClientState.syncEngine={no:L1.bind(null,t),ro:$1.bind(null,t),io:j1.bind(null,t),Qi:U1.bind(null,t),eo:M1.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await F1(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=Yb();if(!Qh.D(t))throw new Z(q.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=qp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Qh(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class gi{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Zv(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=V1.bind(null,this.syncEngine),await qf(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new m1}()}createDatastore(e){const t=Pu(e.databaseInfo.databaseId),r=function(i){return new XR(i)}(e.databaseInfo);return function(i,o,a,l){return new t1(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new r1(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>Zv(this.syncEngine,t,0),function(){return Hv.D()?new Hv:new QR}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,d){const f=new I1(s,i,o,a,l,c);return d&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=pe(s);X("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await Ua(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}gi.provider={build:()=>new gi};function ty(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Yt("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z1{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new yn,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new y1(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G1{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new Z(q.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=pe(s),a={documents:i.map(f=>tu(o.serializer,f))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,rt.emptyPath(),a,i.length),c=new Map;l.forEach(f=>{const v=lR(o.serializer,f);c.set(v.key.toString(),v)});const d=[];return i.forEach(f=>{const v=c.get(f.toString());Ae(!!v),d.push(v)}),d}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Fa(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=ye.fromPath(r);this.mutations.push(new kp(s,this.precondition(s)))}),await async function(r,s){const i=pe(r),o={writes:s.map(a=>nu(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,rt.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Ee();t=Pe.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new Z(q.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Pe.min())?jt.exists(!1):jt.updateTime(t):jt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Pe.min()))throw new Z(q.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return jt.updateTime(t)}return jt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K1{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new Kp(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new G1(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!wu(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!fb(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H1{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=vn.UNAUTHENTICATED,this.clientId=T0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{X("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(X("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new yn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Ba(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Yh(n,e){n.asyncQueue.verifyOperationInProgress(),X("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await zb(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function ny(n,e){n.asyncQueue.verifyOperationInProgress();const t=await am(n);X("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Wv(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>Wv(e.remoteStore,s)),n._onlineComponents=e}async function am(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){X("FirestoreClient","Using user provided OfflineComponentProvider");try{await Yh(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===q.FAILED_PRECONDITION||s.code===q.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;cr("Error using user provided cache. Falling back to memory cache: "+t),await Yh(n,new mi)}}else X("FirestoreClient","Using default OfflineComponentProvider"),await Yh(n,new mi);return n._offlineComponents}async function Xd(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(X("FirestoreClient","Using user provided OnlineComponentProvider"),await ny(n,n._uninitializedComponentsProvider._online)):(X("FirestoreClient","Using default OnlineComponentProvider"),await ny(n,new gi))),n._onlineComponents}function fw(n){return am(n).then(e=>e.persistence)}function qa(n){return am(n).then(e=>e.localStore)}function pw(n){return Xd(n).then(e=>e.remoteStore)}function lm(n){return Xd(n).then(e=>e.syncEngine)}function mw(n){return Xd(n).then(e=>e.datastore)}async function Ra(n){const e=await Xd(n),t=e.eventManager;return t.onListen=E1.bind(null,e.syncEngine),t.onUnlisten=x1.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=T1.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=A1.bind(null,e.syncEngine),t}function W1(n){return n.asyncQueue.enqueue(async()=>{const e=await fw(n),t=await pw(n);return e.setNetworkEnabled(!0),function(s){const i=pe(s);return i.L_.delete(0),Ru(i)}(t)})}function Q1(n){return n.asyncQueue.enqueue(async()=>{const e=await fw(n),t=await pw(n);return e.setNetworkEnabled(!1),async function(s){const i=pe(s);i.L_.add(0),await Ua(i),i.q_.set("Offline")}(t)})}function J1(n,e){const t=new yn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(c,d){const f=pe(c);return f.persistence.runTransaction("read document","readonly",v=>f.localDocuments.getDocument(v,d))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new Z(q.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=Ba(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await qa(n),e,t)),t.promise}function gw(n,e,t={}){const r=new yn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new Yd({next:v=>{d.Za(),o.enqueueAndForget(()=>Xp(i,f));const y=v.docs.has(a);!y&&v.fromCache?c.reject(new Z(q.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&v.fromCache&&l&&l.source==="server"?c.reject(new Z(q.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(v)},error:v=>c.reject(v)}),f=new em(Ma(a.path),d,{includeMetadataChanges:!0,_a:!0});return Yp(i,f)}(await Ra(n),n.asyncQueue,e,t,r)),r.promise}function Y1(n,e){const t=new yn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await hd(s,i,!0),l=new aw(i,a.Ts),c=l.ma(a.documents),d=l.applyChanges(c,!1);o.resolve(d.snapshot)}catch(a){const l=Ba(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await qa(n),e,t)),t.promise}function vw(n,e,t={}){const r=new yn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new Yd({next:v=>{d.Za(),o.enqueueAndForget(()=>Xp(i,f)),v.fromCache&&l.source==="server"?c.reject(new Z(q.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(v)},error:v=>c.reject(v)}),f=new em(a,d,{includeMetadataChanges:!0,_a:!0});return Yp(i,f)}(await Ra(n),n.asyncQueue,e,t,r)),r.promise}function X1(n,e,t){const r=new yn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await mw(n);r.resolve(async function(o,a,l){var c;const d=pe(o),{request:f,ut:v,parent:y}=xb(d.serializer,J0(a),l);d.connection.Fo||delete f.parent;const C=(await d.Lo("RunAggregationQuery",d.serializer.databaseId,y,f,1)).filter(k=>!!k.result);Ae(C.length===1);const A=(c=C[0].result)===null||c===void 0?void 0:c.aggregateFields;return Object.keys(A).reduce((k,$)=>(k[v[$]]=A[$],k),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function Z1(n,e){const t=new Yd(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){pe(s).Y_.add(i),i.next()}(await Ra(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){pe(s).Y_.delete(i)}(await Ra(n),t))}}function eC(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?mb().encode(o):o,function(d,f){return new z1(d,f)}(function(d,f){if(d instanceof Uint8Array)return ty(d,f);if(d instanceof ArrayBuffer)return ty(new Uint8Array(d),f);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,Pu(e));n.asyncQueue.enqueueAndForget(async()=>{B1(await lm(n),s,r)})}function tC(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=pe(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await qa(n),e))}function nC(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=pe(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(c=>function(f,v,y,C,A){f=[...f],v=[...v],f.sort(y),v.sort(y);const k=f.length,$=v.length;let B=0,F=0;for(;B<$&&F<k;){const z=y(f[F],v[B]);z<0?A(f[F++]):z>0?C(v[B++]):(B++,F++)}for(;B<$;)C(v[B++]);for(;F<k;)A(f[F++])}(c,s,oP,d=>{a.push(o.addFieldIndex(l,d))},d=>{a.push(o.deleteFieldIndex(l,d))})).next(()=>L.waitFor(a)))}(await qa(n),e))}function rC(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){pe(r).ss.zi=s}(await qa(n),e))}function sC(n){return n.asyncQueue.enqueue(async()=>function(t){const r=pe(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await qa(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yw(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ry=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function um(n,e,t){if(!t)throw new Z(q.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function iC(n,e,t,r){if(e===!0&&r===!0)throw new Z(q.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function sy(n){if(!ye.isDocumentKey(n))throw new Z(q.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function iy(n){if(ye.isDocumentKey(n))throw new Z(q.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Zd(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Ee()}function Ze(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Z(q.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Zd(n);throw new Z(q.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function _w(n,e){if(e<=0)throw new Z(q.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oy{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new Z(q.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Z(q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}iC("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=yw((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Z(q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Z(q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Z(q.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Cu{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new oy({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Z(q.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Z(q.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new oy(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new XS;switch(r.type){case"firstParty":return new nP(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Z(q.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=ry.get(t);r&&(X("ComponentProvider","Removing Datastore"),ry.delete(t),r.terminate())}(this),Promise.resolve()}}function oC(n,e,t,r={}){var s;const i=(n=Ze(n,Cu))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&cr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=vn.MOCK_USER;else{a=SA(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new Z(q.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new vn(c)}n._authCredentials=new ZS(new I0(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Tn(this.firestore,e,this._query)}}class en{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Lr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new en(this.firestore,e,this._key)}}class Lr extends Tn{constructor(e,t,r){super(e,t,Ma(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new en(this.firestore,null,new ye(e))}withConverter(e){return new Lr(this.firestore,e,this._path)}}function Xe(n,e,...t){if(n=Re(n),um("collection","path",e),n instanceof Cu){const r=rt.fromString(e,...t);return iy(r),new Lr(n,null,r)}{if(!(n instanceof en||n instanceof Lr))throw new Z(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(rt.fromString(e,...t));return iy(r),new Lr(n.firestore,null,r)}}function X4(n,e){if(n=Ze(n,Cu),um("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Z(q.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Tn(n,null,function(r){return new Ts(rt.emptyPath(),r)}(e))}function Me(n,e,...t){if(n=Re(n),arguments.length===1&&(e=T0.newId()),um("doc","path",e),n instanceof Cu){const r=rt.fromString(e,...t);return sy(r),new en(n,null,new ye(r))}{if(!(n instanceof en||n instanceof Lr))throw new Z(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(rt.fromString(e,...t));return sy(r),new en(n.firestore,n instanceof Lr?n.converter:null,new ye(r))}}function Z4(n,e){return n=Re(n),e=Re(e),(n instanceof en||n instanceof Lr)&&(e instanceof en||e instanceof Lr)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function bw(n,e){return n=Re(n),e=Re(e),n instanceof Tn&&e instanceof Tn&&n.firestore===e.firestore&&Eu(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ay{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Kp(this,"async_queue_retry"),this.Vu=()=>{const r=Uc();r&&X("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=Uc();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Uc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new yn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!_i(e))throw e;X("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Yt("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Jp.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&Ee()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function Kf(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class aC{constructor(){this._progressObserver={},this._taskCompletionResolver=new yn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e3=-1;class Tt extends Cu{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new ay,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ay(e),this._firestoreClient=void 0,await e}}}function t3(n,e,t){t||(t="(default)");const r=bu(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(ui(i,e))return s;throw new Z(q.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new Z(q.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Z(q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function lC(n,e){const t=typeof n=="object"?n:f0(),r=typeof n=="string"?n:e||"(default)",s=bu(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=xA("firestore");i&&oC(s,...i)}return s}function qt(n){if(n._terminated)throw new Z(q.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||ww(n),n._firestoreClient}function ww(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,c,d){return new DP(a,l,c,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,yw(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new H1(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function uC(n,e){cr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return Iw(n,gi.provider,{build:r=>new om(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function n3(n){cr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();Iw(n,gi.provider,{build:t=>new hw(t,e.cacheSizeBytes)})}function Iw(n,e,t){if((n=Ze(n,Tt))._firestoreClient||n._terminated)throw new Z(q.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new Z(q.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},ww(n)}function r3(n){if(n._initialized&&!n._terminated)throw new Z(q.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new yn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Or.D())return Promise.resolve();const s=r+"main";await Or.delete(s)}(qp(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function s3(n){return function(t){const r=new yn;return t.asyncQueue.enqueueAndForget(async()=>k1(await lm(t),r)),r.promise}(qt(n=Ze(n,Tt)))}function i3(n){return W1(qt(n=Ze(n,Tt)))}function o3(n){return Q1(qt(n=Ze(n,Tt)))}function a3(n){return FS(n.app,"firestore",n._databaseId.database),n._delete()}function l3(n,e){const t=qt(n=Ze(n,Tt)),r=new aC;return eC(t,n._databaseId,e,r),r}function u3(n,e){return tC(qt(n=Ze(n,Tt)),e).then(t=>t?new Tn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ru{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class cC{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lo{constructor(e){this._byteString=e}static fromBase64String(e){try{return new lo(Ht.fromBase64String(e))}catch(t){throw new Z(q.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new lo(Ht.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Z(q.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new $t(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function c3(){return new co("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ho{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cm{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Z(q.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Z(q.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return $e(this._lat,e._lat)||$e(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eh{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dC=/^__.*__$/;class hC{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new As(e,this.data,this.fieldMask,t,this.fieldTransforms):new La(e,this.data,t,this.fieldTransforms)}}class Ew{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new As(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Tw(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ee()}}class th{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new th(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return gd(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(Tw(this.Cu)&&dC.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class fC{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Pu(e)}Qu(e,t,r,s=!1){return new th({Cu:e,methodName:t,qu:r,path:$t.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function fo(n){const e=n._freezeSettings(),t=Pu(n._databaseId);return new fC(n._databaseId,!!e.ignoreUndefinedProperties,t)}function nh(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);vm("Data must be an object, but it was:",o,r);const a=Sw(r,o);let l,c;if(i.merge)l=new Qn(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const d=[];for(const f of i.mergeFields){const v=su(e,f,t);if(!o.contains(v))throw new Z(q.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);Rw(d,v)||d.push(v)}l=new Qn(d),c=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,c=o.fieldTransforms;return new hC(new En(a),l,c)}class ku extends ho{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ku}}function xw(n,e,t){return new th({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class dm extends ho{_toFieldTransform(e){return new xu(e.path,new wa)}isEqual(e){return e instanceof dm}}class hm extends ho{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=xw(this,e,!0),r=this.Ku.map(i=>po(i,t)),s=new ro(r);return new xu(e.path,s)}isEqual(e){return e instanceof hm&&ui(this.Ku,e.Ku)}}class fm extends ho{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=xw(this,e,!0),r=this.Ku.map(i=>po(i,t)),s=new so(r);return new xu(e.path,s)}isEqual(e){return e instanceof fm&&ui(this.Ku,e.Ku)}}class pm extends ho{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new Ia(e.serializer,ib(e.serializer,this.$u));return new xu(e.path,t)}isEqual(e){return e instanceof pm&&this.$u===e.$u}}function mm(n,e,t,r){const s=n.Qu(1,e,t);vm("Data must be an object, but it was:",s,r);const i=[],o=En.empty();bi(r,(l,c)=>{const d=rh(e,l,t);c=Re(c);const f=s.Nu(d);if(c instanceof ku)i.push(d);else{const v=po(c,f);v!=null&&(i.push(d),o.set(d,v))}});const a=new Qn(i);return new Ew(o,a,s.fieldTransforms)}function gm(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[su(e,r,t)],l=[s];if(i.length%2!=0)throw new Z(q.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<i.length;v+=2)a.push(su(e,i[v])),l.push(i[v+1]);const c=[],d=En.empty();for(let v=a.length-1;v>=0;--v)if(!Rw(c,a[v])){const y=a[v];let C=l[v];C=Re(C);const A=o.Nu(y);if(C instanceof ku)c.push(y);else{const k=po(C,A);k!=null&&(c.push(y),d.set(y,k))}}const f=new Qn(c);return new Ew(d,f,o.fieldTransforms)}function Aw(n,e,t,r=!1){return po(t,n.Qu(r?4:3,e))}function po(n,e){if(Pw(n=Re(n)))return vm("Unsupported field value:",e,n),Sw(n,e);if(n instanceof ho)return function(r,s){if(!Tw(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=po(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Re(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return ib(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Bt.fromDate(r);return{timestampValue:Ea(s.serializer,i)}}if(r instanceof Bt){const i=new Bt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ea(s.serializer,i)}}if(r instanceof cm)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof lo)return{bytesValue:yb(s.serializer,r._byteString)};if(r instanceof en){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Mp(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof eh)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return Cp(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${Zd(r)}`)}(n,e)}function Sw(n,e){const t={};return L0(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):bi(n,(r,s)=>{const i=po(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function Pw(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Bt||n instanceof cm||n instanceof lo||n instanceof en||n instanceof ho||n instanceof eh)}function vm(n,e,t){if(!Pw(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=Zd(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function su(n,e,t){if((e=Re(e))instanceof co)return e._internalPath;if(typeof e=="string")return rh(n,e);throw gd("Field path arguments must be of type string or ",n,!1,void 0,t)}const pC=new RegExp("[~\\*/\\[\\]]");function rh(n,e,t){if(e.search(pC)>=0)throw gd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new co(...e.split("."))._internalPath}catch{throw gd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function gd(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new Z(q.INVALID_ARGUMENT,a+n+l)}function Rw(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iu{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new en(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new mC(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(sh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class mC extends iu{data(){return super.data()}}function sh(n,e){return typeof e=="string"?rh(n,e):e instanceof co?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cw(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Z(q.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ym{}class Du extends ym{}function ih(n,e,...t){let r=[];e instanceof ym&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof za).length,a=i.filter(l=>l instanceof Vu).length;if(o>1||o>0&&a>0)throw new Z(q.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Vu extends Du{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Vu(e,t,r)}_apply(e){const t=this._parse(e);return Dw(e._query,t),new Tn(e.firestore,e.converter,Nf(e._query,t))}_parse(e){const t=fo(e.firestore);return function(i,o,a,l,c,d,f){let v;if(c.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new Z(q.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){uy(f,d);const y=[];for(const C of f)y.push(ly(l,i,C));v={arrayValue:{values:y}}}else v=ly(l,i,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||uy(f,d),v=Aw(a,o,f,d==="in"||d==="not-in");return st.create(c,d,v)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function _m(n,e,t){const r=e,s=sh("where",n);return Vu._create(s,r,t)}class za extends ym{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new za(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:vt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)Dw(o,l),o=Nf(o,l)}(e._query,t),new Tn(e.firestore,e.converter,Nf(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function d3(...n){return n.forEach(e=>Vw("or",e)),za._create("or",n)}function h3(...n){return n.forEach(e=>Vw("and",e)),za._create("and",n)}class bm extends Du{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new bm(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new Z(q.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new Z(q.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new eu(i,o)}(e._query,this._field,this._direction);return new Tn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Ts(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function gC(n,e="asc"){const t=e,r=sh("orderBy",n);return bm._create(r,t)}class oh extends Du{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new oh(e,t,r)}_apply(e){return new Tn(e.firestore,e.converter,od(e._query,this._limit,this._limitType))}}function f3(n){return _w("limit",n),oh._create("limit",n,"F")}function p3(n){return _w("limitToLast",n),oh._create("limitToLast",n,"L")}class ah extends Du{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new ah(e,t,r)}_apply(e){const t=kw(e,this.type,this._docOrFields,this._inclusive);return new Tn(e.firestore,e.converter,function(s,i){return new Ts(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function m3(...n){return ah._create("startAt",n,!0)}function g3(...n){return ah._create("startAfter",n,!1)}class lh extends Du{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new lh(e,t,r)}_apply(e){const t=kw(e,this.type,this._docOrFields,this._inclusive);return new Tn(e.firestore,e.converter,function(s,i){return new Ts(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function v3(...n){return lh._create("endBefore",n,!1)}function y3(...n){return lh._create("endAt",n,!0)}function kw(n,e,t,r){if(t[0]=Re(t[0]),t[0]instanceof iu)return function(i,o,a,l,c){if(!l)throw new Z(q.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const d=[];for(const f of ia(i))if(f.field.isKeyField())d.push(to(o,l.key));else{const v=l.data.field(f.field);if($d(v))throw new Z(q.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(v===null){const y=f.field.canonicalString();throw new Z(q.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}d.push(v)}return new fi(d,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=fo(n.firestore);return function(o,a,l,c,d,f){const v=o.explicitOrderBy;if(d.length>v.length)throw new Z(q.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let C=0;C<d.length;C++){const A=d[C];if(v[C].field.isKeyField()){if(typeof A!="string")throw new Z(q.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof A}`);if(!Pp(o)&&A.indexOf("/")!==-1)throw new Z(q.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${A}' contains a slash.`);const k=o.path.child(rt.fromString(A));if(!ye.isDocumentKey(k))throw new Z(q.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${k}' is not because it contains an odd number of segments.`);const $=new ye(k);y.push(to(a,$))}else{const k=Aw(l,c,A);y.push(k)}}return new fi(y,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function ly(n,e,t){if(typeof(t=Re(t))=="string"){if(t==="")throw new Z(q.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Pp(e)&&t.indexOf("/")!==-1)throw new Z(q.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(rt.fromString(t));if(!ye.isDocumentKey(r))throw new Z(q.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return to(n,new ye(r))}if(t instanceof en)return to(n,t._key);throw new Z(q.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Zd(t)}.`)}function uy(n,e){if(!Array.isArray(n)||n.length===0)throw new Z(q.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Dw(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new Z(q.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Z(q.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Vw(n,e){if(!(e instanceof Vu||e instanceof za))throw new Z(q.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class Nw{convertValue(e,t="none"){switch(di(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ut(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ys(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ee()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return bi(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>Ut(o.doubleValue));return new eh(i)}convertGeoPoint(e){return new cm(Ut(e.latitude),Ut(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=jd(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Yl(e));default:return null}}convertTimestamp(e){const t=vs(e);return new Bt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=rt.fromString(e);Ae(Rb(r));const s=new eo(r.get(1),r.get(3)),i=new ye(r.popFirst(5));return s.isEqual(t)||Yt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uh(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class vC extends Nw{constructor(e){super(),this.firestore=e}convertBytes(e){return new lo(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new en(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _3(n){return new ru("sum",su("sum",n))}function b3(n){return new ru("avg",su("average",n))}function yC(){return new ru("count")}function w3(n,e){var t,r;return n instanceof ru&&e instanceof ru&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function I3(n,e){return bw(n.query,e.query)&&ui(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ki{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ca extends iu{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new $c(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(sh("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class $c extends Ca{data(e={}){return super.data(e)}}class ka{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Ki(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new $c(this._firestore,this._userDataWriter,r.key,r,new Ki(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Z(q.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new $c(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Ki(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new $c(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Ki(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,d=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:_C(a.type),doc:l,oldIndex:c,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function _C(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ee()}}function E3(n,e){return n instanceof Ca&&e instanceof Ca?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof ka&&e instanceof ka&&n._firestore===e._firestore&&bw(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ps(n){n=Ze(n,en);const e=Ze(n.firestore,Tt);return gw(qt(e),n._key).then(t=>wm(e,n,t))}class Ii extends Nw{constructor(e){super(),this.firestore=e}convertBytes(e){return new lo(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new en(this.firestore,null,t)}}function T3(n){n=Ze(n,en);const e=Ze(n.firestore,Tt),t=qt(e),r=new Ii(e);return J1(t,n._key).then(s=>new Ca(e,r,n._key,s,new Ki(s!==null&&s.hasLocalMutations,!0),n.converter))}function x3(n){n=Ze(n,en);const e=Ze(n.firestore,Tt);return gw(qt(e),n._key,{source:"server"}).then(t=>wm(e,n,t))}function Pt(n){n=Ze(n,Tn);const e=Ze(n.firestore,Tt),t=qt(e),r=new Ii(e);return Cw(n._query),vw(t,n._query).then(s=>new ka(e,r,n,s))}function A3(n){n=Ze(n,Tn);const e=Ze(n.firestore,Tt),t=qt(e),r=new Ii(e);return Y1(t,n._query).then(s=>new ka(e,r,n,s))}function S3(n){n=Ze(n,Tn);const e=Ze(n.firestore,Tt),t=qt(e),r=new Ii(e);return vw(t,n._query,{source:"server"}).then(s=>new ka(e,r,n,s))}function Nn(n,e,t){n=Ze(n,en);const r=Ze(n.firestore,Tt),s=uh(n.converter,e,t);return Ou(r,[nh(fo(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,jt.none())])}function Nu(n,e,t,...r){n=Ze(n,en);const s=Ze(n.firestore,Tt),i=fo(s);let o;return o=typeof(e=Re(e))=="string"||e instanceof co?gm(i,"updateDoc",n._key,e,t,r):mm(i,"updateDoc",n._key,e),Ou(s,[o.toMutation(n._key,jt.exists(!0))])}function ou(n){return Ou(Ze(n.firestore,Tt),[new Fa(n._key,jt.none())])}function ch(n,e){const t=Ze(n.firestore,Tt),r=Me(n),s=uh(n.converter,e);return Ou(t,[nh(fo(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,jt.exists(!1))]).then(()=>r)}function P3(n,...e){var t,r,s;n=Re(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Kf(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Kf(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,c,d;if(n instanceof en)c=Ze(n.firestore,Tt),d=Ma(n._key.path),l={next:f=>{e[o]&&e[o](wm(c,n,f))},error:e[o+1],complete:e[o+2]};else{const f=Ze(n,Tn);c=Ze(f.firestore,Tt),d=f._query;const v=new Ii(c);l={next:y=>{e[o]&&e[o](new ka(c,v,f,y))},error:e[o+1],complete:e[o+2]},Cw(n._query)}return function(v,y,C,A){const k=new Yd(A),$=new em(y,k,C);return v.asyncQueue.enqueueAndForget(async()=>Yp(await Ra(v),$)),()=>{k.Za(),v.asyncQueue.enqueueAndForget(async()=>Xp(await Ra(v),$))}}(qt(c),d,a,l)}function R3(n,e){return Z1(qt(n=Ze(n,Tt)),Kf(e)?e:{next:e})}function Ou(n,e){return function(r,s){const i=new yn;return r.asyncQueue.enqueueAndForget(async()=>S1(await lm(r),s,i)),i.promise}(qt(n),e)}function wm(n,e,t){const r=t.docs.get(e._key),s=new Ii(n);return new Ca(n,s,e._key,r,new Ki(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C3(n){return bC(n,{count:yC()})}function bC(n,e){const t=Ze(n.firestore,Tt),r=qt(t),s=M0(e,(i,o)=>new hb(o,i.aggregateType,i._internalFieldPath));return X1(r,n._query,s).then(i=>function(a,l,c){const d=new Ii(a);return new cC(l,d,c)}(t,n,i))}class wC{constructor(e){this.kind="memory",this._onlineComponentProvider=gi.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=mi.provider}toJSON(){return{kind:this.kind}}}class IC{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=SC(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class EC{constructor(){this.kind="memoryEager",this._offlineComponentProvider=mi.provider}toJSON(){return{kind:this.kind}}}class TC{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new q1(e)}}toJSON(){return{kind:this.kind}}}function k3(){return new EC}function D3(n){return new TC(n==null?void 0:n.cacheSizeBytes)}function V3(n){return new wC(n)}function N3(n){return new IC(n)}class xC{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=gi.provider,this._offlineComponentProvider={build:t=>new om(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class AC{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=gi.provider,this._offlineComponentProvider={build:t=>new hw(t,e==null?void 0:e.cacheSizeBytes)}}}function SC(n){return new xC(n==null?void 0:n.forceOwnership)}function O3(){return new AC}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PC={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RC{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=fo(e)}set(e,t,r){this._verifyNotCommitted();const s=Js(e,this._firestore),i=uh(s.converter,t,r),o=nh(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,jt.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=Js(e,this._firestore);let o;return o=typeof(t=Re(t))=="string"||t instanceof co?gm(this._dataReader,"WriteBatch.update",i._key,t,r,s):mm(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,jt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Js(e,this._firestore);return this._mutations=this._mutations.concat(new Fa(t._key,jt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Z(q.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Js(n,e){if((n=Re(n)).firestore!==e)throw new Z(q.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CC extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=fo(t)}get(t){const r=Js(t,this._firestore),s=new vC(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return Ee();const o=i[0];if(o.isFoundDocument())return new iu(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new iu(this._firestore,s,r._key,null,r.converter);throw Ee()})}set(t,r,s){const i=Js(t,this._firestore),o=uh(i.converter,r,s),a=nh(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=Js(t,this._firestore);let a;return a=typeof(r=Re(r))=="string"||r instanceof co?gm(this._dataReader,"Transaction.update",o._key,r,s,i):mm(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=Js(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Js(e,this._firestore),r=new Ii(this._firestore);return super.get(e).then(s=>new Ca(this._firestore,r,t._key,s._document,new Ki(!1,!1),t.converter))}}function L3(n,e,t){n=Ze(n,Tt);const r=Object.assign(Object.assign({},PC),t);return function(i){if(i.maxAttempts<1)throw new Z(q.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new yn;return i.asyncQueue.enqueueAndForget(async()=>{const c=await mw(i);new K1(i.asyncQueue,c,a,o,l).au()}),l.promise}(qt(n),s=>e(new CC(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F3(){return new ku("deleteField")}function Mu(){return new dm("serverTimestamp")}function U3(...n){return new hm("arrayUnion",n)}function $3(...n){return new fm("arrayRemove",n)}function j3(n){return new pm("increment",n)}function B3(n){return new eh(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ow(n){return qt(n=Ze(n,Tt)),new RC(n,e=>Ou(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q3(n,e){const t=qt(n=Ze(n,Tt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return cr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(c){try{return JSON.parse(c)}catch(d){throw new Z(q.INVALID_ARGUMENT,"Failed to parse JSON: "+(d==null?void 0:d.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const c=cy(l,"collectionGroup"),d=[];if(Array.isArray(l.fields))for(const f of l.fields){const v=rh("setIndexConfiguration",cy(f,"fieldPath"));f.arrayConfig==="CONTAINS"?d.push(new Ji(v,2)):f.order==="ASCENDING"?d.push(new Ji(v,0)):f.order==="DESCENDING"&&d.push(new Ji(v,1))}a.push(new va(va.UNKNOWN_ID,c,d,ya.empty()))}return a}(e);return nC(t,r)}function cy(n,e){if(typeof n[e]!="string")throw new Z(q.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kC{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function z3(n){var e;n=Ze(n,Tt);const t=dy.get(n);if(t)return t;if(((e=qt(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new kC(n);return dy.set(n,r),r}function G3(n){Mw(n,!0)}function K3(n){Mw(n,!1)}function H3(n){sC(qt(n._firestore)).then(e=>X("deleting all persistent cache indexes succeeded")).catch(e=>cr("deleting all persistent cache indexes failed",e))}function Mw(n,e){rC(qt(n._firestore),e).then(t=>X(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>cr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const dy=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W3(n){var e;const t=(e=qt(Ze(n.firestore,Tt))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:Gd(t,Ln(n._query))._t}function Q3(n,e){var t;const r=M0(e,(i,o)=>new hb(o,i.aggregateType,i._internalFieldPath)),s=(t=qt(Ze(n.firestore,Tt))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:xb(s,J0(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J3{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return Im.instance.onExistenceFilterMismatch(e)}}class Im{constructor(){this.Uu=new Map}static get instance(){return Ec||(Ec=new Im,function(t){if(ad)throw new Error("a TestingHooksSpi instance is already set");ad=t}(Ec)),Ec}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let Ec=null;(function(e,t=!0){(function(s){Oa=s})(Na),ma(new Zi("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Tt(new eP(r.getProvider("auth-internal")),new rP(r.getProvider("app-check-internal")),function(c,d){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new Z(q.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new eo(c.options.projectId,d)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),ii(ev,"4.7.3",e),ii(ev,"4.7.3","esm2017")})();function Em(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y3={PHONE:"phone",TOTP:"totp"},X3={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},Z3={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},eU={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},tU={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DC(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function Lw(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const nU=DC,VC=Lw,Fw=new _u("auth","Firebase",Lw()),rU={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vd=new wp("@firebase/auth");function NC(n,...e){vd.logLevel<=tt.WARN&&vd.warn(`Auth (${Na}): ${n}`,...e)}function jc(n,...e){vd.logLevel<=tt.ERROR&&vd.error(`Auth (${Na}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yn(n,...e){throw xm(n,...e)}function jn(n,...e){return xm(n,...e)}function Tm(n,e,t){const r=Object.assign(Object.assign({},VC()),{[e]:t});return new _u("auth","Firebase",r).create(e,{appName:n.name})}function _n(n){return Tm(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ga(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Yn(n,"argument-error"),Tm(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function xm(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Fw.create(n,...e)}function ue(n,e,...t){if(!n)throw xm(e,...t)}function Nr(n){const e="INTERNAL ASSERTION FAILED: "+n;throw jc(e),new Error(e)}function _s(n,e){n||Nr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function au(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Am(){return hy()==="http:"||hy()==="https:"}function hy(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OC(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Am()||kA()||"connection"in navigator)?navigator.onLine:!0}function MC(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lu{constructor(e,t){this.shortDelay=e,this.longDelay=t,_s(t>e,"Short delay should be less than long delay!"),this.isMobile=PA()||DA()}get(){return OC()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sm(n,e){_s(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uw{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Nr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Nr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Nr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LC={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FC=new Lu(3e4,6e4);function Nt(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Ot(n,e,t,r,s={}){return $w(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Va(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},i);return CA()||(c.referrerPolicy="no-referrer"),Uw.fetch()(jw(n,n.config.apiHost,t,a),c)})}async function $w(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},LC),e);try{const s=new $C(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Tl(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Tl(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Tl(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Tl(n,"user-disabled",o);const d=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw Tm(n,d,c);Yn(n,d)}}catch(s){if(s instanceof Es)throw s;Yn(n,"network-request-failed",{message:String(s)})}}async function Rs(n,e,t,r,s={}){const i=await Ot(n,e,t,r,s);return"mfaPendingCredential"in i&&Yn(n,"multi-factor-auth-required",{_serverResponse:i}),i}function jw(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?Sm(n.config,s):`${n.config.apiScheme}://${s}`}function UC(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class $C{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(jn(this.auth,"network-request-failed")),FC.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Tl(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=jn(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fy(n){return n!==void 0&&n.getResponse!==void 0}function py(n){return n!==void 0&&n.enterprise!==void 0}class Bw{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return UC(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jC(n){return(await Ot(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function qw(n,e){return Ot(n,"GET","/v2/recaptchaConfig",Nt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BC(n,e){return Ot(n,"POST","/v1/accounts:delete",e)}async function qC(n,e){return Ot(n,"POST","/v1/accounts:update",e)}async function zw(n,e){return Ot(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $l(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sU(n,e=!1){return Re(n).getIdToken(e)}async function zC(n,e=!1){const t=Re(n),r=await t.getIdToken(e),s=dh(r);ue(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:$l(Xh(s.auth_time)),issuedAtTime:$l(Xh(s.iat)),expirationTime:$l(Xh(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Xh(n){return Number(n)*1e3}function dh(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return jc("JWT malformed, contained fewer than 3 sections"),null;try{const s=s0(t);return s?JSON.parse(s):(jc("Failed to decode base64 JWT payload"),null)}catch(s){return jc("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function my(n){const e=dh(n);return ue(e,"internal-error"),ue(typeof e.exp<"u","internal-error"),ue(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bs(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Es&&GC(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function GC({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KC{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hf{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=$l(this.lastLoginAt),this.creationTime=$l(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lu(n){var e;const t=n.auth,r=await n.getIdToken(),s=await bs(n,zw(t,{idToken:r}));ue(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?Gw(i.providerUserInfo):[],a=WC(n.providerData,o),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),d=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Hf(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,f)}async function HC(n){const e=Re(n);await lu(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function WC(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Gw(n){return n.map(e=>{var{providerId:t}=e,r=Em(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QC(n,e){const t=await $w(n,{},async()=>{const r=Va({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=jw(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Uw.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function JC(n,e){return Ot(n,"POST","/v2/accounts:revokeToken",Nt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ue(e.idToken,"internal-error"),ue(typeof e.idToken<"u","internal-error"),ue(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):my(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ue(e.length!==0,"internal-error");const t=my(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ue(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await QC(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new aa;return r&&(ue(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(ue(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(ue(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new aa,this.toJSON())}_performRefresh(){return Nr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qs(n,e){ue(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class us{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=Em(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new KC(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Hf(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await bs(this,this.stsTokenManager.getToken(this.auth,e));return ue(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return zC(this,e)}reload(){return HC(this)}_assign(e){this!==e&&(ue(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new us(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){ue(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await lu(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Xt(this.auth.app))return Promise.reject(_n(this.auth));const e=await this.getIdToken();return await bs(this,BC(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,c,d;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,v=(s=t.email)!==null&&s!==void 0?s:void 0,y=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,C=(o=t.photoURL)!==null&&o!==void 0?o:void 0,A=(a=t.tenantId)!==null&&a!==void 0?a:void 0,k=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,$=(c=t.createdAt)!==null&&c!==void 0?c:void 0,B=(d=t.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:F,emailVerified:z,isAnonymous:ne,providerData:re,stsTokenManager:E}=t;ue(F&&E,e,"internal-error");const I=aa.fromJSON(this.name,E);ue(typeof F=="string",e,"internal-error"),qs(f,e.name),qs(v,e.name),ue(typeof z=="boolean",e,"internal-error"),ue(typeof ne=="boolean",e,"internal-error"),qs(y,e.name),qs(C,e.name),qs(A,e.name),qs(k,e.name),qs($,e.name),qs(B,e.name);const x=new us({uid:F,auth:e,email:v,emailVerified:z,displayName:f,isAnonymous:ne,photoURL:C,phoneNumber:y,tenantId:A,stsTokenManager:I,createdAt:$,lastLoginAt:B});return re&&Array.isArray(re)&&(x.providerData=re.map(P=>Object.assign({},P))),k&&(x._redirectEventId=k),x}static async _fromIdTokenResponse(e,t,r=!1){const s=new aa;s.updateFromServerResponse(t);const i=new us({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await lu(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];ue(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?Gw(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new aa;a.updateFromIdToken(r);const l=new us({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Hf(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gy=new Map;function cs(n){_s(n instanceof Function,"Expected a class definition");let e=gy.get(n);return e?(_s(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,gy.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kw{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Kw.type="NONE";const vy=Kw;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bc(n,e,t){return`firebase:${n}:${e}:${t}`}class la{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Bc(this.userKey,s.apiKey,i),this.fullPersistenceKey=Bc("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?us._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new la(cs(vy),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||cs(vy);const o=Bc(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const d=await c._get(o);if(d){const f=us._fromJSON(e,d);c!==i&&(a=f),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new la(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new la(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yy(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Jw(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Hw(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Xw(e))return"Blackberry";if(Zw(e))return"Webos";if(Ww(e))return"Safari";if((e.includes("chrome/")||Qw(e))&&!e.includes("edge/"))return"Chrome";if(Yw(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function Hw(n=cn()){return/firefox\//i.test(n)}function Ww(n=cn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Qw(n=cn()){return/crios\//i.test(n)}function Jw(n=cn()){return/iemobile/i.test(n)}function Yw(n=cn()){return/android/i.test(n)}function Xw(n=cn()){return/blackberry/i.test(n)}function Zw(n=cn()){return/webos/i.test(n)}function Pm(n=cn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function YC(n=cn()){var e;return Pm(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function XC(){return VA()&&document.documentMode===10}function eI(n=cn()){return Pm(n)||Yw(n)||Zw(n)||Xw(n)||/windows phone/i.test(n)||Jw(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tI(n,e=[]){let t;switch(n){case"Browser":t=yy(cn());break;case"Worker":t=`${yy(cn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Na}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZC{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ek(n,e={}){return Ot(n,"GET","/v2/passwordPolicy",Nt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tk=6;class nk{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:tk,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rk{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new _y(this),this.idTokenSubscription=new _y(this),this.beforeStateQueue=new ZC(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Fw,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=cs(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await la.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await zw(this,{idToken:e}),r=await us._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Xt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return ue(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await lu(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=MC()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Xt(this.app))return Promise.reject(_n(this));const t=e?Re(e):null;return t&&ue(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ue(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Xt(this.app)?Promise.reject(_n(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Xt(this.app)?Promise.reject(_n(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(cs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await ek(this),t=new nk(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new _u("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await JC(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&cs(e)||this._popupRedirectResolver;ue(t,this,"argument-error"),this.redirectPersistenceManager=await la.create(this,[cs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ue(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ue(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=tI(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&NC(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Wt(n){return Re(n)}class _y{constructor(e){this.auth=e,this.observer=null,this.addObserver=UA(t=>this.observer=t)}get next(){return ue(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Fu={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function sk(n){Fu=n}function Rm(n){return Fu.loadJS(n)}function ik(){return Fu.recaptchaV2Script}function ok(){return Fu.recaptchaEnterpriseScript}function ak(){return Fu.gapiScript}function nI(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const lk="recaptcha-enterprise",uk="NO_RECAPTCHA";class rI{constructor(e){this.type=lk,this.auth=Wt(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{qw(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new Bw(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;py(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(uk)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&py(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=ok();l.length!==0&&(l+=a),Rm(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function by(n,e,t,r=!1){const s=new rI(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function uu(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await by(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await by(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function ck(n){const e=Wt(n),t=await qw(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new Bw(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new rI(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dk(n,e){const t=bu(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(ui(i,e??{}))return s;Yn(s,"already-initialized")}return t.initialize({options:e})}function hk(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(cs);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function fk(n,e,t){const r=Wt(n);ue(r._canInitEmulator,r,"emulator-config-failed"),ue(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=sI(e),{host:o,port:a}=pk(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||mk()}function sI(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function pk(n){const e=sI(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:wy(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:wy(o)}}}function wy(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function mk(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uu{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Nr("not implemented")}_getIdTokenResponse(e){return Nr("not implemented")}_linkToIdToken(e,t){return Nr("not implemented")}_getReauthenticationResolver(e){return Nr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iI(n,e){return Ot(n,"POST","/v1/accounts:resetPassword",Nt(n,e))}async function gk(n,e){return Ot(n,"POST","/v1/accounts:update",e)}async function vk(n,e){return Ot(n,"POST","/v1/accounts:signUp",e)}async function yk(n,e){return Ot(n,"POST","/v1/accounts:update",Nt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _k(n,e){return Rs(n,"POST","/v1/accounts:signInWithPassword",Nt(n,e))}async function hh(n,e){return Ot(n,"POST","/v1/accounts:sendOobCode",Nt(n,e))}async function bk(n,e){return hh(n,e)}async function wk(n,e){return hh(n,e)}async function Ik(n,e){return hh(n,e)}async function Ek(n,e){return hh(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tk(n,e){return Rs(n,"POST","/v1/accounts:signInWithEmailLink",Nt(n,e))}async function xk(n,e){return Rs(n,"POST","/v1/accounts:signInWithEmailLink",Nt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cu extends Uu{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new cu(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new cu(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return uu(e,t,"signInWithPassword",_k);case"emailLink":return Tk(e,{email:this._email,oobCode:this._password});default:Yn(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return uu(e,r,"signUpPassword",vk);case"emailLink":return xk(e,{idToken:t,email:this._email,oobCode:this._password});default:Yn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fs(n,e){return Rs(n,"POST","/v1/accounts:signInWithIdp",Nt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ak="http://localhost";class ws extends Uu{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ws(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Yn("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=Em(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new ws(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return fs(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,fs(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,fs(e,t)}buildRequest(){const e={requestUri:Ak,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Va(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sk(n,e){return Ot(n,"POST","/v1/accounts:sendVerificationCode",Nt(n,e))}async function Pk(n,e){return Rs(n,"POST","/v1/accounts:signInWithPhoneNumber",Nt(n,e))}async function Rk(n,e){const t=await Rs(n,"POST","/v1/accounts:signInWithPhoneNumber",Nt(n,e));if(t.temporaryProof)throw Tl(n,"account-exists-with-different-credential",t);return t}const Ck={USER_NOT_FOUND:"user-not-found"};async function kk(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return Rs(n,"POST","/v1/accounts:signInWithPhoneNumber",Nt(n,t),Ck)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yi extends Uu{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Yi({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Yi({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return Pk(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return Rk(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return kk(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new Yi({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dk(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Vk(n){const e=yl(_l(n)).link,t=e?yl(_l(e)).deep_link_id:null,r=yl(_l(n)).deep_link_id;return(r?yl(_l(r)).link:null)||r||t||e||n}class $u{constructor(e){var t,r,s,i,o,a;const l=yl(_l(e)),c=(t=l.apiKey)!==null&&t!==void 0?t:null,d=(r=l.oobCode)!==null&&r!==void 0?r:null,f=Dk((s=l.mode)!==null&&s!==void 0?s:null);ue(c&&d&&f,"argument-error"),this.apiKey=c,this.operation=f,this.code=d,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=Vk(e);try{return new $u(t)}catch{return null}}}function iU(n){return $u.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mo{constructor(){this.providerId=mo.PROVIDER_ID}static credential(e,t){return cu._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=$u.parseLink(t);return ue(r,"argument-error"),cu._fromEmailAndCode(e,r.code,r.tenantId)}}mo.PROVIDER_ID="password";mo.EMAIL_PASSWORD_SIGN_IN_METHOD="password";mo.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cs{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ka extends Cs{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class qc extends Ka{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return ue("providerId"in t&&"signInMethod"in t,"argument-error"),ws._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return ue(e.idToken||e.accessToken,"argument-error"),ws._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return qc.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return qc.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new qc(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys extends Ka{constructor(){super("facebook.com")}static credential(e){return ws._fromParams({providerId:Ys.PROVIDER_ID,signInMethod:Ys.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ys.credentialFromTaggedObject(e)}static credentialFromError(e){return Ys.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ys.credential(e.oauthAccessToken)}catch{return null}}}Ys.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ys.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xs extends Ka{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ws._fromParams({providerId:Xs.PROVIDER_ID,signInMethod:Xs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Xs.credentialFromTaggedObject(e)}static credentialFromError(e){return Xs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Xs.credential(t,r)}catch{return null}}}Xs.GOOGLE_SIGN_IN_METHOD="google.com";Xs.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zs extends Ka{constructor(){super("github.com")}static credential(e){return ws._fromParams({providerId:Zs.PROVIDER_ID,signInMethod:Zs.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Zs.credentialFromTaggedObject(e)}static credentialFromError(e){return Zs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Zs.credential(e.oauthAccessToken)}catch{return null}}}Zs.GITHUB_SIGN_IN_METHOD="github.com";Zs.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nk="http://localhost";class du extends Uu{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return fs(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,fs(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,fs(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new du(r,i)}static _create(e,t){return new du(e,t)}buildRequest(){return{requestUri:Nk,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ok="saml.";class Wf extends Cs{constructor(e){ue(e.startsWith(Ok),"argument-error"),super(e)}static credentialFromResult(e){return Wf.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Wf.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=du.fromJSON(e);return ue(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return du._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ei extends Ka{constructor(){super("twitter.com")}static credential(e,t){return ws._fromParams({providerId:ei.PROVIDER_ID,signInMethod:ei.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ei.credentialFromTaggedObject(e)}static credentialFromError(e){return ei.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return ei.credential(t,r)}catch{return null}}}ei.TWITTER_SIGN_IN_METHOD="twitter.com";ei.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oI(n,e){return Rs(n,"POST","/v1/accounts:signUp",Nt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await us._fromIdTokenResponse(e,r,s),o=Iy(r);return new dr({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=Iy(r);return new dr({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function Iy(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mk(n){var e;if(Xt(n.app))return Promise.reject(_n(n));const t=Wt(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new dr({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await oI(t,{returnSecureToken:!0}),s=await dr._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yd extends Es{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,yd.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new yd(e,t,r,s)}}function aI(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?yd._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lI(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oU(n,e){const t=Re(n);await fh(!0,t,e);const{providerUserInfo:r}=await qC(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=lI(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Cm(n,e,t=!1){const r=await bs(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return dr._forOperation(n,"link",r)}async function fh(n,e,t){await lu(e);const r=lI(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";ue(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uI(n,e,t=!1){const{auth:r}=n;if(Xt(r.app))return Promise.reject(_n(r));const s="reauthenticate";try{const i=await bs(n,aI(r,s,e,n),t);ue(i.idToken,r,"internal-error");const o=dh(i.idToken);ue(o,r,"internal-error");const{sub:a}=o;return ue(n.uid===a,r,"user-mismatch"),dr._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Yn(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cI(n,e,t=!1){if(Xt(n.app))return Promise.reject(_n(n));const r="signIn",s=await aI(n,r,e),i=await dr._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function km(n,e){return cI(Wt(n),e)}async function Lk(n,e){const t=Re(n);return await fh(!1,t,e.providerId),Cm(t,e)}async function Fk(n,e){return uI(Re(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uk(n,e){return Rs(n,"POST","/v1/accounts:signInWithCustomToken",Nt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aU(n,e){if(Xt(n.app))return Promise.reject(_n(n));const t=Wt(n),r=await Uk(t,{token:e,returnSecureToken:!0}),s=await dr._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ju{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Dm._fromServerResponse(e,t):"totpInfo"in t?Vm._fromServerResponse(e,t):Yn(e,"internal-error")}}class Dm extends ju{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Dm(t)}}class Vm extends ju{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Vm(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ph(n,e,t){var r;ue(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),ue(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(ue(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(ue(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nm(n){const e=Wt(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function $k(n,e,t){const r=Wt(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&ph(r,s,t),await uu(r,s,"getOobCode",wk)}async function jk(n,e,t){await iI(Re(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Nm(n),r})}async function lU(n,e){await yk(Re(n),{oobCode:e})}async function Bk(n,e){const t=Re(n),r=await iI(t,{oobCode:e}),s=r.requestType;switch(ue(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":ue(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":ue(r.mfaInfo,t,"internal-error");default:ue(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=ju._fromServerResponse(Wt(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function uU(n,e){const{data:t}=await Bk(Re(n),e);return t.email}async function qk(n,e,t){if(Xt(n.app))return Promise.reject(_n(n));const r=Wt(n),o=await uu(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",oI).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Nm(n),l}),a=await dr._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function zk(n,e,t){return Xt(n.app)?Promise.reject(_n(n)):km(Re(n),mo.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Nm(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cU(n,e,t){const r=Wt(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){ue(a.handleCodeInApp,r,"argument-error"),a&&ph(r,o,a)}i(s,t),await uu(r,s,"getOobCode",Ik)}function dU(n,e){const t=$u.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function hU(n,e,t){if(Xt(n.app))return Promise.reject(_n(n));const r=Re(n),s=mo.credentialWithLink(e,t||au());return ue(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),km(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gk(n,e){return Ot(n,"POST","/v1/accounts:createAuthUri",Nt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fU(n,e){const t=Am()?au():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await Gk(Re(n),r);return s||[]}async function pU(n,e){const t=Re(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&ph(t.auth,s,e);const{email:i}=await bk(t.auth,s);i!==n.email&&await n.reload()}async function mU(n,e,t){const r=Re(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&ph(r.auth,i,t);const{email:o}=await Ek(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kk(n,e){return Ot(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gU(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=Re(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await bs(r,Kk(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function vU(n,e){const t=Re(n);return Xt(t.auth.app)?Promise.reject(_n(t.auth)):dI(t,e,null)}function Hk(n,e){return dI(Re(n),null,e)}async function dI(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await bs(n,gk(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wk(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=dh(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new ua(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new Qk(i,s);case"github.com":return new Jk(i,s);case"google.com":return new Yk(i,s);case"twitter.com":return new Xk(i,s,n.screenName||null);case"custom":case"anonymous":return new ua(i,null);default:return new ua(i,r,s)}}class ua{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class hI extends ua{constructor(e,t,r,s){super(e,t,r),this.username=s}}class Qk extends ua{constructor(e,t){super(e,"facebook.com",t)}}class Jk extends hI{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class Yk extends ua{constructor(e,t){super(e,"google.com",t)}}class Xk extends hI{constructor(e,t,r){super(e,"twitter.com",t,r)}}function yU(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:Wk(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _U(n,e){return Re(n).setPersistence(e)}function bU(n){return ck(n)}async function wU(n,e){return Wt(n).validatePassword(e)}function Zk(n,e,t,r){return Re(n).onIdTokenChanged(e,t,r)}function eD(n,e,t){return Re(n).beforeAuthStateChanged(e,t)}function IU(n,e,t,r){return Re(n).onAuthStateChanged(e,t,r)}function EU(n){Re(n).useDeviceLanguage()}function TU(n,e){return Re(n).updateCurrentUser(e)}function xU(n){return Re(n).signOut()}function AU(n,e){return Wt(n).revokeAccessToken(e)}async function SU(n){return Re(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hi{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new Hi("enroll",e,t)}static _fromMfaPendingCredential(e){return new Hi("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return Hi._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return Hi._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Om{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=Wt(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>ju._fromServerResponse(r,a));ue(s.mfaPendingCredential,r,"internal-error");const o=Hi._fromMfaPendingCredential(s.mfaPendingCredential);return new Om(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const c=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const d=await dr._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(d.user),d;case"reauthenticate":return ue(t.user,r,"internal-error"),dr._forOperation(t.user,t.operationType,c);default:Yn(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function PU(n,e){var t;const r=Re(n),s=e;return ue(e.customData.operationType,r,"argument-error"),ue((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),Om._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tD(n,e){return Ot(n,"POST","/v2/accounts/mfaEnrollment:start",Nt(n,e))}function nD(n,e){return Ot(n,"POST","/v2/accounts/mfaEnrollment:finalize",Nt(n,e))}function rD(n,e){return Ot(n,"POST","/v2/accounts/mfaEnrollment:start",Nt(n,e))}function sD(n,e){return Ot(n,"POST","/v2/accounts/mfaEnrollment:finalize",Nt(n,e))}function iD(n,e){return Ot(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Nt(n,e))}class Mm{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>ju._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new Mm(e)}async getSession(){return Hi._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await bs(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await bs(this.user,iD(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const Zh=new WeakMap;function RU(n){const e=Re(n);return Zh.has(e)||Zh.set(e,Mm._fromUser(e)),Zh.get(e)}const _d="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fI{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(_d,"1"),this.storage.removeItem(_d),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oD=1e3,aD=10;class pI extends fI{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=eI(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);XC()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,aD):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},oD)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}pI.type="LOCAL";const lD=pI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mI extends fI{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}mI.type="SESSION";const gI=mI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uD(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new mh(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await uD(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}mh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gh(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cD{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=gh("",20);s.port1.start();const d=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const v=f;if(v.data.eventId===c)switch(v.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(v.data.response);break;default:clearTimeout(d),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rn(){return window}function dD(n){rn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lm(){return typeof rn().WorkerGlobalScope<"u"&&typeof rn().importScripts=="function"}async function hD(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function fD(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function pD(){return Lm()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vI="firebaseLocalStorageDb",mD=1,bd="firebaseLocalStorage",yI="fbase_key";class Bu{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function vh(n,e){return n.transaction([bd],e?"readwrite":"readonly").objectStore(bd)}function gD(){const n=indexedDB.deleteDatabase(vI);return new Bu(n).toPromise()}function Qf(){const n=indexedDB.open(vI,mD);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(bd,{keyPath:yI})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(bd)?e(r):(r.close(),await gD(),e(await Qf()))})})}async function Ey(n,e,t){const r=vh(n,!0).put({[yI]:e,value:t});return new Bu(r).toPromise()}async function vD(n,e){const t=vh(n,!1).get(e),r=await new Bu(t).toPromise();return r===void 0?null:r.value}function Ty(n,e){const t=vh(n,!0).delete(e);return new Bu(t).toPromise()}const yD=800,_D=3;class _I{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Qf(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>_D)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Lm()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=mh._getInstance(pD()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await hD(),!this.activeServiceWorker)return;this.sender=new cD(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||fD()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Qf();return await Ey(e,_d,"1"),await Ty(e,_d),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Ey(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>vD(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Ty(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=vh(s,!1).getAll();return new Bu(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),yD)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}_I.type="LOCAL";const bD=_I;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wD(n,e){return Ot(n,"POST","/v2/accounts/mfaSignIn:start",Nt(n,e))}function ID(n,e){return Ot(n,"POST","/v2/accounts/mfaSignIn:finalize",Nt(n,e))}function ED(n,e){return Ot(n,"POST","/v2/accounts/mfaSignIn:finalize",Nt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TD=500,xD=6e4,Tc=1e12;class AD{constructor(e){this.auth=e,this.counter=Tc,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new SD(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Tc;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Tc;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Tc;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class SD{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;ue(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=PD(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},xD)},TD))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function PD(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ef=nI("rcb"),RD=new Lu(3e4,6e4);class CD{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=rn().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return ue(kD(t),e,"argument-error"),this.shouldResolveImmediately(t)&&fy(rn().grecaptcha)?Promise.resolve(rn().grecaptcha):new Promise((r,s)=>{const i=rn().setTimeout(()=>{s(jn(e,"network-request-failed"))},RD.get());rn()[ef]=()=>{rn().clearTimeout(i),delete rn()[ef];const a=rn().grecaptcha;if(!a||!fy(a)){s(jn(e,"internal-error"));return}const l=a.render;a.render=(c,d)=>{const f=l(c,d);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${ik()}?${Va({onload:ef,render:"explicit",hl:t})}`;Rm(o).catch(()=>{clearTimeout(i),s(jn(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=rn().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function kD(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class DD{async load(e){return new AD(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bI="recaptcha",VD={theme:"light",type:"image"};class CU{constructor(e,t,r=Object.assign({},VD)){this.parameters=r,this.type=bI,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Wt(e),this.isInvisible=this.parameters.size==="invisible",ue(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;ue(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new DD:new CD,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){ue(!this.parameters.sitekey,this.auth,"argument-error"),ue(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),ue(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=rn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){ue(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){ue(Am()&&!Lm(),this.auth,"internal-error"),await ND(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await jC(this.auth);ue(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return ue(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function ND(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fm{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Yi._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function kU(n,e,t){if(Xt(n.app))return Promise.reject(_n(n));const r=Wt(n),s=await yh(r,e,Re(t));return new Fm(s,i=>km(r,i))}async function DU(n,e,t){const r=Re(n);await fh(!1,r,"phone");const s=await yh(r.auth,e,Re(t));return new Fm(s,i=>Lk(r,i))}async function VU(n,e,t){const r=Re(n);if(Xt(r.auth.app))return Promise.reject(_n(r.auth));const s=await yh(r.auth,e,Re(t));return new Fm(s,i=>Fk(r,i))}async function yh(n,e,t){var r;const s=await t.verify();try{ue(typeof s=="string",n,"argument-error"),ue(t.type===bI,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return ue(o.type==="enroll",n,"internal-error"),(await tD(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{ue(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return ue(a,n,"missing-multi-factor-info"),(await wD(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await Sk(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function NU(n,e){const t=Re(n);if(Xt(t.auth.app))return Promise.reject(_n(t.auth));await Cm(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ca{constructor(e){this.providerId=ca.PROVIDER_ID,this.auth=Wt(e)}verifyPhoneNumber(e,t){return yh(this.auth,e,Re(t))}static credential(e,t){return Yi._fromVerification(e,t)}static credentialFromResult(e){const t=e;return ca.credentialFromTaggedObject(t)}static credentialFromError(e){return ca.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Yi._fromTokenResponse(t,r):null}}ca.PROVIDER_ID="phone";ca.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function go(n,e){return e?cs(e):(ue(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Um extends Uu{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return fs(e,this._buildIdpRequest())}_linkToIdToken(e,t){return fs(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return fs(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function OD(n){return cI(n.auth,new Um(n),n.bypassAuthState)}function MD(n){const{auth:e,user:t}=n;return ue(t,e,"internal-error"),uI(t,new Um(n),n.bypassAuthState)}async function LD(n){const{auth:e,user:t}=n;return ue(t,e,"internal-error"),Cm(t,new Um(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wI{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return OD;case"linkViaPopup":case"linkViaRedirect":return LD;case"reauthViaPopup":case"reauthViaRedirect":return MD;default:Yn(this.auth,"internal-error")}}resolve(e){_s(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){_s(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FD=new Lu(2e3,1e4);async function OU(n,e,t){if(Xt(n.app))return Promise.reject(jn(n,"operation-not-supported-in-this-environment"));const r=Wt(n);Ga(n,e,Cs);const s=go(r,t);return new ds(r,"signInViaPopup",e,s).executeNotNull()}async function MU(n,e,t){const r=Re(n);if(Xt(r.auth.app))return Promise.reject(jn(r.auth,"operation-not-supported-in-this-environment"));Ga(r.auth,e,Cs);const s=go(r.auth,t);return new ds(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function LU(n,e,t){const r=Re(n);Ga(r.auth,e,Cs);const s=go(r.auth,t);return new ds(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class ds extends wI{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,ds.currentPopupAction&&ds.currentPopupAction.cancel(),ds.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ue(e,this.auth,"internal-error"),e}async onExecution(){_s(this.filter.length===1,"Popup operations only handle one event");const e=gh();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(jn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(jn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ds.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(jn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,FD.get())};e()}}ds.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UD="pendingRedirect",zc=new Map;class $D extends wI{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=zc.get(this.auth._key());if(!e){try{const r=await jD(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}zc.set(this.auth._key(),e)}return this.bypassAuthState||zc.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function jD(n,e){const t=EI(e),r=II(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function $m(n,e){return II(n)._set(EI(e),"true")}function BD(n,e){zc.set(n._key(),e)}function II(n){return cs(n._redirectPersistence)}function EI(n){return Bc(UD,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FU(n,e,t){return qD(n,e,t)}async function qD(n,e,t){if(Xt(n.app))return Promise.reject(_n(n));const r=Wt(n);Ga(n,e,Cs),await r._initializationPromise;const s=go(r,t);return await $m(s,r),s._openRedirect(r,e,"signInViaRedirect")}function UU(n,e,t){return zD(n,e,t)}async function zD(n,e,t){const r=Re(n);if(Ga(r.auth,e,Cs),Xt(r.auth.app))return Promise.reject(_n(r.auth));await r.auth._initializationPromise;const s=go(r.auth,t);await $m(s,r.auth);const i=await xI(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function $U(n,e,t){return GD(n,e,t)}async function GD(n,e,t){const r=Re(n);Ga(r.auth,e,Cs),await r.auth._initializationPromise;const s=go(r.auth,t);await fh(!1,r,e.providerId),await $m(s,r.auth);const i=await xI(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function jU(n,e){return await Wt(n)._initializationPromise,TI(n,e,!1)}async function TI(n,e,t=!1){if(Xt(n.app))return Promise.reject(_n(n));const r=Wt(n),s=go(r,e),o=await new $D(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function xI(n){const e=gh(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KD=10*60*1e3;class HD{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!WD(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!AI(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(jn(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=KD&&this.cachedEventUids.clear(),this.cachedEventUids.has(xy(e))}saveEventToCache(e){this.cachedEventUids.add(xy(e)),this.lastProcessedEventTime=Date.now()}}function xy(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function AI({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function WD(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return AI(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QD(n,e={}){return Ot(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JD=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,YD=/^https?/;async function XD(n){if(n.config.emulator)return;const{authorizedDomains:e}=await QD(n);for(const t of e)try{if(ZD(t))return}catch{}Yn(n,"unauthorized-domain")}function ZD(n){const e=au(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!YD.test(t))return!1;if(JD.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eV=new Lu(3e4,6e4);function Ay(){const n=rn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function tV(n){return new Promise((e,t)=>{var r,s,i;function o(){Ay(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Ay(),t(jn(n,"network-request-failed"))},timeout:eV.get()})}if(!((s=(r=rn().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=rn().gapi)===null||i===void 0)&&i.load)o();else{const a=nI("iframefcb");return rn()[a]=()=>{gapi.load?o():t(jn(n,"network-request-failed"))},Rm(`${ak()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw Gc=null,e})}let Gc=null;function nV(n){return Gc=Gc||tV(n),Gc}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rV=new Lu(5e3,15e3),sV="__/auth/iframe",iV="emulator/auth/iframe",oV={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},aV=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function lV(n){const e=n.config;ue(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Sm(e,iV):`https://${n.config.authDomain}/${sV}`,r={apiKey:e.apiKey,appName:n.name,v:Na},s=aV.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Va(r).slice(1)}`}async function uV(n){const e=await nV(n),t=rn().gapi;return ue(t,n,"internal-error"),e.open({where:document.body,url:lV(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:oV,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=jn(n,"network-request-failed"),a=rn().setTimeout(()=>{i(o)},rV.get());function l(){rn().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cV={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},dV=500,hV=600,fV="_blank",pV="http://localhost";class Sy{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function mV(n,e,t,r=dV,s=hV){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},cV),{width:r.toString(),height:s.toString(),top:i,left:o}),c=cn().toLowerCase();t&&(a=Qw(c)?fV:t),Hw(c)&&(e=e||pV,l.scrollbars="yes");const d=Object.entries(l).reduce((v,[y,C])=>`${v}${y}=${C},`,"");if(YC(c)&&a!=="_self")return gV(e||"",a),new Sy(null);const f=window.open(e||"",a,d);ue(f,n,"popup-blocked");try{f.focus()}catch{}return new Sy(f)}function gV(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vV="__/auth/handler",yV="emulator/auth/handler",_V=encodeURIComponent("fac");async function Py(n,e,t,r,s,i){ue(n.config.authDomain,n,"auth-domain-config-required"),ue(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Na,eventId:s};if(e instanceof Cs){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",FA(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,f]of Object.entries(i||{}))o[d]=f}if(e instanceof Ka){const d=e.getScopes().filter(f=>f!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const l=await n._getAppCheckToken(),c=l?`#${_V}=${encodeURIComponent(l)}`:"";return`${bV(n)}?${Va(a).slice(1)}${c}`}function bV({config:n}){return n.emulator?Sm(n,yV):`https://${n.authDomain}/${vV}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tf="webStorageSupport";class wV{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=gI,this._completeRedirectFn=TI,this._overrideRedirectResult=BD}async _openPopup(e,t,r,s){var i;_s((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await Py(e,t,r,au(),s);return mV(e,o,gh())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await Py(e,t,r,au(),s);return dD(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(_s(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await uV(e),r=new HD(e);return t.register("authEvent",s=>(ue(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(tf,{type:tf},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[tf];o!==void 0&&t(!!o),Yn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=XD(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return eI()||Ww()||Pm()}}const IV=wV;class SI{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Nr("unexpected MultiFactorSessionType")}}}class jm extends SI{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new jm(e)}_finalizeEnroll(e,t,r){return nD(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return ID(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class EV{constructor(){}static assertion(e){return jm._fromCredential(e)}}EV.FACTOR_ID="phone";class TV{static assertionForEnrollment(e,t){return hu._fromSecret(e,t)}static assertionForSignIn(e,t){return hu._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;ue(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await rD(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return Bm._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}TV.FACTOR_ID="totp";class hu extends SI{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new hu(t,void 0,e)}static _fromEnrollmentId(e,t){return new hu(t,e)}async _finalizeEnroll(e,t,r){return ue(typeof this.secret<"u",e,"argument-error"),sD(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){ue(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return ED(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class Bm{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new Bm(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(xc(e)||xc(t))&&(s=!0),s&&(xc(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),xc(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function xc(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var Ry="@firebase/auth",Cy="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xV{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ue(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AV(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function SV(n){ma(new Zi("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;ue(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:tI(n)},c=new rk(r,s,i,l);return hk(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),ma(new Zi("auth-internal",e=>{const t=Wt(e.getProvider("auth").getImmediate());return(r=>new xV(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ii(Ry,Cy,AV(n)),ii(Ry,Cy,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PV=5*60,RV=a0("authIdTokenMaxAge")||PV;let ky=null;const CV=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>RV)return;const s=t==null?void 0:t.token;ky!==s&&(ky=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function kV(n=f0()){const e=bu(n,"auth");if(e.isInitialized())return e.getImmediate();const t=dk(n,{popupRedirectResolver:IV,persistence:[bD,lD,gI]}),r=a0("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=CV(i.toString());eD(t,o,()=>o(t.currentUser)),Zk(t,a=>o(a))}}const s=i0("auth");return s&&fk(t,`http://${s}`),t}function DV(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}sk({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=jn("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",DV().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});SV("Browser");const VV={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},PI=h0(VV),ve=lC(PI),vo=kV(PI);try{uC(ve)}catch{}Mk(vo);async function NV(n,e){try{return(await qk(vo,n,e)).user}catch(t){throw t}}async function OV(n,e){try{return(await zk(vo,n,e)).user}catch(t){throw t}}async function MV(n){try{await $k(vo,n)}catch(e){throw e}}async function LV(n){try{const e=vo.currentUser;if(e)await Hk(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const oi=Object.freeze(Object.defineProperty({__proto__:null,auth:vo,createPlayerAccount:NV,db:ve,resetPlayerPassword:MV,signInPlayer:OV,updatePlayerPassword:LV},Symbol.toStringTag,{value:"Module"})),Ha="seasons";async function FV(n,e,t){return await ch(Xe(ve,Ha),{name:n,slug:e,pinCode:t,createdAt:Mu()})}async function UV(n){return await ou(Me(ve,Ha,n))}async function nf(){const n=ih(Xe(ve,Ha),gC("createdAt","desc"));return(await Pt(n)).docs.map(t=>({id:t.id,...t.data()}))}async function wd(n,e){const t=await Ps(Me(ve,Ha,n));return t.exists()?t.data().pinCode===e:!1}async function Jf(n){const e=await Ps(Me(ve,Ha,n));return e.exists()?e.data().pinCode:null}async function gl(n,e){const t=Me(ve,Ha,n);await Nu(t,{sortOrder:e})}const rf=10*60*1e3,sf="impro_selector_pin_session";class $V{constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(sf);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<rf)return t;this.clearSession()}}catch{console.error("Erreur lors du chargement de la session PIN")}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(sf,JSON.stringify(r)),this.sessionData=r}catch{console.error("Erreur lors de la sauvegarde de la session PIN")}}isPinCached(e){return this.sessionData?this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<rf:!1}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(sf),this.sessionData=null}catch{console.error("Erreur lors de la suppression de la session PIN")}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=rf-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const Kn=new $V,jV={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},BV={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},qV={class:"text-center mb-6"},zV={class:"text-gray-300"},GV={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},KV={class:"text-sm text-green-400"},HV={class:"mb-6"},WV={class:"mb-4"},QV={key:0,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},JV={class:"flex justify-end space-x-3"},YV=["disabled"],RI={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=O(""),i=O(""),o=O(null);sn(()=>t.show,d=>{d&&(s.value="",i.value="",un(()=>{var f;(f=o.value)==null||f.focus()}))});function a(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function l(){s.value.length===4&&r("submit",s.value)}function c(){r("cancel")}return(d,f)=>n.show?(U(),j("div",jV,[p("div",BV,[p("div",qV,[f[1]||(f[1]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"🔒")],-1)),f[2]||(f[2]=p("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),p("p",zV,le(n.message),1),n.sessionInfo?(U(),j("div",GV,[p("p",KV," Session active : "+le(n.sessionInfo.timeRemaining)+" min restantes ",1)])):ae("",!0)]),p("div",HV,[p("div",WV,[f[3]||(f[3]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),gt(p("input",{"onUpdate:modelValue":f[0]||(f[0]=v=>s.value=v),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:a,onKeydown:[Cn(l,["enter"]),Cn(c,["escape"])],ref_key:"pinInput",ref:o},null,544),[[Ft,s.value]])]),f[4]||(f[4]=p("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))]),i.value||t.error?(U(),j("div",QV,le(i.value||t.error),1)):ae("",!0),p("div",JV,[p("button",{onClick:c,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:l,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,YV)])])])):ae("",!0)}},XV={class:"relative p-6 pb-4 border-b border-white/10"},ZV={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},CI={__name:"AppHelpModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(U(),j("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[95] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=Kt(()=>{},["stop"]))},[p("div",XV,[p("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=p("div",{class:"flex items-center gap-3"},[p("div",{class:"w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-2xl"},"🎭"),p("div",null,[p("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Bienvenue dans Impro Pick"),p("p",{class:"text-sm text-purple-300"},"L'appli impro pour organiser saisons, événements et sélections")])],-1))]),s[5]||(s[5]=yr('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">À quoi ça sert ?</h3><p> Impro Pick vous aide à gérer vos spectacles d&#39;impro : saisons, événements, joueurs, disponibilités, tirage au sort équitable et annonces. Fini les prises de tête : indiquez qui est dispo, et laissez le hasard pondéré faire le reste. </p></div><div class="space-y-3"><h3 class="text-white font-semibold">Fonctionnalités principales</h3><ul class="list-disc list-inside space-y-2 text-gray-300"><li><span class="text-white">Saisons</span> : regroupez vos événements par saison pour garder un historique clair.</li><li><span class="text-white">Événements</span> : créez des dates avec un titre et un nombre de joueurs à sélectionner; archivez-les quand ils sont passés.</li><li><span class="text-white">Joueurs</span> : gérez la liste des joueurs et leurs informations.</li><li><span class="text-white">Indication de disponibilité</span> : Oui/Non/Peut‑être via liens magiques ou directement dans la grille.</li><li><span class="text-white">Sélection automatique</span> : tirage au sort pondéré qui favorise l&#39;équité sur la durée.</li><li><span class="text-white">Protection des saisies</span> : PIN de saison pour sécuriser les actions sensibles, mot de passe possible pour certains joueurs.</li><li><span class="text-white">Notifications</span> : annoncez un événement (email/lien) pour collecter facilement les disponibilités.</li></ul></div><div class="space-y-2 text-sm text-gray-300"><h3 class="text-white font-semibold">Astuces</h3><ul class="list-disc list-inside space-y-1"><li>Sur mobile, faites glisser horizontalement pour parcourir les événements.</li><li>Le bouton ⚠️ dans les en-têtes signale qu&#39;un événement est prêt pour une sélection ou nécessite votre attention.</li></ul></div></div>',1)),p("div",ZV,[p("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ae("",!0)}},eN=["pin","pinCode","password","motdepasse","mdp","token","oobCode","apiKey","apikey","key","secret","authorization","auth","bearer"];function tN(){var t,r,s,i;const n=((r=(t=import.meta)==null?void 0:t.env)==null?void 0:r.MODE)==="development"?"debug":"warn";return((i=(s=import.meta)==null?void 0:s.env)==null?void 0:i.VITE_LOG_LEVEL)||n}function kI(n){switch(n){case"debug":return 10;case"info":return 20;case"warn":return 30;case"error":return 40;case"silent":return 100;default:return 30}}function nN(n){return typeof n!="string"?n:n.length<=2?"••":n.length>=8?`${n.slice(0,2)}••••${n.slice(-2)}`:"••••"}function DI(n){if(!n)return!1;const e=String(n).toLowerCase();return eN.some(t=>e.includes(t.toLowerCase()))}function Yf(n){if(n==null)return n;if(typeof n=="string"){if(n.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){const[r,s]=n.split("@"),i=r.length<=2?"••":`${r.slice(0,2)}••`,o=s.split("."),a=o[0].length<=2?"••":`${o[0].slice(0,2)}••`;return`${i}@${a}.${o.slice(1).join(".")}`}return n.length>=12&&!/\s/.test(n)?nN(n):n}if(typeof n=="number"){const e=String(n);return/^\d{4,6}$/.test(e)?"••••":n}if(Array.isArray(n))return n.map(e=>Yf(e));if(typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=DI(t)?"••••":Yf(r);return e}return n}function rN(n){const e=[];for(let t=0;t<n.length;t+=1){const r=n[t],s=t>0?n[t-1]:null;if(typeof s=="string"&&DI(s)&&(typeof r=="string"||typeof r=="number")){e.push("••••");continue}e.push(Yf(r))}return e}const sN=kI(tN());function Ac(n,e){const t=kI(n);return(...r)=>{if(t<sN)return;const s=rN(r);console[e](...s)}}const ce={debug:Ac("debug","log"),info:Ac("info","info"),warn:Ac("warn","warn"),error:Ac("error","error")},iN={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},oN={class:"text-center py-16 px-4 relative"},aN=["aria-busy"],lN={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto animate-pulse"},uN={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto"},cN=["onClick"],dN={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},hN={class:"absolute top-4 right-4"},fN=["onClick","aria-expanded"],pN={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},mN=["onClick"],gN=["onClick"],vN=["onClick"],yN={key:2,class:"flex justify-center mt-12"},_N={key:3,class:"text-center py-16"},bN={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},wN={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},IN={class:"mb-6"},EN={class:"mb-6"},TN={class:"mb-6"},xN={class:"flex justify-end space-x-3"},AN=["disabled"],SN={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},PN={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},RN={class:"text-center mb-6"},CN={class:"text-gray-300"},kN={__name:"Home",setup(n){const e=O([]),t=O(!0),r=vu(),s=O(null),i=O(!1),o=O(!1),a=O(""),l=O(""),c=O(""),d=O(null),f=O(!1),v=O(null),y=O(""),C=O(!1);kr(async()=>{var ke;try{e.value=await nf(),ce.info("Saisons chargées",{count:((ke=e.value)==null?void 0:ke.length)||0}),F().catch(ee=>ce.error("Migration sortOrder échouée",ee))}finally{t.value=!1}});const A=nt(()=>[...e.value].sort((ke,ee)=>{var hn,wt;const De=typeof ke.sortOrder=="number"?ke.sortOrder:Number.MAX_SAFE_INTEGER,we=typeof ee.sortOrder=="number"?ee.sortOrder:Number.MAX_SAFE_INTEGER;if(De!==we)return De-we;const Fe=(hn=ke.createdAt)!=null&&hn.toMillis?ke.createdAt.toMillis():0,ct=(wt=ee.createdAt)!=null&&wt.toMillis?ee.createdAt.toMillis():0;return Fe!==ct?ct-Fe:(ke.name||"").localeCompare(ee.name||"")}));function k(ke){r.push(`/season/${ke}`)}function $(ke){s.value=s.value===ke?null:ke}function B(){s.value=null}async function F(){if(!e.value.length)return;const ke=e.value.map(De=>typeof De.sortOrder=="number"?De.sortOrder:null).filter(De=>De!==null);let ee=ke.length?Math.max(...ke):0;for(const De of e.value)if(typeof De.sortOrder!="number"){ee+=1;try{await gl(De.id,ee),De.sortOrder=ee}catch(we){ce.error("Erreur migration sortOrder",{seasonName:De==null?void 0:De.name,error:we})}}}async function z(ke){if(B(),ke<=0)return;const ee=[...A.value],De=ee[ke],we=ee[ke-1],Fe=De.sortOrder;De.sortOrder=we.sortOrder,we.sortOrder=Fe;try{await Promise.all([gl(De.id,De.sortOrder),gl(we.id,we.sortOrder)])}catch(ct){ce.error("Erreur lors du déplacement vers le haut",ct)}}async function ne(ke){B();const ee=[...A.value];if(ke>=ee.length-1)return;const De=ee[ke],we=ee[ke+1],Fe=De.sortOrder;De.sortOrder=we.sortOrder,we.sortOrder=Fe;try{await Promise.all([gl(De.id,De.sortOrder),gl(we.id,we.sortOrder)])}catch(ct){ce.error("Erreur lors du déplacement vers le bas",ct)}}function re(){a.value&&(l.value=a.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function E(){c.value=c.value.replace(/[^0-9]/g,""),c.value.length>4&&(c.value=c.value.slice(0,4))}async function I(){if(!a.value.trim()||!l.value.trim()||!c.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(c.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await FV(a.value.trim(),l.value.trim(),c.value.trim()),e.value=await nf(),await F(),x()}catch(ke){ce.error("Erreur lors de la création de la saison",ke),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function x(){i.value=!1,a.value="",l.value="",c.value=""}function P(ke){d.value=ke,o.value=!0}async function R(){o.value=!1,await ze({type:"deleteSeason",data:{seasonId:d.value.id,seasonName:d.value.name}})}function V(){o.value=!1,d.value=null}function w(){return v.value?{deleteSeason:"Suppression de saison - Code PIN requis"}[v.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function ze(ke){if(Kn.isPinCached(d.value.id)){const ee=Kn.getCachedPin(d.value.id);if(ce.debug("PIN en cache trouvé, utilisation automatique"),await wd(d.value.id,ee)){await je(ke);return}else Kn.clearSession()}v.value=ke,f.value=!0}async function Le(ke){var ee,De,we,Fe;ce.debug("PIN soumis pour l'opération",{operationType:(ee=v.value)==null?void 0:ee.type});try{const ct=((we=(De=v.value)==null?void 0:De.data)==null?void 0:we.seasonId)||((Fe=d.value)==null?void 0:Fe.id),hn=await wd(ct,ke);if(ce.debug("PIN validé",{valid:hn}),hn){Kn.saveSession(ct,ke),ce.debug("PIN correct, fermeture de la modal et exécution de l'opération"),f.value=!1;const wt=v.value;v.value=null,ce.debug("Appel de executePendingOperation",{operationType:wt==null?void 0:wt.type}),await je(wt)}else y.value="Code PIN incorrect",setTimeout(()=>{y.value=""},3e3)}catch(ct){ce.error("Erreur lors de la vérification du PIN",ct),y.value="Erreur lors de la vérification du code PIN"}}function it(){f.value=!1,v.value=null,y.value=""}function Ge(){return d.value&&Kn.isPinCached(d.value.id)?{timeRemaining:Kn.getTimeRemaining(),isExpiringSoon:Kn.isExpiringSoon()}:null}async function je(ke){var we;if(ce.debug("executePendingOperation appelé",{hasOperation:!!ke}),!ke){ce.warn("Aucune opération à exécuter");return}const{type:ee,data:De}=ke;ce.info("Exécution de l'opération",{type:ee});try{switch(ee){case"deleteSeason":ce.info("Suppression de la saison",{seasonId:De.seasonId}),await UV(De.seasonId),ce.info("Saison supprimée, rechargement de la liste"),e.value=await nf(),ce.info("Liste des saisons rechargée",{count:((we=e.value)==null?void 0:we.length)||0});break;default:ce.warn("Type d'opération non reconnu",{type:ee})}}catch(Fe){ce.error("Erreur lors de l'exécution de l'opération",Fe),alert("Erreur lors de l'opération. Veuillez réessayer.")}}return(ke,ee)=>{var De;return U(),j("div",iN,[p("div",oN,[p("button",{onClick:ee[0]||(ee[0]=we=>C.value=!0),class:"absolute right-4 top-4 text-white/90 hover:text-white p-2 rounded-full hover:bg-white/10",title:"Comment ça marche ?","aria-label":"Comment ça marche ?"},ee[8]||(ee[8]=[p("span",{class:"text-2xl"},"❓",-1)])),ee[9]||(ee[9]=p("h1",{class:"text-6xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent animate-pulse"}," Impro Pick ",-1)),ee[10]||(ee[10]=p("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto leading-relaxed"},"Arrêtez de vous prendre la tête pour savoir qui doit jouer, laissez le hasard choisir pour vous !",-1))]),p("div",{class:"container mx-auto px-4 pb-16","aria-busy":t.value},[t.value?(U(),j("div",lN,[(U(),j(St,null,_r(8,we=>p("div",{key:"skeleton-"+we,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8"},ee[11]||(ee[11]=[p("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),p("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),p("div",{class:"h-px bg-white/10 mb-4"},null,-1),p("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(U(),j("div",uN,[(U(!0),j(St,null,_r(A.value,(we,Fe)=>(U(),j("div",{key:we.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20"},[p("div",{onClick:ct=>k(we.slug),class:"text-center cursor-pointer"},[ee[12]||(ee[12]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg"},[p("span",{class:"text-2xl"},"🎭")],-1)),p("h2",dN,le(we.name),1),ee[13]||(ee[13]=p("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),ee[14]||(ee[14]=p("p",{class:"text-gray-300 text-sm"}," Cliquez pour accéder ",-1))],8,cN),p("div",hN,[p("div",{class:"relative",onClick:ee[1]||(ee[1]=Kt(()=>{},["stop"]))},[p("button",{onClick:ct=>$(Fe),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===Fe,"aria-haspopup":"true",title:"Options"},ee[15]||(ee[15]=[p("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,fN),s.value===Fe?(U(),j("div",pN,[p("button",{onClick:ct=>z(Fe),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Monter ",8,mN),p("button",{onClick:ct=>ne(Fe),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Descendre ",8,gN),ee[16]||(ee[16]=p("div",{class:"border-t border-white/10 my-1"},null,-1)),p("button",{onClick:ct=>P(we),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10",role:"menuitem"}," Supprimer ",8,vN)])):ae("",!0)])])]))),128))])):ae("",!0),!t.value&&e.value.length>0?(U(),j("div",yN,[p("button",{onClick:ee[2]||(ee[2]=we=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105"}," ✨ Nouvelle saison ")])):ae("",!0),!t.value&&e.value.length===0?(U(),j("div",_N,[ee[17]||(ee[17]=p("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[p("span",{class:"text-4xl"},"🎪")],-1)),ee[18]||(ee[18]=p("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),ee[19]||(ee[19]=p("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),p("button",{onClick:ee[3]||(ee[3]=we=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):ae("",!0)],8,aN),i.value?(U(),j("div",bN,[p("div",wN,[ee[24]||(ee[24]=p("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),p("div",IN,[ee[20]||(ee[20]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),gt(p("input",{"onUpdate:modelValue":ee[4]||(ee[4]=we=>a.value=we),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:re},null,544),[[Ft,a.value]])]),p("div",EN,[ee[21]||(ee[21]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),gt(p("input",{"onUpdate:modelValue":ee[5]||(ee[5]=we=>l.value=we),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[Ft,l.value]])]),p("div",TN,[ee[22]||(ee[22]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),gt(p("input",{"onUpdate:modelValue":ee[6]||(ee[6]=we=>c.value=we),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:E},null,544),[[Ft,c.value]]),ee[23]||(ee[23]=p("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),p("div",xN,[p("button",{onClick:x,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:I,disabled:!a.value.trim()||!l.value.trim()||!c.value.trim()||c.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,AN)])])])):ae("",!0),o.value?(U(),j("div",SN,[p("div",PN,[p("div",RN,[ee[25]||(ee[25]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"⚠️")],-1)),ee[26]||(ee[26]=p("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),p("p",CN,'Êtes-vous sûr de vouloir supprimer la saison "'+le((De=d.value)==null?void 0:De.name)+'" ?',1)]),ee[27]||(ee[27]=p("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),p("div",{class:"flex justify-end space-x-3"},[p("button",{onClick:V,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:R,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ae("",!0),_t(RI,{show:f.value,message:w(),error:y.value,"session-info":Ge(),onSubmit:Le,onCancel:it},null,8,["show","message","error","session-info"]),_t(CI,{show:C.value,onClose:ee[7]||(ee[7]=we=>C.value=!1)},null,8,["show"]),ee[28]||(ee[28]=yr('<footer class="mt-16 border-t border-white/10"><div class="container mx-auto px-4 py-6 text-center text-xs text-gray-400"><span>© Patrice Lamarque 2025</span><span class="mx-2">•</span><span>Licence MIT</span><span class="mx-2">•</span><a href="https://github.com/plamarque/impro-selector" target="_blank" rel="noopener noreferrer" class="underline decoration-white/20 hover:decoration-white/40 hover:text-gray-200">GitHub</a></div></footer>',1))])}}},DN="modulepreload",VN=function(n){return"/"+n},Dy={},Jt=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=VN(i),i in Dy)return;Dy[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let d=s.length-1;d>=0;d--){const f=s[d];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":DN,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((d,f)=>{c.addEventListener("load",d),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},_h="magicLinks";function bh({seasonId:n,playerId:e,eventId:t,action:r}){return`${n}__${e}__${t}__${r}`}function VI(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function Xf({seasonId:n,playerId:e,eventId:t,action:r}){const s=bh({seasonId:n,playerId:e,eventId:t,action:r}),i=VI(40),o=Me(ve,_h,s),a=Date.now()+1e3*60*60*24*7;await Nn(o,{seasonId:n,playerId:e,eventId:t,token:i,action:r,expiresAt:a});const c=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(i)}&a=${encodeURIComponent(r)}`;return{id:s,token:i,url:c}}async function NI({seasonId:n,playerId:e,email:t}){const r="protection",s="verify_email",i=bh({seasonId:n,playerId:e,eventId:r,action:s}),o=VI(40),a=Me(ve,_h,i),l=Date.now()+1e3*60*60*24*7;await Nn(a,{seasonId:n,playerId:e,eventId:r,token:o,action:s,email:t,expiresAt:l});const d=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(s)}`;return{id:i,token:o,url:d}}async function OI({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=bh({seasonId:n,playerId:e,eventId:t,action:s}),o=Me(ve,_h,i),a=await Ps(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function Zf({seasonId:n,playerId:e,eventId:t,action:r}){const s=bh({seasonId:n,playerId:e,eventId:t,action:r}),i=Me(ve,_h,s);await ou(i)}const NN=Object.freeze(Object.defineProperty({__proto__:null,consumeMagicLink:Zf,createEmailVerificationLink:NI,createMagicLink:Xf,verifyMagicLink:OI},Symbol.toStringTag,{value:"Module"}));class ON{constructor(){this.sessions=new Map,this.sessionDuration=10*60*1e3}isPasswordCached(e){const t=this.sessions.get(e);return t?Date.now()-t.timestamp>this.sessionDuration?(this.sessions.delete(e),!1):!0:!1}getCachedPassword(e){const t=this.sessions.get(e);return t?Date.now()-t.timestamp>this.sessionDuration?(this.sessions.delete(e),null):t.password:null}saveSession(e,t){this.sessions.set(e,{password:t,timestamp:Date.now()})}clearSession(e){this.sessions.delete(e)}clearExpiredSessions(){const e=Date.now();for(const[t,r]of this.sessions.entries())e-r.timestamp>this.sessionDuration&&this.sessions.delete(t)}clearAllSessions(){this.sessions.clear()}}const Da=new ON;function qm(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}async function MI(n,e,t,r=null){try{ce.info("Début protectPlayer",{playerId:n,seasonId:r});const s=await qu(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:l}=await Jt(()=>import("./index.esm-2eecf77a.js"),[]),{db:c}=await Jt(()=>Promise.resolve().then(()=>oi),void 0),d=r?i(c,"seasons",r,"playerProtection"):i(c,"playerProtection"),f=o(d,a("email","==",e)),v=await l(f);if(!v.empty&&v.docs.find(F=>F.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");ce.debug("Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:y}=await Jt(()=>import("./index.esm-bbe4b6d2.js"),[]),{auth:C}=await Jt(()=>Promise.resolve().then(()=>oi),void 0),A=await y(C,e,t);ce.info("Compte Firebase Auth créé",{uid:A.user.uid});const k=qm(t),$=r?Me(c,"seasons",r,"playerProtection",n):Me(c,"playerProtection",n);return await Nn($,{playerId:n,email:e,passwordHash:k,firebaseUid:A.user.uid,isProtected:!0,createdAt:new Date}),ce.info("Protection sauvegardée dans Firestore"),{success:!0}}catch(s){throw ce.error("Erreur lors de la protection du joueur",s),s}}async function LI({playerId:n,email:e,seasonId:t=null}){const r=t?Xe(ve,"seasons",t,"playerProtection"):Xe(ve,"playerProtection"),s=ih(r,_m("email","==",e)),i=await Pt(s);if(!i.empty&&i.docs.find(d=>d.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");try{const{fetchSignInMethodsForEmail:c}=await Jt(()=>import("./index.esm-bbe4b6d2.js"),[]),{auth:d}=await Jt(()=>Promise.resolve().then(()=>oi),void 0),f=await c(d,e);if(Array.isArray(f)&&f.length>0)throw new Error("Cette adresse email est déjà utilisée par un autre joueur")}catch(c){if(c!=null&&c.code&&c.code!=="auth/invalid-email")throw c}const o=t?Me(ve,"seasons",t,"playerProtection",n):Me(ve,"playerProtection",n);(await Ps(o)).exists()?await Nu(o,{email:e,updatedAt:new Date}):await Nn(o,{playerId:n,email:e,isProtected:!1,createdAt:new Date});const{url:l}=await NI({seasonId:t,playerId:n,email:e});return{success:!0,url:l}}async function FI({playerId:n,seasonId:e=null}){const t=e?Me(ve,"seasons",e,"playerProtection",n):Me(ve,"playerProtection",n);if(!(await Ps(t)).exists())throw new Error("Protection introuvable");return await Nu(t,{emailVerifiedAt:new Date}),{success:!0}}async function MN({playerId:n,seasonId:e=null}){const t=e?Me(ve,"seasons",e,"playerProtection",n):Me(ve,"playerProtection",n);return await Nu(t,{emailVerifiedAt:null}),{success:!0}}async function UI(n,e=null){try{const t=e?Me(ve,"seasons",e,"playerProtection",n):Me(ve,"playerProtection",n);return await Nn(t,{playerId:n,email:"",isProtected:!1,emailVerifiedAt:null,updatedAt:new Date}),{success:!0,email:""}}catch(t){throw ce.error("Erreur lors de la suppression de la protection",t),t}}async function Xi(n,e=null){try{const t=e?Me(ve,"seasons",e,"playerProtection",n):Me(ve,"playerProtection",n),r=await Ps(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return ce.error("Erreur lors de la vérification de protection",t),!1}}async function qu(n,e=null){try{const t=e?Me(ve,"seasons",e,"playerProtection",n):Me(ve,"playerProtection",n),r=await Ps(t);return r.exists()?r.data():null}catch(t){return ce.error("Erreur lors de la récupération des données de protection",t),null}}async function $I(n,e=null){try{const t=await qu(n,e);return(t==null?void 0:t.email)||""}catch(t){return ce.error("Erreur lors de la récupération de l'email",t),""}}async function ep(n=null){try{const e=n?Xe(ve,"seasons",n,"playerProtection"):Xe(ve,"playerProtection");return(await Pt(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return ce.error("Erreur lors du chargement des protections",e),[]}}async function zm(n,e,t=null){try{const r=await qu(n,t);if(!r||!r.isProtected)return!1;if(r.firebaseUid){ce.debug("Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await Jt(()=>import("./index.esm-bbe4b6d2.js"),[]),{auth:i}=await Jt(()=>Promise.resolve().then(()=>oi),void 0);return await s(i,r.email,e),ce.debug("Mot de passe Firebase Auth valide"),Da.saveSession(n,e),!0}catch(s){return ce.debug("Mot de passe Firebase Auth invalide",{code:s.code}),!1}}else{ce.debug("Vérification avec hash local");const s=qm(e),i=r.passwordHash===s;return i&&Da.saveSession(n,e),i}}catch(r){return ce.error("Erreur lors de la vérification du mot de passe",r),!1}}function da(n){return Da.isPasswordCached(n)}function LN(n){return Da.getCachedPassword(n)}async function jI(n,e=null){try{ce.info("Début sendPasswordResetEmail",{playerId:n,seasonId:e});const t=await qu(n,e);if(ce.debug("Protection data disponible"),!t||!t.isProtected)throw new Error("Joueur non protégé");if(ce.debug("Email à utiliser (masqué)"),t.firebaseUid){ce.debug("Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await Jt(()=>import("./index.esm-bbe4b6d2.js"),[]),{auth:s}=await Jt(()=>Promise.resolve().then(()=>oi),void 0);ce.debug("Tentative d'envoi d'email"),await r(s,t.email),ce.info("Email envoyé avec succès via Firebase Auth")}else{ce.debug("Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await Jt(()=>import("./index.esm-bbe4b6d2.js"),[]),{auth:i}=await Jt(()=>Promise.resolve().then(()=>oi),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);ce.info("Compte temporaire créé",{uid:a.user.uid}),await s(i,t.email),ce.info("Email envoyé avec succès");const{updateDoc:l}=await Jt(()=>import("./index.esm-2eecf77a.js"),[]),{db:c}=await Jt(()=>Promise.resolve().then(()=>oi),void 0),d=e?Me(c,"seasons",e,"playerProtection",n):Me(c,"playerProtection",n);await l(d,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")ce.debug("Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),ce.info("Email envoyé avec succès");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw ce.error("Erreur lors de l'envoi de l'email de réinitialisation",{error:t}),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}async function FN(n,e,t=null){try{const r=qm(e),s=t?Me(ve,"seasons",t,"playerProtection",n):Me(ve,"playerProtection",n);return await Nu(s,{passwordHash:r,updatedAt:new Date}),{success:!0}}catch(r){throw ce.error("Erreur lors de la mise à jour du mot de passe",r),r}}async function UN(n){return new Promise((e,t)=>{ce.debug("Demande de mot de passe pour disponibilité"),t(new Error("Gestion de mot de passe à implémenter côté composant"))})}const Id=Object.freeze(Object.defineProperty({__proto__:null,clearEmailVerificationForProtection:MN,getCachedPlayerPassword:LN,getPlayerEmail:$I,getPlayerProtectionData:qu,isPlayerPasswordCached:da,isPlayerProtected:Xi,listProtectedPlayers:ep,markEmailVerifiedForProtection:FI,protectPlayer:MI,requirePlayerPasswordForAvailability:UN,sendPasswordResetEmail:jI,startEmailVerificationForProtection:LI,unprotectPlayer:UI,updatePlayerPasswordInFirestore:FN,verifyPlayerPassword:zm},Symbol.toStringTag,{value:"Module"}));let Bn="mock",fu=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],uo=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function BI(n){Bn=n}async function $N(){if(Bn!=="firebase"||!(await Pt(Xe(ve,"seasons"))).empty)return;const e=Me(Xe(ve,"seasons"));await Nn(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:Mu()});const t=await Pt(Xe(ve,"players"));for(const o of t.docs)await Nn(Me(e,"players",o.id),o.data());const r=await Pt(Xe(ve,"events"));for(const o of r.docs)await Nn(Me(e,"events",o.id),o.data());const s=await Pt(Xe(ve,"availability"));for(const o of s.docs)await Nn(Me(e,"availability",o.id),o.data());const i=await Pt(Xe(ve,"selections"));for(const o of i.docs)await Nn(Me(e,"selections",o.id),o.data())}async function jN(){Bn==="firebase"&&await $N()}async function Vy(n=null){return(Bn==="firebase"?n?(await Pt(Xe(ve,"seasons",n,"events"))).docs.map(t=>({id:t.id,...t.data()})):(await Pt(Xe(ve,"events"))).docs.map(t=>({id:t.id,...t.data()})):uo).sort((t,r)=>{const s=c=>{if(!c)return null;if(c instanceof Date)return c;if(typeof(c==null?void 0:c.toDate)=="function")return c.toDate();const d=new Date(c);return isNaN(d.getTime())?null:d},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,l=o?o.getTime():Number.POSITIVE_INFINITY;return a!==l?a-l:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function of(n=null){return(Bn==="firebase"?n?(await Pt(Xe(ve,"seasons",n,"players"))).docs.map(t=>({id:t.id,...t.data()})):(await Pt(Xe(ve,"players"))).docs.map(t=>({id:t.id,...t.data()})):fu).sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function qI(n,e=null){if(Bn==="firebase"){const t=Me(e?Xe(ve,"seasons",e,"players"):Xe(ve,"players"));return await Nn(t,{name:n}),t.id}else{const t=`p${fu.length+1}`;return fu.push({id:t,name:n}),t}}async function BN(n,e=null){if(Bn==="firebase"){const t=e?Me(ve,"seasons",e,"players",n):Me(ve,"players",n);await ou(t);const r=e?await Pt(Xe(ve,"seasons",e,"availability")):await Pt(Xe(ve,"availability")),s=Ow(ve);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else fu=fu.filter(t=>t.id!==n)}async function Go(n,e,t=null){if(Bn==="firebase"){const r=t?await Pt(Xe(ve,"seasons",t,"availability")):await Pt(Xe(ve,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function Ko(n=null){if(Bn==="firebase"){const e=n?await Pt(Xe(ve,"seasons",n,"selections")):await Pt(Xe(ve,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function Ny(n,e,t=null){if(Bn==="firebase"){const r=t?Me(ve,"seasons",t,"availability",n):Me(ve,"availability",n);await Nn(r,e)}}async function qN({seasonId:n,playerName:e,eventId:t,value:r}){if(Bn!=="firebase")return;const s=n?Me(ve,"seasons",n,"availability",e):Me(ve,"availability",e),i=await Ps(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await Nn(s,a)}async function zN(n,e,t=null){if(Bn==="firebase"){const r=t?Me(ve,"seasons",t,"selections",n):Me(ve,"selections",n);await Nn(r,{players:e})}}async function GN(n,e=null){if(ce.info("Suppression de l'événement",{eventId:n}),Bn==="firebase")try{ce.debug("Suppression de l'événement dans Firestore");const t=e?Me(ve,"seasons",e,"events",n):Me(ve,"events",n);await ou(t),ce.debug("Suppression de la sélection associée");const r=e?Me(ve,"seasons",e,"selections",n):Me(ve,"selections",n);await ou(r),ce.debug("Suppression des disponibilités");const s=e?await Pt(Xe(ve,"seasons",e,"availability")):await Pt(Xe(ve,"availability")),i=Ow(ve);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){ce.debug("Mise à jour de la disponibilité pour un joueur");const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),ce.info("Opérations de suppression terminées avec succès")}catch(t){throw ce.error("Erreur lors de la suppression",t),t}else uo=uo.filter(t=>t.id!==n)}async function KN(n,e=null){if(Bn==="firebase"){const t=Me(e?Xe(ve,"seasons",e,"events"):Xe(ve,"events"));return await Nn(t,n),t.id}else{const t=`event${uo.length+1}`;return uo.push({id:t,...n}),t}}async function Oy(n,e,t=null){if(Bn==="firebase"){const r=t?Me(ve,"seasons",t,"events",n):Me(ve,"events",n);await Nn(r,e,{merge:!0})}else{const r=uo.findIndex(s=>s.id===n);r!==-1&&(uo[r]={id:n,...e})}}async function HN({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,reason:o="new_event",fromEmail:a=void 0}){const l=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>Disponibilité demandée</h2>
      <p>Bonjour ${e},</p>
      <p>Peux-tu indiquer ta disponibilité pour <strong>${t}</strong> (${r}) ?</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;margin-right:8px;background:#16a34a;color:#fff;border-radius:8px;text-decoration:none;">Je suis dispo ✅</a>
        <a href="${i}" style="display:inline-block;padding:10px 16px;background:#dc2626;color:#fff;border-radius:8px;text-decoration:none;">Pas dispo ❌</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: ${o}</p>
    </div>
  `,c=`Disponibilité demandée · ${t}`,d={to:n,message:{subject:c,html:l},createdAt:Mu(),meta:{reason:o,eventTitle:t,eventDate:r,playerName:e}};return a&&(d.from=a,d.replyTo=a),await ch(Xe(ve,"mail"),d),{success:!0}}async function WN({toEmail:n,playerName:e,verifyUrl:t,fromEmail:r=void 0}){const s=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>Vérification de votre email</h2>
      <p>Bonjour ${e},</p>
      <p>Pour sécuriser votre joueur, merci de confirmer que vous avez accès à cette adresse email.</p>
      <p>
        <a href="${t}" style="display:inline-block;padding:10px 16px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;">Vérifier mon email</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Ce lien expirera dans 7 jours.</p>
    </div>
  `,o={to:n,message:{subject:"Confirmez votre email pour activer la protection",html:s},createdAt:Mu(),meta:{reason:"protection_email_verification",playerName:e}};r&&(o.from=r,o.replyTo=r),await ch(Xe(ve,"mail"),o)}async function QN({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,html:i=void 0,subject:o=void 0,fromEmail:a=void 0}){ce.debug("queueSelectionEmail",{forPlayer:e,hasCustomHtml:!!i,hasCustomSubject:!!o});const l=i||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>🎭 Tu as été sélectionné(e) !</h2>
      <p>Bonjour ${e},</p>
      <p>Félicitations ! Tu as été sélectionné(e) pour <strong>${t}</strong> (${r}).</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#8b5cf6;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Tu recevras bientôt plus d'informations sur l'organisation.</p>
    </div>
  `,c=o||`🎭 Sélection confirmée · ${t}`;ce.debug("queueSelectionEmail html/subject ready");const d={to:n,message:{subject:c,html:l},createdAt:Mu(),meta:{reason:"selection",eventTitle:t,eventDate:r,playerName:e}};a&&(d.from=a,d.replyTo=a),ce.debug("queueSelectionEmail firestore payload ready");try{return await ch(Xe(ve,"mail"),d),ce.info("Email ajouté à la queue Firestore",{playerName:e}),{success:!0}}catch(f){throw ce.error("Erreur lors de l'ajout à Firestore",{playerName:e,error:f}),f}}async function JN({eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,players:i}){if(ce.info("sendSelectionEmailsForEvent",{eventId:n,seasonId:r,seasonSlug:s,playersCount:i==null?void 0:i.length,selectedCount:t==null?void 0:t.length}),!e||!t||t.length===0)throw new Error("Données manquantes pour l'envoi des emails de sélection");const{getPlayerEmail:o}=await Jt(()=>Promise.resolve().then(()=>Id),void 0),{createMagicLink:a}=await Jt(()=>Promise.resolve().then(()=>NN),void 0),l=`${window.location.origin}/season/${s}/event/${n}`,c=t.join(", "),d=`🎭 Sélection confirmée · ${e.title}`,f=[];for(const v of t){ce.debug("Traitement du joueur",{playerName:v});try{const y=i==null?void 0:i.find(F=>F.name===v);if(!y){ce.warn("Joueur non trouvé",{playerName:v});continue}ce.debug("Joueur trouvé");const C=await o(y.id,r);if(!C){ce.warn("Pas d'email pour le joueur",{playerName:v});continue}ce.debug("Email trouvé pour joueur");const k=`${(await a({seasonId:r,playerId:y.id,eventId:n,action:"no"})).url}&slug=${encodeURIComponent(s)}`,$=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2>🎭 Sélection confirmée</h2>
          <p>Bonjour <strong>${v}</strong>,</p>
          <p>Tu as été sélectionné(e) pour <strong>${e.title}</strong> (${My(e.date)}).</p>
          <p>Sélection complète : <strong>${c}</strong>.</p>
          <p>Tu n'es plus disponible ? Signale le rapidement ici :</p>
          <p>
            <a href="${k}" style="display:inline-block;padding:10px 16px;background:#dc2626;color:#fff;border-radius:8px;text-decoration:none;">Signaler que je ne suis plus disponible</a>
          </p>
          <p>
            <a href="${l}" style="display:inline-block;padding:10px 16px;background:#8b5cf6;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
          </p>
        </div>
      `;ce.debug("HTML généré pour joueur");const B=QN({toEmail:C,playerName:v,eventTitle:e.title,eventDate:My(e.date),eventUrl:l,html:$,subject:d});f.push(B),ce.info("Email ajouté à la queue",{playerName:v})}catch(y){ce.error("Erreur lors de l'envoi de l'email de sélection",{playerName:v,error:y})}}return ce.info("Nombre total d'emails à envoyer",{count:f.length}),await Promise.all(f),ce.info("Tous les emails ont été envoyés avec succès"),{success:!0,count:f.length}}function My(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}const YN={class:"relative p-5 pb-4 border-b border-white/10"},XN={class:"text-xl md:text-2xl font-bold text-white pr-10"},ZN={key:0,class:"text-sm text-purple-300 mt-1"},e2={class:"px-4 md:px-6 py-4 md:py-6 space-y-6 overflow-y-auto"},t2={class:"bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20 p-3"},n2={class:"text-blue-200 text-sm"},r2={class:"flex space-x-1 bg-gray-800 rounded-lg p-1"},s2=["onClick"],i2={key:0,class:"space-y-4"},o2={class:"bg-gray-800 border border-gray-600 rounded-lg p-4 text-white whitespace-pre-line"},a2={class:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2"},l2={key:0,class:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-3"},u2={class:"text-blue-200 text-sm"},c2={class:"bg-gray-800 border border-gray-600 rounded-lg p-3"},d2={key:0,class:"space-y-2"},h2={class:"flex flex-wrap gap-2"},f2={key:1,class:"text-amber-400 text-sm"},p2={key:1,class:"space-y-4"},m2={class:"relative"},g2=["value"],v2=["title"],y2={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},_2={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},b2={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},w2=["disabled"],I2={key:0},E2={key:1},zI={__name:"EventAnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},mode:{type:String,default:"event",validator:n=>["event","selection"].includes(n)},selectedPlayers:{type:Array,default:()=>[]}},emits:["close","notifications-sent","send-email-notifications"],setup(n,{emit:e}){const t=n,r=e,s=O("email"),i=O(!1),o=O("Copier le message"),a=O(!1),l=O(!1),c=[{id:"email",label:"📧 Email"},{id:"copy",label:"📋 Copie"}],d=nt(()=>!t.event||!t.seasonSlug?"":`${window.location.origin}/season/${t.seasonSlug}/event/${t.event.id}`),f=nt(()=>{if(!t.event)return"";const F=k(t.event.date);if(t.mode==="selection"){const z=t.selectedPlayers.join(", ");return`Sélection pour ${t.event.title} du ${F} : ${z}`}else return`Bonjour !

Nouvel événement : ${t.event.title}
Date : ${F}

Lien direct vers l'événement : ${d.value}

Merci de confirmer votre disponibilité.`}),v=nt(()=>{if(!t.event||!t.selectedPlayers)return"";if(t.mode==="selection"){const F=t.selectedPlayers.join(", ");return`Sélection confirmée

Bonjour [Nom du joueur],

Tu as été sélectionné(e) pour ${t.event.title} (${k(t.event.date)}).

Sélection complète : ${F}.

Tu n'es plus disponible ? Signale le rapidement ici : [Lien de désistement]`}else return`Disponibilité demandée

Bonjour [Nom du joueur],

Peux-tu indiquer ta disponibilité pour ${t.event.title} (${k(t.event.date)}) ?`}),y=O([]);async function C(){if(!t.seasonId)return;let F=[];t.mode==="selection"?F=t.players.filter(ne=>t.selectedPlayers.includes(ne.name)):F=t.players.filter(ne=>ne.isProtected);const z=[];for(const ne of F)try{const{getPlayerEmail:re}=await Jt(()=>Promise.resolve().then(()=>Id),void 0),E=await re(ne.id,t.seasonId);E&&z.push({...ne,email:E})}catch(re){console.warn(`Impossible de charger l'email pour ${ne.name}:`,re)}y.value=z}function A(){r("close")}function k(F){var ne;return F?(typeof F=="string"?new Date(F):((ne=F.toDate)==null?void 0:ne.call(F))||F).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function $(){const F=f.value;navigator.clipboard.writeText(F).then(()=>{i.value=!0,o.value="Copié !",setTimeout(()=>{i.value=!1,o.value="Copier le message"},2e3)}).catch(z=>{console.warn("Erreur lors de la copie du texte"),alert("Impossible de copier le message.")})}async function B(){if(!(!t.event||y.value.length===0)){a.value=!0;try{t.mode==="selection"?r("send-email-notifications",{eventId:t.event.id,eventData:t.event,reason:"selection",selectedPlayers:t.selectedPlayers}):r("send-email-notifications",{eventId:t.event.id,eventData:t.event,reason:"manual"})}catch{console.error("Erreur lors de l'envoi des notifications"),alert("Erreur lors de l'envoi des notifications. Veuillez réessayer.")}finally{a.value=!1}}}return kr(()=>{t.show&&(s.value="email",C())}),sn(()=>t.show,F=>{F&&(s.value="email",C())}),sn(()=>t.selectedPlayers,()=>{t.show&&t.mode==="selection"&&C()}),(F,z)=>n.show?(U(),j("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:A},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] flex flex-col",onClick:z[1]||(z[1]=Kt(()=>{},["stop"]))},[p("div",YN,[p("button",{onClick:A,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),p("h2",XN,le(n.mode==="selection"?"Annoncer la sélection":"Annoncer l'événement"),1),n.event?(U(),j("p",ZN,le(n.event.title)+" — "+le(k(n.event.date)),1)):ae("",!0)]),p("div",e2,[p("div",t2,[p("p",n2,le(n.mode==="selection"?"Choisis comment annoncer cette sélection aux joueurs :":"Choisis comment annoncer cet événement aux joueurs :"),1)]),p("div",r2,[(U(),j(St,null,_r(c,ne=>p("button",{key:ne.id,onClick:re=>s.value=ne.id,class:Hn(["flex-1 px-4 py-2 rounded-md text-sm font-medium transition-all duration-200",s.value===ne.id?"bg-purple-600 text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-gray-700"])},le(ne.label),11,s2)),64))]),s.value==="email"?(U(),j("div",i2,[p("div",null,[z[2]||(z[2]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Prévisualisation du message :",-1)),p("div",o2,le(v.value),1)]),p("div",null,[p("label",a2,[z[3]||(z[3]=$n(" Destinataires ")),p("button",{onClick:z[0]||(z[0]=ne=>l.value=!l.value),class:"text-blue-400 hover:text-blue-300 text-lg cursor-help",title:"Cliquer pour plus d'information"}," ? ")]),l.value?(U(),j("div",l2,[p("p",u2,le(n.mode==="selection"?"Les destinataires sont les joueurs sélectionnés qui ont renseigné une adresse email en utilisant la fonction Protéger.":"Les destinataires sont les joueurs qui ont renseigné une adresse email en utilisant la fonction Protéger."),1)])):ae("",!0),p("div",c2,[y.value.length>0?(U(),j("div",d2,[p("div",h2,[(U(!0),j(St,null,_r(y.value,ne=>(U(),j("span",{key:ne.id,class:"px-3 py-1 bg-gray-700 text-white rounded text-sm"},le(ne.name),1))),128))])])):(U(),j("div",f2," ⚠️ "+le(n.mode==="selection"?"Aucun joueur sélectionné avec email renseigné. Les notifications ne pourront pas être envoyées.":"Aucun joueur protégé avec email renseigné. Les notifications ne pourront pas être envoyées."),1))])])])):ae("",!0),s.value==="copy"?(U(),j("div",p2,[z[6]||(z[6]=p("div",{class:"bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-lg border border-purple-500/20 p-3"},[p("p",{class:"text-purple-200 text-sm"},"📋 Copie du message pour partage manuel")],-1)),p("div",m2,[p("textarea",{value:f.value,class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400 resize-none",rows:"6",readonly:""},null,8,g2),p("button",{onClick:$,class:"absolute top-2 right-2 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg p-2 hover:from-purple-600 hover:to-pink-700 transition-all duration-300",title:o.value},[i.value?(U(),j("svg",_2,z[5]||(z[5]=[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(U(),j("svg",y2,z[4]||(z[4]=[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2z"},null,-1)])))],8,v2)])])):ae("",!0)]),p("div",b2,[s.value==="email"?(U(),j("button",{key:0,onClick:B,disabled:y.value.length===0||a.value,class:"h-12 px-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600 flex-1"},[a.value?(U(),j("span",E2,"📧 Envoi en cours...")):(U(),j("span",I2,"📧 Envoyer les notifications email"))],8,w2)):ae("",!0),s.value==="copy"?(U(),j("button",{key:1,onClick:$,class:"h-12 px-6 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 flex-1"}," 📋 Copier le message ")):ae("",!0),p("button",{onClick:A,class:"h-12 px-4 bg-gray-700 text-white rounded-lg"}," Fermer ")])])])):ae("",!0)}},T2={class:"text-center mb-6"},x2={class:"text-lg text-gray-300"},A2={class:"mb-6"},S2={class:"space-y-4"},P2=["disabled"],R2={key:0,class:"animate-spin"},C2={key:1},k2={class:"mb-6 text-center"},D2={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},V2={class:"text-red-300 text-sm"},N2={class:"text-center mb-6"},O2={class:"text-lg text-gray-300"},M2={class:"mb-6"},L2=["disabled"],F2={key:0,class:"animate-spin"},U2={key:1},$2={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},j2={class:"text-red-300 text-sm"},B2={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},q2={class:"text-green-300 text-sm"},z2={class:"flex justify-center"},GI={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=O(""),i=O(!1),o=O(""),a=O(!1),l=O(""),c=O(""),d=O(null);async function f(){if(s.value){i.value=!0,o.value="";try{const C=await Jf(t.seasonId);if(s.value===C){r("verified",{type:"season_pin"}),y();return}await zm(t.player.id,s.value,t.seasonId)?(r("verified",{type:"player_password"}),y()):o.value="Mot de passe incorrect. Veuillez réessayer."}catch(C){ce.error("Erreur lors de la vérification",C),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function v(){i.value=!0,l.value="",c.value="";try{const C=await jI(t.player.id,t.seasonId);c.value=C.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(C){ce.error("Erreur lors de l'envoi de l'email",C),l.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function y(){r("close"),s.value="",o.value="",a.value=!1,l.value="",c.value=""}return sn(()=>t.show,C=>{C&&un(()=>{d.value&&d.value.focus()})}),(C,A)=>{var k,$;return U(),j(St,null,[n.show?(U(),j("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:y},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:A[2]||(A[2]=Kt(()=>{},["stop"]))},[p("div",T2,[A[6]||(A[6]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"🔐")],-1)),A[7]||(A[7]=p("h2",{class:"text-2xl font-bold text-white mb-2"},"Vérification requise",-1)),p("p",x2,le((k=n.player)==null?void 0:k.name),1),A[8]||(A[8]=p("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protégé par mot de passe",-1))]),p("div",A2,[p("div",S2,[p("div",null,[A[9]||(A[9]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),gt(p("input",{"onUpdate:modelValue":A[0]||(A[0]=B=>s.value=B),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:Cn(f,["enter"]),ref_key:"passwordInput",ref:d},null,544),[[Ft,s.value]])])]),p("button",{onClick:f,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(U(),j("span",R2,"⏳")):(U(),j("span",C2,"🔓")),p("span",null,le(i.value?"Vérification...":"Vérifier"),1)],8,P2)]),p("div",k2,[p("button",{onClick:A[1]||(A[1]=B=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(U(),j("div",D2,[p("div",V2,le(o.value),1)])):ae("",!0),p("div",{class:"flex justify-center"},[p("button",{onClick:y,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ae("",!0),a.value?(U(),j("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:A[5]||(A[5]=B=>a.value=!1)},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:A[4]||(A[4]=Kt(()=>{},["stop"]))},[p("div",N2,[A[10]||(A[10]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"📧")],-1)),A[11]||(A[11]=p("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oublié",-1)),p("p",O2,le(($=n.player)==null?void 0:$.name),1)]),p("div",M2,[A[12]||(A[12]=p("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),p("button",{onClick:v,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(U(),j("span",F2,"⏳")):(U(),j("span",U2,"📧")),p("span",null,le(i.value?"Envoi...":"Envoyer l'email"),1)],8,L2)]),l.value?(U(),j("div",$2,[p("div",j2,le(l.value),1)])):ae("",!0),c.value?(U(),j("div",B2,[p("div",q2,le(c.value),1)])):ae("",!0),p("div",z2,[p("button",{onClick:A[3]||(A[3]=B=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ae("",!0)],64)}}},G2={class:"text-center mb-6"},K2={class:"text-lg text-gray-300"},H2={class:"mb-6"},W2={class:"flex items-center space-x-3"},Q2={class:"text-2xl"},J2={class:"font-semibold text-white"},Y2={class:"text-sm text-gray-300"},X2={class:"mb-6"},Z2={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-1"},eO={key:0,class:"mb-6"},tO={class:"flex items-center justify-center gap-3 mb-4 text-sm"},nO={key:0,class:"space-y-4"},rO=["disabled"],sO={key:0,class:"animate-spin"},iO={key:1},oO={key:0,class:"text-sm text-gray-300"},aO={key:1,class:"space-y-4"},lO={key:0,class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},uO=["disabled"],cO={key:0,class:"animate-spin"},dO={key:1},hO={key:1,class:"mb-6"},fO={key:0,class:"space-y-4 mb-4"},pO=["disabled"],mO={key:0,class:"animate-spin"},gO={key:1},vO=["disabled"],yO={key:2,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},_O={class:"text-red-300 text-sm"},bO={key:3,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},wO={class:"text-green-300 text-sm"},IO={__name:"PlayerProtectionModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null},onboarding:{type:Boolean,default:!1}},emits:["close","update","onboarding-finished"],setup(n,{emit:e}){const t=n,r=e,s=O(!1),i=O(1),o=O(""),a=O(""),l=O(""),c=O(""),d=O(!1),f=O(""),v=O(""),y=O(!1),C=O(!1),A=O(""),k=O(!1),$=O(!1),B=yu(),F=nt(()=>o.value&&o.value.includes("@")),z=nt(()=>l.value&&c.value&&l.value===c.value&&l.value.length>=6);async function ne(){var V,w;if((V=t.player)!=null&&V.id&&(s.value=await Xi(t.player.id,t.seasonId),!s.value)){o.value="";try{const ze=await(await Jt(()=>Promise.resolve().then(()=>Id),void 0)).getPlayerProtectionData(t.player.id,t.seasonId);a.value=(ze==null?void 0:ze.email)||"";const Le=!!(ze!=null&&ze.emailVerifiedAt);i.value=Le?2:1;const it=((w=B.query)==null?void 0:w.verified)==="1";$.value=it&&Le}catch{a.value="",i.value=1,$.value=!1}}}async function re(){var V,w;if(F.value){d.value=!0,f.value="",v.value="";try{const ze=await LI({playerId:t.player.id,email:o.value.trim(),seasonId:t.seasonId}),Le=(V=B.params)==null?void 0:V.slug,it=`${ze.url}${Le?`&slug=${encodeURIComponent(Le)}`:""}&player=${encodeURIComponent(t.player.id)}&open=protection`;await WN({toEmail:o.value,playerName:((w=t.player)==null?void 0:w.name)||"joueur",verifyUrl:it}),k.value=!0}catch(ze){ce.error("Erreur envoi email de vérification protection",ze),f.value=(ze==null?void 0:ze.message)||"Impossible d'envoyer l'email de vérification"}finally{d.value=!1}}}async function E(){try{const{clearEmailVerificationForProtection:V}=await Jt(()=>Promise.resolve().then(()=>Id),void 0);await V({playerId:t.player.id,seasonId:t.seasonId})}catch{}i.value=1,k.value=!1,$.value=!1,o.value="",l.value="",c.value=""}async function I(){if(z.value){d.value=!0,f.value="",v.value="";try{const V=a.value||o.value;if(!V)throw new Error("Adresse email manquante");await MI(t.player.id,V,l.value,t.seasonId),v.value="Protection activée avec succès !",s.value=!0,o.value="",a.value="",l.value="",c.value="",r("update");try{t.onboarding&&r("onboarding-finished")}catch{}}catch(V){ce.error("Erreur lors de l'activation de la protection",V),V.message&&V.message.includes("email")?f.value="Cette adresse email est déjà utilisée par un autre joueur.":f.value="Erreur lors de l'activation de la protection. Veuillez réessayer."}finally{d.value=!1}}}function x(){C.value=!0,A.value="",f.value=""}async function P(){if(A.value){d.value=!0,f.value="",v.value="";try{if(!await zm(t.player.id,A.value,t.seasonId)){f.value="Mot de passe incorrect. Veuillez réessayer.";return}const w=await UI(t.player.id,t.seasonId);v.value="Protection désactivée avec succès !",s.value=!1,C.value=!1,A.value="",w.email&&(o.value=w.email),r("update")}catch(V){ce.error("Erreur lors de la désactivation de la protection",V),f.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{d.value=!1}}}function R(){r("close")}return sn(()=>t.player,()=>{t.show&&t.player&&ne()},{immediate:!0}),sn(()=>t.show,V=>{V&&t.player&&(o.value="",l.value="",c.value="",f.value="",v.value="",y.value=!1,C.value=!1,A.value="",i.value=1,k.value=!1,ne(),t.onboarding&&un(()=>{}))}),(V,w)=>{var ze;return n.show?(U(),j("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:R},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:w[6]||(w[6]=Kt(()=>{},["stop"]))},[p("div",G2,[w[7]||(w[7]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"🔒")],-1)),w[8]||(w[8]=p("h2",{class:"text-2xl font-bold text-white mb-2"},"Protection du joueur",-1)),p("p",K2,le((ze=n.player)==null?void 0:ze.name),1)]),p("div",H2,[p("div",{class:Hn(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[p("div",W2,[p("span",Q2,le(s.value?"🔒":"🔓"),1),p("div",null,[p("div",J2,le(s.value?"Protégé":"Non protégé"),1),p("div",Y2,le(s.value?"Modifications sécurisées":"Modifications libres"),1)])])],2)]),p("div",X2,[p("button",{onClick:w[0]||(w[0]=Le=>y.value=!y.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[w[9]||(w[9]=p("h3",{class:"text-sm font-semibold text-blue-300"},"💡 Pourquoi protéger son joueur ?",-1)),p("span",{class:Hn(["text-blue-300 transition-transform duration-200",{"rotate-180":y.value}])},"▼",2)]),y.value?(U(),j("div",Z2,w[10]||(w[10]=[p("div",null,[$n("• "),p("span",{class:"text-blue-300"},"Protection des disponibilités :"),$n(" Seul vous pouvez modifier vos disponibilités")],-1),p("div",null,[$n("• "),p("span",{class:"text-blue-300"},"Protection du nom :"),$n(" Seul vous pouvez changer votre nom de joueur")],-1),p("div",null,[$n("• "),p("span",{class:"text-blue-300"},"Email requis :"),$n(" Permet de réinitialiser le mot de passe en cas d'oubli et de recevoir des notifications quand des changements surviennent")],-1)]))):ae("",!0)]),s.value?ae("",!0):(U(),j("div",eO,[w[18]||(w[18]=p("h3",{class:"text-lg font-semibold text-white mb-4"},"🔐 Activer la protection",-1)),p("div",tO,[p("div",{class:Hn(["px-3 py-1 rounded-full border",i.value===1?"bg-blue-500/20 border-blue-400 text-blue-200":"bg-green-500/20 border-green-400 text-green-200"])},"1. Email",2),w[11]||(w[11]=p("div",{class:"text-gray-400"},"→",-1)),p("div",{class:Hn(["px-3 py-1 rounded-full border",i.value===2?"bg-yellow-500/20 border-yellow-400 text-yellow-200":i.value>2?"bg-green-500/20 border-green-400 text-green-200":"bg-gray-500/20 border-gray-400 text-gray-200"])},"2. Mot de passe",2)]),i.value===1?(U(),j("div",nO,[p("div",null,[w[12]||(w[12]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),gt(p("input",{"onUpdate:modelValue":w[1]||(w[1]=Le=>o.value=Le),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Ft,o.value]])]),p("button",{onClick:re,disabled:!F.value||d.value,class:"w-full px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[d.value?(U(),j("span",sO,"⏳")):(U(),j("span",iO,"✉️")),p("span",null,le(d.value?"Envoi...":"Envoyer le lien de vérification"),1)],8,rO),k.value?(U(),j("div",oO," Un email de vérification a été envoyé. Cliquez sur le lien reçu, puis revenez ici. ")):ae("",!0)])):i.value===2?(U(),j("div",aO,[$.value?(U(),j("div",lO,[w[13]||(w[13]=p("span",null,"✅",-1)),w[14]||(w[14]=p("span",null,"Adresse email vérifiée",-1)),p("button",{type:"button",onClick:E,title:"Changer d'adresse email",class:"ml-auto px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-colors"},"✏️")])):ae("",!0),w[17]||(w[17]=p("div",{class:"text-sm text-gray-300"},"Définissez maintenant votre mot de passe.",-1)),p("div",null,[w[15]||(w[15]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),gt(p("input",{"onUpdate:modelValue":w[2]||(w[2]=Le=>l.value=Le),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé (min. 6 caractères)"},null,512),[[Ft,l.value]])]),p("div",null,[w[16]||(w[16]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),gt(p("input",{"onUpdate:modelValue":w[3]||(w[3]=Le=>c.value=Le),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[Ft,c.value]])]),p("button",{onClick:I,disabled:!z.value||d.value,class:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[d.value?(U(),j("span",cO,"⏳")):(U(),j("span",dO,"🔒")),p("span",null,le(d.value?"Activation...":"Activer la protection"),1)],8,uO)])):ae("",!0)])),s.value?(U(),j("div",hO,[w[21]||(w[21]=p("h3",{class:"text-lg font-semibold text-white mb-4"},"🔓 Désactiver la protection",-1)),w[22]||(w[22]=p("p",{class:"text-sm text-gray-300 mb-4"}," Attention : désactiver la protection supprimera définitivement le mot de passe et l'email associés. ",-1)),C.value?(U(),j("div",fO,[p("div",null,[w[19]||(w[19]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe de confirmation",-1)),gt(p("input",{"onUpdate:modelValue":w[4]||(w[4]=Le=>A.value=Le),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe pour confirmer"},null,512),[[Ft,A.value]])]),p("button",{onClick:P,disabled:!A.value||d.value,class:"w-full px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[d.value?(U(),j("span",mO,"⏳")):(U(),j("span",gO,"🔓")),p("span",null,le(d.value?"Désactivation...":"Confirmer la désactivation"),1)],8,pO),p("button",{onClick:w[5]||(w[5]=Le=>C.value=!1),class:"w-full px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])):ae("",!0),C.value?ae("",!0):(U(),j("button",{key:1,onClick:x,disabled:d.value,class:"w-full px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},w[20]||(w[20]=[p("span",null,"🔓",-1),p("span",null,"Désactiver la protection",-1)]),8,vO))])):ae("",!0),f.value?(U(),j("div",yO,[p("div",_O,le(f.value),1)])):ae("",!0),v.value?(U(),j("div",bO,[p("div",wO,le(v.value),1)])):ae("",!0),p("div",{class:"flex justify-center"},[p("button",{onClick:R,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ae("",!0)}}};const EO=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},TO={class:"relative text-center p-6 pb-4 border-b border-white/10"},xO={class:"text-2xl md:text-3xl font-bold text-white mb-1"},AO={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},SO={class:"grid grid-cols-3 gap-3 md:gap-4"},PO={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},RO={class:"text-xl md:text-2xl font-bold text-white"},CO={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},kO={class:"text-xl md:text-2xl font-bold text-white"},DO={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},VO={class:"text-xl md:text-2xl font-bold text-white"},NO={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},OO={key:0,class:"md:hidden mt-3 space-y-2"},MO={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},LO={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},FO={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},UO={class:"mb-6"},$O={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null},onboardingStep:{type:Number,default:0},onboardingPlayerId:{type:[String,null],default:null}},emits:["close","update","delete","refresh","advance-onboarding"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=O(!1),o=O(""),a=O(null),l=O(!1),c=O(!1),d=O(null),f=O(!1);function v(){s("close")}function y(){var re;o.value=((re=r.player)==null?void 0:re.name)||"",i.value=!0,un(()=>{a.value&&a.value.focus()})}function C(){i.value=!1,o.value=""}async function A(){var E,I;if(!o.value.trim())return;if(await Xi((E=r.player)==null?void 0:E.id,r.seasonId)){da((I=r.player)==null?void 0:I.id)?k():(d.value="update",c.value=!0);return}k()}function k(){var re;s("update",{playerId:(re=r.player)==null?void 0:re.id,newName:o.value.trim()}),i.value=!1,o.value=""}async function $(){var E,I;if(await Xi((E=r.player)==null?void 0:E.id,r.seasonId)){da((I=r.player)==null?void 0:I.id)?B():(d.value="delete",c.value=!0);return}B()}function B(){var re;s("delete",(re=r.player)==null?void 0:re.id)}function F(){s("refresh")}function z(re){d.value==="update"?k():d.value==="delete"&&B(),d.value=null}sn(()=>r.show,re=>{re||(i.value=!1,o.value="",d.value=null,l.value=!1)}),e({openProtection(){l.value=!0}});const ne=O({position:null});return sn(()=>r.show,re=>{re&&r.onboardingStep===4?un(()=>{const E=document.querySelectorAll("button");let I=null;if(E.forEach(x=>{!I&&x.textContent&&x.textContent.includes("Protection")&&(I=x)}),I){const x=I.getBoundingClientRect();ne.value.position={x:Math.round(x.right+8),y:Math.round(x.top+window.scrollY-4)}}}):re||(ne.value.position=null)}),(re,E)=>{var I;return U(),j(St,null,[n.show?(U(),j("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:v},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:E[5]||(E[5]=Kt(()=>{},["stop"]))},[p("div",TO,[p("button",{onClick:v,class:"absolute right-3 top-3 text-white/80 hover:text-white"},"✖️"),E[10]||(E[10]=p("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[p("span",{class:"text-2xl md:text-3xl"},"👤")],-1)),p("h2",xO,le((I=n.player)==null?void 0:I.name),1)]),p("div",AO,[p("div",null,[p("div",SO,[p("div",PO,[p("div",RO,le(r.stats.availability),1),E[11]||(E[11]=p("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),p("div",CO,[p("div",kO,le(r.stats.selection),1),E[12]||(E[12]=p("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),p("div",DO,[p("div",VO,le(r.stats.ratio)+"%",1),E[13]||(E[13]=p("div",{class:"text-xs md:text-sm text-gray-300"},"Taux",-1))])])]),p("div",NO,[p("button",{onClick:y,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},E[14]||(E[14]=[p("span",null,"✏️",-1),p("span",null,"Modifier",-1)])),p("button",{onClick:E[0]||(E[0]=x=>l.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},E[15]||(E[15]=[p("span",null,"🔒",-1),p("span",null,"Protection",-1)])),p("button",{onClick:$,class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},E[16]||(E[16]=[p("span",null,"🗑️",-1),p("span",null,"Supprimer",-1)])),p("button",{onClick:v,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")]),f.value?(U(),j("div",OO,[p("button",{onClick:E[1]||(E[1]=x=>{y(),f.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"}," ✏️ Modifier "),p("button",{onClick:E[2]||(E[2]=x=>{$(),f.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"}," 🗑️ Supprimer ")])):ae("",!0)]),p("div",MO,[p("button",{onClick:E[3]||(E[3]=x=>l.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"}," 🔒 Protection "),p("button",{onClick:v,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer "),p("button",{onClick:E[4]||(E[4]=x=>f.value=!f.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ ")])])])):ae("",!0),i.value?(U(),j("div",LO,[p("div",FO,[E[18]||(E[18]=p("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier le joueur",-1)),p("div",UO,[E[17]||(E[17]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),gt(p("input",{"onUpdate:modelValue":E[6]||(E[6]=x=>o.value=x),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Cn(C,["esc"]),Cn(A,["enter"])],ref_key:"editNameInput",ref:a},null,544),[[Ft,o.value]])]),p("div",{class:"flex justify-end space-x-3"},[p("button",{onClick:C,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:A,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ae("",!0),_t(IO,{show:l.value,player:n.player,seasonId:n.seasonId,onboarding:n.onboardingStep===4,onClose:E[7]||(E[7]=x=>l.value=!1),onUpdate:F,onOnboardingFinished:E[8]||(E[8]=x=>re.$emit("advance-onboarding",5))},null,8,["show","player","seasonId","onboarding"]),_t(GI,{show:c.value,player:n.player,seasonId:n.seasonId,onClose:E[9]||(E[9]=x=>c.value=!1),onVerified:z},null,8,["show","player","seasonId"])],64)}}},jO=EO($O,[["__scopeId","data-v-a6671485"]]),BO={class:"relative p-6 pb-4 border-b border-white/10"},qO={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},zO={__name:"HowItWorksModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(U(),j("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=Kt(()=>{},["stop"]))},[p("div",BO,[p("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=p("div",{class:"flex items-center gap-3"},[p("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-2xl"},"❓"),p("div",null,[p("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Comment fonctionne la sélection automatique ?"),p("p",{class:"text-sm text-blue-300"},"Tirage au sort pondéré pour favoriser l'équité")])],-1))]),s[5]||(s[5]=yr('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">En bref</h3><p>On tire au sort uniquement parmi les joueurs <span class="text-green-300">disponibles</span>. Ceux qui ont <span class="text-purple-300">moins joué</span> ont plus de chances d&#39;être tirés. À long terme, tout le monde joue à peu près autant.</p></div><div class="space-y-3"><h3 class="text-white font-semibold">Détails du tirage</h3><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><span class="text-white">Qui participe ?</span> Tous les joueurs marqués « ✅ Disponible » pour l’événement.</li><li><span class="text-white">Un coup de pouce aux moins joués</span> : si vous avez moins joué récemment, le tirage vous favorise un peu plus.</li><li><span class="text-white">Comment se fait le tirage ?</span> On tire un nom au hasard en tenant compte de cet avantage, on le met de côté, puis on recommence jusqu’à avoir assez de joueurs.</li><li><span class="text-white">Si on relance</span> : on garde les joueurs encore disponibles et on complète seulement les places manquantes.</li><li><span class="text-white">Indisponibles</span> : ils ne sont jamais tirés au sort.</li></ol></div><div class="space-y-2"><h3 class="text-white font-semibold">Estimation des chances</h3><p>L’application peut afficher un pourcentage indicatif pour aider à comprendre : si Alice a moins joué que Bob, elle aura un pourcentage plus élevé. C’est une indication, pas une promesse : deux tirages peuvent donner des résultats différents.</p></div><div class="space-y-2"><h3 class="text-white font-semibold">Pourquoi c’est juste</h3><ul class="list-disc list-inside space-y-1 text-gray-300"><li>Ceux qui ont moins joué ont automatiquement plus de chances.</li><li>Après une sélection, vos chances diminuent un peu pour laisser la place aux autres.</li><li>Sur la durée, les sélections s’<span class="text-green-300">équilibrent naturellement</span>.</li></ul></div><div class="space-y-2"><h3 class="text-white font-semibold">Exemples rapides</h3><p> • Alice n’a encore jamais été sélectionnée, Bob a été sélectionné une fois, Charlie plusieurs fois. Pour 1 place, on aura environ : Alice 57 %, Bob 29 %, Charlie 14 %.<br> • S’il y a 2 places, les chances de chacun augmentent, mais l’ordre reste aléatoire : un tirage peut donner Alice + Bob, un autre Alice + Charlie. </p></div><div class="text-xs text-gray-400"> Remarque : l’algorithme favorise l’équité à long terme, mais <span class="text-gray-300">n’assure pas</span> une rotation parfaite à chaque événement. </div></div>',1)),p("div",qO,[p("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ae("",!0)}},GO={class:"relative text-center p-6 pb-4 border-b border-white/10"},KO={class:"text-2xl md:text-3xl font-bold text-white mb-1"},HO={class:"text-sm md:text-base text-purple-300"},WO={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},QO={key:0,class:"mb-3"},JO={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},YO={class:"text-white font-medium"},XO={key:0,class:"text-purple-400 mr-2"},ZO={key:1,class:"text-green-400 mr-2"},eM={key:2,class:"text-red-400 mr-2"},tM={key:3,class:"text-gray-400 mr-2"},nM={key:1,class:"mb-3"},rM={class:"grid grid-cols-3 gap-2 md:gap-3 mb-3"},sM={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},iM={class:"text-cyan-300 text-lg md:text-xl font-semibold"},oM={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},aM={class:"text-green-400 text-lg md:text-xl font-semibold"},lM={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},uM={class:"text-purple-400 text-lg md:text-xl font-semibold"},cM={key:2,class:"mb-3"},dM={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},hM={class:"flex-1"},fM={class:"text-blue-300 text-sm font-medium"},pM={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},mM=["disabled","title"],gM=["disabled"],vM={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]}},emits:["close","selection","perfect","send-email-notifications"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=O(!1),o=O("Copier le message"),a=O(!1),l=O(!1),c=O(""),d=O(!1),f=O(!1),v=nt(()=>r.currentSelection&&r.currentSelection.length>0),y=nt(()=>{var w;if(!v.value)return!1;const P=r.currentSelection.some(ze=>!z(ze)),R=((w=r.event)==null?void 0:w.playerCount)||6,V=r.availableCount<R;return P||V});nt(()=>{var V;if(!y.value)return"";const P=r.currentSelection.filter(w=>!z(w)),R=((V=r.event)==null?void 0:V.playerCount)||6;return P.length>0?P.length===1?`${P[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${P.length} joueurs ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<R?`Seulement ${r.availableCount} joueurs disponibles pour ${R} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de joueurs à sélectionner.`:"Sélection incomplète"}),nt(()=>{if(!r.event||!v.value)return"";const P=C(r.event.date),R=r.currentSelection.join(", ");return`Sélection pour ${r.event.title} du ${P} : ${R}`}),sn(()=>r.show,P=>{P&&(i.value=!1,o.value="Copier le message",l.value=!1,c.value="",d.value=!1,a.value=!1)});function C(P){var V;return P?(typeof P=="string"?new Date(P):((V=P.toDate)==null?void 0:V.call(P))||P).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function A(){s("selection")}function k(){s("perfect")}function $(){s("close")}function B(){a.value=!0}function F(){f.value=!0}function z(P){return r.playerAvailability[P]===!0}function ne(P){return r.playerAvailability[P]===!1}function re(P){return r.currentSelection.includes(P)&&z(P)}function E(P=!1,R=!1){if(d.value=P,P){const V=C(r.event.date),w=r.currentSelection.join(", ");R?c.value=`Sélection mise à jour pour ${r.event.title} du ${V} : ${w}`:c.value=`Nouvelle sélection pour ${r.event.title} du ${V} : ${w}`}else c.value="Sélection effectuée avec succès !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function I(){l.value=!1}e({showSuccess:E});function x(P){s("send-email-notifications",P),a.value=!1}return(P,R)=>{var V,w,ze;return U(),j(St,null,[n.show?(U(),j("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:$},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:R[0]||(R[0]=Kt(()=>{},["stop"]))},[p("div",GO,[p("button",{onClick:$,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),R[4]||(R[4]=p("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-3xl"},"🎭")],-1)),p("h2",KO,"Sélection pour "+le((V=n.event)==null?void 0:V.title),1),p("p",HO,le(C((w=n.event)==null?void 0:w.date)),1),p("div",{class:"mt-3"},[p("button",{onClick:F,class:"inline-flex items-center gap-2 text-sm text-blue-300 hover:text-blue-200"},R[3]||(R[3]=[p("span",null,"❓",-1),$n(),p("span",null,"Comment ça marche ?",-1)]))])]),p("div",WO,[v.value?(U(),j("div",QO,[R[5]||(R[5]=p("h3",{class:"text-base md:text-lg font-semibold text-white mb-2"},"Joueurs sélectionnés",-1)),p("div",JO,[(U(!0),j(St,null,_r(n.currentSelection,Le=>(U(),j("div",{key:Le,class:Hn(["bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 rounded-lg border border-green-500/30 text-center",{"from-red-500/20 to-red-600/20 border-red-500/30":!z(Le),"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":ne(Le)}])},[p("span",YO,[re(Le)?(U(),j("span",XO,"🎭")):z(Le)?(U(),j("span",ZO,"✅")):ne(Le)?(U(),j("span",eM,"❌")):(U(),j("span",tM,"–")),$n(" "+le(Le),1)])],2))),128))])])):ae("",!0),y.value?(U(),j("div",nM,R[6]||(R[6]=[p("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[p("div",{class:"text-yellow-400"},"⚠️"),p("div",{class:"text-yellow-200 text-sm"},"Sélection incomplète. Vérifie ci-dessous.")],-1)]))):ae("",!0),p("div",rM,[p("div",sM,[p("div",iM,le(((ze=n.event)==null?void 0:ze.playerCount)||6),1),R[7]||(R[7]=p("div",{class:"text-xs md:text-sm text-gray-400"},"À sélectionner",-1))]),p("div",oM,[p("div",aM,le(n.availableCount),1),R[8]||(R[8]=p("div",{class:"text-xs md:text-sm text-gray-400"},"Disponibles",-1))]),p("div",lM,[p("div",uM,le(n.selectedCount),1),R[9]||(R[9]=p("div",{class:"text-xs md:text-sm text-gray-400"},"Sélectionnés",-1))])]),l.value?(U(),j("div",cM,[p("div",dM,[R[11]||(R[11]=p("div",{class:"text-blue-400 text-xl"},"✨",-1)),p("div",hM,[p("p",fM,le(c.value),1)]),p("button",{onClick:I,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},R[10]||(R[10]=[p("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):ae("",!0)]),p("div",pM,[p("button",{onClick:A,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":v.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},R[12]||(R[12]=[$n(" ✨ "),p("span",{class:"hidden sm:inline"},"Sélection Auto",-1),p("span",{class:"sm:hidden"},"Auto",-1)]),8,mM),v.value?(U(),j("button",{key:0,onClick:k,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap"},R[13]||(R[13]=[$n(" 👍 "),p("span",{class:"hidden sm:inline"},"Parfait",-1)]))):ae("",!0),p("button",{onClick:B,disabled:!v.value,class:"h-12 px-3 md:px-4 bg-gray-700 text-white rounded-lg flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},R[14]||(R[14]=[$n(" 📣 "),p("span",{class:"hidden sm:inline"},"Annoncer",-1)]),8,gM)])])])):ae("",!0),_t(zI,{show:a.value,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,mode:"selection","selected-players":n.currentSelection,onClose:R[1]||(R[1]=Le=>a.value=!1),onSendEmailNotifications:x},null,8,["show","event","season-id","season-slug","players","selected-players"]),_t(zO,{show:f.value,onClose:R[2]||(R[2]=Le=>f.value=!1)},null,8,["show"])],64)}}},yM={class:"flex items-center justify-center gap-2"},_M=["title"],bM=["title"],wM=["title"],IM=["title"],EM=["title"],Ly={__name:"AvailabilityCell",props:{playerName:{type:String,required:!0},eventId:{type:String,required:!0},isAvailable:{type:Boolean,default:null},isSelected:{type:Boolean,default:!1},chancePercent:{type:Number,default:null},showSelectedChance:{type:Boolean,default:!1}},emits:["toggle"],setup(n,{emit:e}){const t=n,r=e,s=O(!1),i=nt(()=>!(t.chancePercent==null||t.isAvailable!==!0||t.isSelected&&!t.showSelectedChance)),o=nt(()=>t.isSelected?i.value?`${t.playerName} est sélectionné pour cet événement • avait ~${t.chancePercent}% de chances`:`${t.playerName} est sélectionné pour cet événement`:t.isAvailable===!0?t.chancePercent!=null?`${t.playerName} est disponible • ~${t.chancePercent}% de chances d'être sélectionné`:`${t.playerName} est disponible`:t.isAvailable===!1?`${t.playerName} n'est pas disponible`:`Cliquer pour indiquer la disponibilité de ${t.playerName}`);function a(){r("toggle",t.playerName,t.eventId)}return(l,c)=>(U(),j("div",{class:"flex items-center justify-center cursor-pointer hover:bg-white/10 transition-all duration-200 min-h-20 p-3 md:p-5",onClick:a,onMouseenter:c[0]||(c[0]=d=>s.value=!0),onMouseleave:c[1]||(c[1]=d=>s.value=!1)},[p("div",yM,[i.value&&s.value?(U(),j("span",{key:0,class:"text-[11px] md:text-xs px-2 py-0.5 rounded-full bg-emerald-500/15 border border-emerald-400/40 text-emerald-200",title:o.value},le(n.chancePercent)+"% ",9,_M)):(U(),j(St,{key:1},[n.isSelected?(U(),j("span",{key:0,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:o.value}," 🎭 ",8,bM)):n.isAvailable===!0?(U(),j("span",{key:1,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:o.value}," ✅ ",8,wM)):n.isAvailable===!1?(U(),j("span",{key:2,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:o.value}," ❌ ",8,IM)):(U(),j("span",{key:3,class:"text-gray-500 hover:text-white transition-colors duration-200 text-xl",title:o.value}," – ",8,EM))],64))])],32))}},TM={key:0,class:"fixed inset-0 z-[130] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},xM={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},AM={class:"text-2xl md:text-3xl font-bold text-white mb-3"},SM={class:"text-gray-300 mb-6"},PM={class:"flex flex-col items-stretch justify-center gap-3"},RM=["value"],CM={__name:"CreatorOnboardingModal",props:{seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},onboardingDone:{type:Boolean,default:!1}},emits:["create-event","add-player","copy-link","dismissed"],setup(n,{emit:e}){const t=n,r=e,s=window.location.origin,i=nt(()=>`${s}/season/${t.seasonSlug}`),o=O(!1);try{t.seasonId&&(o.value=!!localStorage.getItem(`dismissCreatorOnboarding:${t.seasonId}`))}catch{}const a=nt(()=>t.onboardingDone?0:t.eventsCount===0&&t.playersCount===0?1:t.eventsCount>0&&t.playersCount===0?2:t.eventsCount>0&&t.playersCount>0&&!o.value?3:0),l=nt(()=>a.value>0),c=O(l.value);sn(a,k=>{c.value=k>0});const d=nt(()=>{switch(a.value){case 1:return"Commençons par créer votre premier événement";case 2:return"Super ! Ajoutez votre premier joueur";case 3:return"Vous y êtes presque! Maintenant, invitez vos joueurs.";default:return""}}),f=nt(()=>{switch(a.value){case 1:return"Un titre, une date... et c’est parti.";case 2:return"Ajoutez au moins un joueur pour commencer à saisir des disponibilités.";case 3:return"Laissez vos membres s’inscrire eux-même et indiquer leurs disponibilités en leur envoyant le lien direct.";default:return""}});function v(){c.value=!1,r("create-event")}function y(){c.value=!1,r("add-player")}function C(){var k;try{(k=navigator.clipboard)==null||k.writeText(i.value)}catch{}r("copy-link")}async function A(){try{if(t.seasonId){const{db:k}=await Jt(()=>Promise.resolve().then(()=>oi),void 0),{doc:$,updateDoc:B}=await Jt(()=>import("./index.esm-2eecf77a.js"),[]);await B($(k,"seasons",t.seasonId),{onboardingCreatorDone:!0})}else localStorage.setItem("dismissCreatorOnboarding","1")}catch{}o.value=!0,c.value=!1,r("dismissed")}return(k,$)=>l.value&&c.value?(U(),j("div",TM,[p("div",xM,[$[1]||($[1]=p("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[p("span",{class:"text-3xl"},"🎬")],-1)),p("h2",AM,le(d.value),1),p("p",SM,le(f.value),1),p("div",PM,[a.value===1?(U(),j("button",{key:0,onClick:v,class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all"}," ✨ Créer un événement ")):a.value===2?(U(),j("button",{key:1,onClick:y,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"}," 👤 Ajouter un joueur ")):a.value===3?(U(),j(St,{key:2},[p("input",{value:i.value,type:"text",readonly:"",class:"w-full px-3 py-2 bg-gray-800 border border-white/20 rounded-lg text-white text-sm select-all",onFocus:$[0]||($[0]=B=>B.target.select())},null,40,RM),p("div",{class:"flex gap-3 justify-center"},[p("button",{onClick:C,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"}," 🔗 Copier le lien "),p("button",{onClick:A,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"}," J’ai compris ")])],64)):ae("",!0)])])])):ae("",!0)}};const kM={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},DM={ref:"pageHeaderRef",class:"sticky top-0 z-[140] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},VM={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},NM={class:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2"},OM={class:"hidden md:flex items-center gap-2"},MM=["title"],LM={class:"text-2xl"},FM={key:0,class:"absolute right-0 mt-2 w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[200] overflow-hidden"},UM={class:"text-sm"},$M={class:"w-full px-0 md:px-0 pb-0 pt-[72px] md:pt-[80px] -mt-[72px] md:-mt-[80px] bg-gray-900"},jM={class:"flex items-stretch relative"},BM={key:0,class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},qM={class:"flex-1 overflow-hidden"},zM=["data-event-id","onClick"],GM=["title"],KM=["title"],HM={key:0,class:"mt-1 text-xs text-gray-400"},WM=["title","onClick"],QM=["title","onClick"],JM={key:0,class:"pointer-events-none"},YM={class:"flex items-center justify-between"},XM={key:1,class:"pointer-events-none"},ZM={id:"coachmark-avail",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-pink-500/40 rounded-xl shadow-2xl p-3 text-white relative"},eL={class:"flex items-center justify-between"},tL={key:2,class:"pointer-events-none"},nL={id:"coachmark-name",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-yellow-500/40 rounded-xl shadow-2xl p-3 text-white relative"},rL={class:"flex items-center justify-between"},sL={class:"table-auto border-separate border-spacing-0 table-fixed w-auto min-w-max"},iL=["data-player-id"],oL={class:"px-0 py-4 md:py-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900 left-col-td"},aL={class:"px-4 md:px-5 font-bold text-xl md:text-2xl whitespace-pre-wrap flex items-center"},lL={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protégé par mot de passe"},uL=["onClick","title"],cL=["data-event-id"],dL={class:"border-t border-white/10"},hL={class:"px-0 py-4 md:py-5 sticky left-0 z-40 bg-gray-900 left-col-td"},fL={class:"px-4 md:px-5 flex items-center"},pL=["data-event-id"],mL={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},gL={class:"text-center"},vL={class:"text-white text-lg"},yL={class:"mt-3 w-64 h-2 bg-white/10 rounded-full overflow-hidden"},_L={class:"text-white/60 text-xs mt-2"},bL={key:3,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-[200]"},wL={class:"flex items-center space-x-2"},IL={key:4,class:"fixed bottom-4 left-4 bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl shadow-2xl border border-red-400/30 backdrop-blur-sm z-[200]"},EL={class:"flex items-center space-x-2"},TL={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},xL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},AL={class:"mb-6"},SL={class:"mb-6"},PL={class:"mb-6"},RL={class:"mb-6 flex items-center gap-3"},CL={class:"mb-6"},kL={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},DL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},VL={class:"mb-6"},NL={class:"flex justify-end space-x-3"},OL={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},ML={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},LL={class:"flex justify-end space-x-3"},FL={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},UL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},$L={class:"flex justify-end space-x-3"},jL={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},BL={class:"relative text-center p-6 pb-4 border-b border-white/10"},qL={class:"text-2xl md:text-3xl font-bold text-white mb-1"},zL={class:"text-sm md:text-base text-purple-300"},GL={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},KL={key:0,class:"mb-4 md:mb-6"},HL={class:"text-gray-300 bg-gray-800/50 p-4 rounded-lg border border-gray-600/50"},WL={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},QL={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},JL={class:"text-xl md:text-2xl font-bold text-white"},YL={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},XL={class:"text-xl md:text-2xl font-bold text-white"},ZL={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},eF={class:"text-xl md:text-2xl font-bold text-white"},tF={key:1,class:"mb-4 md:mb-6"},nF={class:"bg-gray-800 border border-gray-600 rounded-lg overflow-hidden"},rF={class:"col-span-4 p-3 flex items-center"},sF={class:"font-medium text-white"},iF={key:0,class:"text-yellow-400 ml-2 text-lg",title:"Joueur protégé"},oF={class:"col-span-8 p-0"},aF={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},lF=["disabled","title"],uF=["title"],cF={key:2,class:"md:hidden mt-3 space-y-2"},dF=["disabled","title"],hF={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},fF={key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},pF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},mF={class:"mb-6"},gF={class:"mb-6"},vF={class:"mb-6"},yF={class:"mb-6 flex items-center gap-3"},_F={class:"mb-6"},bF={key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},wF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},IF={class:"mb-6"},EF={class:"space-y-4"},TF=["disabled"],xF={key:0,class:"animate-spin"},AF={key:1},SF={class:"mb-6 text-center"},PF={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},RF={class:"text-red-300 text-sm"},CF={key:13,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},kF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},DF={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},VF={class:"space-y-4"},NF={class:"mt-2 text-center"},OF={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},MF={class:"text-red-300 text-sm"},LF={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},FF=["disabled"],UF={key:0,class:"animate-spin"},$F={key:1},jF={class:"mb-6"},BF=["disabled"],qF={key:0,class:"animate-spin"},zF={key:1},GF={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},KF={class:"text-red-300 text-sm"},HF={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},WF={class:"text-green-300 text-sm"},QF={class:"flex justify-center"},JF={class:"mb-6"},YF=["disabled"],XF={key:0,class:"animate-spin"},ZF={key:1},e4={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},t4={class:"text-red-300 text-sm"},n4={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},r4={class:"text-green-300 text-sm"},s4={class:"flex justify-center"},i4={key:16,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},o4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl max-w-md"},a4={class:"flex gap-3"},Fy={__name:"GridBoard",props:{slug:{type:String,required:!0},eventId:{type:String,required:!1}},setup(n){const e=n,t=vu(),r=yu(),s=e.slug,i=O(""),o=O(""),a=O({}),l=O(!1),c=O(null),d=O(null),f=O(""),v=O(""),y=O(6),C=O(!1),A=O(""),k=O(null),$=O(null),B=O(null),F=O({position:null,side:null}),z=O({position:null}),ne=O({position:null}),re=O(!1),E=O(null),I=O(!1),x=O(null),P=O(null),R=O(!1),V=O(null),w=O(""),ze=O(!1),Le=O(null),it=O(""),Ge=O(""),je=O(!1),ke=O(null),ee=O(!1),De=O(null),we=O(""),Fe=O(""),ct=O(!1),hn=O(null),wt=O(!1),Q=O(!1),be=O(""),me=O(""),Te=O(!1),Qe=O(!1),ut=O(""),T=O(""),S=O(!1),N=O(null),J=O(""),W=O(!1),Y=O(!1),fe=O(!1),oe=O(null),ie=O(null),te=O(null),_e=O(0);function ge(){try{if(!o.value||!a.value||a.value.onboardingCreatorDone!==!0||qe.value.length===0)return;const _=localStorage.getItem(`playerTourCompleted:${o.value}`),m=localStorage.getItem(`startPlayerTour:${o.value}`);!_&&m&&(_e.value=1,localStorage.removeItem(`startPlayerTour:${o.value}`),un(()=>{const D=document.querySelector('button[data-onboarding="add-player"]');if(D){D.scrollIntoView({behavior:"smooth",block:"end"});const K=D.getBoundingClientRect(),se=document.getElementById("coachmark-add"),xe=280,he=100,Ce=(se==null?void 0:se.offsetWidth)||xe,Ke=(se==null?void 0:se.offsetHeight)||he,et=Math.round(K.right+12);if(et+Ce<=window.innerWidth-12){const ht=K.top+K.height/2-Ke/2,kt=-14,Dt=12,at=window.innerHeight-Ke-12,Zn=Math.max(Dt,Math.min(Math.round(ht+kt),at));F.value={position:{x:et,y:Zn},side:"right"}}else{const ht=Math.round(K.left+K.width/2-Ce/2),kt=Math.round(K.top-Ke-8),Dt=8,at=window.innerWidth-Ce-8;F.value={position:{x:Math.max(Dt,Math.min(ht,at)),y:kt},side:null}}}}))}catch{}}const Ie=O(!1),Se=O(null),Ve=O(null),Be=O(!1),Ye=O(null),zt=O(!1),Mt=O(null),fn=O(!1);kr(()=>{try{o.value&&localStorage.getItem(`dismissCreatorOnboarding:${o.value}`)&&(onboardingDismissedShare.value=!0)}catch{}});function Qt(){un(()=>{Wa()})}const xn=O(new Set),sr=O(!0),xt=O(0),an=O("Préparation de la grille"),Xn=O(e.eventId||null),yo=O(!1),Ei=O(null);sn(()=>e.eventId,_=>{if(_)if(Xn.value=_,qe.value.length>0)tn(_);else{const m=sn(qe,D=>{D.length>0&&(tn(_),m())},{immediate:!0})}});const _o=nt(()=>Je.value.map(_=>({..._,isProtected:xn.value.has(_.id),email:null}))),Ti=nt(()=>Xn.value?zn.value.findIndex(_=>_.id===Xn.value):-1);nt(()=>{if(!Xn.value||Ti.value===-1)return!1;if(window.innerWidth<=768){const _=document.querySelector(`[data-event-id="${Xn.value}"]`);if(_){const m=_.getBoundingClientRect();return m.left>=0&&m.right<=window.innerWidth}}return!0});const qn=O(null),bo=O(!1),Tr=O(!1),wo=O(0),Io=O(null),An=O(null);function ir(){const _=qn.value;if(!_)return;const{scrollLeft:m,scrollWidth:D,clientWidth:K}=_;bo.value=m>2,Tr.value=m<D-K-2}function Wa(){var _;try{ir(),wo.value=((_=qn.value)==null?void 0:_.scrollLeft)||0}catch{}}function pn(_){const m=qn.value;if(!m)return;let D=0;const K=m.querySelector("tbody tr td[data-event-id]");if(K)D=K.getBoundingClientRect().width;else if(An!=null&&An.value){const xe=An.value.querySelector(".col-event");xe&&(D=xe.getBoundingClientRect().width)}(!D||!isFinite(D))&&(D=m.clientWidth*.6);const se=m.scrollLeft+_*D;m.scrollTo({left:se,behavior:"smooth"})}const ks=O(null);O(0);const hr=O(!1),xr=O(!1),Ds=O(0);function zu(_,m){m&&typeof m.preventDefault=="function"&&m.preventDefault(),pr(),pn(_)}function fr(_,m){if(m&&typeof m.preventDefault=="function"&&m.preventDefault(),hr.value)return;hr.value=!0,Ds.value=_,xr.value=!1;const D=qn.value;if(!D)return;let K=0;const se=D.querySelector("tbody tr td[data-event-id]");if(se)K=se.getBoundingClientRect().width;else if(An!=null&&An.value){const Ke=An.value.querySelector(".col-event");Ke&&(K=Ke.getBoundingClientRect().width)}(!K||!isFinite(K))&&(K=D.clientWidth*.6);const xe=K/6,he=120,Ce=()=>{if(!hr.value||Ds.value===0)return;xr.value||(xr.value=!0);const Ke=D.scrollLeft+Ds.value*xe;D.scrollTo({left:Ke,behavior:"auto"}),ks.value=window.setTimeout(Ce,he)};ks.value=window.setTimeout(Ce,250)}function pr(_){_&&typeof _.preventDefault=="function"&&_.preventDefault();const m=hr.value,D=xr.value;if(hr.value=!1,ks.value&&(clearTimeout(ks.value),ks.value=null),_&&typeof _.type=="string"&&_.type.startsWith("touch")&&!D){const K=Ds.value||0;K!==0&&pn(K),Ds.value=0;return}Ds.value=0,m&&D&&wh()}function wh(){const _=qn.value;if(!_)return;let m=0;const D=_.querySelector("tbody tr td[data-event-id]");if(D)m=D.getBoundingClientRect().width;else if(An!=null&&An.value){const he=An.value.querySelector(".col-event");he&&(m=he.getBoundingClientRect().width)}if(!m||!isFinite(m)||m<=0)return;const K=_.scrollLeft,xe=Math.round(K/m)*m;_.scrollTo({left:xe,behavior:"smooth"})}function Eo(_){k.value=_;const m=document.querySelector(`[data-player-id="${_}"]`);m&&m.scrollIntoView({behavior:"smooth",block:"center"}),Ne.value=!0,yt.value="Nouveau joueur ajouté !",setTimeout(()=>{Ne.value=!1},3e3)}function Gu(){if(_e.value!==1)return;const _=document.querySelector('button[data-onboarding="add-player"]');if(!_)return;const m=_.getBoundingClientRect(),D=document.getElementById("coachmark-add"),K=280,se=100,xe=D!=null&&D.offsetWidth&&D.offsetWidth>0?D.offsetWidth:K,he=D!=null&&D.offsetHeight&&D.offsetHeight>0?D.offsetHeight:se,Ce=Math.round(m.right+12);if(Ce+xe<=window.innerWidth-12){const et=m.top+m.height/2-he/2,ht=To(et+-14,he);F.value={position:{x:Ce,y:ht},side:"right"}}else{const et=Math.round(m.left+m.width/2-xe/2),It=To(m.top-he-8,he),ht=8,kt=window.innerWidth-xe-8;F.value={position:{x:Math.max(ht,Math.min(et,kt)),y:It},side:null}}}function To(_,m){const D=pageHeaderRef==null?void 0:pageHeaderRef.value,K=D?Math.max(0,Math.round(D.getBoundingClientRect().height||0)):0,se=Math.max(12,K+8),xe=window.innerHeight-m-12;return Math.max(se,Math.min(Math.round(_),xe))}const mr=O(!1),gr=O(null);function Ku(){mr.value=!mr.value}function xo(){mr.value=!1}function Ao(_){if(!mr.value)return;const m=gr.value;m&&!m.contains(_.target)&&(mr.value=!1)}kr(()=>{document.addEventListener("click",Ao)}),Cl(()=>{document.removeEventListener("click",Ao)});function Vs(){var _;_e.value===1&&((_=F.value)!=null&&_.position)&&Gu()}kr(()=>{window.addEventListener("scroll",Vs,{passive:!0}),window.addEventListener("resize",Vs)}),Cl(()=>{window.removeEventListener("scroll",Vs),window.removeEventListener("resize",Vs)});function Qa(){var _,m;try{o.value&&(localStorage.removeItem(`playerTourCompleted:${o.value}`),localStorage.setItem(`startPlayerTour:${o.value}`,"1"))}catch{}$.value=$.value||((_=Je.value[0])==null?void 0:_.id)||null,B.value=((m=zn.value[0])==null?void 0:m.id)||null,F.value.position=null,z.value.position=null,ne.value.position=null,_e.value=1,un(()=>{const D=document.querySelector('button[data-onboarding="add-player"]');D&&(D.scrollIntoView({behavior:"smooth",block:"end"}),requestAnimationFrame(()=>{const K=D.getBoundingClientRect(),se=document.getElementById("coachmark-add"),xe=280,he=100,Ce=(se==null?void 0:se.offsetWidth)||xe,Ke=(se==null?void 0:se.offsetHeight)||he,et=Math.round(K.right+12);if(et+Ce<=window.innerWidth-12){const ht=K.top+K.height/2-Ke/2,kt=-14,Dt=12,at=window.innerHeight-Ke-12,Zn=Math.max(Dt,Math.min(Math.round(ht+kt),at));F.value={position:{x:et,y:Zn},side:"right"}}else{const ht=Math.round(K.left+K.width/2-Ce/2),kt=Math.round(K.top-Ke-8),Dt=8,at=window.innerWidth-Ce-8;F.value={position:{x:Math.max(Dt,Math.min(ht,at)),y:kt},side:null}}}))})}function xi(_){return xn.value.has(_)}async function Ja(){if(o.value)try{const _=await ep(o.value),m=new Set;_.forEach(D=>{D.isProtected&&m.add(D.playerId||D.id)}),xn.value=m}catch{const m=new Set;for(const D of Je.value)await Xi(D.id,o.value)&&m.add(D.id);xn.value=m}}const Ne=O(!1),yt=O(""),jr=O(!1),Br=O("");function qr(){try{const _=`${window.location.origin}/season/${s}`;navigator.clipboard.writeText(_),Ne.value=!0,yt.value="Lien copié dans le presse-papiers",setTimeout(()=>{Ne.value=!1},2500)}catch{jr.value=!0,Br.value="Impossible de copier le lien",setTimeout(()=>{jr.value=!1},2500)}}async function So(_){await Xr({type:"deleteEvent",data:{eventId:_}})}async function Ih(_=null){const m=_||c.value;if(console.debug("deleteEventConfirmed"),!m){console.error("Aucun événement à supprimer");return}try{await GN(m,o.value),qe.value=qe.value.filter(D=>D.id!==m),await Promise.all([Vy(o.value),Go(Je.value,qe.value,o.value),Ko(o.value)]).then(([D,K,se])=>{qe.value=D,Gt.value=K,Oe.value=se}),l.value=!1,c.value=null,Ne.value=!0,yt.value="Événement supprimé avec succès !",setTimeout(()=>{Ne.value=!1},3e3)}catch{console.error("Erreur lors de la suppression de l'événement"),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function Hu(){l.value=!1,c.value=null}async function Po(){if(!d.value||!f.value.trim()||!v.value)return;const _=parseInt(y.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}try{const m={title:f.value.trim(),date:v.value,description:J.value.trim()||"",playerCount:_,archived:!!W.value};await Oy(d.value,m,o.value),!m.archived&&Je.value.length>0&&xn.value.size>0&&(Mt.value={id:d.value,...m},zt.value=!0),await Promise.all([Vy(o.value),Go(Je.value,qe.value,o.value),Ko(o.value)]).then(([D,K,se])=>{qe.value=D,Gt.value=K,Oe.value=se}),d.value=null,f.value="",v.value="",J.value="",y.value=6,W.value=!1,Ne.value=!0,yt.value="Événement mis à jour avec succès !",setTimeout(()=>{Ne.value=!1},3e3)}catch{console.error("Erreur lors de l'édition de l'événement"),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function Wu(){if(A.value.trim())try{const _=A.value.trim(),m=await qI(_,o.value);await Promise.all([of(o.value),Go(Je.value,qe.value,o.value),Ko(o.value)]).then(([D,K,se])=>{Je.value=D,Gt.value=K,Oe.value=se,Ja();const xe=Je.value.find(Ce=>Ce.id===m);Eo(m),$.value=m,B.value=zn.value&&zn.value[0]&&zn.value[0].id?zn.value[0].id:null;try{o.value&&localStorage.setItem(`lastAddedPlayerId:${o.value}`,m)}catch{}try{typeof _e<"u"&&(_e.value=2)}catch{}const he=document.querySelector(`[data-player-id="${m}"]`);he&&he.scrollIntoView({behavior:"smooth",block:"center"}),un(()=>{const Ce=`[data-player-id="${$.value}"] td[data-event-id="${B.value}"]`,Ke=document.querySelector(Ce);if(Ke){const et=Ke.getBoundingClientRect();z.value.position={x:Math.round(et.left),y:Math.round(et.top+window.scrollY-48)}}}),Ne.value=!0,yt.value="Joueur ajouté avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{Ne.value=!1},3e3),setTimeout(()=>{Ne.value=!1,yt.value=""},5e3)}),C.value=!1,A.value=""}catch{console.error("Erreur lors de l'ajout du joueur"),alert("Erreur lors de l'ajout du joueur. Veuillez réessayer.")}}function zr(){d.value=null,f.value="",v.value="",J.value="",y.value=6}O(null);const Ns=O(!1),Gr=O(""),Kr=O(""),Ai=O(""),Si=O(6),Pi=O(!1);async function Qu(){if(!Gr.value.trim()||!Kr.value){alert("Veuillez remplir le titre et la date de l'événement");return}const _=parseInt(Si.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}const m={title:Gr.value.trim(),date:Kr.value,description:Ai.value.trim()||"",playerCount:_,archived:!!Pi.value};await Eh(m)}async function Eh(_){try{const m=await KN(_,o.value);qe.value=[...qe.value,{id:m,..._}];const D={};for(const K of Je.value)D[K.name]=Gt.value[K.name]||{},D[K.name][m]=null,await Ny(K.name,D[K.name],o.value);Gr.value="",Kr.value="",Ai.value="",Si.value=6,Pi.value=!1,Ns.value=!1,await Promise.resolve(),Ne.value=!0,yt.value="Événement créé avec succès !",!_.archived&&Je.value.length>0&&xn.value.size>0&&(Mt.value={id:m,..._},zt.value=!0),setTimeout(()=>{Ne.value=!1},3e3)}catch{console.error("Erreur lors de la création de l'événement"),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function Hr(){Gr.value="",Kr.value="",Ai.value="",Si.value=6,Ns.value=!1}async function or(){await Xr({type:"addEvent",data:{}})}const qe=O([]),Je=O([]),Gt=O({}),Oe=O({}),Ro=O({}),Wr=O({});sn([()=>qe.value.length,()=>Je.value.length,sr],()=>{sr.value||un(()=>{Wa()})}),sn([()=>Je.value.length,()=>qe.value.length,o],()=>{ge()}),kr(async()=>{var xe;BI("firebase"),await jN();const _=ih(Xe(ve,"seasons"),_m("slug","==",e.slug)),m=await Pt(_);if(m.empty){t.push("/");return}else{const he=m.docs[0];o.value=he.id;const Ce=he.data();i.value=Ce.name,a.value=Ce,document.title=`Saison : ${i.value}`}if(o.value){an.value="Chargement des événements de la saison",xt.value=20;const he=await Pt(Xe(ve,"seasons",o.value,"events"));qe.value=he.docs.map(at=>({id:at.id,...at.data(),playerCount:at.data().playerCount||6})),an.value="Chargement des joueurs",xt.value=45;const Ce=await Pt(Xe(ve,"seasons",o.value,"players"));Je.value=Ce.docs.map(at=>({id:at.id,...at.data()})),an.value="Chargement des disponibilités",xt.value=70;const Ke=await Pt(Xe(ve,"seasons",o.value,"availability")),et={};Ke.docs.forEach(at=>{const Zn=at.data(),ts={};Object.keys(Zn).forEach(Ni=>{const Uo=Zn[Ni];ts[Ni]=Uo==="oui"?!0:Uo==="non"?!1:Uo}),et[at.id]=ts}),Gt.value=et,an.value="Chargement des sélections",xt.value=85;const It=await Pt(Xe(ve,"seasons",o.value,"selections")),ht={};It.docs.forEach(at=>{ht[at.id]=at.data().players||[]}),Oe.value=ht;const kt=await ep(o.value),Dt=new Set;Array.isArray(kt)&&kt.forEach(at=>{at.isProtected&&Dt.add(at.playerId||at.id)}),xn.value=Dt}const D=he=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>he()):setTimeout(he,0)};an.value="Préparation de l'interface",xt.value=95,D(()=>{Ls(),Yr()}),console.debug("players (deduplicated)"),console.debug("availability loaded"),await un(),xt.value=100,sr.value=!1,un(()=>{ir();const he=qn.value;he&&(he.addEventListener("scroll",Ce=>{ir(),wo.value=he.scrollLeft||0},{passive:!0}),window.addEventListener("resize",ir))});const K=r.query.event;if(K&&qe.value.length>0){const he=qe.value.find(Ce=>Ce.id===K);he?(console.debug("Événement trouvé depuis l'URL"),await dt(K,he)):(console.warn("Événement non trouvé avec l'ID"),jr.value=!0,Br.value="Événement non trouvé",setTimeout(()=>{jr.value=!1},3e3))}const se=r.query.player;if(se&&Je.value.length>0){const he=Je.value.find(Ce=>Ce.id===se);he&&(ol(he),await un(),r.query.open==="protection"&&((xe=P==null?void 0:P.value)!=null&&xe.openProtection)&&P.value.openProtection())}}),sn(()=>r.params.eventId,_=>{if(_){const m=()=>{const D=qe.value.find(K=>K.id===_);return D?(Us(D),!0):!1};if(qe.value.length>0)m();else{const D=sn(qe,K=>{K.length>0&&m()&&D()},{immediate:!0})}}},{immediate:!0});function Os(_){if(!_)return null;if(_ instanceof Date)return _;if(typeof(_==null?void 0:_.toDate)=="function")return _.toDate();if(typeof _=="string"||typeof _=="number"){const m=new Date(_);return isNaN(m.getTime())?null:m}return null}const Ri=nt(()=>[...Je.value].sort((_,m)=>(_.name||"").localeCompare(m.name||"","fr",{sensitivity:"base"}))),Ju=nt(()=>[...qe.value].sort((_,m)=>{const D=Os(_.date),K=Os(m.date),se=D?D.getTime():Number.POSITIVE_INFINITY,xe=K?K.getTime():Number.POSITIVE_INFINITY;return se!==xe?se-xe:(_.title||"").localeCompare(m.title||"","fr",{sensitivity:"base"})})),Qr=O(!1),zn=nt(()=>{const _=Ju.value;return Qr.value?_:_.filter(m=>!m.archived)});function Yu(){Qr.value=!Qr.value}async function Co(_,m){const D=Je.value.find(xe=>xe.name===_);if(!D){console.error("Joueur non trouvé");return}if(!qe.value.find(xe=>xe.id===m)){console.error("Événement non trouvé");return}if(xi(D.id)){const xe=da(D.id),he=te.value===D.id;console.debug("Joueur protégé:",{playerId:D.id,hasCachedPassword:xe,wasRecentlyVerified:he,recentlyVerifiedPlayer:te.value}),xe||he?(console.debug("Session active ou joueur récemment vérifié, procéder au toggle"),he&&(console.debug("Nettoyage du flag recentlyVerifiedPlayer"),te.value=null),Jr(D,m)):(console.debug("Pas de session, affichage de la modal de vérification"),ie.value={playerName:_,eventId:m},oe.value=D,fe.value=!0);return}Jr(D,m)}function Jr(_,m){var se,xe,he;const D=(se=Gt.value[_.name])==null?void 0:se[m];console.debug("toggleAvailability");let K;D===!0?K=!1:D===!1?K=void 0:K=!0,K===void 0?Gt.value[_.name]&&delete Gt.value[_.name][m]:(Gt.value[_.name]||(Gt.value[_.name]={}),Gt.value[_.name][m]=K);try{typeof _e<"u"&&_e.value===1&&_.id===($.value||((xe=Ri.value[0])==null?void 0:xe.id))&&m===(B.value||((he=zn.value[0])==null?void 0:he.id))&&(_e.value=3,un(()=>{const Ke=document.querySelector(`[data-player-id="${_.id}"]`);if(Ke){const et=Ke.querySelector(".player-name");if(et){const It=et.getBoundingClientRect();ne.value.position={x:Math.round(It.right+8),y:Math.round(It.top+window.scrollY-4)}}}}))}catch{}Ny(_.name,Gt.value[_.name],o.value).then(async()=>{await un(),Yr(),Ne.value=!0,yt.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{Ne.value=!1},3e3)}).catch(Ce=>{console.error("Erreur lors de la mise à jour de la disponibilité"),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}function mn(_,m){var D;return(D=Gt.value[_])==null?void 0:D[m]}function Xu(_,m){var se;const D=Oe.value[m]||[],K=(se=Gt.value[_])==null?void 0:se[m];return D.includes(_)&&K===!0}async function Zu(_,m=6){const D=qe.value.find(he=>he.id===_),K=(D==null?void 0:D.playerCount)||6,se=Oe.value[_]||[];if(se.length>0&&se.every(he=>mn(he,_))){console.debug("Tous les joueurs sélectionnés sont disponibles, nouveau tirage complet");const Ce=Je.value.filter(It=>mn(It.name,_)).map(It=>{const ht=Ms(It.name);return{name:It.name,weight:1/(1+ht)}}),Ke=[],et=[...Ce];for(;Ke.length<K&&et.length>0;){const It=et.reduce((Dt,at)=>Dt+at.weight,0);let ht=Math.random()*It;const kt=et.findIndex(Dt=>(ht-=Dt.weight,ht<=0));kt>=0&&(Ke.push(et[kt].name),et.splice(kt,1))}Oe.value[_]=Ke}else{const he=se.filter(Ke=>mn(Ke,_)),Ce=K-he.length;if(Ce<=0)Oe.value[_]=he;else{const Ke=new Set(he),It=Je.value.filter(Dt=>mn(Dt.name,_)&&!Ke.has(Dt.name)).map(Dt=>{const at=Ms(Dt.name);return{name:Dt.name,weight:1/(1+at)}}),ht=[],kt=[...It];for(;ht.length<Ce&&kt.length>0;){const Dt=kt.reduce((ts,Ni)=>ts+Ni.weight,0);let at=Math.random()*Dt;const Zn=kt.findIndex(ts=>(at-=ts.weight,at<=0));Zn>=0&&(ht.push(kt[Zn].name),kt.splice(Zn,1))}Oe.value[_]=[...he,...ht]}}await zN(_,Oe.value[_],o.value),Ls(),Yr()}async function Ya(_,m=6){var he,Ce;console.debug("tirerProtected appelé"),console.debug("etat modal selection avant");const D=Ie.value,K=(he=Se.value)==null?void 0:he.id,se=Oe.value[_]&&Oe.value[_].length>0,xe=se?[...Oe.value[_]]:[];if(await Zu(_,m),console.debug("etat modal selection apres"),D&&!Ie.value&&(console.debug("Restauration de la popin de sélection..."),Ie.value=!0,Se.value=qe.value.find(Ke=>Ke.id===K)),Ie.value&&((Ce=Se.value)==null?void 0:Ce.id)===_)if(console.debug("Popin de sélection ouverte, mise à jour..."),await un(),Ve.value&&Ve.value.showSuccess){console.debug("Appel de showSuccess sur la popin de sélection");const Ke=Oe.value[_]||[],et=xe.filter(ht=>Ke.includes(ht)),It=et.length>0&&et.length<xe.length;Ve.value.showSuccess(se,It)}else console.debug("showSuccess indisponible");else console.debug("Popin de sélection fermée, affichage message global"),Ne.value=!0,qe.value.find(Ke=>Ke.id===_),Oe.value[_],se?yt.value="Sélection mise à jour avec succès !":yt.value="Sélection effectuée avec succès !",setTimeout(()=>{Ne.value=!1},3e3)}function Ar(_){_===0?F.value.position=null:_===1?z.value.position=null:_===2&&(ne.value.position=null)}function Th(_){var D;return _?(typeof _=="string"?new Date(_):((D=_.toDate)==null?void 0:D.call(_))||_).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function Xa(_){var D;return _?(typeof _=="string"?new Date(_):((D=_.toDate)==null?void 0:D.call(_))||_).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function Ms(_){return Object.values(Oe.value).filter(m=>m.includes(_)).length}function ar(_){const m=Gt.value[_]||{};return Object.values(m).filter(D=>D===!0).length}function ko(_){return _?Object.values(Gt.value).filter(m=>m[_]===!0).length:0}function Za(_){return _?(Oe.value[_]||[]).length:0}function Ci(_){const m=qe.value.find(K=>K.id===_),D=(m==null?void 0:m.playerCount)||6;return Za(_)>=D}function Do(_){const m=ar(_),D=Ms(_);return m===0?0:D/m}function ec(_){Ro.value[_]={availability:ar(_),selection:Ms(_),ratio:Do(_)}}function Ls(){Je.value.forEach(_=>ec(_.name))}function Yr(){const _={};qe.value.forEach(m=>{const D=m.playerCount||6,se=Je.value.filter(he=>mn(he.name,m.id)===!0).map(he=>{const Ce=Ms(he.name);return{name:he.name,weight:1/(1+Ce)}}),xe=se.reduce((he,Ce)=>he+Ce.weight,0);se.forEach(he=>{const Ce=Math.min(1,he.weight/xe*D);_[he.name]||(_[he.name]={}),_[he.name][m.id]=Math.round(Ce*100)})}),Wr.value=_}const ki=O(null),Fs=O(!1);async function Lt(_=null){const m=_||ki.value;if(!m){console.error("Aucun joueur à supprimer");return}try{await BN(m,o.value),Je.value=Je.value.filter(D=>D.id!==m),Fs.value=!1,ki.value=null,Ne.value=!0,yt.value="Joueur supprimé avec succès !",setTimeout(()=>{Ne.value=!1},3e3)}catch{console.error("Erreur lors de la suppression du joueur"),alert("Erreur lors de la suppression du joueur. Veuillez réessayer.")}}function xh(){Fs.value=!1,ki.value=null}async function Ah(_){Sr(),await Xi(_,o.value)?await sc({type:"deletePlayer",data:{playerId:_}}):await Xr({type:"deletePlayer",data:{playerId:_}})}async function tc(){if(E.value){const _=qe.value.find(D=>D.id===E.value),m=(_==null?void 0:_.playerCount)||6;await Ya(E.value,m),re.value=!1,E.value=null}}function nc(){re.value=!1,E.value=null}function rc(){return V.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis",toggleArchive:"Archivage d'événement - Code PIN requis"}[V.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function Xr(_){if(Kn.isPinCached(o.value)){const m=Kn.getCachedPin(o.value);if(console.debug("PIN en cache trouvé, utilisation automatique"),await wd(o.value,m)){await Zr(_);return}else Kn.clearSession()}V.value=_,R.value=!0}async function sc(_){const m=_.data.playerId;if(da(m)){console.debug("Mot de passe du joueur en cache trouvé, utilisation automatique"),await Zr(_);return}Le.value=_,ze.value=!0}async function vr(_){try{if(await wd(o.value,_)){Kn.saveSession(o.value,_),R.value=!1;const D=V.value;V.value=null,await Zr(D)}else w.value="Code PIN incorrect",setTimeout(()=>{w.value=""},3e3)}catch{console.error("Erreur lors de la vérification du PIN"),w.value="Erreur lors de la vérification du code PIN"}}function ic(){R.value=!1,V.value=null,w.value=""}async function oc(_){if(_){je.value=!0,it.value="";try{const m=Le.value.data.playerId,D=await Jf(o.value);if(_===D){try{Da.saveSession(Le.value.data.playerId,_)}catch{}ze.value=!1;const se=Le.value;Le.value=null,Ge.value="",await Zr(se);return}if(await verifyPlayerPassword(m,_,o.value)){ze.value=!1;const se=Le.value;Le.value=null,Ge.value="",await Zr(se)}else it.value="Mot de passe incorrect",setTimeout(()=>{it.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),it.value="Erreur lors de la vérification du mot de passe"}finally{je.value=!1}}}function Di(){ze.value=!1,Le.value=null,it.value="",Ge.value="",je.value=!1}async function el(_){if(_){ct.value=!0,we.value="";try{const m=De.value.data.player,D=await Jf(o.value);if(_===D){try{Da.saveSession(De.value.data.player.id,_)}catch{}ee.value=!1;const se=De.value;De.value=null,Fe.value="",await Zr(se);return}if(await verifyPlayerPassword(m.id,_,o.value)){ee.value=!1;const se=De.value;De.value=null,Fe.value="",await Zr(se)}else we.value="Mot de passe incorrect",setTimeout(()=>{we.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),we.value="Erreur lors de la vérification du mot de passe"}finally{ct.value=!1}}}function tl(){ee.value=!1,De.value=null,we.value="",Fe.value="",ct.value=!1}async function Vo(){Q.value=!0,be.value="",me.value="";try{const _=De.value.data.player,m=await sendPasswordResetEmail(_.id,o.value);me.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),be.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{Q.value=!1}}async function ac(){Qe.value=!0,ut.value="",T.value="";try{const _=Le.value.data.playerId,m=await sendPasswordResetEmail(_,o.value);T.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),ut.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{Qe.value=!1}}function No(){return Kn.isPinCached(o.value)?{timeRemaining:Kn.getTimeRemaining(),isExpiringSoon:Kn.isExpiringSoon()}:null}async function Zr(_){if(!_)return;const{type:m,data:D}=_;try{switch(m){case"deleteEvent":console.debug("executePendingOperation - data.eventId reçu"),c.value=D.eventId,l.value=!0;break;case"addEvent":Ns.value=!0;break;case"deletePlayer":ki.value=D.playerId,Fs.value=!0;break;case"launchSelection":Oe.value[D.eventId]&&Oe.value[D.eventId].length>0?(E.value=D.eventId,re.value=!0,S.value=!1):(await Ya(D.eventId,D.count),S.value=!1);break;case"toggleAvailability":Jr(D.player,D.eventId);break;case"toggleArchive":await setEventArchived(D.eventId,D.archived,o.value);{const K=qe.value.findIndex(se=>se.id===D.eventId);K!==-1&&(qe.value[K]={...qe.value[K],archived:!!D.archived}),W.value=!!D.archived}break}}catch{console.error("Erreur lors de l'exécution de l'opération"),Ne.value=!0,yt.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{Ne.value=!1},3e3)}}function lc(){t.push("/")}Cl(()=>{const _=qn.value;_&&_.removeEventListener("scroll",ir),window.removeEventListener("resize",ir)});async function Us(_){N.value=_,J.value=_.description||"",W.value=!!_.archived;try{const[m,D]=await Promise.all([Go(Je.value,qe.value,o.value),Ko(o.value)]);Gt.value=m,Oe.value=D}catch(m){console.warn("Impossible de rafraîchir les données avant ouverture des détails:",m)}S.value=!0}function Oo(){S.value=!1,N.value=null,J.value="",Y.value=!1}function nl(){Oo(),r.params.eventId&&t.push(`/season/${e.slug}`)}async function rl(_,m){console.debug("handleAvailabilityToggle appelé");const D=Je.value.find(se=>se.name===_);if(!D){console.error("Joueur non trouvé");return}console.debug("Joueur trouvé");const K=xi(D.id);if(console.debug("Joueur protégé"),K){da(D.id)?(console.debug("Session active, procéder au toggle"),await Co(_,m)):(console.debug("Demande du mot de passe pour joueur protégé"),ie.value={playerName:_,eventId:m},oe.value=D,fe.value=!0);return}console.debug("Joueur non protégé, procéder au toggle"),await Co(_,m)}function sl(_,m){return(Oe.value[m]||[]).includes(_)}async function uc(_){if(console.debug("Mot de passe vérifié"),oe.value&&(te.value=oe.value.id,console.debug("Joueur marqué comme récemment vérifié")),ie.value){const{playerName:m,eventId:D}=ie.value;console.debug("Exécution de l'action en attente"),await Co(m,D),ie.value=null}else console.debug("Aucune action en attente trouvée");fe.value=!1,oe.value=null}function Vi(){d.value=N.value.id,f.value=N.value.title,v.value=N.value.date,J.value=N.value.description||"",y.value=N.value.playerCount||6,S.value=!1}async function il(){if(N.value)try{const _=!N.value.archived,m={...N.value,archived:_};await Oy(N.value.id,m,o.value),N.value.archived=_;const D=qe.value.findIndex(K=>K.id===N.value.id);D!==-1&&(qe.value[D].archived=_),Ne.value=!0,yt.value=_?"Événement archivé avec succès !":"Événement désarchivé avec succès !",setTimeout(()=>{Ne.value=!1},3e3)}catch{console.error("Erreur lors de la modification de l'archivage"),alert("Erreur lors de la modification de l'archivage. Veuillez réessayer.")}}function ol(_){x.value=_,I.value=!0;try{typeof _e<"u"&&_e.value}catch{}}function Sr(){I.value=!1,x.value=null}async function cc({playerId:_,newName:m}){try{await updatePlayer(_,m,o.value),await Promise.all([of(o.value),Go(Je.value,qe.value,o.value),Ko(o.value)]).then(([D,K,se])=>{if(Je.value=D,Gt.value=K,Oe.value=se,Ja(),x.value&&x.value.id===_){const xe=D.find(he=>he.id===_);xe&&(x.value=xe)}}),Ne.value=!0,yt.value="Joueur mis à jour avec succès !",setTimeout(()=>{Ne.value=!1},3e3)}catch{console.error("Erreur lors de l'édition du joueur"),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function dc(){try{await Promise.all([of(o.value),Go(Je.value,qe.value,o.value),Ko(o.value)]).then(([_,m,D])=>{if(Je.value=_,Gt.value=m,Oe.value=D,Ja(),x.value){const K=_.find(se=>se.id===x.value.id);K&&(x.value=K)}}),Ne.value=!0,yt.value="Données mises à jour !",setTimeout(()=>{Ne.value=!1},3e3)}catch{console.error("Erreur lors du rafraîchissement")}}function hc(_){if(!_)return{availability:0,selection:0,ratio:0};const m=ar(_.name),D=Ms(_.name),K=m===0?0:Math.round(D/m*100);return{availability:m,selection:D,ratio:K}}function Mo(_){const m=Oe.value[_]||[],D=qe.value.find(xe=>xe.id===_),K=(D==null?void 0:D.playerCount)||6,se=ko(_);if(m.length>0){const xe=m.some(Ce=>!mn(Ce,_)),he=se<K;if(xe||he)return{type:"incomplete",hasUnavailablePlayers:xe,hasInsufficientPlayers:he,unavailablePlayers:m.filter(Ce=>!mn(Ce,_)),availableCount:se,requiredCount:K}}return se<K?{type:"insufficient",availableCount:se,requiredCount:K}:m.length===0?{type:"ready",availableCount:se,requiredCount:K}:{type:"complete",availableCount:se,requiredCount:K}}function Lo(_){const m=Mo(_);return m.type==="incomplete"||m.type==="insufficient"}function Sn(_){const m=Mo(_);switch(m.type){case"incomplete":return m.hasUnavailablePlayers?m.unavailablePlayers.length===1?`Sélection incomplète : ${m.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${m.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${m.availableCount} joueurs disponibles pour ${m.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${m.availableCount} disponibles pour ${m.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${m.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${m.availableCount} joueurs disponibles`;default:return""}}async function fc({eventId:_,eventData:m,reason:D}){if(!o.value)return;const K={id:_,...m};if(K.archived){console.debug("Événement archivé, aucune notification envoyée"),Ne.value=!0,yt.value="Aucune notification envoyée : événement archivé",setTimeout(()=>{Ne.value=!1},3e3);return}const se=[];for(const xe of Je.value){if(!await Xi(xe.id,o.value))continue;const Ce=await $I(xe.id,o.value);if(Ce)try{const Ke=await Xf({seasonId:o.value,playerId:xe.id,eventId:K.id,action:"yes"}),et=await Xf({seasonId:o.value,playerId:xe.id,eventId:K.id,action:"no"}),It=`${Ke.url}&slug=${encodeURIComponent(s)}`,ht=`${et.url}&slug=${encodeURIComponent(s)}`;await HN({toEmail:Ce,playerName:xe.name,eventTitle:K.title,eventDate:Xa(K.date),yesUrl:It,noUrl:ht,reason:D})}catch{console.error("Email non envoyé pour un joueur"),se.push(xe.id)}}Ne.value=!0,yt.value=se.length>0?`Emails envoyés (avec ${se.length} échec(s))`:"Emails envoyés aux joueurs protégés.",setTimeout(()=>{Ne.value=!1},3e3)}function Fo(_){if(_!=null&&_.archived){Ne.value=!0,yt.value="Impossible d'annoncer un événement archivé",setTimeout(()=>{Ne.value=!1},3e3);return}u(),Ye.value=_,Be.value=!0}function es(){Be.value=!1,Ye.value=null}function u(){zt.value=!1,Mt.value=null}async function h({eventId:_,eventData:m,reason:D,selectedPlayers:K}){try{D==="selection"?(await JN({eventId:_,eventData:m,selectedPlayers:K,seasonId:o.value,seasonSlug:s,players:_o.value}),M(),Ne.value=!0,yt.value="Notifications de sélection envoyées avec succès !",setTimeout(()=>{Ne.value=!1},3e3)):(await fc({eventId:_,eventData:m,reason:D}),es(),Ne.value=!0,yt.value="Notifications envoyées avec succès !",setTimeout(()=>{Ne.value=!1},3e3))}catch{console.error("Erreur lors de l'envoi des notifications"),Ne.value=!0,yt.value="Erreur lors de l'envoi des notifications",setTimeout(()=>{Ne.value=!1},3e3)}}function g(_){if(!_)return{};const m={};return Je.value.forEach(D=>{m[D.name]=mn(D.name,_)}),m}function b(_){Se.value=_,Ie.value=!0}function M(){Ie.value=!1,Se.value=null}async function G(){if(!Se.value)return;const _=Se.value.id,m=Se.value.playerCount||6;if(ko(_)===0){Ne.value=!0,yt.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{Ne.value=!1},3e3);return}await Xr({type:"launchSelection",data:{eventId:_,count:m}})}function de(){M(),Ne.value=!0,yt.value="Sélection validée !",setTimeout(()=>{Ne.value=!1},3e3)}async function dt(_,m){if(!_||!m)return;ln(),Xn.value=_,yo.value=!0,await un();const D=document.querySelector(`[data-event-id="${_}"]`);if(!D){console.warn("Élément événement non trouvé dans le DOM");return}document.querySelectorAll(".focused-event-highlight").forEach(he=>{he.classList.remove("focused-event-highlight")});const K=document.querySelectorAll(`[data-event-id="${_}"]`);K.forEach(he=>{he.classList.add("focused-event-highlight")});const se=K[0],xe=K[K.length-1];se&&se.classList.add("focused-event-column-start"),xe&&xe.classList.add("focused-event-column-end"),await ot(D),Ne.value=!0,yt.value=`Événement ciblé : ${m.title}`,setTimeout(()=>{Ne.value=!1},4e3),Ei.value=setTimeout(()=>{ln()},8e3)}function tn(_){if(!_)return;const m=qe.value.find(D=>D.id===_);if(!m){console.warn("Événement non trouvé dans la liste des événements"),setTimeout(()=>{const D=qe.value.find(K=>K.id===_);D?dt(_,D):console.error("Événement toujours introuvable après retry")},500);return}dt(_,m)}async function ot(_){if(!_)return;if(await new Promise(D=>setTimeout(D,100)),window.innerWidth<=768){const D=qn.value;if(D){const K=_.offsetLeft,se=_.offsetWidth,xe=D.clientWidth,he=K-xe/2+se/2,Ce=D.scrollWidth-xe,Ke=Math.max(0,Math.min(he,Ce));D.scrollTo({left:Ke,behavior:"smooth"}),setTimeout(()=>{const et=_.getBoundingClientRect();if(et.left<0||et.right>window.innerWidth){const It=K-20;D.scrollTo({left:Math.max(0,It),behavior:"smooth"})}},500)}}else _.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const m=qn.value;m&&setTimeout(()=>{const D=document.querySelector(`[data-event-id="${Xn.value}"]`);if(D&&D.closest("tbody")){const K=D.offsetLeft,se=D.offsetWidth,xe=m.clientWidth,he=K-xe/2+se/2,Ce=m.scrollWidth-xe,Ke=Math.max(0,Math.min(he,Ce));m.scrollTo({left:Ke,behavior:"smooth"})}},300)}function ln(){Ei.value&&(clearTimeout(Ei.value),Ei.value=null),Xn.value=null,yo.value=!1,document.querySelectorAll(".focused-event-highlight").forEach(_=>{_.classList.remove("focused-event-highlight")}),document.querySelectorAll(".focused-event-column-start, .focused-event-column-end").forEach(_=>{_.classList.remove("focused-event-column-start","focused-event-column-end")})}return(_,m)=>{var D,K,se,xe,he,Ce,Ke,et,It,ht,kt,Dt,at,Zn,ts,Ni,Uo,Gm,Km;return U(),j(St,null,[p("div",kM,[p("div",DM,[p("button",{onClick:lc,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour à l'accueil"},m[65]||(m[65]=[p("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),p("h1",VM,le(i.value?i.value:"Chargement..."),1),p("div",NM,[p("div",OM,[p("button",{onClick:Yu,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:Qr.value?"Masquer les événements archivés":"Afficher les événements archivés"},[p("span",LM,le(Qr.value?"📂":"📁"),1)],8,MM),p("button",{onClick:Qa,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Lancer le tutoriel interactif","aria-label":"Lancer le tutoriel interactif"},m[66]||(m[66]=[p("span",{class:"text-2xl"},"✨",-1)])),p("button",{onClick:m[0]||(m[0]=H=>fn.value=!0),class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Comment ça marche ?","aria-label":"Comment ça marche ?"},m[67]||(m[67]=[p("span",{class:"text-2xl"},"❓",-1)]))]),p("div",{class:"relative md:hidden",ref_key:"headerMenuRef",ref:gr},[p("button",{onClick:Kt(Ku,["stop"]),class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Menu","aria-label":"Menu"},m[68]||(m[68]=[p("span",{class:"text-2xl"},"⋯",-1)])),mr.value?(U(),j("div",FM,[p("button",{onClick:m[1]||(m[1]=H=>{Yu(),xo()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},[p("span",null,le(Qr.value?"📂":"📁"),1),p("span",UM,le(Qr.value?"Masquer archivés":"Afficher archivés"),1)]),p("button",{onClick:m[2]||(m[2]=H=>{Qa(),xo()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[69]||(m[69]=[p("span",null,"✨",-1),p("span",{class:"text-sm"},"Lancer le tutoriel",-1)])),p("button",{onClick:m[3]||(m[3]=H=>{fn.value=!0,xo()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[70]||(m[70]=[p("span",null,"❓",-1),p("span",{class:"text-sm"},"Comment ça marche ?",-1)]))])):ae("",!0)],512)])],512),p("div",$M,[p("div",{ref_key:"headerBarRef",ref:Io,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[p("div",jM,[qe.value.length===0&&Je.value.length===0?ae("",!0):(U(),j("div",BM,[p("div",{class:"flex items-center justify-center h-full gap-2"},[p("button",{onClick:or,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel événement"},m[71]||(m[71]=[p("span",{class:"text-lg"},"➕",-1),p("span",{class:"hidden sm:inline"},"Ajouter un événement",-1),p("span",{class:"sm:hidden"},"Événement",-1)]))])])),p("div",qM,[p("div",{ref_key:"headerEventsRef",ref:An,class:"flex relative z-[60]",style:Hs({transform:`translateX(-${wo.value}px)`})},[(U(!0),j(St,null,_r(zn.value,H=>(U(),j("div",{key:"h-"+H.id,"data-event-id":H.id,class:"col-event flex-shrink-0 p-3 text-center cursor-pointer",onClick:Pn=>Us(H)},[p("div",{class:"header-date text-[16px] md:text-base text-gray-300",title:Xa(H.date)},le(Th(H.date)),9,GM),p("div",{class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2",title:H.title},le(H.title||"Sans titre"),9,KM),H.archived?(U(),j("div",HM,"(Archivé)")):ae("",!0),Lo(H.id)?(U(),j("div",{key:1,class:"mt-1 w-4 h-4 bg-yellow-500 rounded-full mx-auto flex items-center justify-center hover:bg-yellow-400 transition-colors duration-200",title:Sn(H.id)+" - Cliquez pour ouvrir la sélection",onClick:Kt(Pn=>b(H),["stop"])},m[72]||(m[72]=[p("span",{class:"text-xs text-white font-bold"},"⚠️",-1)]),8,WM)):Mo(H.id).type==="ready"?(U(),j("div",{key:2,class:"mt-1 w-4 h-4 bg-green-500 rounded-full mx-auto flex items-center justify-center hover:bg-green-400 transition-colors duration-200",title:Sn(H.id)+" - Cliquez pour ouvrir la sélection",onClick:Kt(Pn=>b(H),["stop"])},m[73]||(m[73]=[p("span",{class:"text-xs text-white font-bold"},"🎲",-1)]),8,QM)):ae("",!0)],8,zM))),128))],4)]),m[74]||(m[74]=p("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),gt(p("button",{onClick:m[4]||(m[4]=Kt(H=>zu(-1,H),["prevent"])),onMousedown:m[5]||(m[5]=Kt(H=>fr(-1,H),["prevent"])),onMouseup:m[6]||(m[6]=H=>pr(H)),onMouseleave:m[7]||(m[7]=H=>pr(H)),onTouchstart:m[8]||(m[8]=Kt(H=>fr(-1,H),["prevent"])),onTouchend:m[9]||(m[9]=H=>pr(H)),onTouchcancel:m[10]||(m[10]=H=>pr(H)),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements précédents — cliquez pour défiler"}," ‹ ",544),[[Oh,bo.value]]),gt(p("button",{onClick:m[11]||(m[11]=Kt(H=>zu(1,H),["prevent"])),onMousedown:m[12]||(m[12]=Kt(H=>fr(1,H),["prevent"])),onMouseup:m[13]||(m[13]=H=>pr(H)),onMouseleave:m[14]||(m[14]=H=>pr(H)),onTouchstart:m[15]||(m[15]=Kt(H=>fr(1,H),["prevent"])),onTouchend:m[16]||(m[16]=H=>pr(H)),onTouchcancel:m[17]||(m[17]=H=>pr(H)),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements suivants — cliquez pour défiler"}," › ",544),[[Oh,Tr.value]])])],512),gt(p("div",{ref_key:"gridboardRef",ref:qn,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[_e.value===1?(U(),j("div",JM,[F.value.position?(U(),j("div",{key:0,class:"fixed z-[400]",style:Hs({left:F.value.position.x+"px",top:F.value.position.y+"px"})},[p("div",{id:"coachmark-add",class:Hn(["coachmark pointer-events-auto max-w-sm bg-gray-900 border border-purple-500/40 rounded-xl shadow-2xl p-3 text-white relative",{"coachmark-right":F.value.side==="right","coachmark-left":F.value.side==="left"}])},[m[76]||(m[76]=p("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ajoutez votre nom",-1)),m[77]||(m[77]=p("div",{class:"text-base md:text-sm text-gray-300 mb-2"},'Cliquez sur "Ajouter un joueur" pour vous inscrire',-1)),p("div",YM,[m[75]||(m[75]=p("span",{class:"text-purple-300 text-base md:text-sm"},"Étape 1/4",-1)),p("button",{onClick:m[18]||(m[18]=H=>Ar(0)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant >")])],2)],4)):ae("",!0)])):ae("",!0),_e.value===2&&$.value&&B.value?(U(),j("div",XM,[z.value.position?(U(),j("div",{key:0,class:"fixed z-[400]",style:Hs({position:"absolute",left:z.value.position.x+"px",top:z.value.position.y+"px"})},[p("div",ZM,[m[79]||(m[79]=p("div",{class:"text-lg md:text-base font-semibold mb-1"},"Indiquez vos disponibilités",-1)),m[80]||(m[80]=p("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez cette case pour alterner Oui / Non / Vide",-1)),p("div",eL,[m[78]||(m[78]=p("span",{class:"text-pink-300 text-base md:text-sm"},"Étape 2/4",-1)),p("button",{onClick:m[19]||(m[19]=H=>Ar(1)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ae("",!0)])):ae("",!0),_e.value===3&&$.value?(U(),j("div",tL,[ne.value.position?(U(),j("div",{key:0,class:"fixed z-[400]",style:Hs({position:"absolute",left:ne.value.position.x+"px",top:ne.value.position.y+"px"})},[p("div",nL,[m[82]||(m[82]=p("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ouvrez votre fiche",-1)),m[83]||(m[83]=p("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez sur votre nom pour voir les détails et la protection",-1)),p("div",rL,[m[81]||(m[81]=p("span",{class:"text-yellow-300 text-base md:text-sm"},"Étape 3/4",-1)),p("button",{onClick:m[20]||(m[20]=H=>Ar(2)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ae("",!0)])):ae("",!0),p("table",sL,[p("colgroup",null,[m[84]||(m[84]=p("col",{class:"col-left"},null,-1)),(U(!0),j(St,null,_r(zn.value,(H,Pn)=>(U(),j("col",{key:"c"+Pn,class:"col-event"}))),128)),m[85]||(m[85]=p("col",{class:"col-right"},null,-1))]),m[89]||(m[89]=p("thead",{class:"hidden"},null,-1)),p("tbody",null,[(U(!0),j(St,null,_r(Ri.value,H=>{var Pn;return U(),j("tr",{key:H.id,class:Hn(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":H.id===k.value}]),"data-player-id":H.id},[p("td",oL,[p("div",aL,[xi(H.id)?(U(),j("span",lL," 🔒 ")):ae("",!0),p("span",{onClick:ns=>ol(H),class:Hn(["player-name hover:border-b-2 hover:border-dashed hover:border-purple-400 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight",{"inline-block rounded px-1 ring-2 ring-yellow-400 animate-pulse":_e.value===3&&H.id===($.value||((Pn=Ri.value[0])==null?void 0:Pn.id))}]),title:"Cliquez pour voir les détails : "+H.name},le(H.name),11,uL)])]),(U(!0),j(St,null,_r(zn.value,ns=>{var Hm,Wm,Qm;return U(),j("td",{key:ns.id,"data-event-id":ns.id,class:Hn(["p-0",{"relative ring-2 ring-pink-400 rounded-md animate-pulse":_e.value===2&&H.id===($.value||((Hm=Ri.value[0])==null?void 0:Hm.id))&&ns.id===(B.value||((Wm=zn.value[0])==null?void 0:Wm.id))}])},[_t(Ly,{"player-name":H.name,"event-id":ns.id,"is-available":mn(H.name,ns.id),"is-selected":Xu(H.name,ns.id),"chance-percent":((Qm=Wr.value[H.name])==null?void 0:Qm[ns.id])??null,"show-selected-chance":Ci(ns.id),onToggle:Co},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance"])],10,cL)}),128)),m[86]||(m[86]=p("td",{class:"p-3 md:p-4"},null,-1))],10,iL)}),128)),p("tr",dL,[p("td",hL,[p("div",fL,[p("button",{onClick:m[21]||(m[21]=H=>C.value=!0),class:"w-full md:w-auto flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur","data-onboarding":"add-player"},m[87]||(m[87]=[p("span",{class:"text-lg"},"➕",-1),p("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),p("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(U(!0),j(St,null,_r(zn.value,H=>(U(),j("td",{key:"add-row-"+H.id,"data-event-id":H.id,class:"p-3 md:p-5"},null,8,pL))),128)),m[88]||(m[88]=p("td",{class:"p-3 md:p-4"},null,-1))])])])],512),[[Oh,!sr.value]])])]),sr.value?(U(),j("div",mL,[p("div",gL,[m[90]||(m[90]=p("div",{class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"},[p("span",{class:"text-3xl"},"🎭")],-1)),p("p",vL,le(an.value)+"…",1),p("div",yL,[p("div",{class:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-300",style:Hs({width:xt.value+"%"})},null,4)]),p("p",_L,le(xt.value)+"%",1)])])):ae("",!0),sr.value?ae("",!0):(U(),vp(CM,{key:1,"season-id":o.value,"season-slug":hs(s),"players-count":Je.value.length,"events-count":qe.value.length,"onboarding-done":((D=a.value)==null?void 0:D.onboardingCreatorDone)===!0,onCreateEvent:or,onAddPlayer:m[22]||(m[22]=()=>{C.value=!0}),onCopyLink:qr,onDismissed:Qt},null,8,["season-id","season-slug","players-count","events-count","onboarding-done"])),ae("",!0),Ne.value?(U(),j("div",bL,[p("div",wL,[m[91]||(m[91]=p("span",{class:"text-xl"},"✨",-1)),p("span",null,le(yt.value),1)])])):ae("",!0),jr.value?(U(),j("div",IL,[p("div",EL,[m[92]||(m[92]=p("span",{class:"text-xl"},"⚠️",-1)),p("span",null,le(Br.value),1)])])):ae("",!0),Ns.value?(U(),j("div",TL,[p("div",xL,[m[98]||(m[98]=p("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvel événement",-1)),p("div",AL,[m[93]||(m[93]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),gt(p("input",{"onUpdate:modelValue":m[23]||(m[23]=H=>Gr.value=H),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'événement"},null,512),[[Ft,Gr.value]])]),p("div",SL,[m[94]||(m[94]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),gt(p("input",{"onUpdate:modelValue":m[24]||(m[24]=H=>Kr.value=H),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[Ft,Kr.value]])]),p("div",PL,[m[95]||(m[95]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),gt(p("textarea",{"onUpdate:modelValue":m[25]||(m[25]=H=>Ai.value=H),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)"},null,512),[[Ft,Ai.value]])]),p("div",RL,[gt(p("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":m[26]||(m[26]=H=>Pi.value=H),class:"w-4 h-4"},null,512),[[Tg,Pi.value]]),m[96]||(m[96]=p("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Créer comme archivé",-1))]),p("div",CL,[m[97]||(m[97]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),gt(p("input",{"onUpdate:modelValue":m[27]||(m[27]=H=>Si.value=H),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[Ft,Si.value]])]),p("div",{class:"flex justify-end space-x-3"},[p("button",{onClick:Hr,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:Qu,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):ae("",!0),C.value?(U(),j("div",kL,[p("div",DL,[m[100]||(m[100]=p("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau joueur",-1)),p("div",VL,[m[99]||(m[99]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),gt(p("input",{"onUpdate:modelValue":m[28]||(m[28]=H=>A.value=H),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[Ft,A.value]])]),p("div",NL,[p("button",{onClick:m[29]||(m[29]=H=>C.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:Wu,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):ae("",!0),l.value?(U(),j("div",OL,[p("div",ML,[m[101]||(m[101]=yr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cet événement ?</p></div>',1)),p("div",LL,[p("button",{onClick:Hu,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:m[30]||(m[30]=()=>Ih()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ae("",!0),Fs.value?(U(),j("div",FL,[p("div",UL,[m[102]||(m[102]=yr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce joueur ?</p></div>',1)),p("div",$L,[p("button",{onClick:xh,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),p("button",{onClick:m[31]||(m[31]=()=>Lt()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):ae("",!0),re.value?(U(),j("div",jL,[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},[m[103]||(m[103]=yr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🎭</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.</p></div><p class="mb-6 text-sm text-yellow-400 bg-yellow-900/20 p-3 rounded-lg border border-yellow-500/20"> ⚠️ Pensez à prévenir les gens du changement ! </p>',2)),p("div",{class:"flex justify-end space-x-3"},[p("button",{onClick:nc,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),p("button",{onClick:tc,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):ae("",!0),S.value?(U(),j("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:Oo},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:m[41]||(m[41]=Kt(()=>{},["stop"]))},[p("div",BL,[p("button",{onClick:Oo,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),m[104]||(m[104]=p("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[p("span",{class:"text-2xl md:text-3xl"},"🎭")],-1)),p("h2",qL,le((K=N.value)==null?void 0:K.title),1),p("p",zL,le(Xa((se=N.value)==null?void 0:se.date)),1)]),p("div",GL,[(xe=N.value)!=null&&xe.description?(U(),j("div",KL,[p("p",HL,le(N.value.description),1)])):ae("",!0),p("div",WL,[p("div",QL,[p("div",JL,le(ko((he=N.value)==null?void 0:he.id)),1),m[105]||(m[105]=p("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),p("div",YL,[p("div",XL,le(Za((Ce=N.value)==null?void 0:Ce.id)),1),m[106]||(m[106]=p("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),p("div",ZL,[p("div",eF,le(((Ke=N.value)==null?void 0:Ke.playerCount)||6),1),m[107]||(m[107]=p("div",{class:"text-xs md:text-sm text-gray-300"},"À sélectionner",-1))])]),N.value?(U(),j("div",tF,[m[109]||(m[109]=p("h3",{class:"text-lg font-semibold text-white mb-3"},"Disponibilités des joueurs",-1)),p("div",nF,[m[108]||(m[108]=p("div",{class:"grid grid-cols-12 gap-0 bg-gray-700 border-b border-gray-600"},[p("div",{class:"col-span-4 p-3 font-medium text-gray-300"},"Joueur"),p("div",{class:"col-span-8 p-3 font-medium text-gray-300 text-center"},"Disponibilité")],-1)),(U(!0),j(St,null,_r(Ri.value,H=>{var Pn;return U(),j("div",{key:H.id,class:"grid grid-cols-12 gap-0 border-b border-gray-600 last:border-b-0 hover:bg-gray-700/50 transition-colors"},[p("div",rF,[p("span",sF,le(H.name),1),xi(H.id)?(U(),j("span",iF,"🔒")):ae("",!0)]),p("div",oF,[_t(Ly,{"player-name":H.name,"event-id":N.value.id,"is-available":g(N.value.id)[H.name],"is-selected":sl(H.name,N.value.id),"chance-percent":((Pn=Wr.value[H.name])==null?void 0:Pn[N.value.id])??null,"show-selected-chance":Ci(N.value.id),onToggle:rl},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance"])])])}),128))])])):ae("",!0),p("div",aF,[p("button",{onClick:Vi,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},m[110]||(m[110]=[p("span",null,"✏️",-1),p("span",null,"Modifier",-1)])),p("button",{onClick:m[32]||(m[32]=H=>Fo(N.value)),disabled:(et=N.value)==null?void 0:et.archived,class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(It=N.value)!=null&&It.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[111]||(m[111]=[p("span",null,"📢",-1),p("span",null,"Annoncer",-1)]),8,lF),p("button",{onClick:il,class:"px-5 py-3 bg-gradient-to-r from-indigo-500 to-blue-600 text-white rounded-lg hover:from-indigo-600 hover:to-blue-700 transition-all duration-300 flex items-center gap-2",title:(ht=N.value)!=null&&ht.archived?"Désarchiver cet événement":"Archiver cet événement"},[p("span",null,le((kt=N.value)!=null&&kt.archived?"📂":"📁"),1),p("span",null,le((Dt=N.value)!=null&&Dt.archived?"Désarchiver":"Archiver"),1)],8,uF),p("button",{onClick:m[33]||(m[33]=H=>b(N.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},m[112]||(m[112]=[p("span",null,"🎭",-1),p("span",null,"Sélectionner",-1)])),p("button",{onClick:m[34]||(m[34]=H=>{var Pn;return So((Pn=N.value)==null?void 0:Pn.id)}),class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},m[113]||(m[113]=[p("span",null,"🗑️",-1),p("span",null,"Supprimer",-1)])),p("button",{onClick:nl,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")]),Y.value?(U(),j("div",cF,[p("button",{onClick:m[35]||(m[35]=H=>{Vi(),Y.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"},"✏️ Modifier"),p("button",{onClick:m[36]||(m[36]=H=>{Fo(N.value),Y.value=!1}),disabled:(at=N.value)==null?void 0:at.archived,class:"w-full px-4 py-3 rounded-lg bg-amber-600/20 text-amber-200 border border-amber-500/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(Zn=N.value)!=null&&Zn.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[114]||(m[114]=[p("span",null,"📢",-1),p("span",null,"Annoncer",-1)]),8,dF),p("button",{onClick:m[37]||(m[37]=H=>{il(),Y.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-indigo-600/20 text-indigo-200 border border-indigo-500/30"},le((ts=N.value)!=null&&ts.archived?"📂 Désarchiver":"📁 Archiver"),1),p("button",{onClick:m[38]||(m[38]=H=>{var Pn;So((Pn=N.value)==null?void 0:Pn.id),Y.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"},"🗑️ Supprimer")])):ae("",!0)]),p("div",hF,[p("button",{onClick:m[39]||(m[39]=H=>b(N.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélectionner"),p("button",{onClick:nl,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),p("button",{onClick:m[40]||(m[40]=H=>Y.value=!Y.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):ae("",!0),_t(GI,{show:fe.value,player:oe.value,seasonId:o.value,onClose:m[42]||(m[42]=H=>fe.value=!1),onVerified:uc},null,8,["show","player","seasonId"]),d.value?(U(),j("div",fF,[p("div",pF,[m[120]||(m[120]=p("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier l'événement",-1)),p("div",mF,[m[115]||(m[115]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),gt(p("input",{"onUpdate:modelValue":m[43]||(m[43]=H=>f.value=H),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Cn(zr,["esc"]),Cn(Po,["enter"])],ref:"editTitleInput"},null,544),[[Ft,f.value]])]),p("div",gF,[m[116]||(m[116]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),gt(p("input",{"onUpdate:modelValue":m[44]||(m[44]=H=>v.value=H),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[Cn(zr,["esc"]),Cn(Po,["enter"])]},null,544),[[Ft,v.value]])]),p("div",vF,[m[117]||(m[117]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),gt(p("textarea",{"onUpdate:modelValue":m[45]||(m[45]=H=>J.value=H),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)",onKeydown:Cn(zr,["esc"])},null,544),[[Ft,J.value]])]),p("div",yF,[gt(p("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":m[46]||(m[46]=H=>W.value=H),class:"w-4 h-4"},null,512),[[Tg,W.value]]),m[118]||(m[118]=p("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver cet événement",-1))]),p("div",_F,[m[119]||(m[119]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),gt(p("input",{"onUpdate:modelValue":m[47]||(m[47]=H=>y.value=H),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:Cn(zr,["esc"])},null,544),[[Ft,y.value]])]),p("div",{class:"flex justify-end space-x-3"},[p("button",{onClick:zr,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:Po,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ae("",!0),_t(RI,{show:R.value,message:rc(),error:w.value,"session-info":No(),onSubmit:vr,onCancel:ic},null,8,["show","message","error","session-info"]),ze.value?(U(),j("div",bF,[p("div",wF,[m[122]||(m[122]=yr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protégé par mot de passe</p></div>',1)),p("div",IF,[p("div",EF,[p("div",null,[m[121]||(m[121]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),gt(p("input",{"onUpdate:modelValue":m[48]||(m[48]=H=>Ge.value=H),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[49]||(m[49]=Cn(H=>oc(Ge.value),["enter"])),ref_key:"playerPasswordInputRef",ref:ke},null,544),[[Ft,Ge.value]])])]),p("button",{onClick:m[50]||(m[50]=H=>oc(Ge.value)),disabled:!Ge.value||je.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[je.value?(U(),j("span",xF,"⏳")):(U(),j("span",AF,"🔓")),p("span",null,le(je.value?"Vérification...":"Vérifier et supprimer"),1)],8,TF)]),p("div",SF,[p("button",{onClick:m[51]||(m[51]=H=>Te.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),it.value?(U(),j("div",PF,[p("div",RF,le(it.value),1)])):ae("",!0),p("div",{class:"flex justify-center"},[p("button",{onClick:Di,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ae("",!0),ee.value?(U(),j("div",CF,[p("div",kF,[m[125]||(m[125]=yr('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protégé par mot de passe</p></div>',1)),p("div",DF,[p("div",VF,[p("div",null,[m[123]||(m[123]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),gt(p("input",{"onUpdate:modelValue":m[52]||(m[52]=H=>Fe.value=H),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[53]||(m[53]=Cn(H=>el(Fe.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:hn},null,544),[[Ft,Fe.value]])])]),p("div",NF,[p("button",{onClick:m[54]||(m[54]=H=>wt.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),we.value?(U(),j("div",OF,[p("div",MF,le(we.value),1)])):ae("",!0)]),p("div",LF,[p("button",{onClick:tl,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),p("button",{onClick:m[55]||(m[55]=H=>el(Fe.value)),disabled:!Fe.value||ct.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[ct.value?(U(),j("span",UF,"⏳")):(U(),j("span",$F,"🔓")),p("span",null,[$n(le(ct.value?"Vérification...":"Vérifier"),1),m[124]||(m[124]=p("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,FF)])])])):ae("",!0),wt.value?(U(),j("div",{key:14,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[58]||(m[58]=H=>wt.value=!1)},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[57]||(m[57]=Kt(()=>{},["stop"]))},[m[127]||(m[127]=yr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),p("div",jF,[m[126]||(m[126]=p("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),p("button",{onClick:Vo,disabled:Q.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[Q.value?(U(),j("span",qF,"⏳")):(U(),j("span",zF,"📧")),p("span",null,le(Q.value?"Envoi...":"Envoyer l'email"),1)],8,BF)]),be.value?(U(),j("div",GF,[p("div",KF,le(be.value),1)])):ae("",!0),me.value?(U(),j("div",HF,[p("div",WF,le(me.value),1)])):ae("",!0),p("div",QF,[p("button",{onClick:m[56]||(m[56]=H=>wt.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ae("",!0),Te.value?(U(),j("div",{key:15,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[61]||(m[61]=H=>Te.value=!1)},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[60]||(m[60]=Kt(()=>{},["stop"]))},[m[129]||(m[129]=yr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p></div>',1)),p("div",JF,[m[128]||(m[128]=p("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),p("button",{onClick:ac,disabled:Qe.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[Qe.value?(U(),j("span",XF,"⏳")):(U(),j("span",ZF,"📧")),p("span",null,le(Qe.value?"Envoi...":"Envoyer l'email"),1)],8,YF)]),ut.value?(U(),j("div",e4,[p("div",t4,le(ut.value),1)])):ae("",!0),T.value?(U(),j("div",n4,[p("div",r4,le(T.value),1)])):ae("",!0),p("div",s4,[p("button",{onClick:m[59]||(m[59]=H=>Te.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ae("",!0),_t(jO,{ref_key:"playerModalRef",ref:P,show:I.value,player:x.value,stats:hc(x.value),seasonId:o.value,"onboarding-step":_e.value,"onboarding-player-id":$.value,onClose:Sr,onUpdate:cc,onDelete:Ah,onRefresh:dc,onAdvanceOnboarding:m[62]||(m[62]=H=>{try{typeof _e.value<"u"&&(_e.value.value=H)}catch{}})},null,8,["show","player","stats","seasonId","onboarding-step","onboarding-player-id"]),_t(vM,{ref_key:"selectionModalRef",ref:Ve,show:Ie.value,event:Se.value,"current-selection":Oe.value[(Ni=Se.value)==null?void 0:Ni.id]||[],"available-count":ko((Uo=Se.value)==null?void 0:Uo.id),"selected-count":Za((Gm=Se.value)==null?void 0:Gm.id),"player-availability":g((Km=Se.value)==null?void 0:Km.id),"season-id":o.value,"season-slug":hs(s),players:_o.value,onClose:M,onSelection:G,onPerfect:de,onSendEmailNotifications:h},null,8,["show","event","current-selection","available-count","selected-count","player-availability","season-id","season-slug","players"]),_t(zI,{show:Be.value,event:Ye.value,"season-id":o.value,"season-slug":hs(s),players:_o.value,onClose:es,onSendEmailNotifications:h},null,8,["show","event","season-id","season-slug","players"]),_t(CI,{show:fn.value,onClose:m[63]||(m[63]=H=>fn.value=!1)},null,8,["show"]),zt.value?(U(),j("div",i4,[p("div",o4,[m[130]||(m[130]=p("h3",{class:"text-xl font-bold text-white mb-4 text-center"},"Voulez-vous annoncer cet événement ?",-1)),m[131]||(m[131]=p("p",{class:"text-gray-300 text-center mb-6"},"Envoyer des notifications aux joueurs pour qu'ils indiquent leur disponibilité",-1)),p("div",a4,[p("button",{onClick:m[64]||(m[64]=H=>Fo(Mt.value)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300"}," 📢 Oui "),p("button",{onClick:u,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300"}," Plus tard ")])])])):ae("",!0)],64)}}},l4={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},u4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},c4={key:0,class:"text-center py-8"},d4={key:1,class:"text-center py-8"},h4={class:"text-gray-300 mb-6"},f4={key:2,class:"space-y-6"},p4={class:"text-center"},m4={class:"text-gray-300"},g4={class:"font-semibold text-white"},v4={class:"space-y-4"},y4=["disabled"],_4={key:0,class:"animate-spin"},b4={key:1},w4={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},I4={class:"text-red-300 text-sm"},E4={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},T4={class:"text-green-300 text-sm"},x4={__name:"PasswordReset",setup(n){const e=yu(),t=vu(),r=O(!0),s=O(""),i=O(""),o=O(""),a=O(""),l=O(""),c=O(!1),d=O(""),f=O(""),v=nt(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);kr(async()=>{try{const{oobCode:A}=e.query;if(ce.debug("Token reçu (masqué)"),!A){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=A,i.value="patrice.lamarque+ron@gmail.com",r.value=!1}catch(A){ce.error("Erreur lors de la vérification du lien",A),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function y(){if(v.value){c.value=!0,d.value="",f.value="";try{ce.debug("Début réinitialisation avec token (masqué)"),await jk(vo,o.value,a.value),ce.info("Mot de passe Firebase Auth mis à jour"),ce.info("Réinitialisation terminée avec Firebase Auth"),f.value="Mot de passe réinitialisé avec succès ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{C()},3e3)}catch(A){ce.error("Erreur lors de la réinitialisation",A),A.code==="auth/weak-password"?d.value="Le mot de passe doit contenir au moins 6 caractères":A.code==="auth/invalid-action-code"?d.value="Lien de réinitialisation invalide ou expiré":d.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{c.value=!1}}}function C(){t.push("/")}return(A,k)=>(U(),j("div",l4,[p("div",u4,[k[8]||(k[8]=yr('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(U(),j("div",c4,k[2]||(k[2]=[p("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),p("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(U(),j("div",d4,[k[3]||(k[3]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"❌")],-1)),k[4]||(k[4]=p("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),p("p",h4,le(s.value),1),p("button",{onClick:C,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):i.value?(U(),j("div",f4,[p("div",p4,[p("p",m4,[k[5]||(k[5]=$n("Email : ")),p("span",g4,le(i.value),1)])]),p("div",v4,[p("div",null,[k[6]||(k[6]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),gt(p("input",{"onUpdate:modelValue":k[0]||(k[0]=$=>a.value=$),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:Cn(y,["enter"])},null,544),[[Ft,a.value]])]),p("div",null,[k[7]||(k[7]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),gt(p("input",{"onUpdate:modelValue":k[1]||(k[1]=$=>l.value=$),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:Cn(y,["enter"])},null,544),[[Ft,l.value]])])]),p("button",{onClick:y,disabled:!v.value||c.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[c.value?(U(),j("span",_4,"⏳")):(U(),j("span",b4,"🔑")),p("span",null,le(c.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,y4),d.value?(U(),j("div",w4,[p("div",I4,le(d.value),1)])):ae("",!0),f.value?(U(),j("div",E4,[p("div",T4,le(f.value),1)])):ae("",!0)])):ae("",!0)])]))}},A4={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},S4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},P4={class:"text-3xl"},R4={class:"text-2xl font-bold text-white mb-2"},C4={class:"text-gray-300 mb-6"},k4={__name:"MagicLink",setup(n){const e=yu(),t=vu(),r=O("loading"),s=O("Traitement en cours..."),i=O("Merci de patienter pendant la validation du lien."),o=nt(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/")}return kr(async()=>{try{BI("firebase");const l=String(e.query.sid||""),c=String(e.query.pid||"");let d=String(e.query.eid||"");const f=String(e.query.t||""),v=String(e.query.a||""),y=String(e.query.slug||"");if(!l||!c||!f||!v){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants.";return}if(v==="verify_email"&&(d="protection"),!(await OI({seasonId:l,playerId:c,eventId:d,token:f,action:v})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}if(v==="verify_email"){await FI({playerId:c,seasonId:l}),await Zf({seasonId:l,playerId:c,eventId:"protection",action:v}),r.value="ok",s.value="Email vérifié",i.value="Merci ! Vous pouvez maintenant définir votre mot de passe.",setTimeout(y?()=>t.push(`/season/${y}?player=${encodeURIComponent(c)}&open=protection&verified=1`):()=>t.push("/"),800);return}const A=Me(ve,"seasons",l,"players",c),k=await Ps(A),$=k.exists()&&k.data().name||"";if(!$){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}await qN({seasonId:l,playerName:$,eventId:d,value:v==="yes"}),await Zf({seasonId:l,playerId:c,eventId:d,action:v}),r.value="ok",s.value="Merci !",i.value=v==="yes"?"Votre disponibilité a été enregistrée: Disponible.":"Votre disponibilité a été enregistrée: Non disponible.",setTimeout(y?()=>t.push(`/season/${y}/event/${d}`):()=>t.push("/"),1200)}catch(l){ce.error("Magic link error",l),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,c)=>(U(),j("div",A4,[p("div",S4,[p("div",{class:Hn(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[p("span",P4,le(o.value),1)],2),p("h1",R4,le(s.value),1),p("p",C4,le(i.value),1),p("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},D4={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},V4={class:"text-center py-12 px-4"},N4={class:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},O4={class:"container mx-auto px-4 pb-16"},M4={class:"max-w-xl mx-auto bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl"},L4={class:"space-y-5"},F4=["onKeydown"],U4={class:"flex items-center justify-end gap-3 pt-2"},$4=["disabled"],j4={key:0,class:"mt-6 text-sm text-gray-200"},B4={__name:"JoinSeason",setup(n){const e=yu(),t=vu(),r=e.params.slug,s=O(""),i=O(""),o=O(""),a=O(!1),l=O("");kr(async()=>{const f=ih(Xe(ve,"seasons"),_m("slug","==",r)),v=await Pt(f);if(v.empty)l.value="Saison introuvable";else{const y=v.docs[0];s.value=y.id,i.value=y.data().name,document.title=`Rejoindre : ${i.value}`}});function c(){t.push(`/season/${r}`)}async function d(){if(!(!o.value.trim()||!s.value)){a.value=!0,l.value="";try{await qI(o.value.trim(),s.value),l.value="Inscription réussie. Vous pouvez maintenant indiquer vos disponibilités.";try{localStorage.setItem(`startPlayerTour:${s.value}`,"1"),localStorage.setItem(`dismissCreatorOnboarding:${s.value}`,"1")}catch{}setTimeout(()=>{c()},600)}catch(f){ce.error("Erreur inscription",f),l.value=`Erreur lors de l'inscription: ${(f==null?void 0:f.message)||"Veuillez réessayer"}`}finally{a.value=!1}}}return(f,v)=>(U(),j("div",D4,[p("div",V4,[p("h1",N4,le(i.value||"Rejoindre la saison"),1),v[1]||(v[1]=p("p",{class:"text-gray-300"},"Inscrivez-vous pour indiquer vos disponibilités aux événements",-1))]),p("div",O4,[p("div",M4,[v[3]||(v[3]=p("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Je rejoins la saison",-1)),p("div",L4,[p("div",null,[v[2]||(v[2]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Votre nom",-1)),gt(p("input",{"onUpdate:modelValue":v[0]||(v[0]=y=>o.value=y),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: Marie Dupont",onKeydown:Cn(Kt(d,["prevent"]),["enter"])},null,40,F4),[[Ft,o.value]])]),p("div",U4,[p("button",{onClick:c,class:"px-5 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),p("button",{disabled:!o.value.trim()||a.value,onClick:d,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Rejoindre ",8,$4)])]),l.value?(U(),j("div",j4,le(l.value),1)):ae("",!0)])])]))}};{const n=()=>{};console.debug=n,console.log=n,console.info=n}const q4=[{path:"/",component:kN},{path:"/season/:slug",component:Fy,props:!0},{path:"/season/:slug/event/:eventId",component:Fy,props:!0},{path:"/season/:slug/join",component:B4,props:!0},{path:"/reset-password",component:x4},{path:"/magic",component:k4}],z4=gA({history:Gx("/"),routes:q4});dx(px).use(z4).mount("#app");export{Xe as $,Nw as A,lo as B,Lr as C,en as D,Q3 as E,co as F,cm as G,W3 as H,Q4 as I,cr as J,iC as K,aC as L,ch as M,w3 as N,I3 as O,kC as P,Tn as Q,h3 as R,e3 as S,Bt as T,$3 as U,eh as V,RC as W,U3 as X,b3 as Y,r3 as Z,T0 as _,ru as a,$u as a$,X4 as a0,oC as a1,yC as a2,H3 as a3,ou as a4,F3 as a5,o3 as a6,K3 as a7,Me as a8,c3 as a9,u3 as aA,P3 as aB,R3 as aC,d3 as aD,gC as aE,N3 as aF,O3 as aG,SC as aH,ih as aI,bw as aJ,Z4 as aK,L3 as aL,Mu as aM,Nn as aN,q3 as aO,G4 as aP,E3 as aQ,g3 as aR,m3 as aS,_3 as aT,a3 as aU,Nu as aV,B3 as aW,s3 as aX,_m as aY,Ow as aZ,tU as a_,uC as aa,n3 as ab,i3 as ac,G3 as ad,y3 as ae,v3 as af,qt as ag,Ou as ah,bC as ai,C3 as aj,Ps as ak,T3 as al,x3 as am,Pt as an,A3 as ao,S3 as ap,lC as aq,z3 as ar,j3 as as,t3 as at,f3 as au,p3 as av,l3 as aw,k3 as ax,V3 as ay,D3 as az,cC as b,Mk as b$,Uu as b0,rU as b1,cu as b2,mo as b3,Ys as b4,Y3 as b5,Zs as b6,Xs as b7,ws as b8,qc as b9,zC as bA,PU as bB,jU as bC,vy as bD,bD as bE,dk as bF,bU as bG,dU as bH,Lk as bI,DU as bJ,LU as bK,$U as bL,RU as bM,IU as bN,Zk as bO,iU as bP,VC as bQ,Fk as bR,VU as bS,MU as bT,UU as bU,HC as bV,AU as bW,pU as bX,$k as bY,cU as bZ,_U as b_,eU as ba,Yi as bb,ca as bc,EV as bd,X3 as be,CU as bf,Wf as bg,Z3 as bh,TV as bi,Bm as bj,ei as bk,lU as bl,eD as bm,lD as bn,IV as bo,gI as bp,Bk as bq,jk as br,fk as bs,qk as bt,nU as bu,SU as bv,fU as bw,yU as bx,kV as by,sU as bz,Ca as c,km as c0,aU as c1,zk as c2,hU as c3,kU as c4,OU as c5,FU as c6,xU as c7,oU as c8,TU as c9,vU as ca,Hk as cb,NU as cc,gU as cd,EU as ce,wU as cf,mU as cg,uU as ch,ho as d,Tt as e,Z as f,za as g,Du as h,$c as i,lh as j,Vu as k,oh as l,bm as m,ka as n,ah as o,Ki as p,CC as q,Ht as r,eo as s,ye as t,H4 as u,XS as v,$t as w,J3 as x,Ze as y,K4 as z};
